var D5=Object.defineProperty;var k5=(e$,t$,r$)=>t$ in e$?D5(e$,t$,{enumerable:!0,configurable:!0,writable:!0,value:r$}):e$[t$]=r$;var T5=(e$,t$,r$)=>k5(e$,typeof t$!="symbol"?t$+"":t$,r$);(function(){const t$=document.createElement("link").relList;if(t$&&t$.supports&&t$.supports("modulepreload"))return;for(const i$ of document.querySelectorAll('link[rel="modulepreload"]'))n$(i$);new MutationObserver(i$=>{for(const o$ of i$)if(o$.type==="childList")for(const s$ of o$.addedNodes)s$.tagName==="LINK"&&s$.rel==="modulepreload"&&n$(s$)}).observe(document,{childList:!0,subtree:!0});function r$(i$){const o$={};return i$.integrity&&(o$.integrity=i$.integrity),i$.referrerPolicy&&(o$.referrerPolicy=i$.referrerPolicy),i$.crossOrigin==="use-credentials"?o$.credentials="include":i$.crossOrigin==="anonymous"?o$.credentials="omit":o$.credentials="same-origin",o$}function n$(i$){if(i$.ep)return;i$.ep=!0;const o$=r$(i$);fetch(i$.href,o$)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e$){return e$&&e$.__esModule&&Object.prototype.hasOwnProperty.call(e$,"default")?e$.default:e$}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$2=Symbol.for("react.element"),n$2=Symbol.for("react.portal"),p$3=Symbol.for("react.fragment"),q$3=Symbol.for("react.strict_mode"),r$1=Symbol.for("react.profiler"),t$1=Symbol.for("react.provider"),u$1=Symbol.for("react.context"),v$3=Symbol.for("react.forward_ref"),w$1=Symbol.for("react.suspense"),x$1=Symbol.for("react.memo"),y$1=Symbol.for("react.lazy"),z$2=Symbol.iterator;function A$2(e$){return e$===null||typeof e$!="object"?null:(e$=z$2&&e$[z$2]||e$["@@iterator"],typeof e$=="function"?e$:null)}var B$2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$2=Object.assign,D$2={};function E$2(e$,t$,r$){this.props=e$,this.context=t$,this.refs=D$2,this.updater=r$||B$2}E$2.prototype.isReactComponent={};E$2.prototype.setState=function(e$,t$){if(typeof e$!="object"&&typeof e$!="function"&&e$!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e$,t$,"setState")};E$2.prototype.forceUpdate=function(e$){this.updater.enqueueForceUpdate(this,e$,"forceUpdate")};function F$1(){}F$1.prototype=E$2.prototype;function G$3(e$,t$,r$){this.props=e$,this.context=t$,this.refs=D$2,this.updater=r$||B$2}var H$3=G$3.prototype=new F$1;H$3.constructor=G$3;C$2(H$3,E$2.prototype);H$3.isPureReactComponent=!0;var I$2=Array.isArray,J$2=Object.prototype.hasOwnProperty,K$3={current:null},L$2={key:!0,ref:!0,__self:!0,__source:!0};function M$2(e$,t$,r$){var n$,i$={},o$=null,s$=null;if(t$!=null)for(n$ in t$.ref!==void 0&&(s$=t$.ref),t$.key!==void 0&&(o$=""+t$.key),t$)J$2.call(t$,n$)&&!L$2.hasOwnProperty(n$)&&(i$[n$]=t$[n$]);var a$=arguments.length-2;if(a$===1)i$.children=r$;else if(1<a$){for(var c$=Array(a$),u$=0;u$<a$;u$++)c$[u$]=arguments[u$+2];i$.children=c$}if(e$&&e$.defaultProps)for(n$ in a$=e$.defaultProps,a$)i$[n$]===void 0&&(i$[n$]=a$[n$]);return{$$typeof:l$2,type:e$,key:o$,ref:s$,props:i$,_owner:K$3.current}}function N$3(e$,t$){return{$$typeof:l$2,type:e$.type,key:t$,ref:e$.ref,props:e$.props,_owner:e$._owner}}function O$3(e$){return typeof e$=="object"&&e$!==null&&e$.$$typeof===l$2}function escape$1(e$){var t$={"=":"=0",":":"=2"};return"$"+e$.replace(/[=:]/g,function(r$){return t$[r$]})}var P$3=/\/+/g;function Q$3(e$,t$){return typeof e$=="object"&&e$!==null&&e$.key!=null?escape$1(""+e$.key):t$.toString(36)}function R$3(e$,t$,r$,n$,i$){var o$=typeof e$;(o$==="undefined"||o$==="boolean")&&(e$=null);var s$=!1;if(e$===null)s$=!0;else switch(o$){case"string":case"number":s$=!0;break;case"object":switch(e$.$$typeof){case l$2:case n$2:s$=!0}}if(s$)return s$=e$,i$=i$(s$),e$=n$===""?"."+Q$3(s$,0):n$,I$2(i$)?(r$="",e$!=null&&(r$=e$.replace(P$3,"$&/")+"/"),R$3(i$,t$,r$,"",function(u$){return u$})):i$!=null&&(O$3(i$)&&(i$=N$3(i$,r$+(!i$.key||s$&&s$.key===i$.key?"":(""+i$.key).replace(P$3,"$&/")+"/")+e$)),t$.push(i$)),1;if(s$=0,n$=n$===""?".":n$+":",I$2(e$))for(var a$=0;a$<e$.length;a$++){o$=e$[a$];var c$=n$+Q$3(o$,a$);s$+=R$3(o$,t$,r$,c$,i$)}else if(c$=A$2(e$),typeof c$=="function")for(e$=c$.call(e$),a$=0;!(o$=e$.next()).done;)o$=o$.value,c$=n$+Q$3(o$,a$++),s$+=R$3(o$,t$,r$,c$,i$);else if(o$==="object")throw t$=String(e$),Error("Objects are not valid as a React child (found: "+(t$==="[object Object]"?"object with keys {"+Object.keys(e$).join(", ")+"}":t$)+"). If you meant to render a collection of children, use an array instead.");return s$}function S$2(e$,t$,r$){if(e$==null)return e$;var n$=[],i$=0;return R$3(e$,n$,"","",function(o$){return t$.call(r$,o$,i$++)}),n$}function T$3(e$){if(e$._status===-1){var t$=e$._result;t$=t$(),t$.then(function(r$){(e$._status===0||e$._status===-1)&&(e$._status=1,e$._result=r$)},function(r$){(e$._status===0||e$._status===-1)&&(e$._status=2,e$._result=r$)}),e$._status===-1&&(e$._status=0,e$._result=t$)}if(e$._status===1)return e$._result.default;throw e$._result}var U$3={current:null},V$2={transition:null},W$3={ReactCurrentDispatcher:U$3,ReactCurrentBatchConfig:V$2,ReactCurrentOwner:K$3};function X$3(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$2,forEach:function(e$,t$,r$){S$2(e$,function(){t$.apply(this,arguments)},r$)},count:function(e$){var t$=0;return S$2(e$,function(){t$++}),t$},toArray:function(e$){return S$2(e$,function(t$){return t$})||[]},only:function(e$){if(!O$3(e$))throw Error("React.Children.only expected to receive a single React element child.");return e$}};react_production_min.Component=E$2;react_production_min.Fragment=p$3;react_production_min.Profiler=r$1;react_production_min.PureComponent=G$3;react_production_min.StrictMode=q$3;react_production_min.Suspense=w$1;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$3;react_production_min.act=X$3;react_production_min.cloneElement=function(e$,t$,r$){if(e$==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e$+".");var n$=C$2({},e$.props),i$=e$.key,o$=e$.ref,s$=e$._owner;if(t$!=null){if(t$.ref!==void 0&&(o$=t$.ref,s$=K$3.current),t$.key!==void 0&&(i$=""+t$.key),e$.type&&e$.type.defaultProps)var a$=e$.type.defaultProps;for(c$ in t$)J$2.call(t$,c$)&&!L$2.hasOwnProperty(c$)&&(n$[c$]=t$[c$]===void 0&&a$!==void 0?a$[c$]:t$[c$])}var c$=arguments.length-2;if(c$===1)n$.children=r$;else if(1<c$){a$=Array(c$);for(var u$=0;u$<c$;u$++)a$[u$]=arguments[u$+2];n$.children=a$}return{$$typeof:l$2,type:e$.type,key:i$,ref:o$,props:n$,_owner:s$}};react_production_min.createContext=function(e$){return e$={$$typeof:u$1,_currentValue:e$,_currentValue2:e$,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e$.Provider={$$typeof:t$1,_context:e$},e$.Consumer=e$};react_production_min.createElement=M$2;react_production_min.createFactory=function(e$){var t$=M$2.bind(null,e$);return t$.type=e$,t$};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(e$){return{$$typeof:v$3,render:e$}};react_production_min.isValidElement=O$3;react_production_min.lazy=function(e$){return{$$typeof:y$1,_payload:{_status:-1,_result:e$},_init:T$3}};react_production_min.memo=function(e$,t$){return{$$typeof:x$1,type:e$,compare:t$===void 0?null:t$}};react_production_min.startTransition=function(e$){var t$=V$2.transition;V$2.transition={};try{e$()}finally{V$2.transition=t$}};react_production_min.unstable_act=X$3;react_production_min.useCallback=function(e$,t$){return U$3.current.useCallback(e$,t$)};react_production_min.useContext=function(e$){return U$3.current.useContext(e$)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(e$){return U$3.current.useDeferredValue(e$)};react_production_min.useEffect=function(e$,t$){return U$3.current.useEffect(e$,t$)};react_production_min.useId=function(){return U$3.current.useId()};react_production_min.useImperativeHandle=function(e$,t$,r$){return U$3.current.useImperativeHandle(e$,t$,r$)};react_production_min.useInsertionEffect=function(e$,t$){return U$3.current.useInsertionEffect(e$,t$)};react_production_min.useLayoutEffect=function(e$,t$){return U$3.current.useLayoutEffect(e$,t$)};react_production_min.useMemo=function(e$,t$){return U$3.current.useMemo(e$,t$)};react_production_min.useReducer=function(e$,t$,r$){return U$3.current.useReducer(e$,t$,r$)};react_production_min.useRef=function(e$){return U$3.current.useRef(e$)};react_production_min.useState=function(e$){return U$3.current.useState(e$)};react_production_min.useSyncExternalStore=function(e$,t$,r$){return U$3.current.useSyncExternalStore(e$,t$,r$)};react_production_min.useTransition=function(){return U$3.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs(reactExports);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$1=reactExports,k$1=Symbol.for("react.element"),l$1=Symbol.for("react.fragment"),m$2=Object.prototype.hasOwnProperty,n$1=f$1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$2={key:!0,ref:!0,__self:!0,__source:!0};function q$2(e$,t$,r$){var n$,i$={},o$=null,s$=null;r$!==void 0&&(o$=""+r$),t$.key!==void 0&&(o$=""+t$.key),t$.ref!==void 0&&(s$=t$.ref);for(n$ in t$)m$2.call(t$,n$)&&!p$2.hasOwnProperty(n$)&&(i$[n$]=t$[n$]);if(e$&&e$.defaultProps)for(n$ in t$=e$.defaultProps,t$)i$[n$]===void 0&&(i$[n$]=t$[n$]);return{$$typeof:k$1,type:e$,key:o$,ref:s$,props:i$,_owner:n$1.current}}reactJsxRuntime_production_min.Fragment=l$1;reactJsxRuntime_production_min.jsx=q$2;reactJsxRuntime_production_min.jsxs=q$2;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e$){function t$(I$,P$){var w$=I$.length;I$.push(P$);e:for(;0<w$;){var E$=w$-1>>>1,T$=I$[E$];if(0<i$(T$,P$))I$[E$]=P$,I$[w$]=T$,w$=E$;else break e}}function r$(I$){return I$.length===0?null:I$[0]}function n$(I$){if(I$.length===0)return null;var P$=I$[0],w$=I$.pop();if(w$!==P$){I$[0]=w$;e:for(var E$=0,T$=I$.length,R$=T$>>>1;E$<R$;){var D$=2*(E$+1)-1,j$=I$[D$],G$=D$+1,z$=I$[G$];if(0>i$(j$,w$))G$<T$&&0>i$(z$,j$)?(I$[E$]=z$,I$[G$]=w$,E$=G$):(I$[E$]=j$,I$[D$]=w$,E$=D$);else if(G$<T$&&0>i$(z$,w$))I$[E$]=z$,I$[G$]=w$,E$=G$;else break e}}return P$}function i$(I$,P$){var w$=I$.sortIndex-P$.sortIndex;return w$!==0?w$:I$.id-P$.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o$=performance;e$.unstable_now=function(){return o$.now()}}else{var s$=Date,a$=s$.now();e$.unstable_now=function(){return s$.now()-a$}}var c$=[],u$=[],l$=1,d$=null,h$=3,p$=!1,_$=!1,f$=!1,m$=typeof setTimeout=="function"?setTimeout:null,g$=typeof clearTimeout=="function"?clearTimeout:null,v$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y$(I$){for(var P$=r$(u$);P$!==null;){if(P$.callback===null)n$(u$);else if(P$.startTime<=I$)n$(u$),P$.sortIndex=P$.expirationTime,t$(c$,P$);else break;P$=r$(u$)}}function S$(I$){if(f$=!1,y$(I$),!_$)if(r$(c$)!==null)_$=!0,V$(b$);else{var P$=r$(u$);P$!==null&&A$(S$,P$.startTime-I$)}}function b$(I$,P$){_$=!1,f$&&(f$=!1,g$(N$),N$=-1),p$=!0;var w$=h$;try{for(y$(P$),d$=r$(c$);d$!==null&&(!(d$.expirationTime>P$)||I$&&!U$());){var E$=d$.callback;if(typeof E$=="function"){d$.callback=null,h$=d$.priorityLevel;var T$=E$(d$.expirationTime<=P$);P$=e$.unstable_now(),typeof T$=="function"?d$.callback=T$:d$===r$(c$)&&n$(c$),y$(P$)}else n$(c$);d$=r$(c$)}if(d$!==null)var R$=!0;else{var D$=r$(u$);D$!==null&&A$(S$,D$.startTime-P$),R$=!1}return R$}finally{d$=null,h$=w$,p$=!1}}var $$=!1,C$=null,N$=-1,k$=5,O$=-1;function U$(){return!(e$.unstable_now()-O$<k$)}function x$(){if(C$!==null){var I$=e$.unstable_now();O$=I$;var P$=!0;try{P$=C$(!0,I$)}finally{P$?F$():($$=!1,C$=null)}}else $$=!1}var F$;if(typeof v$=="function")F$=function(){v$(x$)};else if(typeof MessageChannel<"u"){var L$=new MessageChannel,M$=L$.port2;L$.port1.onmessage=x$,F$=function(){M$.postMessage(null)}}else F$=function(){m$(x$,0)};function V$(I$){C$=I$,$$||($$=!0,F$())}function A$(I$,P$){N$=m$(function(){I$(e$.unstable_now())},P$)}e$.unstable_IdlePriority=5,e$.unstable_ImmediatePriority=1,e$.unstable_LowPriority=4,e$.unstable_NormalPriority=3,e$.unstable_Profiling=null,e$.unstable_UserBlockingPriority=2,e$.unstable_cancelCallback=function(I$){I$.callback=null},e$.unstable_continueExecution=function(){_$||p$||(_$=!0,V$(b$))},e$.unstable_forceFrameRate=function(I$){0>I$||125<I$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k$=0<I$?Math.floor(1e3/I$):5},e$.unstable_getCurrentPriorityLevel=function(){return h$},e$.unstable_getFirstCallbackNode=function(){return r$(c$)},e$.unstable_next=function(I$){switch(h$){case 1:case 2:case 3:var P$=3;break;default:P$=h$}var w$=h$;h$=P$;try{return I$()}finally{h$=w$}},e$.unstable_pauseExecution=function(){},e$.unstable_requestPaint=function(){},e$.unstable_runWithPriority=function(I$,P$){switch(I$){case 1:case 2:case 3:case 4:case 5:break;default:I$=3}var w$=h$;h$=I$;try{return P$()}finally{h$=w$}},e$.unstable_scheduleCallback=function(I$,P$,w$){var E$=e$.unstable_now();switch(typeof w$=="object"&&w$!==null?(w$=w$.delay,w$=typeof w$=="number"&&0<w$?E$+w$:E$):w$=E$,I$){case 1:var T$=-1;break;case 2:T$=250;break;case 5:T$=1073741823;break;case 4:T$=1e4;break;default:T$=5e3}return T$=w$+T$,I$={id:l$++,callback:P$,priorityLevel:I$,startTime:w$,expirationTime:T$,sortIndex:-1},w$>E$?(I$.sortIndex=w$,t$(u$,I$),r$(c$)===null&&I$===r$(u$)&&(f$?(g$(N$),N$=-1):f$=!0,A$(S$,w$-E$))):(I$.sortIndex=T$,t$(c$,I$),_$||p$||(_$=!0,V$(b$))),I$},e$.unstable_shouldYield=U$,e$.unstable_wrapCallback=function(I$){var P$=h$;return function(){var w$=h$;h$=P$;try{return I$.apply(this,arguments)}finally{h$=w$}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa$2=reactExports,ca$2=schedulerExports;function p$1(e$){for(var t$="https://reactjs.org/docs/error-decoder.html?invariant="+e$,r$=1;r$<arguments.length;r$++)t$+="&args[]="+encodeURIComponent(arguments[r$]);return"Minified React error #"+e$+"; visit "+t$+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da$2=new Set,ea$2={};function fa$2(e$,t$){ha$2(e$,t$),ha$2(e$+"Capture",t$)}function ha$2(e$,t$){for(ea$2[e$]=t$,e$=0;e$<t$.length;e$++)da$2.add(t$[e$])}var ia$2=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja$2=Object.prototype.hasOwnProperty,ka$2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la$2={},ma$2={};function oa$2(e$){return ja$2.call(ma$2,e$)?!0:ja$2.call(la$2,e$)?!1:ka$2.test(e$)?ma$2[e$]=!0:(la$2[e$]=!0,!1)}function pa$2(e$,t$,r$,n$){if(r$!==null&&r$.type===0)return!1;switch(typeof t$){case"function":case"symbol":return!0;case"boolean":return n$?!1:r$!==null?!r$.acceptsBooleans:(e$=e$.toLowerCase().slice(0,5),e$!=="data-"&&e$!=="aria-");default:return!1}}function qa$2(e$,t$,r$,n$){if(t$===null||typeof t$>"u"||pa$2(e$,t$,r$,n$))return!0;if(n$)return!1;if(r$!==null)switch(r$.type){case 3:return!t$;case 4:return t$===!1;case 5:return isNaN(t$);case 6:return isNaN(t$)||1>t$}return!1}function v$2(e$,t$,r$,n$,i$,o$,s$){this.acceptsBooleans=t$===2||t$===3||t$===4,this.attributeName=n$,this.attributeNamespace=i$,this.mustUseProperty=r$,this.propertyName=e$,this.type=t$,this.sanitizeURL=o$,this.removeEmptyString=s$}var z$1={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e$){z$1[e$]=new v$2(e$,0,!1,e$,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e$){var t$=e$[0];z$1[t$]=new v$2(t$,1,!1,e$[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e$){z$1[e$]=new v$2(e$,2,!1,e$.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e$){z$1[e$]=new v$2(e$,2,!1,e$,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e$){z$1[e$]=new v$2(e$,3,!1,e$.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e$){z$1[e$]=new v$2(e$,3,!0,e$,null,!1,!1)});["capture","download"].forEach(function(e$){z$1[e$]=new v$2(e$,4,!1,e$,null,!1,!1)});["cols","rows","size","span"].forEach(function(e$){z$1[e$]=new v$2(e$,6,!1,e$,null,!1,!1)});["rowSpan","start"].forEach(function(e$){z$1[e$]=new v$2(e$,5,!1,e$.toLowerCase(),null,!1,!1)});var ra$2=/[\-:]([a-z])/g;function sa$2(e$){return e$[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e$){var t$=e$.replace(ra$2,sa$2);z$1[t$]=new v$2(t$,1,!1,e$,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e$){var t$=e$.replace(ra$2,sa$2);z$1[t$]=new v$2(t$,1,!1,e$,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e$){var t$=e$.replace(ra$2,sa$2);z$1[t$]=new v$2(t$,1,!1,e$,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e$){z$1[e$]=new v$2(e$,1,!1,e$.toLowerCase(),null,!1,!1)});z$1.xlinkHref=new v$2("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e$){z$1[e$]=new v$2(e$,1,!1,e$.toLowerCase(),null,!0,!0)});function ta$2(e$,t$,r$,n$){var i$=z$1.hasOwnProperty(t$)?z$1[t$]:null;(i$!==null?i$.type!==0:n$||!(2<t$.length)||t$[0]!=="o"&&t$[0]!=="O"||t$[1]!=="n"&&t$[1]!=="N")&&(qa$2(t$,r$,i$,n$)&&(r$=null),n$||i$===null?oa$2(t$)&&(r$===null?e$.removeAttribute(t$):e$.setAttribute(t$,""+r$)):i$.mustUseProperty?e$[i$.propertyName]=r$===null?i$.type===3?!1:"":r$:(t$=i$.attributeName,n$=i$.attributeNamespace,r$===null?e$.removeAttribute(t$):(i$=i$.type,r$=i$===3||i$===4&&r$===!0?"":""+r$,n$?e$.setAttributeNS(n$,t$,r$):e$.setAttribute(t$,r$))))}var ua$2=aa$2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va$1=Symbol.for("react.element"),wa$2=Symbol.for("react.portal"),ya$1=Symbol.for("react.fragment"),za$2=Symbol.for("react.strict_mode"),Aa$2=Symbol.for("react.profiler"),Ba$2=Symbol.for("react.provider"),Ca$2=Symbol.for("react.context"),Da$2=Symbol.for("react.forward_ref"),Ea$2=Symbol.for("react.suspense"),Fa$2=Symbol.for("react.suspense_list"),Ga$2=Symbol.for("react.memo"),Ha$2=Symbol.for("react.lazy"),Ia$1=Symbol.for("react.offscreen"),Ja$2=Symbol.iterator;function Ka$2(e$){return e$===null||typeof e$!="object"?null:(e$=Ja$2&&e$[Ja$2]||e$["@@iterator"],typeof e$=="function"?e$:null)}var A$1=Object.assign,La$2;function Ma$2(e$){if(La$2===void 0)try{throw Error()}catch(r$){var t$=r$.stack.trim().match(/\n( *(at )?)/);La$2=t$&&t$[1]||""}return`
`+La$2+e$}var Na$2=!1;function Oa$2(e$,t$){if(!e$||Na$2)return"";Na$2=!0;var r$=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t$)if(t$=function(){throw Error()},Object.defineProperty(t$.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t$,[])}catch(u$){var n$=u$}Reflect.construct(e$,[],t$)}else{try{t$.call()}catch(u$){n$=u$}e$.call(t$.prototype)}else{try{throw Error()}catch(u$){n$=u$}e$()}}catch(u$){if(u$&&n$&&typeof u$.stack=="string"){for(var i$=u$.stack.split(`
`),o$=n$.stack.split(`
`),s$=i$.length-1,a$=o$.length-1;1<=s$&&0<=a$&&i$[s$]!==o$[a$];)a$--;for(;1<=s$&&0<=a$;s$--,a$--)if(i$[s$]!==o$[a$]){if(s$!==1||a$!==1)do if(s$--,a$--,0>a$||i$[s$]!==o$[a$]){var c$=`
`+i$[s$].replace(" at new "," at ");return e$.displayName&&c$.includes("<anonymous>")&&(c$=c$.replace("<anonymous>",e$.displayName)),c$}while(1<=s$&&0<=a$);break}}}finally{Na$2=!1,Error.prepareStackTrace=r$}return(e$=e$?e$.displayName||e$.name:"")?Ma$2(e$):""}function Pa$2(e$){switch(e$.tag){case 5:return Ma$2(e$.type);case 16:return Ma$2("Lazy");case 13:return Ma$2("Suspense");case 19:return Ma$2("SuspenseList");case 0:case 2:case 15:return e$=Oa$2(e$.type,!1),e$;case 11:return e$=Oa$2(e$.type.render,!1),e$;case 1:return e$=Oa$2(e$.type,!0),e$;default:return""}}function Qa$1(e$){if(e$==null)return null;if(typeof e$=="function")return e$.displayName||e$.name||null;if(typeof e$=="string")return e$;switch(e$){case ya$1:return"Fragment";case wa$2:return"Portal";case Aa$2:return"Profiler";case za$2:return"StrictMode";case Ea$2:return"Suspense";case Fa$2:return"SuspenseList"}if(typeof e$=="object")switch(e$.$$typeof){case Ca$2:return(e$.displayName||"Context")+".Consumer";case Ba$2:return(e$._context.displayName||"Context")+".Provider";case Da$2:var t$=e$.render;return e$=e$.displayName,e$||(e$=t$.displayName||t$.name||"",e$=e$!==""?"ForwardRef("+e$+")":"ForwardRef"),e$;case Ga$2:return t$=e$.displayName||null,t$!==null?t$:Qa$1(e$.type)||"Memo";case Ha$2:t$=e$._payload,e$=e$._init;try{return Qa$1(e$(t$))}catch{}}return null}function Ra$2(e$){var t$=e$.type;switch(e$.tag){case 24:return"Cache";case 9:return(t$.displayName||"Context")+".Consumer";case 10:return(t$._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e$=t$.render,e$=e$.displayName||e$.name||"",t$.displayName||(e$!==""?"ForwardRef("+e$+")":"ForwardRef");case 7:return"Fragment";case 5:return t$;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa$1(t$);case 8:return t$===za$2?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t$=="function")return t$.displayName||t$.name||null;if(typeof t$=="string")return t$}return null}function Sa$2(e$){switch(typeof e$){case"boolean":case"number":case"string":case"undefined":return e$;case"object":return e$;default:return""}}function Ta$2(e$){var t$=e$.type;return(e$=e$.nodeName)&&e$.toLowerCase()==="input"&&(t$==="checkbox"||t$==="radio")}function Ua$2(e$){var t$=Ta$2(e$)?"checked":"value",r$=Object.getOwnPropertyDescriptor(e$.constructor.prototype,t$),n$=""+e$[t$];if(!e$.hasOwnProperty(t$)&&typeof r$<"u"&&typeof r$.get=="function"&&typeof r$.set=="function"){var i$=r$.get,o$=r$.set;return Object.defineProperty(e$,t$,{configurable:!0,get:function(){return i$.call(this)},set:function(s$){n$=""+s$,o$.call(this,s$)}}),Object.defineProperty(e$,t$,{enumerable:r$.enumerable}),{getValue:function(){return n$},setValue:function(s$){n$=""+s$},stopTracking:function(){e$._valueTracker=null,delete e$[t$]}}}}function Va$2(e$){e$._valueTracker||(e$._valueTracker=Ua$2(e$))}function Wa$2(e$){if(!e$)return!1;var t$=e$._valueTracker;if(!t$)return!0;var r$=t$.getValue(),n$="";return e$&&(n$=Ta$2(e$)?e$.checked?"true":"false":e$.value),e$=n$,e$!==r$?(t$.setValue(e$),!0):!1}function Xa$1(e$){if(e$=e$||(typeof document<"u"?document:void 0),typeof e$>"u")return null;try{return e$.activeElement||e$.body}catch{return e$.body}}function Ya$2(e$,t$){var r$=t$.checked;return A$1({},t$,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r$??e$._wrapperState.initialChecked})}function Za$2(e$,t$){var r$=t$.defaultValue==null?"":t$.defaultValue,n$=t$.checked!=null?t$.checked:t$.defaultChecked;r$=Sa$2(t$.value!=null?t$.value:r$),e$._wrapperState={initialChecked:n$,initialValue:r$,controlled:t$.type==="checkbox"||t$.type==="radio"?t$.checked!=null:t$.value!=null}}function ab$2(e$,t$){t$=t$.checked,t$!=null&&ta$2(e$,"checked",t$,!1)}function bb$2(e$,t$){ab$2(e$,t$);var r$=Sa$2(t$.value),n$=t$.type;if(r$!=null)n$==="number"?(r$===0&&e$.value===""||e$.value!=r$)&&(e$.value=""+r$):e$.value!==""+r$&&(e$.value=""+r$);else if(n$==="submit"||n$==="reset"){e$.removeAttribute("value");return}t$.hasOwnProperty("value")?cb$2(e$,t$.type,r$):t$.hasOwnProperty("defaultValue")&&cb$2(e$,t$.type,Sa$2(t$.defaultValue)),t$.checked==null&&t$.defaultChecked!=null&&(e$.defaultChecked=!!t$.defaultChecked)}function db$2(e$,t$,r$){if(t$.hasOwnProperty("value")||t$.hasOwnProperty("defaultValue")){var n$=t$.type;if(!(n$!=="submit"&&n$!=="reset"||t$.value!==void 0&&t$.value!==null))return;t$=""+e$._wrapperState.initialValue,r$||t$===e$.value||(e$.value=t$),e$.defaultValue=t$}r$=e$.name,r$!==""&&(e$.name=""),e$.defaultChecked=!!e$._wrapperState.initialChecked,r$!==""&&(e$.name=r$)}function cb$2(e$,t$,r$){(t$!=="number"||Xa$1(e$.ownerDocument)!==e$)&&(r$==null?e$.defaultValue=""+e$._wrapperState.initialValue:e$.defaultValue!==""+r$&&(e$.defaultValue=""+r$))}var eb$2=Array.isArray;function fb$2(e$,t$,r$,n$){if(e$=e$.options,t$){t$={};for(var i$=0;i$<r$.length;i$++)t$["$"+r$[i$]]=!0;for(r$=0;r$<e$.length;r$++)i$=t$.hasOwnProperty("$"+e$[r$].value),e$[r$].selected!==i$&&(e$[r$].selected=i$),i$&&n$&&(e$[r$].defaultSelected=!0)}else{for(r$=""+Sa$2(r$),t$=null,i$=0;i$<e$.length;i$++){if(e$[i$].value===r$){e$[i$].selected=!0,n$&&(e$[i$].defaultSelected=!0);return}t$!==null||e$[i$].disabled||(t$=e$[i$])}t$!==null&&(t$.selected=!0)}}function gb$2(e$,t$){if(t$.dangerouslySetInnerHTML!=null)throw Error(p$1(91));return A$1({},t$,{value:void 0,defaultValue:void 0,children:""+e$._wrapperState.initialValue})}function hb$2(e$,t$){var r$=t$.value;if(r$==null){if(r$=t$.children,t$=t$.defaultValue,r$!=null){if(t$!=null)throw Error(p$1(92));if(eb$2(r$)){if(1<r$.length)throw Error(p$1(93));r$=r$[0]}t$=r$}t$==null&&(t$=""),r$=t$}e$._wrapperState={initialValue:Sa$2(r$)}}function ib$2(e$,t$){var r$=Sa$2(t$.value),n$=Sa$2(t$.defaultValue);r$!=null&&(r$=""+r$,r$!==e$.value&&(e$.value=r$),t$.defaultValue==null&&e$.defaultValue!==r$&&(e$.defaultValue=r$)),n$!=null&&(e$.defaultValue=""+n$)}function jb$2(e$){var t$=e$.textContent;t$===e$._wrapperState.initialValue&&t$!==""&&t$!==null&&(e$.value=t$)}function kb$2(e$){switch(e$){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb$2(e$,t$){return e$==null||e$==="http://www.w3.org/1999/xhtml"?kb$2(t$):e$==="http://www.w3.org/2000/svg"&&t$==="foreignObject"?"http://www.w3.org/1999/xhtml":e$}var mb$2,nb$2=function(e$){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t$,r$,n$,i$){MSApp.execUnsafeLocalFunction(function(){return e$(t$,r$,n$,i$)})}:e$}(function(e$,t$){if(e$.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e$)e$.innerHTML=t$;else{for(mb$2=mb$2||document.createElement("div"),mb$2.innerHTML="<svg>"+t$.valueOf().toString()+"</svg>",t$=mb$2.firstChild;e$.firstChild;)e$.removeChild(e$.firstChild);for(;t$.firstChild;)e$.appendChild(t$.firstChild)}});function ob$2(e$,t$){if(t$){var r$=e$.firstChild;if(r$&&r$===e$.lastChild&&r$.nodeType===3){r$.nodeValue=t$;return}}e$.textContent=t$}var pb$2={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb$2=["Webkit","ms","Moz","O"];Object.keys(pb$2).forEach(function(e$){qb$2.forEach(function(t$){t$=t$+e$.charAt(0).toUpperCase()+e$.substring(1),pb$2[t$]=pb$2[e$]})});function rb$2(e$,t$,r$){return t$==null||typeof t$=="boolean"||t$===""?"":r$||typeof t$!="number"||t$===0||pb$2.hasOwnProperty(e$)&&pb$2[e$]?(""+t$).trim():t$+"px"}function sb$2(e$,t$){e$=e$.style;for(var r$ in t$)if(t$.hasOwnProperty(r$)){var n$=r$.indexOf("--")===0,i$=rb$2(r$,t$[r$],n$);r$==="float"&&(r$="cssFloat"),n$?e$.setProperty(r$,i$):e$[r$]=i$}}var tb$2=A$1({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub$2(e$,t$){if(t$){if(tb$2[e$]&&(t$.children!=null||t$.dangerouslySetInnerHTML!=null))throw Error(p$1(137,e$));if(t$.dangerouslySetInnerHTML!=null){if(t$.children!=null)throw Error(p$1(60));if(typeof t$.dangerouslySetInnerHTML!="object"||!("__html"in t$.dangerouslySetInnerHTML))throw Error(p$1(61))}if(t$.style!=null&&typeof t$.style!="object")throw Error(p$1(62))}}function vb$2(e$,t$){if(e$.indexOf("-")===-1)return typeof t$.is=="string";switch(e$){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb$2=null;function xb$2(e$){return e$=e$.target||e$.srcElement||window,e$.correspondingUseElement&&(e$=e$.correspondingUseElement),e$.nodeType===3?e$.parentNode:e$}var yb$2=null,zb$2=null,Ab$2=null;function Bb$2(e$){if(e$=Cb$2(e$)){if(typeof yb$2!="function")throw Error(p$1(280));var t$=e$.stateNode;t$&&(t$=Db$2(t$),yb$2(e$.stateNode,e$.type,t$))}}function Eb$2(e$){zb$2?Ab$2?Ab$2.push(e$):Ab$2=[e$]:zb$2=e$}function Fb$2(){if(zb$2){var e$=zb$2,t$=Ab$2;if(Ab$2=zb$2=null,Bb$2(e$),t$)for(e$=0;e$<t$.length;e$++)Bb$2(t$[e$])}}function Gb$2(e$,t$){return e$(t$)}function Hb$2(){}var Ib$2=!1;function Jb$2(e$,t$,r$){if(Ib$2)return e$(t$,r$);Ib$2=!0;try{return Gb$2(e$,t$,r$)}finally{Ib$2=!1,(zb$2!==null||Ab$2!==null)&&(Hb$2(),Fb$2())}}function Kb$2(e$,t$){var r$=e$.stateNode;if(r$===null)return null;var n$=Db$2(r$);if(n$===null)return null;r$=n$[t$];e:switch(t$){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n$=!n$.disabled)||(e$=e$.type,n$=!(e$==="button"||e$==="input"||e$==="select"||e$==="textarea")),e$=!n$;break e;default:e$=!1}if(e$)return null;if(r$&&typeof r$!="function")throw Error(p$1(231,t$,typeof r$));return r$}var Lb$2=!1;if(ia$2)try{var Mb$2={};Object.defineProperty(Mb$2,"passive",{get:function(){Lb$2=!0}}),window.addEventListener("test",Mb$2,Mb$2),window.removeEventListener("test",Mb$2,Mb$2)}catch{Lb$2=!1}function Nb$2(e$,t$,r$,n$,i$,o$,s$,a$,c$){var u$=Array.prototype.slice.call(arguments,3);try{t$.apply(r$,u$)}catch(l$){this.onError(l$)}}var Ob$2=!1,Pb$2=null,Qb$2=!1,Rb$2=null,Sb$2={onError:function(e$){Ob$2=!0,Pb$2=e$}};function Tb$2(e$,t$,r$,n$,i$,o$,s$,a$,c$){Ob$2=!1,Pb$2=null,Nb$2.apply(Sb$2,arguments)}function Ub$2(e$,t$,r$,n$,i$,o$,s$,a$,c$){if(Tb$2.apply(this,arguments),Ob$2){if(Ob$2){var u$=Pb$2;Ob$2=!1,Pb$2=null}else throw Error(p$1(198));Qb$2||(Qb$2=!0,Rb$2=u$)}}function Vb$2(e$){var t$=e$,r$=e$;if(e$.alternate)for(;t$.return;)t$=t$.return;else{e$=t$;do t$=e$,t$.flags&4098&&(r$=t$.return),e$=t$.return;while(e$)}return t$.tag===3?r$:null}function Wb$2(e$){if(e$.tag===13){var t$=e$.memoizedState;if(t$===null&&(e$=e$.alternate,e$!==null&&(t$=e$.memoizedState)),t$!==null)return t$.dehydrated}return null}function Xb$2(e$){if(Vb$2(e$)!==e$)throw Error(p$1(188))}function Yb$2(e$){var t$=e$.alternate;if(!t$){if(t$=Vb$2(e$),t$===null)throw Error(p$1(188));return t$!==e$?null:e$}for(var r$=e$,n$=t$;;){var i$=r$.return;if(i$===null)break;var o$=i$.alternate;if(o$===null){if(n$=i$.return,n$!==null){r$=n$;continue}break}if(i$.child===o$.child){for(o$=i$.child;o$;){if(o$===r$)return Xb$2(i$),e$;if(o$===n$)return Xb$2(i$),t$;o$=o$.sibling}throw Error(p$1(188))}if(r$.return!==n$.return)r$=i$,n$=o$;else{for(var s$=!1,a$=i$.child;a$;){if(a$===r$){s$=!0,r$=i$,n$=o$;break}if(a$===n$){s$=!0,n$=i$,r$=o$;break}a$=a$.sibling}if(!s$){for(a$=o$.child;a$;){if(a$===r$){s$=!0,r$=o$,n$=i$;break}if(a$===n$){s$=!0,n$=o$,r$=i$;break}a$=a$.sibling}if(!s$)throw Error(p$1(189))}}if(r$.alternate!==n$)throw Error(p$1(190))}if(r$.tag!==3)throw Error(p$1(188));return r$.stateNode.current===r$?e$:t$}function Zb$2(e$){return e$=Yb$2(e$),e$!==null?$b$2(e$):null}function $b$2(e$){if(e$.tag===5||e$.tag===6)return e$;for(e$=e$.child;e$!==null;){var t$=$b$2(e$);if(t$!==null)return t$;e$=e$.sibling}return null}var ac$2=ca$2.unstable_scheduleCallback,bc$2=ca$2.unstable_cancelCallback,cc$2=ca$2.unstable_shouldYield,dc$2=ca$2.unstable_requestPaint,B$1=ca$2.unstable_now,ec$2=ca$2.unstable_getCurrentPriorityLevel,fc$2=ca$2.unstable_ImmediatePriority,gc$2=ca$2.unstable_UserBlockingPriority,hc$2=ca$2.unstable_NormalPriority,ic$2=ca$2.unstable_LowPriority,jc$2=ca$2.unstable_IdlePriority,kc$2=null,lc$2=null;function mc$2(e$){if(lc$2&&typeof lc$2.onCommitFiberRoot=="function")try{lc$2.onCommitFiberRoot(kc$2,e$,void 0,(e$.current.flags&128)===128)}catch{}}var oc$2=Math.clz32?Math.clz32:nc$2,pc$2=Math.log,qc$2=Math.LN2;function nc$2(e$){return e$>>>=0,e$===0?32:31-(pc$2(e$)/qc$2|0)|0}var rc$2=64,sc$2=4194304;function tc$2(e$){switch(e$&-e$){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e$&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e$&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e$}}function uc$2(e$,t$){var r$=e$.pendingLanes;if(r$===0)return 0;var n$=0,i$=e$.suspendedLanes,o$=e$.pingedLanes,s$=r$&268435455;if(s$!==0){var a$=s$&~i$;a$!==0?n$=tc$2(a$):(o$&=s$,o$!==0&&(n$=tc$2(o$)))}else s$=r$&~i$,s$!==0?n$=tc$2(s$):o$!==0&&(n$=tc$2(o$));if(n$===0)return 0;if(t$!==0&&t$!==n$&&!(t$&i$)&&(i$=n$&-n$,o$=t$&-t$,i$>=o$||i$===16&&(o$&4194240)!==0))return t$;if(n$&4&&(n$|=r$&16),t$=e$.entangledLanes,t$!==0)for(e$=e$.entanglements,t$&=n$;0<t$;)r$=31-oc$2(t$),i$=1<<r$,n$|=e$[r$],t$&=~i$;return n$}function vc$2(e$,t$){switch(e$){case 1:case 2:case 4:return t$+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t$+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc$2(e$,t$){for(var r$=e$.suspendedLanes,n$=e$.pingedLanes,i$=e$.expirationTimes,o$=e$.pendingLanes;0<o$;){var s$=31-oc$2(o$),a$=1<<s$,c$=i$[s$];c$===-1?(!(a$&r$)||a$&n$)&&(i$[s$]=vc$2(a$,t$)):c$<=t$&&(e$.expiredLanes|=a$),o$&=~a$}}function xc$2(e$){return e$=e$.pendingLanes&-1073741825,e$!==0?e$:e$&1073741824?1073741824:0}function yc$2(){var e$=rc$2;return rc$2<<=1,!(rc$2&4194240)&&(rc$2=64),e$}function zc$2(e$){for(var t$=[],r$=0;31>r$;r$++)t$.push(e$);return t$}function Ac$2(e$,t$,r$){e$.pendingLanes|=t$,t$!==536870912&&(e$.suspendedLanes=0,e$.pingedLanes=0),e$=e$.eventTimes,t$=31-oc$2(t$),e$[t$]=r$}function Bc$2(e$,t$){var r$=e$.pendingLanes&~t$;e$.pendingLanes=t$,e$.suspendedLanes=0,e$.pingedLanes=0,e$.expiredLanes&=t$,e$.mutableReadLanes&=t$,e$.entangledLanes&=t$,t$=e$.entanglements;var n$=e$.eventTimes;for(e$=e$.expirationTimes;0<r$;){var i$=31-oc$2(r$),o$=1<<i$;t$[i$]=0,n$[i$]=-1,e$[i$]=-1,r$&=~o$}}function Cc$2(e$,t$){var r$=e$.entangledLanes|=t$;for(e$=e$.entanglements;r$;){var n$=31-oc$2(r$),i$=1<<n$;i$&t$|e$[n$]&t$&&(e$[n$]|=t$),r$&=~i$}}var C$1=0;function Dc$2(e$){return e$&=-e$,1<e$?4<e$?e$&268435455?16:536870912:4:1}var Ec$2,Fc$2,Gc$2,Hc$2,Ic$2,Jc$2=!1,Kc$2=[],Lc$2=null,Mc$2=null,Nc$2=null,Oc$2=new Map,Pc$2=new Map,Qc$2=[],Rc$2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc$2(e$,t$){switch(e$){case"focusin":case"focusout":Lc$2=null;break;case"dragenter":case"dragleave":Mc$2=null;break;case"mouseover":case"mouseout":Nc$2=null;break;case"pointerover":case"pointerout":Oc$2.delete(t$.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc$2.delete(t$.pointerId)}}function Tc$2(e$,t$,r$,n$,i$,o$){return e$===null||e$.nativeEvent!==o$?(e$={blockedOn:t$,domEventName:r$,eventSystemFlags:n$,nativeEvent:o$,targetContainers:[i$]},t$!==null&&(t$=Cb$2(t$),t$!==null&&Fc$2(t$)),e$):(e$.eventSystemFlags|=n$,t$=e$.targetContainers,i$!==null&&t$.indexOf(i$)===-1&&t$.push(i$),e$)}function Uc$2(e$,t$,r$,n$,i$){switch(t$){case"focusin":return Lc$2=Tc$2(Lc$2,e$,t$,r$,n$,i$),!0;case"dragenter":return Mc$2=Tc$2(Mc$2,e$,t$,r$,n$,i$),!0;case"mouseover":return Nc$2=Tc$2(Nc$2,e$,t$,r$,n$,i$),!0;case"pointerover":var o$=i$.pointerId;return Oc$2.set(o$,Tc$2(Oc$2.get(o$)||null,e$,t$,r$,n$,i$)),!0;case"gotpointercapture":return o$=i$.pointerId,Pc$2.set(o$,Tc$2(Pc$2.get(o$)||null,e$,t$,r$,n$,i$)),!0}return!1}function Vc$2(e$){var t$=Wc$2(e$.target);if(t$!==null){var r$=Vb$2(t$);if(r$!==null){if(t$=r$.tag,t$===13){if(t$=Wb$2(r$),t$!==null){e$.blockedOn=t$,Ic$2(e$.priority,function(){Gc$2(r$)});return}}else if(t$===3&&r$.stateNode.current.memoizedState.isDehydrated){e$.blockedOn=r$.tag===3?r$.stateNode.containerInfo:null;return}}}e$.blockedOn=null}function Xc$2(e$){if(e$.blockedOn!==null)return!1;for(var t$=e$.targetContainers;0<t$.length;){var r$=Yc$2(e$.domEventName,e$.eventSystemFlags,t$[0],e$.nativeEvent);if(r$===null){r$=e$.nativeEvent;var n$=new r$.constructor(r$.type,r$);wb$2=n$,r$.target.dispatchEvent(n$),wb$2=null}else return t$=Cb$2(r$),t$!==null&&Fc$2(t$),e$.blockedOn=r$,!1;t$.shift()}return!0}function Zc$2(e$,t$,r$){Xc$2(e$)&&r$.delete(t$)}function $c$2(){Jc$2=!1,Lc$2!==null&&Xc$2(Lc$2)&&(Lc$2=null),Mc$2!==null&&Xc$2(Mc$2)&&(Mc$2=null),Nc$2!==null&&Xc$2(Nc$2)&&(Nc$2=null),Oc$2.forEach(Zc$2),Pc$2.forEach(Zc$2)}function ad$1(e$,t$){e$.blockedOn===t$&&(e$.blockedOn=null,Jc$2||(Jc$2=!0,ca$2.unstable_scheduleCallback(ca$2.unstable_NormalPriority,$c$2)))}function bd$2(e$){function t$(i$){return ad$1(i$,e$)}if(0<Kc$2.length){ad$1(Kc$2[0],e$);for(var r$=1;r$<Kc$2.length;r$++){var n$=Kc$2[r$];n$.blockedOn===e$&&(n$.blockedOn=null)}}for(Lc$2!==null&&ad$1(Lc$2,e$),Mc$2!==null&&ad$1(Mc$2,e$),Nc$2!==null&&ad$1(Nc$2,e$),Oc$2.forEach(t$),Pc$2.forEach(t$),r$=0;r$<Qc$2.length;r$++)n$=Qc$2[r$],n$.blockedOn===e$&&(n$.blockedOn=null);for(;0<Qc$2.length&&(r$=Qc$2[0],r$.blockedOn===null);)Vc$2(r$),r$.blockedOn===null&&Qc$2.shift()}var cd$2=ua$2.ReactCurrentBatchConfig,dd$2=!0;function ed$2(e$,t$,r$,n$){var i$=C$1,o$=cd$2.transition;cd$2.transition=null;try{C$1=1,fd$2(e$,t$,r$,n$)}finally{C$1=i$,cd$2.transition=o$}}function gd$2(e$,t$,r$,n$){var i$=C$1,o$=cd$2.transition;cd$2.transition=null;try{C$1=4,fd$2(e$,t$,r$,n$)}finally{C$1=i$,cd$2.transition=o$}}function fd$2(e$,t$,r$,n$){if(dd$2){var i$=Yc$2(e$,t$,r$,n$);if(i$===null)hd$2(e$,t$,n$,id$2,r$),Sc$2(e$,n$);else if(Uc$2(i$,e$,t$,r$,n$))n$.stopPropagation();else if(Sc$2(e$,n$),t$&4&&-1<Rc$2.indexOf(e$)){for(;i$!==null;){var o$=Cb$2(i$);if(o$!==null&&Ec$2(o$),o$=Yc$2(e$,t$,r$,n$),o$===null&&hd$2(e$,t$,n$,id$2,r$),o$===i$)break;i$=o$}i$!==null&&n$.stopPropagation()}else hd$2(e$,t$,n$,null,r$)}}var id$2=null;function Yc$2(e$,t$,r$,n$){if(id$2=null,e$=xb$2(n$),e$=Wc$2(e$),e$!==null)if(t$=Vb$2(e$),t$===null)e$=null;else if(r$=t$.tag,r$===13){if(e$=Wb$2(t$),e$!==null)return e$;e$=null}else if(r$===3){if(t$.stateNode.current.memoizedState.isDehydrated)return t$.tag===3?t$.stateNode.containerInfo:null;e$=null}else t$!==e$&&(e$=null);return id$2=e$,null}function jd$2(e$){switch(e$){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec$2()){case fc$2:return 1;case gc$2:return 4;case hc$2:case ic$2:return 16;case jc$2:return 536870912;default:return 16}default:return 16}}var kd$2=null,ld$2=null,md$2=null;function nd$2(){if(md$2)return md$2;var e$,t$=ld$2,r$=t$.length,n$,i$="value"in kd$2?kd$2.value:kd$2.textContent,o$=i$.length;for(e$=0;e$<r$&&t$[e$]===i$[e$];e$++);var s$=r$-e$;for(n$=1;n$<=s$&&t$[r$-n$]===i$[o$-n$];n$++);return md$2=i$.slice(e$,1<n$?1-n$:void 0)}function od$2(e$){var t$=e$.keyCode;return"charCode"in e$?(e$=e$.charCode,e$===0&&t$===13&&(e$=13)):e$=t$,e$===10&&(e$=13),32<=e$||e$===13?e$:0}function pd$2(){return!0}function qd$2(){return!1}function rd$2(e$){function t$(r$,n$,i$,o$,s$){this._reactName=r$,this._targetInst=i$,this.type=n$,this.nativeEvent=o$,this.target=s$,this.currentTarget=null;for(var a$ in e$)e$.hasOwnProperty(a$)&&(r$=e$[a$],this[a$]=r$?r$(o$):o$[a$]);return this.isDefaultPrevented=(o$.defaultPrevented!=null?o$.defaultPrevented:o$.returnValue===!1)?pd$2:qd$2,this.isPropagationStopped=qd$2,this}return A$1(t$.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r$=this.nativeEvent;r$&&(r$.preventDefault?r$.preventDefault():typeof r$.returnValue!="unknown"&&(r$.returnValue=!1),this.isDefaultPrevented=pd$2)},stopPropagation:function(){var r$=this.nativeEvent;r$&&(r$.stopPropagation?r$.stopPropagation():typeof r$.cancelBubble!="unknown"&&(r$.cancelBubble=!0),this.isPropagationStopped=pd$2)},persist:function(){},isPersistent:pd$2}),t$}var sd$1={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e$){return e$.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td$2=rd$2(sd$1),ud$2=A$1({},sd$1,{view:0,detail:0}),vd$2=rd$2(ud$2),wd$2,xd$2,yd$2,Ad$2=A$1({},ud$2,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd$2,button:0,buttons:0,relatedTarget:function(e$){return e$.relatedTarget===void 0?e$.fromElement===e$.srcElement?e$.toElement:e$.fromElement:e$.relatedTarget},movementX:function(e$){return"movementX"in e$?e$.movementX:(e$!==yd$2&&(yd$2&&e$.type==="mousemove"?(wd$2=e$.screenX-yd$2.screenX,xd$2=e$.screenY-yd$2.screenY):xd$2=wd$2=0,yd$2=e$),wd$2)},movementY:function(e$){return"movementY"in e$?e$.movementY:xd$2}}),Bd$2=rd$2(Ad$2),Cd$2=A$1({},Ad$2,{dataTransfer:0}),Dd$2=rd$2(Cd$2),Ed$2=A$1({},ud$2,{relatedTarget:0}),Fd$2=rd$2(Ed$2),Gd$2=A$1({},sd$1,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd$2=rd$2(Gd$2),Id$2=A$1({},sd$1,{clipboardData:function(e$){return"clipboardData"in e$?e$.clipboardData:window.clipboardData}}),Jd$2=rd$2(Id$2),Kd$2=A$1({},sd$1,{data:0}),Ld$2=rd$2(Kd$2),Md$2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd$2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od$2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd$2(e$){var t$=this.nativeEvent;return t$.getModifierState?t$.getModifierState(e$):(e$=Od$2[e$])?!!t$[e$]:!1}function zd$2(){return Pd$2}var Qd$2=A$1({},ud$2,{key:function(e$){if(e$.key){var t$=Md$2[e$.key]||e$.key;if(t$!=="Unidentified")return t$}return e$.type==="keypress"?(e$=od$2(e$),e$===13?"Enter":String.fromCharCode(e$)):e$.type==="keydown"||e$.type==="keyup"?Nd$2[e$.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd$2,charCode:function(e$){return e$.type==="keypress"?od$2(e$):0},keyCode:function(e$){return e$.type==="keydown"||e$.type==="keyup"?e$.keyCode:0},which:function(e$){return e$.type==="keypress"?od$2(e$):e$.type==="keydown"||e$.type==="keyup"?e$.keyCode:0}}),Rd$2=rd$2(Qd$2),Sd$2=A$1({},Ad$2,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td$2=rd$2(Sd$2),Ud$2=A$1({},ud$2,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd$2}),Vd$2=rd$2(Ud$2),Wd$2=A$1({},sd$1,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd$2=rd$2(Wd$2),Yd$2=A$1({},Ad$2,{deltaX:function(e$){return"deltaX"in e$?e$.deltaX:"wheelDeltaX"in e$?-e$.wheelDeltaX:0},deltaY:function(e$){return"deltaY"in e$?e$.deltaY:"wheelDeltaY"in e$?-e$.wheelDeltaY:"wheelDelta"in e$?-e$.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd$2=rd$2(Yd$2),$d$2=[9,13,27,32],ae$2=ia$2&&"CompositionEvent"in window,be$2=null;ia$2&&"documentMode"in document&&(be$2=document.documentMode);var ce$1=ia$2&&"TextEvent"in window&&!be$2,de$2=ia$2&&(!ae$2||be$2&&8<be$2&&11>=be$2),ee$1=" ",fe$2=!1;function ge$2(e$,t$){switch(e$){case"keyup":return $d$2.indexOf(t$.keyCode)!==-1;case"keydown":return t$.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he$2(e$){return e$=e$.detail,typeof e$=="object"&&"data"in e$?e$.data:null}var ie$2=!1;function je$2(e$,t$){switch(e$){case"compositionend":return he$2(t$);case"keypress":return t$.which!==32?null:(fe$2=!0,ee$1);case"textInput":return e$=t$.data,e$===ee$1&&fe$2?null:e$;default:return null}}function ke$2(e$,t$){if(ie$2)return e$==="compositionend"||!ae$2&&ge$2(e$,t$)?(e$=nd$2(),md$2=ld$2=kd$2=null,ie$2=!1,e$):null;switch(e$){case"paste":return null;case"keypress":if(!(t$.ctrlKey||t$.altKey||t$.metaKey)||t$.ctrlKey&&t$.altKey){if(t$.char&&1<t$.char.length)return t$.char;if(t$.which)return String.fromCharCode(t$.which)}return null;case"compositionend":return de$2&&t$.locale!=="ko"?null:t$.data;default:return null}}var le$2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me$2(e$){var t$=e$&&e$.nodeName&&e$.nodeName.toLowerCase();return t$==="input"?!!le$2[e$.type]:t$==="textarea"}function ne$1(e$,t$,r$,n$){Eb$2(n$),t$=oe$2(t$,"onChange"),0<t$.length&&(r$=new td$2("onChange","change",null,r$,n$),e$.push({event:r$,listeners:t$}))}var pe$2=null,qe$2=null;function re$2(e$){se$2(e$,0)}function te$2(e$){var t$=ue$2(e$);if(Wa$2(t$))return e$}function ve$2(e$,t$){if(e$==="change")return t$}var we$2=!1;if(ia$2){var xe$2;if(ia$2){var ye$2="oninput"in document;if(!ye$2){var ze$2=document.createElement("div");ze$2.setAttribute("oninput","return;"),ye$2=typeof ze$2.oninput=="function"}xe$2=ye$2}else xe$2=!1;we$2=xe$2&&(!document.documentMode||9<document.documentMode)}function Ae$1(){pe$2&&(pe$2.detachEvent("onpropertychange",Be$2),qe$2=pe$2=null)}function Be$2(e$){if(e$.propertyName==="value"&&te$2(qe$2)){var t$=[];ne$1(t$,qe$2,e$,xb$2(e$)),Jb$2(re$2,t$)}}function Ce$2(e$,t$,r$){e$==="focusin"?(Ae$1(),pe$2=t$,qe$2=r$,pe$2.attachEvent("onpropertychange",Be$2)):e$==="focusout"&&Ae$1()}function De$2(e$){if(e$==="selectionchange"||e$==="keyup"||e$==="keydown")return te$2(qe$2)}function Ee$2(e$,t$){if(e$==="click")return te$2(t$)}function Fe$2(e$,t$){if(e$==="input"||e$==="change")return te$2(t$)}function Ge$2(e$,t$){return e$===t$&&(e$!==0||1/e$===1/t$)||e$!==e$&&t$!==t$}var He$2=typeof Object.is=="function"?Object.is:Ge$2;function Ie$2(e$,t$){if(He$2(e$,t$))return!0;if(typeof e$!="object"||e$===null||typeof t$!="object"||t$===null)return!1;var r$=Object.keys(e$),n$=Object.keys(t$);if(r$.length!==n$.length)return!1;for(n$=0;n$<r$.length;n$++){var i$=r$[n$];if(!ja$2.call(t$,i$)||!He$2(e$[i$],t$[i$]))return!1}return!0}function Je$2(e$){for(;e$&&e$.firstChild;)e$=e$.firstChild;return e$}function Ke$2(e$,t$){var r$=Je$2(e$);e$=0;for(var n$;r$;){if(r$.nodeType===3){if(n$=e$+r$.textContent.length,e$<=t$&&n$>=t$)return{node:r$,offset:t$-e$};e$=n$}e:{for(;r$;){if(r$.nextSibling){r$=r$.nextSibling;break e}r$=r$.parentNode}r$=void 0}r$=Je$2(r$)}}function Le$2(e$,t$){return e$&&t$?e$===t$?!0:e$&&e$.nodeType===3?!1:t$&&t$.nodeType===3?Le$2(e$,t$.parentNode):"contains"in e$?e$.contains(t$):e$.compareDocumentPosition?!!(e$.compareDocumentPosition(t$)&16):!1:!1}function Me$2(){for(var e$=window,t$=Xa$1();t$ instanceof e$.HTMLIFrameElement;){try{var r$=typeof t$.contentWindow.location.href=="string"}catch{r$=!1}if(r$)e$=t$.contentWindow;else break;t$=Xa$1(e$.document)}return t$}function Ne$2(e$){var t$=e$&&e$.nodeName&&e$.nodeName.toLowerCase();return t$&&(t$==="input"&&(e$.type==="text"||e$.type==="search"||e$.type==="tel"||e$.type==="url"||e$.type==="password")||t$==="textarea"||e$.contentEditable==="true")}function Oe$1(e$){var t$=Me$2(),r$=e$.focusedElem,n$=e$.selectionRange;if(t$!==r$&&r$&&r$.ownerDocument&&Le$2(r$.ownerDocument.documentElement,r$)){if(n$!==null&&Ne$2(r$)){if(t$=n$.start,e$=n$.end,e$===void 0&&(e$=t$),"selectionStart"in r$)r$.selectionStart=t$,r$.selectionEnd=Math.min(e$,r$.value.length);else if(e$=(t$=r$.ownerDocument||document)&&t$.defaultView||window,e$.getSelection){e$=e$.getSelection();var i$=r$.textContent.length,o$=Math.min(n$.start,i$);n$=n$.end===void 0?o$:Math.min(n$.end,i$),!e$.extend&&o$>n$&&(i$=n$,n$=o$,o$=i$),i$=Ke$2(r$,o$);var s$=Ke$2(r$,n$);i$&&s$&&(e$.rangeCount!==1||e$.anchorNode!==i$.node||e$.anchorOffset!==i$.offset||e$.focusNode!==s$.node||e$.focusOffset!==s$.offset)&&(t$=t$.createRange(),t$.setStart(i$.node,i$.offset),e$.removeAllRanges(),o$>n$?(e$.addRange(t$),e$.extend(s$.node,s$.offset)):(t$.setEnd(s$.node,s$.offset),e$.addRange(t$)))}}for(t$=[],e$=r$;e$=e$.parentNode;)e$.nodeType===1&&t$.push({element:e$,left:e$.scrollLeft,top:e$.scrollTop});for(typeof r$.focus=="function"&&r$.focus(),r$=0;r$<t$.length;r$++)e$=t$[r$],e$.element.scrollLeft=e$.left,e$.element.scrollTop=e$.top}}var Pe$2=ia$2&&"documentMode"in document&&11>=document.documentMode,Qe$2=null,Re$1=null,Se$2=null,Te$2=!1;function Ue$2(e$,t$,r$){var n$=r$.window===r$?r$.document:r$.nodeType===9?r$:r$.ownerDocument;Te$2||Qe$2==null||Qe$2!==Xa$1(n$)||(n$=Qe$2,"selectionStart"in n$&&Ne$2(n$)?n$={start:n$.selectionStart,end:n$.selectionEnd}:(n$=(n$.ownerDocument&&n$.ownerDocument.defaultView||window).getSelection(),n$={anchorNode:n$.anchorNode,anchorOffset:n$.anchorOffset,focusNode:n$.focusNode,focusOffset:n$.focusOffset}),Se$2&&Ie$2(Se$2,n$)||(Se$2=n$,n$=oe$2(Re$1,"onSelect"),0<n$.length&&(t$=new td$2("onSelect","select",null,t$,r$),e$.push({event:t$,listeners:n$}),t$.target=Qe$2)))}function Ve$2(e$,t$){var r$={};return r$[e$.toLowerCase()]=t$.toLowerCase(),r$["Webkit"+e$]="webkit"+t$,r$["Moz"+e$]="moz"+t$,r$}var We$2={animationend:Ve$2("Animation","AnimationEnd"),animationiteration:Ve$2("Animation","AnimationIteration"),animationstart:Ve$2("Animation","AnimationStart"),transitionend:Ve$2("Transition","TransitionEnd")},Xe$2={},Ye$2={};ia$2&&(Ye$2=document.createElement("div").style,"AnimationEvent"in window||(delete We$2.animationend.animation,delete We$2.animationiteration.animation,delete We$2.animationstart.animation),"TransitionEvent"in window||delete We$2.transitionend.transition);function Ze$1(e$){if(Xe$2[e$])return Xe$2[e$];if(!We$2[e$])return e$;var t$=We$2[e$],r$;for(r$ in t$)if(t$.hasOwnProperty(r$)&&r$ in Ye$2)return Xe$2[e$]=t$[r$];return e$}var $e$2=Ze$1("animationend"),af$2=Ze$1("animationiteration"),bf$2=Ze$1("animationstart"),cf$2=Ze$1("transitionend"),df$2=new Map,ef$2="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff$2(e$,t$){df$2.set(e$,t$),fa$2(t$,[e$])}for(var gf$2=0;gf$2<ef$2.length;gf$2++){var hf$2=ef$2[gf$2],jf$1=hf$2.toLowerCase(),kf$2=hf$2[0].toUpperCase()+hf$2.slice(1);ff$2(jf$1,"on"+kf$2)}ff$2($e$2,"onAnimationEnd");ff$2(af$2,"onAnimationIteration");ff$2(bf$2,"onAnimationStart");ff$2("dblclick","onDoubleClick");ff$2("focusin","onFocus");ff$2("focusout","onBlur");ff$2(cf$2,"onTransitionEnd");ha$2("onMouseEnter",["mouseout","mouseover"]);ha$2("onMouseLeave",["mouseout","mouseover"]);ha$2("onPointerEnter",["pointerout","pointerover"]);ha$2("onPointerLeave",["pointerout","pointerover"]);fa$2("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa$2("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa$2("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa$2("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa$2("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa$2("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf$2="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf$2=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf$2));function nf$2(e$,t$,r$){var n$=e$.type||"unknown-event";e$.currentTarget=r$,Ub$2(n$,t$,void 0,e$),e$.currentTarget=null}function se$2(e$,t$){t$=(t$&4)!==0;for(var r$=0;r$<e$.length;r$++){var n$=e$[r$],i$=n$.event;n$=n$.listeners;e:{var o$=void 0;if(t$)for(var s$=n$.length-1;0<=s$;s$--){var a$=n$[s$],c$=a$.instance,u$=a$.currentTarget;if(a$=a$.listener,c$!==o$&&i$.isPropagationStopped())break e;nf$2(i$,a$,u$),o$=c$}else for(s$=0;s$<n$.length;s$++){if(a$=n$[s$],c$=a$.instance,u$=a$.currentTarget,a$=a$.listener,c$!==o$&&i$.isPropagationStopped())break e;nf$2(i$,a$,u$),o$=c$}}}if(Qb$2)throw e$=Rb$2,Qb$2=!1,Rb$2=null,e$}function D$1(e$,t$){var r$=t$[of$2];r$===void 0&&(r$=t$[of$2]=new Set);var n$=e$+"__bubble";r$.has(n$)||(pf$2(t$,e$,2,!1),r$.add(n$))}function qf$1(e$,t$,r$){var n$=0;t$&&(n$|=4),pf$2(r$,e$,n$,t$)}var rf$2="_reactListening"+Math.random().toString(36).slice(2);function sf$2(e$){if(!e$[rf$2]){e$[rf$2]=!0,da$2.forEach(function(r$){r$!=="selectionchange"&&(mf$2.has(r$)||qf$1(r$,!1,e$),qf$1(r$,!0,e$))});var t$=e$.nodeType===9?e$:e$.ownerDocument;t$===null||t$[rf$2]||(t$[rf$2]=!0,qf$1("selectionchange",!1,t$))}}function pf$2(e$,t$,r$,n$){switch(jd$2(t$)){case 1:var i$=ed$2;break;case 4:i$=gd$2;break;default:i$=fd$2}r$=i$.bind(null,t$,r$,e$),i$=void 0,!Lb$2||t$!=="touchstart"&&t$!=="touchmove"&&t$!=="wheel"||(i$=!0),n$?i$!==void 0?e$.addEventListener(t$,r$,{capture:!0,passive:i$}):e$.addEventListener(t$,r$,!0):i$!==void 0?e$.addEventListener(t$,r$,{passive:i$}):e$.addEventListener(t$,r$,!1)}function hd$2(e$,t$,r$,n$,i$){var o$=n$;if(!(t$&1)&&!(t$&2)&&n$!==null)e:for(;;){if(n$===null)return;var s$=n$.tag;if(s$===3||s$===4){var a$=n$.stateNode.containerInfo;if(a$===i$||a$.nodeType===8&&a$.parentNode===i$)break;if(s$===4)for(s$=n$.return;s$!==null;){var c$=s$.tag;if((c$===3||c$===4)&&(c$=s$.stateNode.containerInfo,c$===i$||c$.nodeType===8&&c$.parentNode===i$))return;s$=s$.return}for(;a$!==null;){if(s$=Wc$2(a$),s$===null)return;if(c$=s$.tag,c$===5||c$===6){n$=o$=s$;continue e}a$=a$.parentNode}}n$=n$.return}Jb$2(function(){var u$=o$,l$=xb$2(r$),d$=[];e:{var h$=df$2.get(e$);if(h$!==void 0){var p$=td$2,_$=e$;switch(e$){case"keypress":if(od$2(r$)===0)break e;case"keydown":case"keyup":p$=Rd$2;break;case"focusin":_$="focus",p$=Fd$2;break;case"focusout":_$="blur",p$=Fd$2;break;case"beforeblur":case"afterblur":p$=Fd$2;break;case"click":if(r$.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p$=Bd$2;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p$=Dd$2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p$=Vd$2;break;case $e$2:case af$2:case bf$2:p$=Hd$2;break;case cf$2:p$=Xd$2;break;case"scroll":p$=vd$2;break;case"wheel":p$=Zd$2;break;case"copy":case"cut":case"paste":p$=Jd$2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p$=Td$2}var f$=(t$&4)!==0,m$=!f$&&e$==="scroll",g$=f$?h$!==null?h$+"Capture":null:h$;f$=[];for(var v$=u$,y$;v$!==null;){y$=v$;var S$=y$.stateNode;if(y$.tag===5&&S$!==null&&(y$=S$,g$!==null&&(S$=Kb$2(v$,g$),S$!=null&&f$.push(tf$2(v$,S$,y$)))),m$)break;v$=v$.return}0<f$.length&&(h$=new p$(h$,_$,null,r$,l$),d$.push({event:h$,listeners:f$}))}}if(!(t$&7)){e:{if(h$=e$==="mouseover"||e$==="pointerover",p$=e$==="mouseout"||e$==="pointerout",h$&&r$!==wb$2&&(_$=r$.relatedTarget||r$.fromElement)&&(Wc$2(_$)||_$[uf$2]))break e;if((p$||h$)&&(h$=l$.window===l$?l$:(h$=l$.ownerDocument)?h$.defaultView||h$.parentWindow:window,p$?(_$=r$.relatedTarget||r$.toElement,p$=u$,_$=_$?Wc$2(_$):null,_$!==null&&(m$=Vb$2(_$),_$!==m$||_$.tag!==5&&_$.tag!==6)&&(_$=null)):(p$=null,_$=u$),p$!==_$)){if(f$=Bd$2,S$="onMouseLeave",g$="onMouseEnter",v$="mouse",(e$==="pointerout"||e$==="pointerover")&&(f$=Td$2,S$="onPointerLeave",g$="onPointerEnter",v$="pointer"),m$=p$==null?h$:ue$2(p$),y$=_$==null?h$:ue$2(_$),h$=new f$(S$,v$+"leave",p$,r$,l$),h$.target=m$,h$.relatedTarget=y$,S$=null,Wc$2(l$)===u$&&(f$=new f$(g$,v$+"enter",_$,r$,l$),f$.target=y$,f$.relatedTarget=m$,S$=f$),m$=S$,p$&&_$)t:{for(f$=p$,g$=_$,v$=0,y$=f$;y$;y$=vf$2(y$))v$++;for(y$=0,S$=g$;S$;S$=vf$2(S$))y$++;for(;0<v$-y$;)f$=vf$2(f$),v$--;for(;0<y$-v$;)g$=vf$2(g$),y$--;for(;v$--;){if(f$===g$||g$!==null&&f$===g$.alternate)break t;f$=vf$2(f$),g$=vf$2(g$)}f$=null}else f$=null;p$!==null&&wf$2(d$,h$,p$,f$,!1),_$!==null&&m$!==null&&wf$2(d$,m$,_$,f$,!0)}}e:{if(h$=u$?ue$2(u$):window,p$=h$.nodeName&&h$.nodeName.toLowerCase(),p$==="select"||p$==="input"&&h$.type==="file")var b$=ve$2;else if(me$2(h$))if(we$2)b$=Fe$2;else{b$=De$2;var $$=Ce$2}else(p$=h$.nodeName)&&p$.toLowerCase()==="input"&&(h$.type==="checkbox"||h$.type==="radio")&&(b$=Ee$2);if(b$&&(b$=b$(e$,u$))){ne$1(d$,b$,r$,l$);break e}$$&&$$(e$,h$,u$),e$==="focusout"&&($$=h$._wrapperState)&&$$.controlled&&h$.type==="number"&&cb$2(h$,"number",h$.value)}switch($$=u$?ue$2(u$):window,e$){case"focusin":(me$2($$)||$$.contentEditable==="true")&&(Qe$2=$$,Re$1=u$,Se$2=null);break;case"focusout":Se$2=Re$1=Qe$2=null;break;case"mousedown":Te$2=!0;break;case"contextmenu":case"mouseup":case"dragend":Te$2=!1,Ue$2(d$,r$,l$);break;case"selectionchange":if(Pe$2)break;case"keydown":case"keyup":Ue$2(d$,r$,l$)}var C$;if(ae$2)e:{switch(e$){case"compositionstart":var N$="onCompositionStart";break e;case"compositionend":N$="onCompositionEnd";break e;case"compositionupdate":N$="onCompositionUpdate";break e}N$=void 0}else ie$2?ge$2(e$,r$)&&(N$="onCompositionEnd"):e$==="keydown"&&r$.keyCode===229&&(N$="onCompositionStart");N$&&(de$2&&r$.locale!=="ko"&&(ie$2||N$!=="onCompositionStart"?N$==="onCompositionEnd"&&ie$2&&(C$=nd$2()):(kd$2=l$,ld$2="value"in kd$2?kd$2.value:kd$2.textContent,ie$2=!0)),$$=oe$2(u$,N$),0<$$.length&&(N$=new Ld$2(N$,e$,null,r$,l$),d$.push({event:N$,listeners:$$}),C$?N$.data=C$:(C$=he$2(r$),C$!==null&&(N$.data=C$)))),(C$=ce$1?je$2(e$,r$):ke$2(e$,r$))&&(u$=oe$2(u$,"onBeforeInput"),0<u$.length&&(l$=new Ld$2("onBeforeInput","beforeinput",null,r$,l$),d$.push({event:l$,listeners:u$}),l$.data=C$))}se$2(d$,t$)})}function tf$2(e$,t$,r$){return{instance:e$,listener:t$,currentTarget:r$}}function oe$2(e$,t$){for(var r$=t$+"Capture",n$=[];e$!==null;){var i$=e$,o$=i$.stateNode;i$.tag===5&&o$!==null&&(i$=o$,o$=Kb$2(e$,r$),o$!=null&&n$.unshift(tf$2(e$,o$,i$)),o$=Kb$2(e$,t$),o$!=null&&n$.push(tf$2(e$,o$,i$))),e$=e$.return}return n$}function vf$2(e$){if(e$===null)return null;do e$=e$.return;while(e$&&e$.tag!==5);return e$||null}function wf$2(e$,t$,r$,n$,i$){for(var o$=t$._reactName,s$=[];r$!==null&&r$!==n$;){var a$=r$,c$=a$.alternate,u$=a$.stateNode;if(c$!==null&&c$===n$)break;a$.tag===5&&u$!==null&&(a$=u$,i$?(c$=Kb$2(r$,o$),c$!=null&&s$.unshift(tf$2(r$,c$,a$))):i$||(c$=Kb$2(r$,o$),c$!=null&&s$.push(tf$2(r$,c$,a$)))),r$=r$.return}s$.length!==0&&e$.push({event:t$,listeners:s$})}var xf$1=/\r\n?/g,yf$2=/\u0000|\uFFFD/g;function zf$2(e$){return(typeof e$=="string"?e$:""+e$).replace(xf$1,`
`).replace(yf$2,"")}function Af$2(e$,t$,r$){if(t$=zf$2(t$),zf$2(e$)!==t$&&r$)throw Error(p$1(425))}function Bf$1(){}var Cf$2=null,Df$2=null;function Ef$2(e$,t$){return e$==="textarea"||e$==="noscript"||typeof t$.children=="string"||typeof t$.children=="number"||typeof t$.dangerouslySetInnerHTML=="object"&&t$.dangerouslySetInnerHTML!==null&&t$.dangerouslySetInnerHTML.__html!=null}var Ff$1=typeof setTimeout=="function"?setTimeout:void 0,Gf$1=typeof clearTimeout=="function"?clearTimeout:void 0,Hf$1=typeof Promise=="function"?Promise:void 0,Jf$1=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf$1<"u"?function(e$){return Hf$1.resolve(null).then(e$).catch(If$2)}:Ff$1;function If$2(e$){setTimeout(function(){throw e$})}function Kf$1(e$,t$){var r$=t$,n$=0;do{var i$=r$.nextSibling;if(e$.removeChild(r$),i$&&i$.nodeType===8)if(r$=i$.data,r$==="/$"){if(n$===0){e$.removeChild(i$),bd$2(t$);return}n$--}else r$!=="$"&&r$!=="$?"&&r$!=="$!"||n$++;r$=i$}while(r$);bd$2(t$)}function Lf$2(e$){for(;e$!=null;e$=e$.nextSibling){var t$=e$.nodeType;if(t$===1||t$===3)break;if(t$===8){if(t$=e$.data,t$==="$"||t$==="$!"||t$==="$?")break;if(t$==="/$")return null}}return e$}function Mf$2(e$){e$=e$.previousSibling;for(var t$=0;e$;){if(e$.nodeType===8){var r$=e$.data;if(r$==="$"||r$==="$!"||r$==="$?"){if(t$===0)return e$;t$--}else r$==="/$"&&t$++}e$=e$.previousSibling}return null}var Nf$2=Math.random().toString(36).slice(2),Of$2="__reactFiber$"+Nf$2,Pf$2="__reactProps$"+Nf$2,uf$2="__reactContainer$"+Nf$2,of$2="__reactEvents$"+Nf$2,Qf$2="__reactListeners$"+Nf$2,Rf$2="__reactHandles$"+Nf$2;function Wc$2(e$){var t$=e$[Of$2];if(t$)return t$;for(var r$=e$.parentNode;r$;){if(t$=r$[uf$2]||r$[Of$2]){if(r$=t$.alternate,t$.child!==null||r$!==null&&r$.child!==null)for(e$=Mf$2(e$);e$!==null;){if(r$=e$[Of$2])return r$;e$=Mf$2(e$)}return t$}e$=r$,r$=e$.parentNode}return null}function Cb$2(e$){return e$=e$[Of$2]||e$[uf$2],!e$||e$.tag!==5&&e$.tag!==6&&e$.tag!==13&&e$.tag!==3?null:e$}function ue$2(e$){if(e$.tag===5||e$.tag===6)return e$.stateNode;throw Error(p$1(33))}function Db$2(e$){return e$[Pf$2]||null}var Sf$2=[],Tf$2=-1;function Uf$1(e$){return{current:e$}}function E$1(e$){0>Tf$2||(e$.current=Sf$2[Tf$2],Sf$2[Tf$2]=null,Tf$2--)}function G$2(e$,t$){Tf$2++,Sf$2[Tf$2]=e$.current,e$.current=t$}var Vf$1={},H$2=Uf$1(Vf$1),Wf$1=Uf$1(!1),Xf$2=Vf$1;function Yf$1(e$,t$){var r$=e$.type.contextTypes;if(!r$)return Vf$1;var n$=e$.stateNode;if(n$&&n$.__reactInternalMemoizedUnmaskedChildContext===t$)return n$.__reactInternalMemoizedMaskedChildContext;var i$={},o$;for(o$ in r$)i$[o$]=t$[o$];return n$&&(e$=e$.stateNode,e$.__reactInternalMemoizedUnmaskedChildContext=t$,e$.__reactInternalMemoizedMaskedChildContext=i$),i$}function Zf$2(e$){return e$=e$.childContextTypes,e$!=null}function $f$2(){E$1(Wf$1),E$1(H$2)}function ag$2(e$,t$,r$){if(H$2.current!==Vf$1)throw Error(p$1(168));G$2(H$2,t$),G$2(Wf$1,r$)}function bg$2(e$,t$,r$){var n$=e$.stateNode;if(t$=t$.childContextTypes,typeof n$.getChildContext!="function")return r$;n$=n$.getChildContext();for(var i$ in n$)if(!(i$ in t$))throw Error(p$1(108,Ra$2(e$)||"Unknown",i$));return A$1({},r$,n$)}function cg$2(e$){return e$=(e$=e$.stateNode)&&e$.__reactInternalMemoizedMergedChildContext||Vf$1,Xf$2=H$2.current,G$2(H$2,e$),G$2(Wf$1,Wf$1.current),!0}function dg$2(e$,t$,r$){var n$=e$.stateNode;if(!n$)throw Error(p$1(169));r$?(e$=bg$2(e$,t$,Xf$2),n$.__reactInternalMemoizedMergedChildContext=e$,E$1(Wf$1),E$1(H$2),G$2(H$2,e$)):E$1(Wf$1),G$2(Wf$1,r$)}var eg$2=null,fg$2=!1,gg$2=!1;function hg$2(e$){eg$2===null?eg$2=[e$]:eg$2.push(e$)}function ig$2(e$){fg$2=!0,hg$2(e$)}function jg$2(){if(!gg$2&&eg$2!==null){gg$2=!0;var e$=0,t$=C$1;try{var r$=eg$2;for(C$1=1;e$<r$.length;e$++){var n$=r$[e$];do n$=n$(!0);while(n$!==null)}eg$2=null,fg$2=!1}catch(i$){throw eg$2!==null&&(eg$2=eg$2.slice(e$+1)),ac$2(fc$2,jg$2),i$}finally{C$1=t$,gg$2=!1}}return null}var kg$2=[],lg$2=0,mg$2=null,ng$2=0,og$2=[],pg$2=0,qg$2=null,rg$2=1,sg$2="";function tg$2(e$,t$){kg$2[lg$2++]=ng$2,kg$2[lg$2++]=mg$2,mg$2=e$,ng$2=t$}function ug$2(e$,t$,r$){og$2[pg$2++]=rg$2,og$2[pg$2++]=sg$2,og$2[pg$2++]=qg$2,qg$2=e$;var n$=rg$2;e$=sg$2;var i$=32-oc$2(n$)-1;n$&=~(1<<i$),r$+=1;var o$=32-oc$2(t$)+i$;if(30<o$){var s$=i$-i$%5;o$=(n$&(1<<s$)-1).toString(32),n$>>=s$,i$-=s$,rg$2=1<<32-oc$2(t$)+i$|r$<<i$|n$,sg$2=o$+e$}else rg$2=1<<o$|r$<<i$|n$,sg$2=e$}function vg$2(e$){e$.return!==null&&(tg$2(e$,1),ug$2(e$,1,0))}function wg$2(e$){for(;e$===mg$2;)mg$2=kg$2[--lg$2],kg$2[lg$2]=null,ng$2=kg$2[--lg$2],kg$2[lg$2]=null;for(;e$===qg$2;)qg$2=og$2[--pg$2],og$2[pg$2]=null,sg$2=og$2[--pg$2],og$2[pg$2]=null,rg$2=og$2[--pg$2],og$2[pg$2]=null}var xg$2=null,yg$2=null,I$1=!1,zg$2=null;function Ag$2(e$,t$){var r$=Bg$2(5,null,null,0);r$.elementType="DELETED",r$.stateNode=t$,r$.return=e$,t$=e$.deletions,t$===null?(e$.deletions=[r$],e$.flags|=16):t$.push(r$)}function Cg$2(e$,t$){switch(e$.tag){case 5:var r$=e$.type;return t$=t$.nodeType!==1||r$.toLowerCase()!==t$.nodeName.toLowerCase()?null:t$,t$!==null?(e$.stateNode=t$,xg$2=e$,yg$2=Lf$2(t$.firstChild),!0):!1;case 6:return t$=e$.pendingProps===""||t$.nodeType!==3?null:t$,t$!==null?(e$.stateNode=t$,xg$2=e$,yg$2=null,!0):!1;case 13:return t$=t$.nodeType!==8?null:t$,t$!==null?(r$=qg$2!==null?{id:rg$2,overflow:sg$2}:null,e$.memoizedState={dehydrated:t$,treeContext:r$,retryLane:1073741824},r$=Bg$2(18,null,null,0),r$.stateNode=t$,r$.return=e$,e$.child=r$,xg$2=e$,yg$2=null,!0):!1;default:return!1}}function Dg$2(e$){return(e$.mode&1)!==0&&(e$.flags&128)===0}function Eg$2(e$){if(I$1){var t$=yg$2;if(t$){var r$=t$;if(!Cg$2(e$,t$)){if(Dg$2(e$))throw Error(p$1(418));t$=Lf$2(r$.nextSibling);var n$=xg$2;t$&&Cg$2(e$,t$)?Ag$2(n$,r$):(e$.flags=e$.flags&-4097|2,I$1=!1,xg$2=e$)}}else{if(Dg$2(e$))throw Error(p$1(418));e$.flags=e$.flags&-4097|2,I$1=!1,xg$2=e$}}}function Fg$2(e$){for(e$=e$.return;e$!==null&&e$.tag!==5&&e$.tag!==3&&e$.tag!==13;)e$=e$.return;xg$2=e$}function Gg$2(e$){if(e$!==xg$2)return!1;if(!I$1)return Fg$2(e$),I$1=!0,!1;var t$;if((t$=e$.tag!==3)&&!(t$=e$.tag!==5)&&(t$=e$.type,t$=t$!=="head"&&t$!=="body"&&!Ef$2(e$.type,e$.memoizedProps)),t$&&(t$=yg$2)){if(Dg$2(e$))throw Hg$2(),Error(p$1(418));for(;t$;)Ag$2(e$,t$),t$=Lf$2(t$.nextSibling)}if(Fg$2(e$),e$.tag===13){if(e$=e$.memoizedState,e$=e$!==null?e$.dehydrated:null,!e$)throw Error(p$1(317));e:{for(e$=e$.nextSibling,t$=0;e$;){if(e$.nodeType===8){var r$=e$.data;if(r$==="/$"){if(t$===0){yg$2=Lf$2(e$.nextSibling);break e}t$--}else r$!=="$"&&r$!=="$!"&&r$!=="$?"||t$++}e$=e$.nextSibling}yg$2=null}}else yg$2=xg$2?Lf$2(e$.stateNode.nextSibling):null;return!0}function Hg$2(){for(var e$=yg$2;e$;)e$=Lf$2(e$.nextSibling)}function Ig$2(){yg$2=xg$2=null,I$1=!1}function Jg$2(e$){zg$2===null?zg$2=[e$]:zg$2.push(e$)}var Kg$2=ua$2.ReactCurrentBatchConfig;function Lg$2(e$,t$,r$){if(e$=r$.ref,e$!==null&&typeof e$!="function"&&typeof e$!="object"){if(r$._owner){if(r$=r$._owner,r$){if(r$.tag!==1)throw Error(p$1(309));var n$=r$.stateNode}if(!n$)throw Error(p$1(147,e$));var i$=n$,o$=""+e$;return t$!==null&&t$.ref!==null&&typeof t$.ref=="function"&&t$.ref._stringRef===o$?t$.ref:(t$=function(s$){var a$=i$.refs;s$===null?delete a$[o$]:a$[o$]=s$},t$._stringRef=o$,t$)}if(typeof e$!="string")throw Error(p$1(284));if(!r$._owner)throw Error(p$1(290,e$))}return e$}function Mg$2(e$,t$){throw e$=Object.prototype.toString.call(t$),Error(p$1(31,e$==="[object Object]"?"object with keys {"+Object.keys(t$).join(", ")+"}":e$))}function Ng$2(e$){var t$=e$._init;return t$(e$._payload)}function Og$2(e$){function t$(g$,v$){if(e$){var y$=g$.deletions;y$===null?(g$.deletions=[v$],g$.flags|=16):y$.push(v$)}}function r$(g$,v$){if(!e$)return null;for(;v$!==null;)t$(g$,v$),v$=v$.sibling;return null}function n$(g$,v$){for(g$=new Map;v$!==null;)v$.key!==null?g$.set(v$.key,v$):g$.set(v$.index,v$),v$=v$.sibling;return g$}function i$(g$,v$){return g$=Pg$2(g$,v$),g$.index=0,g$.sibling=null,g$}function o$(g$,v$,y$){return g$.index=y$,e$?(y$=g$.alternate,y$!==null?(y$=y$.index,y$<v$?(g$.flags|=2,v$):y$):(g$.flags|=2,v$)):(g$.flags|=1048576,v$)}function s$(g$){return e$&&g$.alternate===null&&(g$.flags|=2),g$}function a$(g$,v$,y$,S$){return v$===null||v$.tag!==6?(v$=Qg$2(y$,g$.mode,S$),v$.return=g$,v$):(v$=i$(v$,y$),v$.return=g$,v$)}function c$(g$,v$,y$,S$){var b$=y$.type;return b$===ya$1?l$(g$,v$,y$.props.children,S$,y$.key):v$!==null&&(v$.elementType===b$||typeof b$=="object"&&b$!==null&&b$.$$typeof===Ha$2&&Ng$2(b$)===v$.type)?(S$=i$(v$,y$.props),S$.ref=Lg$2(g$,v$,y$),S$.return=g$,S$):(S$=Rg$2(y$.type,y$.key,y$.props,null,g$.mode,S$),S$.ref=Lg$2(g$,v$,y$),S$.return=g$,S$)}function u$(g$,v$,y$,S$){return v$===null||v$.tag!==4||v$.stateNode.containerInfo!==y$.containerInfo||v$.stateNode.implementation!==y$.implementation?(v$=Sg$2(y$,g$.mode,S$),v$.return=g$,v$):(v$=i$(v$,y$.children||[]),v$.return=g$,v$)}function l$(g$,v$,y$,S$,b$){return v$===null||v$.tag!==7?(v$=Tg$2(y$,g$.mode,S$,b$),v$.return=g$,v$):(v$=i$(v$,y$),v$.return=g$,v$)}function d$(g$,v$,y$){if(typeof v$=="string"&&v$!==""||typeof v$=="number")return v$=Qg$2(""+v$,g$.mode,y$),v$.return=g$,v$;if(typeof v$=="object"&&v$!==null){switch(v$.$$typeof){case va$1:return y$=Rg$2(v$.type,v$.key,v$.props,null,g$.mode,y$),y$.ref=Lg$2(g$,null,v$),y$.return=g$,y$;case wa$2:return v$=Sg$2(v$,g$.mode,y$),v$.return=g$,v$;case Ha$2:var S$=v$._init;return d$(g$,S$(v$._payload),y$)}if(eb$2(v$)||Ka$2(v$))return v$=Tg$2(v$,g$.mode,y$,null),v$.return=g$,v$;Mg$2(g$,v$)}return null}function h$(g$,v$,y$,S$){var b$=v$!==null?v$.key:null;if(typeof y$=="string"&&y$!==""||typeof y$=="number")return b$!==null?null:a$(g$,v$,""+y$,S$);if(typeof y$=="object"&&y$!==null){switch(y$.$$typeof){case va$1:return y$.key===b$?c$(g$,v$,y$,S$):null;case wa$2:return y$.key===b$?u$(g$,v$,y$,S$):null;case Ha$2:return b$=y$._init,h$(g$,v$,b$(y$._payload),S$)}if(eb$2(y$)||Ka$2(y$))return b$!==null?null:l$(g$,v$,y$,S$,null);Mg$2(g$,y$)}return null}function p$(g$,v$,y$,S$,b$){if(typeof S$=="string"&&S$!==""||typeof S$=="number")return g$=g$.get(y$)||null,a$(v$,g$,""+S$,b$);if(typeof S$=="object"&&S$!==null){switch(S$.$$typeof){case va$1:return g$=g$.get(S$.key===null?y$:S$.key)||null,c$(v$,g$,S$,b$);case wa$2:return g$=g$.get(S$.key===null?y$:S$.key)||null,u$(v$,g$,S$,b$);case Ha$2:var $$=S$._init;return p$(g$,v$,y$,$$(S$._payload),b$)}if(eb$2(S$)||Ka$2(S$))return g$=g$.get(y$)||null,l$(v$,g$,S$,b$,null);Mg$2(v$,S$)}return null}function _$(g$,v$,y$,S$){for(var b$=null,$$=null,C$=v$,N$=v$=0,k$=null;C$!==null&&N$<y$.length;N$++){C$.index>N$?(k$=C$,C$=null):k$=C$.sibling;var O$=h$(g$,C$,y$[N$],S$);if(O$===null){C$===null&&(C$=k$);break}e$&&C$&&O$.alternate===null&&t$(g$,C$),v$=o$(O$,v$,N$),$$===null?b$=O$:$$.sibling=O$,$$=O$,C$=k$}if(N$===y$.length)return r$(g$,C$),I$1&&tg$2(g$,N$),b$;if(C$===null){for(;N$<y$.length;N$++)C$=d$(g$,y$[N$],S$),C$!==null&&(v$=o$(C$,v$,N$),$$===null?b$=C$:$$.sibling=C$,$$=C$);return I$1&&tg$2(g$,N$),b$}for(C$=n$(g$,C$);N$<y$.length;N$++)k$=p$(C$,g$,N$,y$[N$],S$),k$!==null&&(e$&&k$.alternate!==null&&C$.delete(k$.key===null?N$:k$.key),v$=o$(k$,v$,N$),$$===null?b$=k$:$$.sibling=k$,$$=k$);return e$&&C$.forEach(function(U$){return t$(g$,U$)}),I$1&&tg$2(g$,N$),b$}function f$(g$,v$,y$,S$){var b$=Ka$2(y$);if(typeof b$!="function")throw Error(p$1(150));if(y$=b$.call(y$),y$==null)throw Error(p$1(151));for(var $$=b$=null,C$=v$,N$=v$=0,k$=null,O$=y$.next();C$!==null&&!O$.done;N$++,O$=y$.next()){C$.index>N$?(k$=C$,C$=null):k$=C$.sibling;var U$=h$(g$,C$,O$.value,S$);if(U$===null){C$===null&&(C$=k$);break}e$&&C$&&U$.alternate===null&&t$(g$,C$),v$=o$(U$,v$,N$),$$===null?b$=U$:$$.sibling=U$,$$=U$,C$=k$}if(O$.done)return r$(g$,C$),I$1&&tg$2(g$,N$),b$;if(C$===null){for(;!O$.done;N$++,O$=y$.next())O$=d$(g$,O$.value,S$),O$!==null&&(v$=o$(O$,v$,N$),$$===null?b$=O$:$$.sibling=O$,$$=O$);return I$1&&tg$2(g$,N$),b$}for(C$=n$(g$,C$);!O$.done;N$++,O$=y$.next())O$=p$(C$,g$,N$,O$.value,S$),O$!==null&&(e$&&O$.alternate!==null&&C$.delete(O$.key===null?N$:O$.key),v$=o$(O$,v$,N$),$$===null?b$=O$:$$.sibling=O$,$$=O$);return e$&&C$.forEach(function(x$){return t$(g$,x$)}),I$1&&tg$2(g$,N$),b$}function m$(g$,v$,y$,S$){if(typeof y$=="object"&&y$!==null&&y$.type===ya$1&&y$.key===null&&(y$=y$.props.children),typeof y$=="object"&&y$!==null){switch(y$.$$typeof){case va$1:e:{for(var b$=y$.key,$$=v$;$$!==null;){if($$.key===b$){if(b$=y$.type,b$===ya$1){if($$.tag===7){r$(g$,$$.sibling),v$=i$($$,y$.props.children),v$.return=g$,g$=v$;break e}}else if($$.elementType===b$||typeof b$=="object"&&b$!==null&&b$.$$typeof===Ha$2&&Ng$2(b$)===$$.type){r$(g$,$$.sibling),v$=i$($$,y$.props),v$.ref=Lg$2(g$,$$,y$),v$.return=g$,g$=v$;break e}r$(g$,$$);break}else t$(g$,$$);$$=$$.sibling}y$.type===ya$1?(v$=Tg$2(y$.props.children,g$.mode,S$,y$.key),v$.return=g$,g$=v$):(S$=Rg$2(y$.type,y$.key,y$.props,null,g$.mode,S$),S$.ref=Lg$2(g$,v$,y$),S$.return=g$,g$=S$)}return s$(g$);case wa$2:e:{for($$=y$.key;v$!==null;){if(v$.key===$$)if(v$.tag===4&&v$.stateNode.containerInfo===y$.containerInfo&&v$.stateNode.implementation===y$.implementation){r$(g$,v$.sibling),v$=i$(v$,y$.children||[]),v$.return=g$,g$=v$;break e}else{r$(g$,v$);break}else t$(g$,v$);v$=v$.sibling}v$=Sg$2(y$,g$.mode,S$),v$.return=g$,g$=v$}return s$(g$);case Ha$2:return $$=y$._init,m$(g$,v$,$$(y$._payload),S$)}if(eb$2(y$))return _$(g$,v$,y$,S$);if(Ka$2(y$))return f$(g$,v$,y$,S$);Mg$2(g$,y$)}return typeof y$=="string"&&y$!==""||typeof y$=="number"?(y$=""+y$,v$!==null&&v$.tag===6?(r$(g$,v$.sibling),v$=i$(v$,y$),v$.return=g$,g$=v$):(r$(g$,v$),v$=Qg$2(y$,g$.mode,S$),v$.return=g$,g$=v$),s$(g$)):r$(g$,v$)}return m$}var Ug$2=Og$2(!0),Vg$2=Og$2(!1),Wg$2=Uf$1(null),Xg$2=null,Yg$2=null,Zg$2=null;function $g$2(){Zg$2=Yg$2=Xg$2=null}function ah$1(e$){var t$=Wg$2.current;E$1(Wg$2),e$._currentValue=t$}function bh$2(e$,t$,r$){for(;e$!==null;){var n$=e$.alternate;if((e$.childLanes&t$)!==t$?(e$.childLanes|=t$,n$!==null&&(n$.childLanes|=t$)):n$!==null&&(n$.childLanes&t$)!==t$&&(n$.childLanes|=t$),e$===r$)break;e$=e$.return}}function ch$1(e$,t$){Xg$2=e$,Zg$2=Yg$2=null,e$=e$.dependencies,e$!==null&&e$.firstContext!==null&&(e$.lanes&t$&&(dh$1=!0),e$.firstContext=null)}function eh$2(e$){var t$=e$._currentValue;if(Zg$2!==e$)if(e$={context:e$,memoizedValue:t$,next:null},Yg$2===null){if(Xg$2===null)throw Error(p$1(308));Yg$2=e$,Xg$2.dependencies={lanes:0,firstContext:e$}}else Yg$2=Yg$2.next=e$;return t$}var fh$2=null;function gh$2(e$){fh$2===null?fh$2=[e$]:fh$2.push(e$)}function hh$2(e$,t$,r$,n$){var i$=t$.interleaved;return i$===null?(r$.next=r$,gh$2(t$)):(r$.next=i$.next,i$.next=r$),t$.interleaved=r$,ih$1(e$,n$)}function ih$1(e$,t$){e$.lanes|=t$;var r$=e$.alternate;for(r$!==null&&(r$.lanes|=t$),r$=e$,e$=e$.return;e$!==null;)e$.childLanes|=t$,r$=e$.alternate,r$!==null&&(r$.childLanes|=t$),r$=e$,e$=e$.return;return r$.tag===3?r$.stateNode:null}var jh$2=!1;function kh$2(e$){e$.updateQueue={baseState:e$.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh$1(e$,t$){e$=e$.updateQueue,t$.updateQueue===e$&&(t$.updateQueue={baseState:e$.baseState,firstBaseUpdate:e$.firstBaseUpdate,lastBaseUpdate:e$.lastBaseUpdate,shared:e$.shared,effects:e$.effects})}function mh$2(e$,t$){return{eventTime:e$,lane:t$,tag:0,payload:null,callback:null,next:null}}function nh$2(e$,t$,r$){var n$=e$.updateQueue;if(n$===null)return null;if(n$=n$.shared,K$2&2){var i$=n$.pending;return i$===null?t$.next=t$:(t$.next=i$.next,i$.next=t$),n$.pending=t$,ih$1(e$,r$)}return i$=n$.interleaved,i$===null?(t$.next=t$,gh$2(n$)):(t$.next=i$.next,i$.next=t$),n$.interleaved=t$,ih$1(e$,r$)}function oh$1(e$,t$,r$){if(t$=t$.updateQueue,t$!==null&&(t$=t$.shared,(r$&4194240)!==0)){var n$=t$.lanes;n$&=e$.pendingLanes,r$|=n$,t$.lanes=r$,Cc$2(e$,r$)}}function ph$2(e$,t$){var r$=e$.updateQueue,n$=e$.alternate;if(n$!==null&&(n$=n$.updateQueue,r$===n$)){var i$=null,o$=null;if(r$=r$.firstBaseUpdate,r$!==null){do{var s$={eventTime:r$.eventTime,lane:r$.lane,tag:r$.tag,payload:r$.payload,callback:r$.callback,next:null};o$===null?i$=o$=s$:o$=o$.next=s$,r$=r$.next}while(r$!==null);o$===null?i$=o$=t$:o$=o$.next=t$}else i$=o$=t$;r$={baseState:n$.baseState,firstBaseUpdate:i$,lastBaseUpdate:o$,shared:n$.shared,effects:n$.effects},e$.updateQueue=r$;return}e$=r$.lastBaseUpdate,e$===null?r$.firstBaseUpdate=t$:e$.next=t$,r$.lastBaseUpdate=t$}function qh$2(e$,t$,r$,n$){var i$=e$.updateQueue;jh$2=!1;var o$=i$.firstBaseUpdate,s$=i$.lastBaseUpdate,a$=i$.shared.pending;if(a$!==null){i$.shared.pending=null;var c$=a$,u$=c$.next;c$.next=null,s$===null?o$=u$:s$.next=u$,s$=c$;var l$=e$.alternate;l$!==null&&(l$=l$.updateQueue,a$=l$.lastBaseUpdate,a$!==s$&&(a$===null?l$.firstBaseUpdate=u$:a$.next=u$,l$.lastBaseUpdate=c$))}if(o$!==null){var d$=i$.baseState;s$=0,l$=u$=c$=null,a$=o$;do{var h$=a$.lane,p$=a$.eventTime;if((n$&h$)===h$){l$!==null&&(l$=l$.next={eventTime:p$,lane:0,tag:a$.tag,payload:a$.payload,callback:a$.callback,next:null});e:{var _$=e$,f$=a$;switch(h$=t$,p$=r$,f$.tag){case 1:if(_$=f$.payload,typeof _$=="function"){d$=_$.call(p$,d$,h$);break e}d$=_$;break e;case 3:_$.flags=_$.flags&-65537|128;case 0:if(_$=f$.payload,h$=typeof _$=="function"?_$.call(p$,d$,h$):_$,h$==null)break e;d$=A$1({},d$,h$);break e;case 2:jh$2=!0}}a$.callback!==null&&a$.lane!==0&&(e$.flags|=64,h$=i$.effects,h$===null?i$.effects=[a$]:h$.push(a$))}else p$={eventTime:p$,lane:h$,tag:a$.tag,payload:a$.payload,callback:a$.callback,next:null},l$===null?(u$=l$=p$,c$=d$):l$=l$.next=p$,s$|=h$;if(a$=a$.next,a$===null){if(a$=i$.shared.pending,a$===null)break;h$=a$,a$=h$.next,h$.next=null,i$.lastBaseUpdate=h$,i$.shared.pending=null}}while(!0);if(l$===null&&(c$=d$),i$.baseState=c$,i$.firstBaseUpdate=u$,i$.lastBaseUpdate=l$,t$=i$.shared.interleaved,t$!==null){i$=t$;do s$|=i$.lane,i$=i$.next;while(i$!==t$)}else o$===null&&(i$.shared.lanes=0);rh$1|=s$,e$.lanes=s$,e$.memoizedState=d$}}function sh$1(e$,t$,r$){if(e$=t$.effects,t$.effects=null,e$!==null)for(t$=0;t$<e$.length;t$++){var n$=e$[t$],i$=n$.callback;if(i$!==null){if(n$.callback=null,n$=r$,typeof i$!="function")throw Error(p$1(191,i$));i$.call(n$)}}}var th$2={},uh$2=Uf$1(th$2),vh$2=Uf$1(th$2),wh$2=Uf$1(th$2);function xh$2(e$){if(e$===th$2)throw Error(p$1(174));return e$}function yh$2(e$,t$){switch(G$2(wh$2,t$),G$2(vh$2,e$),G$2(uh$2,th$2),e$=t$.nodeType,e$){case 9:case 11:t$=(t$=t$.documentElement)?t$.namespaceURI:lb$2(null,"");break;default:e$=e$===8?t$.parentNode:t$,t$=e$.namespaceURI||null,e$=e$.tagName,t$=lb$2(t$,e$)}E$1(uh$2),G$2(uh$2,t$)}function zh$2(){E$1(uh$2),E$1(vh$2),E$1(wh$2)}function Ah$2(e$){xh$2(wh$2.current);var t$=xh$2(uh$2.current),r$=lb$2(t$,e$.type);t$!==r$&&(G$2(vh$2,e$),G$2(uh$2,r$))}function Bh$2(e$){vh$2.current===e$&&(E$1(uh$2),E$1(vh$2))}var L$1=Uf$1(0);function Ch$2(e$){for(var t$=e$;t$!==null;){if(t$.tag===13){var r$=t$.memoizedState;if(r$!==null&&(r$=r$.dehydrated,r$===null||r$.data==="$?"||r$.data==="$!"))return t$}else if(t$.tag===19&&t$.memoizedProps.revealOrder!==void 0){if(t$.flags&128)return t$}else if(t$.child!==null){t$.child.return=t$,t$=t$.child;continue}if(t$===e$)break;for(;t$.sibling===null;){if(t$.return===null||t$.return===e$)return null;t$=t$.return}t$.sibling.return=t$.return,t$=t$.sibling}return null}var Dh$2=[];function Eh$2(){for(var e$=0;e$<Dh$2.length;e$++)Dh$2[e$]._workInProgressVersionPrimary=null;Dh$2.length=0}var Fh$2=ua$2.ReactCurrentDispatcher,Gh$2=ua$2.ReactCurrentBatchConfig,Hh$2=0,M$1=null,N$2=null,O$2=null,Ih$2=!1,Jh$2=!1,Kh$2=0,Lh$2=0;function P$2(){throw Error(p$1(321))}function Mh$2(e$,t$){if(t$===null)return!1;for(var r$=0;r$<t$.length&&r$<e$.length;r$++)if(!He$2(e$[r$],t$[r$]))return!1;return!0}function Nh$2(e$,t$,r$,n$,i$,o$){if(Hh$2=o$,M$1=t$,t$.memoizedState=null,t$.updateQueue=null,t$.lanes=0,Fh$2.current=e$===null||e$.memoizedState===null?Oh$2:Ph$2,e$=r$(n$,i$),Jh$2){o$=0;do{if(Jh$2=!1,Kh$2=0,25<=o$)throw Error(p$1(301));o$+=1,O$2=N$2=null,t$.updateQueue=null,Fh$2.current=Qh$2,e$=r$(n$,i$)}while(Jh$2)}if(Fh$2.current=Rh$2,t$=N$2!==null&&N$2.next!==null,Hh$2=0,O$2=N$2=M$1=null,Ih$2=!1,t$)throw Error(p$1(300));return e$}function Sh$2(){var e$=Kh$2!==0;return Kh$2=0,e$}function Th$2(){var e$={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O$2===null?M$1.memoizedState=O$2=e$:O$2=O$2.next=e$,O$2}function Uh$2(){if(N$2===null){var e$=M$1.alternate;e$=e$!==null?e$.memoizedState:null}else e$=N$2.next;var t$=O$2===null?M$1.memoizedState:O$2.next;if(t$!==null)O$2=t$,N$2=e$;else{if(e$===null)throw Error(p$1(310));N$2=e$,e$={memoizedState:N$2.memoizedState,baseState:N$2.baseState,baseQueue:N$2.baseQueue,queue:N$2.queue,next:null},O$2===null?M$1.memoizedState=O$2=e$:O$2=O$2.next=e$}return O$2}function Vh$2(e$,t$){return typeof t$=="function"?t$(e$):t$}function Wh$2(e$){var t$=Uh$2(),r$=t$.queue;if(r$===null)throw Error(p$1(311));r$.lastRenderedReducer=e$;var n$=N$2,i$=n$.baseQueue,o$=r$.pending;if(o$!==null){if(i$!==null){var s$=i$.next;i$.next=o$.next,o$.next=s$}n$.baseQueue=i$=o$,r$.pending=null}if(i$!==null){o$=i$.next,n$=n$.baseState;var a$=s$=null,c$=null,u$=o$;do{var l$=u$.lane;if((Hh$2&l$)===l$)c$!==null&&(c$=c$.next={lane:0,action:u$.action,hasEagerState:u$.hasEagerState,eagerState:u$.eagerState,next:null}),n$=u$.hasEagerState?u$.eagerState:e$(n$,u$.action);else{var d$={lane:l$,action:u$.action,hasEagerState:u$.hasEagerState,eagerState:u$.eagerState,next:null};c$===null?(a$=c$=d$,s$=n$):c$=c$.next=d$,M$1.lanes|=l$,rh$1|=l$}u$=u$.next}while(u$!==null&&u$!==o$);c$===null?s$=n$:c$.next=a$,He$2(n$,t$.memoizedState)||(dh$1=!0),t$.memoizedState=n$,t$.baseState=s$,t$.baseQueue=c$,r$.lastRenderedState=n$}if(e$=r$.interleaved,e$!==null){i$=e$;do o$=i$.lane,M$1.lanes|=o$,rh$1|=o$,i$=i$.next;while(i$!==e$)}else i$===null&&(r$.lanes=0);return[t$.memoizedState,r$.dispatch]}function Xh$2(e$){var t$=Uh$2(),r$=t$.queue;if(r$===null)throw Error(p$1(311));r$.lastRenderedReducer=e$;var n$=r$.dispatch,i$=r$.pending,o$=t$.memoizedState;if(i$!==null){r$.pending=null;var s$=i$=i$.next;do o$=e$(o$,s$.action),s$=s$.next;while(s$!==i$);He$2(o$,t$.memoizedState)||(dh$1=!0),t$.memoizedState=o$,t$.baseQueue===null&&(t$.baseState=o$),r$.lastRenderedState=o$}return[o$,n$]}function Yh$2(){}function Zh$2(e$,t$){var r$=M$1,n$=Uh$2(),i$=t$(),o$=!He$2(n$.memoizedState,i$);if(o$&&(n$.memoizedState=i$,dh$1=!0),n$=n$.queue,$h$2(ai$2.bind(null,r$,n$,e$),[e$]),n$.getSnapshot!==t$||o$||O$2!==null&&O$2.memoizedState.tag&1){if(r$.flags|=2048,bi$2(9,ci$2.bind(null,r$,n$,i$,t$),void 0,null),Q$2===null)throw Error(p$1(349));Hh$2&30||di$2(r$,t$,i$)}return i$}function di$2(e$,t$,r$){e$.flags|=16384,e$={getSnapshot:t$,value:r$},t$=M$1.updateQueue,t$===null?(t$={lastEffect:null,stores:null},M$1.updateQueue=t$,t$.stores=[e$]):(r$=t$.stores,r$===null?t$.stores=[e$]:r$.push(e$))}function ci$2(e$,t$,r$,n$){t$.value=r$,t$.getSnapshot=n$,ei$2(t$)&&fi$2(e$)}function ai$2(e$,t$,r$){return r$(function(){ei$2(t$)&&fi$2(e$)})}function ei$2(e$){var t$=e$.getSnapshot;e$=e$.value;try{var r$=t$();return!He$2(e$,r$)}catch{return!0}}function fi$2(e$){var t$=ih$1(e$,1);t$!==null&&gi$2(t$,e$,1,-1)}function hi$2(e$){var t$=Th$2();return typeof e$=="function"&&(e$=e$()),t$.memoizedState=t$.baseState=e$,e$={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh$2,lastRenderedState:e$},t$.queue=e$,e$=e$.dispatch=ii$2.bind(null,M$1,e$),[t$.memoizedState,e$]}function bi$2(e$,t$,r$,n$){return e$={tag:e$,create:t$,destroy:r$,deps:n$,next:null},t$=M$1.updateQueue,t$===null?(t$={lastEffect:null,stores:null},M$1.updateQueue=t$,t$.lastEffect=e$.next=e$):(r$=t$.lastEffect,r$===null?t$.lastEffect=e$.next=e$:(n$=r$.next,r$.next=e$,e$.next=n$,t$.lastEffect=e$)),e$}function ji$2(){return Uh$2().memoizedState}function ki$2(e$,t$,r$,n$){var i$=Th$2();M$1.flags|=e$,i$.memoizedState=bi$2(1|t$,r$,void 0,n$===void 0?null:n$)}function li$2(e$,t$,r$,n$){var i$=Uh$2();n$=n$===void 0?null:n$;var o$=void 0;if(N$2!==null){var s$=N$2.memoizedState;if(o$=s$.destroy,n$!==null&&Mh$2(n$,s$.deps)){i$.memoizedState=bi$2(t$,r$,o$,n$);return}}M$1.flags|=e$,i$.memoizedState=bi$2(1|t$,r$,o$,n$)}function mi$2(e$,t$){return ki$2(8390656,8,e$,t$)}function $h$2(e$,t$){return li$2(2048,8,e$,t$)}function ni$2(e$,t$){return li$2(4,2,e$,t$)}function oi$2(e$,t$){return li$2(4,4,e$,t$)}function pi$2(e$,t$){if(typeof t$=="function")return e$=e$(),t$(e$),function(){t$(null)};if(t$!=null)return e$=e$(),t$.current=e$,function(){t$.current=null}}function qi$2(e$,t$,r$){return r$=r$!=null?r$.concat([e$]):null,li$2(4,4,pi$2.bind(null,t$,e$),r$)}function ri$2(){}function si$1(e$,t$){var r$=Uh$2();t$=t$===void 0?null:t$;var n$=r$.memoizedState;return n$!==null&&t$!==null&&Mh$2(t$,n$[1])?n$[0]:(r$.memoizedState=[e$,t$],e$)}function ti$2(e$,t$){var r$=Uh$2();t$=t$===void 0?null:t$;var n$=r$.memoizedState;return n$!==null&&t$!==null&&Mh$2(t$,n$[1])?n$[0]:(e$=e$(),r$.memoizedState=[e$,t$],e$)}function ui$2(e$,t$,r$){return Hh$2&21?(He$2(r$,t$)||(r$=yc$2(),M$1.lanes|=r$,rh$1|=r$,e$.baseState=!0),t$):(e$.baseState&&(e$.baseState=!1,dh$1=!0),e$.memoizedState=r$)}function vi$2(e$,t$){var r$=C$1;C$1=r$!==0&&4>r$?r$:4,e$(!0);var n$=Gh$2.transition;Gh$2.transition={};try{e$(!1),t$()}finally{C$1=r$,Gh$2.transition=n$}}function wi$2(){return Uh$2().memoizedState}function xi$2(e$,t$,r$){var n$=yi$2(e$);if(r$={lane:n$,action:r$,hasEagerState:!1,eagerState:null,next:null},zi$2(e$))Ai$2(t$,r$);else if(r$=hh$2(e$,t$,r$,n$),r$!==null){var i$=R$2();gi$2(r$,e$,n$,i$),Bi$2(r$,t$,n$)}}function ii$2(e$,t$,r$){var n$=yi$2(e$),i$={lane:n$,action:r$,hasEagerState:!1,eagerState:null,next:null};if(zi$2(e$))Ai$2(t$,i$);else{var o$=e$.alternate;if(e$.lanes===0&&(o$===null||o$.lanes===0)&&(o$=t$.lastRenderedReducer,o$!==null))try{var s$=t$.lastRenderedState,a$=o$(s$,r$);if(i$.hasEagerState=!0,i$.eagerState=a$,He$2(a$,s$)){var c$=t$.interleaved;c$===null?(i$.next=i$,gh$2(t$)):(i$.next=c$.next,c$.next=i$),t$.interleaved=i$;return}}catch{}finally{}r$=hh$2(e$,t$,i$,n$),r$!==null&&(i$=R$2(),gi$2(r$,e$,n$,i$),Bi$2(r$,t$,n$))}}function zi$2(e$){var t$=e$.alternate;return e$===M$1||t$!==null&&t$===M$1}function Ai$2(e$,t$){Jh$2=Ih$2=!0;var r$=e$.pending;r$===null?t$.next=t$:(t$.next=r$.next,r$.next=t$),e$.pending=t$}function Bi$2(e$,t$,r$){if(r$&4194240){var n$=t$.lanes;n$&=e$.pendingLanes,r$|=n$,t$.lanes=r$,Cc$2(e$,r$)}}var Rh$2={readContext:eh$2,useCallback:P$2,useContext:P$2,useEffect:P$2,useImperativeHandle:P$2,useInsertionEffect:P$2,useLayoutEffect:P$2,useMemo:P$2,useReducer:P$2,useRef:P$2,useState:P$2,useDebugValue:P$2,useDeferredValue:P$2,useTransition:P$2,useMutableSource:P$2,useSyncExternalStore:P$2,useId:P$2,unstable_isNewReconciler:!1},Oh$2={readContext:eh$2,useCallback:function(e$,t$){return Th$2().memoizedState=[e$,t$===void 0?null:t$],e$},useContext:eh$2,useEffect:mi$2,useImperativeHandle:function(e$,t$,r$){return r$=r$!=null?r$.concat([e$]):null,ki$2(4194308,4,pi$2.bind(null,t$,e$),r$)},useLayoutEffect:function(e$,t$){return ki$2(4194308,4,e$,t$)},useInsertionEffect:function(e$,t$){return ki$2(4,2,e$,t$)},useMemo:function(e$,t$){var r$=Th$2();return t$=t$===void 0?null:t$,e$=e$(),r$.memoizedState=[e$,t$],e$},useReducer:function(e$,t$,r$){var n$=Th$2();return t$=r$!==void 0?r$(t$):t$,n$.memoizedState=n$.baseState=t$,e$={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e$,lastRenderedState:t$},n$.queue=e$,e$=e$.dispatch=xi$2.bind(null,M$1,e$),[n$.memoizedState,e$]},useRef:function(e$){var t$=Th$2();return e$={current:e$},t$.memoizedState=e$},useState:hi$2,useDebugValue:ri$2,useDeferredValue:function(e$){return Th$2().memoizedState=e$},useTransition:function(){var e$=hi$2(!1),t$=e$[0];return e$=vi$2.bind(null,e$[1]),Th$2().memoizedState=e$,[t$,e$]},useMutableSource:function(){},useSyncExternalStore:function(e$,t$,r$){var n$=M$1,i$=Th$2();if(I$1){if(r$===void 0)throw Error(p$1(407));r$=r$()}else{if(r$=t$(),Q$2===null)throw Error(p$1(349));Hh$2&30||di$2(n$,t$,r$)}i$.memoizedState=r$;var o$={value:r$,getSnapshot:t$};return i$.queue=o$,mi$2(ai$2.bind(null,n$,o$,e$),[e$]),n$.flags|=2048,bi$2(9,ci$2.bind(null,n$,o$,r$,t$),void 0,null),r$},useId:function(){var e$=Th$2(),t$=Q$2.identifierPrefix;if(I$1){var r$=sg$2,n$=rg$2;r$=(n$&~(1<<32-oc$2(n$)-1)).toString(32)+r$,t$=":"+t$+"R"+r$,r$=Kh$2++,0<r$&&(t$+="H"+r$.toString(32)),t$+=":"}else r$=Lh$2++,t$=":"+t$+"r"+r$.toString(32)+":";return e$.memoizedState=t$},unstable_isNewReconciler:!1},Ph$2={readContext:eh$2,useCallback:si$1,useContext:eh$2,useEffect:$h$2,useImperativeHandle:qi$2,useInsertionEffect:ni$2,useLayoutEffect:oi$2,useMemo:ti$2,useReducer:Wh$2,useRef:ji$2,useState:function(){return Wh$2(Vh$2)},useDebugValue:ri$2,useDeferredValue:function(e$){var t$=Uh$2();return ui$2(t$,N$2.memoizedState,e$)},useTransition:function(){var e$=Wh$2(Vh$2)[0],t$=Uh$2().memoizedState;return[e$,t$]},useMutableSource:Yh$2,useSyncExternalStore:Zh$2,useId:wi$2,unstable_isNewReconciler:!1},Qh$2={readContext:eh$2,useCallback:si$1,useContext:eh$2,useEffect:$h$2,useImperativeHandle:qi$2,useInsertionEffect:ni$2,useLayoutEffect:oi$2,useMemo:ti$2,useReducer:Xh$2,useRef:ji$2,useState:function(){return Xh$2(Vh$2)},useDebugValue:ri$2,useDeferredValue:function(e$){var t$=Uh$2();return N$2===null?t$.memoizedState=e$:ui$2(t$,N$2.memoizedState,e$)},useTransition:function(){var e$=Xh$2(Vh$2)[0],t$=Uh$2().memoizedState;return[e$,t$]},useMutableSource:Yh$2,useSyncExternalStore:Zh$2,useId:wi$2,unstable_isNewReconciler:!1};function Ci$2(e$,t$){if(e$&&e$.defaultProps){t$=A$1({},t$),e$=e$.defaultProps;for(var r$ in e$)t$[r$]===void 0&&(t$[r$]=e$[r$]);return t$}return t$}function Di$2(e$,t$,r$,n$){t$=e$.memoizedState,r$=r$(n$,t$),r$=r$==null?t$:A$1({},t$,r$),e$.memoizedState=r$,e$.lanes===0&&(e$.updateQueue.baseState=r$)}var Ei$2={isMounted:function(e$){return(e$=e$._reactInternals)?Vb$2(e$)===e$:!1},enqueueSetState:function(e$,t$,r$){e$=e$._reactInternals;var n$=R$2(),i$=yi$2(e$),o$=mh$2(n$,i$);o$.payload=t$,r$!=null&&(o$.callback=r$),t$=nh$2(e$,o$,i$),t$!==null&&(gi$2(t$,e$,i$,n$),oh$1(t$,e$,i$))},enqueueReplaceState:function(e$,t$,r$){e$=e$._reactInternals;var n$=R$2(),i$=yi$2(e$),o$=mh$2(n$,i$);o$.tag=1,o$.payload=t$,r$!=null&&(o$.callback=r$),t$=nh$2(e$,o$,i$),t$!==null&&(gi$2(t$,e$,i$,n$),oh$1(t$,e$,i$))},enqueueForceUpdate:function(e$,t$){e$=e$._reactInternals;var r$=R$2(),n$=yi$2(e$),i$=mh$2(r$,n$);i$.tag=2,t$!=null&&(i$.callback=t$),t$=nh$2(e$,i$,n$),t$!==null&&(gi$2(t$,e$,n$,r$),oh$1(t$,e$,n$))}};function Fi$2(e$,t$,r$,n$,i$,o$,s$){return e$=e$.stateNode,typeof e$.shouldComponentUpdate=="function"?e$.shouldComponentUpdate(n$,o$,s$):t$.prototype&&t$.prototype.isPureReactComponent?!Ie$2(r$,n$)||!Ie$2(i$,o$):!0}function Gi$2(e$,t$,r$){var n$=!1,i$=Vf$1,o$=t$.contextType;return typeof o$=="object"&&o$!==null?o$=eh$2(o$):(i$=Zf$2(t$)?Xf$2:H$2.current,n$=t$.contextTypes,o$=(n$=n$!=null)?Yf$1(e$,i$):Vf$1),t$=new t$(r$,o$),e$.memoizedState=t$.state!==null&&t$.state!==void 0?t$.state:null,t$.updater=Ei$2,e$.stateNode=t$,t$._reactInternals=e$,n$&&(e$=e$.stateNode,e$.__reactInternalMemoizedUnmaskedChildContext=i$,e$.__reactInternalMemoizedMaskedChildContext=o$),t$}function Hi$2(e$,t$,r$,n$){e$=t$.state,typeof t$.componentWillReceiveProps=="function"&&t$.componentWillReceiveProps(r$,n$),typeof t$.UNSAFE_componentWillReceiveProps=="function"&&t$.UNSAFE_componentWillReceiveProps(r$,n$),t$.state!==e$&&Ei$2.enqueueReplaceState(t$,t$.state,null)}function Ii$2(e$,t$,r$,n$){var i$=e$.stateNode;i$.props=r$,i$.state=e$.memoizedState,i$.refs={},kh$2(e$);var o$=t$.contextType;typeof o$=="object"&&o$!==null?i$.context=eh$2(o$):(o$=Zf$2(t$)?Xf$2:H$2.current,i$.context=Yf$1(e$,o$)),i$.state=e$.memoizedState,o$=t$.getDerivedStateFromProps,typeof o$=="function"&&(Di$2(e$,t$,o$,r$),i$.state=e$.memoizedState),typeof t$.getDerivedStateFromProps=="function"||typeof i$.getSnapshotBeforeUpdate=="function"||typeof i$.UNSAFE_componentWillMount!="function"&&typeof i$.componentWillMount!="function"||(t$=i$.state,typeof i$.componentWillMount=="function"&&i$.componentWillMount(),typeof i$.UNSAFE_componentWillMount=="function"&&i$.UNSAFE_componentWillMount(),t$!==i$.state&&Ei$2.enqueueReplaceState(i$,i$.state,null),qh$2(e$,r$,i$,n$),i$.state=e$.memoizedState),typeof i$.componentDidMount=="function"&&(e$.flags|=4194308)}function Ji$2(e$,t$){try{var r$="",n$=t$;do r$+=Pa$2(n$),n$=n$.return;while(n$);var i$=r$}catch(o$){i$=`
Error generating stack: `+o$.message+`
`+o$.stack}return{value:e$,source:t$,stack:i$,digest:null}}function Ki$1(e$,t$,r$){return{value:e$,source:null,stack:r$??null,digest:t$??null}}function Li$2(e$,t$){try{console.error(t$.value)}catch(r$){setTimeout(function(){throw r$})}}var Mi$2=typeof WeakMap=="function"?WeakMap:Map;function Ni$2(e$,t$,r$){r$=mh$2(-1,r$),r$.tag=3,r$.payload={element:null};var n$=t$.value;return r$.callback=function(){Oi$1||(Oi$1=!0,Pi$2=n$),Li$2(e$,t$)},r$}function Qi$2(e$,t$,r$){r$=mh$2(-1,r$),r$.tag=3;var n$=e$.type.getDerivedStateFromError;if(typeof n$=="function"){var i$=t$.value;r$.payload=function(){return n$(i$)},r$.callback=function(){Li$2(e$,t$)}}var o$=e$.stateNode;return o$!==null&&typeof o$.componentDidCatch=="function"&&(r$.callback=function(){Li$2(e$,t$),typeof n$!="function"&&(Ri$2===null?Ri$2=new Set([this]):Ri$2.add(this));var s$=t$.stack;this.componentDidCatch(t$.value,{componentStack:s$!==null?s$:""})}),r$}function Si$2(e$,t$,r$){var n$=e$.pingCache;if(n$===null){n$=e$.pingCache=new Mi$2;var i$=new Set;n$.set(t$,i$)}else i$=n$.get(t$),i$===void 0&&(i$=new Set,n$.set(t$,i$));i$.has(r$)||(i$.add(r$),e$=Ti$2.bind(null,e$,t$,r$),t$.then(e$,e$))}function Ui$2(e$){do{var t$;if((t$=e$.tag===13)&&(t$=e$.memoizedState,t$=t$!==null?t$.dehydrated!==null:!0),t$)return e$;e$=e$.return}while(e$!==null);return null}function Vi$2(e$,t$,r$,n$,i$){return e$.mode&1?(e$.flags|=65536,e$.lanes=i$,e$):(e$===t$?e$.flags|=65536:(e$.flags|=128,r$.flags|=131072,r$.flags&=-52805,r$.tag===1&&(r$.alternate===null?r$.tag=17:(t$=mh$2(-1,1),t$.tag=2,nh$2(r$,t$,1))),r$.lanes|=1),e$)}var Wi$2=ua$2.ReactCurrentOwner,dh$1=!1;function Xi$2(e$,t$,r$,n$){t$.child=e$===null?Vg$2(t$,null,r$,n$):Ug$2(t$,e$.child,r$,n$)}function Yi$2(e$,t$,r$,n$,i$){r$=r$.render;var o$=t$.ref;return ch$1(t$,i$),n$=Nh$2(e$,t$,r$,n$,o$,i$),r$=Sh$2(),e$!==null&&!dh$1?(t$.updateQueue=e$.updateQueue,t$.flags&=-2053,e$.lanes&=~i$,Zi$2(e$,t$,i$)):(I$1&&r$&&vg$2(t$),t$.flags|=1,Xi$2(e$,t$,n$,i$),t$.child)}function $i$2(e$,t$,r$,n$,i$){if(e$===null){var o$=r$.type;return typeof o$=="function"&&!aj$2(o$)&&o$.defaultProps===void 0&&r$.compare===null&&r$.defaultProps===void 0?(t$.tag=15,t$.type=o$,bj$1(e$,t$,o$,n$,i$)):(e$=Rg$2(r$.type,null,n$,t$,t$.mode,i$),e$.ref=t$.ref,e$.return=t$,t$.child=e$)}if(o$=e$.child,!(e$.lanes&i$)){var s$=o$.memoizedProps;if(r$=r$.compare,r$=r$!==null?r$:Ie$2,r$(s$,n$)&&e$.ref===t$.ref)return Zi$2(e$,t$,i$)}return t$.flags|=1,e$=Pg$2(o$,n$),e$.ref=t$.ref,e$.return=t$,t$.child=e$}function bj$1(e$,t$,r$,n$,i$){if(e$!==null){var o$=e$.memoizedProps;if(Ie$2(o$,n$)&&e$.ref===t$.ref)if(dh$1=!1,t$.pendingProps=n$=o$,(e$.lanes&i$)!==0)e$.flags&131072&&(dh$1=!0);else return t$.lanes=e$.lanes,Zi$2(e$,t$,i$)}return cj$2(e$,t$,r$,n$,i$)}function dj$2(e$,t$,r$){var n$=t$.pendingProps,i$=n$.children,o$=e$!==null?e$.memoizedState:null;if(n$.mode==="hidden")if(!(t$.mode&1))t$.memoizedState={baseLanes:0,cachePool:null,transitions:null},G$2(ej$2,fj$2),fj$2|=r$;else{if(!(r$&1073741824))return e$=o$!==null?o$.baseLanes|r$:r$,t$.lanes=t$.childLanes=1073741824,t$.memoizedState={baseLanes:e$,cachePool:null,transitions:null},t$.updateQueue=null,G$2(ej$2,fj$2),fj$2|=e$,null;t$.memoizedState={baseLanes:0,cachePool:null,transitions:null},n$=o$!==null?o$.baseLanes:r$,G$2(ej$2,fj$2),fj$2|=n$}else o$!==null?(n$=o$.baseLanes|r$,t$.memoizedState=null):n$=r$,G$2(ej$2,fj$2),fj$2|=n$;return Xi$2(e$,t$,i$,r$),t$.child}function gj$2(e$,t$){var r$=t$.ref;(e$===null&&r$!==null||e$!==null&&e$.ref!==r$)&&(t$.flags|=512,t$.flags|=2097152)}function cj$2(e$,t$,r$,n$,i$){var o$=Zf$2(r$)?Xf$2:H$2.current;return o$=Yf$1(t$,o$),ch$1(t$,i$),r$=Nh$2(e$,t$,r$,n$,o$,i$),n$=Sh$2(),e$!==null&&!dh$1?(t$.updateQueue=e$.updateQueue,t$.flags&=-2053,e$.lanes&=~i$,Zi$2(e$,t$,i$)):(I$1&&n$&&vg$2(t$),t$.flags|=1,Xi$2(e$,t$,r$,i$),t$.child)}function hj$2(e$,t$,r$,n$,i$){if(Zf$2(r$)){var o$=!0;cg$2(t$)}else o$=!1;if(ch$1(t$,i$),t$.stateNode===null)ij$2(e$,t$),Gi$2(t$,r$,n$),Ii$2(t$,r$,n$,i$),n$=!0;else if(e$===null){var s$=t$.stateNode,a$=t$.memoizedProps;s$.props=a$;var c$=s$.context,u$=r$.contextType;typeof u$=="object"&&u$!==null?u$=eh$2(u$):(u$=Zf$2(r$)?Xf$2:H$2.current,u$=Yf$1(t$,u$));var l$=r$.getDerivedStateFromProps,d$=typeof l$=="function"||typeof s$.getSnapshotBeforeUpdate=="function";d$||typeof s$.UNSAFE_componentWillReceiveProps!="function"&&typeof s$.componentWillReceiveProps!="function"||(a$!==n$||c$!==u$)&&Hi$2(t$,s$,n$,u$),jh$2=!1;var h$=t$.memoizedState;s$.state=h$,qh$2(t$,n$,s$,i$),c$=t$.memoizedState,a$!==n$||h$!==c$||Wf$1.current||jh$2?(typeof l$=="function"&&(Di$2(t$,r$,l$,n$),c$=t$.memoizedState),(a$=jh$2||Fi$2(t$,r$,a$,n$,h$,c$,u$))?(d$||typeof s$.UNSAFE_componentWillMount!="function"&&typeof s$.componentWillMount!="function"||(typeof s$.componentWillMount=="function"&&s$.componentWillMount(),typeof s$.UNSAFE_componentWillMount=="function"&&s$.UNSAFE_componentWillMount()),typeof s$.componentDidMount=="function"&&(t$.flags|=4194308)):(typeof s$.componentDidMount=="function"&&(t$.flags|=4194308),t$.memoizedProps=n$,t$.memoizedState=c$),s$.props=n$,s$.state=c$,s$.context=u$,n$=a$):(typeof s$.componentDidMount=="function"&&(t$.flags|=4194308),n$=!1)}else{s$=t$.stateNode,lh$1(e$,t$),a$=t$.memoizedProps,u$=t$.type===t$.elementType?a$:Ci$2(t$.type,a$),s$.props=u$,d$=t$.pendingProps,h$=s$.context,c$=r$.contextType,typeof c$=="object"&&c$!==null?c$=eh$2(c$):(c$=Zf$2(r$)?Xf$2:H$2.current,c$=Yf$1(t$,c$));var p$=r$.getDerivedStateFromProps;(l$=typeof p$=="function"||typeof s$.getSnapshotBeforeUpdate=="function")||typeof s$.UNSAFE_componentWillReceiveProps!="function"&&typeof s$.componentWillReceiveProps!="function"||(a$!==d$||h$!==c$)&&Hi$2(t$,s$,n$,c$),jh$2=!1,h$=t$.memoizedState,s$.state=h$,qh$2(t$,n$,s$,i$);var _$=t$.memoizedState;a$!==d$||h$!==_$||Wf$1.current||jh$2?(typeof p$=="function"&&(Di$2(t$,r$,p$,n$),_$=t$.memoizedState),(u$=jh$2||Fi$2(t$,r$,u$,n$,h$,_$,c$)||!1)?(l$||typeof s$.UNSAFE_componentWillUpdate!="function"&&typeof s$.componentWillUpdate!="function"||(typeof s$.componentWillUpdate=="function"&&s$.componentWillUpdate(n$,_$,c$),typeof s$.UNSAFE_componentWillUpdate=="function"&&s$.UNSAFE_componentWillUpdate(n$,_$,c$)),typeof s$.componentDidUpdate=="function"&&(t$.flags|=4),typeof s$.getSnapshotBeforeUpdate=="function"&&(t$.flags|=1024)):(typeof s$.componentDidUpdate!="function"||a$===e$.memoizedProps&&h$===e$.memoizedState||(t$.flags|=4),typeof s$.getSnapshotBeforeUpdate!="function"||a$===e$.memoizedProps&&h$===e$.memoizedState||(t$.flags|=1024),t$.memoizedProps=n$,t$.memoizedState=_$),s$.props=n$,s$.state=_$,s$.context=c$,n$=u$):(typeof s$.componentDidUpdate!="function"||a$===e$.memoizedProps&&h$===e$.memoizedState||(t$.flags|=4),typeof s$.getSnapshotBeforeUpdate!="function"||a$===e$.memoizedProps&&h$===e$.memoizedState||(t$.flags|=1024),n$=!1)}return jj$2(e$,t$,r$,n$,o$,i$)}function jj$2(e$,t$,r$,n$,i$,o$){gj$2(e$,t$);var s$=(t$.flags&128)!==0;if(!n$&&!s$)return i$&&dg$2(t$,r$,!1),Zi$2(e$,t$,o$);n$=t$.stateNode,Wi$2.current=t$;var a$=s$&&typeof r$.getDerivedStateFromError!="function"?null:n$.render();return t$.flags|=1,e$!==null&&s$?(t$.child=Ug$2(t$,e$.child,null,o$),t$.child=Ug$2(t$,null,a$,o$)):Xi$2(e$,t$,a$,o$),t$.memoizedState=n$.state,i$&&dg$2(t$,r$,!0),t$.child}function kj$2(e$){var t$=e$.stateNode;t$.pendingContext?ag$2(e$,t$.pendingContext,t$.pendingContext!==t$.context):t$.context&&ag$2(e$,t$.context,!1),yh$2(e$,t$.containerInfo)}function lj$2(e$,t$,r$,n$,i$){return Ig$2(),Jg$2(i$),t$.flags|=256,Xi$2(e$,t$,r$,n$),t$.child}var mj$2={dehydrated:null,treeContext:null,retryLane:0};function nj$2(e$){return{baseLanes:e$,cachePool:null,transitions:null}}function oj$2(e$,t$,r$){var n$=t$.pendingProps,i$=L$1.current,o$=!1,s$=(t$.flags&128)!==0,a$;if((a$=s$)||(a$=e$!==null&&e$.memoizedState===null?!1:(i$&2)!==0),a$?(o$=!0,t$.flags&=-129):(e$===null||e$.memoizedState!==null)&&(i$|=1),G$2(L$1,i$&1),e$===null)return Eg$2(t$),e$=t$.memoizedState,e$!==null&&(e$=e$.dehydrated,e$!==null)?(t$.mode&1?e$.data==="$!"?t$.lanes=8:t$.lanes=1073741824:t$.lanes=1,null):(s$=n$.children,e$=n$.fallback,o$?(n$=t$.mode,o$=t$.child,s$={mode:"hidden",children:s$},!(n$&1)&&o$!==null?(o$.childLanes=0,o$.pendingProps=s$):o$=pj$2(s$,n$,0,null),e$=Tg$2(e$,n$,r$,null),o$.return=t$,e$.return=t$,o$.sibling=e$,t$.child=o$,t$.child.memoizedState=nj$2(r$),t$.memoizedState=mj$2,e$):qj$2(t$,s$));if(i$=e$.memoizedState,i$!==null&&(a$=i$.dehydrated,a$!==null))return rj$2(e$,t$,s$,n$,a$,i$,r$);if(o$){o$=n$.fallback,s$=t$.mode,i$=e$.child,a$=i$.sibling;var c$={mode:"hidden",children:n$.children};return!(s$&1)&&t$.child!==i$?(n$=t$.child,n$.childLanes=0,n$.pendingProps=c$,t$.deletions=null):(n$=Pg$2(i$,c$),n$.subtreeFlags=i$.subtreeFlags&14680064),a$!==null?o$=Pg$2(a$,o$):(o$=Tg$2(o$,s$,r$,null),o$.flags|=2),o$.return=t$,n$.return=t$,n$.sibling=o$,t$.child=n$,n$=o$,o$=t$.child,s$=e$.child.memoizedState,s$=s$===null?nj$2(r$):{baseLanes:s$.baseLanes|r$,cachePool:null,transitions:s$.transitions},o$.memoizedState=s$,o$.childLanes=e$.childLanes&~r$,t$.memoizedState=mj$2,n$}return o$=e$.child,e$=o$.sibling,n$=Pg$2(o$,{mode:"visible",children:n$.children}),!(t$.mode&1)&&(n$.lanes=r$),n$.return=t$,n$.sibling=null,e$!==null&&(r$=t$.deletions,r$===null?(t$.deletions=[e$],t$.flags|=16):r$.push(e$)),t$.child=n$,t$.memoizedState=null,n$}function qj$2(e$,t$){return t$=pj$2({mode:"visible",children:t$},e$.mode,0,null),t$.return=e$,e$.child=t$}function sj$2(e$,t$,r$,n$){return n$!==null&&Jg$2(n$),Ug$2(t$,e$.child,null,r$),e$=qj$2(t$,t$.pendingProps.children),e$.flags|=2,t$.memoizedState=null,e$}function rj$2(e$,t$,r$,n$,i$,o$,s$){if(r$)return t$.flags&256?(t$.flags&=-257,n$=Ki$1(Error(p$1(422))),sj$2(e$,t$,s$,n$)):t$.memoizedState!==null?(t$.child=e$.child,t$.flags|=128,null):(o$=n$.fallback,i$=t$.mode,n$=pj$2({mode:"visible",children:n$.children},i$,0,null),o$=Tg$2(o$,i$,s$,null),o$.flags|=2,n$.return=t$,o$.return=t$,n$.sibling=o$,t$.child=n$,t$.mode&1&&Ug$2(t$,e$.child,null,s$),t$.child.memoizedState=nj$2(s$),t$.memoizedState=mj$2,o$);if(!(t$.mode&1))return sj$2(e$,t$,s$,null);if(i$.data==="$!"){if(n$=i$.nextSibling&&i$.nextSibling.dataset,n$)var a$=n$.dgst;return n$=a$,o$=Error(p$1(419)),n$=Ki$1(o$,n$,void 0),sj$2(e$,t$,s$,n$)}if(a$=(s$&e$.childLanes)!==0,dh$1||a$){if(n$=Q$2,n$!==null){switch(s$&-s$){case 4:i$=2;break;case 16:i$=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i$=32;break;case 536870912:i$=268435456;break;default:i$=0}i$=i$&(n$.suspendedLanes|s$)?0:i$,i$!==0&&i$!==o$.retryLane&&(o$.retryLane=i$,ih$1(e$,i$),gi$2(n$,e$,i$,-1))}return tj$2(),n$=Ki$1(Error(p$1(421))),sj$2(e$,t$,s$,n$)}return i$.data==="$?"?(t$.flags|=128,t$.child=e$.child,t$=uj$2.bind(null,e$),i$._reactRetry=t$,null):(e$=o$.treeContext,yg$2=Lf$2(i$.nextSibling),xg$2=t$,I$1=!0,zg$2=null,e$!==null&&(og$2[pg$2++]=rg$2,og$2[pg$2++]=sg$2,og$2[pg$2++]=qg$2,rg$2=e$.id,sg$2=e$.overflow,qg$2=t$),t$=qj$2(t$,n$.children),t$.flags|=4096,t$)}function vj$2(e$,t$,r$){e$.lanes|=t$;var n$=e$.alternate;n$!==null&&(n$.lanes|=t$),bh$2(e$.return,t$,r$)}function wj$2(e$,t$,r$,n$,i$){var o$=e$.memoizedState;o$===null?e$.memoizedState={isBackwards:t$,rendering:null,renderingStartTime:0,last:n$,tail:r$,tailMode:i$}:(o$.isBackwards=t$,o$.rendering=null,o$.renderingStartTime=0,o$.last=n$,o$.tail=r$,o$.tailMode=i$)}function xj$2(e$,t$,r$){var n$=t$.pendingProps,i$=n$.revealOrder,o$=n$.tail;if(Xi$2(e$,t$,n$.children,r$),n$=L$1.current,n$&2)n$=n$&1|2,t$.flags|=128;else{if(e$!==null&&e$.flags&128)e:for(e$=t$.child;e$!==null;){if(e$.tag===13)e$.memoizedState!==null&&vj$2(e$,r$,t$);else if(e$.tag===19)vj$2(e$,r$,t$);else if(e$.child!==null){e$.child.return=e$,e$=e$.child;continue}if(e$===t$)break e;for(;e$.sibling===null;){if(e$.return===null||e$.return===t$)break e;e$=e$.return}e$.sibling.return=e$.return,e$=e$.sibling}n$&=1}if(G$2(L$1,n$),!(t$.mode&1))t$.memoizedState=null;else switch(i$){case"forwards":for(r$=t$.child,i$=null;r$!==null;)e$=r$.alternate,e$!==null&&Ch$2(e$)===null&&(i$=r$),r$=r$.sibling;r$=i$,r$===null?(i$=t$.child,t$.child=null):(i$=r$.sibling,r$.sibling=null),wj$2(t$,!1,i$,r$,o$);break;case"backwards":for(r$=null,i$=t$.child,t$.child=null;i$!==null;){if(e$=i$.alternate,e$!==null&&Ch$2(e$)===null){t$.child=i$;break}e$=i$.sibling,i$.sibling=r$,r$=i$,i$=e$}wj$2(t$,!0,r$,null,o$);break;case"together":wj$2(t$,!1,null,null,void 0);break;default:t$.memoizedState=null}return t$.child}function ij$2(e$,t$){!(t$.mode&1)&&e$!==null&&(e$.alternate=null,t$.alternate=null,t$.flags|=2)}function Zi$2(e$,t$,r$){if(e$!==null&&(t$.dependencies=e$.dependencies),rh$1|=t$.lanes,!(r$&t$.childLanes))return null;if(e$!==null&&t$.child!==e$.child)throw Error(p$1(153));if(t$.child!==null){for(e$=t$.child,r$=Pg$2(e$,e$.pendingProps),t$.child=r$,r$.return=t$;e$.sibling!==null;)e$=e$.sibling,r$=r$.sibling=Pg$2(e$,e$.pendingProps),r$.return=t$;r$.sibling=null}return t$.child}function yj$2(e$,t$,r$){switch(t$.tag){case 3:kj$2(t$),Ig$2();break;case 5:Ah$2(t$);break;case 1:Zf$2(t$.type)&&cg$2(t$);break;case 4:yh$2(t$,t$.stateNode.containerInfo);break;case 10:var n$=t$.type._context,i$=t$.memoizedProps.value;G$2(Wg$2,n$._currentValue),n$._currentValue=i$;break;case 13:if(n$=t$.memoizedState,n$!==null)return n$.dehydrated!==null?(G$2(L$1,L$1.current&1),t$.flags|=128,null):r$&t$.child.childLanes?oj$2(e$,t$,r$):(G$2(L$1,L$1.current&1),e$=Zi$2(e$,t$,r$),e$!==null?e$.sibling:null);G$2(L$1,L$1.current&1);break;case 19:if(n$=(r$&t$.childLanes)!==0,e$.flags&128){if(n$)return xj$2(e$,t$,r$);t$.flags|=128}if(i$=t$.memoizedState,i$!==null&&(i$.rendering=null,i$.tail=null,i$.lastEffect=null),G$2(L$1,L$1.current),n$)break;return null;case 22:case 23:return t$.lanes=0,dj$2(e$,t$,r$)}return Zi$2(e$,t$,r$)}var zj$2,Aj$2,Bj$2,Cj$2;zj$2=function(e$,t$){for(var r$=t$.child;r$!==null;){if(r$.tag===5||r$.tag===6)e$.appendChild(r$.stateNode);else if(r$.tag!==4&&r$.child!==null){r$.child.return=r$,r$=r$.child;continue}if(r$===t$)break;for(;r$.sibling===null;){if(r$.return===null||r$.return===t$)return;r$=r$.return}r$.sibling.return=r$.return,r$=r$.sibling}};Aj$2=function(){};Bj$2=function(e$,t$,r$,n$){var i$=e$.memoizedProps;if(i$!==n$){e$=t$.stateNode,xh$2(uh$2.current);var o$=null;switch(r$){case"input":i$=Ya$2(e$,i$),n$=Ya$2(e$,n$),o$=[];break;case"select":i$=A$1({},i$,{value:void 0}),n$=A$1({},n$,{value:void 0}),o$=[];break;case"textarea":i$=gb$2(e$,i$),n$=gb$2(e$,n$),o$=[];break;default:typeof i$.onClick!="function"&&typeof n$.onClick=="function"&&(e$.onclick=Bf$1)}ub$2(r$,n$);var s$;r$=null;for(u$ in i$)if(!n$.hasOwnProperty(u$)&&i$.hasOwnProperty(u$)&&i$[u$]!=null)if(u$==="style"){var a$=i$[u$];for(s$ in a$)a$.hasOwnProperty(s$)&&(r$||(r$={}),r$[s$]="")}else u$!=="dangerouslySetInnerHTML"&&u$!=="children"&&u$!=="suppressContentEditableWarning"&&u$!=="suppressHydrationWarning"&&u$!=="autoFocus"&&(ea$2.hasOwnProperty(u$)?o$||(o$=[]):(o$=o$||[]).push(u$,null));for(u$ in n$){var c$=n$[u$];if(a$=i$!=null?i$[u$]:void 0,n$.hasOwnProperty(u$)&&c$!==a$&&(c$!=null||a$!=null))if(u$==="style")if(a$){for(s$ in a$)!a$.hasOwnProperty(s$)||c$&&c$.hasOwnProperty(s$)||(r$||(r$={}),r$[s$]="");for(s$ in c$)c$.hasOwnProperty(s$)&&a$[s$]!==c$[s$]&&(r$||(r$={}),r$[s$]=c$[s$])}else r$||(o$||(o$=[]),o$.push(u$,r$)),r$=c$;else u$==="dangerouslySetInnerHTML"?(c$=c$?c$.__html:void 0,a$=a$?a$.__html:void 0,c$!=null&&a$!==c$&&(o$=o$||[]).push(u$,c$)):u$==="children"?typeof c$!="string"&&typeof c$!="number"||(o$=o$||[]).push(u$,""+c$):u$!=="suppressContentEditableWarning"&&u$!=="suppressHydrationWarning"&&(ea$2.hasOwnProperty(u$)?(c$!=null&&u$==="onScroll"&&D$1("scroll",e$),o$||a$===c$||(o$=[])):(o$=o$||[]).push(u$,c$))}r$&&(o$=o$||[]).push("style",r$);var u$=o$;(t$.updateQueue=u$)&&(t$.flags|=4)}};Cj$2=function(e$,t$,r$,n$){r$!==n$&&(t$.flags|=4)};function Dj$2(e$,t$){if(!I$1)switch(e$.tailMode){case"hidden":t$=e$.tail;for(var r$=null;t$!==null;)t$.alternate!==null&&(r$=t$),t$=t$.sibling;r$===null?e$.tail=null:r$.sibling=null;break;case"collapsed":r$=e$.tail;for(var n$=null;r$!==null;)r$.alternate!==null&&(n$=r$),r$=r$.sibling;n$===null?t$||e$.tail===null?e$.tail=null:e$.tail.sibling=null:n$.sibling=null}}function S$1(e$){var t$=e$.alternate!==null&&e$.alternate.child===e$.child,r$=0,n$=0;if(t$)for(var i$=e$.child;i$!==null;)r$|=i$.lanes|i$.childLanes,n$|=i$.subtreeFlags&14680064,n$|=i$.flags&14680064,i$.return=e$,i$=i$.sibling;else for(i$=e$.child;i$!==null;)r$|=i$.lanes|i$.childLanes,n$|=i$.subtreeFlags,n$|=i$.flags,i$.return=e$,i$=i$.sibling;return e$.subtreeFlags|=n$,e$.childLanes=r$,t$}function Ej$2(e$,t$,r$){var n$=t$.pendingProps;switch(wg$2(t$),t$.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$1(t$),null;case 1:return Zf$2(t$.type)&&$f$2(),S$1(t$),null;case 3:return n$=t$.stateNode,zh$2(),E$1(Wf$1),E$1(H$2),Eh$2(),n$.pendingContext&&(n$.context=n$.pendingContext,n$.pendingContext=null),(e$===null||e$.child===null)&&(Gg$2(t$)?t$.flags|=4:e$===null||e$.memoizedState.isDehydrated&&!(t$.flags&256)||(t$.flags|=1024,zg$2!==null&&(Fj$2(zg$2),zg$2=null))),Aj$2(e$,t$),S$1(t$),null;case 5:Bh$2(t$);var i$=xh$2(wh$2.current);if(r$=t$.type,e$!==null&&t$.stateNode!=null)Bj$2(e$,t$,r$,n$,i$),e$.ref!==t$.ref&&(t$.flags|=512,t$.flags|=2097152);else{if(!n$){if(t$.stateNode===null)throw Error(p$1(166));return S$1(t$),null}if(e$=xh$2(uh$2.current),Gg$2(t$)){n$=t$.stateNode,r$=t$.type;var o$=t$.memoizedProps;switch(n$[Of$2]=t$,n$[Pf$2]=o$,e$=(t$.mode&1)!==0,r$){case"dialog":D$1("cancel",n$),D$1("close",n$);break;case"iframe":case"object":case"embed":D$1("load",n$);break;case"video":case"audio":for(i$=0;i$<lf$2.length;i$++)D$1(lf$2[i$],n$);break;case"source":D$1("error",n$);break;case"img":case"image":case"link":D$1("error",n$),D$1("load",n$);break;case"details":D$1("toggle",n$);break;case"input":Za$2(n$,o$),D$1("invalid",n$);break;case"select":n$._wrapperState={wasMultiple:!!o$.multiple},D$1("invalid",n$);break;case"textarea":hb$2(n$,o$),D$1("invalid",n$)}ub$2(r$,o$),i$=null;for(var s$ in o$)if(o$.hasOwnProperty(s$)){var a$=o$[s$];s$==="children"?typeof a$=="string"?n$.textContent!==a$&&(o$.suppressHydrationWarning!==!0&&Af$2(n$.textContent,a$,e$),i$=["children",a$]):typeof a$=="number"&&n$.textContent!==""+a$&&(o$.suppressHydrationWarning!==!0&&Af$2(n$.textContent,a$,e$),i$=["children",""+a$]):ea$2.hasOwnProperty(s$)&&a$!=null&&s$==="onScroll"&&D$1("scroll",n$)}switch(r$){case"input":Va$2(n$),db$2(n$,o$,!0);break;case"textarea":Va$2(n$),jb$2(n$);break;case"select":case"option":break;default:typeof o$.onClick=="function"&&(n$.onclick=Bf$1)}n$=i$,t$.updateQueue=n$,n$!==null&&(t$.flags|=4)}else{s$=i$.nodeType===9?i$:i$.ownerDocument,e$==="http://www.w3.org/1999/xhtml"&&(e$=kb$2(r$)),e$==="http://www.w3.org/1999/xhtml"?r$==="script"?(e$=s$.createElement("div"),e$.innerHTML="<script><\/script>",e$=e$.removeChild(e$.firstChild)):typeof n$.is=="string"?e$=s$.createElement(r$,{is:n$.is}):(e$=s$.createElement(r$),r$==="select"&&(s$=e$,n$.multiple?s$.multiple=!0:n$.size&&(s$.size=n$.size))):e$=s$.createElementNS(e$,r$),e$[Of$2]=t$,e$[Pf$2]=n$,zj$2(e$,t$,!1,!1),t$.stateNode=e$;e:{switch(s$=vb$2(r$,n$),r$){case"dialog":D$1("cancel",e$),D$1("close",e$),i$=n$;break;case"iframe":case"object":case"embed":D$1("load",e$),i$=n$;break;case"video":case"audio":for(i$=0;i$<lf$2.length;i$++)D$1(lf$2[i$],e$);i$=n$;break;case"source":D$1("error",e$),i$=n$;break;case"img":case"image":case"link":D$1("error",e$),D$1("load",e$),i$=n$;break;case"details":D$1("toggle",e$),i$=n$;break;case"input":Za$2(e$,n$),i$=Ya$2(e$,n$),D$1("invalid",e$);break;case"option":i$=n$;break;case"select":e$._wrapperState={wasMultiple:!!n$.multiple},i$=A$1({},n$,{value:void 0}),D$1("invalid",e$);break;case"textarea":hb$2(e$,n$),i$=gb$2(e$,n$),D$1("invalid",e$);break;default:i$=n$}ub$2(r$,i$),a$=i$;for(o$ in a$)if(a$.hasOwnProperty(o$)){var c$=a$[o$];o$==="style"?sb$2(e$,c$):o$==="dangerouslySetInnerHTML"?(c$=c$?c$.__html:void 0,c$!=null&&nb$2(e$,c$)):o$==="children"?typeof c$=="string"?(r$!=="textarea"||c$!=="")&&ob$2(e$,c$):typeof c$=="number"&&ob$2(e$,""+c$):o$!=="suppressContentEditableWarning"&&o$!=="suppressHydrationWarning"&&o$!=="autoFocus"&&(ea$2.hasOwnProperty(o$)?c$!=null&&o$==="onScroll"&&D$1("scroll",e$):c$!=null&&ta$2(e$,o$,c$,s$))}switch(r$){case"input":Va$2(e$),db$2(e$,n$,!1);break;case"textarea":Va$2(e$),jb$2(e$);break;case"option":n$.value!=null&&e$.setAttribute("value",""+Sa$2(n$.value));break;case"select":e$.multiple=!!n$.multiple,o$=n$.value,o$!=null?fb$2(e$,!!n$.multiple,o$,!1):n$.defaultValue!=null&&fb$2(e$,!!n$.multiple,n$.defaultValue,!0);break;default:typeof i$.onClick=="function"&&(e$.onclick=Bf$1)}switch(r$){case"button":case"input":case"select":case"textarea":n$=!!n$.autoFocus;break e;case"img":n$=!0;break e;default:n$=!1}}n$&&(t$.flags|=4)}t$.ref!==null&&(t$.flags|=512,t$.flags|=2097152)}return S$1(t$),null;case 6:if(e$&&t$.stateNode!=null)Cj$2(e$,t$,e$.memoizedProps,n$);else{if(typeof n$!="string"&&t$.stateNode===null)throw Error(p$1(166));if(r$=xh$2(wh$2.current),xh$2(uh$2.current),Gg$2(t$)){if(n$=t$.stateNode,r$=t$.memoizedProps,n$[Of$2]=t$,(o$=n$.nodeValue!==r$)&&(e$=xg$2,e$!==null))switch(e$.tag){case 3:Af$2(n$.nodeValue,r$,(e$.mode&1)!==0);break;case 5:e$.memoizedProps.suppressHydrationWarning!==!0&&Af$2(n$.nodeValue,r$,(e$.mode&1)!==0)}o$&&(t$.flags|=4)}else n$=(r$.nodeType===9?r$:r$.ownerDocument).createTextNode(n$),n$[Of$2]=t$,t$.stateNode=n$}return S$1(t$),null;case 13:if(E$1(L$1),n$=t$.memoizedState,e$===null||e$.memoizedState!==null&&e$.memoizedState.dehydrated!==null){if(I$1&&yg$2!==null&&t$.mode&1&&!(t$.flags&128))Hg$2(),Ig$2(),t$.flags|=98560,o$=!1;else if(o$=Gg$2(t$),n$!==null&&n$.dehydrated!==null){if(e$===null){if(!o$)throw Error(p$1(318));if(o$=t$.memoizedState,o$=o$!==null?o$.dehydrated:null,!o$)throw Error(p$1(317));o$[Of$2]=t$}else Ig$2(),!(t$.flags&128)&&(t$.memoizedState=null),t$.flags|=4;S$1(t$),o$=!1}else zg$2!==null&&(Fj$2(zg$2),zg$2=null),o$=!0;if(!o$)return t$.flags&65536?t$:null}return t$.flags&128?(t$.lanes=r$,t$):(n$=n$!==null,n$!==(e$!==null&&e$.memoizedState!==null)&&n$&&(t$.child.flags|=8192,t$.mode&1&&(e$===null||L$1.current&1?T$2===0&&(T$2=3):tj$2())),t$.updateQueue!==null&&(t$.flags|=4),S$1(t$),null);case 4:return zh$2(),Aj$2(e$,t$),e$===null&&sf$2(t$.stateNode.containerInfo),S$1(t$),null;case 10:return ah$1(t$.type._context),S$1(t$),null;case 17:return Zf$2(t$.type)&&$f$2(),S$1(t$),null;case 19:if(E$1(L$1),o$=t$.memoizedState,o$===null)return S$1(t$),null;if(n$=(t$.flags&128)!==0,s$=o$.rendering,s$===null)if(n$)Dj$2(o$,!1);else{if(T$2!==0||e$!==null&&e$.flags&128)for(e$=t$.child;e$!==null;){if(s$=Ch$2(e$),s$!==null){for(t$.flags|=128,Dj$2(o$,!1),n$=s$.updateQueue,n$!==null&&(t$.updateQueue=n$,t$.flags|=4),t$.subtreeFlags=0,n$=r$,r$=t$.child;r$!==null;)o$=r$,e$=n$,o$.flags&=14680066,s$=o$.alternate,s$===null?(o$.childLanes=0,o$.lanes=e$,o$.child=null,o$.subtreeFlags=0,o$.memoizedProps=null,o$.memoizedState=null,o$.updateQueue=null,o$.dependencies=null,o$.stateNode=null):(o$.childLanes=s$.childLanes,o$.lanes=s$.lanes,o$.child=s$.child,o$.subtreeFlags=0,o$.deletions=null,o$.memoizedProps=s$.memoizedProps,o$.memoizedState=s$.memoizedState,o$.updateQueue=s$.updateQueue,o$.type=s$.type,e$=s$.dependencies,o$.dependencies=e$===null?null:{lanes:e$.lanes,firstContext:e$.firstContext}),r$=r$.sibling;return G$2(L$1,L$1.current&1|2),t$.child}e$=e$.sibling}o$.tail!==null&&B$1()>Gj$2&&(t$.flags|=128,n$=!0,Dj$2(o$,!1),t$.lanes=4194304)}else{if(!n$)if(e$=Ch$2(s$),e$!==null){if(t$.flags|=128,n$=!0,r$=e$.updateQueue,r$!==null&&(t$.updateQueue=r$,t$.flags|=4),Dj$2(o$,!0),o$.tail===null&&o$.tailMode==="hidden"&&!s$.alternate&&!I$1)return S$1(t$),null}else 2*B$1()-o$.renderingStartTime>Gj$2&&r$!==1073741824&&(t$.flags|=128,n$=!0,Dj$2(o$,!1),t$.lanes=4194304);o$.isBackwards?(s$.sibling=t$.child,t$.child=s$):(r$=o$.last,r$!==null?r$.sibling=s$:t$.child=s$,o$.last=s$)}return o$.tail!==null?(t$=o$.tail,o$.rendering=t$,o$.tail=t$.sibling,o$.renderingStartTime=B$1(),t$.sibling=null,r$=L$1.current,G$2(L$1,n$?r$&1|2:r$&1),t$):(S$1(t$),null);case 22:case 23:return Hj$2(),n$=t$.memoizedState!==null,e$!==null&&e$.memoizedState!==null!==n$&&(t$.flags|=8192),n$&&t$.mode&1?fj$2&1073741824&&(S$1(t$),t$.subtreeFlags&6&&(t$.flags|=8192)):S$1(t$),null;case 24:return null;case 25:return null}throw Error(p$1(156,t$.tag))}function Ij$1(e$,t$){switch(wg$2(t$),t$.tag){case 1:return Zf$2(t$.type)&&$f$2(),e$=t$.flags,e$&65536?(t$.flags=e$&-65537|128,t$):null;case 3:return zh$2(),E$1(Wf$1),E$1(H$2),Eh$2(),e$=t$.flags,e$&65536&&!(e$&128)?(t$.flags=e$&-65537|128,t$):null;case 5:return Bh$2(t$),null;case 13:if(E$1(L$1),e$=t$.memoizedState,e$!==null&&e$.dehydrated!==null){if(t$.alternate===null)throw Error(p$1(340));Ig$2()}return e$=t$.flags,e$&65536?(t$.flags=e$&-65537|128,t$):null;case 19:return E$1(L$1),null;case 4:return zh$2(),null;case 10:return ah$1(t$.type._context),null;case 22:case 23:return Hj$2(),null;case 24:return null;default:return null}}var Jj$2=!1,U$2=!1,Kj$2=typeof WeakSet=="function"?WeakSet:Set,V$1=null;function Lj$2(e$,t$){var r$=e$.ref;if(r$!==null)if(typeof r$=="function")try{r$(null)}catch(n$){W$2(e$,t$,n$)}else r$.current=null}function Mj$2(e$,t$,r$){try{r$()}catch(n$){W$2(e$,t$,n$)}}var Nj$2=!1;function Oj$2(e$,t$){if(Cf$2=dd$2,e$=Me$2(),Ne$2(e$)){if("selectionStart"in e$)var r$={start:e$.selectionStart,end:e$.selectionEnd};else e:{r$=(r$=e$.ownerDocument)&&r$.defaultView||window;var n$=r$.getSelection&&r$.getSelection();if(n$&&n$.rangeCount!==0){r$=n$.anchorNode;var i$=n$.anchorOffset,o$=n$.focusNode;n$=n$.focusOffset;try{r$.nodeType,o$.nodeType}catch{r$=null;break e}var s$=0,a$=-1,c$=-1,u$=0,l$=0,d$=e$,h$=null;t:for(;;){for(var p$;d$!==r$||i$!==0&&d$.nodeType!==3||(a$=s$+i$),d$!==o$||n$!==0&&d$.nodeType!==3||(c$=s$+n$),d$.nodeType===3&&(s$+=d$.nodeValue.length),(p$=d$.firstChild)!==null;)h$=d$,d$=p$;for(;;){if(d$===e$)break t;if(h$===r$&&++u$===i$&&(a$=s$),h$===o$&&++l$===n$&&(c$=s$),(p$=d$.nextSibling)!==null)break;d$=h$,h$=d$.parentNode}d$=p$}r$=a$===-1||c$===-1?null:{start:a$,end:c$}}else r$=null}r$=r$||{start:0,end:0}}else r$=null;for(Df$2={focusedElem:e$,selectionRange:r$},dd$2=!1,V$1=t$;V$1!==null;)if(t$=V$1,e$=t$.child,(t$.subtreeFlags&1028)!==0&&e$!==null)e$.return=t$,V$1=e$;else for(;V$1!==null;){t$=V$1;try{var _$=t$.alternate;if(t$.flags&1024)switch(t$.tag){case 0:case 11:case 15:break;case 1:if(_$!==null){var f$=_$.memoizedProps,m$=_$.memoizedState,g$=t$.stateNode,v$=g$.getSnapshotBeforeUpdate(t$.elementType===t$.type?f$:Ci$2(t$.type,f$),m$);g$.__reactInternalSnapshotBeforeUpdate=v$}break;case 3:var y$=t$.stateNode.containerInfo;y$.nodeType===1?y$.textContent="":y$.nodeType===9&&y$.documentElement&&y$.removeChild(y$.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$1(163))}}catch(S$){W$2(t$,t$.return,S$)}if(e$=t$.sibling,e$!==null){e$.return=t$.return,V$1=e$;break}V$1=t$.return}return _$=Nj$2,Nj$2=!1,_$}function Pj$2(e$,t$,r$){var n$=t$.updateQueue;if(n$=n$!==null?n$.lastEffect:null,n$!==null){var i$=n$=n$.next;do{if((i$.tag&e$)===e$){var o$=i$.destroy;i$.destroy=void 0,o$!==void 0&&Mj$2(t$,r$,o$)}i$=i$.next}while(i$!==n$)}}function Qj$2(e$,t$){if(t$=t$.updateQueue,t$=t$!==null?t$.lastEffect:null,t$!==null){var r$=t$=t$.next;do{if((r$.tag&e$)===e$){var n$=r$.create;r$.destroy=n$()}r$=r$.next}while(r$!==t$)}}function Rj$2(e$){var t$=e$.ref;if(t$!==null){var r$=e$.stateNode;switch(e$.tag){case 5:e$=r$;break;default:e$=r$}typeof t$=="function"?t$(e$):t$.current=e$}}function Sj$2(e$){var t$=e$.alternate;t$!==null&&(e$.alternate=null,Sj$2(t$)),e$.child=null,e$.deletions=null,e$.sibling=null,e$.tag===5&&(t$=e$.stateNode,t$!==null&&(delete t$[Of$2],delete t$[Pf$2],delete t$[of$2],delete t$[Qf$2],delete t$[Rf$2])),e$.stateNode=null,e$.return=null,e$.dependencies=null,e$.memoizedProps=null,e$.memoizedState=null,e$.pendingProps=null,e$.stateNode=null,e$.updateQueue=null}function Tj$2(e$){return e$.tag===5||e$.tag===3||e$.tag===4}function Uj$2(e$){e:for(;;){for(;e$.sibling===null;){if(e$.return===null||Tj$2(e$.return))return null;e$=e$.return}for(e$.sibling.return=e$.return,e$=e$.sibling;e$.tag!==5&&e$.tag!==6&&e$.tag!==18;){if(e$.flags&2||e$.child===null||e$.tag===4)continue e;e$.child.return=e$,e$=e$.child}if(!(e$.flags&2))return e$.stateNode}}function Vj$2(e$,t$,r$){var n$=e$.tag;if(n$===5||n$===6)e$=e$.stateNode,t$?r$.nodeType===8?r$.parentNode.insertBefore(e$,t$):r$.insertBefore(e$,t$):(r$.nodeType===8?(t$=r$.parentNode,t$.insertBefore(e$,r$)):(t$=r$,t$.appendChild(e$)),r$=r$._reactRootContainer,r$!=null||t$.onclick!==null||(t$.onclick=Bf$1));else if(n$!==4&&(e$=e$.child,e$!==null))for(Vj$2(e$,t$,r$),e$=e$.sibling;e$!==null;)Vj$2(e$,t$,r$),e$=e$.sibling}function Wj$2(e$,t$,r$){var n$=e$.tag;if(n$===5||n$===6)e$=e$.stateNode,t$?r$.insertBefore(e$,t$):r$.appendChild(e$);else if(n$!==4&&(e$=e$.child,e$!==null))for(Wj$2(e$,t$,r$),e$=e$.sibling;e$!==null;)Wj$2(e$,t$,r$),e$=e$.sibling}var X$2=null,Xj$2=!1;function Yj$2(e$,t$,r$){for(r$=r$.child;r$!==null;)Zj$2(e$,t$,r$),r$=r$.sibling}function Zj$2(e$,t$,r$){if(lc$2&&typeof lc$2.onCommitFiberUnmount=="function")try{lc$2.onCommitFiberUnmount(kc$2,r$)}catch{}switch(r$.tag){case 5:U$2||Lj$2(r$,t$);case 6:var n$=X$2,i$=Xj$2;X$2=null,Yj$2(e$,t$,r$),X$2=n$,Xj$2=i$,X$2!==null&&(Xj$2?(e$=X$2,r$=r$.stateNode,e$.nodeType===8?e$.parentNode.removeChild(r$):e$.removeChild(r$)):X$2.removeChild(r$.stateNode));break;case 18:X$2!==null&&(Xj$2?(e$=X$2,r$=r$.stateNode,e$.nodeType===8?Kf$1(e$.parentNode,r$):e$.nodeType===1&&Kf$1(e$,r$),bd$2(e$)):Kf$1(X$2,r$.stateNode));break;case 4:n$=X$2,i$=Xj$2,X$2=r$.stateNode.containerInfo,Xj$2=!0,Yj$2(e$,t$,r$),X$2=n$,Xj$2=i$;break;case 0:case 11:case 14:case 15:if(!U$2&&(n$=r$.updateQueue,n$!==null&&(n$=n$.lastEffect,n$!==null))){i$=n$=n$.next;do{var o$=i$,s$=o$.destroy;o$=o$.tag,s$!==void 0&&(o$&2||o$&4)&&Mj$2(r$,t$,s$),i$=i$.next}while(i$!==n$)}Yj$2(e$,t$,r$);break;case 1:if(!U$2&&(Lj$2(r$,t$),n$=r$.stateNode,typeof n$.componentWillUnmount=="function"))try{n$.props=r$.memoizedProps,n$.state=r$.memoizedState,n$.componentWillUnmount()}catch(a$){W$2(r$,t$,a$)}Yj$2(e$,t$,r$);break;case 21:Yj$2(e$,t$,r$);break;case 22:r$.mode&1?(U$2=(n$=U$2)||r$.memoizedState!==null,Yj$2(e$,t$,r$),U$2=n$):Yj$2(e$,t$,r$);break;default:Yj$2(e$,t$,r$)}}function ak$2(e$){var t$=e$.updateQueue;if(t$!==null){e$.updateQueue=null;var r$=e$.stateNode;r$===null&&(r$=e$.stateNode=new Kj$2),t$.forEach(function(n$){var i$=bk$2.bind(null,e$,n$);r$.has(n$)||(r$.add(n$),n$.then(i$,i$))})}}function ck$2(e$,t$){var r$=t$.deletions;if(r$!==null)for(var n$=0;n$<r$.length;n$++){var i$=r$[n$];try{var o$=e$,s$=t$,a$=s$;e:for(;a$!==null;){switch(a$.tag){case 5:X$2=a$.stateNode,Xj$2=!1;break e;case 3:X$2=a$.stateNode.containerInfo,Xj$2=!0;break e;case 4:X$2=a$.stateNode.containerInfo,Xj$2=!0;break e}a$=a$.return}if(X$2===null)throw Error(p$1(160));Zj$2(o$,s$,i$),X$2=null,Xj$2=!1;var c$=i$.alternate;c$!==null&&(c$.return=null),i$.return=null}catch(u$){W$2(i$,t$,u$)}}if(t$.subtreeFlags&12854)for(t$=t$.child;t$!==null;)dk$2(t$,e$),t$=t$.sibling}function dk$2(e$,t$){var r$=e$.alternate,n$=e$.flags;switch(e$.tag){case 0:case 11:case 14:case 15:if(ck$2(t$,e$),ek$2(e$),n$&4){try{Pj$2(3,e$,e$.return),Qj$2(3,e$)}catch(f$){W$2(e$,e$.return,f$)}try{Pj$2(5,e$,e$.return)}catch(f$){W$2(e$,e$.return,f$)}}break;case 1:ck$2(t$,e$),ek$2(e$),n$&512&&r$!==null&&Lj$2(r$,r$.return);break;case 5:if(ck$2(t$,e$),ek$2(e$),n$&512&&r$!==null&&Lj$2(r$,r$.return),e$.flags&32){var i$=e$.stateNode;try{ob$2(i$,"")}catch(f$){W$2(e$,e$.return,f$)}}if(n$&4&&(i$=e$.stateNode,i$!=null)){var o$=e$.memoizedProps,s$=r$!==null?r$.memoizedProps:o$,a$=e$.type,c$=e$.updateQueue;if(e$.updateQueue=null,c$!==null)try{a$==="input"&&o$.type==="radio"&&o$.name!=null&&ab$2(i$,o$),vb$2(a$,s$);var u$=vb$2(a$,o$);for(s$=0;s$<c$.length;s$+=2){var l$=c$[s$],d$=c$[s$+1];l$==="style"?sb$2(i$,d$):l$==="dangerouslySetInnerHTML"?nb$2(i$,d$):l$==="children"?ob$2(i$,d$):ta$2(i$,l$,d$,u$)}switch(a$){case"input":bb$2(i$,o$);break;case"textarea":ib$2(i$,o$);break;case"select":var h$=i$._wrapperState.wasMultiple;i$._wrapperState.wasMultiple=!!o$.multiple;var p$=o$.value;p$!=null?fb$2(i$,!!o$.multiple,p$,!1):h$!==!!o$.multiple&&(o$.defaultValue!=null?fb$2(i$,!!o$.multiple,o$.defaultValue,!0):fb$2(i$,!!o$.multiple,o$.multiple?[]:"",!1))}i$[Pf$2]=o$}catch(f$){W$2(e$,e$.return,f$)}}break;case 6:if(ck$2(t$,e$),ek$2(e$),n$&4){if(e$.stateNode===null)throw Error(p$1(162));i$=e$.stateNode,o$=e$.memoizedProps;try{i$.nodeValue=o$}catch(f$){W$2(e$,e$.return,f$)}}break;case 3:if(ck$2(t$,e$),ek$2(e$),n$&4&&r$!==null&&r$.memoizedState.isDehydrated)try{bd$2(t$.containerInfo)}catch(f$){W$2(e$,e$.return,f$)}break;case 4:ck$2(t$,e$),ek$2(e$);break;case 13:ck$2(t$,e$),ek$2(e$),i$=e$.child,i$.flags&8192&&(o$=i$.memoizedState!==null,i$.stateNode.isHidden=o$,!o$||i$.alternate!==null&&i$.alternate.memoizedState!==null||(fk$2=B$1())),n$&4&&ak$2(e$);break;case 22:if(l$=r$!==null&&r$.memoizedState!==null,e$.mode&1?(U$2=(u$=U$2)||l$,ck$2(t$,e$),U$2=u$):ck$2(t$,e$),ek$2(e$),n$&8192){if(u$=e$.memoizedState!==null,(e$.stateNode.isHidden=u$)&&!l$&&e$.mode&1)for(V$1=e$,l$=e$.child;l$!==null;){for(d$=V$1=l$;V$1!==null;){switch(h$=V$1,p$=h$.child,h$.tag){case 0:case 11:case 14:case 15:Pj$2(4,h$,h$.return);break;case 1:Lj$2(h$,h$.return);var _$=h$.stateNode;if(typeof _$.componentWillUnmount=="function"){n$=h$,r$=h$.return;try{t$=n$,_$.props=t$.memoizedProps,_$.state=t$.memoizedState,_$.componentWillUnmount()}catch(f$){W$2(n$,r$,f$)}}break;case 5:Lj$2(h$,h$.return);break;case 22:if(h$.memoizedState!==null){gk$2(d$);continue}}p$!==null?(p$.return=h$,V$1=p$):gk$2(d$)}l$=l$.sibling}e:for(l$=null,d$=e$;;){if(d$.tag===5){if(l$===null){l$=d$;try{i$=d$.stateNode,u$?(o$=i$.style,typeof o$.setProperty=="function"?o$.setProperty("display","none","important"):o$.display="none"):(a$=d$.stateNode,c$=d$.memoizedProps.style,s$=c$!=null&&c$.hasOwnProperty("display")?c$.display:null,a$.style.display=rb$2("display",s$))}catch(f$){W$2(e$,e$.return,f$)}}}else if(d$.tag===6){if(l$===null)try{d$.stateNode.nodeValue=u$?"":d$.memoizedProps}catch(f$){W$2(e$,e$.return,f$)}}else if((d$.tag!==22&&d$.tag!==23||d$.memoizedState===null||d$===e$)&&d$.child!==null){d$.child.return=d$,d$=d$.child;continue}if(d$===e$)break e;for(;d$.sibling===null;){if(d$.return===null||d$.return===e$)break e;l$===d$&&(l$=null),d$=d$.return}l$===d$&&(l$=null),d$.sibling.return=d$.return,d$=d$.sibling}}break;case 19:ck$2(t$,e$),ek$2(e$),n$&4&&ak$2(e$);break;case 21:break;default:ck$2(t$,e$),ek$2(e$)}}function ek$2(e$){var t$=e$.flags;if(t$&2){try{e:{for(var r$=e$.return;r$!==null;){if(Tj$2(r$)){var n$=r$;break e}r$=r$.return}throw Error(p$1(160))}switch(n$.tag){case 5:var i$=n$.stateNode;n$.flags&32&&(ob$2(i$,""),n$.flags&=-33);var o$=Uj$2(e$);Wj$2(e$,o$,i$);break;case 3:case 4:var s$=n$.stateNode.containerInfo,a$=Uj$2(e$);Vj$2(e$,a$,s$);break;default:throw Error(p$1(161))}}catch(c$){W$2(e$,e$.return,c$)}e$.flags&=-3}t$&4096&&(e$.flags&=-4097)}function hk$2(e$,t$,r$){V$1=e$,ik$2(e$)}function ik$2(e$,t$,r$){for(var n$=(e$.mode&1)!==0;V$1!==null;){var i$=V$1,o$=i$.child;if(i$.tag===22&&n$){var s$=i$.memoizedState!==null||Jj$2;if(!s$){var a$=i$.alternate,c$=a$!==null&&a$.memoizedState!==null||U$2;a$=Jj$2;var u$=U$2;if(Jj$2=s$,(U$2=c$)&&!u$)for(V$1=i$;V$1!==null;)s$=V$1,c$=s$.child,s$.tag===22&&s$.memoizedState!==null?jk$2(i$):c$!==null?(c$.return=s$,V$1=c$):jk$2(i$);for(;o$!==null;)V$1=o$,ik$2(o$),o$=o$.sibling;V$1=i$,Jj$2=a$,U$2=u$}kk$2(e$)}else i$.subtreeFlags&8772&&o$!==null?(o$.return=i$,V$1=o$):kk$2(e$)}}function kk$2(e$){for(;V$1!==null;){var t$=V$1;if(t$.flags&8772){var r$=t$.alternate;try{if(t$.flags&8772)switch(t$.tag){case 0:case 11:case 15:U$2||Qj$2(5,t$);break;case 1:var n$=t$.stateNode;if(t$.flags&4&&!U$2)if(r$===null)n$.componentDidMount();else{var i$=t$.elementType===t$.type?r$.memoizedProps:Ci$2(t$.type,r$.memoizedProps);n$.componentDidUpdate(i$,r$.memoizedState,n$.__reactInternalSnapshotBeforeUpdate)}var o$=t$.updateQueue;o$!==null&&sh$1(t$,o$,n$);break;case 3:var s$=t$.updateQueue;if(s$!==null){if(r$=null,t$.child!==null)switch(t$.child.tag){case 5:r$=t$.child.stateNode;break;case 1:r$=t$.child.stateNode}sh$1(t$,s$,r$)}break;case 5:var a$=t$.stateNode;if(r$===null&&t$.flags&4){r$=a$;var c$=t$.memoizedProps;switch(t$.type){case"button":case"input":case"select":case"textarea":c$.autoFocus&&r$.focus();break;case"img":c$.src&&(r$.src=c$.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t$.memoizedState===null){var u$=t$.alternate;if(u$!==null){var l$=u$.memoizedState;if(l$!==null){var d$=l$.dehydrated;d$!==null&&bd$2(d$)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$1(163))}U$2||t$.flags&512&&Rj$2(t$)}catch(h$){W$2(t$,t$.return,h$)}}if(t$===e$){V$1=null;break}if(r$=t$.sibling,r$!==null){r$.return=t$.return,V$1=r$;break}V$1=t$.return}}function gk$2(e$){for(;V$1!==null;){var t$=V$1;if(t$===e$){V$1=null;break}var r$=t$.sibling;if(r$!==null){r$.return=t$.return,V$1=r$;break}V$1=t$.return}}function jk$2(e$){for(;V$1!==null;){var t$=V$1;try{switch(t$.tag){case 0:case 11:case 15:var r$=t$.return;try{Qj$2(4,t$)}catch(c$){W$2(t$,r$,c$)}break;case 1:var n$=t$.stateNode;if(typeof n$.componentDidMount=="function"){var i$=t$.return;try{n$.componentDidMount()}catch(c$){W$2(t$,i$,c$)}}var o$=t$.return;try{Rj$2(t$)}catch(c$){W$2(t$,o$,c$)}break;case 5:var s$=t$.return;try{Rj$2(t$)}catch(c$){W$2(t$,s$,c$)}}}catch(c$){W$2(t$,t$.return,c$)}if(t$===e$){V$1=null;break}var a$=t$.sibling;if(a$!==null){a$.return=t$.return,V$1=a$;break}V$1=t$.return}}var lk$2=Math.ceil,mk$2=ua$2.ReactCurrentDispatcher,nk$2=ua$2.ReactCurrentOwner,ok$2=ua$2.ReactCurrentBatchConfig,K$2=0,Q$2=null,Y$1=null,Z$2=0,fj$2=0,ej$2=Uf$1(0),T$2=0,pk$2=null,rh$1=0,qk$2=0,rk$2=0,sk$2=null,tk$2=null,fk$2=0,Gj$2=1/0,uk$2=null,Oi$1=!1,Pi$2=null,Ri$2=null,vk$2=!1,wk$2=null,xk$2=0,yk$2=0,zk$2=null,Ak$2=-1,Bk$2=0;function R$2(){return K$2&6?B$1():Ak$2!==-1?Ak$2:Ak$2=B$1()}function yi$2(e$){return e$.mode&1?K$2&2&&Z$2!==0?Z$2&-Z$2:Kg$2.transition!==null?(Bk$2===0&&(Bk$2=yc$2()),Bk$2):(e$=C$1,e$!==0||(e$=window.event,e$=e$===void 0?16:jd$2(e$.type)),e$):1}function gi$2(e$,t$,r$,n$){if(50<yk$2)throw yk$2=0,zk$2=null,Error(p$1(185));Ac$2(e$,r$,n$),(!(K$2&2)||e$!==Q$2)&&(e$===Q$2&&(!(K$2&2)&&(qk$2|=r$),T$2===4&&Ck$2(e$,Z$2)),Dk$2(e$,n$),r$===1&&K$2===0&&!(t$.mode&1)&&(Gj$2=B$1()+500,fg$2&&jg$2()))}function Dk$2(e$,t$){var r$=e$.callbackNode;wc$2(e$,t$);var n$=uc$2(e$,e$===Q$2?Z$2:0);if(n$===0)r$!==null&&bc$2(r$),e$.callbackNode=null,e$.callbackPriority=0;else if(t$=n$&-n$,e$.callbackPriority!==t$){if(r$!=null&&bc$2(r$),t$===1)e$.tag===0?ig$2(Ek$2.bind(null,e$)):hg$2(Ek$2.bind(null,e$)),Jf$1(function(){!(K$2&6)&&jg$2()}),r$=null;else{switch(Dc$2(n$)){case 1:r$=fc$2;break;case 4:r$=gc$2;break;case 16:r$=hc$2;break;case 536870912:r$=jc$2;break;default:r$=hc$2}r$=Fk$2(r$,Gk$2.bind(null,e$))}e$.callbackPriority=t$,e$.callbackNode=r$}}function Gk$2(e$,t$){if(Ak$2=-1,Bk$2=0,K$2&6)throw Error(p$1(327));var r$=e$.callbackNode;if(Hk$2()&&e$.callbackNode!==r$)return null;var n$=uc$2(e$,e$===Q$2?Z$2:0);if(n$===0)return null;if(n$&30||n$&e$.expiredLanes||t$)t$=Ik$2(e$,n$);else{t$=n$;var i$=K$2;K$2|=2;var o$=Jk$2();(Q$2!==e$||Z$2!==t$)&&(uk$2=null,Gj$2=B$1()+500,Kk$2(e$,t$));do try{Lk$2();break}catch(a$){Mk$2(e$,a$)}while(!0);$g$2(),mk$2.current=o$,K$2=i$,Y$1!==null?t$=0:(Q$2=null,Z$2=0,t$=T$2)}if(t$!==0){if(t$===2&&(i$=xc$2(e$),i$!==0&&(n$=i$,t$=Nk$2(e$,i$))),t$===1)throw r$=pk$2,Kk$2(e$,0),Ck$2(e$,n$),Dk$2(e$,B$1()),r$;if(t$===6)Ck$2(e$,n$);else{if(i$=e$.current.alternate,!(n$&30)&&!Ok$2(i$)&&(t$=Ik$2(e$,n$),t$===2&&(o$=xc$2(e$),o$!==0&&(n$=o$,t$=Nk$2(e$,o$))),t$===1))throw r$=pk$2,Kk$2(e$,0),Ck$2(e$,n$),Dk$2(e$,B$1()),r$;switch(e$.finishedWork=i$,e$.finishedLanes=n$,t$){case 0:case 1:throw Error(p$1(345));case 2:Pk$2(e$,tk$2,uk$2);break;case 3:if(Ck$2(e$,n$),(n$&130023424)===n$&&(t$=fk$2+500-B$1(),10<t$)){if(uc$2(e$,0)!==0)break;if(i$=e$.suspendedLanes,(i$&n$)!==n$){R$2(),e$.pingedLanes|=e$.suspendedLanes&i$;break}e$.timeoutHandle=Ff$1(Pk$2.bind(null,e$,tk$2,uk$2),t$);break}Pk$2(e$,tk$2,uk$2);break;case 4:if(Ck$2(e$,n$),(n$&4194240)===n$)break;for(t$=e$.eventTimes,i$=-1;0<n$;){var s$=31-oc$2(n$);o$=1<<s$,s$=t$[s$],s$>i$&&(i$=s$),n$&=~o$}if(n$=i$,n$=B$1()-n$,n$=(120>n$?120:480>n$?480:1080>n$?1080:1920>n$?1920:3e3>n$?3e3:4320>n$?4320:1960*lk$2(n$/1960))-n$,10<n$){e$.timeoutHandle=Ff$1(Pk$2.bind(null,e$,tk$2,uk$2),n$);break}Pk$2(e$,tk$2,uk$2);break;case 5:Pk$2(e$,tk$2,uk$2);break;default:throw Error(p$1(329))}}}return Dk$2(e$,B$1()),e$.callbackNode===r$?Gk$2.bind(null,e$):null}function Nk$2(e$,t$){var r$=sk$2;return e$.current.memoizedState.isDehydrated&&(Kk$2(e$,t$).flags|=256),e$=Ik$2(e$,t$),e$!==2&&(t$=tk$2,tk$2=r$,t$!==null&&Fj$2(t$)),e$}function Fj$2(e$){tk$2===null?tk$2=e$:tk$2.push.apply(tk$2,e$)}function Ok$2(e$){for(var t$=e$;;){if(t$.flags&16384){var r$=t$.updateQueue;if(r$!==null&&(r$=r$.stores,r$!==null))for(var n$=0;n$<r$.length;n$++){var i$=r$[n$],o$=i$.getSnapshot;i$=i$.value;try{if(!He$2(o$(),i$))return!1}catch{return!1}}}if(r$=t$.child,t$.subtreeFlags&16384&&r$!==null)r$.return=t$,t$=r$;else{if(t$===e$)break;for(;t$.sibling===null;){if(t$.return===null||t$.return===e$)return!0;t$=t$.return}t$.sibling.return=t$.return,t$=t$.sibling}}return!0}function Ck$2(e$,t$){for(t$&=~rk$2,t$&=~qk$2,e$.suspendedLanes|=t$,e$.pingedLanes&=~t$,e$=e$.expirationTimes;0<t$;){var r$=31-oc$2(t$),n$=1<<r$;e$[r$]=-1,t$&=~n$}}function Ek$2(e$){if(K$2&6)throw Error(p$1(327));Hk$2();var t$=uc$2(e$,0);if(!(t$&1))return Dk$2(e$,B$1()),null;var r$=Ik$2(e$,t$);if(e$.tag!==0&&r$===2){var n$=xc$2(e$);n$!==0&&(t$=n$,r$=Nk$2(e$,n$))}if(r$===1)throw r$=pk$2,Kk$2(e$,0),Ck$2(e$,t$),Dk$2(e$,B$1()),r$;if(r$===6)throw Error(p$1(345));return e$.finishedWork=e$.current.alternate,e$.finishedLanes=t$,Pk$2(e$,tk$2,uk$2),Dk$2(e$,B$1()),null}function Qk$2(e$,t$){var r$=K$2;K$2|=1;try{return e$(t$)}finally{K$2=r$,K$2===0&&(Gj$2=B$1()+500,fg$2&&jg$2())}}function Rk$2(e$){wk$2!==null&&wk$2.tag===0&&!(K$2&6)&&Hk$2();var t$=K$2;K$2|=1;var r$=ok$2.transition,n$=C$1;try{if(ok$2.transition=null,C$1=1,e$)return e$()}finally{C$1=n$,ok$2.transition=r$,K$2=t$,!(K$2&6)&&jg$2()}}function Hj$2(){fj$2=ej$2.current,E$1(ej$2)}function Kk$2(e$,t$){e$.finishedWork=null,e$.finishedLanes=0;var r$=e$.timeoutHandle;if(r$!==-1&&(e$.timeoutHandle=-1,Gf$1(r$)),Y$1!==null)for(r$=Y$1.return;r$!==null;){var n$=r$;switch(wg$2(n$),n$.tag){case 1:n$=n$.type.childContextTypes,n$!=null&&$f$2();break;case 3:zh$2(),E$1(Wf$1),E$1(H$2),Eh$2();break;case 5:Bh$2(n$);break;case 4:zh$2();break;case 13:E$1(L$1);break;case 19:E$1(L$1);break;case 10:ah$1(n$.type._context);break;case 22:case 23:Hj$2()}r$=r$.return}if(Q$2=e$,Y$1=e$=Pg$2(e$.current,null),Z$2=fj$2=t$,T$2=0,pk$2=null,rk$2=qk$2=rh$1=0,tk$2=sk$2=null,fh$2!==null){for(t$=0;t$<fh$2.length;t$++)if(r$=fh$2[t$],n$=r$.interleaved,n$!==null){r$.interleaved=null;var i$=n$.next,o$=r$.pending;if(o$!==null){var s$=o$.next;o$.next=i$,n$.next=s$}r$.pending=n$}fh$2=null}return e$}function Mk$2(e$,t$){do{var r$=Y$1;try{if($g$2(),Fh$2.current=Rh$2,Ih$2){for(var n$=M$1.memoizedState;n$!==null;){var i$=n$.queue;i$!==null&&(i$.pending=null),n$=n$.next}Ih$2=!1}if(Hh$2=0,O$2=N$2=M$1=null,Jh$2=!1,Kh$2=0,nk$2.current=null,r$===null||r$.return===null){T$2=1,pk$2=t$,Y$1=null;break}e:{var o$=e$,s$=r$.return,a$=r$,c$=t$;if(t$=Z$2,a$.flags|=32768,c$!==null&&typeof c$=="object"&&typeof c$.then=="function"){var u$=c$,l$=a$,d$=l$.tag;if(!(l$.mode&1)&&(d$===0||d$===11||d$===15)){var h$=l$.alternate;h$?(l$.updateQueue=h$.updateQueue,l$.memoizedState=h$.memoizedState,l$.lanes=h$.lanes):(l$.updateQueue=null,l$.memoizedState=null)}var p$=Ui$2(s$);if(p$!==null){p$.flags&=-257,Vi$2(p$,s$,a$,o$,t$),p$.mode&1&&Si$2(o$,u$,t$),t$=p$,c$=u$;var _$=t$.updateQueue;if(_$===null){var f$=new Set;f$.add(c$),t$.updateQueue=f$}else _$.add(c$);break e}else{if(!(t$&1)){Si$2(o$,u$,t$),tj$2();break e}c$=Error(p$1(426))}}else if(I$1&&a$.mode&1){var m$=Ui$2(s$);if(m$!==null){!(m$.flags&65536)&&(m$.flags|=256),Vi$2(m$,s$,a$,o$,t$),Jg$2(Ji$2(c$,a$));break e}}o$=c$=Ji$2(c$,a$),T$2!==4&&(T$2=2),sk$2===null?sk$2=[o$]:sk$2.push(o$),o$=s$;do{switch(o$.tag){case 3:o$.flags|=65536,t$&=-t$,o$.lanes|=t$;var g$=Ni$2(o$,c$,t$);ph$2(o$,g$);break e;case 1:a$=c$;var v$=o$.type,y$=o$.stateNode;if(!(o$.flags&128)&&(typeof v$.getDerivedStateFromError=="function"||y$!==null&&typeof y$.componentDidCatch=="function"&&(Ri$2===null||!Ri$2.has(y$)))){o$.flags|=65536,t$&=-t$,o$.lanes|=t$;var S$=Qi$2(o$,a$,t$);ph$2(o$,S$);break e}}o$=o$.return}while(o$!==null)}Sk$2(r$)}catch(b$){t$=b$,Y$1===r$&&r$!==null&&(Y$1=r$=r$.return);continue}break}while(!0)}function Jk$2(){var e$=mk$2.current;return mk$2.current=Rh$2,e$===null?Rh$2:e$}function tj$2(){(T$2===0||T$2===3||T$2===2)&&(T$2=4),Q$2===null||!(rh$1&268435455)&&!(qk$2&268435455)||Ck$2(Q$2,Z$2)}function Ik$2(e$,t$){var r$=K$2;K$2|=2;var n$=Jk$2();(Q$2!==e$||Z$2!==t$)&&(uk$2=null,Kk$2(e$,t$));do try{Tk$2();break}catch(i$){Mk$2(e$,i$)}while(!0);if($g$2(),K$2=r$,mk$2.current=n$,Y$1!==null)throw Error(p$1(261));return Q$2=null,Z$2=0,T$2}function Tk$2(){for(;Y$1!==null;)Uk$2(Y$1)}function Lk$2(){for(;Y$1!==null&&!cc$2();)Uk$2(Y$1)}function Uk$2(e$){var t$=Vk$2(e$.alternate,e$,fj$2);e$.memoizedProps=e$.pendingProps,t$===null?Sk$2(e$):Y$1=t$,nk$2.current=null}function Sk$2(e$){var t$=e$;do{var r$=t$.alternate;if(e$=t$.return,t$.flags&32768){if(r$=Ij$1(r$,t$),r$!==null){r$.flags&=32767,Y$1=r$;return}if(e$!==null)e$.flags|=32768,e$.subtreeFlags=0,e$.deletions=null;else{T$2=6,Y$1=null;return}}else if(r$=Ej$2(r$,t$,fj$2),r$!==null){Y$1=r$;return}if(t$=t$.sibling,t$!==null){Y$1=t$;return}Y$1=t$=e$}while(t$!==null);T$2===0&&(T$2=5)}function Pk$2(e$,t$,r$){var n$=C$1,i$=ok$2.transition;try{ok$2.transition=null,C$1=1,Wk$2(e$,t$,r$,n$)}finally{ok$2.transition=i$,C$1=n$}return null}function Wk$2(e$,t$,r$,n$){do Hk$2();while(wk$2!==null);if(K$2&6)throw Error(p$1(327));r$=e$.finishedWork;var i$=e$.finishedLanes;if(r$===null)return null;if(e$.finishedWork=null,e$.finishedLanes=0,r$===e$.current)throw Error(p$1(177));e$.callbackNode=null,e$.callbackPriority=0;var o$=r$.lanes|r$.childLanes;if(Bc$2(e$,o$),e$===Q$2&&(Y$1=Q$2=null,Z$2=0),!(r$.subtreeFlags&2064)&&!(r$.flags&2064)||vk$2||(vk$2=!0,Fk$2(hc$2,function(){return Hk$2(),null})),o$=(r$.flags&15990)!==0,r$.subtreeFlags&15990||o$){o$=ok$2.transition,ok$2.transition=null;var s$=C$1;C$1=1;var a$=K$2;K$2|=4,nk$2.current=null,Oj$2(e$,r$),dk$2(r$,e$),Oe$1(Df$2),dd$2=!!Cf$2,Df$2=Cf$2=null,e$.current=r$,hk$2(r$),dc$2(),K$2=a$,C$1=s$,ok$2.transition=o$}else e$.current=r$;if(vk$2&&(vk$2=!1,wk$2=e$,xk$2=i$),o$=e$.pendingLanes,o$===0&&(Ri$2=null),mc$2(r$.stateNode),Dk$2(e$,B$1()),t$!==null)for(n$=e$.onRecoverableError,r$=0;r$<t$.length;r$++)i$=t$[r$],n$(i$.value,{componentStack:i$.stack,digest:i$.digest});if(Oi$1)throw Oi$1=!1,e$=Pi$2,Pi$2=null,e$;return xk$2&1&&e$.tag!==0&&Hk$2(),o$=e$.pendingLanes,o$&1?e$===zk$2?yk$2++:(yk$2=0,zk$2=e$):yk$2=0,jg$2(),null}function Hk$2(){if(wk$2!==null){var e$=Dc$2(xk$2),t$=ok$2.transition,r$=C$1;try{if(ok$2.transition=null,C$1=16>e$?16:e$,wk$2===null)var n$=!1;else{if(e$=wk$2,wk$2=null,xk$2=0,K$2&6)throw Error(p$1(331));var i$=K$2;for(K$2|=4,V$1=e$.current;V$1!==null;){var o$=V$1,s$=o$.child;if(V$1.flags&16){var a$=o$.deletions;if(a$!==null){for(var c$=0;c$<a$.length;c$++){var u$=a$[c$];for(V$1=u$;V$1!==null;){var l$=V$1;switch(l$.tag){case 0:case 11:case 15:Pj$2(8,l$,o$)}var d$=l$.child;if(d$!==null)d$.return=l$,V$1=d$;else for(;V$1!==null;){l$=V$1;var h$=l$.sibling,p$=l$.return;if(Sj$2(l$),l$===u$){V$1=null;break}if(h$!==null){h$.return=p$,V$1=h$;break}V$1=p$}}}var _$=o$.alternate;if(_$!==null){var f$=_$.child;if(f$!==null){_$.child=null;do{var m$=f$.sibling;f$.sibling=null,f$=m$}while(f$!==null)}}V$1=o$}}if(o$.subtreeFlags&2064&&s$!==null)s$.return=o$,V$1=s$;else e:for(;V$1!==null;){if(o$=V$1,o$.flags&2048)switch(o$.tag){case 0:case 11:case 15:Pj$2(9,o$,o$.return)}var g$=o$.sibling;if(g$!==null){g$.return=o$.return,V$1=g$;break e}V$1=o$.return}}var v$=e$.current;for(V$1=v$;V$1!==null;){s$=V$1;var y$=s$.child;if(s$.subtreeFlags&2064&&y$!==null)y$.return=s$,V$1=y$;else e:for(s$=v$;V$1!==null;){if(a$=V$1,a$.flags&2048)try{switch(a$.tag){case 0:case 11:case 15:Qj$2(9,a$)}}catch(b$){W$2(a$,a$.return,b$)}if(a$===s$){V$1=null;break e}var S$=a$.sibling;if(S$!==null){S$.return=a$.return,V$1=S$;break e}V$1=a$.return}}if(K$2=i$,jg$2(),lc$2&&typeof lc$2.onPostCommitFiberRoot=="function")try{lc$2.onPostCommitFiberRoot(kc$2,e$)}catch{}n$=!0}return n$}finally{C$1=r$,ok$2.transition=t$}}return!1}function Xk$2(e$,t$,r$){t$=Ji$2(r$,t$),t$=Ni$2(e$,t$,1),e$=nh$2(e$,t$,1),t$=R$2(),e$!==null&&(Ac$2(e$,1,t$),Dk$2(e$,t$))}function W$2(e$,t$,r$){if(e$.tag===3)Xk$2(e$,e$,r$);else for(;t$!==null;){if(t$.tag===3){Xk$2(t$,e$,r$);break}else if(t$.tag===1){var n$=t$.stateNode;if(typeof t$.type.getDerivedStateFromError=="function"||typeof n$.componentDidCatch=="function"&&(Ri$2===null||!Ri$2.has(n$))){e$=Ji$2(r$,e$),e$=Qi$2(t$,e$,1),t$=nh$2(t$,e$,1),e$=R$2(),t$!==null&&(Ac$2(t$,1,e$),Dk$2(t$,e$));break}}t$=t$.return}}function Ti$2(e$,t$,r$){var n$=e$.pingCache;n$!==null&&n$.delete(t$),t$=R$2(),e$.pingedLanes|=e$.suspendedLanes&r$,Q$2===e$&&(Z$2&r$)===r$&&(T$2===4||T$2===3&&(Z$2&130023424)===Z$2&&500>B$1()-fk$2?Kk$2(e$,0):rk$2|=r$),Dk$2(e$,t$)}function Yk$2(e$,t$){t$===0&&(e$.mode&1?(t$=sc$2,sc$2<<=1,!(sc$2&130023424)&&(sc$2=4194304)):t$=1);var r$=R$2();e$=ih$1(e$,t$),e$!==null&&(Ac$2(e$,t$,r$),Dk$2(e$,r$))}function uj$2(e$){var t$=e$.memoizedState,r$=0;t$!==null&&(r$=t$.retryLane),Yk$2(e$,r$)}function bk$2(e$,t$){var r$=0;switch(e$.tag){case 13:var n$=e$.stateNode,i$=e$.memoizedState;i$!==null&&(r$=i$.retryLane);break;case 19:n$=e$.stateNode;break;default:throw Error(p$1(314))}n$!==null&&n$.delete(t$),Yk$2(e$,r$)}var Vk$2;Vk$2=function(e$,t$,r$){if(e$!==null)if(e$.memoizedProps!==t$.pendingProps||Wf$1.current)dh$1=!0;else{if(!(e$.lanes&r$)&&!(t$.flags&128))return dh$1=!1,yj$2(e$,t$,r$);dh$1=!!(e$.flags&131072)}else dh$1=!1,I$1&&t$.flags&1048576&&ug$2(t$,ng$2,t$.index);switch(t$.lanes=0,t$.tag){case 2:var n$=t$.type;ij$2(e$,t$),e$=t$.pendingProps;var i$=Yf$1(t$,H$2.current);ch$1(t$,r$),i$=Nh$2(null,t$,n$,e$,i$,r$);var o$=Sh$2();return t$.flags|=1,typeof i$=="object"&&i$!==null&&typeof i$.render=="function"&&i$.$$typeof===void 0?(t$.tag=1,t$.memoizedState=null,t$.updateQueue=null,Zf$2(n$)?(o$=!0,cg$2(t$)):o$=!1,t$.memoizedState=i$.state!==null&&i$.state!==void 0?i$.state:null,kh$2(t$),i$.updater=Ei$2,t$.stateNode=i$,i$._reactInternals=t$,Ii$2(t$,n$,e$,r$),t$=jj$2(null,t$,n$,!0,o$,r$)):(t$.tag=0,I$1&&o$&&vg$2(t$),Xi$2(null,t$,i$,r$),t$=t$.child),t$;case 16:n$=t$.elementType;e:{switch(ij$2(e$,t$),e$=t$.pendingProps,i$=n$._init,n$=i$(n$._payload),t$.type=n$,i$=t$.tag=Zk$2(n$),e$=Ci$2(n$,e$),i$){case 0:t$=cj$2(null,t$,n$,e$,r$);break e;case 1:t$=hj$2(null,t$,n$,e$,r$);break e;case 11:t$=Yi$2(null,t$,n$,e$,r$);break e;case 14:t$=$i$2(null,t$,n$,Ci$2(n$.type,e$),r$);break e}throw Error(p$1(306,n$,""))}return t$;case 0:return n$=t$.type,i$=t$.pendingProps,i$=t$.elementType===n$?i$:Ci$2(n$,i$),cj$2(e$,t$,n$,i$,r$);case 1:return n$=t$.type,i$=t$.pendingProps,i$=t$.elementType===n$?i$:Ci$2(n$,i$),hj$2(e$,t$,n$,i$,r$);case 3:e:{if(kj$2(t$),e$===null)throw Error(p$1(387));n$=t$.pendingProps,o$=t$.memoizedState,i$=o$.element,lh$1(e$,t$),qh$2(t$,n$,null,r$);var s$=t$.memoizedState;if(n$=s$.element,o$.isDehydrated)if(o$={element:n$,isDehydrated:!1,cache:s$.cache,pendingSuspenseBoundaries:s$.pendingSuspenseBoundaries,transitions:s$.transitions},t$.updateQueue.baseState=o$,t$.memoizedState=o$,t$.flags&256){i$=Ji$2(Error(p$1(423)),t$),t$=lj$2(e$,t$,n$,r$,i$);break e}else if(n$!==i$){i$=Ji$2(Error(p$1(424)),t$),t$=lj$2(e$,t$,n$,r$,i$);break e}else for(yg$2=Lf$2(t$.stateNode.containerInfo.firstChild),xg$2=t$,I$1=!0,zg$2=null,r$=Vg$2(t$,null,n$,r$),t$.child=r$;r$;)r$.flags=r$.flags&-3|4096,r$=r$.sibling;else{if(Ig$2(),n$===i$){t$=Zi$2(e$,t$,r$);break e}Xi$2(e$,t$,n$,r$)}t$=t$.child}return t$;case 5:return Ah$2(t$),e$===null&&Eg$2(t$),n$=t$.type,i$=t$.pendingProps,o$=e$!==null?e$.memoizedProps:null,s$=i$.children,Ef$2(n$,i$)?s$=null:o$!==null&&Ef$2(n$,o$)&&(t$.flags|=32),gj$2(e$,t$),Xi$2(e$,t$,s$,r$),t$.child;case 6:return e$===null&&Eg$2(t$),null;case 13:return oj$2(e$,t$,r$);case 4:return yh$2(t$,t$.stateNode.containerInfo),n$=t$.pendingProps,e$===null?t$.child=Ug$2(t$,null,n$,r$):Xi$2(e$,t$,n$,r$),t$.child;case 11:return n$=t$.type,i$=t$.pendingProps,i$=t$.elementType===n$?i$:Ci$2(n$,i$),Yi$2(e$,t$,n$,i$,r$);case 7:return Xi$2(e$,t$,t$.pendingProps,r$),t$.child;case 8:return Xi$2(e$,t$,t$.pendingProps.children,r$),t$.child;case 12:return Xi$2(e$,t$,t$.pendingProps.children,r$),t$.child;case 10:e:{if(n$=t$.type._context,i$=t$.pendingProps,o$=t$.memoizedProps,s$=i$.value,G$2(Wg$2,n$._currentValue),n$._currentValue=s$,o$!==null)if(He$2(o$.value,s$)){if(o$.children===i$.children&&!Wf$1.current){t$=Zi$2(e$,t$,r$);break e}}else for(o$=t$.child,o$!==null&&(o$.return=t$);o$!==null;){var a$=o$.dependencies;if(a$!==null){s$=o$.child;for(var c$=a$.firstContext;c$!==null;){if(c$.context===n$){if(o$.tag===1){c$=mh$2(-1,r$&-r$),c$.tag=2;var u$=o$.updateQueue;if(u$!==null){u$=u$.shared;var l$=u$.pending;l$===null?c$.next=c$:(c$.next=l$.next,l$.next=c$),u$.pending=c$}}o$.lanes|=r$,c$=o$.alternate,c$!==null&&(c$.lanes|=r$),bh$2(o$.return,r$,t$),a$.lanes|=r$;break}c$=c$.next}}else if(o$.tag===10)s$=o$.type===t$.type?null:o$.child;else if(o$.tag===18){if(s$=o$.return,s$===null)throw Error(p$1(341));s$.lanes|=r$,a$=s$.alternate,a$!==null&&(a$.lanes|=r$),bh$2(s$,r$,t$),s$=o$.sibling}else s$=o$.child;if(s$!==null)s$.return=o$;else for(s$=o$;s$!==null;){if(s$===t$){s$=null;break}if(o$=s$.sibling,o$!==null){o$.return=s$.return,s$=o$;break}s$=s$.return}o$=s$}Xi$2(e$,t$,i$.children,r$),t$=t$.child}return t$;case 9:return i$=t$.type,n$=t$.pendingProps.children,ch$1(t$,r$),i$=eh$2(i$),n$=n$(i$),t$.flags|=1,Xi$2(e$,t$,n$,r$),t$.child;case 14:return n$=t$.type,i$=Ci$2(n$,t$.pendingProps),i$=Ci$2(n$.type,i$),$i$2(e$,t$,n$,i$,r$);case 15:return bj$1(e$,t$,t$.type,t$.pendingProps,r$);case 17:return n$=t$.type,i$=t$.pendingProps,i$=t$.elementType===n$?i$:Ci$2(n$,i$),ij$2(e$,t$),t$.tag=1,Zf$2(n$)?(e$=!0,cg$2(t$)):e$=!1,ch$1(t$,r$),Gi$2(t$,n$,i$),Ii$2(t$,n$,i$,r$),jj$2(null,t$,n$,!0,e$,r$);case 19:return xj$2(e$,t$,r$);case 22:return dj$2(e$,t$,r$)}throw Error(p$1(156,t$.tag))};function Fk$2(e$,t$){return ac$2(e$,t$)}function $k$2(e$,t$,r$,n$){this.tag=e$,this.key=r$,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t$,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n$,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg$2(e$,t$,r$,n$){return new $k$2(e$,t$,r$,n$)}function aj$2(e$){return e$=e$.prototype,!(!e$||!e$.isReactComponent)}function Zk$2(e$){if(typeof e$=="function")return aj$2(e$)?1:0;if(e$!=null){if(e$=e$.$$typeof,e$===Da$2)return 11;if(e$===Ga$2)return 14}return 2}function Pg$2(e$,t$){var r$=e$.alternate;return r$===null?(r$=Bg$2(e$.tag,t$,e$.key,e$.mode),r$.elementType=e$.elementType,r$.type=e$.type,r$.stateNode=e$.stateNode,r$.alternate=e$,e$.alternate=r$):(r$.pendingProps=t$,r$.type=e$.type,r$.flags=0,r$.subtreeFlags=0,r$.deletions=null),r$.flags=e$.flags&14680064,r$.childLanes=e$.childLanes,r$.lanes=e$.lanes,r$.child=e$.child,r$.memoizedProps=e$.memoizedProps,r$.memoizedState=e$.memoizedState,r$.updateQueue=e$.updateQueue,t$=e$.dependencies,r$.dependencies=t$===null?null:{lanes:t$.lanes,firstContext:t$.firstContext},r$.sibling=e$.sibling,r$.index=e$.index,r$.ref=e$.ref,r$}function Rg$2(e$,t$,r$,n$,i$,o$){var s$=2;if(n$=e$,typeof e$=="function")aj$2(e$)&&(s$=1);else if(typeof e$=="string")s$=5;else e:switch(e$){case ya$1:return Tg$2(r$.children,i$,o$,t$);case za$2:s$=8,i$|=8;break;case Aa$2:return e$=Bg$2(12,r$,t$,i$|2),e$.elementType=Aa$2,e$.lanes=o$,e$;case Ea$2:return e$=Bg$2(13,r$,t$,i$),e$.elementType=Ea$2,e$.lanes=o$,e$;case Fa$2:return e$=Bg$2(19,r$,t$,i$),e$.elementType=Fa$2,e$.lanes=o$,e$;case Ia$1:return pj$2(r$,i$,o$,t$);default:if(typeof e$=="object"&&e$!==null)switch(e$.$$typeof){case Ba$2:s$=10;break e;case Ca$2:s$=9;break e;case Da$2:s$=11;break e;case Ga$2:s$=14;break e;case Ha$2:s$=16,n$=null;break e}throw Error(p$1(130,e$==null?e$:typeof e$,""))}return t$=Bg$2(s$,r$,t$,i$),t$.elementType=e$,t$.type=n$,t$.lanes=o$,t$}function Tg$2(e$,t$,r$,n$){return e$=Bg$2(7,e$,n$,t$),e$.lanes=r$,e$}function pj$2(e$,t$,r$,n$){return e$=Bg$2(22,e$,n$,t$),e$.elementType=Ia$1,e$.lanes=r$,e$.stateNode={isHidden:!1},e$}function Qg$2(e$,t$,r$){return e$=Bg$2(6,e$,null,t$),e$.lanes=r$,e$}function Sg$2(e$,t$,r$){return t$=Bg$2(4,e$.children!==null?e$.children:[],e$.key,t$),t$.lanes=r$,t$.stateNode={containerInfo:e$.containerInfo,pendingChildren:null,implementation:e$.implementation},t$}function al$2(e$,t$,r$,n$,i$){this.tag=t$,this.containerInfo=e$,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc$2(0),this.expirationTimes=zc$2(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc$2(0),this.identifierPrefix=n$,this.onRecoverableError=i$,this.mutableSourceEagerHydrationData=null}function bl$2(e$,t$,r$,n$,i$,o$,s$,a$,c$){return e$=new al$2(e$,t$,r$,a$,c$),t$===1?(t$=1,o$===!0&&(t$|=8)):t$=0,o$=Bg$2(3,null,null,t$),e$.current=o$,o$.stateNode=e$,o$.memoizedState={element:n$,isDehydrated:r$,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh$2(o$),e$}function cl$2(e$,t$,r$){var n$=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa$2,key:n$==null?null:""+n$,children:e$,containerInfo:t$,implementation:r$}}function dl$2(e$){if(!e$)return Vf$1;e$=e$._reactInternals;e:{if(Vb$2(e$)!==e$||e$.tag!==1)throw Error(p$1(170));var t$=e$;do{switch(t$.tag){case 3:t$=t$.stateNode.context;break e;case 1:if(Zf$2(t$.type)){t$=t$.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t$=t$.return}while(t$!==null);throw Error(p$1(171))}if(e$.tag===1){var r$=e$.type;if(Zf$2(r$))return bg$2(e$,r$,t$)}return t$}function el$2(e$,t$,r$,n$,i$,o$,s$,a$,c$){return e$=bl$2(r$,n$,!0,e$,i$,o$,s$,a$,c$),e$.context=dl$2(null),r$=e$.current,n$=R$2(),i$=yi$2(r$),o$=mh$2(n$,i$),o$.callback=t$??null,nh$2(r$,o$,i$),e$.current.lanes=i$,Ac$2(e$,i$,n$),Dk$2(e$,n$),e$}function fl$2(e$,t$,r$,n$){var i$=t$.current,o$=R$2(),s$=yi$2(i$);return r$=dl$2(r$),t$.context===null?t$.context=r$:t$.pendingContext=r$,t$=mh$2(o$,s$),t$.payload={element:e$},n$=n$===void 0?null:n$,n$!==null&&(t$.callback=n$),e$=nh$2(i$,t$,s$),e$!==null&&(gi$2(e$,i$,s$,o$),oh$1(e$,i$,s$)),s$}function gl$2(e$){if(e$=e$.current,!e$.child)return null;switch(e$.child.tag){case 5:return e$.child.stateNode;default:return e$.child.stateNode}}function hl$2(e$,t$){if(e$=e$.memoizedState,e$!==null&&e$.dehydrated!==null){var r$=e$.retryLane;e$.retryLane=r$!==0&&r$<t$?r$:t$}}function il$2(e$,t$){hl$2(e$,t$),(e$=e$.alternate)&&hl$2(e$,t$)}function jl$2(){return null}var kl$2=typeof reportError=="function"?reportError:function(e$){console.error(e$)};function ll$2(e$){this._internalRoot=e$}ml$2.prototype.render=ll$2.prototype.render=function(e$){var t$=this._internalRoot;if(t$===null)throw Error(p$1(409));fl$2(e$,t$,null,null)};ml$2.prototype.unmount=ll$2.prototype.unmount=function(){var e$=this._internalRoot;if(e$!==null){this._internalRoot=null;var t$=e$.containerInfo;Rk$2(function(){fl$2(null,e$,null,null)}),t$[uf$2]=null}};function ml$2(e$){this._internalRoot=e$}ml$2.prototype.unstable_scheduleHydration=function(e$){if(e$){var t$=Hc$2();e$={blockedOn:null,target:e$,priority:t$};for(var r$=0;r$<Qc$2.length&&t$!==0&&t$<Qc$2[r$].priority;r$++);Qc$2.splice(r$,0,e$),r$===0&&Vc$2(e$)}};function nl$2(e$){return!(!e$||e$.nodeType!==1&&e$.nodeType!==9&&e$.nodeType!==11)}function ol$2(e$){return!(!e$||e$.nodeType!==1&&e$.nodeType!==9&&e$.nodeType!==11&&(e$.nodeType!==8||e$.nodeValue!==" react-mount-point-unstable "))}function pl$2(){}function ql$2(e$,t$,r$,n$,i$){if(i$){if(typeof n$=="function"){var o$=n$;n$=function(){var u$=gl$2(s$);o$.call(u$)}}var s$=el$2(t$,n$,e$,0,null,!1,!1,"",pl$2);return e$._reactRootContainer=s$,e$[uf$2]=s$.current,sf$2(e$.nodeType===8?e$.parentNode:e$),Rk$2(),s$}for(;i$=e$.lastChild;)e$.removeChild(i$);if(typeof n$=="function"){var a$=n$;n$=function(){var u$=gl$2(c$);a$.call(u$)}}var c$=bl$2(e$,0,!1,null,null,!1,!1,"",pl$2);return e$._reactRootContainer=c$,e$[uf$2]=c$.current,sf$2(e$.nodeType===8?e$.parentNode:e$),Rk$2(function(){fl$2(t$,c$,r$,n$)}),c$}function rl$2(e$,t$,r$,n$,i$){var o$=r$._reactRootContainer;if(o$){var s$=o$;if(typeof i$=="function"){var a$=i$;i$=function(){var c$=gl$2(s$);a$.call(c$)}}fl$2(t$,s$,e$,i$)}else s$=ql$2(r$,t$,e$,i$,n$);return gl$2(s$)}Ec$2=function(e$){switch(e$.tag){case 3:var t$=e$.stateNode;if(t$.current.memoizedState.isDehydrated){var r$=tc$2(t$.pendingLanes);r$!==0&&(Cc$2(t$,r$|1),Dk$2(t$,B$1()),!(K$2&6)&&(Gj$2=B$1()+500,jg$2()))}break;case 13:Rk$2(function(){var n$=ih$1(e$,1);if(n$!==null){var i$=R$2();gi$2(n$,e$,1,i$)}}),il$2(e$,1)}};Fc$2=function(e$){if(e$.tag===13){var t$=ih$1(e$,134217728);if(t$!==null){var r$=R$2();gi$2(t$,e$,134217728,r$)}il$2(e$,134217728)}};Gc$2=function(e$){if(e$.tag===13){var t$=yi$2(e$),r$=ih$1(e$,t$);if(r$!==null){var n$=R$2();gi$2(r$,e$,t$,n$)}il$2(e$,t$)}};Hc$2=function(){return C$1};Ic$2=function(e$,t$){var r$=C$1;try{return C$1=e$,t$()}finally{C$1=r$}};yb$2=function(e$,t$,r$){switch(t$){case"input":if(bb$2(e$,r$),t$=r$.name,r$.type==="radio"&&t$!=null){for(r$=e$;r$.parentNode;)r$=r$.parentNode;for(r$=r$.querySelectorAll("input[name="+JSON.stringify(""+t$)+'][type="radio"]'),t$=0;t$<r$.length;t$++){var n$=r$[t$];if(n$!==e$&&n$.form===e$.form){var i$=Db$2(n$);if(!i$)throw Error(p$1(90));Wa$2(n$),bb$2(n$,i$)}}}break;case"textarea":ib$2(e$,r$);break;case"select":t$=r$.value,t$!=null&&fb$2(e$,!!r$.multiple,t$,!1)}};Gb$2=Qk$2;Hb$2=Rk$2;var sl$2={usingClientEntryPoint:!1,Events:[Cb$2,ue$2,Db$2,Eb$2,Fb$2,Qk$2]},tl$2={findFiberByHostInstance:Wc$2,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul$2={bundleType:tl$2.bundleType,version:tl$2.version,rendererPackageName:tl$2.rendererPackageName,rendererConfig:tl$2.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua$2.ReactCurrentDispatcher,findHostInstanceByFiber:function(e$){return e$=Zb$2(e$),e$===null?null:e$.stateNode},findFiberByHostInstance:tl$2.findFiberByHostInstance||jl$2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl$2=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl$2.isDisabled&&vl$2.supportsFiber)try{kc$2=vl$2.inject(ul$2),lc$2=vl$2}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl$2;reactDom_production_min.createPortal=function(e$,t$){var r$=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl$2(t$))throw Error(p$1(200));return cl$2(e$,t$,null,r$)};reactDom_production_min.createRoot=function(e$,t$){if(!nl$2(e$))throw Error(p$1(299));var r$=!1,n$="",i$=kl$2;return t$!=null&&(t$.unstable_strictMode===!0&&(r$=!0),t$.identifierPrefix!==void 0&&(n$=t$.identifierPrefix),t$.onRecoverableError!==void 0&&(i$=t$.onRecoverableError)),t$=bl$2(e$,1,!1,null,null,r$,!1,n$,i$),e$[uf$2]=t$.current,sf$2(e$.nodeType===8?e$.parentNode:e$),new ll$2(t$)};reactDom_production_min.findDOMNode=function(e$){if(e$==null)return null;if(e$.nodeType===1)return e$;var t$=e$._reactInternals;if(t$===void 0)throw typeof e$.render=="function"?Error(p$1(188)):(e$=Object.keys(e$).join(","),Error(p$1(268,e$)));return e$=Zb$2(t$),e$=e$===null?null:e$.stateNode,e$};reactDom_production_min.flushSync=function(e$){return Rk$2(e$)};reactDom_production_min.hydrate=function(e$,t$,r$){if(!ol$2(t$))throw Error(p$1(200));return rl$2(null,e$,t$,!0,r$)};reactDom_production_min.hydrateRoot=function(e$,t$,r$){if(!nl$2(e$))throw Error(p$1(405));var n$=r$!=null&&r$.hydratedSources||null,i$=!1,o$="",s$=kl$2;if(r$!=null&&(r$.unstable_strictMode===!0&&(i$=!0),r$.identifierPrefix!==void 0&&(o$=r$.identifierPrefix),r$.onRecoverableError!==void 0&&(s$=r$.onRecoverableError)),t$=el$2(t$,null,e$,1,r$??null,i$,!1,o$,s$),e$[uf$2]=t$.current,sf$2(e$),n$)for(e$=0;e$<n$.length;e$++)r$=n$[e$],i$=r$._getVersion,i$=i$(r$._source),t$.mutableSourceEagerHydrationData==null?t$.mutableSourceEagerHydrationData=[r$,i$]:t$.mutableSourceEagerHydrationData.push(r$,i$);return new ml$2(t$)};reactDom_production_min.render=function(e$,t$,r$){if(!ol$2(t$))throw Error(p$1(200));return rl$2(null,e$,t$,!1,r$)};reactDom_production_min.unmountComponentAtNode=function(e$){if(!ol$2(e$))throw Error(p$1(40));return e$._reactRootContainer?(Rk$2(function(){rl$2(null,null,e$,!1,function(){e$._reactRootContainer=null,e$[uf$2]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk$2;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(e$,t$,r$,n$){if(!ol$2(r$))throw Error(p$1(200));if(e$==null||e$._reactInternals===void 0)throw Error(p$1(38));return rl$2(e$,t$,r$,!1,n$)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(e$){console.error(e$)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports,createRoot,m$1=reactDomExports;createRoot=m$1.createRoot,m$1.hydrateRoot;function e(e$,t$){return t$.forEach(function(r$){r$&&typeof r$!="string"&&!Array.isArray(r$)&&Object.keys(r$).forEach(function(n$){if(n$!=="default"&&!(n$ in e$)){var i$=Object.getOwnPropertyDescriptor(r$,n$);Object.defineProperty(e$,n$,i$.get?i$:{enumerable:!0,get:function(){return r$[n$]}})}})}),Object.freeze(e$)}var t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function i(e$){return e$&&e$.__esModule&&Object.prototype.hasOwnProperty.call(e$,"default")?e$.default:e$}var n=function(e$){try{return!!e$()}catch{return!0}},r=!n(function(){var e$=(function(){}).bind();return typeof e$!="function"||e$.hasOwnProperty("prototype")}),o=r,s=Function.prototype,a=s.call,c=o&&s.bind.bind(a,a),d=o?c:function(e$){return function(){return a.apply(e$,arguments)}},l=d({}.isPrototypeOf),u=function(e$){return e$&&e$.Math==Math&&e$},h=u(typeof globalThis=="object"&&globalThis)||u(typeof window=="object"&&window)||u(typeof self=="object"&&self)||u(typeof t=="object"&&t)||function(){return this}()||t||Function("return this")(),p=r,_$1=Function.prototype,E=_$1.apply,f=_$1.call,m=typeof Reflect=="object"&&Reflect.apply||(p?f.bind(E):function(){return f.apply(E,arguments)}),T$1=d,S=T$1({}.toString),g=T$1("".slice),R$1=function(e$){return g(S(e$),8,-1)},C=R$1,I=d,v$1=function(e$){if(C(e$)==="Function")return I(e$)},y=typeof document=="object"&&document.all,A={all:y,IS_HTMLDDA:y===void 0&&y!==void 0},b=A.all,w=A.IS_HTMLDDA?function(e$){return typeof e$=="function"||e$===b}:function(e$){return typeof e$=="function"},O$1={},N$1=!n(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),D=r,P$1=Function.prototype.call,L=D?P$1.bind(P$1):function(){return P$1.apply(P$1,arguments)},k={},M={}.propertyIsEnumerable,U$1=Object.getOwnPropertyDescriptor,x=U$1&&!M.call({1:2},1);k.f=x?function(e$){var t$=U$1(this,e$);return!!t$&&t$.enumerable}:M;var V,F,B=function(e$,t$){return{enumerable:!(1&e$),configurable:!(2&e$),writable:!(4&e$),value:t$}},j$1=n,G$1=R$1,W$1=Object,H$1=d("".split),K$1=j$1(function(){return!W$1("z").propertyIsEnumerable(0)})?function(e$){return G$1(e$)=="String"?H$1(e$,""):W$1(e$)}:W$1,Y=function(e$){return e$==null},q$1=Y,z=TypeError,J$1=function(e$){if(q$1(e$))throw z("Can't call method on "+e$);return e$},X$1=K$1,Q$1=J$1,Z$1=function(e$){return X$1(Q$1(e$))},$$1=w,ee=A.all,te$1=A.IS_HTMLDDA?function(e$){return typeof e$=="object"?e$!==null:$$1(e$)||e$===ee}:function(e$){return typeof e$=="object"?e$!==null:$$1(e$)},ie$1={},ne=ie$1,re$1=h,oe$1=w,se$1=function(e$){return oe$1(e$)?e$:void 0},ae$1=function(e$,t$){return arguments.length<2?se$1(ne[e$])||se$1(re$1[e$]):ne[e$]&&ne[e$][t$]||re$1[e$]&&re$1[e$][t$]},ce=typeof navigator<"u"&&String(navigator.userAgent)||"",de$1=h,le$1=ce,ue$1=de$1.process,he$1=de$1.Deno,pe$1=ue$1&&ue$1.versions||he$1&&he$1.version,_e=pe$1&&pe$1.v8;_e&&(F=(V=_e.split("."))[0]>0&&V[0]<4?1:+(V[0]+V[1])),!F&&le$1&&(!(V=le$1.match(/Edge\/(\d+)/))||V[1]>=74)&&(V=le$1.match(/Chrome\/(\d+)/))&&(F=+V[1]);var Ee$1=F,fe$1=Ee$1,me$1=n,Te$1=h.String,Se$1=!!Object.getOwnPropertySymbols&&!me$1(function(){var e$=Symbol();return!Te$1(e$)||!(Object(e$)instanceof Symbol)||!Symbol.sham&&fe$1&&fe$1<41}),ge$1=Se$1&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Re=ae$1,Ce$1=w,Ie$1=l,ve$1=Object,ye$1=ge$1?function(e$){return typeof e$=="symbol"}:function(e$){var t$=Re("Symbol");return Ce$1(t$)&&Ie$1(t$.prototype,ve$1(e$))},Ae=String,be$1=function(e$){try{return Ae(e$)}catch{return"Object"}},we$1=w,Oe=be$1,Ne$1=TypeError,De$1=function(e$){if(we$1(e$))return e$;throw Ne$1(Oe(e$)+" is not a function")},Pe$1=De$1,Le$1=Y,ke$1=function(e$,t$){var r$=e$[t$];return Le$1(r$)?void 0:Pe$1(r$)},Me$1=L,Ue$1=w,xe$1=te$1,Ve$1=TypeError,Fe$1={exports:{}},Be$1=h,je$1=Object.defineProperty,Ge$1=function(e$,t$){try{je$1(Be$1,e$,{value:t$,configurable:!0,writable:!0})}catch{Be$1[e$]=t$}return t$},We$1="__core-js_shared__",He$1=h[We$1]||Ge$1(We$1,{}),Ke$1=He$1;(Fe$1.exports=function(e$,t$){return Ke$1[e$]||(Ke$1[e$]=t$!==void 0?t$:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Ye$1=Fe$1.exports,qe$1=J$1,ze$1=Object,Je$1=function(e$){return ze$1(qe$1(e$))},Xe$1=Je$1,Qe$1=d({}.hasOwnProperty),Ze=Object.hasOwn||function(e$,t$){return Qe$1(Xe$1(e$),t$)},$e$1=d,et$1=0,tt$1=Math.random(),it$1=$e$1(1 .toString),nt$1=function(e$){return"Symbol("+(e$===void 0?"":e$)+")_"+it$1(++et$1+tt$1,36)},rt=Ye$1,ot$1=Ze,st$1=nt$1,at$1=Se$1,ct$1=ge$1,dt$1=h.Symbol,lt=rt("wks"),ut$1=ct$1?dt$1.for||dt$1:dt$1&&dt$1.withoutSetter||st$1,ht$1=function(e$){return ot$1(lt,e$)||(lt[e$]=at$1&&ot$1(dt$1,e$)?dt$1[e$]:ut$1("Symbol."+e$)),lt[e$]},pt$1=L,_t$1=te$1,Et$1=ye$1,ft$1=ke$1,mt$1=function(e$,t$){var r$,n$;if(Ue$1(r$=e$.toString)&&!xe$1(n$=Me$1(r$,e$))||Ue$1(r$=e$.valueOf)&&!xe$1(n$=Me$1(r$,e$)))return n$;throw Ve$1("Can't convert object to primitive value")},Tt$1=TypeError,St$1=ht$1("toPrimitive"),gt=function(e$,t$){if(!_t$1(e$)||Et$1(e$))return e$;var r$,n$=ft$1(e$,St$1);if(n$){if(r$=pt$1(n$,e$,t$),!_t$1(r$)||Et$1(r$))return r$;throw Tt$1("Can't convert object to primitive value")}return mt$1(e$)},Rt$1=ye$1,Ct$1=function(e$){var t$=gt(e$,"string");return Rt$1(t$)?t$:t$+""},It$1=te$1,vt=h.document,yt$1=It$1(vt)&&It$1(vt.createElement),At$1=function(e$){return yt$1?vt.createElement(e$):{}},bt=At$1,wt$1=!N$1&&!n(function(){return Object.defineProperty(bt("div"),"a",{get:function(){return 7}}).a!=7}),Ot$1=N$1,Nt$1=L,Dt=k,Pt$1=B,Lt$1=Z$1,kt$1=Ct$1,Mt$1=Ze,Ut$1=wt$1,xt$1=Object.getOwnPropertyDescriptor;O$1.f=Ot$1?xt$1:function(e$,t$){if(e$=Lt$1(e$),t$=kt$1(t$),Ut$1)try{return xt$1(e$,t$)}catch{}if(Mt$1(e$,t$))return Pt$1(!Nt$1(Dt.f,e$,t$),e$[t$])};var Vt$1=n,Ft$1=w,Bt=/#|\.prototype\./,jt$1=function(e$,t$){var r$=Wt[Gt$1(e$)];return r$==Kt$1||r$!=Ht$1&&(Ft$1(t$)?Vt$1(t$):!!t$)},Gt$1=jt$1.normalize=function(e$){return String(e$).replace(Bt,".").toLowerCase()},Wt=jt$1.data={},Ht$1=jt$1.NATIVE="N",Kt$1=jt$1.POLYFILL="P",Yt$1=jt$1,qt$1=De$1,zt$1=r,Jt$1=v$1(v$1.bind),Xt$1=function(e$,t$){return qt$1(e$),t$===void 0?e$:zt$1?Jt$1(e$,t$):function(){return e$.apply(t$,arguments)}},Qt$1={},Zt$1=N$1&&n(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),$t$1=te$1,ei$1=String,ti$1=TypeError,ii$1=function(e$){if($t$1(e$))return e$;throw ti$1(ei$1(e$)+" is not an object")},ni$1=N$1,ri$1=wt$1,oi$1=Zt$1,si=ii$1,ai$1=Ct$1,ci$1=TypeError,di$1=Object.defineProperty,li$1=Object.getOwnPropertyDescriptor,ui$1="enumerable",hi$1="configurable",pi$1="writable";Qt$1.f=ni$1?oi$1?function(e$,t$,r$){if(si(e$),t$=ai$1(t$),si(r$),typeof e$=="function"&&t$==="prototype"&&"value"in r$&&pi$1 in r$&&!r$[pi$1]){var n$=li$1(e$,t$);n$&&n$[pi$1]&&(e$[t$]=r$.value,r$={configurable:hi$1 in r$?r$[hi$1]:n$[hi$1],enumerable:ui$1 in r$?r$[ui$1]:n$[ui$1],writable:!1})}return di$1(e$,t$,r$)}:di$1:function(e$,t$,r$){if(si(e$),t$=ai$1(t$),si(r$),ri$1)try{return di$1(e$,t$,r$)}catch{}if("get"in r$||"set"in r$)throw ci$1("Accessors not supported");return"value"in r$&&(e$[t$]=r$.value),e$};var _i$1=Qt$1,Ei$1=B,fi$1=N$1?function(e$,t$,r$){return _i$1.f(e$,t$,Ei$1(1,r$))}:function(e$,t$,r$){return e$[t$]=r$,e$},mi$1=h,Ti$1=m,Si$1=v$1,gi$1=w,Ri$1=O$1.f,Ci$1=Yt$1,Ii$1=ie$1,vi$1=Xt$1,yi$1=fi$1,Ai$1=Ze,bi$1=function(e$){var t$=function(r$,n$,i$){if(this instanceof t$){switch(arguments.length){case 0:return new e$;case 1:return new e$(r$);case 2:return new e$(r$,n$)}return new e$(r$,n$,i$)}return Ti$1(e$,this,arguments)};return t$.prototype=e$.prototype,t$},wi$1=function(e$,t$){var r$,n$,i$,o$,s$,a$,c$,u$,l$,d$=e$.target,h$=e$.global,p$=e$.stat,_$=e$.proto,f$=h$?mi$1:p$?mi$1[d$]:(mi$1[d$]||{}).prototype,m$=h$?Ii$1:Ii$1[d$]||yi$1(Ii$1,d$,{})[d$],g$=m$.prototype;for(o$ in t$)n$=!(r$=Ci$1(h$?o$:d$+(p$?".":"#")+o$,e$.forced))&&f$&&Ai$1(f$,o$),a$=m$[o$],n$&&(c$=e$.dontCallGetSet?(l$=Ri$1(f$,o$))&&l$.value:f$[o$]),s$=n$&&c$?c$:t$[o$],n$&&typeof a$==typeof s$||(u$=e$.bind&&n$?vi$1(s$,mi$1):e$.wrap&&n$?bi$1(s$):_$&&gi$1(s$)?Si$1(s$):s$,(e$.sham||s$&&s$.sham||a$&&a$.sham)&&yi$1(u$,"sham",!0),yi$1(m$,o$,u$),_$&&(Ai$1(Ii$1,i$=d$+"Prototype")||yi$1(Ii$1,i$,{}),yi$1(Ii$1[i$],o$,s$),e$.real&&g$&&(r$||!g$[o$])&&yi$1(g$,o$,s$)))},Oi=Math.ceil,Ni$1=Math.floor,Di$1=Math.trunc||function(e$){var t$=+e$;return(t$>0?Ni$1:Oi)(t$)},Pi$1=Di$1,Li$1=function(e$){var t$=+e$;return t$!=t$||t$===0?0:Pi$1(t$)},ki$1=Li$1,Mi$1=Math.max,Ui$1=Math.min,xi$1=function(e$,t$){var r$=ki$1(e$);return r$<0?Mi$1(r$+t$,0):Ui$1(r$,t$)},Vi$1=Li$1,Fi$1=Math.min,Bi$1=function(e$){return e$>0?Fi$1(Vi$1(e$),9007199254740991):0},ji$1=Bi$1,Gi$1=function(e$){return ji$1(e$.length)},Wi$1=Z$1,Hi$1=xi$1,Ki=Gi$1,Yi$1=function(e$){return function(t$,r$,n$){var i$,o$=Wi$1(t$),s$=Ki(o$),a$=Hi$1(n$,s$);if(e$&&r$!=r$){for(;s$>a$;)if((i$=o$[a$++])!=i$)return!0}else for(;s$>a$;a$++)if((e$||a$ in o$)&&o$[a$]===r$)return e$||a$||0;return!e$&&-1}},qi$1={includes:Yi$1(!0),indexOf:Yi$1(!1)},zi$1=qi$1.includes;wi$1({target:"Array",proto:!0,forced:n(function(){return!Array(1).includes()})},{includes:function(e$){return zi$1(this,e$,arguments.length>1?arguments[1]:void 0)}});var Ji$1=ie$1,Xi$1=function(e$){return Ji$1[e$+"Prototype"]},Qi$1=Xi$1("Array").includes,Zi$1=te$1,$i$1=R$1,en$1=ht$1("match"),tn$1=function(e$){var t$;return Zi$1(e$)&&((t$=e$[en$1])!==void 0?!!t$:$i$1(e$)=="RegExp")},nn$1=tn$1,rn$1=TypeError,on$1={};on$1[ht$1("toStringTag")]="z";var sn$1=String(on$1)==="[object z]",an$1=sn$1,cn$1=w,dn$1=R$1,ln$1=ht$1("toStringTag"),un$1=Object,hn$1=dn$1(function(){return arguments}())=="Arguments",pn$1=an$1?dn$1:function(e$){var t$,r$,n$;return e$===void 0?"Undefined":e$===null?"Null":typeof(r$=function(i$,o$){try{return i$[o$]}catch{}}(t$=un$1(e$),ln$1))=="string"?r$:hn$1?dn$1(t$):(n$=dn$1(t$))=="Object"&&cn$1(t$.callee)?"Arguments":n$},_n$1=pn$1,En$1=String,fn=function(e$){if(_n$1(e$)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return En$1(e$)},mn$1=ht$1("match"),Tn$1=wi$1,Sn$1=function(e$){if(nn$1(e$))throw rn$1("The method doesn't accept regular expressions");return e$},gn=J$1,Rn$1=fn,Cn$1=function(e$){var t$=/./;try{"/./"[e$](t$)}catch{try{return t$[mn$1]=!1,"/./"[e$](t$)}catch{}}return!1},In=d("".indexOf);Tn$1({target:"String",proto:!0,forced:!Cn$1("includes")},{includes:function(e$){return!!~In(Rn$1(gn(this)),Rn$1(Sn$1(e$)),arguments.length>1?arguments[1]:void 0)}});var vn=Xi$1("String").includes,yn$1=l,An$1=Qi$1,bn$1=vn,wn$1=Array.prototype,On$1=String.prototype,Nn$1=function(e$){var t$=e$.includes;return e$===wn$1||yn$1(wn$1,e$)&&t$===wn$1.includes?An$1:typeof e$=="string"||e$===On$1||yn$1(On$1,e$)&&t$===On$1.includes?bn$1:t$},Dn$1=i(Nn$1),Pn=De$1,Ln$1=Je$1,kn$1=K$1,Mn$1=Gi$1,Un$1=TypeError,xn$1=function(e$){return function(t$,r$,n$,i$){Pn(r$);var o$=Ln$1(t$),s$=kn$1(o$),a$=Mn$1(o$),c$=e$?a$-1:0,u$=e$?-1:1;if(n$<2)for(;;){if(c$ in s$){i$=s$[c$],c$+=u$;break}if(c$+=u$,e$?c$<0:a$<=c$)throw Un$1("Reduce of empty array with no initial value")}for(;e$?c$>=0:a$>c$;c$+=u$)c$ in s$&&(i$=r$(i$,s$[c$],c$,o$));return i$}},Vn$1={left:xn$1(!1),right:xn$1(!0)},Fn$1=n,Bn$1=function(e$,t$){var r$=[][e$];return!!r$&&Fn$1(function(){r$.call(null,t$||function(){return 1},1)})},jn$1=typeof process<"u"&&R$1(process)=="process",Gn$1=Vn$1.left;wi$1({target:"Array",proto:!0,forced:!jn$1&&Ee$1>79&&Ee$1<83||!Bn$1("reduce")},{reduce:function(e$){var t$=arguments.length;return Gn$1(this,e$,t$,t$>1?arguments[1]:void 0)}});var Wn$1=Xi$1("Array").reduce,Hn$1=l,Kn=Wn$1,Yn=Array.prototype,qn=function(e$){var t$=e$.reduce;return e$===Yn||Hn$1(Yn,e$)&&t$===Yn.reduce?Kn:t$},zn$1=qn,Jn$1=i(zn$1);let Xn$1=!0,Qn$1=!0;function Zn$1(e$,t$,r$){const n$=e$.match(t$);return n$&&n$.length>=r$&&parseInt(n$[r$],10)}function $n$1(e$,t$,r$){if(!e$.RTCPeerConnection)return;const n$=e$.RTCPeerConnection.prototype,i$=n$.addEventListener;n$.addEventListener=function(s$,a$){if(s$!==t$)return i$.apply(this,arguments);const c$=u$=>{const l$=r$(u$);l$&&(a$.handleEvent?a$.handleEvent(l$):a$(l$))};return this._eventMap=this._eventMap||{},this._eventMap[t$]||(this._eventMap[t$]=new Map),this._eventMap[t$].set(a$,c$),i$.apply(this,[s$,c$])};const o$=n$.removeEventListener;n$.removeEventListener=function(s$,a$){if(s$!==t$||!this._eventMap||!this._eventMap[t$])return o$.apply(this,arguments);if(!this._eventMap[t$].has(a$))return o$.apply(this,arguments);const c$=this._eventMap[t$].get(a$);return this._eventMap[t$].delete(a$),this._eventMap[t$].size===0&&delete this._eventMap[t$],Object.keys(this._eventMap).length===0&&delete this._eventMap,o$.apply(this,[s$,c$])},Object.defineProperty(n$,"on"+t$,{get(){return this["_on"+t$]},set(s$){this["_on"+t$]&&(this.removeEventListener(t$,this["_on"+t$]),delete this["_on"+t$]),s$&&this.addEventListener(t$,this["_on"+t$]=s$)},enumerable:!0,configurable:!0})}function er$1(e$){return typeof e$!="boolean"?new Error("Argument type: "+typeof e$+". Please use a boolean."):(Xn$1=e$,e$?"adapter.js logging disabled":"adapter.js logging enabled")}function tr$1(e$){return typeof e$!="boolean"?new Error("Argument type: "+typeof e$+". Please use a boolean."):(Qn$1=!e$,"adapter.js deprecation warnings "+(e$?"disabled":"enabled"))}function ir$1(){if(typeof window=="object"){if(Xn$1)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function nr$1(e$,t$){Qn$1&&console.warn(e$+" is deprecated, please use "+t$+" instead.")}function rr$1(e$){return Object.prototype.toString.call(e$)==="[object Object]"}function or$1(e$){var t$;return rr$1(e$)?Jn$1(t$=Object.keys(e$)).call(t$,function(r$,n$){const i$=rr$1(e$[n$]),o$=i$?or$1(e$[n$]):e$[n$],s$=i$&&!Object.keys(o$).length;return o$===void 0||s$?r$:Object.assign(r$,{[n$]:o$})},{}):e$}function sr$1(e$,t$,r$){t$&&!r$.has(t$.id)&&(r$.set(t$.id,t$),Object.keys(t$).forEach(n$=>{n$.endsWith("Id")?sr$1(e$,e$.get(t$[n$]),r$):n$.endsWith("Ids")&&t$[n$].forEach(i$=>{sr$1(e$,e$.get(i$),r$)})}))}function ar$1(e$,t$,r$){const n$=r$?"outbound-rtp":"inbound-rtp",i$=new Map;if(t$===null)return i$;const o$=[];return e$.forEach(s$=>{s$.type==="track"&&s$.trackIdentifier===t$.id&&o$.push(s$)}),o$.forEach(s$=>{e$.forEach(a$=>{a$.type===n$&&a$.trackId===s$.id&&sr$1(e$,a$,i$)})}),i$}var cr$1=nt$1,dr$1=Ye$1("keys"),lr$1=function(e$){return dr$1[e$]||(dr$1[e$]=cr$1(e$))},ur$1=!n(function(){function e$(){}return e$.prototype.constructor=null,Object.getPrototypeOf(new e$)!==e$.prototype}),hr$1=Ze,pr$1=w,_r$1=Je$1,Er$1=ur$1,fr$1=lr$1("IE_PROTO"),mr$1=Object,Tr$1=mr$1.prototype,Sr$1=Er$1?mr$1.getPrototypeOf:function(e$){var t$=_r$1(e$);if(hr$1(t$,fr$1))return t$[fr$1];var r$=t$.constructor;return pr$1(r$)&&t$ instanceof r$?r$.prototype:t$ instanceof mr$1?Tr$1:null},gr=d,Rr$1=De$1,Cr$1=w,Ir$1=String,vr$1=TypeError,yr$1=function(e$,t$,r$){try{return gr(Rr$1(Object.getOwnPropertyDescriptor(e$,t$)[r$]))}catch{}},Ar$1=ii$1,br$1=function(e$){if(typeof e$=="object"||Cr$1(e$))return e$;throw vr$1("Can't set "+Ir$1(e$)+" as a prototype")},wr$1=Object.setPrototypeOf||("__proto__"in{}?function(){var e$,t$=!1,r$={};try{(e$=yr$1(Object.prototype,"__proto__","set"))(r$,[]),t$=r$ instanceof Array}catch{}return function(n$,i$){return Ar$1(n$),br$1(i$),t$?e$(n$,i$):n$.__proto__=i$,n$}}():void 0),Or$1={},Nr$1={},Dr$1=Ze,Pr$1=Z$1,Lr$1=qi$1.indexOf,kr$1=Nr$1,Mr=d([].push),Ur=function(e$,t$){var r$,n$=Pr$1(e$),i$=0,o$=[];for(r$ in n$)!Dr$1(kr$1,r$)&&Dr$1(n$,r$)&&Mr(o$,r$);for(;t$.length>i$;)Dr$1(n$,r$=t$[i$++])&&(~Lr$1(o$,r$)||Mr(o$,r$));return o$},xr$1=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Vr$1=Ur,Fr$1=xr$1.concat("length","prototype");Or$1.f=Object.getOwnPropertyNames||function(e$){return Vr$1(e$,Fr$1)};var Br$1={};Br$1.f=Object.getOwnPropertySymbols;var jr$1=ae$1,Gr$1=Or$1,Wr$1=Br$1,Hr$1=ii$1,Kr$1=d([].concat),Yr$1=jr$1("Reflect","ownKeys")||function(e$){var t$=Gr$1.f(Hr$1(e$)),r$=Wr$1.f;return r$?Kr$1(t$,r$(e$)):t$},qr$1=Ze,zr$1=Yr$1,Jr$1=O$1,Xr$1=Qt$1,Qr$1={},Zr$1=Ur,$r$1=xr$1,eo$1=Object.keys||function(e$){return Zr$1(e$,$r$1)},to$1=N$1,io$1=Zt$1,no$1=Qt$1,ro$1=ii$1,oo$1=Z$1,so$1=eo$1;Qr$1.f=to$1&&!io$1?Object.defineProperties:function(e$,t$){ro$1(e$);for(var r$,n$=oo$1(t$),i$=so$1(t$),o$=i$.length,s$=0;o$>s$;)no$1.f(e$,r$=i$[s$++],n$[r$]);return e$};var ao$1,co$1=ae$1("document","documentElement"),lo$1=ii$1,uo$1=Qr$1,ho$1=xr$1,po$1=Nr$1,_o$1=co$1,Eo$1=At$1,fo$1="prototype",mo$1="script",To$1=lr$1("IE_PROTO"),So=function(){},go$1=function(e$){return"<"+mo$1+">"+e$+"</"+mo$1+">"},Ro=function(e$){e$.write(go$1("")),e$.close();var t$=e$.parentWindow.Object;return e$=null,t$},Co$1=function(){try{ao$1=new ActiveXObject("htmlfile")}catch{}var e$,t$,r$;Co$1=typeof document<"u"?document.domain&&ao$1?Ro(ao$1):(t$=Eo$1("iframe"),r$="java"+mo$1+":",t$.style.display="none",_o$1.appendChild(t$),t$.src=String(r$),(e$=t$.contentWindow.document).open(),e$.write(go$1("document.F=Object")),e$.close(),e$.F):Ro(ao$1);for(var n$=ho$1.length;n$--;)delete Co$1[fo$1][ho$1[n$]];return Co$1()};po$1[To$1]=!0;var Io$1=Object.create||function(e$,t$){var r$;return e$!==null?(So[fo$1]=lo$1(e$),r$=new So,So[fo$1]=null,r$[To$1]=e$):r$=Co$1(),t$===void 0?r$:uo$1.f(r$,t$)},vo$1=te$1,yo$1=fi$1,Ao$1=Error,bo$1=d("".replace),wo$1=String(Ao$1("zxcasd").stack),Oo$1=/\n\s*at [^:]*:[^\n]*/,No$1=Oo$1.test(wo$1),Do$1=B,Po$1=!n(function(){var e$=Error("a");return!("stack"in e$)||(Object.defineProperty(e$,"stack",Do$1(1,7)),e$.stack!==7)}),Lo$1=fi$1,ko$1=function(e$,t$){if(No$1&&typeof e$=="string"&&!Ao$1.prepareStackTrace)for(;t$--;)e$=bo$1(e$,Oo$1,"");return e$},Mo$1=Po$1,Uo$1=Error.captureStackTrace,xo$1={},Vo$1=xo$1,Fo$1=ht$1("iterator"),Bo$1=Array.prototype,jo$1=function(e$){return e$!==void 0&&(Vo$1.Array===e$||Bo$1[Fo$1]===e$)},Go$1=pn$1,Wo$1=ke$1,Ho$1=Y,Ko$1=xo$1,Yo$1=ht$1("iterator"),qo$1=function(e$){if(!Ho$1(e$))return Wo$1(e$,Yo$1)||Wo$1(e$,"@@iterator")||Ko$1[Go$1(e$)]},zo$1=L,Jo$1=De$1,Xo$1=ii$1,Qo$1=be$1,Zo$1=qo$1,$o$1=TypeError,es$1=function(e$,t$){var r$=arguments.length<2?Zo$1(e$):t$;if(Jo$1(r$))return Xo$1(zo$1(r$,e$));throw $o$1(Qo$1(e$)+" is not iterable")},ts$1=L,is$1=ii$1,ns$1=ke$1,rs=function(e$,t$,r$){var n$,i$;is$1(e$);try{if(!(n$=ns$1(e$,"return"))){if(t$==="throw")throw r$;return r$}n$=ts$1(n$,e$)}catch(o$){i$=!0,n$=o$}if(t$==="throw")throw r$;if(i$)throw n$;return is$1(n$),r$},os$1=Xt$1,ss$1=L,as$1=ii$1,cs$1=be$1,ds$1=jo$1,ls$1=Gi$1,us$1=l,hs$1=es$1,ps$1=qo$1,_s$1=rs,Es$1=TypeError,fs$1=function(e$,t$){this.stopped=e$,this.result=t$},ms$1=fs$1.prototype,Ts$1=function(e$,t$,r$){var n$,i$,o$,s$,a$,c$,u$,l$=r$&&r$.that,d$=!(!r$||!r$.AS_ENTRIES),h$=!(!r$||!r$.IS_RECORD),p$=!(!r$||!r$.IS_ITERATOR),_$=!(!r$||!r$.INTERRUPTED),f$=os$1(t$,l$),m$=function(v$){return n$&&_s$1(n$,"normal",v$),new fs$1(!0,v$)},g$=function(v$){return d$?(as$1(v$),_$?f$(v$[0],v$[1],m$):f$(v$[0],v$[1])):_$?f$(v$,m$):f$(v$)};if(h$)n$=e$.iterator;else if(p$)n$=e$;else{if(!(i$=ps$1(e$)))throw Es$1(cs$1(e$)+" is not iterable");if(ds$1(i$)){for(o$=0,s$=ls$1(e$);s$>o$;o$++)if((a$=g$(e$[o$]))&&us$1(ms$1,a$))return a$;return new fs$1(!1)}n$=hs$1(e$,i$)}for(c$=h$?e$.next:n$.next;!(u$=ss$1(c$,n$)).done;){try{a$=g$(u$.value)}catch(v$){_s$1(n$,"throw",v$)}if(typeof a$=="object"&&a$&&us$1(ms$1,a$))return a$}return new fs$1(!1)},Ss$1=fn,gs$1=wi$1,Rs$1=l,Cs$1=Sr$1,Is$1=wr$1,vs$1=function(e$,t$,r$){for(var n$=zr$1(t$),i$=Xr$1.f,o$=Jr$1.f,s$=0;s$<n$.length;s$++){var a$=n$[s$];qr$1(e$,a$)||r$&&qr$1(r$,a$)||i$(e$,a$,o$(t$,a$))}},ys$1=Io$1,As$1=fi$1,bs=B,ws$1=function(e$,t$){vo$1(t$)&&"cause"in t$&&yo$1(e$,"cause",t$.cause)},Os$1=function(e$,t$,r$,n$){Mo$1&&(Uo$1?Uo$1(e$,t$):Lo$1(e$,"stack",ko$1(r$,n$)))},Ns$1=Ts$1,Ds$1=function(e$,t$){return e$===void 0?arguments.length<2?"":t$:Ss$1(e$)},Ps$1=ht$1("toStringTag"),Ls$1=Error,ks$1=[].push,Ms$1=function(e$,t$){var r$,n$=Rs$1(Us$1,this);Is$1?r$=Is$1(Ls$1(),n$?Cs$1(this):Us$1):(r$=n$?this:ys$1(Us$1),As$1(r$,Ps$1,"Error")),t$!==void 0&&As$1(r$,"message",Ds$1(t$)),Os$1(r$,Ms$1,r$.stack,1),arguments.length>2&&ws$1(r$,arguments[2]);var i$=[];return Ns$1(e$,ks$1,{that:i$}),As$1(r$,"errors",i$),r$};Is$1?Is$1(Ms$1,Ls$1):vs$1(Ms$1,Ls$1,{name:!0});var Us$1=Ms$1.prototype=ys$1(Ls$1.prototype,{constructor:bs(1,Ms$1),message:bs(1,""),name:bs(1,"AggregateError")});gs$1({global:!0,constructor:!0,arity:2},{AggregateError:Ms$1});var xs$1,Vs$1,Fs$1,Bs$1=w,js$1=h.WeakMap,Gs$1=Bs$1(js$1)&&/native code/.test(String(js$1)),Ws$1=h,Hs$1=te$1,Ks$1=fi$1,Ys$1=Ze,qs$1=He$1,zs$1=lr$1,Js$1=Nr$1,Xs$1="Object already initialized",Qs$1=Ws$1.TypeError,Zs$1=Ws$1.WeakMap;if(Gs$1||qs$1.state){var $s$1=qs$1.state||(qs$1.state=new Zs$1);$s$1.get=$s$1.get,$s$1.has=$s$1.has,$s$1.set=$s$1.set,xs$1=function(e$,t$){if($s$1.has(e$))throw Qs$1(Xs$1);return t$.facade=e$,$s$1.set(e$,t$),t$},Vs$1=function(e$){return $s$1.get(e$)||{}},Fs$1=function(e$){return $s$1.has(e$)}}else{var ea$1=zs$1("state");Js$1[ea$1]=!0,xs$1=function(e$,t$){if(Ys$1(e$,ea$1))throw Qs$1(Xs$1);return t$.facade=e$,Ks$1(e$,ea$1,t$),t$},Vs$1=function(e$){return Ys$1(e$,ea$1)?e$[ea$1]:{}},Fs$1=function(e$){return Ys$1(e$,ea$1)}}var ta$1,ia$1,na$1,ra$1={set:xs$1,get:Vs$1,has:Fs$1,enforce:function(e$){return Fs$1(e$)?Vs$1(e$):xs$1(e$,{})},getterFor:function(e$){return function(t$){var r$;if(!Hs$1(t$)||(r$=Vs$1(t$)).type!==e$)throw Qs$1("Incompatible receiver, "+e$+" required");return r$}}},oa$1=N$1,sa$1=Ze,aa$1=Function.prototype,ca$1=oa$1&&Object.getOwnPropertyDescriptor,da$1=sa$1(aa$1,"name"),la$1={EXISTS:da$1,PROPER:da$1&&(function(){}).name==="something",CONFIGURABLE:da$1&&(!oa$1||oa$1&&ca$1(aa$1,"name").configurable)},ua$1=fi$1,ha$1=function(e$,t$,r$,n$){return n$&&n$.enumerable?e$[t$]=r$:ua$1(e$,t$,r$),e$},pa$1=n,_a$1=w,Ea$1=te$1,fa$1=Io$1,ma$1=Sr$1,Ta$1=ha$1,Sa$1=ht$1("iterator"),ga$1=!1;[].keys&&("next"in(na$1=[].keys())?(ia$1=ma$1(ma$1(na$1)))!==Object.prototype&&(ta$1=ia$1):ga$1=!0);var Ra$1=!Ea$1(ta$1)||pa$1(function(){var e$={};return ta$1[Sa$1].call(e$)!==e$});_a$1((ta$1=Ra$1?{}:fa$1(ta$1))[Sa$1])||Ta$1(ta$1,Sa$1,function(){return this});var Ca$1={IteratorPrototype:ta$1,BUGGY_SAFARI_ITERATORS:ga$1},Ia=pn$1,va=sn$1?{}.toString:function(){return"[object "+Ia(this)+"]"},ya=sn$1,Aa$1=Qt$1.f,ba$1=fi$1,wa$1=Ze,Oa$1=va,Na$1=ht$1("toStringTag"),Da$1=function(e$,t$,r$,n$){if(e$){var i$=r$?e$:e$.prototype;wa$1(i$,Na$1)||Aa$1(i$,Na$1,{configurable:!0,value:t$}),n$&&!ya&&ba$1(i$,"toString",Oa$1)}},Pa$1=Ca$1.IteratorPrototype,La$1=Io$1,ka$1=B,Ma$1=Da$1,Ua$1=xo$1,xa$1=function(){return this},Va$1=function(e$,t$,r$,n$){var i$=t$+" Iterator";return e$.prototype=La$1(Pa$1,{next:ka$1(+!n$,r$)}),Ma$1(e$,i$,!1,!0),Ua$1[i$]=xa$1,e$},Fa$1=wi$1,Ba$1=L,ja$1=la$1,Ga$1=Va$1,Wa$1=Sr$1,Ha$1=Da$1,Ka$1=ha$1,Ya$1=xo$1,qa$1=Ca$1,za$1=ja$1.PROPER,Ja$1=qa$1.BUGGY_SAFARI_ITERATORS,Xa=ht$1("iterator"),Qa="keys",Za$1="values",$a$1="entries",ec$1=function(){return this},tc$1=function(e$,t$,r$,n$,i$,o$,s$){Ga$1(r$,t$,n$);var a$,c$,u$,l$=function(g$){if(g$===i$&&f$)return f$;if(!Ja$1&&g$ in p$)return p$[g$];switch(g$){case Qa:case Za$1:case $a$1:return function(){return new r$(this,g$)}}return function(){return new r$(this)}},d$=t$+" Iterator",h$=!1,p$=e$.prototype,_$=p$[Xa]||p$["@@iterator"]||i$&&p$[i$],f$=!Ja$1&&_$||l$(i$),m$=t$=="Array"&&p$.entries||_$;if(m$&&(a$=Wa$1(m$.call(new e$)))!==Object.prototype&&a$.next&&(Ha$1(a$,d$,!0,!0),Ya$1[d$]=ec$1),za$1&&i$==Za$1&&_$&&_$.name!==Za$1&&(h$=!0,f$=function(){return Ba$1(_$,this)}),i$)if(c$={values:l$(Za$1),keys:o$?f$:l$(Qa),entries:l$($a$1)},s$)for(u$ in c$)(Ja$1||h$||!(u$ in p$))&&Ka$1(p$,u$,c$[u$]);else Fa$1({target:t$,proto:!0,forced:Ja$1||h$},c$);return s$&&p$[Xa]!==f$&&Ka$1(p$,Xa,f$,{name:i$}),Ya$1[t$]=f$,c$},ic$1=function(e$,t$){return{value:e$,done:t$}},nc$1=Z$1,rc$1=xo$1,oc$1=ra$1;Qt$1.f;var sc$1=tc$1,ac$1=ic$1,cc$1="Array Iterator",dc$1=oc$1.set,lc$1=oc$1.getterFor(cc$1);sc$1(Array,"Array",function(e$,t$){dc$1(this,{type:cc$1,target:nc$1(e$),index:0,kind:t$})},function(){var e$=lc$1(this),t$=e$.target,r$=e$.kind,n$=e$.index++;return!t$||n$>=t$.length?(e$.target=void 0,ac$1(void 0,!0)):ac$1(r$=="keys"?n$:r$=="values"?t$[n$]:[n$,t$[n$]],!1)},"values"),rc$1.Arguments=rc$1.Array;var uc$1=Qt$1,hc$1=function(e$,t$,r$){return uc$1.f(e$,t$,r$)},pc$1=ae$1,_c$1=hc$1,Ec$1=N$1,fc$1=ht$1("species"),mc$1=l,Tc$1=TypeError,Sc$1=function(e$,t$){if(mc$1(t$,e$))return e$;throw Tc$1("Incorrect invocation")},gc$1=w,Rc$1=He$1,Cc$1=d(Function.toString);gc$1(Rc$1.inspectSource)||(Rc$1.inspectSource=function(e$){return Cc$1(e$)});var Ic$1=Rc$1.inspectSource,vc$1=d,yc$1=n,Ac$1=w,bc$1=pn$1,wc$1=Ic$1,Oc$1=function(){},Nc$1=[],Dc$1=ae$1("Reflect","construct"),Pc$1=/^\s*(?:class|function)\b/,Lc$1=vc$1(Pc$1.exec),kc$1=!Pc$1.exec(Oc$1),Mc$1=function(e$){if(!Ac$1(e$))return!1;try{return Dc$1(Oc$1,Nc$1,e$),!0}catch{return!1}},Uc$1=function(e$){if(!Ac$1(e$))return!1;switch(bc$1(e$)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return kc$1||!!Lc$1(Pc$1,wc$1(e$))}catch{return!0}};Uc$1.sham=!0;var xc$1,Vc$1,Fc$1,Bc$1,jc$1=!Dc$1||yc$1(function(){var e$;return Mc$1(Mc$1.call)||!Mc$1(Object)||!Mc$1(function(){e$=!0})||e$})?Uc$1:Mc$1,Gc$1=jc$1,Wc$1=be$1,Hc$1=TypeError,Kc$1=ii$1,Yc$1=function(e$){if(Gc$1(e$))return e$;throw Hc$1(Wc$1(e$)+" is not a constructor")},qc$1=Y,zc$1=ht$1("species"),Jc$1=function(e$,t$){var r$,n$=Kc$1(e$).constructor;return n$===void 0||qc$1(r$=Kc$1(n$)[zc$1])?t$:Yc$1(r$)},Xc$1=d([].slice),Qc$1=TypeError,Zc$1=function(e$,t$){if(e$<t$)throw Qc$1("Not enough arguments");return e$},$c$1=/(?:ipad|iphone|ipod).*applewebkit/i.test(ce),ed$1=h,td$1=m,id$1=Xt$1,nd$1=w,rd$1=Ze,od$1=n,sd=co$1,ad=Xc$1,cd$1=At$1,dd$1=Zc$1,ld$1=$c$1,ud$1=jn$1,hd$1=ed$1.setImmediate,pd$1=ed$1.clearImmediate,_d$1=ed$1.process,Ed$1=ed$1.Dispatch,fd$1=ed$1.Function,md$1=ed$1.MessageChannel,Td$1=ed$1.String,Sd$1=0,gd$1={},Rd$1="onreadystatechange";od$1(function(){xc$1=ed$1.location});var Cd$1=function(e$){if(rd$1(gd$1,e$)){var t$=gd$1[e$];delete gd$1[e$],t$()}},Id$1=function(e$){return function(){Cd$1(e$)}},vd$1=function(e$){Cd$1(e$.data)},yd$1=function(e$){ed$1.postMessage(Td$1(e$),xc$1.protocol+"//"+xc$1.host)};hd$1&&pd$1||(hd$1=function(e$){dd$1(arguments.length,1);var t$=nd$1(e$)?e$:fd$1(e$),r$=ad(arguments,1);return gd$1[++Sd$1]=function(){td$1(t$,void 0,r$)},Vc$1(Sd$1),Sd$1},pd$1=function(e$){delete gd$1[e$]},ud$1?Vc$1=function(e$){_d$1.nextTick(Id$1(e$))}:Ed$1&&Ed$1.now?Vc$1=function(e$){Ed$1.now(Id$1(e$))}:md$1&&!ld$1?(Bc$1=(Fc$1=new md$1).port2,Fc$1.port1.onmessage=vd$1,Vc$1=id$1(Bc$1.postMessage,Bc$1)):ed$1.addEventListener&&nd$1(ed$1.postMessage)&&!ed$1.importScripts&&xc$1&&xc$1.protocol!=="file:"&&!od$1(yd$1)?(Vc$1=yd$1,ed$1.addEventListener("message",vd$1,!1)):Vc$1=Rd$1 in cd$1("script")?function(e$){sd.appendChild(cd$1("script"))[Rd$1]=function(){sd.removeChild(this),Cd$1(e$)}}:function(e$){setTimeout(Id$1(e$),0)});var Ad$1={set:hd$1,clear:pd$1},bd$1=function(){this.head=null,this.tail=null};bd$1.prototype={add:function(e$){var t$={item:e$,next:null},r$=this.tail;r$?r$.next=t$:this.head=t$,this.tail=t$},get:function(){var e$=this.head;if(e$)return(this.head=e$.next)===null&&(this.tail=null),e$.item}};var wd$1,Od$1,Nd$1,Dd$1,Pd$1,Ld$1=bd$1,kd$1=/ipad|iphone|ipod/i.test(ce)&&typeof Pebble<"u",Md$1=/web0s(?!.*chrome)/i.test(ce),Ud$1=h,xd$1=Xt$1,Vd$1=O$1.f,Fd$1=Ad$1.set,Bd$1=Ld$1,jd$1=$c$1,Gd$1=kd$1,Wd$1=Md$1,Hd$1=jn$1,Kd$1=Ud$1.MutationObserver||Ud$1.WebKitMutationObserver,Yd$1=Ud$1.document,qd$1=Ud$1.process,zd$1=Ud$1.Promise,Jd$1=Vd$1(Ud$1,"queueMicrotask"),Xd$1=Jd$1&&Jd$1.value;if(!Xd$1){var Qd$1=new Bd$1,Zd$1=function(){var e$,t$;for(Hd$1&&(e$=qd$1.domain)&&e$.exit();t$=Qd$1.get();)try{t$()}catch(r$){throw Qd$1.head&&wd$1(),r$}e$&&e$.enter()};jd$1||Hd$1||Wd$1||!Kd$1||!Yd$1?!Gd$1&&zd$1&&zd$1.resolve?((Dd$1=zd$1.resolve(void 0)).constructor=zd$1,Pd$1=xd$1(Dd$1.then,Dd$1),wd$1=function(){Pd$1(Zd$1)}):Hd$1?wd$1=function(){qd$1.nextTick(Zd$1)}:(Fd$1=xd$1(Fd$1,Ud$1),wd$1=function(){Fd$1(Zd$1)}):(Od$1=!0,Nd$1=Yd$1.createTextNode(""),new Kd$1(Zd$1).observe(Nd$1,{characterData:!0}),wd$1=function(){Nd$1.data=Od$1=!Od$1}),Xd$1=function(e$){Qd$1.head||wd$1(),Qd$1.add(e$)}}var $d$1=Xd$1,el$1=function(e$){try{return{error:!1,value:e$()}}catch(t$){return{error:!0,value:t$}}},tl$1=h.Promise,il$1=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",nl$1=!il$1&&!jn$1&&typeof window=="object"&&typeof document=="object",rl$1=h,ol$1=tl$1,sl$1=w,al$1=Yt$1,cl$1=Ic$1,dl$1=ht$1,ll$1=nl$1,ul$1=il$1,hl$1=Ee$1,pl$1=ol$1&&ol$1.prototype,_l$1=dl$1("species"),El$1=!1,fl$1=sl$1(rl$1.PromiseRejectionEvent),ml$1=al$1("Promise",function(){var e$=cl$1(ol$1),t$=e$!==String(ol$1);if(!t$&&hl$1===66||!pl$1.catch||!pl$1.finally)return!0;if(!hl$1||hl$1<51||!/native code/.test(e$)){var r$=new ol$1(function(i$){i$(1)}),n$=function(i$){i$(function(){},function(){})};if((r$.constructor={})[_l$1]=n$,!(El$1=r$.then(function(){})instanceof n$))return!0}return!t$&&(ll$1||ul$1)&&!fl$1}),Tl$1={CONSTRUCTOR:ml$1,REJECTION_EVENT:fl$1,SUBCLASSING:El$1},Sl$1={},gl$1=De$1,Rl$1=TypeError,Cl$1=function(e$){var t$,r$;this.promise=new e$(function(n$,i$){if(t$!==void 0||r$!==void 0)throw Rl$1("Bad Promise constructor");t$=n$,r$=i$}),this.resolve=gl$1(t$),this.reject=gl$1(r$)};Sl$1.f=function(e$){return new Cl$1(e$)};var Il$1,vl$1,yl$1=wi$1,Al$1=jn$1,bl$1=h,wl$1=L,Ol$1=ha$1,Nl$1=Da$1,Dl$1=function(e$){var t$=pc$1(e$);Ec$1&&t$&&!t$[fc$1]&&_c$1(t$,fc$1,{configurable:!0,get:function(){return this}})},Pl$1=De$1,Ll$1=w,kl$1=te$1,Ml$1=Sc$1,Ul$1=Jc$1,xl$1=Ad$1.set,Vl$1=$d$1,Fl$1=function(e$,t$){try{arguments.length==1?console.error(e$):console.error(e$,t$)}catch{}},Bl$1=el$1,jl$1=Ld$1,Gl$1=ra$1,Wl$1=tl$1,Hl$1=Tl$1,Kl$1=Sl$1,Yl$1="Promise",ql$1=Hl$1.CONSTRUCTOR,zl$1=Hl$1.REJECTION_EVENT,Jl$1=Gl$1.getterFor(Yl$1),Xl$1=Gl$1.set,Ql$1=Wl$1&&Wl$1.prototype,Zl$1=Wl$1,$l$1=Ql$1,eu$1=bl$1.TypeError,tu$1=bl$1.document,iu$1=bl$1.process,nu$1=Kl$1.f,ru$1=nu$1,ou$1=!!(tu$1&&tu$1.createEvent&&bl$1.dispatchEvent),su$1="unhandledrejection",au$1=function(e$){var t$;return!(!kl$1(e$)||!Ll$1(t$=e$.then))&&t$},cu$1=function(e$,t$){var r$,n$,i$,o$=t$.value,s$=t$.state==1,a$=s$?e$.ok:e$.fail,c$=e$.resolve,u$=e$.reject,l$=e$.domain;try{a$?(s$||(t$.rejection===2&&pu$1(t$),t$.rejection=1),a$===!0?r$=o$:(l$&&l$.enter(),r$=a$(o$),l$&&(l$.exit(),i$=!0)),r$===e$.promise?u$(eu$1("Promise-chain cycle")):(n$=au$1(r$))?wl$1(n$,r$,c$,u$):c$(r$)):u$(o$)}catch(d$){l$&&!i$&&l$.exit(),u$(d$)}},du$1=function(e$,t$){e$.notified||(e$.notified=!0,Vl$1(function(){for(var r$,n$=e$.reactions;r$=n$.get();)cu$1(r$,e$);e$.notified=!1,t$&&!e$.rejection&&uu$1(e$)}))},lu$1=function(e$,t$,r$){var n$,i$;ou$1?((n$=tu$1.createEvent("Event")).promise=t$,n$.reason=r$,n$.initEvent(e$,!1,!0),bl$1.dispatchEvent(n$)):n$={promise:t$,reason:r$},!zl$1&&(i$=bl$1["on"+e$])?i$(n$):e$===su$1&&Fl$1("Unhandled promise rejection",r$)},uu$1=function(e$){wl$1(xl$1,bl$1,function(){var t$,r$=e$.facade,n$=e$.value;if(hu$1(e$)&&(t$=Bl$1(function(){Al$1?iu$1.emit("unhandledRejection",n$,r$):lu$1(su$1,r$,n$)}),e$.rejection=Al$1||hu$1(e$)?2:1,t$.error))throw t$.value})},hu$1=function(e$){return e$.rejection!==1&&!e$.parent},pu$1=function(e$){wl$1(xl$1,bl$1,function(){var t$=e$.facade;Al$1?iu$1.emit("rejectionHandled",t$):lu$1("rejectionhandled",t$,e$.value)})},_u$1=function(e$,t$,r$){return function(n$){e$(t$,n$,r$)}},Eu$1=function(e$,t$,r$){e$.done||(e$.done=!0,r$&&(e$=r$),e$.value=t$,e$.state=2,du$1(e$,!0))},fu$1=function(e$,t$,r$){if(!e$.done){e$.done=!0,r$&&(e$=r$);try{if(e$.facade===t$)throw eu$1("Promise can't be resolved itself");var n$=au$1(t$);n$?Vl$1(function(){var i$={done:!1};try{wl$1(n$,t$,_u$1(fu$1,i$,e$),_u$1(Eu$1,i$,e$))}catch(o$){Eu$1(i$,o$,e$)}}):(e$.value=t$,e$.state=1,du$1(e$,!1))}catch(i$){Eu$1({done:!1},i$,e$)}}};ql$1&&($l$1=(Zl$1=function(e$){Ml$1(this,$l$1),Pl$1(e$),wl$1(Il$1,this);var t$=Jl$1(this);try{e$(_u$1(fu$1,t$),_u$1(Eu$1,t$))}catch(r$){Eu$1(t$,r$)}}).prototype,(Il$1=function(e$){Xl$1(this,{type:Yl$1,done:!1,notified:!1,parent:!1,reactions:new jl$1,rejection:!1,state:0,value:void 0})}).prototype=Ol$1($l$1,"then",function(e$,t$){var r$=Jl$1(this),n$=nu$1(Ul$1(this,Zl$1));return r$.parent=!0,n$.ok=!Ll$1(e$)||e$,n$.fail=Ll$1(t$)&&t$,n$.domain=Al$1?iu$1.domain:void 0,r$.state==0?r$.reactions.add(n$):Vl$1(function(){cu$1(n$,r$)}),n$.promise}),vl$1=function(){var e$=new Il$1,t$=Jl$1(e$);this.promise=e$,this.resolve=_u$1(fu$1,t$),this.reject=_u$1(Eu$1,t$)},Kl$1.f=nu$1=function(e$){return e$===Zl$1||e$===void 0?new vl$1(e$):ru$1(e$)}),yl$1({global:!0,constructor:!0,wrap:!0,forced:ql$1},{Promise:Zl$1}),Nl$1(Zl$1,Yl$1,!1,!0),Dl$1(Yl$1);var mu$1=ht$1("iterator"),Tu$1=!1;try{var Su$1=0,gu$1={next:function(){return{done:!!Su$1++}},return:function(){Tu$1=!0}};gu$1[mu$1]=function(){return this},Array.from(gu$1,function(){throw 2})}catch{}var Ru$1=tl$1,Cu$1=function(e$,t$){if(!Tu$1)return!1;var r$=!1;try{var n$={};n$[mu$1]=function(){return{next:function(){return{done:r$=!0}}}},e$(n$)}catch{}return r$},Iu$1=Tl$1.CONSTRUCTOR||!Cu$1(function(e$){Ru$1.all(e$).then(void 0,function(){})}),vu$1=L,yu$1=De$1,Au$1=Sl$1,bu$1=el$1,wu$1=Ts$1;wi$1({target:"Promise",stat:!0,forced:Iu$1},{all:function(e$){var t$=this,r$=Au$1.f(t$),n$=r$.resolve,i$=r$.reject,o$=bu$1(function(){var s$=yu$1(t$.resolve),a$=[],c$=0,u$=1;wu$1(e$,function(l$){var d$=c$++,h$=!1;u$++,vu$1(s$,t$,l$).then(function(p$){h$||(h$=!0,a$[d$]=p$,--u$||n$(a$))},i$)}),--u$||n$(a$)});return o$.error&&i$(o$.value),r$.promise}});var Ou$1=wi$1,Nu$1=Tl$1.CONSTRUCTOR;tl$1&&tl$1.prototype,Ou$1({target:"Promise",proto:!0,forced:Nu$1,real:!0},{catch:function(e$){return this.then(void 0,e$)}});var Du$1=L,Pu$1=De$1,Lu$1=Sl$1,ku$1=el$1,Mu$1=Ts$1;wi$1({target:"Promise",stat:!0,forced:Iu$1},{race:function(e$){var t$=this,r$=Lu$1.f(t$),n$=r$.reject,i$=ku$1(function(){var o$=Pu$1(t$.resolve);Mu$1(e$,function(s$){Du$1(o$,t$,s$).then(r$.resolve,n$)})});return i$.error&&n$(i$.value),r$.promise}});var Uu$1=L,xu$1=Sl$1;wi$1({target:"Promise",stat:!0,forced:Tl$1.CONSTRUCTOR},{reject:function(e$){var t$=xu$1.f(this);return Uu$1(t$.reject,void 0,e$),t$.promise}});var Vu$1=ii$1,Fu$1=te$1,Bu$1=Sl$1,ju$1=function(e$,t$){if(Vu$1(e$),Fu$1(t$)&&t$.constructor===e$)return t$;var r$=Bu$1.f(e$);return(0,r$.resolve)(t$),r$.promise},Gu$1=wi$1,Wu$1=tl$1,Hu$1=Tl$1.CONSTRUCTOR,Ku$1=ju$1,Yu$1=ae$1("Promise"),qu$1=!Hu$1;Gu$1({target:"Promise",stat:!0,forced:!0},{resolve:function(e$){return Ku$1(qu$1&&this===Yu$1?Wu$1:this,e$)}});var zu$1=L,Ju$1=De$1,Xu$1=Sl$1,Qu$1=el$1,Zu$1=Ts$1;wi$1({target:"Promise",stat:!0,forced:Iu$1},{allSettled:function(e$){var t$=this,r$=Xu$1.f(t$),n$=r$.resolve,i$=r$.reject,o$=Qu$1(function(){var s$=Ju$1(t$.resolve),a$=[],c$=0,u$=1;Zu$1(e$,function(l$){var d$=c$++,h$=!1;u$++,zu$1(s$,t$,l$).then(function(p$){h$||(h$=!0,a$[d$]={status:"fulfilled",value:p$},--u$||n$(a$))},function(p$){h$||(h$=!0,a$[d$]={status:"rejected",reason:p$},--u$||n$(a$))})}),--u$||n$(a$)});return o$.error&&i$(o$.value),r$.promise}});var $u$1=L,eh$1=De$1,th$1=ae$1,ih=Sl$1,nh$1=el$1,rh=Ts$1,oh="No one promise resolved";wi$1({target:"Promise",stat:!0,forced:Iu$1},{any:function(e$){var t$=this,r$=th$1("AggregateError"),n$=ih.f(t$),i$=n$.resolve,o$=n$.reject,s$=nh$1(function(){var a$=eh$1(t$.resolve),c$=[],u$=0,l$=1,d$=!1;rh(e$,function(h$){var p$=u$++,_$=!1;l$++,$u$1(a$,t$,h$).then(function(f$){_$||d$||(d$=!0,i$(f$))},function(f$){_$||d$||(_$=!0,c$[p$]=f$,--l$||o$(new r$(c$,oh)))})}),--l$||o$(new r$(c$,oh))});return s$.error&&o$(s$.value),n$.promise}});var sh=wi$1,ah=tl$1,ch=n,dh=ae$1,lh=w,uh$1=Jc$1,hh$1=ju$1,ph$1=ah&&ah.prototype;sh({target:"Promise",proto:!0,real:!0,forced:!!ah&&ch(function(){ph$1.finally.call({then:function(){}},function(){})})},{finally:function(e$){var t$=uh$1(this,dh("Promise")),r$=lh(e$);return this.then(r$?function(n$){return hh$1(t$,e$()).then(function(){return n$})}:e$,r$?function(n$){return hh$1(t$,e$()).then(function(){throw n$})}:e$)}});var _h$1=d,Eh$1=Li$1,fh$1=fn,mh$1=J$1,Th$1=_h$1("".charAt),Sh$1=_h$1("".charCodeAt),gh$1=_h$1("".slice),Rh$1=function(e$){return function(t$,r$){var n$,i$,o$=fh$1(mh$1(t$)),s$=Eh$1(r$),a$=o$.length;return s$<0||s$>=a$?e$?"":void 0:(n$=Sh$1(o$,s$))<55296||n$>56319||s$+1===a$||(i$=Sh$1(o$,s$+1))<56320||i$>57343?e$?Th$1(o$,s$):n$:e$?gh$1(o$,s$,s$+2):i$-56320+(n$-55296<<10)+65536}},Ch$1={codeAt:Rh$1(!1),charAt:Rh$1(!0)},Ih$1=Ch$1.charAt,vh$1=fn,yh$1=ra$1,Ah$1=tc$1,bh$1=ic$1,wh$1="String Iterator",Oh$1=yh$1.set,Nh$1=yh$1.getterFor(wh$1);Ah$1(String,"String",function(e$){Oh$1(this,{type:wh$1,string:vh$1(e$),index:0})},function(){var e$,t$=Nh$1(this),r$=t$.string,n$=t$.index;return n$>=r$.length?bh$1(void 0,!0):(e$=Ih$1(r$,n$),t$.index+=e$.length,bh$1(e$,!1))});var Dh$1=ie$1.Promise,Ph$1={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Lh$1=h,kh$1=pn$1,Mh$1=fi$1,Uh$1=xo$1,xh$1=ht$1("toStringTag");for(var Vh$1 in Ph$1){var Fh$1=Lh$1[Vh$1],Bh$1=Fh$1&&Fh$1.prototype;Bh$1&&kh$1(Bh$1)!==xh$1&&Mh$1(Bh$1,xh$1,Vh$1),Uh$1[Vh$1]=Uh$1.Array}var jh$1=Dh$1,Gh$1=i(jh$1);const Wh$1=ir$1;function Hh$1(e$,t$){const r$=e$&&e$.navigator;if(!r$.mediaDevices)return;const n$=function(s$){if(typeof s$!="object"||s$.mandatory||s$.optional)return s$;const a$={};return Object.keys(s$).forEach(c$=>{if(c$==="require"||c$==="advanced"||c$==="mediaSource")return;const u$=typeof s$[c$]=="object"?s$[c$]:{ideal:s$[c$]};u$.exact!==void 0&&typeof u$.exact=="number"&&(u$.min=u$.max=u$.exact);const l$=function(d$,h$){return d$?d$+h$.charAt(0).toUpperCase()+h$.slice(1):h$==="deviceId"?"sourceId":h$};if(u$.ideal!==void 0){a$.optional=a$.optional||[];let d$={};typeof u$.ideal=="number"?(d$[l$("min",c$)]=u$.ideal,a$.optional.push(d$),d$={},d$[l$("max",c$)]=u$.ideal,a$.optional.push(d$)):(d$[l$("",c$)]=u$.ideal,a$.optional.push(d$))}u$.exact!==void 0&&typeof u$.exact!="number"?(a$.mandatory=a$.mandatory||{},a$.mandatory[l$("",c$)]=u$.exact):["min","max"].forEach(d$=>{u$[d$]!==void 0&&(a$.mandatory=a$.mandatory||{},a$.mandatory[l$(d$,c$)]=u$[d$])})}),s$.advanced&&(a$.optional=(a$.optional||[]).concat(s$.advanced)),a$},i$=function(s$,a$){if(t$.version>=61)return a$(s$);if((s$=JSON.parse(JSON.stringify(s$)))&&typeof s$.audio=="object"){const c$=function(u$,l$,d$){l$ in u$&&!(d$ in u$)&&(u$[d$]=u$[l$],delete u$[l$])};c$((s$=JSON.parse(JSON.stringify(s$))).audio,"autoGainControl","googAutoGainControl"),c$(s$.audio,"noiseSuppression","googNoiseSuppression"),s$.audio=n$(s$.audio)}if(s$&&typeof s$.video=="object"){let c$=s$.video.facingMode;c$=c$&&(typeof c$=="object"?c$:{ideal:c$});const u$=t$.version<66;if(c$&&(c$.exact==="user"||c$.exact==="environment"||c$.ideal==="user"||c$.ideal==="environment")&&(!r$.mediaDevices.getSupportedConstraints||!r$.mediaDevices.getSupportedConstraints().facingMode||u$)){let l$;if(delete s$.video.facingMode,c$.exact==="environment"||c$.ideal==="environment"?l$=["back","rear"]:c$.exact!=="user"&&c$.ideal!=="user"||(l$=["front"]),l$)return r$.mediaDevices.enumerateDevices().then(d$=>{let h$=(d$=d$.filter(p$=>p$.kind==="videoinput")).find(p$=>l$.some(_$=>{var f$;return Dn$1(f$=p$.label.toLowerCase()).call(f$,_$)}));return!h$&&d$.length&&Dn$1(l$).call(l$,"back")&&(h$=d$[d$.length-1]),h$&&(s$.video.deviceId=c$.exact?{exact:h$.deviceId}:{ideal:h$.deviceId}),s$.video=n$(s$.video),Wh$1("chrome: "+JSON.stringify(s$)),a$(s$)})}s$.video=n$(s$.video)}return Wh$1("chrome: "+JSON.stringify(s$)),a$(s$)},o$=function(s$){return t$.version>=64?s$:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[s$.name]||s$.name,message:s$.message,constraint:s$.constraint||s$.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r$.getUserMedia=(function(s$,a$,c$){i$(s$,u$=>{r$.webkitGetUserMedia(u$,a$,l$=>{c$&&c$(o$(l$))})})}).bind(r$),r$.mediaDevices.getUserMedia){const s$=r$.mediaDevices.getUserMedia.bind(r$.mediaDevices);r$.mediaDevices.getUserMedia=function(a$){return i$(a$,c$=>s$(c$).then(u$=>{if(c$.audio&&!u$.getAudioTracks().length||c$.video&&!u$.getVideoTracks().length)throw u$.getTracks().forEach(l$=>{l$.stop()}),new DOMException("","NotFoundError");return u$},u$=>Gh$1.reject(o$(u$))))}}}function Kh$1(e$){e$.MediaStream=e$.MediaStream||e$.webkitMediaStream}function Yh$1(e$){if(typeof e$=="object"&&e$.RTCPeerConnection&&!("ontrack"in e$.RTCPeerConnection.prototype)){Object.defineProperty(e$.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r$){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r$)},enumerable:!0,configurable:!0});const t$=e$.RTCPeerConnection.prototype.setRemoteDescription;e$.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r$=>{r$.stream.addEventListener("addtrack",n$=>{let i$;i$=e$.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(s$=>s$.track&&s$.track.id===n$.track.id):{track:n$.track};const o$=new Event("track");o$.track=n$.track,o$.receiver=i$,o$.transceiver={receiver:i$},o$.streams=[r$.stream],this.dispatchEvent(o$)}),r$.stream.getTracks().forEach(n$=>{let i$;i$=e$.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(s$=>s$.track&&s$.track.id===n$.id):{track:n$};const o$=new Event("track");o$.track=n$,o$.receiver=i$,o$.transceiver={receiver:i$},o$.streams=[r$.stream],this.dispatchEvent(o$)})},this.addEventListener("addstream",this._ontrackpoly)),t$.apply(this,arguments)}}else $n$1(e$,"track",t$=>(t$.transceiver||Object.defineProperty(t$,"transceiver",{value:{receiver:t$.receiver}}),t$))}function qh$1(e$){if(typeof e$=="object"&&e$.RTCPeerConnection&&!("getSenders"in e$.RTCPeerConnection.prototype)&&"createDTMFSender"in e$.RTCPeerConnection.prototype){const t$=function(i$,o$){return{track:o$,get dtmf(){return this._dtmf===void 0&&(o$.kind==="audio"?this._dtmf=i$.createDTMFSender(o$):this._dtmf=null),this._dtmf},_pc:i$}};if(!e$.RTCPeerConnection.prototype.getSenders){e$.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i$=e$.RTCPeerConnection.prototype.addTrack;e$.RTCPeerConnection.prototype.addTrack=function(s$,a$){let c$=i$.apply(this,arguments);return c$||(c$=t$(this,s$),this._senders.push(c$)),c$};const o$=e$.RTCPeerConnection.prototype.removeTrack;e$.RTCPeerConnection.prototype.removeTrack=function(s$){o$.apply(this,arguments);const a$=this._senders.indexOf(s$);a$!==-1&&this._senders.splice(a$,1)}}const r$=e$.RTCPeerConnection.prototype.addStream;e$.RTCPeerConnection.prototype.addStream=function(i$){this._senders=this._senders||[],r$.apply(this,[i$]),i$.getTracks().forEach(o$=>{this._senders.push(t$(this,o$))})};const n$=e$.RTCPeerConnection.prototype.removeStream;e$.RTCPeerConnection.prototype.removeStream=function(i$){this._senders=this._senders||[],n$.apply(this,[i$]),i$.getTracks().forEach(o$=>{const s$=this._senders.find(a$=>a$.track===o$);s$&&this._senders.splice(this._senders.indexOf(s$),1)})}}else if(typeof e$=="object"&&e$.RTCPeerConnection&&"getSenders"in e$.RTCPeerConnection.prototype&&"createDTMFSender"in e$.RTCPeerConnection.prototype&&e$.RTCRtpSender&&!("dtmf"in e$.RTCRtpSender.prototype)){const t$=e$.RTCPeerConnection.prototype.getSenders;e$.RTCPeerConnection.prototype.getSenders=function(){const r$=t$.apply(this,[]);return r$.forEach(n$=>n$._pc=this),r$},Object.defineProperty(e$.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function zh$1(e$){if(!e$.RTCPeerConnection)return;const t$=e$.RTCPeerConnection.prototype.getStats;e$.RTCPeerConnection.prototype.getStats=function(){const[r$,n$,i$]=arguments;if(arguments.length>0&&typeof r$=="function")return t$.apply(this,arguments);if(t$.length===0&&(arguments.length===0||typeof r$!="function"))return t$.apply(this,[]);const o$=function(a$){const c$={};return a$.result().forEach(u$=>{const l$={id:u$.id,timestamp:u$.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[u$.type]||u$.type};u$.names().forEach(d$=>{l$[d$]=u$.stat(d$)}),c$[l$.id]=l$}),c$},s$=function(a$){return new Map(Object.keys(a$).map(c$=>[c$,a$[c$]]))};if(arguments.length>=2){const a$=function(c$){n$(s$(o$(c$)))};return t$.apply(this,[a$,r$])}return new Gh$1((a$,c$)=>{t$.apply(this,[function(u$){a$(s$(o$(u$)))},c$])}).then(n$,i$)}}function Jh$1(e$){if(!(typeof e$=="object"&&e$.RTCPeerConnection&&e$.RTCRtpSender&&e$.RTCRtpReceiver))return;if(!("getStats"in e$.RTCRtpSender.prototype)){const r$=e$.RTCPeerConnection.prototype.getSenders;r$&&(e$.RTCPeerConnection.prototype.getSenders=function(){const i$=r$.apply(this,[]);return i$.forEach(o$=>o$._pc=this),i$});const n$=e$.RTCPeerConnection.prototype.addTrack;n$&&(e$.RTCPeerConnection.prototype.addTrack=function(){const i$=n$.apply(this,arguments);return i$._pc=this,i$}),e$.RTCRtpSender.prototype.getStats=function(){const i$=this;return this._pc.getStats().then(o$=>ar$1(o$,i$.track,!0))}}if(!("getStats"in e$.RTCRtpReceiver.prototype)){const r$=e$.RTCPeerConnection.prototype.getReceivers;r$&&(e$.RTCPeerConnection.prototype.getReceivers=function(){const n$=r$.apply(this,[]);return n$.forEach(i$=>i$._pc=this),n$}),$n$1(e$,"track",n$=>(n$.receiver._pc=n$.srcElement,n$)),e$.RTCRtpReceiver.prototype.getStats=function(){const n$=this;return this._pc.getStats().then(i$=>ar$1(i$,n$.track,!1))}}if(!("getStats"in e$.RTCRtpSender.prototype)||!("getStats"in e$.RTCRtpReceiver.prototype))return;const t$=e$.RTCPeerConnection.prototype.getStats;e$.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e$.MediaStreamTrack){const r$=arguments[0];let n$,i$,o$;return this.getSenders().forEach(s$=>{s$.track===r$&&(n$?o$=!0:n$=s$)}),this.getReceivers().forEach(s$=>(s$.track===r$&&(i$?o$=!0:i$=s$),s$.track===r$)),o$||n$&&i$?Gh$1.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n$?n$.getStats():i$?i$.getStats():Gh$1.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t$.apply(this,arguments)}}function Xh$1(e$){e$.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o$=>this._shimmedLocalStreams[o$][0])};const t$=e$.RTCPeerConnection.prototype.addTrack;e$.RTCPeerConnection.prototype.addTrack=function(o$,s$){if(!s$)return t$.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const a$=t$.apply(this,arguments);return this._shimmedLocalStreams[s$.id]?this._shimmedLocalStreams[s$.id].indexOf(a$)===-1&&this._shimmedLocalStreams[s$.id].push(a$):this._shimmedLocalStreams[s$.id]=[s$,a$],a$};const r$=e$.RTCPeerConnection.prototype.addStream;e$.RTCPeerConnection.prototype.addStream=function(o$){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o$.getTracks().forEach(c$=>{if(this.getSenders().find(l$=>l$.track===c$))throw new DOMException("Track already exists.","InvalidAccessError")});const s$=this.getSenders();r$.apply(this,arguments);const a$=this.getSenders().filter(c$=>s$.indexOf(c$)===-1);this._shimmedLocalStreams[o$.id]=[o$].concat(a$)};const n$=e$.RTCPeerConnection.prototype.removeStream;e$.RTCPeerConnection.prototype.removeStream=function(o$){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o$.id],n$.apply(this,arguments)};const i$=e$.RTCPeerConnection.prototype.removeTrack;e$.RTCPeerConnection.prototype.removeTrack=function(o$){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o$&&Object.keys(this._shimmedLocalStreams).forEach(s$=>{const a$=this._shimmedLocalStreams[s$].indexOf(o$);a$!==-1&&this._shimmedLocalStreams[s$].splice(a$,1),this._shimmedLocalStreams[s$].length===1&&delete this._shimmedLocalStreams[s$]}),i$.apply(this,arguments)}}function Qh$1(e$,t$){if(!e$.RTCPeerConnection)return;if(e$.RTCPeerConnection.prototype.addTrack&&t$.version>=65)return Xh$1(e$);const r$=e$.RTCPeerConnection.prototype.getLocalStreams;e$.RTCPeerConnection.prototype.getLocalStreams=function(){const c$=r$.apply(this);return this._reverseStreams=this._reverseStreams||{},c$.map(u$=>this._reverseStreams[u$.id])};const n$=e$.RTCPeerConnection.prototype.addStream;e$.RTCPeerConnection.prototype.addStream=function(c$){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c$.getTracks().forEach(u$=>{if(this.getSenders().find(d$=>d$.track===u$))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c$.id]){const u$=new e$.MediaStream(c$.getTracks());this._streams[c$.id]=u$,this._reverseStreams[u$.id]=c$,c$=u$}n$.apply(this,[c$])};const i$=e$.RTCPeerConnection.prototype.removeStream;function o$(c$,u$){let l$=u$.sdp;return Object.keys(c$._reverseStreams||[]).forEach(d$=>{const h$=c$._reverseStreams[d$],p$=c$._streams[h$.id];l$=l$.replace(new RegExp(p$.id,"g"),h$.id)}),new RTCSessionDescription({type:u$.type,sdp:l$})}e$.RTCPeerConnection.prototype.removeStream=function(c$){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i$.apply(this,[this._streams[c$.id]||c$]),delete this._reverseStreams[this._streams[c$.id]?this._streams[c$.id].id:c$.id],delete this._streams[c$.id]},e$.RTCPeerConnection.prototype.addTrack=function(c$,u$){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const l$=[].slice.call(arguments,1);if(l$.length!==1||!l$[0].getTracks().find(p$=>p$===c$))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(p$=>p$.track===c$))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const h$=this._streams[u$.id];if(h$)h$.addTrack(c$),Gh$1.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const p$=new e$.MediaStream([c$]);this._streams[u$.id]=p$,this._reverseStreams[p$.id]=u$,this.addStream(p$)}return this.getSenders().find(p$=>p$.track===c$)},["createOffer","createAnswer"].forEach(function(c$){const u$=e$.RTCPeerConnection.prototype[c$],l$={[c$](){const d$=arguments;return arguments.length&&typeof arguments[0]=="function"?u$.apply(this,[h$=>{const p$=o$(this,h$);d$[0].apply(null,[p$])},h$=>{d$[1]&&d$[1].apply(null,h$)},arguments[2]]):u$.apply(this,arguments).then(h$=>o$(this,h$))}};e$.RTCPeerConnection.prototype[c$]=l$[c$]});const s$=e$.RTCPeerConnection.prototype.setLocalDescription;e$.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(c$,u$){let l$=u$.sdp;return Object.keys(c$._reverseStreams||[]).forEach(d$=>{const h$=c$._reverseStreams[d$],p$=c$._streams[h$.id];l$=l$.replace(new RegExp(h$.id,"g"),p$.id)}),new RTCSessionDescription({type:u$.type,sdp:l$})}(this,arguments[0]),s$.apply(this,arguments)):s$.apply(this,arguments)};const a$=Object.getOwnPropertyDescriptor(e$.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e$.RTCPeerConnection.prototype,"localDescription",{get(){const c$=a$.get.apply(this);return c$.type===""?c$:o$(this,c$)}}),e$.RTCPeerConnection.prototype.removeTrack=function(c$){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c$._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(c$._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let u$;this._streams=this._streams||{},Object.keys(this._streams).forEach(l$=>{this._streams[l$].getTracks().find(d$=>c$.track===d$)&&(u$=this._streams[l$])}),u$&&(u$.getTracks().length===1?this.removeStream(this._reverseStreams[u$.id]):u$.removeTrack(c$.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Zh$1(e$,t$){!e$.RTCPeerConnection&&e$.webkitRTCPeerConnection&&(e$.RTCPeerConnection=e$.webkitRTCPeerConnection),e$.RTCPeerConnection&&t$.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r$){const n$=e$.RTCPeerConnection.prototype[r$],i$={[r$](){return arguments[0]=new(r$==="addIceCandidate"?e$.RTCIceCandidate:e$.RTCSessionDescription)(arguments[0]),n$.apply(this,arguments)}};e$.RTCPeerConnection.prototype[r$]=i$[r$]})}function $h$1(e$,t$){$n$1(e$,"negotiationneeded",r$=>{const n$=r$.target;if(!(t$.version<72||n$.getConfiguration&&n$.getConfiguration().sdpSemantics==="plan-b")||n$.signalingState==="stable")return r$})}var ep$1=Object.freeze({__proto__:null,fixNegotiationNeeded:$h$1,shimAddTrackRemoveTrack:Qh$1,shimAddTrackRemoveTrackWithNative:Xh$1,shimGetDisplayMedia:function(e$,t$){e$.navigator.mediaDevices&&"getDisplayMedia"in e$.navigator.mediaDevices||e$.navigator.mediaDevices&&(typeof t$=="function"?e$.navigator.mediaDevices.getDisplayMedia=function(r$){return t$(r$).then(n$=>{const i$=r$.video&&r$.video.width,o$=r$.video&&r$.video.height,s$=r$.video&&r$.video.frameRate;return r$.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n$,maxFrameRate:s$||3}},i$&&(r$.video.mandatory.maxWidth=i$),o$&&(r$.video.mandatory.maxHeight=o$),e$.navigator.mediaDevices.getUserMedia(r$)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:qh$1,shimGetStats:zh$1,shimGetUserMedia:Hh$1,shimMediaStream:Kh$1,shimOnTrack:Yh$1,shimPeerConnection:Zh$1,shimSenderReceiverGetStats:Jh$1});function tp$1(e$,t$){const r$=e$&&e$.navigator,n$=e$&&e$.MediaStreamTrack;if(r$.getUserMedia=function(i$,o$,s$){nr$1("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r$.mediaDevices.getUserMedia(i$).then(o$,s$)},!(t$.version>55&&"autoGainControl"in r$.mediaDevices.getSupportedConstraints())){const i$=function(s$,a$,c$){a$ in s$&&!(c$ in s$)&&(s$[c$]=s$[a$],delete s$[a$])},o$=r$.mediaDevices.getUserMedia.bind(r$.mediaDevices);if(r$.mediaDevices.getUserMedia=function(s$){return typeof s$=="object"&&typeof s$.audio=="object"&&(s$=JSON.parse(JSON.stringify(s$)),i$(s$.audio,"autoGainControl","mozAutoGainControl"),i$(s$.audio,"noiseSuppression","mozNoiseSuppression")),o$(s$)},n$&&n$.prototype.getSettings){const s$=n$.prototype.getSettings;n$.prototype.getSettings=function(){const a$=s$.apply(this,arguments);return i$(a$,"mozAutoGainControl","autoGainControl"),i$(a$,"mozNoiseSuppression","noiseSuppression"),a$}}if(n$&&n$.prototype.applyConstraints){const s$=n$.prototype.applyConstraints;n$.prototype.applyConstraints=function(a$){return this.kind==="audio"&&typeof a$=="object"&&(a$=JSON.parse(JSON.stringify(a$)),i$(a$,"autoGainControl","mozAutoGainControl"),i$(a$,"noiseSuppression","mozNoiseSuppression")),s$.apply(this,[a$])}}}}function ip$1(e$){typeof e$=="object"&&e$.RTCTrackEvent&&"receiver"in e$.RTCTrackEvent.prototype&&!("transceiver"in e$.RTCTrackEvent.prototype)&&Object.defineProperty(e$.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function np$1(e$,t$){if(typeof e$!="object"||!e$.RTCPeerConnection&&!e$.mozRTCPeerConnection)return;!e$.RTCPeerConnection&&e$.mozRTCPeerConnection&&(e$.RTCPeerConnection=e$.mozRTCPeerConnection),t$.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i$){const o$=e$.RTCPeerConnection.prototype[i$],s$={[i$](){return arguments[0]=new(i$==="addIceCandidate"?e$.RTCIceCandidate:e$.RTCSessionDescription)(arguments[0]),o$.apply(this,arguments)}};e$.RTCPeerConnection.prototype[i$]=s$[i$]});const r$={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n$=e$.RTCPeerConnection.prototype.getStats;e$.RTCPeerConnection.prototype.getStats=function(){const[i$,o$,s$]=arguments;return n$.apply(this,[i$||null]).then(a$=>{if(t$.version<53&&!o$)try{a$.forEach(c$=>{c$.type=r$[c$.type]||c$.type})}catch(c$){if(c$.name!=="TypeError")throw c$;a$.forEach((u$,l$)=>{a$.set(l$,Object.assign({},u$,{type:r$[u$.type]||u$.type}))})}return a$}).then(o$,s$)}}function rp$1(e$){if(typeof e$!="object"||!e$.RTCPeerConnection||!e$.RTCRtpSender||e$.RTCRtpSender&&"getStats"in e$.RTCRtpSender.prototype)return;const t$=e$.RTCPeerConnection.prototype.getSenders;t$&&(e$.RTCPeerConnection.prototype.getSenders=function(){const n$=t$.apply(this,[]);return n$.forEach(i$=>i$._pc=this),n$});const r$=e$.RTCPeerConnection.prototype.addTrack;r$&&(e$.RTCPeerConnection.prototype.addTrack=function(){const n$=r$.apply(this,arguments);return n$._pc=this,n$}),e$.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Gh$1.resolve(new Map)}}function op$1(e$){if(typeof e$!="object"||!e$.RTCPeerConnection||!e$.RTCRtpSender||e$.RTCRtpSender&&"getStats"in e$.RTCRtpReceiver.prototype)return;const t$=e$.RTCPeerConnection.prototype.getReceivers;t$&&(e$.RTCPeerConnection.prototype.getReceivers=function(){const r$=t$.apply(this,[]);return r$.forEach(n$=>n$._pc=this),r$}),$n$1(e$,"track",r$=>(r$.receiver._pc=r$.srcElement,r$)),e$.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function sp$1(e$){e$.RTCPeerConnection&&!("removeStream"in e$.RTCPeerConnection.prototype)&&(e$.RTCPeerConnection.prototype.removeStream=function(t$){nr$1("removeStream","removeTrack"),this.getSenders().forEach(r$=>{var n$;r$.track&&Dn$1(n$=t$.getTracks()).call(n$,r$.track)&&this.removeTrack(r$)})})}function ap$1(e$){e$.DataChannel&&!e$.RTCDataChannel&&(e$.RTCDataChannel=e$.DataChannel)}function cp$1(e$){if(typeof e$!="object"||!e$.RTCPeerConnection)return;const t$=e$.RTCPeerConnection.prototype.addTransceiver;t$&&(e$.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r$=arguments[1]&&arguments[1].sendEncodings;r$===void 0&&(r$=[]),r$=[...r$];const n$=r$.length>0;n$&&r$.forEach(o$=>{if("rid"in o$&&!/^[a-z0-9]{0,16}$/i.test(o$.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o$&&!(parseFloat(o$.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o$&&!(parseFloat(o$.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i$=t$.apply(this,arguments);if(n$){const{sender:o$}=i$,s$=o$.getParameters();(!("encodings"in s$)||s$.encodings.length===1&&Object.keys(s$.encodings[0]).length===0)&&(s$.encodings=r$,o$.sendEncodings=r$,this.setParametersPromises.push(o$.setParameters(s$).then(()=>{delete o$.sendEncodings}).catch(()=>{delete o$.sendEncodings})))}return i$})}function dp$1(e$){if(typeof e$!="object"||!e$.RTCRtpSender)return;const t$=e$.RTCRtpSender.prototype.getParameters;t$&&(e$.RTCRtpSender.prototype.getParameters=function(){const r$=t$.apply(this,arguments);return"encodings"in r$||(r$.encodings=[].concat(this.sendEncodings||[{}])),r$})}function lp$1(e$){if(typeof e$!="object"||!e$.RTCPeerConnection)return;const t$=e$.RTCPeerConnection.prototype.createOffer;e$.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Gh$1.all(this.setParametersPromises).then(()=>t$.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t$.apply(this,arguments)}}function up$1(e$){if(typeof e$!="object"||!e$.RTCPeerConnection)return;const t$=e$.RTCPeerConnection.prototype.createAnswer;e$.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Gh$1.all(this.setParametersPromises).then(()=>t$.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t$.apply(this,arguments)}}var hp$1=Object.freeze({__proto__:null,shimAddTransceiver:cp$1,shimCreateAnswer:up$1,shimCreateOffer:lp$1,shimGetDisplayMedia:function(e$,t$){e$.navigator.mediaDevices&&"getDisplayMedia"in e$.navigator.mediaDevices||e$.navigator.mediaDevices&&(e$.navigator.mediaDevices.getDisplayMedia=function(r$){if(!r$||!r$.video){const n$=new DOMException("getDisplayMedia without video constraints is undefined");return n$.name="NotFoundError",n$.code=8,Gh$1.reject(n$)}return r$.video===!0?r$.video={mediaSource:t$}:r$.video.mediaSource=t$,e$.navigator.mediaDevices.getUserMedia(r$)})},shimGetParameters:dp$1,shimGetUserMedia:tp$1,shimOnTrack:ip$1,shimPeerConnection:np$1,shimRTCDataChannel:ap$1,shimReceiverGetStats:op$1,shimRemoveStream:sp$1,shimSenderGetStats:rp$1});function pp$1(e$){if(typeof e$=="object"&&e$.RTCPeerConnection){if("getLocalStreams"in e$.RTCPeerConnection.prototype||(e$.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e$.RTCPeerConnection.prototype)){const t$=e$.RTCPeerConnection.prototype.addTrack;e$.RTCPeerConnection.prototype.addStream=function(r$){var n$;this._localStreams||(this._localStreams=[]),Dn$1(n$=this._localStreams).call(n$,r$)||this._localStreams.push(r$),r$.getAudioTracks().forEach(i$=>t$.call(this,i$,r$)),r$.getVideoTracks().forEach(i$=>t$.call(this,i$,r$))},e$.RTCPeerConnection.prototype.addTrack=function(r$){for(var n$=arguments.length,i$=new Array(n$>1?n$-1:0),o$=1;o$<n$;o$++)i$[o$-1]=arguments[o$];return i$&&i$.forEach(s$=>{var a$;this._localStreams?Dn$1(a$=this._localStreams).call(a$,s$)||this._localStreams.push(s$):this._localStreams=[s$]}),t$.apply(this,arguments)}}"removeStream"in e$.RTCPeerConnection.prototype||(e$.RTCPeerConnection.prototype.removeStream=function(t$){this._localStreams||(this._localStreams=[]);const r$=this._localStreams.indexOf(t$);if(r$===-1)return;this._localStreams.splice(r$,1);const n$=t$.getTracks();this.getSenders().forEach(i$=>{Dn$1(n$).call(n$,i$.track)&&this.removeTrack(i$)})})}}function _p$1(e$){if(typeof e$=="object"&&e$.RTCPeerConnection&&("getRemoteStreams"in e$.RTCPeerConnection.prototype||(e$.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e$.RTCPeerConnection.prototype))){Object.defineProperty(e$.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r$){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r$),this.addEventListener("track",this._onaddstreampoly=n$=>{n$.streams.forEach(i$=>{var o$;if(this._remoteStreams||(this._remoteStreams=[]),Dn$1(o$=this._remoteStreams).call(o$,i$))return;this._remoteStreams.push(i$);const s$=new Event("addstream");s$.stream=i$,this.dispatchEvent(s$)})})}});const t$=e$.RTCPeerConnection.prototype.setRemoteDescription;e$.RTCPeerConnection.prototype.setRemoteDescription=function(){const r$=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n$){n$.streams.forEach(i$=>{if(r$._remoteStreams||(r$._remoteStreams=[]),r$._remoteStreams.indexOf(i$)>=0)return;r$._remoteStreams.push(i$);const o$=new Event("addstream");o$.stream=i$,r$.dispatchEvent(o$)})}),t$.apply(r$,arguments)}}}function Ep$1(e$){if(typeof e$!="object"||!e$.RTCPeerConnection)return;const t$=e$.RTCPeerConnection.prototype,r$=t$.createOffer,n$=t$.createAnswer,i$=t$.setLocalDescription,o$=t$.setRemoteDescription,s$=t$.addIceCandidate;t$.createOffer=function(c$,u$){const l$=arguments.length>=2?arguments[2]:arguments[0],d$=r$.apply(this,[l$]);return u$?(d$.then(c$,u$),Gh$1.resolve()):d$},t$.createAnswer=function(c$,u$){const l$=arguments.length>=2?arguments[2]:arguments[0],d$=n$.apply(this,[l$]);return u$?(d$.then(c$,u$),Gh$1.resolve()):d$};let a$=function(c$,u$,l$){const d$=i$.apply(this,[c$]);return l$?(d$.then(u$,l$),Gh$1.resolve()):d$};t$.setLocalDescription=a$,a$=function(c$,u$,l$){const d$=o$.apply(this,[c$]);return l$?(d$.then(u$,l$),Gh$1.resolve()):d$},t$.setRemoteDescription=a$,a$=function(c$,u$,l$){const d$=s$.apply(this,[c$]);return l$?(d$.then(u$,l$),Gh$1.resolve()):d$},t$.addIceCandidate=a$}function fp$1(e$){const t$=e$&&e$.navigator;if(t$.mediaDevices&&t$.mediaDevices.getUserMedia){const r$=t$.mediaDevices,n$=r$.getUserMedia.bind(r$);t$.mediaDevices.getUserMedia=i$=>n$(mp$1(i$))}!t$.getUserMedia&&t$.mediaDevices&&t$.mediaDevices.getUserMedia&&(t$.getUserMedia=(function(r$,n$,i$){t$.mediaDevices.getUserMedia(r$).then(n$,i$)}).bind(t$))}function mp$1(e$){return e$&&e$.video!==void 0?Object.assign({},e$,{video:or$1(e$.video)}):e$}function Tp$1(e$){if(!e$.RTCPeerConnection)return;const t$=e$.RTCPeerConnection;e$.RTCPeerConnection=function(r$,n$){if(r$&&r$.iceServers){const i$=[];for(let o$=0;o$<r$.iceServers.length;o$++){let s$=r$.iceServers[o$];!s$.hasOwnProperty("urls")&&s$.hasOwnProperty("url")?(nr$1("RTCIceServer.url","RTCIceServer.urls"),s$=JSON.parse(JSON.stringify(s$)),s$.urls=s$.url,delete s$.url,i$.push(s$)):i$.push(r$.iceServers[o$])}r$.iceServers=i$}return new t$(r$,n$)},e$.RTCPeerConnection.prototype=t$.prototype,"generateCertificate"in t$&&Object.defineProperty(e$.RTCPeerConnection,"generateCertificate",{get:()=>t$.generateCertificate})}function Sp$1(e$){typeof e$=="object"&&e$.RTCTrackEvent&&"receiver"in e$.RTCTrackEvent.prototype&&!("transceiver"in e$.RTCTrackEvent.prototype)&&Object.defineProperty(e$.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function gp$1(e$){const t$=e$.RTCPeerConnection.prototype.createOffer;e$.RTCPeerConnection.prototype.createOffer=function(r$){if(r$){r$.offerToReceiveAudio!==void 0&&(r$.offerToReceiveAudio=!!r$.offerToReceiveAudio);const n$=this.getTransceivers().find(o$=>o$.receiver.track.kind==="audio");r$.offerToReceiveAudio===!1&&n$?n$.direction==="sendrecv"?n$.setDirection?n$.setDirection("sendonly"):n$.direction="sendonly":n$.direction==="recvonly"&&(n$.setDirection?n$.setDirection("inactive"):n$.direction="inactive"):r$.offerToReceiveAudio!==!0||n$||this.addTransceiver("audio",{direction:"recvonly"}),r$.offerToReceiveVideo!==void 0&&(r$.offerToReceiveVideo=!!r$.offerToReceiveVideo);const i$=this.getTransceivers().find(o$=>o$.receiver.track.kind==="video");r$.offerToReceiveVideo===!1&&i$?i$.direction==="sendrecv"?i$.setDirection?i$.setDirection("sendonly"):i$.direction="sendonly":i$.direction==="recvonly"&&(i$.setDirection?i$.setDirection("inactive"):i$.direction="inactive"):r$.offerToReceiveVideo!==!0||i$||this.addTransceiver("video",{direction:"recvonly"})}return t$.apply(this,arguments)}}function Rp$1(e$){typeof e$!="object"||e$.AudioContext||(e$.AudioContext=e$.webkitAudioContext)}var Cp$1=Object.freeze({__proto__:null,shimAudioContext:Rp$1,shimCallbacksAPI:Ep$1,shimConstraints:mp$1,shimCreateOfferLegacy:gp$1,shimGetUserMedia:fp$1,shimLocalStreamsAPI:pp$1,shimRTCIceServerUrls:Tp$1,shimRemoteStreamsAPI:_p$1,shimTrackEventTransceiver:Sp$1}),Ip$1=`	
\v\f\r \u2028\u2029\uFEFF`,vp$1=J$1,yp$1=fn,Ap$1=Ip$1,bp$1=d("".replace),wp$1=RegExp("^["+Ap$1+"]+"),Op$1=RegExp("(^|[^"+Ap$1+"])["+Ap$1+"]+$"),Np$1=function(e$){return function(t$){var r$=yp$1(vp$1(t$));return 1&e$&&(r$=bp$1(r$,wp$1,"")),2&e$&&(r$=bp$1(r$,Op$1,"$1")),r$}},Dp$1={start:Np$1(1),end:Np$1(2),trim:Np$1(3)},Pp$1=la$1.PROPER,Lp$1=n,kp$1=Ip$1,Mp$1=Dp$1.trim;wi$1({target:"String",proto:!0,forced:function(e$){return Lp$1(function(){return!!kp$1[e$]()||""[e$]()!==""||Pp$1&&kp$1[e$].name!==e$})}("trim")},{trim:function(){return Mp$1(this)}});var Up$1=Xi$1("String").trim,xp$1=l,Vp$1=Up$1,Fp$1=String.prototype,Bp$1=function(e$){var t$=e$.trim;return typeof e$=="string"||e$===Fp$1||xp$1(Fp$1,e$)&&t$===Fp$1.trim?Vp$1:t$},jp$1=i(Bp$1),Gp$1={exports:{}};(function(e$){const t$={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t$.localCName=t$.generateIdentifier(),t$.splitLines=function(r$){return r$.trim().split(`
`).map(n$=>n$.trim())},t$.splitSections=function(r$){return r$.split(`
m=`).map((n$,i$)=>(i$>0?"m="+n$:n$).trim()+`\r
`)},t$.getDescription=function(r$){const n$=t$.splitSections(r$);return n$&&n$[0]},t$.getMediaSections=function(r$){const n$=t$.splitSections(r$);return n$.shift(),n$},t$.matchPrefix=function(r$,n$){return t$.splitLines(r$).filter(i$=>i$.indexOf(n$)===0)},t$.parseCandidate=function(r$){let n$;n$=r$.indexOf("a=candidate:")===0?r$.substring(12).split(" "):r$.substring(10).split(" ");const i$={foundation:n$[0],component:{1:"rtp",2:"rtcp"}[n$[1]]||n$[1],protocol:n$[2].toLowerCase(),priority:parseInt(n$[3],10),ip:n$[4],address:n$[4],port:parseInt(n$[5],10),type:n$[7]};for(let o$=8;o$<n$.length;o$+=2)switch(n$[o$]){case"raddr":i$.relatedAddress=n$[o$+1];break;case"rport":i$.relatedPort=parseInt(n$[o$+1],10);break;case"tcptype":i$.tcpType=n$[o$+1];break;case"ufrag":i$.ufrag=n$[o$+1],i$.usernameFragment=n$[o$+1];break;default:i$[n$[o$]]===void 0&&(i$[n$[o$]]=n$[o$+1])}return i$},t$.writeCandidate=function(r$){const n$=[];n$.push(r$.foundation);const i$=r$.component;i$==="rtp"?n$.push(1):i$==="rtcp"?n$.push(2):n$.push(i$),n$.push(r$.protocol.toUpperCase()),n$.push(r$.priority),n$.push(r$.address||r$.ip),n$.push(r$.port);const o$=r$.type;return n$.push("typ"),n$.push(o$),o$!=="host"&&r$.relatedAddress&&r$.relatedPort&&(n$.push("raddr"),n$.push(r$.relatedAddress),n$.push("rport"),n$.push(r$.relatedPort)),r$.tcpType&&r$.protocol.toLowerCase()==="tcp"&&(n$.push("tcptype"),n$.push(r$.tcpType)),(r$.usernameFragment||r$.ufrag)&&(n$.push("ufrag"),n$.push(r$.usernameFragment||r$.ufrag)),"candidate:"+n$.join(" ")},t$.parseIceOptions=function(r$){return r$.substring(14).split(" ")},t$.parseRtpMap=function(r$){let n$=r$.substring(9).split(" ");const i$={payloadType:parseInt(n$.shift(),10)};return n$=n$[0].split("/"),i$.name=n$[0],i$.clockRate=parseInt(n$[1],10),i$.channels=n$.length===3?parseInt(n$[2],10):1,i$.numChannels=i$.channels,i$},t$.writeRtpMap=function(r$){let n$=r$.payloadType;r$.preferredPayloadType!==void 0&&(n$=r$.preferredPayloadType);const i$=r$.channels||r$.numChannels||1;return"a=rtpmap:"+n$+" "+r$.name+"/"+r$.clockRate+(i$!==1?"/"+i$:"")+`\r
`},t$.parseExtmap=function(r$){const n$=r$.substring(9).split(" ");return{id:parseInt(n$[0],10),direction:n$[0].indexOf("/")>0?n$[0].split("/")[1]:"sendrecv",uri:n$[1],attributes:n$.slice(2).join(" ")}},t$.writeExtmap=function(r$){return"a=extmap:"+(r$.id||r$.preferredId)+(r$.direction&&r$.direction!=="sendrecv"?"/"+r$.direction:"")+" "+r$.uri+(r$.attributes?" "+r$.attributes:"")+`\r
`},t$.parseFmtp=function(r$){const n$={};let i$;const o$=r$.substring(r$.indexOf(" ")+1).split(";");for(let s$=0;s$<o$.length;s$++)i$=o$[s$].trim().split("="),n$[i$[0].trim()]=i$[1];return n$},t$.writeFmtp=function(r$){let n$="",i$=r$.payloadType;if(r$.preferredPayloadType!==void 0&&(i$=r$.preferredPayloadType),r$.parameters&&Object.keys(r$.parameters).length){const o$=[];Object.keys(r$.parameters).forEach(s$=>{r$.parameters[s$]!==void 0?o$.push(s$+"="+r$.parameters[s$]):o$.push(s$)}),n$+="a=fmtp:"+i$+" "+o$.join(";")+`\r
`}return n$},t$.parseRtcpFb=function(r$){const n$=r$.substring(r$.indexOf(" ")+1).split(" ");return{type:n$.shift(),parameter:n$.join(" ")}},t$.writeRtcpFb=function(r$){let n$="",i$=r$.payloadType;return r$.preferredPayloadType!==void 0&&(i$=r$.preferredPayloadType),r$.rtcpFeedback&&r$.rtcpFeedback.length&&r$.rtcpFeedback.forEach(o$=>{n$+="a=rtcp-fb:"+i$+" "+o$.type+(o$.parameter&&o$.parameter.length?" "+o$.parameter:"")+`\r
`}),n$},t$.parseSsrcMedia=function(r$){const n$=r$.indexOf(" "),i$={ssrc:parseInt(r$.substring(7,n$),10)},o$=r$.indexOf(":",n$);return o$>-1?(i$.attribute=r$.substring(n$+1,o$),i$.value=r$.substring(o$+1)):i$.attribute=r$.substring(n$+1),i$},t$.parseSsrcGroup=function(r$){const n$=r$.substring(13).split(" ");return{semantics:n$.shift(),ssrcs:n$.map(i$=>parseInt(i$,10))}},t$.getMid=function(r$){const n$=t$.matchPrefix(r$,"a=mid:")[0];if(n$)return n$.substring(6)},t$.parseFingerprint=function(r$){const n$=r$.substring(14).split(" ");return{algorithm:n$[0].toLowerCase(),value:n$[1].toUpperCase()}},t$.getDtlsParameters=function(r$,n$){return{role:"auto",fingerprints:t$.matchPrefix(r$+n$,"a=fingerprint:").map(t$.parseFingerprint)}},t$.writeDtlsParameters=function(r$,n$){let i$="a=setup:"+n$+`\r
`;return r$.fingerprints.forEach(o$=>{i$+="a=fingerprint:"+o$.algorithm+" "+o$.value+`\r
`}),i$},t$.parseCryptoLine=function(r$){const n$=r$.substring(9).split(" ");return{tag:parseInt(n$[0],10),cryptoSuite:n$[1],keyParams:n$[2],sessionParams:n$.slice(3)}},t$.writeCryptoLine=function(r$){return"a=crypto:"+r$.tag+" "+r$.cryptoSuite+" "+(typeof r$.keyParams=="object"?t$.writeCryptoKeyParams(r$.keyParams):r$.keyParams)+(r$.sessionParams?" "+r$.sessionParams.join(" "):"")+`\r
`},t$.parseCryptoKeyParams=function(r$){if(r$.indexOf("inline:")!==0)return null;const n$=r$.substring(7).split("|");return{keyMethod:"inline",keySalt:n$[0],lifeTime:n$[1],mkiValue:n$[2]?n$[2].split(":")[0]:void 0,mkiLength:n$[2]?n$[2].split(":")[1]:void 0}},t$.writeCryptoKeyParams=function(r$){return r$.keyMethod+":"+r$.keySalt+(r$.lifeTime?"|"+r$.lifeTime:"")+(r$.mkiValue&&r$.mkiLength?"|"+r$.mkiValue+":"+r$.mkiLength:"")},t$.getCryptoParameters=function(r$,n$){return t$.matchPrefix(r$+n$,"a=crypto:").map(t$.parseCryptoLine)},t$.getIceParameters=function(r$,n$){const i$=t$.matchPrefix(r$+n$,"a=ice-ufrag:")[0],o$=t$.matchPrefix(r$+n$,"a=ice-pwd:")[0];return i$&&o$?{usernameFragment:i$.substring(12),password:o$.substring(10)}:null},t$.writeIceParameters=function(r$){let n$="a=ice-ufrag:"+r$.usernameFragment+`\r
a=ice-pwd:`+r$.password+`\r
`;return r$.iceLite&&(n$+=`a=ice-lite\r
`),n$},t$.parseRtpParameters=function(r$){const n$={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i$=t$.splitLines(r$)[0].split(" ");n$.profile=i$[2];for(let s$=3;s$<i$.length;s$++){const a$=i$[s$],c$=t$.matchPrefix(r$,"a=rtpmap:"+a$+" ")[0];if(c$){const u$=t$.parseRtpMap(c$),l$=t$.matchPrefix(r$,"a=fmtp:"+a$+" ");switch(u$.parameters=l$.length?t$.parseFmtp(l$[0]):{},u$.rtcpFeedback=t$.matchPrefix(r$,"a=rtcp-fb:"+a$+" ").map(t$.parseRtcpFb),n$.codecs.push(u$),u$.name.toUpperCase()){case"RED":case"ULPFEC":n$.fecMechanisms.push(u$.name.toUpperCase())}}}t$.matchPrefix(r$,"a=extmap:").forEach(s$=>{n$.headerExtensions.push(t$.parseExtmap(s$))});const o$=t$.matchPrefix(r$,"a=rtcp-fb:* ").map(t$.parseRtcpFb);return n$.codecs.forEach(s$=>{o$.forEach(a$=>{s$.rtcpFeedback.find(c$=>c$.type===a$.type&&c$.parameter===a$.parameter)||s$.rtcpFeedback.push(a$)})}),n$},t$.writeRtpDescription=function(r$,n$){let i$="";i$+="m="+r$+" ",i$+=n$.codecs.length>0?"9":"0",i$+=" "+(n$.profile||"UDP/TLS/RTP/SAVPF")+" ",i$+=n$.codecs.map(s$=>s$.preferredPayloadType!==void 0?s$.preferredPayloadType:s$.payloadType).join(" ")+`\r
`,i$+=`c=IN IP4 0.0.0.0\r
`,i$+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n$.codecs.forEach(s$=>{i$+=t$.writeRtpMap(s$),i$+=t$.writeFmtp(s$),i$+=t$.writeRtcpFb(s$)});let o$=0;return n$.codecs.forEach(s$=>{s$.maxptime>o$&&(o$=s$.maxptime)}),o$>0&&(i$+="a=maxptime:"+o$+`\r
`),n$.headerExtensions&&n$.headerExtensions.forEach(s$=>{i$+=t$.writeExtmap(s$)}),i$},t$.parseRtpEncodingParameters=function(r$){const n$=[],i$=t$.parseRtpParameters(r$),o$=i$.fecMechanisms.indexOf("RED")!==-1,s$=i$.fecMechanisms.indexOf("ULPFEC")!==-1,a$=t$.matchPrefix(r$,"a=ssrc:").map(h$=>t$.parseSsrcMedia(h$)).filter(h$=>h$.attribute==="cname"),c$=a$.length>0&&a$[0].ssrc;let u$;const l$=t$.matchPrefix(r$,"a=ssrc-group:FID").map(h$=>h$.substring(17).split(" ").map(p$=>parseInt(p$,10)));l$.length>0&&l$[0].length>1&&l$[0][0]===c$&&(u$=l$[0][1]),i$.codecs.forEach(h$=>{if(h$.name.toUpperCase()==="RTX"&&h$.parameters.apt){let p$={ssrc:c$,codecPayloadType:parseInt(h$.parameters.apt,10)};c$&&u$&&(p$.rtx={ssrc:u$}),n$.push(p$),o$&&(p$=JSON.parse(JSON.stringify(p$)),p$.fec={ssrc:c$,mechanism:s$?"red+ulpfec":"red"},n$.push(p$))}}),n$.length===0&&c$&&n$.push({ssrc:c$});let d$=t$.matchPrefix(r$,"b=");return d$.length&&(d$=d$[0].indexOf("b=TIAS:")===0?parseInt(d$[0].substring(7),10):d$[0].indexOf("b=AS:")===0?1e3*parseInt(d$[0].substring(5),10)*.95-16e3:void 0,n$.forEach(h$=>{h$.maxBitrate=d$})),n$},t$.parseRtcpParameters=function(r$){const n$={},i$=t$.matchPrefix(r$,"a=ssrc:").map(a$=>t$.parseSsrcMedia(a$)).filter(a$=>a$.attribute==="cname")[0];i$&&(n$.cname=i$.value,n$.ssrc=i$.ssrc);const o$=t$.matchPrefix(r$,"a=rtcp-rsize");n$.reducedSize=o$.length>0,n$.compound=o$.length===0;const s$=t$.matchPrefix(r$,"a=rtcp-mux");return n$.mux=s$.length>0,n$},t$.writeRtcpParameters=function(r$){let n$="";return r$.reducedSize&&(n$+=`a=rtcp-rsize\r
`),r$.mux&&(n$+=`a=rtcp-mux\r
`),r$.ssrc!==void 0&&r$.cname&&(n$+="a=ssrc:"+r$.ssrc+" cname:"+r$.cname+`\r
`),n$},t$.parseMsid=function(r$){let n$;const i$=t$.matchPrefix(r$,"a=msid:");if(i$.length===1)return n$=i$[0].substring(7).split(" "),{stream:n$[0],track:n$[1]};const o$=t$.matchPrefix(r$,"a=ssrc:").map(s$=>t$.parseSsrcMedia(s$)).filter(s$=>s$.attribute==="msid");return o$.length>0?(n$=o$[0].value.split(" "),{stream:n$[0],track:n$[1]}):void 0},t$.parseSctpDescription=function(r$){const n$=t$.parseMLine(r$),i$=t$.matchPrefix(r$,"a=max-message-size:");let o$;i$.length>0&&(o$=parseInt(i$[0].substring(19),10)),isNaN(o$)&&(o$=65536);const s$=t$.matchPrefix(r$,"a=sctp-port:");if(s$.length>0)return{port:parseInt(s$[0].substring(12),10),protocol:n$.fmt,maxMessageSize:o$};const a$=t$.matchPrefix(r$,"a=sctpmap:");if(a$.length>0){const c$=a$[0].substring(10).split(" ");return{port:parseInt(c$[0],10),protocol:c$[1],maxMessageSize:o$}}},t$.writeSctpDescription=function(r$,n$){let i$=[];return i$=r$.protocol!=="DTLS/SCTP"?["m="+r$.kind+" 9 "+r$.protocol+" "+n$.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n$.port+`\r
`]:["m="+r$.kind+" 9 "+r$.protocol+" "+n$.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n$.port+" "+n$.protocol+` 65535\r
`],n$.maxMessageSize!==void 0&&i$.push("a=max-message-size:"+n$.maxMessageSize+`\r
`),i$.join("")},t$.generateSessionId=function(){return Math.random().toString().substr(2,22)},t$.writeSessionBoilerplate=function(r$,n$,i$){let o$;const s$=n$!==void 0?n$:2;return o$=r$||t$.generateSessionId(),`v=0\r
o=`+(i$||"thisisadapterortc")+" "+o$+" "+s$+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t$.getDirection=function(r$,n$){const i$=t$.splitLines(r$);for(let o$=0;o$<i$.length;o$++)switch(i$[o$]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i$[o$].substring(2)}return n$?t$.getDirection(n$):"sendrecv"},t$.getKind=function(r$){return t$.splitLines(r$)[0].split(" ")[0].substring(2)},t$.isRejected=function(r$){return r$.split(" ",2)[1]==="0"},t$.parseMLine=function(r$){const n$=t$.splitLines(r$)[0].substring(2).split(" ");return{kind:n$[0],port:parseInt(n$[1],10),protocol:n$[2],fmt:n$.slice(3).join(" ")}},t$.parseOLine=function(r$){const n$=t$.matchPrefix(r$,"o=")[0].substring(2).split(" ");return{username:n$[0],sessionId:n$[1],sessionVersion:parseInt(n$[2],10),netType:n$[3],addressType:n$[4],address:n$[5]}},t$.isValidSDP=function(r$){if(typeof r$!="string"||r$.length===0)return!1;const n$=t$.splitLines(r$);for(let i$=0;i$<n$.length;i$++)if(n$[i$].length<2||n$[i$].charAt(1)!=="=")return!1;return!0},e$.exports=t$})(Gp$1);var Wp$1=Gp$1.exports,Hp$1=i(Wp$1),Kp$1=e({__proto__:null,default:Hp$1},[Wp$1]);function Yp$1(e$){if(!e$.RTCIceCandidate||e$.RTCIceCandidate&&"foundation"in e$.RTCIceCandidate.prototype)return;const t$=e$.RTCIceCandidate;e$.RTCIceCandidate=function(r$){if(typeof r$=="object"&&r$.candidate&&r$.candidate.indexOf("a=")===0&&((r$=JSON.parse(JSON.stringify(r$))).candidate=r$.candidate.substr(2)),r$.candidate&&r$.candidate.length){const n$=new t$(r$),i$=Hp$1.parseCandidate(r$.candidate),o$=Object.assign(n$,i$);return o$.toJSON=function(){return{candidate:o$.candidate,sdpMid:o$.sdpMid,sdpMLineIndex:o$.sdpMLineIndex,usernameFragment:o$.usernameFragment}},o$}return new t$(r$)},e$.RTCIceCandidate.prototype=t$.prototype,$n$1(e$,"icecandidate",r$=>(r$.candidate&&Object.defineProperty(r$,"candidate",{value:new e$.RTCIceCandidate(r$.candidate),writable:"false"}),r$))}function qp$1(e$){!e$.RTCIceCandidate||e$.RTCIceCandidate&&"relayProtocol"in e$.RTCIceCandidate.prototype||$n$1(e$,"icecandidate",t$=>{if(t$.candidate){const r$=Hp$1.parseCandidate(t$.candidate.candidate);r$.type==="relay"&&(t$.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r$.priority>>24])}return t$})}function zp$1(e$,t$){if(!e$.RTCPeerConnection)return;"sctp"in e$.RTCPeerConnection.prototype||Object.defineProperty(e$.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const r$=function(a$){if(!a$||!a$.sdp)return!1;const c$=Hp$1.splitSections(a$.sdp);return c$.shift(),c$.some(u$=>{const l$=Hp$1.parseMLine(u$);return l$&&l$.kind==="application"&&l$.protocol.indexOf("SCTP")!==-1})},n$=function(a$){const c$=a$.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c$===null||c$.length<2)return-1;const u$=parseInt(c$[1],10);return u$!=u$?-1:u$},i$=function(a$){let c$=65536;return t$.browser==="firefox"&&(c$=t$.version<57?a$===-1?16384:2147483637:t$.version<60?t$.version===57?65535:65536:2147483637),c$},o$=function(a$,c$){let u$=65536;t$.browser==="firefox"&&t$.version===57&&(u$=65535);const l$=Hp$1.matchPrefix(a$.sdp,"a=max-message-size:");return l$.length>0?u$=parseInt(l$[0].substr(19),10):t$.browser==="firefox"&&c$!==-1&&(u$=2147483637),u$},s$=e$.RTCPeerConnection.prototype.setRemoteDescription;e$.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t$.browser==="chrome"&&t$.version>=76){const{sdpSemantics:a$}=this.getConfiguration();a$==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(r$(arguments[0])){const a$=n$(arguments[0]),c$=i$(a$),u$=o$(arguments[0],a$);let l$;l$=c$===0&&u$===0?Number.POSITIVE_INFINITY:c$===0||u$===0?Math.max(c$,u$):Math.min(c$,u$);const d$={};Object.defineProperty(d$,"maxMessageSize",{get:()=>l$}),this._sctp=d$}return s$.apply(this,arguments)}}function Jp$1(e$){if(!e$.RTCPeerConnection||!("createDataChannel"in e$.RTCPeerConnection.prototype))return;function t$(n$,i$){const o$=n$.send;n$.send=function(){const s$=arguments[0],a$=s$.length||s$.size||s$.byteLength;if(n$.readyState==="open"&&i$.sctp&&a$>i$.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i$.sctp.maxMessageSize+" bytes)");return o$.apply(n$,arguments)}}const r$=e$.RTCPeerConnection.prototype.createDataChannel;e$.RTCPeerConnection.prototype.createDataChannel=function(){const n$=r$.apply(this,arguments);return t$(n$,this),n$},$n$1(e$,"datachannel",n$=>(t$(n$.channel,n$.target),n$))}function Xp$1(e$){if(!e$.RTCPeerConnection||"connectionState"in e$.RTCPeerConnection.prototype)return;const t$=e$.RTCPeerConnection.prototype;Object.defineProperty(t$,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t$,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r$){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r$&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r$)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r$=>{const n$=t$[r$];t$[r$]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i$=>{const o$=i$.target;if(o$._lastConnectionState!==o$.connectionState){o$._lastConnectionState=o$.connectionState;const s$=new Event("connectionstatechange",i$);o$.dispatchEvent(s$)}return i$},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n$.apply(this,arguments)}})}function Qp$1(e$,t$){if(!e$.RTCPeerConnection||t$.browser==="chrome"&&t$.version>=71||t$.browser==="safari"&&t$.version>=605)return;const r$=e$.RTCPeerConnection.prototype.setRemoteDescription;e$.RTCPeerConnection.prototype.setRemoteDescription=function(n$){if(n$&&n$.sdp&&n$.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i$=n$.sdp.split(`
`).filter(o$=>jp$1(o$).call(o$)!=="a=extmap-allow-mixed").join(`
`);e$.RTCSessionDescription&&n$ instanceof e$.RTCSessionDescription?arguments[0]=new e$.RTCSessionDescription({type:n$.type,sdp:i$}):n$.sdp=i$}return r$.apply(this,arguments)}}function Zp$1(e$,t$){if(!e$.RTCPeerConnection||!e$.RTCPeerConnection.prototype)return;const r$=e$.RTCPeerConnection.prototype.addIceCandidate;r$&&r$.length!==0&&(e$.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t$.browser==="chrome"&&t$.version<78||t$.browser==="firefox"&&t$.version<68||t$.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Gh$1.resolve():r$.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Gh$1.resolve())})}function $p$1(e$,t$){if(!e$.RTCPeerConnection||!e$.RTCPeerConnection.prototype)return;const r$=e$.RTCPeerConnection.prototype.setLocalDescription;r$&&r$.length!==0&&(e$.RTCPeerConnection.prototype.setLocalDescription=function(){let n$=arguments[0]||{};if(typeof n$!="object"||n$.type&&n$.sdp)return r$.apply(this,arguments);if(n$={type:n$.type,sdp:n$.sdp},!n$.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n$.type="offer";break;default:n$.type="answer"}return n$.sdp||n$.type!=="offer"&&n$.type!=="answer"?r$.apply(this,[n$]):(n$.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i$=>r$.apply(this,[i$]))})}var e_$1=Object.freeze({__proto__:null,removeExtmapAllowMixed:Qp$1,shimAddIceCandidateNullOrEmpty:Zp$1,shimConnectionState:Xp$1,shimMaxMessageSize:zp$1,shimParameterlessSetLocalDescription:$p$1,shimRTCIceCandidate:Yp$1,shimRTCIceCandidateRelayProtocol:qp$1,shimSendThrowTypeError:Jp$1});(function(){let{window:e$}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const r$=ir$1,n$=function(o$){const s$={browser:null,version:null};if(o$===void 0||!o$.navigator)return s$.browser="Not a browser.",s$;const{navigator:a$}=o$;if(a$.mozGetUserMedia)s$.browser="firefox",s$.version=Zn$1(a$.userAgent,/Firefox\/(\d+)\./,1);else if(a$.webkitGetUserMedia||o$.isSecureContext===!1&&o$.webkitRTCPeerConnection)s$.browser="chrome",s$.version=Zn$1(a$.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!o$.RTCPeerConnection||!a$.userAgent.match(/AppleWebKit\/(\d+)\./))return s$.browser="Not a supported browser.",s$;s$.browser="safari",s$.version=Zn$1(a$.userAgent,/AppleWebKit\/(\d+)\./,1),s$.supportsUnifiedPlan=o$.RTCRtpTransceiver&&"currentDirection"in o$.RTCRtpTransceiver.prototype}return s$}(e$),i$={browserDetails:n$,commonShim:e_$1,extractVersion:Zn$1,disableLog:er$1,disableWarnings:tr$1,sdp:Kp$1};switch(n$.browser){case"chrome":if(!ep$1||!Zh$1||!t$.shimChrome)return r$("Chrome shim is not included in this adapter release."),i$;if(n$.version===null)return r$("Chrome shim can not determine version, not shimming."),i$;r$("adapter.js shimming chrome."),i$.browserShim=ep$1,Zp$1(e$,n$),$p$1(e$),Hh$1(e$,n$),Kh$1(e$),Zh$1(e$,n$),Yh$1(e$),Qh$1(e$,n$),qh$1(e$),zh$1(e$),Jh$1(e$),$h$1(e$,n$),Yp$1(e$),qp$1(e$),Xp$1(e$),zp$1(e$,n$),Jp$1(e$),Qp$1(e$,n$);break;case"firefox":if(!hp$1||!np$1||!t$.shimFirefox)return r$("Firefox shim is not included in this adapter release."),i$;r$("adapter.js shimming firefox."),i$.browserShim=hp$1,Zp$1(e$,n$),$p$1(e$),tp$1(e$,n$),np$1(e$,n$),ip$1(e$),sp$1(e$),rp$1(e$),op$1(e$),ap$1(e$),cp$1(e$),dp$1(e$),lp$1(e$),up$1(e$),Yp$1(e$),Xp$1(e$),zp$1(e$,n$),Jp$1(e$);break;case"safari":if(!Cp$1||!t$.shimSafari)return r$("Safari shim is not included in this adapter release."),i$;r$("adapter.js shimming safari."),i$.browserShim=Cp$1,Zp$1(e$,n$),$p$1(e$),Tp$1(e$),gp$1(e$),Ep$1(e$),pp$1(e$),_p$1(e$),Sp$1(e$),fp$1(e$),Rp$1(e$),Yp$1(e$),qp$1(e$),zp$1(e$,n$),Jp$1(e$),Qp$1(e$,n$);break;default:r$("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var t_$1=Xi$1("Array").keys,i_$1=pn$1,n_$1=Ze,r_$1=l,o_$1=t_$1,s_$1=Array.prototype,a_$1={DOMTokenList:!0,NodeList:!0},c_$1=function(e$){var t$=e$.keys;return e$===s_$1||r_$1(s_$1,e$)&&t$===s_$1.keys||n_$1(a_$1,i_$1(e$))?o_$1:t$},d_$1=i(c_$1),l_$1=be$1,u_$1=TypeError,h_$1=Ct$1,p_$1=Qt$1,__$1=B,E_$1=function(e$,t$,r$){var n$=h_$1(t$);n$ in e$?p_$1.f(e$,n$,__$1(0,r$)):e$[n$]=r$},f_$1=xi$1,m_$1=Gi$1,T_$1=E_$1,S_$1=Array,g_$1=Math.max,R_$1=function(e$,t$,r$){for(var n$=m_$1(e$),i$=f_$1(t$,n$),o$=f_$1(r$===void 0?n$:r$,n$),s$=S_$1(g_$1(o$-i$,0)),a$=0;i$<o$;i$++,a$++)T_$1(s$,a$,e$[i$]);return s$.length=a$,s$},C_=R_$1,I_$1=Math.floor,v_$1=function(e$,t$){var r$=e$.length,n$=I_$1(r$/2);return r$<8?y_$1(e$,t$):A_$1(e$,v_$1(C_(e$,0,n$),t$),v_$1(C_(e$,n$),t$),t$)},y_$1=function(e$,t$){for(var r$,n$,i$=e$.length,o$=1;o$<i$;){for(n$=o$,r$=e$[o$];n$&&t$(e$[n$-1],r$)>0;)e$[n$]=e$[--n$];n$!==o$++&&(e$[n$]=r$)}return e$},A_$1=function(e$,t$,r$,n$){for(var i$=t$.length,o$=r$.length,s$=0,a$=0;s$<i$||a$<o$;)e$[s$+a$]=s$<i$&&a$<o$?n$(t$[s$],r$[a$])<=0?t$[s$++]:r$[a$++]:s$<i$?t$[s$++]:r$[a$++];return e$},b_$1=v_$1,w_$1=ce.match(/firefox\/(\d+)/i),O_$1=!!w_$1&&+w_$1[1],N_$1=/MSIE|Trident/.test(ce),D_$1=ce.match(/AppleWebKit\/(\d+)\./),P_$1=!!D_$1&&+D_$1[1],L_$1=wi$1,k_$1=d,M_$1=De$1,U_$1=Je$1,x_$1=Gi$1,V_$1=function(e$,t$){if(!delete e$[t$])throw u_$1("Cannot delete property "+l_$1(t$)+" of "+l_$1(e$))},F_$1=fn,B_$1=n,j_$1=b_$1,G_$1=Bn$1,W_$1=O_$1,H_$1=N_$1,K_$1=Ee$1,Y_$1=P_$1,q_$1=[],z_$1=k_$1(q_$1.sort),J_$1=k_$1(q_$1.push),X_$1=B_$1(function(){q_$1.sort(void 0)}),Q_$1=B_$1(function(){q_$1.sort(null)}),Z_$1=G_$1("sort"),$_$1=!B_$1(function(){if(K_$1)return K_$1<70;if(!(W_$1&&W_$1>3)){if(H_$1)return!0;if(Y_$1)return Y_$1<603;var e$,t$,r$,n$,i$="";for(e$=65;e$<76;e$++){switch(t$=String.fromCharCode(e$),e$){case 66:case 69:case 70:case 72:r$=3;break;case 68:case 71:r$=4;break;default:r$=2}for(n$=0;n$<47;n$++)q_$1.push({k:t$+n$,v:r$})}for(q_$1.sort(function(o$,s$){return s$.v-o$.v}),n$=0;n$<q_$1.length;n$++)t$=q_$1[n$].k.charAt(0),i$.charAt(i$.length-1)!==t$&&(i$+=t$);return i$!=="DGBEFHACIJK"}});L_$1({target:"Array",proto:!0,forced:X_$1||!Q_$1||!Z_$1||!$_$1},{sort:function(e$){e$!==void 0&&M_$1(e$);var t$=U_$1(this);if($_$1)return e$===void 0?z_$1(t$):z_$1(t$,e$);var r$,n$,i$=[],o$=x_$1(t$);for(n$=0;n$<o$;n$++)n$ in t$&&J_$1(i$,t$[n$]);for(j_$1(i$,function(s$){return function(a$,c$){return c$===void 0?-1:a$===void 0?1:s$!==void 0?+s$(a$,c$)||0:F_$1(a$)>F_$1(c$)?1:-1}}(e$)),r$=x_$1(i$),n$=0;n$<r$;)t$[n$]=i$[n$++];for(;n$<o$;)V_$1(t$,n$++);return t$}});var eE$1,tE$1,iE$1=Xi$1("Array").sort,nE$1=l,rE$1=iE$1,oE$1=Array.prototype,sE$1=function(e$){var t$=e$.sort;return e$===oE$1||nE$1(oE$1,e$)&&t$===oE$1.sort?rE$1:t$},aE$1=i(sE$1),cE$1={exports:{}};eE$1=cE$1,tE$1=cE$1.exports,function(e$,t$){var r$="function",n$="undefined",i$="object",o$="string",s$="major",a$="model",c$="name",u$="type",l$="vendor",d$="version",h$="architecture",p$="console",_$="mobile",f$="tablet",m$="smarttv",g$="wearable",v$="embedded",y$="Amazon",S$="Apple",b$="ASUS",$$="BlackBerry",C$="Browser",N$="Chrome",k$="Firefox",O$="Google",U$="Huawei",x$="LG",F$="Microsoft",L$="Motorola",M$="Opera",V$="Samsung",A$="Sharp",I$="Sony",P$="Xiaomi",w$="Zebra",E$="Facebook",T$="Chromium OS",R$="Mac OS",D$=function(K$){for(var B$={},H$=0;H$<K$.length;H$++)B$[K$[H$].toUpperCase()]=K$[H$];return B$},j$=function(K$,B$){return typeof K$===o$&&G$(B$).indexOf(G$(K$))!==-1},G$=function(K$){return K$.toLowerCase()},z$=function(K$,B$){if(typeof K$===o$)return K$=K$.replace(/^\s\s*/,""),typeof B$===n$?K$:K$.substring(0,350)},J$=function(K$,B$){for(var H$,X$,t0,q$,W$,Z$,o5=0;o5<B$.length&&!W$;){var _q=B$[o5],l5=B$[o5+1];for(H$=X$=0;H$<_q.length&&!W$&&_q[H$];)if(W$=_q[H$++].exec(K$))for(t0=0;t0<l5.length;t0++)Z$=W$[++X$],typeof(q$=l5[t0])===i$&&q$.length>0?q$.length===2?typeof q$[1]==r$?this[q$[0]]=q$[1].call(this,Z$):this[q$[0]]=q$[1]:q$.length===3?typeof q$[1]!==r$||q$[1].exec&&q$[1].test?this[q$[0]]=Z$?Z$.replace(q$[1],q$[2]):t$:this[q$[0]]=Z$?q$[1].call(this,Z$,q$[2]):t$:q$.length===4&&(this[q$[0]]=Z$?q$[3].call(this,Z$.replace(q$[1],q$[2])):t$):this[q$]=Z$||t$;o5+=2}},t5=function(K$,B$){for(var H$ in B$)if(typeof B$[H$]===i$&&B$[H$].length>0){for(var X$=0;X$<B$[H$].length;X$++)if(j$(B$[H$][X$],K$))return H$==="?"?t$:H$}else if(j$(B$[H$],K$))return H$==="?"?t$:H$;return K$},a5={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},s5={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[d$,[c$,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[d$,[c$,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[c$,d$],[/opios[\/ ]+([\w\.]+)/i],[d$,[c$,M$+" Mini"]],[/\bopr\/([\w\.]+)/i],[d$,[c$,M$]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[c$,d$],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[d$,[c$,"UC"+C$]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[d$,[c$,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[d$,[c$,"WeChat"]],[/konqueror\/([\w\.]+)/i],[d$,[c$,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[d$,[c$,"IE"]],[/yabrowser\/([\w\.]+)/i],[d$,[c$,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[c$,/(.+)/,"$1 Secure "+C$],d$],[/\bfocus\/([\w\.]+)/i],[d$,[c$,k$+" Focus"]],[/\bopt\/([\w\.]+)/i],[d$,[c$,M$+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[d$,[c$,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[d$,[c$,"Dolphin"]],[/coast\/([\w\.]+)/i],[d$,[c$,M$+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[d$,[c$,"MIUI "+C$]],[/fxios\/([-\w\.]+)/i],[d$,[c$,k$]],[/\bqihu|(qi?ho?o?|360)browser/i],[[c$,"360 "+C$]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[c$,/(.+)/,"$1 "+C$],d$],[/(comodo_dragon)\/([\w\.]+)/i],[[c$,/_/g," "],d$],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[c$,d$],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[c$],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[c$,E$],d$],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[c$,d$],[/\bgsa\/([\w\.]+) .*safari\//i],[d$,[c$,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[d$,[c$,N$+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[c$,N$+" WebView"],d$],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[d$,[c$,"Android "+C$]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[c$,d$],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[d$,[c$,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[d$,c$],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[c$,[d$,t5,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[c$,d$],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[c$,"Netscape"],d$],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[d$,[c$,k$+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[c$,d$],[/(cobalt)\/([\w\.]+)/i],[c$,[d$,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[h$,"amd64"]],[/(ia32(?=;))/i],[[h$,G$]],[/((?:i[346]|x)86)[;\)]/i],[[h$,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[h$,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[h$,"armhf"]],[/windows (ce|mobile); ppc;/i],[[h$,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[h$,/ower/,"",G$]],[/(sun4\w)[;\)]/i],[[h$,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[h$,G$]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[a$,[l$,V$],[u$,f$]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[a$,[l$,V$],[u$,_$]],[/\((ip(?:hone|od)[\w ]*);/i],[a$,[l$,S$],[u$,_$]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[a$,[l$,S$],[u$,f$]],[/(macintosh);/i],[a$,[l$,S$]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[a$,[l$,A$],[u$,_$]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[a$,[l$,U$],[u$,f$]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[a$,[l$,U$],[u$,_$]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[a$,/_/g," "],[l$,P$],[u$,_$]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[a$,/_/g," "],[l$,P$],[u$,f$]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[a$,[l$,"OPPO"],[u$,_$]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[a$,[l$,"Vivo"],[u$,_$]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[a$,[l$,"Realme"],[u$,_$]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[a$,[l$,L$],[u$,_$]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[a$,[l$,L$],[u$,f$]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[a$,[l$,x$],[u$,f$]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[a$,[l$,x$],[u$,_$]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[a$,[l$,"Lenovo"],[u$,f$]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[a$,/_/g," "],[l$,"Nokia"],[u$,_$]],[/(pixel c)\b/i],[a$,[l$,O$],[u$,f$]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[a$,[l$,O$],[u$,_$]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[a$,[l$,I$],[u$,_$]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[a$,"Xperia Tablet"],[l$,I$],[u$,f$]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[a$,[l$,"OnePlus"],[u$,_$]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[a$,[l$,y$],[u$,f$]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[a$,/(.+)/g,"Fire Phone $1"],[l$,y$],[u$,_$]],[/(playbook);[-\w\),; ]+(rim)/i],[a$,l$,[u$,f$]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[a$,[l$,$$],[u$,_$]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[a$,[l$,b$],[u$,f$]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[a$,[l$,b$],[u$,_$]],[/(nexus 9)/i],[a$,[l$,"HTC"],[u$,f$]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[l$,[a$,/_/g," "],[u$,_$]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[a$,[l$,"Acer"],[u$,f$]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[a$,[l$,"Meizu"],[u$,_$]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[l$,a$,[u$,_$]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[l$,a$,[u$,f$]],[/(surface duo)/i],[a$,[l$,F$],[u$,f$]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[a$,[l$,"Fairphone"],[u$,_$]],[/(u304aa)/i],[a$,[l$,"AT&T"],[u$,_$]],[/\bsie-(\w*)/i],[a$,[l$,"Siemens"],[u$,_$]],[/\b(rct\w+) b/i],[a$,[l$,"RCA"],[u$,f$]],[/\b(venue[\d ]{2,7}) b/i],[a$,[l$,"Dell"],[u$,f$]],[/\b(q(?:mv|ta)\w+) b/i],[a$,[l$,"Verizon"],[u$,f$]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[a$,[l$,"Barnes & Noble"],[u$,f$]],[/\b(tm\d{3}\w+) b/i],[a$,[l$,"NuVision"],[u$,f$]],[/\b(k88) b/i],[a$,[l$,"ZTE"],[u$,f$]],[/\b(nx\d{3}j) b/i],[a$,[l$,"ZTE"],[u$,_$]],[/\b(gen\d{3}) b.+49h/i],[a$,[l$,"Swiss"],[u$,_$]],[/\b(zur\d{3}) b/i],[a$,[l$,"Swiss"],[u$,f$]],[/\b((zeki)?tb.*\b) b/i],[a$,[l$,"Zeki"],[u$,f$]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[l$,"Dragon Touch"],a$,[u$,f$]],[/\b(ns-?\w{0,9}) b/i],[a$,[l$,"Insignia"],[u$,f$]],[/\b((nxa|next)-?\w{0,9}) b/i],[a$,[l$,"NextBook"],[u$,f$]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[l$,"Voice"],a$,[u$,_$]],[/\b(lvtel\-)?(v1[12]) b/i],[[l$,"LvTel"],a$,[u$,_$]],[/\b(ph-1) /i],[a$,[l$,"Essential"],[u$,_$]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[a$,[l$,"Envizen"],[u$,f$]],[/\b(trio[-\w\. ]+) b/i],[a$,[l$,"MachSpeed"],[u$,f$]],[/\btu_(1491) b/i],[a$,[l$,"Rotor"],[u$,f$]],[/(shield[\w ]+) b/i],[a$,[l$,"Nvidia"],[u$,f$]],[/(sprint) (\w+)/i],[l$,a$,[u$,_$]],[/(kin\.[onetw]{3})/i],[[a$,/\./g," "],[l$,F$],[u$,_$]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[a$,[l$,w$],[u$,f$]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[a$,[l$,w$],[u$,_$]],[/smart-tv.+(samsung)/i],[l$,[u$,m$]],[/hbbtv.+maple;(\d+)/i],[[a$,/^/,"SmartTV"],[l$,V$],[u$,m$]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[l$,x$],[u$,m$]],[/(apple) ?tv/i],[l$,[a$,S$+" TV"],[u$,m$]],[/crkey/i],[[a$,N$+"cast"],[l$,O$],[u$,m$]],[/droid.+aft(\w)( bui|\))/i],[a$,[l$,y$],[u$,m$]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[a$,[l$,A$],[u$,m$]],[/(bravia[\w ]+)( bui|\))/i],[a$,[l$,I$],[u$,m$]],[/(mitv-\w{5}) bui/i],[a$,[l$,P$],[u$,m$]],[/Hbbtv.*(technisat) (.*);/i],[l$,a$,[u$,m$]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[l$,z$],[a$,z$],[u$,m$]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[u$,m$]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[l$,a$,[u$,p$]],[/droid.+; (shield) bui/i],[a$,[l$,"Nvidia"],[u$,p$]],[/(playstation [345portablevi]+)/i],[a$,[l$,I$],[u$,p$]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[a$,[l$,F$],[u$,p$]],[/((pebble))app/i],[l$,a$,[u$,g$]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[a$,[l$,S$],[u$,g$]],[/droid.+; (glass) \d/i],[a$,[l$,O$],[u$,g$]],[/droid.+; (wt63?0{2,3})\)/i],[a$,[l$,w$],[u$,g$]],[/(quest( 2| pro)?)/i],[a$,[l$,E$],[u$,g$]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[l$,[u$,v$]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[a$,[u$,_$]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[a$,[u$,f$]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[u$,f$]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[u$,_$]],[/(android[-\w\. ]{0,9});.+buil/i],[a$,[l$,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[d$,[c$,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[d$,[c$,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[c$,d$],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[d$,c$]],os:[[/microsoft (windows) (vista|xp)/i],[c$,d$],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[c$,[d$,t5,a5]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[c$,"Windows"],[d$,t5,a5]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[d$,/_/g,"."],[c$,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[c$,R$],[d$,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[d$,c$],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[c$,d$],[/\(bb(10);/i],[d$,[c$,$$]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[d$,[c$,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[d$,[c$,k$+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[d$,[c$,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[d$,[c$,"watchOS"]],[/crkey\/([\d\.]+)/i],[d$,[c$,N$+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[c$,T$],d$],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[c$,d$],[/(sunos) ?([\w\.\d]*)/i],[[c$,"Solaris"],d$],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[c$,d$]]},t3=function(K$,B$){if(typeof K$===i$&&(B$=K$,K$=t$),!(this instanceof t3))return new t3(K$,B$).getResult();var H$=typeof e$!==n$&&e$.navigator?e$.navigator:t$,X$=K$||(H$&&H$.userAgent?H$.userAgent:""),t0=H$&&H$.userAgentData?H$.userAgentData:t$,q$=B$?function(W$,Z$){var o5={};for(var _q in W$)Z$[_q]&&Z$[_q].length%2==0?o5[_q]=Z$[_q].concat(W$[_q]):o5[_q]=W$[_q];return o5}(s5,B$):s5;return this.getBrowser=function(){var W$={};return W$[c$]=t$,W$[d$]=t$,J$.call(W$,X$,q$.browser),W$[s$]=function(Z$){return typeof Z$===o$?Z$.replace(/[^\d\.]/g,"").split(".")[0]:t$}(W$[d$]),H$&&H$.brave&&typeof H$.brave.isBrave==r$&&(W$[c$]="Brave"),W$},this.getCPU=function(){var W$={};return W$[h$]=t$,J$.call(W$,X$,q$.cpu),W$},this.getDevice=function(){var W$={};return W$[l$]=t$,W$[a$]=t$,W$[u$]=t$,J$.call(W$,X$,q$.device),!W$[u$]&&t0&&t0.mobile&&(W$[u$]=_$),W$[a$]=="Macintosh"&&H$&&typeof H$.standalone!==n$&&H$.maxTouchPoints&&H$.maxTouchPoints>2&&(W$[a$]="iPad",W$[u$]=f$),W$},this.getEngine=function(){var W$={};return W$[c$]=t$,W$[d$]=t$,J$.call(W$,X$,q$.engine),W$},this.getOS=function(){var W$={};return W$[c$]=t$,W$[d$]=t$,J$.call(W$,X$,q$.os),!W$[c$]&&t0&&t0.platform!="Unknown"&&(W$[c$]=t0.platform.replace(/chrome os/i,T$).replace(/macos/i,R$)),W$},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return X$},this.setUA=function(W$){return X$=typeof W$===o$&&W$.length>350?z$(W$,350):W$,this},this.setUA(X$),this};t3.VERSION="0.7.34",t3.BROWSER=D$([c$,d$,s$]),t3.CPU=D$([h$]),t3.DEVICE=D$([a$,l$,u$,p$,_$,m$,f$,g$,v$]),t3.ENGINE=t3.OS=D$([c$,d$]),eE$1.exports&&(tE$1=eE$1.exports=t3),tE$1.UAParser=t3;var Q$=typeof e$!==n$&&(e$.jQuery||e$.Zepto);if(Q$&&!Q$.ua){var Y$=new t3;Q$.ua=Y$.getResult(),Q$.ua.get=function(){return Y$.getUA()},Q$.ua.set=function(K$){Y$.setUA(K$);var B$=Y$.getResult();for(var H$ in B$)Q$.ua[H$]=B$[H$]}}}(typeof window=="object"?window:t);var dE$1=i(cE$1.exports),lE$1=pn$1,uE$1=Ze,hE$1=Y,pE$1=xo$1,_E$1=ht$1("iterator"),EE$1=Object,fE$1=function(e$){if(hE$1(e$))return!1;var t$=EE$1(e$);return t$[_E$1]!==void 0||"@@iterator"in t$||uE$1(pE$1,lE$1(t$))},mE$1=i(fE$1),TE$1=h;wi$1({global:!0,forced:TE$1.globalThis!==TE$1},{globalThis:TE$1});var SE$1=i(h),gE$1=Ad$1.clear;wi$1({global:!0,bind:!0,enumerable:!0,forced:h.clearImmediate!==gE$1},{clearImmediate:gE$1});var RE$1=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",CE$1=h,IE$1=m,vE$1=w,yE$1=RE$1,AE$1=ce,bE$1=Xc$1,wE$1=Zc$1,OE$1=CE$1.Function,NE$1=/MSIE .\./.test(AE$1)||yE$1&&function(){var e$=CE$1.Bun.version.split(".");return e$.length<3||e$[0]==0&&(e$[1]<3||e$[1]==3&&e$[2]==0)}(),DE$1=wi$1,PE$1=h,LE$1=Ad$1.set,kE$1=function(e$,t$){var r$=1;return NE$1?function(n$,i$){var o$=wE$1(arguments.length,1)>r$,s$=vE$1(n$)?n$:OE$1(n$),a$=o$?bE$1(arguments,r$):[],c$=o$?function(){IE$1(s$,this,a$)}:s$;return e$(c$)}:e$},ME$1=PE$1.setImmediate?kE$1(LE$1):LE$1;DE$1({global:!0,bind:!0,enumerable:!0,forced:PE$1.setImmediate!==ME$1},{setImmediate:ME$1});var UE$1=i(ie$1.setImmediate),xE$1=wi$1,VE$1=$d$1,FE$1=De$1,BE$1=Zc$1,jE$1=jn$1,GE$1=h.process;xE$1({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(e$){BE$1(arguments.length,1),FE$1(e$);var t$=jE$1&&GE$1.domain;VE$1(t$?t$.bind(e$):e$)}});var WE$1=i(ie$1.queueMicrotask);function HE$1(e$,t$){return function(){return e$.apply(t$,arguments)}}const{toString:KE$1}=Object.prototype,{getPrototypeOf:YE$1}=Object,qE$1=(zE$1=Object.create(null),e$=>{const t$=KE$1.call(e$);return zE$1[t$]||(zE$1[t$]=t$.slice(8,-1).toLowerCase())});var zE$1;const JE$1=e$=>(e$=e$.toLowerCase(),t$=>qE$1(t$)===e$),XE$1=e$=>t$=>typeof t$===e$,{isArray:QE$1}=Array,ZE$1=XE$1("undefined"),$E$1=JE$1("ArrayBuffer"),ef$1=XE$1("string"),tf$1=XE$1("function"),nf$1=XE$1("number"),rf$1=e$=>e$!==null&&typeof e$=="object",of$1=e$=>{if(qE$1(e$)!=="object")return!1;const t$=YE$1(e$);return!(t$!==null&&t$!==Object.prototype&&Object.getPrototypeOf(t$)!==null||Symbol.toStringTag in e$||mE$1(e$))},sf$1=JE$1("Date"),af$1=JE$1("File"),cf$1=JE$1("Blob"),df$1=JE$1("FileList"),lf$1=JE$1("URLSearchParams"),[uf$1,hf$1,pf$1,_f$1]=["ReadableStream","Request","Response","Headers"].map(JE$1);function Ef$1(e$,t$){let r$,n$,{allOwnKeys:i$=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e$!=null)if(typeof e$!="object"&&(e$=[e$]),QE$1(e$))for(r$=0,n$=e$.length;r$<n$;r$++)t$.call(null,e$[r$],r$,e$);else{const o$=i$?Object.getOwnPropertyNames(e$):Object.keys(e$),s$=o$.length;let a$;for(r$=0;r$<s$;r$++)a$=o$[r$],t$.call(null,e$[a$],a$,e$)}}function ff$1(e$,t$){t$=t$.toLowerCase();const r$=Object.keys(e$);let n$,i$=r$.length;for(;i$-- >0;)if(n$=r$[i$],t$===n$.toLowerCase())return n$;return null}const mf$1=SE$1!==void 0?SE$1:typeof self<"u"?self:typeof window<"u"?window:global,Tf$1=e$=>!ZE$1(e$)&&e$!==mf$1,Sf$1=(gf$1=typeof Uint8Array<"u"&&YE$1(Uint8Array),e$=>gf$1&&e$ instanceof gf$1);var gf$1;const Rf$1=JE$1("HTMLFormElement"),Cf$1=(e$=>{let{hasOwnProperty:t$}=e$;return(r$,n$)=>t$.call(r$,n$)})(Object.prototype),If$1=JE$1("RegExp"),vf$1=(e$,t$)=>{const r$=Object.getOwnPropertyDescriptors(e$),n$={};Ef$1(r$,(i$,o$)=>{let s$;(s$=t$(i$,o$,e$))!==!1&&(n$[o$]=s$||i$)}),Object.defineProperties(e$,n$)},yf$1="abcdefghijklmnopqrstuvwxyz",Af$1="0123456789",bf$1={DIGIT:Af$1,ALPHA:yf$1,ALPHA_DIGIT:yf$1+yf$1.toUpperCase()+Af$1},wf$1=JE$1("AsyncFunction"),Of$1=(Nf$1=typeof UE$1=="function",Df$1=tf$1(mf$1.postMessage),Nf$1?UE$1:Df$1?(Pf$1="axios@".concat(Math.random()),Lf$1=[],mf$1.addEventListener("message",e$=>{let{source:t$,data:r$}=e$;t$===mf$1&&r$===Pf$1&&Lf$1.length&&Lf$1.shift()()},!1),e$=>{Lf$1.push(e$),mf$1.postMessage(Pf$1,"*")}):e$=>setTimeout(e$));var Nf$1,Df$1,Pf$1,Lf$1;const kf$1=WE$1!==void 0?WE$1.bind(mf$1):typeof process<"u"&&process.nextTick||Of$1;var Mf$1={isArray:QE$1,isArrayBuffer:$E$1,isBuffer:function(e$){return e$!==null&&!ZE$1(e$)&&e$.constructor!==null&&!ZE$1(e$.constructor)&&tf$1(e$.constructor.isBuffer)&&e$.constructor.isBuffer(e$)},isFormData:e$=>{let t$;return e$&&(typeof FormData=="function"&&e$ instanceof FormData||tf$1(e$.append)&&((t$=qE$1(e$))==="formdata"||t$==="object"&&tf$1(e$.toString)&&e$.toString()==="[object FormData]"))},isArrayBufferView:function(e$){let t$;return t$=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e$):e$&&e$.buffer&&$E$1(e$.buffer),t$},isString:ef$1,isNumber:nf$1,isBoolean:e$=>e$===!0||e$===!1,isObject:rf$1,isPlainObject:of$1,isReadableStream:uf$1,isRequest:hf$1,isResponse:pf$1,isHeaders:_f$1,isUndefined:ZE$1,isDate:sf$1,isFile:af$1,isBlob:cf$1,isRegExp:If$1,isFunction:tf$1,isStream:e$=>rf$1(e$)&&tf$1(e$.pipe),isURLSearchParams:lf$1,isTypedArray:Sf$1,isFileList:df$1,forEach:Ef$1,merge:function e$(){const{caseless:t$}=Tf$1(this)&&this||{},r$={},n$=(i$,o$)=>{const s$=t$&&ff$1(r$,o$)||o$;of$1(r$[s$])&&of$1(i$)?r$[s$]=e$(r$[s$],i$):of$1(i$)?r$[s$]=e$({},i$):QE$1(i$)?r$[s$]=i$.slice():r$[s$]=i$};for(let i$=0,o$=arguments.length;i$<o$;i$++)arguments[i$]&&Ef$1(arguments[i$],n$);return r$},extend:function(e$,t$,r$){let{allOwnKeys:n$}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Ef$1(t$,(i$,o$)=>{r$&&tf$1(i$)?e$[o$]=HE$1(i$,r$):e$[o$]=i$},{allOwnKeys:n$}),e$},trim:e$=>jp$1(e$)?jp$1(e$).call(e$):e$.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e$=>(e$.charCodeAt(0)===65279&&(e$=e$.slice(1)),e$),inherits:(e$,t$,r$,n$)=>{e$.prototype=Object.create(t$.prototype,n$),e$.prototype.constructor=e$,Object.defineProperty(e$,"super",{value:t$.prototype}),r$&&Object.assign(e$.prototype,r$)},toFlatObject:(e$,t$,r$,n$)=>{let i$,o$,s$;const a$={};if(t$=t$||{},e$==null)return t$;do{for(i$=Object.getOwnPropertyNames(e$),o$=i$.length;o$-- >0;)s$=i$[o$],n$&&!n$(s$,e$,t$)||a$[s$]||(t$[s$]=e$[s$],a$[s$]=!0);e$=r$!==!1&&YE$1(e$)}while(e$&&(!r$||r$(e$,t$))&&e$!==Object.prototype);return t$},kindOf:qE$1,kindOfTest:JE$1,endsWith:(e$,t$,r$)=>{e$=String(e$),(r$===void 0||r$>e$.length)&&(r$=e$.length),r$-=t$.length;const n$=e$.indexOf(t$,r$);return n$!==-1&&n$===r$},toArray:e$=>{if(!e$)return null;if(QE$1(e$))return e$;let t$=e$.length;if(!nf$1(t$))return null;const r$=new Array(t$);for(;t$-- >0;)r$[t$]=e$[t$];return r$},forEachEntry:(e$,t$)=>{const r$=(e$&&e$[Symbol.iterator]).call(e$);let n$;for(;(n$=r$.next())&&!n$.done;){const i$=n$.value;t$.call(e$,i$[0],i$[1])}},matchAll:(e$,t$)=>{let r$;const n$=[];for(;(r$=e$.exec(t$))!==null;)n$.push(r$);return n$},isHTMLForm:Rf$1,hasOwnProperty:Cf$1,hasOwnProp:Cf$1,reduceDescriptors:vf$1,freezeMethods:e$=>{vf$1(e$,(t$,r$)=>{if(tf$1(e$)&&["arguments","caller","callee"].indexOf(r$)!==-1)return!1;const n$=e$[r$];tf$1(n$)&&(t$.enumerable=!1,"writable"in t$?t$.writable=!1:t$.set||(t$.set=()=>{throw Error("Can not rewrite read-only method '"+r$+"'")}))})},toObjectSet:(e$,t$)=>{const r$={},n$=i$=>{i$.forEach(o$=>{r$[o$]=!0})};return QE$1(e$)?n$(e$):n$(String(e$).split(t$)),r$},toCamelCase:e$=>e$.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t$,r$,n$){return r$.toUpperCase()+n$}),noop:()=>{},toFiniteNumber:(e$,t$)=>e$!=null&&Number.isFinite(e$=+e$)?e$:t$,findKey:ff$1,global:mf$1,isContextDefined:Tf$1,ALPHABET:bf$1,generateString:function(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:bf$1.ALPHA_DIGIT,r$="";const{length:n$}=t$;for(;e$--;)r$+=t$[Math.random()*n$|0];return r$},isSpecCompliantForm:function(e$){return!!(e$&&tf$1(e$.append)&&e$[Symbol.toStringTag]==="FormData"&&e$[Symbol.iterator])},toJSONObject:e$=>{const t$=new Array(10),r$=(n$,i$)=>{if(rf$1(n$)){if(t$.indexOf(n$)>=0)return;if(!("toJSON"in n$)){t$[i$]=n$;const o$=QE$1(n$)?[]:{};return Ef$1(n$,(s$,a$)=>{const c$=r$(s$,i$+1);!ZE$1(c$)&&(o$[a$]=c$)}),t$[i$]=void 0,o$}}return n$};return r$(e$,0)},isAsyncFn:wf$1,isThenable:e$=>e$&&(rf$1(e$)||tf$1(e$))&&tf$1(e$.then)&&tf$1(e$.catch),setImmediate:Of$1,asap:kf$1};function Uf(e$,t$,r$,n$,i$){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e$,this.name="AxiosError",t$&&(this.code=t$),r$&&(this.config=r$),n$&&(this.request=n$),i$&&(this.response=i$,this.status=i$.status?i$.status:null)}Mf$1.inherits(Uf,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Mf$1.toJSONObject(this.config),code:this.code,status:this.status}}});const xf=Uf.prototype,Vf={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e$=>{Vf[e$]={value:e$}}),Object.defineProperties(Uf,Vf),Object.defineProperty(xf,"isAxiosError",{value:!0}),Uf.from=(e$,t$,r$,n$,i$,o$)=>{const s$=Object.create(xf);return Mf$1.toFlatObject(e$,s$,function(a$){return a$!==Error.prototype},a$=>a$!=="isAxiosError"),Uf.call(s$,e$.message,t$,r$,n$,i$),s$.cause=e$,s$.name=e$.name,o$&&Object.assign(s$,o$),s$};function Ff(e$){return Mf$1.isPlainObject(e$)||Mf$1.isArray(e$)}function Bf(e$){return Mf$1.endsWith(e$,"[]")?e$.slice(0,-2):e$}function jf(e$,t$,r$){return e$?e$.concat(t$).map(function(n$,i$){return n$=Bf(n$),!r$&&i$?"["+n$+"]":n$}).join(r$?".":""):t$}const Gf=Mf$1.toFlatObject(Mf$1,{},null,function(e$){return/^is[A-Z]/.test(e$)});function Wf(e$,t$,r$){if(!Mf$1.isObject(e$))throw new TypeError("target must be an object");t$=t$||new FormData;const n$=(r$=Mf$1.toFlatObject(r$,{metaTokens:!0,dots:!1,indexes:!1},!1,function(h$,p$){return!Mf$1.isUndefined(p$[h$])})).metaTokens,i$=r$.visitor||u$,o$=r$.dots,s$=r$.indexes,a$=(r$.Blob||typeof Blob<"u"&&Blob)&&Mf$1.isSpecCompliantForm(t$);if(!Mf$1.isFunction(i$))throw new TypeError("visitor must be a function");function c$(h$){if(h$===null)return"";if(Mf$1.isDate(h$))return h$.toISOString();if(!a$&&Mf$1.isBlob(h$))throw new Uf("Blob is not supported. Use a Buffer instead.");return Mf$1.isArrayBuffer(h$)||Mf$1.isTypedArray(h$)?a$&&typeof Blob=="function"?new Blob([h$]):Buffer.from(h$):h$}function u$(h$,p$,_$){let f$=h$;if(h$&&!_$&&typeof h$=="object"){if(Mf$1.endsWith(p$,"{}"))p$=n$?p$:p$.slice(0,-2),h$=JSON.stringify(h$);else if(Mf$1.isArray(h$)&&function(m$){return Mf$1.isArray(m$)&&!m$.some(Ff)}(h$)||(Mf$1.isFileList(h$)||Mf$1.endsWith(p$,"[]"))&&(f$=Mf$1.toArray(h$)))return p$=Bf(p$),f$.forEach(function(m$,g$){!Mf$1.isUndefined(m$)&&m$!==null&&t$.append(s$===!0?jf([p$],g$,o$):s$===null?p$:p$+"[]",c$(m$))}),!1}return!!Ff(h$)||(t$.append(jf(_$,p$,o$),c$(h$)),!1)}const l$=[],d$=Object.assign(Gf,{defaultVisitor:u$,convertValue:c$,isVisitable:Ff});if(!Mf$1.isObject(e$))throw new TypeError("data must be an object");return function h$(p$,_$){if(!Mf$1.isUndefined(p$)){if(l$.indexOf(p$)!==-1)throw Error("Circular reference detected in "+_$.join("."));l$.push(p$),Mf$1.forEach(p$,function(f$,m$){(!(Mf$1.isUndefined(f$)||f$===null)&&i$.call(t$,f$,Mf$1.isString(m$)?jp$1(m$).call(m$):m$,_$,d$))===!0&&h$(f$,_$?_$.concat(m$):[m$])}),l$.pop()}}(e$),t$}function Hf(e$){const t$={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e$).replace(/[!'()~]|%20|%00/g,function(r$){return t$[r$]})}function Kf(e$,t$){this._pairs=[],e$&&Wf(e$,this,t$)}const Yf=Kf.prototype;function qf(e$){return encodeURIComponent(e$).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function zf$1(e$,t$,r$){if(!t$)return e$;const n$=r$&&r$.encode||qf,i$=r$&&r$.serialize;let o$;if(o$=i$?i$(t$,r$):Mf$1.isURLSearchParams(t$)?t$.toString():new Kf(t$,r$).toString(n$),o$){const s$=e$.indexOf("#");s$!==-1&&(e$=e$.slice(0,s$)),e$+=(e$.indexOf("?")===-1?"?":"&")+o$}return e$}Yf.append=function(e$,t$){this._pairs.push([e$,t$])},Yf.toString=function(e$){const t$=e$?function(r$){return e$.call(this,r$,Hf)}:Hf;return this._pairs.map(function(r$){return t$(r$[0])+"="+t$(r$[1])},"").join("&")};var Jf=class{constructor(){this.handlers=[]}use(e$,t$,r$){return this.handlers.push({fulfilled:e$,rejected:t$,synchronous:!!r$&&r$.synchronous,runWhen:r$?r$.runWhen:null}),this.handlers.length-1}eject(e$){this.handlers[e$]&&(this.handlers[e$]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e$){Mf$1.forEach(this.handlers,function(t$){t$!==null&&e$(t$)})}},Xf$1={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Qf$1={exports:{}},Zf$1=wi$1,$f$1=N$1,em$1=Qt$1.f;Zf$1({target:"Object",stat:!0,forced:Object.defineProperty!==em$1,sham:!$f$1},{defineProperty:em$1});var tm$1=ie$1.Object,im$1=Qf$1.exports=function(e$,t$,r$){return tm$1.defineProperty(e$,t$,r$)};tm$1.defineProperty.sham&&(im$1.sham=!0);var nm$1=i(Qf$1.exports),rm$1=R$1,om$1=Array.isArray||function(e$){return rm$1(e$)=="Array"},sm$1=TypeError,am$1=om$1,cm$1=jc$1,dm$1=te$1,lm$1=ht$1("species"),um$1=Array,hm$1=function(e$){var t$;return am$1(e$)&&(t$=e$.constructor,(cm$1(t$)&&(t$===um$1||am$1(t$.prototype))||dm$1(t$)&&(t$=t$[lm$1])===null)&&(t$=void 0)),t$===void 0?um$1:t$},pm$1=function(e$,t$){return new(hm$1(e$))(t$===0?0:t$)},_m$1=n,Em$1=Ee$1,fm$1=ht$1("species"),mm$1=function(e$){return Em$1>=51||!_m$1(function(){var t$=[];return(t$.constructor={})[fm$1]=function(){return{foo:1}},t$[e$](Boolean).foo!==1})},Tm$1=wi$1,Sm$1=n,gm$1=om$1,Rm$1=te$1,Cm$1=Je$1,Im$1=Gi$1,vm$1=function(e$){if(e$>9007199254740991)throw sm$1("Maximum allowed index exceeded");return e$},ym$1=E_$1,Am$1=pm$1,bm$1=mm$1,wm$1=Ee$1,Om$1=ht$1("isConcatSpreadable"),Nm$1=wm$1>=51||!Sm$1(function(){var e$=[];return e$[Om$1]=!1,e$.concat()[0]!==e$}),Dm$1=function(e$){if(!Rm$1(e$))return!1;var t$=e$[Om$1];return t$!==void 0?!!t$:gm$1(e$)};Tm$1({target:"Array",proto:!0,arity:1,forced:!Nm$1||!bm$1("concat")},{concat:function(e$){var t$,r$,n$,i$,o$,s$=Cm$1(this),a$=Am$1(s$,0),c$=0;for(t$=-1,n$=arguments.length;t$<n$;t$++)if(Dm$1(o$=t$===-1?s$:arguments[t$]))for(i$=Im$1(o$),vm$1(c$+i$),r$=0;r$<i$;r$++,c$++)r$ in o$&&ym$1(a$,c$,o$[r$]);else vm$1(c$+1),ym$1(a$,c$++,o$);return a$.length=c$,a$}});var Pm$1={},Lm$1=R$1,km$1=Z$1,Mm$1=Or$1.f,Um$1=R_$1,xm$1=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Pm$1.f=function(e$){return xm$1&&Lm$1(e$)=="Window"?function(t$){try{return Mm$1(t$)}catch{return Um$1(xm$1)}}(e$):Mm$1(km$1(e$))};var Vm$1={},Fm$1=ht$1;Vm$1.f=Fm$1;var Bm$1=ie$1,jm$1=Ze,Gm$1=Vm$1,Wm$1=Qt$1.f,Hm$1=function(e$){var t$=Bm$1.Symbol||(Bm$1.Symbol={});jm$1(t$,e$)||Wm$1(t$,e$,{value:Gm$1.f(e$)})},Km$1=L,Ym$1=ae$1,qm$1=ht$1,zm$1=ha$1,Jm$1=function(){var e$=Ym$1("Symbol"),t$=e$&&e$.prototype,r$=t$&&t$.valueOf,n$=qm$1("toPrimitive");t$&&!t$[n$]&&zm$1(t$,n$,function(i$){return Km$1(r$,this)},{arity:1})},Xm$1=Xt$1,Qm$1=K$1,Zm$1=Je$1,$m$1=Gi$1,eT$1=pm$1,tT$1=d([].push),iT$1=function(e$){var t$=e$==1,r$=e$==2,n$=e$==3,i$=e$==4,o$=e$==6,s$=e$==7,a$=e$==5||o$;return function(c$,u$,l$,d$){for(var h$,p$,_$=Zm$1(c$),f$=Qm$1(_$),m$=Xm$1(u$,l$),g$=$m$1(f$),v$=0,y$=d$||eT$1,S$=t$?y$(c$,g$):r$||s$?y$(c$,0):void 0;g$>v$;v$++)if((a$||v$ in f$)&&(p$=m$(h$=f$[v$],v$,_$),e$))if(t$)S$[v$]=p$;else if(p$)switch(e$){case 3:return!0;case 5:return h$;case 6:return v$;case 2:tT$1(S$,h$)}else switch(e$){case 4:return!1;case 7:tT$1(S$,h$)}return o$?-1:n$||i$?i$:S$}},nT$1={forEach:iT$1(0),map:iT$1(1),filter:iT$1(2),some:iT$1(3),every:iT$1(4),find:iT$1(5),findIndex:iT$1(6),filterReject:iT$1(7)},rT$1=wi$1,oT$1=h,sT$1=L,aT$1=d,cT$1=N$1,dT$1=Se$1,lT$1=n,uT$1=Ze,hT$1=l,pT$1=ii$1,_T$1=Z$1,ET$1=Ct$1,fT$1=fn,mT$1=B,TT$1=Io$1,ST$1=eo$1,gT$1=Or$1,RT$1=Pm$1,CT$1=Br$1,IT$1=O$1,vT$1=Qt$1,yT$1=Qr$1,AT$1=k,bT$1=ha$1,wT$1=hc$1,OT$1=Ye$1,NT$1=Nr$1,DT$1=nt$1,PT$1=ht$1,LT$1=Vm$1,kT$1=Hm$1,MT$1=Jm$1,UT$1=Da$1,xT$1=ra$1,VT$1=nT$1.forEach,FT$1=lr$1("hidden"),BT$1="Symbol",jT$1="prototype",GT$1=xT$1.set,WT$1=xT$1.getterFor(BT$1),HT$1=Object[jT$1],KT$1=oT$1.Symbol,YT$1=KT$1&&KT$1[jT$1],qT$1=oT$1.TypeError,zT$1=oT$1.QObject,JT$1=IT$1.f,XT$1=vT$1.f,QT$1=RT$1.f,ZT$1=AT$1.f,$T$1=aT$1([].push),eS$1=OT$1("symbols"),tS$1=OT$1("op-symbols"),iS$1=OT$1("wks"),nS$1=!zT$1||!zT$1[jT$1]||!zT$1[jT$1].findChild,rS$1=cT$1&&lT$1(function(){return TT$1(XT$1({},"a",{get:function(){return XT$1(this,"a",{value:7}).a}})).a!=7})?function(e$,t$,r$){var n$=JT$1(HT$1,t$);n$&&delete HT$1[t$],XT$1(e$,t$,r$),n$&&e$!==HT$1&&XT$1(HT$1,t$,n$)}:XT$1,oS$1=function(e$,t$){var r$=eS$1[e$]=TT$1(YT$1);return GT$1(r$,{type:BT$1,tag:e$,description:t$}),cT$1||(r$.description=t$),r$},sS$1=function(e$,t$,r$){e$===HT$1&&sS$1(tS$1,t$,r$),pT$1(e$);var n$=ET$1(t$);return pT$1(r$),uT$1(eS$1,n$)?(r$.enumerable?(uT$1(e$,FT$1)&&e$[FT$1][n$]&&(e$[FT$1][n$]=!1),r$=TT$1(r$,{enumerable:mT$1(0,!1)})):(uT$1(e$,FT$1)||XT$1(e$,FT$1,mT$1(1,{})),e$[FT$1][n$]=!0),rS$1(e$,n$,r$)):XT$1(e$,n$,r$)},aS$1=function(e$,t$){pT$1(e$);var r$=_T$1(t$),n$=ST$1(r$).concat(uS$1(r$));return VT$1(n$,function(i$){cT$1&&!sT$1(cS$1,r$,i$)||sS$1(e$,i$,r$[i$])}),e$},cS$1=function(e$){var t$=ET$1(e$),r$=sT$1(ZT$1,this,t$);return!(this===HT$1&&uT$1(eS$1,t$)&&!uT$1(tS$1,t$))&&(!(r$||!uT$1(this,t$)||!uT$1(eS$1,t$)||uT$1(this,FT$1)&&this[FT$1][t$])||r$)},dS$1=function(e$,t$){var r$=_T$1(e$),n$=ET$1(t$);if(r$!==HT$1||!uT$1(eS$1,n$)||uT$1(tS$1,n$)){var i$=JT$1(r$,n$);return!i$||!uT$1(eS$1,n$)||uT$1(r$,FT$1)&&r$[FT$1][n$]||(i$.enumerable=!0),i$}},lS$1=function(e$){var t$=QT$1(_T$1(e$)),r$=[];return VT$1(t$,function(n$){uT$1(eS$1,n$)||uT$1(NT$1,n$)||$T$1(r$,n$)}),r$},uS$1=function(e$){var t$=e$===HT$1,r$=QT$1(t$?tS$1:_T$1(e$)),n$=[];return VT$1(r$,function(i$){!uT$1(eS$1,i$)||t$&&!uT$1(HT$1,i$)||$T$1(n$,eS$1[i$])}),n$};dT$1||(bT$1(YT$1=(KT$1=function(){if(hT$1(YT$1,this))throw qT$1("Symbol is not a constructor");var e$=arguments.length&&arguments[0]!==void 0?fT$1(arguments[0]):void 0,t$=DT$1(e$),r$=function(n$){this===HT$1&&sT$1(r$,tS$1,n$),uT$1(this,FT$1)&&uT$1(this[FT$1],t$)&&(this[FT$1][t$]=!1),rS$1(this,t$,mT$1(1,n$))};return cT$1&&nS$1&&rS$1(HT$1,t$,{configurable:!0,set:r$}),oS$1(t$,e$)})[jT$1],"toString",function(){return WT$1(this).tag}),bT$1(KT$1,"withoutSetter",function(e$){return oS$1(DT$1(e$),e$)}),AT$1.f=cS$1,vT$1.f=sS$1,yT$1.f=aS$1,IT$1.f=dS$1,gT$1.f=RT$1.f=lS$1,CT$1.f=uS$1,LT$1.f=function(e$){return oS$1(PT$1(e$),e$)},cT$1&&wT$1(YT$1,"description",{configurable:!0,get:function(){return WT$1(this).description}})),rT$1({global:!0,constructor:!0,wrap:!0,forced:!dT$1,sham:!dT$1},{Symbol:KT$1}),VT$1(ST$1(iS$1),function(e$){kT$1(e$)}),rT$1({target:BT$1,stat:!0,forced:!dT$1},{useSetter:function(){nS$1=!0},useSimple:function(){nS$1=!1}}),rT$1({target:"Object",stat:!0,forced:!dT$1,sham:!cT$1},{create:function(e$,t$){return t$===void 0?TT$1(e$):aS$1(TT$1(e$),t$)},defineProperty:sS$1,defineProperties:aS$1,getOwnPropertyDescriptor:dS$1}),rT$1({target:"Object",stat:!0,forced:!dT$1},{getOwnPropertyNames:lS$1}),MT$1(),UT$1(KT$1,BT$1),NT$1[FT$1]=!0;var hS$1=Se$1&&!!Symbol.for&&!!Symbol.keyFor,pS$1=wi$1,_S$1=ae$1,ES$1=Ze,fS$1=fn,mS$1=Ye$1,TS$1=hS$1,SS$1=mS$1("string-to-symbol-registry"),gS$1=mS$1("symbol-to-string-registry");pS$1({target:"Symbol",stat:!0,forced:!TS$1},{for:function(e$){var t$=fS$1(e$);if(ES$1(SS$1,t$))return SS$1[t$];var r$=_S$1("Symbol")(t$);return SS$1[t$]=r$,gS$1[r$]=t$,r$}});var RS$1=wi$1,CS$1=Ze,IS$1=ye$1,vS$1=be$1,yS$1=hS$1,AS$1=Ye$1("symbol-to-string-registry");RS$1({target:"Symbol",stat:!0,forced:!yS$1},{keyFor:function(e$){if(!IS$1(e$))throw TypeError(vS$1(e$)+" is not a symbol");if(CS$1(AS$1,e$))return AS$1[e$]}});var bS$1=om$1,wS$1=w,OS$1=R$1,NS$1=fn,DS$1=d([].push),PS$1=wi$1,LS$1=ae$1,kS$1=m,MS$1=L,US$1=d,xS$1=n,VS$1=w,FS$1=ye$1,BS$1=Xc$1,jS$1=function(e$){if(wS$1(e$))return e$;if(bS$1(e$)){for(var t$=e$.length,r$=[],n$=0;n$<t$;n$++){var i$=e$[n$];typeof i$=="string"?DS$1(r$,i$):typeof i$!="number"&&OS$1(i$)!="Number"&&OS$1(i$)!="String"||DS$1(r$,NS$1(i$))}var o$=r$.length,s$=!0;return function(a$,c$){if(s$)return s$=!1,c$;if(bS$1(this))return c$;for(var u$=0;u$<o$;u$++)if(r$[u$]===a$)return c$}}},GS$1=Se$1,WS$1=String,HS$1=LS$1("JSON","stringify"),KS$1=US$1(/./.exec),YS$1=US$1("".charAt),qS$1=US$1("".charCodeAt),zS$1=US$1("".replace),JS$1=US$1(1 .toString),XS$1=/[\uD800-\uDFFF]/g,QS$1=/^[\uD800-\uDBFF]$/,ZS$1=/^[\uDC00-\uDFFF]$/,$S$1=!GS$1||xS$1(function(){var e$=LS$1("Symbol")();return HS$1([e$])!="[null]"||HS$1({a:e$})!="{}"||HS$1(Object(e$))!="{}"}),eg$1=xS$1(function(){return HS$1("\uDF06\uD834")!=='"\\udf06\\ud834"'||HS$1("\uDEAD")!=='"\\udead"'}),tg$1=function(e$,t$){var r$=BS$1(arguments),n$=jS$1(t$);if(VS$1(n$)||e$!==void 0&&!FS$1(e$))return r$[1]=function(i$,o$){if(VS$1(n$)&&(o$=MS$1(n$,this,WS$1(i$),o$)),!FS$1(o$))return o$},kS$1(HS$1,null,r$)},ig$1=function(e$,t$,r$){var n$=YS$1(r$,t$-1),i$=YS$1(r$,t$+1);return KS$1(QS$1,e$)&&!KS$1(ZS$1,i$)||KS$1(ZS$1,e$)&&!KS$1(QS$1,n$)?"\\u"+JS$1(qS$1(e$,0),16):e$};HS$1&&PS$1({target:"JSON",stat:!0,arity:3,forced:$S$1||eg$1},{stringify:function(e$,t$,r$){var n$=BS$1(arguments),i$=kS$1($S$1?tg$1:HS$1,null,n$);return eg$1&&typeof i$=="string"?zS$1(i$,XS$1,ig$1):i$}});var ng$1=Br$1,rg$1=Je$1;wi$1({target:"Object",stat:!0,forced:!Se$1||n(function(){ng$1.f(1)})},{getOwnPropertySymbols:function(e$){var t$=ng$1.f;return t$?t$(rg$1(e$)):[]}}),Hm$1("asyncIterator"),Hm$1("hasInstance"),Hm$1("isConcatSpreadable"),Hm$1("iterator"),Hm$1("match"),Hm$1("matchAll"),Hm$1("replace"),Hm$1("search"),Hm$1("species"),Hm$1("split");var og$1=Jm$1;Hm$1("toPrimitive"),og$1();var sg$1=ae$1,ag$1=Da$1;Hm$1("toStringTag"),ag$1(sg$1("Symbol"),"Symbol"),Hm$1("unscopables"),Da$1(h.JSON,"JSON",!0);var cg$1=ie$1.Symbol,dg$1=ht$1,lg$1=Qt$1.f,ug$1=dg$1("metadata"),hg$1=Function.prototype;hg$1[ug$1]===void 0&&lg$1(hg$1,ug$1,{value:null}),Hm$1("dispose"),Hm$1("metadata");var pg$1=cg$1;Hm$1("asyncDispose");var _g$1=d,Eg$1=ae$1("Symbol"),fg$1=Eg$1.keyFor,mg$1=_g$1(Eg$1.prototype.valueOf),Tg$1=Eg$1.isRegisteredSymbol||function(e$){try{return fg$1(mg$1(e$))!==void 0}catch{return!1}};wi$1({target:"Symbol",stat:!0},{isRegisteredSymbol:Tg$1});for(var Sg$1=Ye$1,gg$1=ae$1,Rg$1=d,Cg$1=ye$1,Ig$1=ht$1,vg$1=gg$1("Symbol"),yg$1=vg$1.isWellKnownSymbol,Ag$1=gg$1("Object","getOwnPropertyNames"),bg$1=Rg$1(vg$1.prototype.valueOf),wg$1=Sg$1("wks"),Og$1=0,Ng$1=Ag$1(vg$1),Dg$1=Ng$1.length;Og$1<Dg$1;Og$1++)try{var Pg$1=Ng$1[Og$1];Cg$1(vg$1[Pg$1])&&Ig$1(Pg$1)}catch{}var Lg$1=function(e$){if(yg$1&&yg$1(e$))return!0;try{for(var t$=bg$1(e$),r$=0,n$=Ag$1(wg$1),i$=n$.length;r$<i$;r$++)if(wg$1[n$[r$]]==t$)return!0}catch{}return!1};wi$1({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Lg$1}),Hm$1("matcher"),Hm$1("observable"),wi$1({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:Tg$1}),wi$1({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:Lg$1}),Hm$1("metadataKey"),Hm$1("patternMatch"),Hm$1("replaceAll");var kg$1=i(pg$1),Mg$1=i(Vm$1.f("iterator"));function Ug$1(e$){return Ug$1=typeof kg$1=="function"&&typeof Mg$1=="symbol"?function(t$){return typeof t$}:function(t$){return t$&&typeof kg$1=="function"&&t$.constructor===kg$1&&t$!==kg$1.prototype?"symbol":typeof t$},Ug$1(e$)}var xg$1=i(Vm$1.f("toPrimitive"));function Vg$1(e$){var t$=function(r$,n$){if(Ug$1(r$)!=="object"||r$===null)return r$;var i$=r$[xg$1];if(i$!==void 0){var o$=i$.call(r$,n$||"default");if(Ug$1(o$)!=="object")return o$;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n$==="string"?String:Number)(r$)}(e$,"string");return Ug$1(t$)==="symbol"?t$:String(t$)}function Fg$1(e$,t$,r$){return(t$=Vg$1(t$))in e$?nm$1(e$,t$,{value:r$,enumerable:!0,configurable:!0,writable:!0}):e$[t$]=r$,e$}var Bg$1=n,jg$1=ht$1("iterator"),Gg$1=!Bg$1(function(){var e$=new URL("b?a=1&b=2&c=3","http://a"),t$=e$.searchParams,r$=new URLSearchParams("a=1&a=2"),n$="";return e$.pathname="c%20d",t$.forEach(function(i$,o$){t$.delete("b"),n$+=o$+i$}),r$.delete("a",2),!e$.toJSON||!r$.has("a",1)||r$.has("a",2)||!t$.size&&!0||!t$.sort||e$.href!=="http://a/c%20d?a=1&c=3"||t$.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t$[jg$1]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||n$!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Wg$1=ha$1,Hg$1=wi$1,Kg$1=h,Yg$1=L,qg$1=d,zg$1=N$1,Jg$1=Gg$1,Xg$1=ha$1,Qg$1=hc$1,Zg$1=function(e$,t$,r$){for(var n$ in t$)r$&&r$.unsafe&&e$[n$]?e$[n$]=t$[n$]:Wg$1(e$,n$,t$[n$],r$);return e$},$g$1=Da$1,eR$1=Va$1,tR$1=ra$1,iR$1=Sc$1,nR$1=w,rR$1=Ze,oR$1=Xt$1,sR$1=pn$1,aR$1=ii$1,cR$1=te$1,dR$1=fn,lR$1=Io$1,uR$1=B,hR$1=es$1,pR$1=qo$1,_R$1=Zc$1,ER$1=b_$1,fR$1=ht$1("iterator"),mR$1="URLSearchParams",TR$1=mR$1+"Iterator",SR$1=tR$1.set,gR$1=tR$1.getterFor(mR$1),RR$1=tR$1.getterFor(TR$1),CR$1=Object.getOwnPropertyDescriptor,IR$1=function(e$){if(!zg$1)return Kg$1[e$];var t$=CR$1(Kg$1,e$);return t$&&t$.value},vR$1=IR$1("fetch"),yR$1=IR$1("Request"),AR$1=IR$1("Headers"),bR$1=yR$1&&yR$1.prototype,wR$1=AR$1&&AR$1.prototype,OR$1=Kg$1.RegExp,NR$1=Kg$1.TypeError,DR$1=Kg$1.decodeURIComponent,PR$1=Kg$1.encodeURIComponent,LR$1=qg$1("".charAt),kR$1=qg$1([].join),MR$1=qg$1([].push),UR$1=qg$1("".replace),xR$1=qg$1([].shift),VR$1=qg$1([].splice),FR$1=qg$1("".split),BR$1=qg$1("".slice),jR$1=/\+/g,GR$1=Array(4),WR$1=function(e$){return GR$1[e$-1]||(GR$1[e$-1]=OR$1("((?:%[\\da-f]{2}){"+e$+"})","gi"))},HR$1=function(e$){try{return DR$1(e$)}catch{return e$}},KR$1=function(e$){var t$=UR$1(e$,jR$1," "),r$=4;try{return DR$1(t$)}catch{for(;r$;)t$=UR$1(t$,WR$1(r$--),HR$1);return t$}},YR$1=/[!'()~]|%20/g,qR$1={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},zR$1=function(e$){return qR$1[e$]},JR$1=function(e$){return UR$1(PR$1(e$),YR$1,zR$1)},XR$1=eR$1(function(e$,t$){SR$1(this,{type:TR$1,iterator:hR$1(gR$1(e$).entries),kind:t$})},"Iterator",function(){var e$=RR$1(this),t$=e$.kind,r$=e$.iterator.next(),n$=r$.value;return r$.done||(r$.value=t$==="keys"?n$.key:t$==="values"?n$.value:[n$.key,n$.value]),r$},!0),QR$1=function(e$){this.entries=[],this.url=null,e$!==void 0&&(cR$1(e$)?this.parseObject(e$):this.parseQuery(typeof e$=="string"?LR$1(e$,0)==="?"?BR$1(e$,1):e$:dR$1(e$)))};QR$1.prototype={type:mR$1,bindURL:function(e$){this.url=e$,this.update()},parseObject:function(e$){var t$,r$,n$,i$,o$,s$,a$,c$=pR$1(e$);if(c$)for(r$=(t$=hR$1(e$,c$)).next;!(n$=Yg$1(r$,t$)).done;){if(o$=(i$=hR$1(aR$1(n$.value))).next,(s$=Yg$1(o$,i$)).done||(a$=Yg$1(o$,i$)).done||!Yg$1(o$,i$).done)throw NR$1("Expected sequence with length 2");MR$1(this.entries,{key:dR$1(s$.value),value:dR$1(a$.value)})}else for(var u$ in e$)rR$1(e$,u$)&&MR$1(this.entries,{key:u$,value:dR$1(e$[u$])})},parseQuery:function(e$){if(e$)for(var t$,r$,n$=FR$1(e$,"&"),i$=0;i$<n$.length;)(t$=n$[i$++]).length&&(r$=FR$1(t$,"="),MR$1(this.entries,{key:KR$1(xR$1(r$)),value:KR$1(kR$1(r$,"="))}))},serialize:function(){for(var e$,t$=this.entries,r$=[],n$=0;n$<t$.length;)e$=t$[n$++],MR$1(r$,JR$1(e$.key)+"="+JR$1(e$.value));return kR$1(r$,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ZR$1=function(){iR$1(this,$R$1);var e$=SR$1(this,new QR$1(arguments.length>0?arguments[0]:void 0));zg$1||(this.size=e$.entries.length)},$R$1=ZR$1.prototype;if(Zg$1($R$1,{append:function(e$,t$){var r$=gR$1(this);_R$1(arguments.length,2),MR$1(r$.entries,{key:dR$1(e$),value:dR$1(t$)}),zg$1||this.length++,r$.updateURL()},delete:function(e$){for(var t$=gR$1(this),r$=_R$1(arguments.length,1),n$=t$.entries,i$=dR$1(e$),o$=r$<2?void 0:arguments[1],s$=o$===void 0?o$:dR$1(o$),a$=0;a$<n$.length;){var c$=n$[a$];if(c$.key!==i$||s$!==void 0&&c$.value!==s$)a$++;else if(VR$1(n$,a$,1),s$!==void 0)break}zg$1||(this.size=n$.length),t$.updateURL()},get:function(e$){var t$=gR$1(this).entries;_R$1(arguments.length,1);for(var r$=dR$1(e$),n$=0;n$<t$.length;n$++)if(t$[n$].key===r$)return t$[n$].value;return null},getAll:function(e$){var t$=gR$1(this).entries;_R$1(arguments.length,1);for(var r$=dR$1(e$),n$=[],i$=0;i$<t$.length;i$++)t$[i$].key===r$&&MR$1(n$,t$[i$].value);return n$},has:function(e$){for(var t$=gR$1(this).entries,r$=_R$1(arguments.length,1),n$=dR$1(e$),i$=r$<2?void 0:arguments[1],o$=i$===void 0?i$:dR$1(i$),s$=0;s$<t$.length;){var a$=t$[s$++];if(a$.key===n$&&(o$===void 0||a$.value===o$))return!0}return!1},set:function(e$,t$){var r$=gR$1(this);_R$1(arguments.length,1);for(var n$,i$=r$.entries,o$=!1,s$=dR$1(e$),a$=dR$1(t$),c$=0;c$<i$.length;c$++)(n$=i$[c$]).key===s$&&(o$?VR$1(i$,c$--,1):(o$=!0,n$.value=a$));o$||MR$1(i$,{key:s$,value:a$}),zg$1||(this.size=i$.length),r$.updateURL()},sort:function(){var e$=gR$1(this);ER$1(e$.entries,function(t$,r$){return t$.key>r$.key?1:-1}),e$.updateURL()},forEach:function(e$){for(var t$,r$=gR$1(this).entries,n$=oR$1(e$,arguments.length>1?arguments[1]:void 0),i$=0;i$<r$.length;)n$((t$=r$[i$++]).value,t$.key,this)},keys:function(){return new XR$1(this,"keys")},values:function(){return new XR$1(this,"values")},entries:function(){return new XR$1(this,"entries")}},{enumerable:!0}),Xg$1($R$1,fR$1,$R$1.entries,{name:"entries"}),Xg$1($R$1,"toString",function(){return gR$1(this).serialize()},{enumerable:!0}),zg$1&&Qg$1($R$1,"size",{get:function(){return gR$1(this).entries.length},configurable:!0,enumerable:!0}),$g$1(ZR$1,mR$1),Hg$1({global:!0,constructor:!0,forced:!Jg$1},{URLSearchParams:ZR$1}),!Jg$1&&nR$1(AR$1)){var eC$1=qg$1(wR$1.has),tC$1=qg$1(wR$1.set),iC$1=function(e$){if(cR$1(e$)){var t$,r$=e$.body;if(sR$1(r$)===mR$1)return t$=e$.headers?new AR$1(e$.headers):new AR$1,eC$1(t$,"content-type")||tC$1(t$,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),lR$1(e$,{body:uR$1(0,dR$1(r$)),headers:uR$1(0,t$)})}return e$};if(nR$1(vR$1)&&Hg$1({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e$){return vR$1(e$,arguments.length>1?iC$1(arguments[1]):{})}}),nR$1(yR$1)){var nC$1=function(e$){return iR$1(this,bR$1),new yR$1(e$,arguments.length>1?iC$1(arguments[1]):{})};bR$1.constructor=nC$1,nC$1.prototype=bR$1,Hg$1({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:nC$1})}}var rC$1={URLSearchParams:ZR$1,getState:gR$1},oC$1=i(ie$1.URLSearchParams),sC$1={isBrowser:!0,classes:{URLSearchParams:oC$1!==void 0?oC$1:Kf,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const aC$1=typeof window<"u"&&typeof document<"u",cC$1=typeof navigator=="object"&&navigator||void 0,dC$1=aC$1&&(!cC$1||["ReactNative","NativeScript","NS"].indexOf(cC$1.product)<0),lC$1=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",uC$1=aC$1&&window.location.href||"http://localhost";function hC$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function pC$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?hC$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):hC$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var _C$1=pC$1(pC$1({},Object.freeze({__proto__:null,hasBrowserEnv:aC$1,hasStandardBrowserEnv:dC$1,hasStandardBrowserWebWorkerEnv:lC$1,navigator:cC$1,origin:uC$1})),sC$1),EC$1=ii$1,fC$1=L,mC$1=Ze,TC$1=l,SC$1=function(){var e$=EC$1(this),t$="";return e$.hasIndices&&(t$+="d"),e$.global&&(t$+="g"),e$.ignoreCase&&(t$+="i"),e$.multiline&&(t$+="m"),e$.dotAll&&(t$+="s"),e$.unicode&&(t$+="u"),e$.unicodeSets&&(t$+="v"),e$.sticky&&(t$+="y"),t$},gC$1=RegExp.prototype,RC$1=function(e$){var t$=e$.flags;return t$!==void 0||"flags"in gC$1||mC$1(e$,"flags")||!TC$1(gC$1,e$)?t$:fC$1(SC$1,e$)},CC$1=Ch$1.charAt,IC$1=L,vC$1=ii$1,yC$1=w,AC$1=R$1,bC$1=/./.exec,wC$1=TypeError,OC$1=wi$1,NC$1=L,DC$1=v$1,PC$1=Va$1,LC$1=ic$1,kC$1=J$1,MC$1=Bi$1,UC$1=fn,xC$1=ii$1,VC$1=Y,FC$1=R$1,BC$1=tn$1,jC$1=RC$1,GC$1=ke$1,WC$1=n,HC$1=Jc$1,KC$1=function(e$,t$,r$){return t$+(r$?CC$1(e$,t$).length:1)},YC$1=function(e$,t$){var r$=e$.exec;if(yC$1(r$)){var n$=IC$1(r$,e$,t$);return n$!==null&&vC$1(n$),n$}if(AC$1(e$)==="RegExp")return IC$1(bC$1,e$,t$);throw wC$1("RegExp#exec called on incompatible receiver")},qC$1=ra$1,zC$1=ht$1("matchAll"),JC$1="RegExp String",XC$1=JC$1+" Iterator",QC$1=qC$1.set,ZC$1=qC$1.getterFor(XC$1),$C$1=TypeError,eI$1=DC$1("".indexOf),tI$1=DC$1("".matchAll),iI$1=!!tI$1&&!WC$1(function(){tI$1("a",/./)}),nI$1=PC$1(function(e$,t$,r$,n$){QC$1(this,{type:XC$1,regexp:e$,string:t$,global:r$,unicode:n$,done:!1})},JC$1,function(){var e$=ZC$1(this);if(e$.done)return LC$1(void 0,!0);var t$=e$.regexp,r$=e$.string,n$=YC$1(t$,r$);return n$===null?(e$.done=!0,LC$1(void 0,!0)):e$.global?(UC$1(n$[0])===""&&(t$.lastIndex=KC$1(r$,MC$1(t$.lastIndex),e$.unicode)),LC$1(n$,!1)):(e$.done=!0,LC$1(n$,!1))}),rI$1=function(e$){var t$,r$,n$,i$=xC$1(this),o$=UC$1(e$),s$=HC$1(i$,RegExp),a$=UC$1(jC$1(i$));return t$=new s$(s$===RegExp?i$.source:i$,a$),r$=!!~eI$1(a$,"g"),n$=!!~eI$1(a$,"u"),t$.lastIndex=MC$1(i$.lastIndex),new nI$1(t$,o$,r$,n$)};OC$1({target:"String",proto:!0,forced:iI$1},{matchAll:function(e$){var t$,r$,n$,i$,o$=kC$1(this);if(VC$1(e$)){if(iI$1)return tI$1(o$,e$)}else{if(BC$1(e$)&&(t$=UC$1(kC$1(jC$1(e$))),!~eI$1(t$,"g")))throw $C$1("`.matchAll` does not allow non-global regexes");if(iI$1)return tI$1(o$,e$);if((n$=GC$1(e$,zC$1))===void 0&&FC$1(e$)=="RegExp"&&(n$=rI$1),n$)return NC$1(n$,e$,o$)}return r$=UC$1(o$),i$=new RegExp(e$,"g"),NC$1(rI$1,i$,r$)}});var oI$1=Xi$1("String").matchAll,sI$1=l,aI$1=oI$1,cI$1=String.prototype,dI$1=function(e$){var t$=e$.matchAll;return typeof e$=="string"||e$===cI$1||sI$1(cI$1,e$)&&t$===cI$1.matchAll?aI$1:t$},lI$1=i(dI$1);function uI$1(e$){function t$(r$,n$,i$,o$){let s$=r$[o$++];if(s$==="__proto__")return!0;const a$=Number.isFinite(+s$),c$=o$>=r$.length;return s$=!s$&&Mf$1.isArray(i$)?i$.length:s$,c$?(Mf$1.hasOwnProp(i$,s$)?i$[s$]=[i$[s$],n$]:i$[s$]=n$,!a$):(i$[s$]&&Mf$1.isObject(i$[s$])||(i$[s$]=[]),t$(r$,n$,i$[s$],o$)&&Mf$1.isArray(i$[s$])&&(i$[s$]=function(u$){const l$={},d$=Object.keys(u$);let h$;const p$=d$.length;let _$;for(h$=0;h$<p$;h$++)_$=d$[h$],l$[_$]=u$[_$];return l$}(i$[s$])),!a$)}if(Mf$1.isFormData(e$)&&Mf$1.isFunction(e$.entries)){const r$={};return Mf$1.forEachEntry(e$,(n$,i$)=>{t$(function(o$){return lI$1(Mf$1).call(Mf$1,/\w+|\[(\w*)]/g,o$).map(s$=>s$[0]==="[]"?"":s$[1]||s$[0])}(n$),i$,r$,0)}),r$}return null}const hI$1={transitional:Xf$1,adapter:["xhr","http","fetch"],transformRequest:[function(e$,t$){const r$=t$.getContentType()||"",n$=r$.indexOf("application/json")>-1,i$=Mf$1.isObject(e$);if(i$&&Mf$1.isHTMLForm(e$)&&(e$=new FormData(e$)),Mf$1.isFormData(e$))return n$?JSON.stringify(uI$1(e$)):e$;if(Mf$1.isArrayBuffer(e$)||Mf$1.isBuffer(e$)||Mf$1.isStream(e$)||Mf$1.isFile(e$)||Mf$1.isBlob(e$)||Mf$1.isReadableStream(e$))return e$;if(Mf$1.isArrayBufferView(e$))return e$.buffer;if(Mf$1.isURLSearchParams(e$))return t$.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e$.toString();let o$;if(i$){if(r$.indexOf("application/x-www-form-urlencoded")>-1)return function(s$,a$){return Wf(s$,new _C$1.classes.URLSearchParams,Object.assign({visitor:function(c$,u$,l$,d$){return _C$1.isNode&&Mf$1.isBuffer(c$)?(this.append(u$,c$.toString("base64")),!1):d$.defaultVisitor.apply(this,arguments)}},a$))}(e$,this.formSerializer).toString();if((o$=Mf$1.isFileList(e$))||r$.indexOf("multipart/form-data")>-1){const s$=this.env&&this.env.FormData;return Wf(o$?{"files[]":e$}:e$,s$&&new s$,this.formSerializer)}}return i$||n$?(t$.setContentType("application/json",!1),function(s$,a$,c$){if(Mf$1.isString(s$))try{return(a$||JSON.parse)(s$),jp$1(Mf$1).call(Mf$1,s$)}catch(u$){if(u$.name!=="SyntaxError")throw u$}return(0,JSON.stringify)(s$)}(e$)):e$}],transformResponse:[function(e$){const t$=this.transitional||hI$1.transitional,r$=t$&&t$.forcedJSONParsing,n$=this.responseType==="json";if(Mf$1.isResponse(e$)||Mf$1.isReadableStream(e$))return e$;if(e$&&Mf$1.isString(e$)&&(r$&&!this.responseType||n$)){const i$=!(t$&&t$.silentJSONParsing)&&n$;try{return JSON.parse(e$)}catch(o$){if(i$)throw o$.name==="SyntaxError"?Uf.from(o$,Uf.ERR_BAD_RESPONSE,this,null,this.response):o$}}return e$}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:_C$1.classes.FormData,Blob:_C$1.classes.Blob},validateStatus:function(e$){return e$>=200&&e$<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Mf$1.forEach(["delete","get","head","post","put","patch"],e$=>{hI$1.headers[e$]={}});var pI$1=hI$1;const _I$1=Mf$1.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),EI$1=Symbol("internals");function fI$1(e$){var t$;return e$&&jp$1(t$=String(e$)).call(t$).toLowerCase()}function mI$1(e$){return e$===!1||e$==null?e$:Mf$1.isArray(e$)?e$.map(mI$1):String(e$)}function TI$1(e$,t$,r$,n$,i$){return Mf$1.isFunction(n$)?n$.call(this,t$,r$):(i$&&(t$=r$),Mf$1.isString(t$)?Mf$1.isString(n$)?t$.indexOf(n$)!==-1:Mf$1.isRegExp(n$)?n$.test(t$):void 0:void 0)}let SI$1=class{constructor(t$){t$&&this.set(t$)}set(t$,r$,n$){const i$=this;function o$(c$,u$,l$){const d$=fI$1(u$);if(!d$)throw new Error("header name must be a non-empty string");const h$=Mf$1.findKey(i$,d$);(!h$||i$[h$]===void 0||l$===!0||l$===void 0&&i$[h$]!==!1)&&(i$[h$||u$]=mI$1(c$))}const s$=(c$,u$)=>Mf$1.forEach(c$,(l$,d$)=>o$(l$,d$,u$));if(Mf$1.isPlainObject(t$)||t$ instanceof this.constructor)s$(t$,r$);else if(Mf$1.isString(t$)&&(t$=jp$1(t$).call(t$))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(jp$1(a$=t$).call(a$)))s$((c$=>{const u$={};let l$,d$,h$;return c$&&c$.split(`
`).forEach(function(p$){var _$,f$;h$=p$.indexOf(":"),l$=jp$1(_$=p$.substring(0,h$)).call(_$).toLowerCase(),d$=jp$1(f$=p$.substring(h$+1)).call(f$),!l$||u$[l$]&&_I$1[l$]||(l$==="set-cookie"?u$[l$]?u$[l$].push(d$):u$[l$]=[d$]:u$[l$]=u$[l$]?u$[l$]+", "+d$:d$)}),u$})(t$),r$);else if(Mf$1.isHeaders(t$))for(const[c$,u$]of t$.entries())o$(u$,c$,n$);else t$!=null&&o$(r$,t$,n$);var a$;return this}get(t$,r$){if(t$=fI$1(t$)){const n$=Mf$1.findKey(this,t$);if(n$){const i$=this[n$];if(!r$)return i$;if(r$===!0)return function(o$){const s$=Object.create(null),a$=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let c$;for(;c$=a$.exec(o$);)s$[c$[1]]=c$[2];return s$}(i$);if(Mf$1.isFunction(r$))return r$.call(this,i$,n$);if(Mf$1.isRegExp(r$))return r$.exec(i$);throw new TypeError("parser must be boolean|regexp|function")}}}has(t$,r$){if(t$=fI$1(t$)){const n$=Mf$1.findKey(this,t$);return!(!n$||this[n$]===void 0||r$&&!TI$1(0,this[n$],n$,r$))}return!1}delete(t$,r$){const n$=this;let i$=!1;function o$(s$){if(s$=fI$1(s$)){const a$=Mf$1.findKey(n$,s$);!a$||r$&&!TI$1(0,n$[a$],a$,r$)||(delete n$[a$],i$=!0)}}return Mf$1.isArray(t$)?t$.forEach(o$):o$(t$),i$}clear(t$){const r$=Object.keys(this);let n$=r$.length,i$=!1;for(;n$--;){const o$=r$[n$];t$&&!TI$1(0,this[o$],o$,t$,!0)||(delete this[o$],i$=!0)}return i$}normalize(t$){const r$=this,n$={};return Mf$1.forEach(this,(i$,o$)=>{var s$;const a$=Mf$1.findKey(n$,o$);if(a$)return r$[a$]=mI$1(i$),void delete r$[o$];const c$=t$?function(u$){return jp$1(u$).call(u$).toLowerCase().replace(/([a-z\d])(\w*)/g,(l$,d$,h$)=>d$.toUpperCase()+h$)}(o$):jp$1(s$=String(o$)).call(s$);c$!==o$&&delete r$[o$],r$[c$]=mI$1(i$),n$[c$]=!0}),this}concat(){for(var t$=arguments.length,r$=new Array(t$),n$=0;n$<t$;n$++)r$[n$]=arguments[n$];return this.constructor.concat(this,...r$)}toJSON(t$){const r$=Object.create(null);return Mf$1.forEach(this,(n$,i$)=>{n$!=null&&n$!==!1&&(r$[i$]=t$&&Mf$1.isArray(n$)?n$.join(", "):n$)}),r$}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t$=>{let[r$,n$]=t$;return r$+": "+n$}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t$){return t$ instanceof this?t$:new this(t$)}static concat(t$){const r$=new this(t$);for(var n$=arguments.length,i$=new Array(n$>1?n$-1:0),o$=1;o$<n$;o$++)i$[o$-1]=arguments[o$];return i$.forEach(s$=>r$.set(s$)),r$}static accessor(t$){const r$=(this[EI$1]=this[EI$1]={accessors:{}}).accessors,n$=this.prototype;function i$(o$){const s$=fI$1(o$);r$[s$]||(function(a$,c$){const u$=Mf$1.toCamelCase(" "+c$);["get","set","has"].forEach(l$=>{Object.defineProperty(a$,l$+u$,{value:function(d$,h$,p$){return this[l$].call(this,c$,d$,h$,p$)},configurable:!0})})}(n$,o$),r$[s$]=!0)}return Mf$1.isArray(t$)?t$.forEach(i$):i$(t$),this}};SI$1.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Mf$1.reduceDescriptors(SI$1.prototype,(e$,t$)=>{let{value:r$}=e$,n$=t$[0].toUpperCase()+t$.slice(1);return{get:()=>r$,set(i$){this[n$]=i$}}}),Mf$1.freezeMethods(SI$1);var gI$1=SI$1;function RI$1(e$,t$){const r$=this||pI$1,n$=t$||r$,i$=gI$1.from(n$.headers);let o$=n$.data;return Mf$1.forEach(e$,function(s$){o$=s$.call(r$,o$,i$.normalize(),t$?t$.status:void 0)}),i$.normalize(),o$}function CI$1(e$){return!(!e$||!e$.__CANCEL__)}function II$1(e$,t$,r$){Uf.call(this,e$??"canceled",Uf.ERR_CANCELED,t$,r$),this.name="CanceledError"}function vI$1(e$,t$,r$){const n$=r$.config.validateStatus;r$.status&&n$&&!n$(r$.status)?t$(new Uf("Request failed with status code "+r$.status,[Uf.ERR_BAD_REQUEST,Uf.ERR_BAD_RESPONSE][Math.floor(r$.status/100)-4],r$.config,r$.request,r$)):e$(r$)}Mf$1.inherits(II$1,Uf,{__CANCEL__:!0});const yI$1=function(e$,t$){let r$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n$=0;const i$=function(o$,s$){o$=o$||10;const a$=new Array(o$),c$=new Array(o$);let u$,l$=0,d$=0;return s$=s$!==void 0?s$:1e3,function(h$){const p$=Date.now(),_$=c$[d$];u$||(u$=p$),a$[l$]=h$,c$[l$]=p$;let f$=d$,m$=0;for(;f$!==l$;)m$+=a$[f$++],f$%=o$;if(l$=(l$+1)%o$,l$===d$&&(d$=(d$+1)%o$),p$-u$<s$)return;const g$=_$&&p$-_$;return g$?Math.round(1e3*m$/g$):void 0}}(50,250);return function(o$,s$){let a$,c$,u$=0,l$=1e3/s$;const d$=function(h$){u$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),a$=null,c$&&(clearTimeout(c$),c$=null),o$.apply(null,h$)};return[function(){const h$=Date.now(),p$=h$-u$;for(var _$=arguments.length,f$=new Array(_$),m$=0;m$<_$;m$++)f$[m$]=arguments[m$];p$>=l$?d$(f$,h$):(a$=f$,c$||(c$=setTimeout(()=>{c$=null,d$(a$)},l$-p$)))},()=>a$&&d$(a$)]}(o$=>{const s$=o$.loaded,a$=o$.lengthComputable?o$.total:void 0,c$=s$-n$,u$=i$(c$);n$=s$,e$({loaded:s$,total:a$,progress:a$?s$/a$:void 0,bytes:c$,rate:u$||void 0,estimated:u$&&a$&&s$<=a$?(a$-s$)/u$:void 0,event:o$,lengthComputable:a$!=null,[t$?"download":"upload"]:!0})},r$)},AI$1=(e$,t$)=>{const r$=e$!=null;return[n$=>t$[0]({lengthComputable:r$,total:e$,loaded:n$}),t$[1]]},bI$1=e$=>function(){for(var t$=arguments.length,r$=new Array(t$),n$=0;n$<t$;n$++)r$[n$]=arguments[n$];return Mf$1.asap(()=>e$(...r$))};var wI$1=_C$1.hasStandardBrowserEnv?function(){const e$=_C$1.navigator&&/(msie|trident)/i.test(_C$1.navigator.userAgent),t$=document.createElement("a");let r$;function n$(i$){let o$=i$;return e$&&(t$.setAttribute("href",o$),o$=t$.href),t$.setAttribute("href",o$),{href:t$.href,protocol:t$.protocol?t$.protocol.replace(/:$/,""):"",host:t$.host,search:t$.search?t$.search.replace(/^\?/,""):"",hash:t$.hash?t$.hash.replace(/^#/,""):"",hostname:t$.hostname,port:t$.port,pathname:t$.pathname.charAt(0)==="/"?t$.pathname:"/"+t$.pathname}}return r$=n$(window.location.href),function(i$){const o$=Mf$1.isString(i$)?n$(i$):i$;return o$.protocol===r$.protocol&&o$.host===r$.host}}():function(){return!0},OI$1=_C$1.hasStandardBrowserEnv?{write(e$,t$,r$,n$,i$,o$){const s$=[e$+"="+encodeURIComponent(t$)];Mf$1.isNumber(r$)&&s$.push("expires="+new Date(r$).toGMTString()),Mf$1.isString(n$)&&s$.push("path="+n$),Mf$1.isString(i$)&&s$.push("domain="+i$),o$===!0&&s$.push("secure"),document.cookie=s$.join("; ")},read(e$){const t$=document.cookie.match(new RegExp("(^|;\\s*)("+e$+")=([^;]*)"));return t$?decodeURIComponent(t$[3]):null},remove(e$){this.write(e$,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function NI$1(e$,t$){return e$&&!function(r$){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r$)}(t$)?function(r$,n$){return n$?r$.replace(/\/?\/$/,"")+"/"+n$.replace(/^\/+/,""):r$}(e$,t$):t$}function DI$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}const PI$1=e$=>e$ instanceof gI$1?function(t$){for(var r$=1;r$<arguments.length;r$++){var n$=arguments[r$]!=null?arguments[r$]:{};r$%2?DI$1(Object(n$),!0).forEach(function(i$){Fg$1(t$,i$,n$[i$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t$,Object.getOwnPropertyDescriptors(n$)):DI$1(Object(n$)).forEach(function(i$){Object.defineProperty(t$,i$,Object.getOwnPropertyDescriptor(n$,i$))})}return t$}({},e$):e$;function LI$1(e$,t$){t$=t$||{};const r$={};function n$(u$,l$,d$){return Mf$1.isPlainObject(u$)&&Mf$1.isPlainObject(l$)?Mf$1.merge.call({caseless:d$},u$,l$):Mf$1.isPlainObject(l$)?Mf$1.merge({},l$):Mf$1.isArray(l$)?l$.slice():l$}function i$(u$,l$,d$){return Mf$1.isUndefined(l$)?Mf$1.isUndefined(u$)?void 0:n$(void 0,u$,d$):n$(u$,l$,d$)}function o$(u$,l$){if(!Mf$1.isUndefined(l$))return n$(void 0,l$)}function s$(u$,l$){return Mf$1.isUndefined(l$)?Mf$1.isUndefined(u$)?void 0:n$(void 0,u$):n$(void 0,l$)}function a$(u$,l$,d$){return d$ in t$?n$(u$,l$):d$ in e$?n$(void 0,u$):void 0}const c$={url:o$,method:o$,data:o$,baseURL:s$,transformRequest:s$,transformResponse:s$,paramsSerializer:s$,timeout:s$,timeoutMessage:s$,withCredentials:s$,withXSRFToken:s$,adapter:s$,responseType:s$,xsrfCookieName:s$,xsrfHeaderName:s$,onUploadProgress:s$,onDownloadProgress:s$,decompress:s$,maxContentLength:s$,maxBodyLength:s$,beforeRedirect:s$,transport:s$,httpAgent:s$,httpsAgent:s$,cancelToken:s$,socketPath:s$,responseEncoding:s$,validateStatus:a$,headers:(u$,l$)=>i$(PI$1(u$),PI$1(l$),!0)};return Mf$1.forEach(Object.keys(Object.assign({},e$,t$)),function(u$){const l$=c$[u$]||i$,d$=l$(e$[u$],t$[u$],u$);Mf$1.isUndefined(d$)&&l$!==a$||(r$[u$]=d$)}),r$}var kI$1=e$=>{const t$=LI$1({},e$);let r$,{data:n$,withXSRFToken:i$,xsrfHeaderName:o$,xsrfCookieName:s$,headers:a$,auth:c$}=t$;if(t$.headers=a$=gI$1.from(a$),t$.url=zf$1(NI$1(t$.baseURL,t$.url),e$.params,e$.paramsSerializer),c$&&a$.set("Authorization","Basic "+btoa((c$.username||"")+":"+(c$.password?unescape(encodeURIComponent(c$.password)):""))),Mf$1.isFormData(n$)){if(_C$1.hasStandardBrowserEnv||_C$1.hasStandardBrowserWebWorkerEnv)a$.setContentType(void 0);else if((r$=a$.getContentType())!==!1){const[u$,...l$]=r$?r$.split(";").map(d$=>jp$1(d$).call(d$)).filter(Boolean):[];a$.setContentType([u$||"multipart/form-data",...l$].join("; "))}}if(_C$1.hasStandardBrowserEnv&&(i$&&Mf$1.isFunction(i$)&&(i$=i$(t$)),i$||i$!==!1&&wI$1(t$.url))){const u$=o$&&s$&&OI$1.read(s$);u$&&a$.set(o$,u$)}return t$},MI$1=typeof XMLHttpRequest<"u"&&function(e$){return new Gh$1(function(t$,r$){const n$=kI$1(e$);let i$=n$.data;const o$=gI$1.from(n$.headers).normalize();let s$,a$,c$,u$,l$,{responseType:d$,onUploadProgress:h$,onDownloadProgress:p$}=n$;function _$(){u$&&u$(),l$&&l$(),n$.cancelToken&&n$.cancelToken.unsubscribe(s$),n$.signal&&n$.signal.removeEventListener("abort",s$)}let f$=new XMLHttpRequest;function m$(){if(!f$)return;const v$=gI$1.from("getAllResponseHeaders"in f$&&f$.getAllResponseHeaders());vI$1(function(y$){t$(y$),_$()},function(y$){r$(y$),_$()},{data:d$&&d$!=="text"&&d$!=="json"?f$.response:f$.responseText,status:f$.status,statusText:f$.statusText,headers:v$,config:e$,request:f$}),f$=null}f$.open(n$.method.toUpperCase(),n$.url,!0),f$.timeout=n$.timeout,"onloadend"in f$?f$.onloadend=m$:f$.onreadystatechange=function(){f$&&f$.readyState===4&&(f$.status!==0||f$.responseURL&&f$.responseURL.indexOf("file:")===0)&&setTimeout(m$)},f$.onabort=function(){f$&&(r$(new Uf("Request aborted",Uf.ECONNABORTED,e$,f$)),f$=null)},f$.onerror=function(){r$(new Uf("Network Error",Uf.ERR_NETWORK,e$,f$)),f$=null},f$.ontimeout=function(){let v$=n$.timeout?"timeout of "+n$.timeout+"ms exceeded":"timeout exceeded";const y$=n$.transitional||Xf$1;n$.timeoutErrorMessage&&(v$=n$.timeoutErrorMessage),r$(new Uf(v$,y$.clarifyTimeoutError?Uf.ETIMEDOUT:Uf.ECONNABORTED,e$,f$)),f$=null},i$===void 0&&o$.setContentType(null),"setRequestHeader"in f$&&Mf$1.forEach(o$.toJSON(),function(v$,y$){f$.setRequestHeader(y$,v$)}),Mf$1.isUndefined(n$.withCredentials)||(f$.withCredentials=!!n$.withCredentials),d$&&d$!=="json"&&(f$.responseType=n$.responseType),p$&&([c$,l$]=yI$1(p$,!0),f$.addEventListener("progress",c$)),h$&&f$.upload&&([a$,u$]=yI$1(h$),f$.upload.addEventListener("progress",a$),f$.upload.addEventListener("loadend",u$)),(n$.cancelToken||n$.signal)&&(s$=v$=>{f$&&(r$(!v$||v$.type?new II$1(null,e$,f$):v$),f$.abort(),f$=null)},n$.cancelToken&&n$.cancelToken.subscribe(s$),n$.signal&&(n$.signal.aborted?s$():n$.signal.addEventListener("abort",s$)));const g$=function(v$){const y$=/^([-+\w]{1,25})(:?\/\/|:)/.exec(v$);return y$&&y$[1]||""}(n$.url);g$&&_C$1.protocols.indexOf(g$)===-1?r$(new Uf("Unsupported protocol "+g$+":",Uf.ERR_BAD_REQUEST,e$)):f$.send(i$||null)})},UI$1=(e$,t$)=>{const{length:r$}=e$=e$?e$.filter(Boolean):[];if(t$||r$){let n$,i$=new AbortController;const o$=function(u$){if(!n$){n$=!0,a$();const l$=u$ instanceof Error?u$:this.reason;i$.abort(l$ instanceof Uf?l$:new II$1(l$ instanceof Error?l$.message:l$))}};let s$=t$&&setTimeout(()=>{s$=null,o$(new Uf("timeout ".concat(t$," of ms exceeded"),Uf.ETIMEDOUT))},t$);const a$=()=>{e$&&(s$&&clearTimeout(s$),s$=null,e$.forEach(u$=>{u$.unsubscribe?u$.unsubscribe(o$):u$.removeEventListener("abort",o$)}),e$=null)};e$.forEach(u$=>u$.addEventListener("abort",o$));const{signal:c$}=i$;return c$.unsubscribe=()=>Mf$1.asap(a$),c$}},xI$1=jh$1,VI$1=Sl$1;wi$1({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e$=VI$1.f(this);return{promise:e$.promise,resolve:e$.resolve,reject:e$.reject}}});var FI$1=Sl$1,BI$1=el$1;wi$1({target:"Promise",stat:!0,forced:!0},{try:function(e$){var t$=FI$1.f(this),r$=BI$1(e$);return(r$.error?t$.reject:t$.resolve)(r$.value),t$.promise}});var jI$1=i(xI$1),GI$1=Vm$1.f("asyncIterator"),WI$1=i(GI$1);function HI$1(e$,t$){this.v=e$,this.k=t$}function KI$1(e$){var t$,r$;function n$(o$,s$){try{var a$=e$[o$](s$),c$=a$.value,u$=c$ instanceof HI$1;jI$1.resolve(u$?c$.v:c$).then(function(l$){if(u$){var d$=o$==="return"?"return":"next";if(!c$.k||l$.done)return n$(d$,l$);l$=e$[d$](l$).value}i$(a$.done?"return":"normal",l$)},function(l$){n$("throw",l$)})}catch(l$){i$("throw",l$)}}function i$(o$,s$){switch(o$){case"return":t$.resolve({value:s$,done:!0});break;case"throw":t$.reject(s$);break;default:t$.resolve({value:s$,done:!1})}(t$=t$.next)?n$(t$.key,t$.arg):r$=null}this._invoke=function(o$,s$){return new jI$1(function(a$,c$){var u$={key:o$,arg:s$,resolve:a$,reject:c$,next:null};r$?r$=r$.next=u$:(t$=r$=u$,n$(o$,s$))})},typeof e$.return!="function"&&(this.return=void 0)}function YI$1(e$){return function(){return new KI$1(e$.apply(this,arguments))}}function qI$1(e$){return new HI$1(e$,0)}function zI$1(e$){var t$={},r$=!1;function n$(i$,o$){return r$=!0,{done:!1,value:new HI$1(o$=new jI$1(function(s$){s$(e$[i$](o$))}),1)}}return t$[kg$1!==void 0&&Mg$1||"@@iterator"]=function(){return this},t$.next=function(i$){return r$?(r$=!1,i$):n$("next",i$)},typeof e$.throw=="function"&&(t$.throw=function(i$){if(r$)throw r$=!1,i$;return n$("throw",i$)}),typeof e$.return=="function"&&(t$.return=function(i$){return r$?(r$=!1,i$):n$("return",i$)}),t$}KI$1.prototype[typeof kg$1=="function"&&WI$1||"@@asyncIterator"]=function(){return this},KI$1.prototype.next=function(e$){return this._invoke("next",e$)},KI$1.prototype.throw=function(e$){return this._invoke("throw",e$)},KI$1.prototype.return=function(e$){return this._invoke("return",e$)};var JI$1=i(GI$1);function XI$1(e$){var t$,r$,n$,i$=2;for(typeof Symbol<"u"&&(r$=JI$1,n$=Symbol.iterator);i$--;){if(r$&&(t$=e$[r$])!=null)return t$.call(e$);if(n$&&(t$=e$[n$])!=null)return new QI$1(t$.call(e$));r$="@@asyncIterator",n$="@@iterator"}throw new TypeError("Object is not async iterable")}function QI$1(e$){function t$(r$){if(Object(r$)!==r$)return Gh$1.reject(new TypeError(r$+" is not an object."));var n$=r$.done;return Gh$1.resolve(r$.value).then(function(i$){return{value:i$,done:n$}})}return QI$1=function(r$){this.s=r$,this.n=r$.next},QI$1.prototype={s:null,n:null,next:function(){return t$(this.n.apply(this.s,arguments))},return:function(r$){var n$=this.s.return;return n$===void 0?Gh$1.resolve({value:r$,done:!0}):t$(n$.apply(this.s,arguments))},throw:function(r$){var n$=this.s.return;return n$===void 0?Gh$1.reject(r$):t$(n$.apply(this.s,arguments))}},new QI$1(e$)}const ZI$1=function*(e$,t$){let r$=e$.byteLength;if(!t$||r$<t$)return void(yield e$);let n$,i$=0;for(;i$<r$;)n$=i$+t$,yield e$.slice(i$,n$),i$=n$},$I$1=function(){var e$=YI$1(function*(t$,r$){var n$,i$=!1,o$=!1;try{for(var s$,a$=XI$1(ev$1(t$));i$=!(s$=yield qI$1(a$.next())).done;i$=!1){const c$=s$.value;yield*zI$1(XI$1(ZI$1(c$,r$)))}}catch(c$){o$=!0,n$=c$}finally{try{i$&&a$.return!=null&&(yield qI$1(a$.return()))}finally{if(o$)throw n$}}});return function(t$,r$){return e$.apply(this,arguments)}}(),ev$1=function(){var e$=YI$1(function*(t$){if(t$[JI$1])return void(yield*zI$1(XI$1(t$)));const r$=t$.getReader();try{for(;;){const{done:n$,value:i$}=yield qI$1(r$.read());if(n$)break;yield i$}}finally{yield qI$1(r$.cancel())}});return function(t$){return e$.apply(this,arguments)}}(),tv$1=(e$,t$,r$,n$)=>{const i$=$I$1(e$,t$);let o$,s$=0,a$=c$=>{o$||(o$=!0,n$&&n$(c$))};return new ReadableStream({async pull(c$){try{const{done:u$,value:l$}=await i$.next();if(u$)return a$(),void c$.close();let d$=l$.byteLength;if(r$){let h$=s$+=d$;r$(h$)}c$.enqueue(new Uint8Array(l$))}catch(u$){throw a$(u$),u$}},cancel:c$=>(a$(c$),i$.return())},{highWaterMark:2})};function iv$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function nv$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?iv$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):iv$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}const rv$1=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",ov$1=rv$1&&typeof ReadableStream=="function",sv$1=rv$1&&(typeof TextEncoder=="function"?(av$1=new TextEncoder,e$=>av$1.encode(e$)):async e$=>new Uint8Array(await new Response(e$).arrayBuffer()));var av$1;const cv$1=function(e$){try{for(var t$=arguments.length,r$=new Array(t$>1?t$-1:0),n$=1;n$<t$;n$++)r$[n$-1]=arguments[n$];return!!e$(...r$)}catch{return!1}},dv$1=ov$1&&cv$1(()=>{let e$=!1;const t$=new Request(_C$1.origin,{body:new ReadableStream,method:"POST",get duplex(){return e$=!0,"half"}}).headers.has("Content-Type");return e$&&!t$}),lv$1=ov$1&&cv$1(()=>Mf$1.isReadableStream(new Response("").body)),uv$1={stream:lv$1&&(e$=>e$.body)};var hv$1;rv$1&&(hv$1=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e$=>{!uv$1[e$]&&(uv$1[e$]=Mf$1.isFunction(hv$1[e$])?t$=>t$[e$]():(t$,r$)=>{throw new Uf("Response type '".concat(e$,"' is not supported"),Uf.ERR_NOT_SUPPORT,r$)})}));const pv$1=async(e$,t$)=>{const r$=Mf$1.toFiniteNumber(e$.getContentLength());return r$??(async n$=>n$==null?0:Mf$1.isBlob(n$)?n$.size:Mf$1.isSpecCompliantForm(n$)?(await new Request(_C$1.origin,{method:"POST",body:n$}).arrayBuffer()).byteLength:Mf$1.isArrayBufferView(n$)||Mf$1.isArrayBuffer(n$)?n$.byteLength:(Mf$1.isURLSearchParams(n$)&&(n$+=""),Mf$1.isString(n$)?(await sv$1(n$)).byteLength:void 0))(t$)};var _v$1=rv$1&&(async e$=>{let{url:t$,method:r$,data:n$,signal:i$,cancelToken:o$,timeout:s$,onDownloadProgress:a$,onUploadProgress:c$,responseType:u$,headers:l$,withCredentials:d$="same-origin",fetchOptions:h$}=kI$1(e$);u$=u$?(u$+"").toLowerCase():"text";let p$,_$=UI$1([i$,o$&&o$.toAbortSignal()],s$);const f$=_$&&_$.unsubscribe&&(()=>{_$.unsubscribe()});let m$;try{if(c$&&dv$1&&r$!=="get"&&r$!=="head"&&(m$=await pv$1(l$,n$))!==0){let b$,$$=new Request(t$,{method:"POST",body:n$,duplex:"half"});if(Mf$1.isFormData(n$)&&(b$=$$.headers.get("content-type"))&&l$.setContentType(b$),$$.body){const[C$,N$]=AI$1(m$,yI$1(bI$1(c$)));n$=tv$1($$.body,65536,C$,N$)}}Mf$1.isString(d$)||(d$=d$?"include":"omit");const g$="credentials"in Request.prototype;p$=new Request(t$,nv$1(nv$1({},h$),{},{signal:_$,method:r$.toUpperCase(),headers:l$.normalize().toJSON(),body:n$,duplex:"half",credentials:g$?d$:void 0}));let v$=await fetch(p$);const y$=lv$1&&(u$==="stream"||u$==="response");if(lv$1&&(a$||y$&&f$)){const b$={};["status","statusText","headers"].forEach(k$=>{b$[k$]=v$[k$]});const $$=Mf$1.toFiniteNumber(v$.headers.get("content-length")),[C$,N$]=a$&&AI$1($$,yI$1(bI$1(a$),!0))||[];v$=new Response(tv$1(v$.body,65536,C$,()=>{N$&&N$(),f$&&f$()}),b$)}u$=u$||"text";let S$=await uv$1[Mf$1.findKey(uv$1,u$)||"text"](v$,e$);return!y$&&f$&&f$(),await new Gh$1((b$,$$)=>{vI$1(b$,$$,{data:S$,headers:gI$1.from(v$.headers),status:v$.status,statusText:v$.statusText,config:e$,request:p$})})}catch(g$){throw f$&&f$(),g$&&g$.name==="TypeError"&&/fetch/i.test(g$.message)?Object.assign(new Uf("Network Error",Uf.ERR_NETWORK,e$,p$),{cause:g$.cause||g$}):Uf.from(g$,g$&&g$.code,e$,p$)}});const Ev$1={http:null,xhr:MI$1,fetch:_v$1};Mf$1.forEach(Ev$1,(e$,t$)=>{if(e$){try{Object.defineProperty(e$,"name",{value:t$})}catch{}Object.defineProperty(e$,"adapterName",{value:t$})}});const fv$1=e$=>"- ".concat(e$),mv$1=e$=>Mf$1.isFunction(e$)||e$===null||e$===!1;var Tv$1={getAdapter:e$=>{e$=Mf$1.isArray(e$)?e$:[e$];const{length:t$}=e$;let r$,n$;const i$={};for(let o$=0;o$<t$;o$++){let s$;if(r$=e$[o$],n$=r$,!mv$1(r$)&&(n$=Ev$1[(s$=String(r$)).toLowerCase()],n$===void 0))throw new Uf("Unknown adapter '".concat(s$,"'"));if(n$)break;i$[s$||"#"+o$]=n$}if(!n$){const o$=Object.entries(i$).map(s$=>{let[a$,c$]=s$;return"adapter ".concat(a$," ")+(c$===!1?"is not supported by the environment":"is not available in the build")});throw new Uf("There is no suitable adapter to dispatch the request "+(t$?o$.length>1?`since :
`+o$.map(fv$1).join(`
`):" "+fv$1(o$[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n$},adapters:Ev$1};function Sv$1(e$){if(e$.cancelToken&&e$.cancelToken.throwIfRequested(),e$.signal&&e$.signal.aborted)throw new II$1(null,e$)}function gv$1(e$){return Sv$1(e$),e$.headers=gI$1.from(e$.headers),e$.data=RI$1.call(e$,e$.transformRequest),["post","put","patch"].indexOf(e$.method)!==-1&&e$.headers.setContentType("application/x-www-form-urlencoded",!1),Tv$1.getAdapter(e$.adapter||pI$1.adapter)(e$).then(function(t$){return Sv$1(e$),t$.data=RI$1.call(e$,e$.transformResponse,t$),t$.headers=gI$1.from(t$.headers),t$},function(t$){return CI$1(t$)||(Sv$1(e$),t$&&t$.response&&(t$.response.data=RI$1.call(e$,e$.transformResponse,t$.response),t$.response.headers=gI$1.from(t$.response.headers))),Gh$1.reject(t$)})}const Rv$1="1.7.7",Cv$1={};["object","boolean","number","function","string","symbol"].forEach((e$,t$)=>{Cv$1[e$]=function(r$){return typeof r$===e$||"a"+(t$<1?"n ":" ")+e$}});const Iv$1={};Cv$1.transitional=function(e$,t$,r$){function n$(i$,o$){return"[Axios v"+Rv$1+"] Transitional option '"+i$+"'"+o$+(r$?". "+r$:"")}return(i$,o$,s$)=>{if(e$===!1)throw new Uf(n$(o$," has been removed"+(t$?" in "+t$:"")),Uf.ERR_DEPRECATED);return t$&&!Iv$1[o$]&&(Iv$1[o$]=!0,console.warn(n$(o$," has been deprecated since v"+t$+" and will be removed in the near future"))),!e$||e$(i$,o$,s$)}};var vv$1={assertOptions:function(e$,t$,r$){if(typeof e$!="object")throw new Uf("options must be an object",Uf.ERR_BAD_OPTION_VALUE);const n$=Object.keys(e$);let i$=n$.length;for(;i$-- >0;){const o$=n$[i$],s$=t$[o$];if(s$){const a$=e$[o$],c$=a$===void 0||s$(a$,o$,e$);if(c$!==!0)throw new Uf("option "+o$+" must be "+c$,Uf.ERR_BAD_OPTION_VALUE)}else if(r$!==!0)throw new Uf("Unknown option "+o$,Uf.ERR_BAD_OPTION)}},validators:Cv$1};const yv$1=vv$1.validators;let Av$1=class{constructor(t$){this.defaults=t$,this.interceptors={request:new Jf,response:new Jf}}async request(t$,r$){try{return await this._request(t$,r$)}catch(n$){if(n$ instanceof Error){let i$;Error.captureStackTrace?Error.captureStackTrace(i$={}):i$=new Error;const o$=i$.stack?i$.stack.replace(/^.+\n/,""):"";try{n$.stack?o$&&!String(n$.stack).endsWith(o$.replace(/^.+\n.+\n/,""))&&(n$.stack+=`
`+o$):n$.stack=o$}catch{}}throw n$}}_request(t$,r$){typeof t$=="string"?(r$=r$||{}).url=t$:r$=t$||{},r$=LI$1(this.defaults,r$);const{transitional:n$,paramsSerializer:i$,headers:o$}=r$;n$!==void 0&&vv$1.assertOptions(n$,{silentJSONParsing:yv$1.transitional(yv$1.boolean),forcedJSONParsing:yv$1.transitional(yv$1.boolean),clarifyTimeoutError:yv$1.transitional(yv$1.boolean)},!1),i$!=null&&(Mf$1.isFunction(i$)?r$.paramsSerializer={serialize:i$}:vv$1.assertOptions(i$,{encode:yv$1.function,serialize:yv$1.function},!0)),r$.method=(r$.method||this.defaults.method||"get").toLowerCase();let s$=o$&&Mf$1.merge(o$.common,o$[r$.method]);o$&&Mf$1.forEach(["delete","get","head","post","put","patch","common"],_$=>{delete o$[_$]}),r$.headers=gI$1.concat(s$,o$);const a$=[];let c$=!0;this.interceptors.request.forEach(function(_$){typeof _$.runWhen=="function"&&_$.runWhen(r$)===!1||(c$=c$&&_$.synchronous,a$.unshift(_$.fulfilled,_$.rejected))});const u$=[];let l$;this.interceptors.response.forEach(function(_$){u$.push(_$.fulfilled,_$.rejected)});let d$,h$=0;if(!c$){const _$=[gv$1.bind(this),void 0];for(_$.unshift.apply(_$,a$),_$.push.apply(_$,u$),d$=_$.length,l$=Gh$1.resolve(r$);h$<d$;)l$=l$.then(_$[h$++],_$[h$++]);return l$}d$=a$.length;let p$=r$;for(h$=0;h$<d$;){const _$=a$[h$++],f$=a$[h$++];try{p$=_$(p$)}catch(m$){f$.call(this,m$);break}}try{l$=gv$1.call(this,p$)}catch(_$){return Gh$1.reject(_$)}for(h$=0,d$=u$.length;h$<d$;)l$=l$.then(u$[h$++],u$[h$++]);return l$}getUri(t$){return zf$1(NI$1((t$=LI$1(this.defaults,t$)).baseURL,t$.url),t$.params,t$.paramsSerializer)}};Mf$1.forEach(["delete","get","head","options"],function(e$){Av$1.prototype[e$]=function(t$,r$){return this.request(LI$1(r$||{},{method:e$,url:t$,data:(r$||{}).data}))}}),Mf$1.forEach(["post","put","patch"],function(e$){function t$(r$){return function(n$,i$,o$){return this.request(LI$1(o$||{},{method:e$,headers:r$?{"Content-Type":"multipart/form-data"}:{},url:n$,data:i$}))}}Av$1.prototype[e$]=t$(),Av$1.prototype[e$+"Form"]=t$(!0)});var bv$1=Av$1;let wv$1=class S5{constructor(t$){if(typeof t$!="function")throw new TypeError("executor must be a function.");let r$;this.promise=new Gh$1(function(i$){r$=i$});const n$=this;this.promise.then(i$=>{if(!n$._listeners)return;let o$=n$._listeners.length;for(;o$-- >0;)n$._listeners[o$](i$);n$._listeners=null}),this.promise.then=i$=>{let o$;const s$=new Gh$1(a$=>{n$.subscribe(a$),o$=a$}).then(i$);return s$.cancel=function(){n$.unsubscribe(o$)},s$},t$(function(i$,o$,s$){n$.reason||(n$.reason=new II$1(i$,o$,s$),r$(n$.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t$){this.reason?t$(this.reason):this._listeners?this._listeners.push(t$):this._listeners=[t$]}unsubscribe(t$){if(!this._listeners)return;const r$=this._listeners.indexOf(t$);r$!==-1&&this._listeners.splice(r$,1)}toAbortSignal(){const t$=new AbortController,r$=n$=>{t$.abort(n$)};return this.subscribe(r$),t$.signal.unsubscribe=()=>this.unsubscribe(r$),t$.signal}static source(){let t$;return{token:new S5(function(r$){t$=r$}),cancel:t$}}};var Ov$1=wv$1;const Nv$1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Nv$1).forEach(e$=>{let[t$,r$]=e$;Nv$1[r$]=t$});var Dv$1=Nv$1;const Pv$1=function e$(t$){const r$=new bv$1(t$),n$=HE$1(bv$1.prototype.request,r$);return Mf$1.extend(n$,bv$1.prototype,r$,{allOwnKeys:!0}),Mf$1.extend(n$,r$,null,{allOwnKeys:!0}),n$.create=function(i$){return e$(LI$1(t$,i$))},n$}(pI$1);Pv$1.Axios=bv$1,Pv$1.CanceledError=II$1,Pv$1.CancelToken=Ov$1,Pv$1.isCancel=CI$1,Pv$1.VERSION=Rv$1,Pv$1.toFormData=Wf,Pv$1.AxiosError=Uf,Pv$1.Cancel=Pv$1.CanceledError,Pv$1.all=function(e$){return Gh$1.all(e$)},Pv$1.spread=function(e$){return function(t$){return e$.apply(null,t$)}},Pv$1.isAxiosError=function(e$){return Mf$1.isObject(e$)&&e$.isAxiosError===!0},Pv$1.mergeConfig=LI$1,Pv$1.AxiosHeaders=gI$1,Pv$1.formToJSON=e$=>uI$1(Mf$1.isHTMLForm(e$)?new FormData(e$):e$),Pv$1.getAdapter=Tv$1.getAdapter,Pv$1.HttpStatusCode=Dv$1,Pv$1.default=Pv$1;var Lv$1=Pv$1;const kv$1=()=>{};function Mv$1(){const e$={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:kv$1};return e$.promise=new Gh$1((t$,r$)=>{e$.resolve=n$=>{e$.isFinished||(e$.isResolved=!0,e$.isFinished=!0,t$(n$),e$.value=n$)},e$.reject=n$=>{e$.isFinished||(e$.isRejected=!0,e$.isFinished=!0,r$(n$))}}),e$}const Uv$1=new Map,xv$1=new Map,Vv$1=new Map;let Fv$1=function(e$){return e$.WIN_10="Windows 10",e$.WIN_81="Windows 8.1",e$.WIN_8="Windows 8",e$.WIN_7="Windows 7",e$.WIN_VISTA="Windows Vista",e$.WIN_SERVER_2003="Windows Server 2003",e$.WIN_XP="Windows XP",e$.WIN_2000="Windows 2000",e$.ANDROID="Android",e$.HARMONY_OS="HarmonyOS",e$.OPEN_BSD="Open BSD",e$.SUN_OS="Sun OS",e$.LINUX="Linux",e$.IOS="iOS",e$.MAC_OS="Mac OS",e$.CHROMIUM_OS="Chromium OS",e$.QNX="QNX",e$.UNIX="UNIX",e$.BEOS="BeOS",e$.OS_2="OS/2",e$.SEARCH_BOT="Search Bot",e$}({}),Bv$1=function(e$){return e$.CHROME="Chrome",e$.SAFARI="Safari",e$.EDGE="Edge",e$.FIREFOX="Firefox",e$.OPERA="OPR",e$.QQ="QQBrowser",e$.WECHAT="MicroMessenger",e$}({});const jv$1=new dE$1;let Gv$1=jv$1.getResult(),Wv$1=null;function Hv$1(e$){if(!Wv$1){Gv$1=jv$1.getResult();const t$=function(a$){if(a$.engine.name==="Blink"&&a$.browser.name!=="WeChat")return Bv$1.CHROME;switch(a$.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Bv$1.CHROME;case"Safari":case"Mobile Safari":return Bv$1.SAFARI;case"Edge":return Bv$1.EDGE;case"Firefox":return Bv$1.FIREFOX;case"QQ":case"QQBrowser":return Bv$1.QQ;case"Opera":return Bv$1.OPERA;case"WeChat":return Bv$1.WECHAT;default:return a$.browser.name||""}}(Gv$1),r$=Kv$1(Gv$1),n$=function(a$){return a$.os.name==="Windows"?a$.os.version?a$.os.name+" "+a$.os.version:a$.os.name:a$.os.name||""}(Gv$1),i$=Gv$1.os.version,o$=Kv$1(Gv$1,!1),s$=Gv$1.device.type;if(!(t$&&r$&&n$&&i$))return{name:t$,version:r$,os:n$,osVersion:i$,browserVersion:o$,deviceType:s$};Wv$1={name:t$,version:r$,os:n$,osVersion:i$,browserVersion:o$,deviceType:s$}}return Wv$1}function Kv$1(e$){let t$,r$=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t$=e$.engine.name==="Blink"?e$.engine.version||"":e$.browser.version||"",r$?t$.split(".")[0]:t$}function Yv$1(){return Hv$1().os}function qv$1(){const e$=Hv$1();return"".concat(e$.os," ").concat(e$.osVersion)}function zv$1(){const e$=Hv$1();return!!(Gv$1.engine.name==="WebKit"&&e$.os===Fv$1.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e$.name!==Bv$1.SAFARI||$v$1()&&e$.name!==Bv$1.SAFARI)}function Jv$1(){return Hv$1().name===Bv$1.CHROME}function Xv$1(){return Hv$1().name===Bv$1.SAFARI}function Qv$1(){return Hv$1().name===Bv$1.EDGE}function Zv$1(){return Hv$1().name===Bv$1.FIREFOX}function $v$1(){return Hv$1().os===Fv$1.IOS}function ey$1(e$){const t$=Hv$1();return!(t$.name!==Bv$1.CHROME||!t$.osVersion)&&Number(t$.version)>=e$}function ty$1(e$){const t$=Hv$1();return!(t$.name!==Bv$1.CHROME||!t$.osVersion)&&Number(t$.version)<e$}function iy$1(e$){const t$=Hv$1();return!(t$.name!==Bv$1.EDGE||!t$.osVersion)&&Number(t$.version)>=e$}function ny$1(e$){const t$=Hv$1();return!(t$.name!==Bv$1.SAFARI||!t$.osVersion)&&Number(t$.version)>=e$}function ry$1(e$,t$,r$){const n$=Hv$1();if(n$.os!==Fv$1.IOS||!n$.osVersion)return!1;const i$=n$.osVersion.split(".");return t$&&Number(i$[0])===e$&&Number(i$[1])<t$||Number(i$[0])<e$}function oy$1(e$,t$,r$){const n$=Hv$1();if(n$.name!==Bv$1.SAFARI||!n$.osVersion||!n$.browserVersion)return!1;const i$=n$.browserVersion.split(".");return t$&&Number(i$[0])===e$&&Number(i$[1])<t$||Number(i$[0])<e$}function sy$1(e$){const t$=Hv$1();return!(t$.name!==Bv$1.OPERA||!t$.osVersion)&&Number(t$.version)>=e$}function ay$1(){const e$=Hv$1();if(e$.os!==Fv$1.IOS||!e$.osVersion)return!1;const t$=e$.osVersion.split(".");return Number(t$[0])<14||Number(t$[0])===14&&Number(t$[1])<=6}function cy$1(){const e$=Hv$1();if(e$.os!==Fv$1.IOS||!e$.osVersion)return!1;const t$=e$.osVersion.split(".");return Number(t$[0])===15}function dy$1(){const e$=Hv$1();if(e$.os!==Fv$1.IOS||!e$.osVersion)return!1;const t$=e$.osVersion.split(".");return Number(t$[0])===16}function ly$1(){const e$=Hv$1();if(e$.os!==Fv$1.IOS||!e$.osVersion)return!1;const t$=e$.osVersion.split(".");return Number(t$[0])===15&&Number(t$[1])>=1}function uy$1(){return Xv$1()&&navigator.maxTouchPoints>0}function hy$1(){return Hv$1().name===Bv$1.WECHAT}function py$1(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function _y$1(){const e$=Yv$1();return function(){const{deviceType:t$}=Hv$1();return t$==="mobile"||t$==="tablet"}()||e$===Fv$1.ANDROID||e$===Fv$1.IOS||e$===Fv$1.HARMONY_OS}function Ey$1(){const e$=Hv$1();return e$.name!==Bv$1.EDGE&&e$.name!==Bv$1.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function fy$1(){return Yv$1()===Fv$1.ANDROID}function my$1(){const e$=Hv$1();return fy$1()&&(e$.name===Bv$1.CHROME||e$.name===Bv$1.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Ty$1(e$,t$,r$){return(t$=function(n$){var i$=function(o$,s$){if(typeof o$!="object"||!o$)return o$;var a$=o$[Symbol.toPrimitive];if(a$!==void 0){var c$=a$.call(o$,"string");if(typeof c$!="object")return c$;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o$)}(n$);return typeof i$=="symbol"?i$:i$+""}(t$))in e$?Object.defineProperty(e$,t$,{value:r$,enumerable:!0,configurable:!0,writable:!0}):e$[t$]=r$,e$}function Sy$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function gy$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?Sy$1(Object(r$),!0).forEach(function(n$){Ty$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):Sy$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}let Ry$1=function(e$){return e$.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e$.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e$.TIMEOUT="TIMEOUT",e$.INVALID_PARAMS="INVALID_PARAMS",e$.NOT_READABLE="NOT_READABLE",e$.NOT_SUPPORTED="NOT_SUPPORTED",e$.INVALID_OPERATION="INVALID_OPERATION",e$.OPERATION_ABORTED="OPERATION_ABORTED",e$.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e$.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e$.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e$.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e$.NETWORK_ERROR="NETWORK_ERROR",e$.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e$.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e$.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e$.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e$.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e$.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e$.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e$.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e$.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e$.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e$.PERMISSION_DENIED="PERMISSION_DENIED",e$.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e$.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e$.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e$.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e$.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e$.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e$.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e$.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e$.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e$.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e$.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e$.UID_CONFLICT="UID_CONFLICT",e$.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e$.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e$.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e$.INVALID_TRACK="INVALID_TRACK",e$.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e$.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e$.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e$.ICE_FAILED="ICE_FAILED",e$.PC_CLOSED="PC_CLOSED",e$.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e$.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e$.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e$.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e$.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e$.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e$.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e$.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e$.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e$.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e$.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e$.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e$.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e$.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e$.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e$.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e$.WS_ABORT="WS_ABORT",e$.WS_DISCONNECT="WS_DISCONNECT",e$.WS_ERR="WS_ERR",e$.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e$.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e$.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e$.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e$.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e$.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e$.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e$.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e$.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e$.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e$.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e$.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e$.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e$.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e$.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e$.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e$.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e$.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e$.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e$.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e$.INVALID_PLUGIN="INVALID_PLUGIN",e$.DISCONNECT_P2P="DISCONNECT_P2P",e$.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e$.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e$.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e$.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e$.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e$.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e$.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e$.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e$}({}),Cy$1=class extends Error{constructor(t$){let r$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n$=arguments.length>2?arguments[2]:void 0;super(r$),Ty$1(this,"code",void 0),Ty$1(this,"message",void 0),Ty$1(this,"data",void 0),Ty$1(this,"name","AgoraRTCException"),this.code=t$,this.message="AgoraRTCError ".concat(this.code,": ").concat(r$),this.data=n$}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let t$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r$=arguments.length>1?arguments[1]:void 0;return t$==="error"&&(r$||console).error(this.toString()),t$==="warning"&&(r$||console).warn(this.toString()),this}throw(t$){throw this.print("error",t$),this}};function Iy$1(e$,t$){if(typeof e$!="boolean")throw new Cy$1(Ry$1.INVALID_PARAMS,"Invalid ".concat(t$,": The value is of the boolean type."))}function vy$1(e$,t$,r$){if(!Dn$1(r$).call(r$,e$))throw new Cy$1(Ry$1.INVALID_PARAMS,"".concat(t$," can only be set as ").concat(JSON.stringify(r$)))}function yy$1(e$,t$){let r$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n$=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e$<r$||e$>n$||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i$){return typeof i$=="number"&&i$%1==0}(e$))throw new Cy$1(Ry$1.INVALID_PARAMS,"invalid ".concat(t$,": the value range is [").concat(r$,", ").concat(n$,"]. integer only"))}function Ay$1(e$,t$){if(typeof e$!="number"){if(!(e$.min||e$.max||e$.ideal||e$.exact))throw new Cy$1(Ry$1.INVALID_PARAMS,"".concat(t$," is not a valid ConstrainLong"));e$.min!==void 0&&yy$1(e$.min,"".concat(t$,".min"),0,1/0),e$.max!==void 0&&yy$1(e$.max,"".concat(t$,".max"),1,1/0),e$.exact!==void 0&&yy$1(e$.exact,"".concat(t$,".exact"),1,1/0),e$.ideal!==void 0&&yy$1(e$.ideal,"".concat(t$,".ideal"),1,1/0)}else yy$1(e$,t$,1,1/0)}function by$1(e$,t$){let r$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n$=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i$=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e$==null)throw new Cy$1(Ry$1.INVALID_PARAMS,"".concat(t$||"param"," cannot be empty"));if(!Ny$1(e$,r$,n$,i$))throw new Cy$1(Ry$1.INVALID_PARAMS,"Invalid ".concat(t$||"string param",": Length of the string: [").concat(r$,",").concat(n$,"].").concat(i$?" ASCII characters only.":""))}function wy$1(e$,t$){if(!Array.isArray(e$))throw new Cy$1(Ry$1.INVALID_PARAMS,"".concat(t$," should be an array"))}function Oy$1(e$){return e$==null}function Ny$1(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,n$=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e$=="string"&&e$.length<=r$&&e$.length>=t$&&(!n$||function(i$){if(typeof i$!="string")return!1;for(let o$=0;o$<i$.length;o$+=1){const s$=i$.charCodeAt(o$);if(s$<0||s$>255)return!1}return!0}(e$))}var Dy$1=function(e$){return e$.COVERED="COVERED",e$.POSITION="POSITION",e$.SIZE="SIZE",e$.STYLE="STYLE",e$}(Dy$1||{}),Py$1=function(e$){return e$.UNMOUNTED="UNMOUNTED",e$.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e$}(Py$1||{});const Ly$1=new class{constructor(){Ty$1(this,"_clientSize",null),Ty$1(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Ty$1(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Ty$1(this,"getStyle",e$=>window.getComputedStyle(e$,null)),Ty$1(this,"checkCssVisibleProperty",e$=>{var t$;let r$=!0;const n$=this.getStyle(e$),{display:i$,visibility:o$,opacity:s$,filter:a$}=n$;return(i$==="none"||Dn$1(t$=["hidden","collapse"]).call(t$,o$)||Number(s$)<.1)&&(r$=!1),!!r$&&(a$&&a$.split(" ").filter(c$=>{var u$;const l$=c$.split("(")[0];return Dn$1(u$=["brightness","blur","opacity"]).call(u$,l$)}).map(c$=>{const[u$,l$]=c$.split(/\(|\)/);return[u$,Number(l$.match(/^[0-9\.]+/))]}).forEach(c$=>{const[u$,l$]=c$;switch(u$){case"brightness":(l$<.1||l$>3)&&(r$=!1);break;case"blur":l$>3&&(r$=!1);break;case"opacity":l$<.1&&(r$=!1)}}),r$)}),Ty$1(this,"checkPropertyUpToAllParentNodes",(e$,t$)=>{let r$=!0,n$=!0;const i$=s$=>t$(s$);let o$=e$;for(;o$&&n$;)i$(o$)||(r$=!1,n$=!1),o$=o$.parentElement,o$||(n$=!1);return r$}),Ty$1(this,"checkActualCssVisibleIncludeInherit",e$=>this.checkPropertyUpToAllParentNodes(e$,this.checkCssVisibleProperty)),Ty$1(this,"getSizeAboutClient",e$=>{const{width:t$,height:r$,left:n$,right:i$,top:o$,bottom:s$}=e$.getBoundingClientRect(),a$=this.getClientWidth(),c$=this.getClientHeight();return{width:t$,height:r$,left:n$,right:i$,top:o$,bottom:s$,clientWidth:a$,clientHeight:c$,clientMin:Math.min(a$,c$)}}),Ty$1(this,"checkActualSize",()=>{const{width:e$,height:t$,clientMin:r$}=this._clientSize;return this.checkSizeIsVisible(e$,t$,r$)}),Ty$1(this,"elementFromPoint",(e$,t$)=>document.elementFromPoint?document.elementFromPoint(e$,t$):null),Ty$1(this,"checkCoverForAPoint",(e$,t$,r$)=>{const n$=this.elementFromPoint(e$,t$);return n$!==null&&n$!==r$}),Ty$1(this,"getPointPositionList",()=>{const{width:e$,height:t$,left:r$,top:n$}=this._clientSize,i$=e$/6,o$=t$/6,s$=[],a$=10**6;for(let c$=0;c$<5;c$++)for(let u$=0;u$<5;u$++){const l$=(r$*a$+(c$===0?.1:c$===4?(i$*c$*a$-1e5)/a$:i$*c$)*a$)/a$,d$=(n$*a$+(u$===0?.1:u$===4?(o$*u$*a$-1e5)/a$:o$*u$)*a$)/a$;s$.push({x:l$,y:d$})}return[...s$]}),Ty$1(this,"checkElementCover",e$=>this.getPointPositionList().map(t$=>this.checkCoverForAPoint(t$.x,t$.y,e$)).filter(t$=>!!t$).length>6),Ty$1(this,"checkSizeIsVisible",(e$,t$,r$)=>(e$>50||r$/e$<=10)&&(t$>50||r$/t$<=10)),Ty$1(this,"checkSizeOfPartInClient",()=>{const{left:e$,right:t$,top:r$,bottom:n$,clientHeight:i$,clientWidth:o$,clientMin:s$}=this._clientSize;let a$,c$,u$,l$;if(e$<0)a$=0;else{if(!(e$<o$))return!1;a$=e$}if(t$<0)return!1;if(c$=t$<o$?t$:o$,r$<0)u$=0;else{if(!(r$<i$))return!1;u$=r$}if(n$<0)return!1;l$=n$<i$?n$:i$;const d$=c$-a$,h$=l$-u$;return this.checkSizeIsVisible(d$,h$,s$)}),Ty$1(this,"returnHiddenResult",e$=>(this._clientSize=null,{visible:!1,reason:e$})),Ty$1(this,"checkOneElementVisible",e$=>{if(e$ instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e$)){if(this.checkActualCssVisibleIncludeInherit(e$)){if(this._clientSize=this.getSizeAboutClient(e$),this.checkElementCover(e$))return this.returnHiddenResult(Dy$1.COVERED);{const t$=this.checkActualSize(),r$=this.checkSizeOfPartInClient();return t$&&!r$?this.returnHiddenResult(Dy$1.POSITION):t$?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Dy$1.SIZE)}}return this.returnHiddenResult(Dy$1.STYLE)}return this.returnHiddenResult(Py$1.UNMOUNTED)}return this.returnHiddenResult(Py$1.INVALID_HTML_ELEMENT)}),Ty$1(this,"checkElementIsMountedOnDom",e$=>this.checkPropertyUpToAllParentNodes(e$,t$=>t$.nodeName.toUpperCase()!=="HTML"?t$.parentElement!==null:!!document.documentElement))}};function ky$1(e$){return new TextEncoder().encode(e$)}const My$1=function(e$,t$){const r$=new Uint8Array(e$.byteLength+t$.byteLength);return r$.set(new Uint8Array(e$),0),r$.set(new Uint8Array(t$),e$.byteLength),r$},Uy$1=async e$=>function(t$,r$){let n$="";return new Uint8Array(t$).forEach(i$=>{n$+=i$.toString(r$).padStart(2,"0")}),n$}(await crypto.subtle.digest("SHA-256",ky$1(e$)),16);let xy$1=class{constructor(){Ty$1(this,"_events",{}),Ty$1(this,"addListener",this.on)}getListeners(t$){return this._events[t$]?this._events[t$].map(r$=>r$.listener):[]}on(t$,r$){this._events[t$]||(this._events[t$]=[]);const n$=this._events[t$];this._indexOfListener(n$,r$)===-1&&n$.push({listener:r$,once:!1})}once(t$,r$){this._events[t$]||(this._events[t$]=[]);const n$=this._events[t$];this._indexOfListener(n$,r$)===-1&&n$.push({listener:r$,once:!0})}off(t$,r$){if(!this._events[t$])return;const n$=this._events[t$],i$=this._indexOfListener(n$,r$);i$!==-1&&n$.splice(i$,1),this._events[t$].length===0&&delete this._events[t$]}removeAllListeners(t$){t$?delete this._events[t$]:this._events={}}emit(t$){this._events[t$]||(this._events[t$]=[]);const r$=this._events[t$].map(s$=>s$);for(var n$=arguments.length,i$=new Array(n$>1?n$-1:0),o$=1;o$<n$;o$++)i$[o$-1]=arguments[o$];for(let s$=0;s$<r$.length;s$+=1){const a$=r$[s$];a$.once&&this.off(t$,a$.listener),a$.listener.apply(this,i$||[])}}safeEmit(t$){for(var r$=arguments.length,n$=new Array(r$>1?r$-1:0),i$=1;i$<r$;i$++)n$[i$-1]=arguments[i$];[...this._events[t$]||[]].forEach(o$=>{o$.once&&this.off(t$,o$.listener);try{o$.listener.apply(this,n$)}catch(s$){console.error("safeEmit event:".concat(t$," error ").concat(s$==null?void 0:s$.toString()))}})}_indexOfListener(t$,r$){let n$=t$.length;for(;n$--;)if(t$[n$].listener===r$)return n$;return-1}},Vy$1=null;function Fy$1(){if(Vy$1)return Vy$1;if(window.electron)return Vy$1=window.electron;if(!window.require)return null;try{return Vy$1=window.require("electron"),Vy$1}catch{return null}}let By$1=function(e$){return e$.CREATE_CLIENT="createClient",e$.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e$.SET_AREA="setArea",e$.PRELOAD="PRELOAD",e$.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e$.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e$.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e$.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e$.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e$.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e$.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e$.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e$.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e$.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e$.START_PROXY_SERVER="Client.startProxyServer",e$.STOP_PROXY_SERVER="Client.stopProxyServer",e$.SET_PROXY_SERVER="Client.setProxyServer",e$.SET_TURN_SERVER="Client.setTurnServer",e$.SET_CLIENT_ROLE="Client.setClientRole",e$.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e$.ENABLE_DUAL_STREAM="Client.enableDualStream",e$.DISABLE_DUAL_STREAM="Client.disableDualStream",e$.JOIN="Client.join",e$.LEAVE="Client.leave",e$.PUBLISH="Client.publish",e$.UNPUBLISH="Client.unpublish",e$.SUBSCRIBE="Client.subscribe",e$.MASS_SUBSCRIBE="Client.massSubscribe",e$.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e$.UNSUBSCRIBE="Client.unsubscribe",e$.RENEW_TOKEN="Client.renewToken",e$.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e$.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e$.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e$.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e$.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e$.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e$.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e$.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e$.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e$.START_LIVE_STREAMING="Client.startLiveStreaming",e$.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e$.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e$.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e$.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e$.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e$.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e$.SET_CONFIG_DISTRIBUTE="_configDistribute",e$.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e$.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e$.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e$.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e$.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e$.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e$.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e$.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e$.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e$.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e$.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e$.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e$.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e$.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e$.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e$.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e$.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e$.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e$.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e$.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e$.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e$.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e$.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e$.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e$.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e$.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e$.STREAM_TYPE_CHANGE="streamTypeChange",e$.CONNECTION_STATE_CHANGE="connectionStateChange",e$.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e$.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e$}({}),jy$1=function(e$){return e$.TRACER="tracer",e$}({});function Gy$1(e$){return yy$1(e$.timeout,"config.timeout",0,1e5),yy$1(e$.timeoutFactor,"config.timeoutFactor",0,100,!1),yy$1(e$.maxRetryCount,"config.maxRetryConfig",0,1/0),yy$1(e$.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Wy$1=function(e$){return e$[e$.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e$[e$.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e$[e$.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e$}({}),Hy$1=function(e$){return e$.LEAVE="LEAVE",e$.NETWORK_ERROR="NETWORK_ERROR",e$.SERVER_ERROR="SERVER_ERROR",e$.UID_BANNED="UID_BANNED",e$.FALLBACK="FALLBACK",e$.IP_BANNED="IP_BANNED",e$.CHANNEL_BANNED="CHANNEL_BANNED",e$.LICENSE_MISSING="LICENSE_MISSING",e$.LICENSE_EXPIRED="LICENSE_EXPIRED",e$.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e$.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e$.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e$.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e$.TOKEN_EXPIRE="TOKEN_EXPIRE",e$}({});function Ky$1(e$){if(!Array.isArray(e$)||e$.length<1)return!1;try{e$.forEach(t$=>{if(!t$.urls)throw Error()})}catch{return!1}return!0}function Yy$1(e$){return by$1(e$.turnServerURL,"turnServerURL"),by$1(e$.username,"username"),by$1(e$.password,"password"),e$.udpport&&yy$1(e$.udpport,"udpport",1,99999,!0),e$.forceturn&&Iy$1(e$.forceturn,"forceturn"),e$.security&&Iy$1(e$.security,"security"),e$.tcpport&&yy$1(e$.tcpport,"tcpport",1,99999,!0),!0}function qy$1(e$){return e$.level!==void 0&&vy$1(e$.level,"level",[1,2,3]),e$.delay!==void 0&&yy$1(e$.delay,"delay",0,3e3,!0),!0}let zy$1=function(e$){return e$.CONNECTION_STATE_CHANGE="connection-state-change",e$.MEDIA_RECONNECT_START="media-reconnect-start",e$.MEDIA_RECONNECT_END="media-reconnect-end",e$.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e$.USER_JOINED="user-joined",e$.USER_LEAVED="user-left",e$.USER_PUBLISHED="user-published",e$.USER_UNPUBLISHED="user-unpublished",e$.USER_INFO_UPDATED="user-info-updated",e$.CLIENT_BANNED="client-banned",e$.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e$.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e$.VOLUME_INDICATOR="volume-indicator",e$.CRYPT_ERROR="crypt-error",e$.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e$.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e$.NETWORK_QUALITY="network-quality",e$.STREAM_TYPE_CHANGED="stream-type-changed",e$.STREAM_FALLBACK="stream-fallback",e$.RECEIVE_METADATA="receive-metadata",e$.STREAM_MESSAGE="stream-message",e$.LIVE_STREAMING_ERROR="live-streaming-error",e$.LIVE_STREAMING_WARNING="live-streaming-warning",e$.EXCEPTION="exception",e$.ERROR="error",e$.P2P_LOST="p2p_lost",e$.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e$.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e$.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e$.PUBLISHED_USER_LIST="published-user-list",e$.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e$.CONTENT_INSPECT_ERROR="content-inspect-error",e$.CONTENT_INSPECT_RESULT="content-inspect-result",e$.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e$}({}),Jy$1=function(e$){return e$.NETWORK_ERROR="NETWORK_ERROR",e$.SERVER_ERROR="SERVER_ERROR",e$.MULTI_IP="MULTI_IP",e$.TIMEOUT="TIMEOUT",e$.OFFLINE="OFFLINE",e$.LEAVE="LEAVE",e$.P2P_FAILED="P2P_FAILED",e$.FALLBACK="FALLBACK",e$}({}),Xy$1=function(e$){return e$.ONLINE="ONLINE",e$.OFFLINE="OFFLINE",e$}({}),Qy$1=function(e$){return e$.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e$.ONLINE="ONLINE",e$.OFFLINE="OFFLINE",e$}({});function Zy$1(e$,t$){for(var r$=arguments.length,n$=new Array(r$>2?r$-2:0),i$=2;i$<r$;i$++)n$[i$-2]=arguments[i$];return e$.getListeners(t$).length===0?Gh$1.reject(new Cy$1(Ry$1.UNEXPECTED_ERROR,"can not emit promise")):new Gh$1((o$,s$)=>{e$.emit(t$,...n$,o$,s$)})}function $y$1(e$,t$){if(e$.getListeners(t$).length===0)return Gh$1.resolve();for(var r$=arguments.length,n$=new Array(r$>2?r$-2:0),i$=2;i$<r$;i$++)n$[i$-2]=arguments[i$];return Zy$1(e$,t$,...n$)}function eA$1(e$,t$){if(e$.getListeners(t$).length===0)return null;for(var r$=arguments.length,n$=new Array(r$>2?r$-2:0),i$=2;i$<r$;i$++)n$[i$-2]=arguments[i$];return tA$1(e$,t$,...n$)}function tA$1(e$,t$){let r$=null,n$=null;for(var i$=arguments.length,o$=new Array(i$>2?i$-2:0),s$=2;s$<i$;s$++)o$[s$-2]=arguments[s$];if(e$.emit(t$,...o$,a$=>{r$=a$},a$=>{n$=a$}),n$!==null)throw n$;if(r$===null)throw new Cy$1(Ry$1.UNEXPECTED_ERROR,"handler is not sync");return r$}const iA$1=new class extends xy$1{set networkState(e$){this.emit(Qy$1.NETWORK_STATE_CHANGE,e$,this._networkState),e$===Xy$1.ONLINE?this.emit(Qy$1.ONLINE):e$===Xy$1.OFFLINE&&(this.onlineWaiter=new Gh$1(t$=>{this.once(Qy$1.ONLINE,()=>{this.onlineWaiter=void 0,t$(Xy$1.ONLINE)})}),this.emit(Qy$1.OFFLINE)),this._networkState=e$}get networkState(){return this._networkState}get isOnline(){return this._networkState===Xy$1.ONLINE}constructor(){super(),Ty$1(this,"_moduleName","network-indicator"),Ty$1(this,"_networkState",Xy$1.ONLINE),Ty$1(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Xy$1.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Xy$1.OFFLINE})}};function nA$1(e$,t$){const r$=e$.indexOf(t$);r$!==-1&&e$.splice(r$,1)}function rA$1(e$){const t$=[];return e$.forEach(r$=>{t$.indexOf(r$)===-1&&t$.push(r$)}),t$}function oA$1(e$){Gh$1!==void 0?Gh$1.resolve().then(e$):setTimeout(e$,0)}function sA$1(e$){return JSON.parse(JSON.stringify(e$))}function aA$1(e$){try{return sA$1(e$)}catch{return e$}}const cA$1={};function dA$1(e$,t$){cA$1[t$]||(cA$1[t$]=!0,e$())}function lA$1(e$){const t$=window.atob(e$),r$=new Uint8Array(new ArrayBuffer(t$.length));for(let n$=0;n$<t$.length;n$+=1)r$[n$]=t$.charCodeAt(n$);return r$}function uA$1(e$){let t$="";for(let r$=0;r$<e$.length;r$+=1)t$+=String.fromCharCode(e$[r$]);return window.btoa(t$)}function hA$1(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,r$=new TextEncoder().encode(e$);if(r$.length>t$)r$=r$.slice(0,t$);else if(r$.length<t$){const n$=new Uint8Array(t$);n$.set(r$),r$=n$}return r$}function pA$1(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];const n$=Jn$1(t$).call(t$,(s$,a$)=>s$+a$.length,0),i$=new Uint8Array(new ArrayBuffer(n$));let o$=0;return t$.forEach(s$=>{i$.set(s$,o$),o$+=s$.length}),i$}function _A$1(e$){return window.TextEncoder?new TextEncoder().encode(e$).length:e$.length}function EA$1(e$){let t$=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e$.realFormData&&(e$=e$.realFormData),e$.forEach(r$=>{t$+=typeof r$=="string"?_A$1(r$):r$.size}),t$+138}function fA$1(e$){const t$=new Cy$1(Ry$1.TIMEOUT,"timeout");return new Gh$1((r$,n$)=>{window.setTimeout(()=>n$(t$),e$)})}function mA$1(e$){return new Gh$1(t$=>{window.setTimeout(t$,e$)})}function TA$1(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t$=arguments.length>1?arguments[1]:void 0;const r$=Math.random().toString(16).substr(2,e$).toLowerCase();return r$.length===e$?"".concat(t$).concat(r$):"".concat(t$).concat(r$)+TA$1(e$-r$.length,"")}function SA$1(){return TA$1(32,"").toUpperCase()}const gA$1=()=>{},RA$1=new class{constructor(){Ty$1(this,"fnMap",new Map)}throttleByKey(e$,t$,r$,n$){for(var i$=arguments.length,o$=new Array(i$>4?i$-4:0),s$=4;s$<i$;s$++)o$[s$-4]=arguments[s$];if(this.fnMap.has(t$)){const a$=this.fnMap.get(t$);if(a$.threshold!==r$){a$.fn(...a$.args),clearTimeout(a$.timer);const c$=window.setTimeout(()=>{const u$=this.fnMap.get(t$);u$&&u$.fn(...u$.args),this.fnMap.delete(t$)},r$);this.fnMap.set(t$,{fn:e$,threshold:r$,timer:c$,args:o$,skipFn:n$})}else a$.skipFn&&a$.skipFn(...a$.args),this.fnMap.set(t$,gy$1(gy$1({},a$),{},{fn:e$,args:o$,skipFn:n$}))}else{const a$=window.setTimeout(()=>{const c$=this.fnMap.get(t$);c$&&c$.fn(...c$.args),this.fnMap.delete(t$)},r$);this.fnMap.set(t$,{fn:e$,threshold:r$,timer:a$,args:o$,skipFn:n$})}}},CA$1=RA$1.throttleByKey.bind(RA$1);function IA$1(e$){return typeof e$=="object"&&e$!==null&&!(e$ instanceof RegExp)}function vA$1(e$,t$){if(!IA$1(e$)||!IA$1(t$)||Array.isArray(e$)&&!Array.isArray(t$)||!Array.isArray(e$)&&Array.isArray(t$))return t$;if(Array.isArray(t$)&&Array.isArray(e$)){const r$=[...e$];for(let n$=0;n$<t$.length;n$++)r$[n$]=vA$1(e$[n$],t$[n$]);return r$}{const r$=gy$1({},e$);for(const n$ in t$)Object.prototype.hasOwnProperty.call(t$,n$)&&(Object.prototype.hasOwnProperty.call(e$,n$)?r$[n$]=vA$1(e$[n$],t$[n$]):r$[n$]=t$[n$]);return r$}}function yA$1(e$,t$){let r$=[0];if(r$=new Array(t$).fill(0),e$===0)return r$;let n$=0;for(;e$>0&&(r$[n$]=255&e$,e$>>=8,n$++,n$!==t$););return r$}function AA$1(e$){return typeof e$=="number"?e$:e$.exact||e$.ideal||e$.max||e$.min||0}function bA$1(e$){const t$="0123456789abcdef";function r$(y$){let S$,b$="";for(S$=0;S$<=3;S$++)b$+=t$.charAt(y$>>8*S$+4&15)+t$.charAt(y$>>8*S$&15);return b$}function n$(y$,S$){const b$=(65535&y$)+(65535&S$);return(y$>>16)+(S$>>16)+(b$>>16)<<16|65535&b$}function i$(y$,S$,b$,$$,C$,N$){return n$(function(k$,O$){return k$<<O$|k$>>>32-O$}(n$(n$(S$,y$),n$($$,N$)),C$),b$)}function o$(y$,S$,b$,$$,C$,N$,k$){return i$(S$&b$|~S$&$$,y$,S$,C$,N$,k$)}function s$(y$,S$,b$,$$,C$,N$,k$){return i$(S$&$$|b$&~$$,y$,S$,C$,N$,k$)}function a$(y$,S$,b$,$$,C$,N$,k$){return i$(S$^b$^$$,y$,S$,C$,N$,k$)}function c$(y$,S$,b$,$$,C$,N$,k$){return i$(b$^(S$|~$$),y$,S$,C$,N$,k$)}const u$=function(y$){let S$;const b$=1+(y$.length+8>>6),$$=new Array(16*b$);for(S$=0;S$<16*b$;S$++)$$[S$]=0;for(S$=0;S$<y$.length;S$++)$$[S$>>2]|=y$.charCodeAt(S$)<<S$%4*8;return $$[S$>>2]|=128<<S$%4*8,$$[16*b$-2]=8*y$.length,$$}(e$);let l$,d$,h$,p$,_$,f$=1732584193,m$=-271733879,g$=-1732584194,v$=271733878;for(l$=0;l$<u$.length;l$+=16)d$=f$,h$=m$,p$=g$,_$=v$,f$=o$(f$,m$,g$,v$,u$[l$+0],7,-680876936),v$=o$(v$,f$,m$,g$,u$[l$+1],12,-389564586),g$=o$(g$,v$,f$,m$,u$[l$+2],17,606105819),m$=o$(m$,g$,v$,f$,u$[l$+3],22,-1044525330),f$=o$(f$,m$,g$,v$,u$[l$+4],7,-176418897),v$=o$(v$,f$,m$,g$,u$[l$+5],12,1200080426),g$=o$(g$,v$,f$,m$,u$[l$+6],17,-1473231341),m$=o$(m$,g$,v$,f$,u$[l$+7],22,-45705983),f$=o$(f$,m$,g$,v$,u$[l$+8],7,1770035416),v$=o$(v$,f$,m$,g$,u$[l$+9],12,-1958414417),g$=o$(g$,v$,f$,m$,u$[l$+10],17,-42063),m$=o$(m$,g$,v$,f$,u$[l$+11],22,-1990404162),f$=o$(f$,m$,g$,v$,u$[l$+12],7,1804603682),v$=o$(v$,f$,m$,g$,u$[l$+13],12,-40341101),g$=o$(g$,v$,f$,m$,u$[l$+14],17,-1502002290),m$=o$(m$,g$,v$,f$,u$[l$+15],22,1236535329),f$=s$(f$,m$,g$,v$,u$[l$+1],5,-165796510),v$=s$(v$,f$,m$,g$,u$[l$+6],9,-1069501632),g$=s$(g$,v$,f$,m$,u$[l$+11],14,643717713),m$=s$(m$,g$,v$,f$,u$[l$+0],20,-373897302),f$=s$(f$,m$,g$,v$,u$[l$+5],5,-701558691),v$=s$(v$,f$,m$,g$,u$[l$+10],9,38016083),g$=s$(g$,v$,f$,m$,u$[l$+15],14,-660478335),m$=s$(m$,g$,v$,f$,u$[l$+4],20,-405537848),f$=s$(f$,m$,g$,v$,u$[l$+9],5,568446438),v$=s$(v$,f$,m$,g$,u$[l$+14],9,-1019803690),g$=s$(g$,v$,f$,m$,u$[l$+3],14,-187363961),m$=s$(m$,g$,v$,f$,u$[l$+8],20,1163531501),f$=s$(f$,m$,g$,v$,u$[l$+13],5,-1444681467),v$=s$(v$,f$,m$,g$,u$[l$+2],9,-51403784),g$=s$(g$,v$,f$,m$,u$[l$+7],14,1735328473),m$=s$(m$,g$,v$,f$,u$[l$+12],20,-1926607734),f$=a$(f$,m$,g$,v$,u$[l$+5],4,-378558),v$=a$(v$,f$,m$,g$,u$[l$+8],11,-2022574463),g$=a$(g$,v$,f$,m$,u$[l$+11],16,1839030562),m$=a$(m$,g$,v$,f$,u$[l$+14],23,-35309556),f$=a$(f$,m$,g$,v$,u$[l$+1],4,-1530992060),v$=a$(v$,f$,m$,g$,u$[l$+4],11,1272893353),g$=a$(g$,v$,f$,m$,u$[l$+7],16,-155497632),m$=a$(m$,g$,v$,f$,u$[l$+10],23,-1094730640),f$=a$(f$,m$,g$,v$,u$[l$+13],4,681279174),v$=a$(v$,f$,m$,g$,u$[l$+0],11,-358537222),g$=a$(g$,v$,f$,m$,u$[l$+3],16,-722521979),m$=a$(m$,g$,v$,f$,u$[l$+6],23,76029189),f$=a$(f$,m$,g$,v$,u$[l$+9],4,-640364487),v$=a$(v$,f$,m$,g$,u$[l$+12],11,-421815835),g$=a$(g$,v$,f$,m$,u$[l$+15],16,530742520),m$=a$(m$,g$,v$,f$,u$[l$+2],23,-995338651),f$=c$(f$,m$,g$,v$,u$[l$+0],6,-198630844),v$=c$(v$,f$,m$,g$,u$[l$+7],10,1126891415),g$=c$(g$,v$,f$,m$,u$[l$+14],15,-1416354905),m$=c$(m$,g$,v$,f$,u$[l$+5],21,-57434055),f$=c$(f$,m$,g$,v$,u$[l$+12],6,1700485571),v$=c$(v$,f$,m$,g$,u$[l$+3],10,-1894986606),g$=c$(g$,v$,f$,m$,u$[l$+10],15,-1051523),m$=c$(m$,g$,v$,f$,u$[l$+1],21,-2054922799),f$=c$(f$,m$,g$,v$,u$[l$+8],6,1873313359),v$=c$(v$,f$,m$,g$,u$[l$+15],10,-30611744),g$=c$(g$,v$,f$,m$,u$[l$+6],15,-1560198380),m$=c$(m$,g$,v$,f$,u$[l$+13],21,1309151649),f$=c$(f$,m$,g$,v$,u$[l$+4],6,-145523070),v$=c$(v$,f$,m$,g$,u$[l$+11],10,-1120210379),g$=c$(g$,v$,f$,m$,u$[l$+2],15,718787259),m$=c$(m$,g$,v$,f$,u$[l$+9],21,-343485551),f$=n$(f$,d$),m$=n$(m$,h$),g$=n$(g$,p$),v$=n$(v$,_$);return r$(f$)+r$(m$)+r$(g$)+r$(v$)}let wA$1=1,OA$1=console,NA$1=class{static setLogger(t$){OA$1=t$}constructor(t$){Ty$1(this,"lockingPromise",Gh$1.resolve()),Ty$1(this,"locks",0),Ty$1(this,"name",""),Ty$1(this,"lockId",void 0),this.lockId=wA$1++,t$&&(this.name=t$),OA$1.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(t$){let r$;this.locks+=1,OA$1.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof t$=="string"?t$:""));const n$=new Gh$1(o$=>{r$=()=>{this.locks-=1,OA$1.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof t$=="string"?t$:"")),o$()}}),i$=this.lockingPromise.then(()=>r$);return this.lockingPromise=this.lockingPromise.then(()=>n$),i$}};function DA$1(e$,t$){return function(r$,n$,i$){const o$=i$.value;if(typeof o$!="function")throw new Error("Cannot use mutex on object property.");return i$.value=async function(){const s$=this[t$];if(!s$)throw new Error("mutex property key ".concat(t$," doesn't exist on ").concat(e$));const a$=await s$.lock("From ".concat(e$,".").concat(n$));try{for(var c$=arguments.length,u$=new Array(c$),l$=0;l$<c$;l$++)u$[l$]=arguments[l$];return await o$.apply(this,u$)}finally{a$()}},i$}}const PA$1={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function LA$1(e$,t$){const r$=Math.floor(t$.timeout*Math.pow(t$.timeoutFactor,e$));return Math.min(t$.maxRetryTimeout,r$)}function kA$1(e$,t$,r$,n$){const i$=Object.assign({},PA$1,n$);let o$=i$.timeout;const s$=async()=>{await function(u$){return new Gh$1(l$=>{window.setTimeout(l$,u$)})}(o$),o$*=i$.timeoutFactor,o$=Math.min(i$.maxRetryTimeout,o$)};let a$=!1;const c$=new Gh$1(async(u$,l$)=>{t$=t$||(()=>!1),r$=r$||(()=>!0);for(let d$=0;d$<i$.maxRetryCount;d$+=1){if(a$)return l$(new Cy$1(Ry$1.OPERATION_ABORTED));try{const h$=await e$();if(!t$(h$,d$)||d$+1===i$.maxRetryCount)return u$(h$);await s$()}catch(h$){if(!r$(h$,d$)||d$+1===i$.maxRetryCount)return l$(h$);await s$()}}});return c$.cancel=()=>a$=!0,c$}let MA$1=class{constructor(t$){Ty$1(this,"input",[]),Ty$1(this,"size",void 0),this.size=t$}add(t$){this.input.push(t$),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t$;return this.input.length===0?0:Jn$1(t$=this.input).call(t$,(r$,n$)=>r$+n$)/this.input.length}},UA$1,xA$1=0,VA$1=0;function FA$1(e$,t$,r$,n$){return new Gh$1((i$,o$)=>{t$.responseType=t$.responseType||"json",t$.data&&!r$?(t$.data=JSON.stringify(t$.data),xA$1+=_A$1(t$.data)):r$&&(t$.data.size?xA$1+=t$.data.size:t$.data instanceof FormData?xA$1+=EA$1(t$.data):xA$1+=_A$1(JSON.stringify(t$.data))),t$.headers=t$.headers||{},t$.headers["Content-Type"]=t$.headers["Content-Type"]||"application/json",t$.method="POST",t$.url=e$,Lv$1.request(t$).then(s$=>{typeof s$.data=="string"?VA$1+=_A$1(s$.data):s$.data instanceof ArrayBuffer||s$.data instanceof Uint8Array?VA$1+=s$.data.byteLength:VA$1+=_A$1(JSON.stringify(s$.data)),i$(s$.data)}).catch(s$=>{Lv$1.isCancel(s$)?o$(new Cy$1(Ry$1.OPERATION_ABORTED,"cancel token canceled")):s$.code==="ECONNABORTED"?o$(new Cy$1(Ry$1.NETWORK_TIMEOUT,s$.message)):s$.response?o$(new Cy$1(Ry$1.NETWORK_RESPONSE_ERROR,s$.response.status)):o$(new Cy$1(Ry$1.NETWORK_ERROR,s$.message))})})}async function BA$1(e$,t$){const r$=new Blob([t$.data],{type:"buffer"});return await FA$1(e$,gy$1(gy$1({},t$),{},{data:r$,headers:{"Content-Type":"application/octet-stream"}}),!0)}const jA$1=()=>window.isSecureContext!==void 0,GA$1=function(e$){if(e$.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e$;const t$=e$.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t$&&t$[1]&&t$[2]){const r$=t$[1],n$=t$[2];return"".concat(r$,".").concat(n$)}return"4.0.0.999"}("4.22.1"),WA$1=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let HA$1=function(e$){return e$.Default="default",e$.Auto="auto",e$.Relay="relay",e$.SdRtn="sd-rtn",e$}({});const KA$1=function(){const e$="us".concat("erna","me"),t$="pa".concat("sswo","rd"),r$=["t","s","t"];r$.splice(1,0,"e");const n$=r$.join(""),i$=[];for(let a$=0;a$<6;a$++)i$.push("1");const o$=i$.join(""),s$={};return s$[e$]=n$,s$[t$]=o$,Object.assign(s$,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=KA$1;const YA$1={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},qA$1="v4.22.1-0-g1c8e27e9(9/19/2024, 2:23:30 PM)",zA$1=gy$1(gy$1({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:YA$1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0,DISABLE_SCREEN_SHARE_REMB:!1},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0});function JA$1(e$,t$,r$){var n$,i$,o$;Dn$1(n$=Object.keys(zA$1)).call(n$,e$)&&(!r$&&Dn$1(i$=Object.keys(QA$1)).call(i$,e$)||(zA$1[e$]=t$,e$==="ENABLE_VIDEO_SEI"&&t$===!0&&(zA$1.ENABLE_ENCODED_TRANSFORM=!0),e$==="USE_NEW_NETWORK_CONFIG"&&t$&&(o$=!!t$,zA$1.USE_NEW_NETWORK_CONFIG=o$,o$&&(zA$1.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],zA$1.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],zA$1.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],zA$1.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],zA$1.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",zA$1.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",zA$1.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e$==="ENABLE_PRE_SUB"&&t$&&(zA$1.ENABLE_INSTANT_VIDEO=!0,zA$1.ENABLE_PREALLOC_PC=!0),e$==="ENABLE_SVC"&&t$&&(zA$1.ENABLE_AUT_CC=!0)))}function XA$1(e$){return zA$1[e$]}WA$1||(zA$1.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],zA$1.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],zA$1.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],zA$1.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],zA$1.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],zA$1.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],zA$1.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",zA$1.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",zA$1.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",zA$1.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",zA$1.AREAS=["NORTH_AMERICA","OVERSEA"]);const QA$1={};var ZA$1=function(e$){return e$.SET_SESSION_ID="SET_SESSION_ID",e$.SET_P2P_ID="SET_P2P_id",e$.SET_DC_ID="SET_DC_id",e$.SET_UID="SET_UID",e$.SET_INT_UID="SET_INT_UID",e$.SET_PUB_ID="SET_PUB_ID",e$.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e$.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e$.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e$.AVOID_JOIN_START="AVOID_JOIN_START",e$.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e$.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e$.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e$.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e$.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e$.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e$.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e$.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e$.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e$.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e$.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e$.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e$.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e$.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e$.RESET_KEY_METRICS="RESET_KEY_METRICS",e$.SET_USE_P2P="SET_USE_P2P",e$.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e$}(ZA$1||{});let $A$1=class{constructor(t$,r$,n$,i$){Ty$1(this,"state",void 0),this.state={codec:t$,audioCodec:r$,mode:n$,clientId:i$,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:HA$1.Default}}dispatch(t$){this.state=function(r$,n$){switch(n$.type){case ZA$1.SET_SESSION_ID:return gy$1(gy$1({},r$),{},{sessionId:n$.sessionId});case ZA$1.SET_P2P_ID:return gy$1(gy$1({},r$),{},{p2pId:n$.p2pId});case ZA$1.SET_UID:return gy$1(gy$1({},r$),{},{uid:n$.uid});case ZA$1.SET_INT_UID:return gy$1(gy$1({},r$),{},{intUid:n$.intUid});case ZA$1.SET_PUB_ID:return gy$1(gy$1({},r$),{},{pubId:n$.pubId});case ZA$1.KEY_METRIC_CLIENT_CREATED:return gy$1(gy$1({},r$),{},{keyMetrics:gy$1(gy$1({},r$.keyMetrics),{},{clientCreated:n$.metric})});case ZA$1.KEY_METRIC_JOIN_START:return gy$1(gy$1({},r$),{},{keyMetrics:gy$1(gy$1({},r$.keyMetrics),{},{joinStart:n$.metric})});case ZA$1.AVOID_JOIN_START:return gy$1(gy$1({},r$),{},{avoidJoinStart:n$.avoidJoinStart});case ZA$1.KEY_METRIC_JOIN_END:return gy$1(gy$1({},r$),{},{keyMetrics:gy$1(gy$1({},r$.keyMetrics),{},{joinEnd:n$.metric})});case ZA$1.KEY_METRIC_REQUEST_AP_START:return gy$1(gy$1({},r$),{},{keyMetrics:gy$1(gy$1({},r$.keyMetrics),{},{requestAPStart:n$.metric})});case ZA$1.KEY_METRIC_REQUEST_AP_END:return gy$1(gy$1({},r$),{},{keyMetrics:gy$1(gy$1({},r$.keyMetrics),{},{requestAPEnd:n$.metric})});case ZA$1.KEY_METRIC_JOIN_GATEWAY_START:return gy$1(gy$1({},r$),{},{keyMetrics:gy$1(gy$1({},r$.keyMetrics),{},{joinGatewayStart:n$.metric})});case ZA$1.KEY_METRIC_JOIN_GATEWAY_END:return gy$1(gy$1({},r$),{},{keyMetrics:gy$1(gy$1({},r$.keyMetrics),{},{joinGatewayEnd:n$.metric})});case ZA$1.KEY_METRIC_PEER_CONNECTION_START:return gy$1(gy$1({},r$),{},{keyMetrics:gy$1(gy$1({},r$.keyMetrics),{},{peerConnectionStart:n$.metric})});case ZA$1.KEY_METRIC_PEER_CONNECTION_END:return gy$1(gy$1({},r$),{},{keyMetrics:gy$1(gy$1({},r$.keyMetrics),{},{peerConnectionEnd:n$.metric})});case ZA$1.KEY_METRIC_DESCRIPTION_START:return gy$1(gy$1({},r$),{},{keyMetrics:gy$1(gy$1({},r$.keyMetrics),{},{descriptionStart:n$.metric})});case ZA$1.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return gy$1(gy$1({},r$),{},{keyMetrics:gy$1(gy$1({},r$.keyMetrics),{},{signalChannelOpen:n$.metric})});case ZA$1.KEY_METRIC_ICE_CONNECTION_END:return gy$1(gy$1({},r$),{},{keyMetrics:gy$1(gy$1({},r$.keyMetrics),{},{iceConnectionEnd:n$.metric})});case ZA$1.KEY_METRIC_PUBLISH:{const i$=r$.keyMetrics.publish,o$=i$.findIndex(s$=>s$.trackId===n$.metric.trackId);return o$!==-1?(i$[o$]=gy$1(gy$1({},i$[o$]),n$.metric),gy$1(gy$1({},r$),{},{keyMetrics:gy$1(gy$1({},r$.keyMetrics),{},{publish:[...i$]})})):gy$1(gy$1({},r$),{},{keyMetrics:gy$1(gy$1({},r$.keyMetrics),{},{publish:[...r$.keyMetrics.publish,n$.metric]})})}case ZA$1.KEY_METRIC_SUBSCRIBE:{const i$=r$.keyMetrics.subscribe,o$=i$.findIndex(s$=>s$.userId===n$.metric.userId&&s$.type===n$.metric.type);return o$!==-1?(i$[o$]=gy$1(gy$1({},i$[o$]),n$.metric),gy$1(gy$1({},r$),{},{keyMetrics:gy$1(gy$1({},r$.keyMetrics),{},{subscribe:[...i$]})})):gy$1(gy$1({},r$),{},{keyMetrics:gy$1(gy$1({},r$.keyMetrics),{},{subscribe:[...r$.keyMetrics.subscribe,n$.metric]})})}case ZA$1.SET_CLOUD_PROXY_SERVER_MODE:return r$.cloudProxyServerMode=n$.mode,r$;case ZA$1.RECORD_JOIN_CHANNEL_SERVICE:return typeof n$.index!="number"?r$.joinChannelServiceRecords=[...r$.joinChannelServiceRecords,n$.record]:(r$.joinChannelServiceRecords[n$.index]=gy$1(gy$1({},r$.joinChannelServiceRecords[n$.index]),n$.record),r$.joinChannelServiceRecords=[...r$.joinChannelServiceRecords]),r$;case ZA$1.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return r$.joinChannelServiceRecords=[],r$;case ZA$1.RESET_KEY_METRICS:return r$.keyMetrics={publish:[],subscribe:[]},r$;case ZA$1.SET_USE_P2P:return gy$1(gy$1({},r$),{},{useP2P:n$.val});case ZA$1.SET_TRANSPORT_TYPE:return gy$1(gy$1({},r$),{},{p2pTransport:n$.val});default:return r$}}(this.state,t$)}set sessionId(t$){this.dispatch({type:ZA$1.SET_SESSION_ID,sessionId:t$})}get sessionId(){return this.state.sessionId}set codec(t$){this.state.codec=t$}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t$){this.dispatch({type:ZA$1.SET_P2P_ID,p2pId:t$})}get p2pId(){return this.state.p2pId}set dcId(t$){this.dispatch({type:ZA$1.SET_DC_ID,dcId:t$})}get dcId(){return this.state.dcId}set uid(t$){this.dispatch({type:ZA$1.SET_UID,uid:t$})}get uid(){return this.state.uid}set intUid(t$){this.dispatch({type:ZA$1.SET_INT_UID,intUid:t$})}get intUid(){return this.state.intUid}set pubId(t$){this.dispatch({type:ZA$1.SET_PUB_ID,pubId:t$})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t$){this.dispatch({type:ZA$1.SET_CLOUD_PROXY_SERVER_MODE,mode:t$})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(t$){this.dispatch({type:ZA$1.SET_USE_P2P,val:t$})}get useP2P(){return this.state.useP2P}set p2pTransport(t$){this.dispatch({type:ZA$1.SET_TRANSPORT_TYPE,val:t$})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:ZA$1.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ZA$1.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:ZA$1.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ZA$1.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ZA$1.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ZA$1.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ZA$1.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ZA$1.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ZA$1.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:ZA$1.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ZA$1.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ZA$1.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t$,r$,n$,i$){this.dispatch({type:ZA$1.KEY_METRIC_PUBLISH,metric:gy$1(gy$1({trackId:t$,type:r$},n$&&{publishStart:n$}),i$&&{publishEnd:i$})})}subscribe(t$,r$,n$,i$,o$,s$,a$){this.dispatch({type:ZA$1.KEY_METRIC_SUBSCRIBE,metric:gy$1(gy$1(gy$1(gy$1(gy$1({userId:t$,type:r$},n$&&{subscribeStart:n$}),i$&&{subscribeEnd:i$}),o$&&{firstFrame:o$}),s$&&{streamAdded:s$}),a$&&{firstDecoded:a$})})}massSubscribe(t$,r$,n$,i$){t$.forEach(o$=>{this.dispatch({type:ZA$1.KEY_METRIC_SUBSCRIBE,metric:gy$1(gy$1(gy$1({userId:o$.userId,type:o$.type},r$&&{subscribeStart:r$}),n$&&{subscribeEnd:n$}),i$&&{firstFrame:i$})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t$,r$){t$.service==="gateway"&&Array.isArray(t$.urls)&&(t$.urls=t$.urls.map(n$=>n$.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof r$!="number"?(this.dispatch({type:ZA$1.RECORD_JOIN_CHANNEL_SERVICE,record:gy$1(gy$1({},t$),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(r$<0||r$>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ZA$1.RECORD_JOIN_CHANNEL_SERVICE,record:t$,index:r$}),r$)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ZA$1.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ZA$1.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t$){this.dispatch({type:ZA$1.AVOID_JOIN_START,avoidJoinStart:t$})}},eb$1=function(e$){return e$.h264="h264",e$.h265="h265",e$.vp8="vp8",e$.vp9="vp9",e$.av1="av1",e$}({});(function(e$){e$.opus="opus",e$.pcma="pcma",e$.pcmu="pcmu",e$.g722="g722"})({});const tb$1=128,ib$1=96,nb$1=1e3,rb$1=10;let ob$1=0;function sb$1(e$,t$,r$){return(t$=function(n$){var i$=function(o$,s$){if(typeof o$!="object"||!o$)return o$;var a$=o$[Symbol.toPrimitive];if(a$!==void 0){var c$=a$.call(o$,"string");if(typeof c$!="object")return c$;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o$)}(n$);return typeof i$=="symbol"?i$:i$+""}(t$))in e$?Object.defineProperty(e$,t$,{value:r$,enumerable:!0,configurable:!0,writable:!0}):e$[t$]=r$,e$}function ab$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function cb$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?ab$1(Object(r$),!0).forEach(function(n$){sb$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):ab$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}const db$1=new class extends xy$1{constructor(){super(...arguments),sb$1(this,"currentUploadLogID",0)}reportLogUploadError(e$){const{errorRange:t$}=e$;t$[t$.length-1]&&t$[t$.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t$[t$.length-1],this.emit("REPORT_LOG_UPLOAD",e$))}};let lb$1=class{constructor(t$){sb$1(this,"logger",void 0),sb$1(this,"prefixLists",[]),this.logger=t$}debug(){for(var t$=arguments.length,r$=new Array(t$),n$=0;n$<t$;n$++)r$[n$]=arguments[n$];this.logger.debug(...this.prefixLists,...r$)}info(){for(var t$=arguments.length,r$=new Array(t$),n$=0;n$<t$;n$++)r$[n$]=arguments[n$];this.logger.info(...this.prefixLists,...r$)}warning(){for(var t$=arguments.length,r$=new Array(t$),n$=0;n$<t$;n$++)r$[n$]=arguments[n$];this.logger.warning(...this.prefixLists,...r$)}error(){for(var t$=arguments.length,r$=new Array(t$),n$=0;n$<t$;n$++)r$[n$]=arguments[n$];this.logger.error(...this.prefixLists,...r$)}prefix(t$){return this.prefixLists.push(t$),this}popPrefix(){return this.prefixLists.pop(),this}};function ub$1(){const e$=new Date;return e$.toTimeString().split(" ")[0]+":"+e$.getMilliseconds()}function hb$1(){const e$=new Date,t$=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t$?(t$==null?void 0:t$[0])+":"+e$.getUTCMilliseconds():e$.toTimeString().split(" ")[0]+":"+e$.getMilliseconds()}const pb$1={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},_b$1=Date.now(),Eb$1=e$=>{for(const t$ in pb$1)if(Object.prototype.hasOwnProperty.call(pb$1,t$)&&pb$1[t$]===e$)return t$;return"DEFAULT"},fb$1=new class{constructor(){sb$1(this,"proxyServerURL",void 0),sb$1(this,"logLevel",pb$1.DEBUG),sb$1(this,"uploadState","collecting"),sb$1(this,"uploadLogWaitingList",[]),sb$1(this,"uploadLogUploadingList",[]),sb$1(this,"uploadErrorCount",0),sb$1(this,"currentLogID",0),sb$1(this,"url",void 0),sb$1(this,"extLog",(e$,t$)=>{this.appendLogToWaitingList(e$,...t$)})}debug(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];const n$=[pb$1.DEBUG].concat(t$);this.log.apply(this,n$)}info(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];const n$=[pb$1.INFO].concat(t$);this.log.apply(this,n$)}warning(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];const n$=[pb$1.WARNING].concat(t$);this.log.apply(this,n$)}warn(){this.warning(...arguments)}error(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];const n$=[pb$1.ERROR].concat(t$);this.log.apply(this,n$)}upload(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];const n$=[pb$1.DEBUG].concat(t$);this.uploadLog.apply(this,n$)}setLogLevel(e$){e$=Math.min(Math.max(0,e$),4),this.logLevel=e$}enableLogUpload(){JA$1("UPLOAD_LOG",!0)}disableLogUpload(){JA$1("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e$){this.proxyServerURL=e$}prefix(e$){return new lb$1(this).prefix(e$)}log(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];if(Date.now()-_b$1<100)return void setTimeout(()=>{this.log(...t$)},Date.now()-_b$1);const n$=Math.max(0,Math.min(4,t$[0]));if(t$[0]=ub$1()+" Agora-SDK [".concat(Eb$1(n$),"]:"),this.appendLogToWaitingList(n$,...t$),n$<this.logLevel)return;const i$=ub$1()+" %cAgora-SDK [".concat(Eb$1(n$),"]:");let o$=[];if(!XA$1("USE_NEW_LOG"))switch(n$){case pb$1.DEBUG:o$=[i$,"color: #64B5F6;"].concat(t$.slice(1)),console.log.apply(console,o$);break;case pb$1.INFO:o$=[i$,"color: #1E88E5; font-weight: bold;"].concat(t$.slice(1)),console.log.apply(console,o$);break;case pb$1.WARNING:o$=[i$,"color: #FB8C00; font-weight: bold;"].concat(t$.slice(1)),console.warn.apply(console,o$);break;case pb$1.ERROR:o$=[i$,"color: #B00020; font-weight: bold;"].concat(t$.slice(1)),console.error.apply(console,o$)}}uploadLog(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];if(Date.now()-_b$1<100)return void setTimeout(()=>{this.uploadLog(...t$)},Date.now()-_b$1);const n$=Math.max(0,Math.min(4,t$[0]));t$[0]=ub$1()+" Agora-SDK [".concat(Eb$1(n$),"]:"),this.appendLogToWaitingList(n$,...t$)}appendLogToWaitingList(e$){if(!XA$1("UPLOAD_LOG"))return;for(var t$=arguments.length,r$=new Array(t$>1?t$-1:0),n$=1;n$<t$;n$++)r$[n$-1]=arguments[n$];Array.isArray(r$[0])?r$[0][0]=hb$1()+" Agora-SDK [".concat(Eb$1(e$),"]:"):r$[0]=hb$1()+" Agora-SDK [".concat(Eb$1(e$),"]:");let i$="";r$.forEach(o$=>{typeof o$=="object"&&(o$=JSON.stringify(o$)),i$+="".concat(o$," ")}),this.uploadLogWaitingList.push({payload_str:i$,log_level:e$,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e$=this.uploadLogUploadingList,t$={sdk_version:GA$1,process_id:XA$1("PROCESS_ID"),payload:JSON.stringify(e$)};return kA$1(async()=>{const r$=await Lv$1.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(XA$1("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(XA$1("LOG_UPLOAD_SERVER"),"/upload/v1")),t$,{responseType:"text"});if(r$.data!=="OK"){const n$=new Error("unexpected upload log response");throw n$.response=r$,n$}},()=>(this.uploadLogUploadingList=[],!1),r$=>{const n$={status:-1,message:r$.message,errorRange:e$.map(i$=>i$.log_item_id)};return r$.response?(n$.status=r$.response.status,n$.data=r$.response.data,n$.headers=r$.response.headers):r$.request&&(n$.status=r$.request.status),db$1.reportLogUploadError(n$),!0},{timeout:XA$1("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:XA$1("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,XA$1("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),XA$1("UPLOAD_LOG_INTERVAL"))}).catch(e$=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),XA$1("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),XA$1("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var mb$1;function Tb$1(e$){return by$1(e$.reportId,"params.reportId",0,100,!1),by$1(e$.category,"params.category",0,100,!1),by$1(e$.event,"params.event",0,100,!1),by$1(e$.label,"params.label",0,100,!1),yy$1(e$.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(mb$1={}).FREE="free",mb$1.UPLOADING="uploading",function(e$){e$[e$.MISC=0]="MISC",e$[e$.INTERNAL_EVENT=1]="INTERNAL_EVENT",e$[e$.PUBLIC_EVENT=2]="PUBLIC_EVENT",e$[e$.WEB_EVENT=3]="WEB_EVENT",e$[e$.INTERNAL_API=4]="INTERNAL_API",e$[e$.WEB_API=5]="WEB_API",e$[e$.PUBLIC_API=6]="PUBLIC_API"}({});const Sb$1={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let gb$1=function(e$){return e$.PUBLISH="publish",e$.SUBSCRIBE="subscribe",e$.WS_COMPRESSOR_INIT="ws_compressor_init",e$.SESSION_INIT="session_init",e$.JOIN_CHOOSE_SERVER="join_choose_server",e$.REQ_USER_ACCOUNT="req_user_account",e$.JOIN_GATEWAY="join_gateway",e$.REJOIN_GATEWAY="rejoin_gateway",e$.STREAM_SWITCH="stream_switch",e$.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e$.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e$.FIRST_VIDEO_RECEIVED="first_video_received",e$.FIRST_AUDIO_RECEIVED="first_audio_received",e$.FIRST_VIDEO_DECODE="first_video_decode",e$.FIRST_AUDIO_DECODE="first_audio_decode",e$.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e$.ON_ADD_VIDEO_STREAM="on_add_video_stream",e$.ON_UPDATE_STREAM="on_update_stream",e$.ON_REMOVE_STREAM="on_remove_stream",e$.USER_ANALYTICS="req_user_analytics",e$.PC_STATS="pc_stats",e$.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e$}({}),Rb$1=function(e$){return e$.SESSION="io.agora.pb.Wrtc.Session",e$.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e$.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e$.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e$.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e$.PUBLISH="io.agora.pb.Wrtc.Publish",e$.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e$.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e$.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e$.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e$.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e$.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e$.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e$.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e$.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e$.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e$.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e$.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e$.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e$.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e$.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e$.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e$.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e$.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e$.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e$.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e$.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e$.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e$.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e$.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e$.PC_STATS="io.agora.pb.Wrtc.PCStats",e$.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e$}({});(function(e$){e$[e$.WORKER_EVENT=156]="WORKER_EVENT",e$[e$.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Cb$1=function(e$){return e$[e$.SESSION=26]="SESSION",e$[e$.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e$[e$.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e$[e$.JOIN_GATEWAY=28]="JOIN_GATEWAY",e$[e$.PUBLISH=30]="PUBLISH",e$[e$.SUBSCRIBE=29]="SUBSCRIBE",e$[e$.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e$[e$.STREAM_SWITCH=32]="STREAM_SWITCH",e$[e$.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e$[e$.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e$[e$.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e$[e$.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e$[e$.API_INVOKE=41]="API_INVOKE",e$[e$.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e$[e$.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e$[e$.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e$[e$.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e$[e$.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e$[e$.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e$[e$.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e$[e$.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e$[e$.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e$[e$.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e$[e$.WORKER_EVENT=156]="WORKER_EVENT",e$[e$.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e$[e$.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e$[e$.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e$[e$.USER_ANALYTICS=1e4]="USER_ANALYTICS",e$[e$.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e$}({});function Ib$1(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t$,r$,n$){const i$=n$.value;if(typeof i$=="function"){const o$=e$.className||t$.__className__||(t$.constructor.name==="AgoraRTCClient"?"Client":t$.constructor.name);n$.value=function(){for(var s$=arguments.length,a$=new Array(s$),c$=0;c$<s$;c$++)a$[c$]=arguments[c$];let u$=a$;if(e$.argsMap)try{u$=e$.argsMap(this,...a$)}catch(d$){fb$1.warning(d$),u$=[]}try{JSON.stringify(u$)}catch{fb$1.warning("arguments for method ".concat(o$,".").concat(String(r$)," not serializable for apiInvoke.")),u$=[]}const l$=(e$.report||vb$1).reportApiInvoke(this._sessionId||null,{name:"".concat(o$,".").concat(String(r$)),options:u$,tag:jy$1.TRACER,reportResult:e$.reportResult},e$.throttleTime);try{const d$=i$.apply(this,a$);return d$ instanceof Gh$1?d$.then(h$=>(l$.onSuccess(e$.reportResult&&h$),h$)).catch(h$=>{throw l$.onError(h$),h$}):(l$.onSuccess(e$.reportResult&&d$),d$)}catch(d$){throw l$.onError(d$),d$}}}return n$}}const vb$1=new class{constructor(){sb$1(this,"baseInfoMap",new Map),sb$1(this,"proxyServer",void 0),sb$1(this,"eventUploadTimer",void 0),sb$1(this,"setSessionIdTimer",void 0),sb$1(this,"url",void 0),sb$1(this,"sids",new Set),sb$1(this,"backupUrl",void 0),sb$1(this,"_appId",void 0),sb$1(this,"keyEventUploadPendingItems",[]),sb$1(this,"normalEventUploadPendingItems",[]),sb$1(this,"apiInvokeUploadPendingItems",[]),sb$1(this,"apiInvokeCount",0),sb$1(this,"ltsList",[]),sb$1(this,"lastSendNormalEventTime",Date.now()),sb$1(this,"customReportCounterTimer",void 0),sb$1(this,"customReportCount",0),sb$1(this,"extApiInvoke",async e$=>{for(const t$ of e$){const r$=cb$1(cb$1({},t$),{},{sid:null,invokeId:++this.apiInvokeCount,tag:jy$1.TRACER});this.sendApiInvoke(r$)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),XA$1("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),XA$1("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e$){return this.baseInfoMap.get(e$)}adjustSessionStartTime(e$){if(!this.baseInfoMap.has(e$)&&!this.baseInfoMap.get(e$))return void fb$1.error("adjust session ".concat(e$," start time, sid is not exist or info is undefined"));const t$=this.baseInfoMap.get(e$),r$=Date.now(),n$=t$.startTime;t$.startTime=r$,fb$1.debug("rewrite session ".concat(e$," startTime: ").concat(r$," , ").concat(r$-n$,"ms")),this.baseInfoMap.set(e$,t$)}setAppId(e$){this._appId=e$}reportApiInvoke(e$,t$,r$){t$.timeout=t$.timeout||6e4,t$.reportResult=t$.reportResult===void 0||t$.reportResult;const n$=Date.now();this.apiInvokeCount+=1;const i$=this.apiInvokeCount,o$=()=>({tag:t$.tag,invokeId:i$,sid:e$,name:t$.name,apiInvokeTime:n$,options:t$.options,states:t$.states||null}),s$=!!XA$1("SHOW_REPORT_INVOKER_LOG");s$&&fb$1.info("".concat(t$.name," start"),t$.options);let a$=!1;mA$1(t$.timeout).then(()=>{a$||(this.sendApiInvoke(cb$1(cb$1({},o$()),{},{error:Ry$1.API_INVOKE_TIMEOUT,success:!1})),fb$1.debug("".concat(t$.name," timeout")))});const c$=new Cy$1(Ry$1.UNEXPECTED_ERROR,"".concat(t$.name,": this api invoke is end"));return{onSuccess:u$=>{const l$=()=>{if(a$)throw c$;return a$=!0,this.sendApiInvoke(cb$1(cb$1({},o$()),{},{success:!0},t$.reportResult&&{result:u$})),s$&&fb$1.info("".concat(t$.name," onSuccess")),u$};return r$?CA$1(l$,t$.name+"Success",r$,()=>a$=!0):l$()},onError:u$=>{const l$=()=>{if(a$)throw u$;a$=!0,this.sendApiInvoke(cb$1(cb$1({},o$()),{},{success:!1,error:u$})),s$&&fb$1.info("".concat(t$.name," onFailure"),u$.toString())};return r$?CA$1(l$,t$.name+"Error",r$,()=>a$=!0):l$()}}}sessionInit(e$,t$){if(this.baseInfoMap.has(e$))return;const r$=Date.now(),n$=this.createBaseInfo(e$,r$);n$.cname=t$.cname;const i$=Object.assign({},{willUploadConsoleLog:XA$1("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:WA$1?"global":"oversea",areas:XA$1("AREAS")&&XA$1("AREAS").join(",")},t$.extend),{stringUid:o$,channelProfile:s$,channelMode:a$,isABTestSuccess:c$,lsid:u$,clientRole:l$}=t$,d$=Date.now(),h$=cb$1(cb$1({},n$),{},{eventType:gb$1.SESSION_INIT,appid:t$.appid,browser:navigator.userAgent,buildFormat:t$.buildFormat,build:qA$1,lts:d$,elapse:d$-r$,extend:JSON.stringify(i$),mode:t$.mode,process:XA$1("PROCESS_ID"),appType:XA$1("APP_TYPE"),success:!0,version:GA$1,stringUid:o$,channelProfile:s$,channelMode:a$,isABTestSuccess:c$,lsid:u$,clientType:Dn$1(p$=window.navigator.userAgent).call(p$,"AgoraWebView")?42:20,clientRole:l$,serviceId:XA$1("PROCESS_ID"),extensionID:XA$1("PLUGIN_INFO").join(",")||""});var p$;this.send({type:Rb$1.SESSION,data:h$},!0)}joinChooseServer(e$,t$){const r$=this.baseInfoMap.get(e$);if(!r$)return;const n$=r$.info,i$=Date.now(),o$=cb$1(cb$1({},n$),{},{eventType:gb$1.JOIN_CHOOSE_SERVER,lts:i$,eventElapse:t$.elapse||i$-t$.lts,chooseServerAddr:t$.csAddr,errorCode:t$.ec,elapse:i$-r$.startTime,success:t$.succ,chooseServerAddrList:JSON.stringify(t$.serverList),uid:t$.uid?parseInt(t$.uid):null,cid:t$.cid?parseInt(t$.cid):null,chooseServerIp:t$.csIp||"",opid:t$.opid,unilbsServerIds:t$.unilbsServerIds,extend:t$.extend||void 0,isHttp3:t$.isHttp3,corssRegionTagReq:t$.corssRegionTagReq||void 0,corssRegionTagRes:t$.corssRegionTagRes||void 0});this.send({type:Rb$1.JOIN_CHOOSE_SERVER,data:o$},!0)}reqUserAccount(e$,t$){const r$=this.baseInfoMap.get(e$);if(!r$)return;const n$=r$.info,i$=Date.now(),o$=cb$1(cb$1({},n$),{},{eventType:gb$1.REQ_USER_ACCOUNT,lts:i$,success:t$.success,serverAddress:t$.serverAddr,stringUid:t$.stringUid,uid:t$.uid,errorCode:t$.errorCode,elapse:t$.elapse||i$-r$.startTime,eventElapse:i$-t$.lts,extend:JSON.stringify(t$.extend)});this.send({type:Rb$1.REQ_USER_ACCOUNT,data:o$},!0)}joinGateway(e$,t$){const r$=this.baseInfoMap.get(e$);if(!r$)return;const n$=r$.info;t$.vid&&(n$.vid=t$.vid),n$.uid=t$.uid,n$.cid=t$.cid;const i$=Date.now(),{firstSuccess:o$,avoidJoinStartTime:s$}=t$,a$=i$-(o$&&s$?s$:r$.startTime),c$=cb$1(cb$1({},n$),{},{eventType:gb$1.JOIN_GATEWAY,lts:i$,gatewayAddr:t$.addr,success:t$.succ,errorCode:t$.ec,errorMsg:t$.errorMsg||"",elapse:a$,eventElapse:i$-t$.lts,firstSuccess:o$,signalChannel:t$.signalChannel,preload:t$.preload?1:0});t$.succ&&(r$.lastJoinSuccessTime=i$),this.send({type:Rb$1.JOIN_GATEWAY,data:c$},!0)}joinChannelTimeout(e$,t$){const r$=this.baseInfoMap.get(e$);if(!r$)return;const n$=Date.now(),i$=cb$1(cb$1({},r$.info),{},{lts:n$,timeout:t$,elapse:n$-r$.startTime});this.send({type:Rb$1.JOIN_CHANNEL_TIMEOUT,data:i$},!0)}publish(e$,t$){const r$=this.baseInfoMap.get(e$);if(!r$)return;const n$=r$.info,i$=Date.now(),o$=cb$1(cb$1({},n$),{},{eventType:gb$1.PUBLISH,lts:i$,eventElapse:t$.eventElapse,elapse:i$-r$.startTime,success:t$.succ,errorCode:t$.ec,videoName:t$.videoName,audioName:t$.audioName,screenName:t$.screenName,screenshare:t$.screenshare,audio:t$.audio,video:t$.video,p2pid:t$.p2pid,publishRequestid:t$.publishRequestid});this.send({type:Rb$1.PUBLISH,data:o$},!0)}subscribe(e$,t$,r$){const n$=this.baseInfoMap.get(e$);if(!n$)return;const i$=n$.info,o$=Date.now(),s$=cb$1(cb$1({},i$),{},{eventType:gb$1.SUBSCRIBE,lts:o$,eventElapse:t$.eventElapse,elapse:o$-n$.startTime,success:t$.succ,errorCode:t$.ec,video:t$.video,audio:t$.audio,subscribeRequestid:t$.subscribeRequestid,p2pid:t$.p2pid,preSsrc:t$.preSsrc?1:0},r$&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t$.peerid=="string"?s$.peerSuid=t$.peerid:s$.peer=t$.peerid,this.send({type:Rb$1.SUBSCRIBE,data:s$},!0)}wsCompressorInit(e$){var t$;const r$=[...d_$1(t$=this.baseInfoMap).call(t$)],n$=r$.length?r$[0]:"UnableToGetSid",i$=this.baseInfoMap.get(n$);if(!i$)return;const o$=i$.info,s$=Date.now(),a$=cb$1(cb$1({},o$),{},{eventType:gb$1.WS_COMPRESSOR_INIT,lts:s$,eventElapse:e$.eventElapse,elapse:s$-i$.startTime,status:e$.status?1:2});this.send({type:Rb$1.WS_COMPRESSOR_INIT,data:a$},!0)}firstRemoteVideoDecode(e$,t$,r$,n$){const i$=this.baseInfoMap.get(e$);if(!i$)return;const o$=i$.info,s$=Date.now(),a$=cb$1(cb$1(cb$1({},o$),n$),{},{elapse:s$-i$.startTime,eventType:t$,lts:s$,firstDecodeFrame:Math.max((n$.firstFrame||s$)-i$.startTime,0),apEnd:Math.max(n$.apEnd-i$.startTime,0),apStart:Math.max(n$.apStart-i$.startTime,0),joinGwEnd:Math.max(n$.joinGwEnd-i$.startTime,0),joinGwStart:Math.max(n$.joinGwStart-i$.startTime,0),pcEnd:Math.max(n$.pcEnd-i$.startTime,0),pcStart:Math.max(n$.pcStart-i$.startTime,0),subscriberEnd:Math.max(n$.subscriberEnd-i$.startTime,0),subscriberStart:Math.max(n$.subscriberStart-i$.startTime,0),videoAddNotify:Math.max(n$.videoAddNotify-i$.startTime,0)});this.send({type:r$,data:a$},!0)}firstRemoteFrame(e$,t$,r$,n$){const i$=this.baseInfoMap.get(e$);if(!i$)return;const o$=i$.info,s$=Date.now(),a$=cb$1(cb$1(cb$1({},o$),n$),{},{elapse:s$-i$.startTime,eventType:t$,lts:s$});this.send({type:r$,data:a$},!0)}pcStats(e$,t$){const r$=this.baseInfoMap.get(e$);if(!r$)return;const n$=r$.info,i$=Date.now(),o$=cb$1(cb$1(cb$1({},n$),t$),{},{vid:n$.vid===void 0?0:Number(n$.vid),elapse:i$-r$.startTime,eventType:gb$1.PC_STATS,lts:i$,preallocation:t$.preallocation?1:0});this.send({type:Rb$1.PC_STATS,data:o$},!0)}updateRemoteRTPCapabilities(e$,t$){if(e$){const r$=this.baseInfoMap.get(e$);if(!r$)return;const n$=r$.info,i$=Date.now(),o$=cb$1(cb$1(cb$1({},n$),t$),{},{vid:n$.vid===void 0?0:Number(n$.vid),eventType:gb$1.UPDATE_REMOTE_RTPCAPABILITIES,lts:i$});this.send({type:Rb$1.UPDATE_REMOTE_RTPCAPABILITIES,data:o$},!0)}}onGatewayStream(e$,t$,r$,n$){const i$=this.baseInfoMap.get(e$);if(!i$)return;const o$=i$.info,s$=Date.now(),a$=cb$1(cb$1(cb$1({},o$),n$),{},{eventType:t$,lts:s$});this.send({type:r$,data:a$},!0)}streamSwitch(e$,t$){const r$=this.baseInfoMap.get(e$);if(!r$)return;const n$=r$.info,i$=Date.now(),o$=cb$1(cb$1({},n$),{},{eventType:gb$1.STREAM_SWITCH,lts:i$,isDual:t$.isdual,elapse:i$-r$.startTime,success:t$.succ});this.send({type:Rb$1.STREAM_SWITCH,data:o$},!0)}requestProxyAppCenter(e$,t$){const r$=this.baseInfoMap.get(e$);if(!r$)return;const n$=r$.info,i$=Date.now(),o$=cb$1(cb$1({},n$),{},{eventType:gb$1.REQUEST_PROXY_APPCENTER,lts:i$,eventElapse:i$-t$.lts,elapse:i$-r$.startTime,APAddr:t$.APAddr,workerManagerList:t$.workerManagerList,response:t$.response,errorCode:t$.ec,success:t$.succ});this.send({type:Rb$1.REQUEST_PROXY_APPCENTER,data:o$},!0)}requestProxyWorkerManager(e$,t$){const r$=this.baseInfoMap.get(e$);if(!r$)return;const n$=r$.info,i$=Date.now(),o$=cb$1(cb$1({},n$),{},{eventType:gb$1.REQUEST_PROXY_WORKER_MANAGER,lts:i$,eventElapse:i$-t$.lts,elapse:i$-r$.startTime,workerManagerAddr:t$.workerManagerAddr,response:t$.response,errorCode:t$.ec,success:t$.succ});this.send({type:Rb$1.REQUEST_PROXY_WORKER_MANAGER,data:o$},!0)}setProxyServer(e$){this.proxyServer=e$,e$?fb$1.debug("reportProxyServerurl: ".concat(e$)):fb$1.debug("disable reportProxyServerurl: ".concat(e$))}peerPublishStatus(e$,t$){const r$=this.baseInfoMap.get(e$);if(!r$)return;const n$=r$.info,i$=Date.now(),o$=cb$1(cb$1({},n$),{},{subscribeElapse:t$.subscribeElapse,peer:t$.peer,peerPublishDuration:Math.max(t$.audioPublishDuration,t$.videoPublishDuration),audiotag:t$.audioPublishDuration>0?1:-1,videotag:t$.videoPublishDuration>0?1:-1,lts:i$,elapse:i$-r$.startTime,joinChannelSuccessElapse:i$-(r$.lastJoinSuccessTime||i$),peerPublishDurationVideo:t$.videoPublishDuration,peerPublishDurationAudio:t$.audioPublishDuration});this.send({type:Rb$1.PEER_PUBLISH_STATUS,data:o$},!0)}workerEvent(e$,t$){const r$=this.baseInfoMap.get(e$);if(!r$)return;const n$=r$.info,i$=Date.now();(function(o$,s$,a$){const c$=o$[s$];if(!c$||typeof c$!="string")return[o$];o$[s$]="";const u$=_A$1(JSON.stringify(o$));let l$=0;const d$=[];let h$=0;for(let p$=0;p$<c$.length;p$++)h$+=c$.charCodeAt(p$)<=127?1:3,h$<=a$-u$||(d$[d$.length]=gy$1(gy$1({},o$),{},{[s$]:c$.substring(l$,p$)}),l$=p$,h$=c$.charCodeAt(p$)<=127?1:3);return l$!==c$.length-1&&(d$[d$.length]=gy$1(gy$1({},o$),{},{[s$]:c$.substring(l$)})),d$})(cb$1(cb$1(cb$1({},n$),t$),{},{elapse:i$-r$.startTime,lts:i$,productType:"WebRTC"}),"payload",1300).forEach(o$=>this.send({type:Rb$1.WORKER_EVENT,data:o$},!0))}apworkerEvent(e$,t$){const r$=this.baseInfoMap.get(e$);if(!r$)return;const n$=r$.info,i$=Date.now(),o$=cb$1(cb$1(cb$1({},n$),t$),{},{elapse:i$-r$.startTime,lts:i$});this.send({type:Rb$1.AP_WORKER_EVENT,data:o$},!0)}joinWebProxyAP(e$,t$){const r$=this.baseInfoMap.get(e$);if(!r$)return;const n$=r$.info,i$=Date.now(),o$=cb$1(cb$1(cb$1({},n$),t$),{},{elapse:i$-r$.startTime,lts:i$,extend:t$.extend||void 0});this.send({type:Rb$1.JOIN_WEB_PROXY_AP,data:o$},!0)}WebSocketQuit(e$,t$){const r$=this.baseInfoMap.get(e$);if(!r$)return;const n$=r$.info,i$=Date.now(),o$=cb$1(cb$1(cb$1({},n$),t$),{},{elapse:i$-r$.startTime,lts:i$});this.send({type:Rb$1.WEBSOCKET_QUIT,data:o$},!0)}async sendCustomReportMessage(e$,t$){if(this.customReportCount+=t$.length,this.customReportCount>XA$1("CUSTOM_REPORT_LIMIT"))throw new Cy$1(Ry$1.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const r$=Date.now(),n$=t$.map(i$=>({type:Rb$1.USER_ANALYTICS,data:cb$1(cb$1({sid:e$},i$),{},{lts:r$})}));try{XA$1("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(n$):await this.postDataToStatsCollector(n$)}catch(i$){throw fb$1.error("send custom report message failed",i$.toString()),new Cy$1(Ry$1.CUSTOM_REPORT_SEND_FAILED,i$.message)}}sendApiInvoke(e$){const t$=XA$1("NOT_REPORT_EVENT");if(e$.tag&&Dn$1(t$)&&Dn$1(t$).call(t$,e$.tag))return!1;if(e$.sid===null)return this.apiInvokeUploadPendingItems.push(e$),!1;const r$=this.baseInfoMap.get(e$.sid);if(!r$)return this.apiInvokeUploadPendingItems.push(e$),!1;const{cname:n$,uid:i$,cid:o$}=r$.info;let s$;if(e$.lts=e$.lts||Date.now(),e$.error)if(e$.error instanceof Cy$1){const{code:c$,message:u$}=e$.error;s$=c$||u$||e$.error.toString()}else s$=e$.error.toString();const a$={invokeId:e$.invokeId,sid:e$.sid,cname:n$,cid:o$,uid:i$,lts:e$.lts,success:e$.success,elapse:e$.lts-r$.startTime,execElapse:e$.lts-e$.apiInvokeTime,apiName:e$.name,options:e$.options?JSON.stringify(e$.options):void 0,execStates:e$.states?JSON.stringify(e$.states):void 0,execResult:e$.result?JSON.stringify(e$.result):void 0,errorCode:e$.error?s$:void 0,errorMsg:e$.error?JSON.stringify(e$.error):void 0};return this.send({type:Rb$1.API_INVOKE,data:a$},!1),!0}addSid(e$){this.sids.add(e$)}removeSid(e$){this.sids.delete(e$)}appendSessionId(){const e$=this.apiInvokeUploadPendingItems;if(e$.length===0)return;const t$=Array.from(this.sids).find(r$=>r$!==null);t$&&e$.forEach(r$=>{r$&&(r$.sid=t$,this.sendApiInvoke(Object.assign({},r$)))}),e$.length=0}send(e$,t$){if(t$)return this.keyEventUploadPendingItems.push(e$),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e$),this.normalEventUploadPendingItems.length>XA$1("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e$,t$){const r$=[],n$=[];for(;e$.length;){const o$=e$.shift();r$.length<20?r$.push(o$):n$.push(o$)}e$.push(...n$);for(const o$ of[...r$]){var i$;this.ltsList.indexOf(o$.data.lts)!==-1?(o$.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o$.data.lts)):(this.ltsList.push(o$.data.lts),aE$1(i$=this.ltsList).call(i$,(s$,a$)=>s$-a$))}return t$||(this.lastSendNormalEventTime=Date.now()),XA$1("ENABLE_EVENT_REPORT")&&r$.length&&(XA$1("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r$):this.postDataToStatsCollector(r$)).catch((o$=>s$=>{XA$1("EVENT_REPORT_RETRY")&&(t$?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(o$):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(o$),this.normalEventUploadPendingItems.length>XA$1("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-XA$1("NORMAL_EVENT_QUEUE_CAPACITY")),fb$1.warning("report: drop normal events"))))})(r$)),e$}async postDataToStatsCollector2(e$){iA$1.networkState===Xy$1.OFFLINE&&await Gh$1.race([iA$1.onlineWaiter,mA$1(2*PA$1.maxRetryTimeout)]);const t$=i$=>{let o$=new Uint8Array;return i$.forEach(s$=>{const a$=ky$1(JSON.stringify(s$.data)),c$=new ArrayBuffer(5),u$=(d$=>{let h$=0;return Object.entries(Rb$1).forEach(p$=>{let[_$,f$]=p$;f$===d$.type&&(h$=Cb$1[_$])}),h$})(s$),l$=new DataView(c$);l$.setUint16(0,a$.byteLength,!0),l$.setUint8(2,255&u$),l$.setUint8(3,u$>>>8&255),l$.setUint8(4,u$>>>16&255),o$=My$1(o$,new Uint8Array(c$)),o$=My$1(o$,a$)}),o$},r$="event";let n$=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(XA$1("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r$):"https://".concat(XA$1("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r$);for(let i$=0;i$<2;i$+=1){i$===1&&(n$=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(XA$1("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r$):"https://".concat(XA$1("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r$));try{await FA$1(n$,{timeout:1e4,data:t$(e$),headers:cb$1(cb$1({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(o$){if(i$===1)throw o$;continue}return}}async postDataToStatsCollector(e$){let t$=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r$={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e$.map(o$=>JSON.stringify(o$)),vid:(o$=>{const s$=o$&&o$.data.sid&&this.baseInfoMap.get(o$.data.sid);return s$&&s$.info.vid&&+s$.info.vid||0})(e$[0])};iA$1.networkState===Xy$1.OFFLINE&&await Gh$1.race([iA$1.onlineWaiter,mA$1(2*PA$1.maxRetryTimeout)]);const n$=t$?"/events/proto-raws":"/events/messages";let i$=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(XA$1("EVENT_REPORT_DOMAIN"),"&p=").concat(XA$1("STATS_COLLECTOR_PORT"),"&d=").concat(n$):"https://".concat(XA$1("EVENT_REPORT_DOMAIN"),":").concat(XA$1("STATS_COLLECTOR_PORT")).concat(n$));for(let o$=0;o$<2;o$+=1){o$===1&&(i$=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(XA$1("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(XA$1("STATS_COLLECTOR_PORT"),"&d=").concat(n$):"https://".concat(XA$1("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(XA$1("STATS_COLLECTOR_PORT")).concat(n$)));try{t$?await BA$1(i$,{timeout:1e4,data:r$}):await FA$1(i$,{timeout:1e4,data:r$})}catch(s$){if(o$===1)throw s$;continue}return}}createBaseInfo(e$,t$){const r$=Object.assign({},Sb$1);return r$.sid=e$,this.baseInfoMap.set(e$,{info:r$,startTime:t$}),r$}reportResourceTiming(e$,t$){const r$=performance.getEntriesByName(e$),n$=r$[r$.length-1];n$&&this.reportApiInvoke(t$,{name:"Client.resourceTiming",options:n$,tag:jy$1.TRACER}).onSuccess()}};db$1.on("REPORT_LOG_UPLOAD",e$=>{e$.networkState=iA$1.networkState,vb$1.reportApiInvoke(null,{name:"logUploadError",options:e$,tag:jy$1.TRACER}).onSuccess("logUploadError")});let yb$1=class extends Cy$1{constructor(t$){super(t$,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),sb$1(this,"name","AgoraRTCException")}print(){let t$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t$,fb$1)}throw(){super.throw(fb$1)}};const Ab$1=["CHINA","GLOBAL"],bb$1=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],wb$1=[];function Ob$1(e$,t$){return!!t$&&wb$1.some(r$=>r$.uid===e$&&r$.channelName===t$)}var Nb$1=nT$1.forEach,Db$1=Bn$1("forEach")?[].forEach:function(e$){return Nb$1(this,e$,arguments.length>1?arguments[1]:void 0)};wi$1({target:"Array",proto:!0,forced:[].forEach!=Db$1},{forEach:Db$1});var Pb$1=Xi$1("Array").forEach,Lb$1=pn$1,kb$1=Ze,Mb$1=l,Ub$1=Pb$1,xb$1=Array.prototype,Vb$1={DOMTokenList:!0,NodeList:!0},Fb$1=function(e$){var t$=e$.forEach;return e$===xb$1||Mb$1(xb$1,e$)&&t$===xb$1.forEach||kb$1(Vb$1,Lb$1(e$))?Ub$1:t$},Bb$1=i(Fb$1),jb$1=Je$1,Gb$1=eo$1;wi$1({target:"Object",stat:!0,forced:n(function(){Gb$1(1)})},{keys:function(e$){return Gb$1(jb$1(e$))}});var Wb$1=i(ie$1.Object.keys),Hb$1=i(zn$1),Kb$1=wi$1,Yb$1=om$1,qb$1=d([].reverse),zb$1=[1,2];Kb$1({target:"Array",proto:!0,forced:String(zb$1)===String(zb$1.reverse())},{reverse:function(){return Yb$1(this)&&(this.length=this.length),qb$1(this)}});var Jb$1=Xi$1("Array").reverse,Xb$1=l,Qb$1=Jb$1,Zb$1=Array.prototype,$b$1=function(e$){var t$=e$.reverse;return e$===Zb$1||Xb$1(Zb$1,e$)&&t$===Zb$1.reverse?Qb$1:t$},ew$1=$b$1,tw$1=i(ew$1),iw$1=wi$1,nw$1=om$1,rw$1=jc$1,ow$1=te$1,sw$1=xi$1,aw$1=Gi$1,cw$1=Z$1,dw$1=E_$1,lw$1=ht$1,uw$1=Xc$1,hw$1=mm$1("slice"),pw$1=lw$1("species"),_w$1=Array,Ew$1=Math.max;iw$1({target:"Array",proto:!0,forced:!hw$1},{slice:function(e$,t$){var r$,n$,i$,o$=cw$1(this),s$=aw$1(o$),a$=sw$1(e$,s$),c$=sw$1(t$===void 0?s$:t$,s$);if(nw$1(o$)&&(r$=o$.constructor,(rw$1(r$)&&(r$===_w$1||nw$1(r$.prototype))||ow$1(r$)&&(r$=r$[pw$1])===null)&&(r$=void 0),r$===_w$1||r$===void 0))return uw$1(o$,a$,c$);for(n$=new(r$===void 0?_w$1:r$)(Ew$1(c$-a$,0)),i$=0;a$<c$;a$++,i$++)a$ in o$&&dw$1(n$,i$,o$[a$]);return n$.length=i$,n$}});var fw$1=Xi$1("Array").slice,mw$1=l,Tw$1=fw$1,Sw$1=Array.prototype,gw$1=function(e$){var t$=e$.slice;return e$===Sw$1||mw$1(Sw$1,e$)&&t$===Sw$1.slice?Tw$1:t$},Rw$1=i(gw$1);function Cw$1(e$,t$,r$,n$,i$){var o$,s$,a$,c$={};return Bb$1(o$=Wb$1(n$)).call(o$,function(u$){c$[u$]=n$[u$]}),c$.enumerable=!!c$.enumerable,c$.configurable=!!c$.configurable,("value"in c$||c$.initializer)&&(c$.writable=!0),c$=Hb$1(s$=tw$1(a$=Rw$1(r$).call(r$)).call(a$)).call(s$,function(u$,l$){return l$(e$,t$,u$)||u$},c$),i$&&c$.initializer!==void 0&&(c$.value=c$.initializer?c$.initializer.call(i$):void 0,c$.initializer=void 0),c$.initializer===void 0&&(nm$1(e$,t$,c$),c$=null),c$}let Iw$1=function(e$){return e$.L1T1="L1T1",e$.L1T2="L1T2",e$.L1T3="L1T3",e$.L1T3_KEY="L1T3_KEY",e$.L2T1_KEY="L2T1_KEY",e$.L2T2_KEY="L2T2_KEY",e$.L2T3_KEY="L2T3_KEY",e$.L3T1_KEY="L3T1_KEY",e$.L3T2_KEY="L3T2_KEY",e$.L3T3_KEY="L3T3_KEY",e$}({}),vw$1=function(e$){return e$.CERTIFICATE="certificate",e$.CODEC="codec",e$.CANDIDATE_PAIR="candidate-pair",e$.LOCAL_CANDIDATE="local-candidate",e$.REMOTE_CANDIDATE="remote-candidate",e$.INBOUND="inbound-rtp",e$.TRACK="track",e$.OUTBOUND="outbound-rtp",e$.PC="peer-connection",e$.REMOTE_INBOUND="remote-inbound-rtp",e$.REMOTE_OUTBOUND="remote-outbound-rtp",e$.TRANSPORT="transport",e$.CSRC="csrc",e$.DATA_CHANNEL="data-channel",e$.STREAM="stream",e$.SENDER="sender",e$.RECEIVER="receiver",e$}({}),yw$1=function(e$){return e$[e$.ACCESS_POINT=101]="ACCESS_POINT",e$[e$.UNILBS=201]="UNILBS",e$[e$.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e$}({}),Aw$1=function(e$){return e$[e$.IIIEGAL_APPID=1]="IIIEGAL_APPID",e$[e$.IIIEGAL_UID=2]="IIIEGAL_UID",e$[e$.INTERNAL_ERROR=3]="INTERNAL_ERROR",e$}({}),bw$1=function(e$){return e$[e$.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e$[e$.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e$[e$.INTERNAL_ERROR=8]="INTERNAL_ERROR",e$[e$.NO_AUTHORIZED=9]="NO_AUTHORIZED",e$[e$.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e$[e$.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e$[e$.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e$[e$.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e$[e$.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e$[e$.USER_OVERLOAD=16]="USER_OVERLOAD",e$[e$.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e$[e$.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e$}({}),ww$1=function(e$){return e$[e$.NO_FLAG_SET=100]="NO_FLAG_SET",e$[e$.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e$[e$.INVALID_FALG_SET=102]="INVALID_FALG_SET",e$[e$.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e$[e$.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e$[e$.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e$[e$.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e$[e$.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e$[e$.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e$[e$.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e$[e$.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e$[e$.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e$[e$.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e$[e$.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e$[e$.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e$[e$.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e$[e$.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e$[e$.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e$[e$.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e$}({}),Ow$1=function(e$){return e$[e$.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e$[e$.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e$[e$.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e$[e$.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e$[e$.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e$[e$.K_TICKET_INVALID=7]="K_TICKET_INVALID",e$[e$.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e$[e$.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e$[e$.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e$[e$.K_UID_BANNED=14]="K_UID_BANNED",e$[e$.K_IP_BANNED=15]="K_IP_BANNED",e$[e$.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e$[e$.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e$[e$.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e$[e$.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e$[e$.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e$[e$.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e$[e$.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e$[e$.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e$[e$.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e$[e$.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e$[e$.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e$[e$.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e$[e$.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e$[e$.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e$[e$.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e$[e$.ERR_INVALID_UID=117]="ERR_INVALID_UID",e$[e$.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e$[e$.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e$[e$.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e$[e$.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e$[e$.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e$[e$.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e$[e$.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e$[e$.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e$[e$.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e$[e$.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e$[e$.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e$[e$.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e$[e$.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e$[e$.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e$[e$.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e$[e$.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e$[e$.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e$[e$.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e$[e$.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e$[e$.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e$[e$.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e$[e$.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e$[e$.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e$[e$.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e$[e$.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e$[e$.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e$[e$.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e$[e$.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e$[e$.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e$[e$.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e$[e$.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e$[e$.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e$[e$.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e$[e$.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e$[e$.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e$[e$.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e$[e$.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e$}({}),Nw$1=function(e$){return e$.CONNECTING="connecting",e$.CONNECTED="connected",e$.RECONNECTING="reconnecting",e$.CLOSED="closed",e$}({}),Dw$1=function(e$){return e$.WS_CONNECTED="ws_connected",e$.WS_RECONNECTING="ws_reconnecting",e$.WS_CLOSED="ws_closed",e$.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e$.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e$.ON_BINARY_DATA="on_binary_data",e$.REQUEST_RECOVER="request_recover",e$.REQUEST_JOIN_INFO="request_join_info",e$.REQUEST_REJOIN_INFO="req_rejoin_info",e$.IS_P2P_DISCONNECTED="is_p2p_dis",e$.DISCONNECT_P2P="dis_p2p",e$.ABORT_P2P_EXECUTION="abort_p2p_execution",e$.NEED_RENEW_SESSION="need-sid",e$.REPORT_JOIN_GATEWAY="report_join_gateway",e$.REQUEST_TIMEOUT="request_timeout",e$.REQUEST_SUCCESS="request_success",e$.JOIN_RESPONSE="join_response",e$.PRE_CONNECT_PC="pre_connect_pc",e$.P2P_CONNECTION="p2p_connection",e$.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e$.P2P_SUBSCRIBE="p2p_subscribe",e$.P2P_UNSUBSCRIBE="p2p_unsubscribe",e$.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e$.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e$.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e$.RECOVER_NOTIFICATION="recover_notification",e$}({}),Pw$1=function(e$){return e$.PING="ping",e$.PING_BACK="ping_back",e$.JOIN="join_v3",e$.REJOIN="rejoin_v3",e$.LEAVE="leave",e$.SET_CLIENT_ROLE="set_client_role",e$.PUBLISH="publish",e$.PUBLISH_DATASTREAM="publish_datastream",e$.UNPUBLISH="unpublish",e$.UNPUBLISH_DATASTREAM="unpublish_datastream",e$.SUBSCRIBE="subscribe",e$.PRE_SUBSCRIBE="pre_subscribe",e$.SUBSCRIBE_DATASTREAM="subscribe_datastream",e$.SUBSCRIBE_STREAMS="subscribe_streams",e$.UNSUBSCRIBE="unsubscribe",e$.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e$.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e$.SUBSCRIBE_CHANGE="subscribe_change",e$.TRAFFIC_STATS="traffic_stats",e$.RENEW_TOKEN="renew_token",e$.SWITCH_VIDEO_STREAM="switch_video_stream",e$.DEFAULT_VIDEO_STREAM="default_video_stream",e$.SET_FALLBACK_OPTION="set_fallback_option",e$.GATEWAY_INFO="gateway_info",e$.CONTROL="control",e$.SEND_METADATA="send_metadata",e$.DATA_STREAM="data_stream",e$.PICK_SVC_LAYER="pick_svc_layer",e$.RESTART_ICE="restart_ice",e$.CONNECT_PC="connect_pc",e$.SET_VIDEO_PROFILE="set_video_profile",e$.SET_PARAMETER="set_parameter",e$.SET_RTM2_FLAG="set_rtm2_flag",e$}({}),Lw$1=function(e$){return e$.WRTC_STATS="wrtc_stats",e$.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e$.DENOISER_STATS="denoiser_stats",e$.EXTENSION_USAGE_STATS="extension_usage_stats",e$}({}),kw$1=function(e$){return e$.ON_USER_ONLINE="on_user_online",e$.ON_USER_OFFLINE="on_user_offline",e$.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e$.ON_PUBLISH_STREAM="on_publish_stream",e$.ON_UPLINK_STATS="on_uplink_stats",e$.ON_P2P_LOST="on_p2p_lost",e$.ON_REMOVE_STREAM="on_remove_stream",e$.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e$.ON_ADD_VIDEO_STREAM="on_add_video_stream",e$.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e$.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e$.ON_USER_BANNED="on_user_banned",e$.ON_USER_LICENSE_BANNED="on_user_license_banned",e$.ON_NOTIFICATION="on_notification",e$.ON_CRYPT_ERROR="on_crypt_error",e$.MUTE_AUDIO="mute_audio",e$.MUTE_VIDEO="mute_video",e$.UNMUTE_AUDIO="unmute_audio",e$.UNMUTE_VIDEO="unmute_video",e$.ON_P2P_OK="on_p2p_ok",e$.RECEIVE_METADATA="receive_metadata",e$.ON_DATA_STREAM="on_data_stream",e$.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e$.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e$.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e$.ENABLE_LOCAL_VIDEO="enable_local_video",e$.DISABLE_LOCAL_VIDEO="disable_local_video",e$.ENABLE_LOCAL_AUDIO="enable_local_audio",e$.DISABLE_LOCAL_AUDIO="disable_local_audio",e$.ON_PUBLISHED_USER_LIST="on_published_user_list",e$}({}),Mw$1=function(e$){return e$.SEND_ONLY="SEND_ONLY",e$.RECEIVE_ONLY="RECEIVE_ONLY",e$}({}),Uw$1=function(e$){return e$.CONNECTED="websocket:connected",e$.RECONNECTING="websocket:reconnecting",e$.WILL_RECONNECT="websocket:will_reconnect",e$.CLOSED="websocket:closed",e$.FAILED="websocket:failed",e$.ON_MESSAGE="websocket:on_message",e$.REQUEST_NEW_URLS="websocket:request_new_urls",e$.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e$.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e$.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e$}({});function xw$1(e$){if(typeof e$!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e$))throw fb$1.error("Invalid Channel Name ".concat(e$)),new yb$1(Ry$1.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Vw$1(e$){if(!function(t$){return typeof t$=="number"&&Math.floor(t$)===t$&&0<=t$&&t$<=4294967295}(e$)&&!Ny$1(e$,1,255))throw new yb$1(Ry$1.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof e$=="string"&&fb$1.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Fw$1=function(e$){return e$.TRANSCODE="mix_streaming",e$.RAW="raw_streaming",e$}({});const Bw$1={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},jw$1={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Gw$1(e$,t$){by$1(e$.url,"".concat(t$,".url"),1,1e3,!1),Oy$1(e$.x)||yy$1(e$.x,"".concat(t$,".x"),0,1e4),Oy$1(e$.y)||yy$1(e$.y,"".concat(t$,".y"),0,1e4),Oy$1(e$.width)||yy$1(e$.width,"".concat(t$,".width"),0,1e4),Oy$1(e$.height)||yy$1(e$.height,"".concat(t$,".height"),0,1e4),Oy$1(e$.zOrder)||yy$1(e$.zOrder,"".concat(t$,".zOrder"),0,255),Oy$1(e$.alpha)||yy$1(e$.alpha,"".concat(t$,".alpha"),0,1,!1)}const Ww$1={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Hw$1=function(e$){return e$.WARNING="@live_uap-warning",e$.ERROR="@line_uap-error",e$.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e$.WORKER_STATUS="@live_uap-worker-status",e$.REQUEST_NEW_ADDRESS="@live_uap-request-address",e$}({}),Kw$1=function(e$){return e$.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e$}({}),Yw$1=function(e$){return e$[e$.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e$[e$.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e$[e$.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e$[e$.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e$[e$.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e$[e$.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e$[e$.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e$[e$.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e$[e$.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e$[e$.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e$[e$.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e$[e$.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e$[e$.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e$[e$.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e$[e$.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e$[e$.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e$[e$.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e$[e$.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e$[e$.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e$[e$.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e$[e$.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e$}({});function qw$1(e$){if(!e$.channelName)throw new yb$1(Ry$1.INVALID_PARAMS,"invalid channelName in info");if(typeof e$.uid!="number")throw new yb$1(Ry$1.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e$.token&&by$1(e$.token,"info.token",1,2047),Vw$1(e$.uid),xw$1(e$.channelName),!0}let zw$1=function(e$){return e$[e$.SetSdkProfile=0]="SetSdkProfile",e$[e$.SetSourceChannel=1]="SetSourceChannel",e$[e$.SetSourceUserId=2]="SetSourceUserId",e$[e$.SetDestChannel=3]="SetDestChannel",e$[e$.StartPacketTransfer=4]="StartPacketTransfer",e$[e$.StopPacketTransfer=5]="StopPacketTransfer",e$[e$.UpdateDestChannel=6]="UpdateDestChannel",e$[e$.Reconnect=7]="Reconnect",e$[e$.SetVideoProfile=8]="SetVideoProfile",e$}({}),Jw$1=function(e$){return e$.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e$.NETWORK_CONNECTED="NETWORK_CONNECTED",e$.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e$.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e$.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e$.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e$.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e$.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e$.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e$.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e$}({}),Xw$1=function(e$){return e$.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e$.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e$.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e$.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e$}({}),Qw$1=function(e$){return e$.RELAY_OK="RELAY_OK",e$.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e$.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e$.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e$}({}),Zw$1=function(e$){return e$.High="high",e$.Low="low",e$.Audio="audio",e$.Screen="screen",e$.ScreenLow="screen_low",e$}({}),$w$1=function(e$){return e$.DISCONNECT="disconnect",e$.CONNECTION_STATE_CHANGE="connection-state-change",e$.NETWORK_QUALITY="network-quality",e$.STREAM_TYPE_CHANGE="stream-type-change",e$.IS_P2P_DISCONNECTED="is-p2p-dis",e$.DISCONNECT_P2P="dis-p2p",e$.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e$.NEED_RENEW_SESSION="need-sid",e$.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e$.JOIN_RESPONSE="join-response",e$.RESET_CONNECTION_EVENTS="reset-connection-events",e$.PRE_CONNECT_PC="pre-connect_pc",e$}({}),eO$1=function(e$){return e$.P2P_DISCONNECTED="P2P_DISCONNECTED",e$.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e$.TIMEOUT="TIMEOUT",e$.UNKNOWN_REASON="UNKNOWN_REASON",e$}({}),tO$1=function(e$){return e$[e$.Nothing=0]="Nothing",e$[e$.Audio=1]="Audio",e$[e$.LwoVideo=2]="LwoVideo",e$[e$.Video=4]="Video",e$[e$.Data=8]="Data",e$[e$.DataStream0=256]="DataStream0",e$[e$.DataStream1=512]="DataStream1",e$[e$.DataStream2=1024]="DataStream2",e$[e$.DataStream3=2048]="DataStream3",e$[e$.DataStream4=4096]="DataStream4",e$[e$.DataStream5=8192]="DataStream5",e$[e$.DataStream6=16384]="DataStream6",e$[e$.DataStream7=32768]="DataStream7",e$}({}),iO$1=function(e$){return e$.CHINA="CHINA",e$.ASIA="ASIA",e$.NORTH_AMERICA="NORTH_AMERICA",e$.EUROPE="EUROPE",e$.JAPAN="JAPAN",e$.INDIA="INDIA",e$.KOREA="KOREA",e$.HKMC="HKMC",e$.US="US",e$.OCEANIA="OCEANIA",e$.SOUTH_AMERICA="SOUTH_AMERICA",e$.AFRICA="AFRICA",e$.OVERSEA="OVERSEA",e$.GLOBAL="GLOBAL",e$.EXTENSIONS="EXTENSIONS",e$}({});const nO$1=[iO$1.AFRICA,iO$1.ASIA,iO$1.CHINA,iO$1.EUROPE,iO$1.GLOBAL,iO$1.INDIA,iO$1.JAPAN,iO$1.NORTH_AMERICA,iO$1.OCEANIA,iO$1.OVERSEA,iO$1.SOUTH_AMERICA];let rO$1=function(e$){return e$.CHINA="CN",e$.ASIA="AS",e$.NORTH_AMERICA="NA",e$.EUROPE="EU",e$.JAPAN="JP",e$.INDIA="IN",e$.KOREA="KR",e$.HKMC="HK",e$.US="US",e$.OCEANIA="OC",e$.SOUTH_AMERICA="SA",e$.AFRICA="AF",e$.OVERSEA="OVERSEA",e$.GLOBAL="GLOBAL",e$.EXTENSIONS="GLOBAL",e$}({});const oO$1={CHINA:{},ASIA:{CODE:rO$1.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:rO$1.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:rO$1.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:rO$1.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:rO$1.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:rO$1.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:rO$1.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:rO$1.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:rO$1.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:rO$1.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:rO$1.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:rO$1.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:rO$1.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};WA$1&&(oO$1.CHINA={CODE:rO$1.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let sO$1=function(e$){return e$.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e$}({}),aO$1=class extends xy$1{constructor(t$,r$){super(),Fg$1(this,"onICEConnectionStateChange",void 0),Fg$1(this,"onConnectionStateChange",void 0),Fg$1(this,"onDTLSTransportStateChange",void 0),Fg$1(this,"onDTLSTransportError",void 0),Fg$1(this,"onICETransportStateChange",void 0),Fg$1(this,"onFirstAudioReceived",void 0),Fg$1(this,"onFirstVideoReceived",void 0),Fg$1(this,"onFirstAudioDecoded",void 0),Fg$1(this,"onFirstVideoDecoded",void 0),Fg$1(this,"onFirstVideoDecodedTimeout",void 0),Fg$1(this,"onSelectedLocalCandidateChanged",void 0),Fg$1(this,"onSelectedRemoteCandidateChanged",void 0),Fg$1(this,"getLocalVideoStats",void 0)}},cO$1=class extends aO$1{constructor(t$,r$){super(t$,r$),Fg$1(this,"establishPromise",void 0)}},dO$1=function(e$){return e$.VIDEO="video",e$.AUDIO="audio",e$}({}),lO$1=function(e$){return e$[e$.UDP=0]="UDP",e$[e$.TCP=1]="TCP",e$[e$.RELAY=2]="RELAY",e$}({}),uO$1=function(e$){return e$[e$.FIRST_CONNECTION=0]="FIRST_CONNECTION",e$[e$.TCP_RESTART=1]="TCP_RESTART",e$[e$.RELAY_RESTART=2]="RELAY_RESTART",e$[e$.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e$[e$.OLD_RESTART=11]="OLD_RESTART",e$[e$.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e$}({}),hO$1=function(e$){return e$.LocalVideoTrack="videoTrack",e$.LocalAudioTrack="audioTrack",e$.LocalVideoLowTrack="videoLowTrack",e$}({}),pO$1=function(e$){return e$.New="new",e$.Connected="connected",e$.Reconnecting="reconnecting",e$.Disconnected="disconnected",e$}({}),_O$1=function(e$){return e$.StateChange="stateChange",e$.IceConnectionStateChange="iceConnectionStateChange",e$.RequestMuteLocal="requestMuteLocal",e$.RequestUnmuteLocal="requestUnmuteLocal",e$.RequestRePublish="requestRePublish",e$.RequestRePublishDataChannel="requestRePublishDataChannel",e$.RequestReSubscribe="requestReSubscribe",e$.RequestUploadStats="requestUploadStats",e$.RequestUpload="requestUpload",e$.MediaReconnectStart="MediaReconnectStart",e$.MediaReconnectEnd="MediaReconnectEnd",e$.NeedSignalRTT="NeedSignalRTT",e$.RequestRestartICE="RequestRestartIce",e$.PeerConnectionStateChange="PeerConnectionStateChange",e$.RequestReconnect="RequestReconnect",e$.RequestReconnectPC="RequestReconnectPC",e$.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e$.P2PLost="P2PLost",e$.UpdateVideoEncoder="UpdateVideoEncoder",e$.ConnectionTypeChange="ConnectionTypeChange",e$.RequestLowStreamParameter="RequestLowStreamParameter",e$.QueryClientConnectionState="QueryClientConnectionState",e$.LocalCandidate="LocalCandidate",e$.RequestP2PMuteLocal="requestP2PMuteLocal",e$.RequestP2PUnPublish="RequestP2PUnPublish",e$.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e$.RequestP2PMuteRemote="RequestP2PMuteRemote",e$.RequestP2PRestartICE="RequestP2PRestartICE",e$}({}),EO$1=function(e$){return e$.CONNECTING="CONNECTING",e$.RECONNECTING="RECONNECTING",e$.CONNECTED="CONNECTED",e$.CLOSED="CLOSED",e$}({}),fO$1=function(e$){return e$[e$.CONNECT_AP=0]="CONNECT_AP",e$[e$.AP_CONNECTED=1]="AP_CONNECTED",e$[e$.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e$[e$.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e$[e$.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e$[e$.CONNECT_WORKER=5]="CONNECT_WORKER",e$[e$.WORKER_CONNECTED=6]="WORKER_CONNECTED",e$[e$.CLOSED=7]="CLOSED",e$}({}),mO$1=function(e$){return e$.CONNECTION_STATE_CHANGE="connection-state-change",e$.STATE_CHANGE="state-change",e$.INSPECT_RESULT="inspect-result",e$.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e$.REQUEST_NEW_WORKER_URL="request-new-worker-url",e$}({}),TO$1=function(e$){return e$.CONNECTED="transmitter:connected",e$.RECONNECTING="transmitter:reconnecting",e$.WILL_RECONNECT="transmitter:will_reconnect",e$.CLOSED="transmitter:closed",e$.FAILED="transmitter:failed",e$.ON_MESSAGE="transmitter:on_message",e$.REQUEST_NEW_URLS="transmitter:request_new_urls",e$.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e$.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e$.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e$.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e$.FAILBACK="transmitter:failback",e$.PRE_CONNECT_PC="transmitter:pre_connect_pc",e$}({}),SO$1=function(e$){return e$.CAMERA_CHANGED="camera-changed",e$.MICROPHONE_CHANGED="microphone-changed",e$.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e$.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e$.AUTOPLAY_FAILED="autoplay-failed",e$.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e$.SECURITY_POLICY_VIOLATION="security-policy-violation",e$}({}),gO$1=function(e$){return e$.CONNECTING="CONNECTING",e$.RECONNECTING="RECONNECTING",e$.CONNECTED="CONNECTED",e$.CLOSED="CLOSED",e$}({}),RO$1=function(e$){return e$.CONNECTION_STATE_CHANGE="connection-state-change",e$.STATE_CHANGE="state-change",e$.INSPECT_RESULT="inspect-result",e$.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e$.REQUEST_NEW_WORKER_URL="request-new-worker-url",e$}({}),CO$1=function(e$){return e$[e$.CONNECT_AP=0]="CONNECT_AP",e$[e$.AP_CONNECTED=1]="AP_CONNECTED",e$[e$.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e$[e$.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e$[e$.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e$[e$.CONNECT_WORKER=5]="CONNECT_WORKER",e$[e$.WORKER_CONNECTED=6]="WORKER_CONNECTED",e$[e$.CLOSED=7]="CLOSED",e$}({}),IO$1=function(e$){return e$.CALL="call",e$.CANDIDATE="candidate",e$.PUBLISH="publish",e$.UNPUBLISH="unpublish",e$.CONTROL="control",e$.RESTART_ICE="restart_ice",e$.ACK="ack",e$.RESPONSE="response",e$.JOIN="join",e$.CHECK="check",e$}({}),vO$1=function(e$){return e$.ABORT="abort",e$}({}),yO$1=function(e$){return e$.MUTE_LOCAL_AUDIO="mute_local_audio",e$.MUTE_LOCAL_VIDEO="mute_local_video",e$.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e$.UNMUTE_LOCAL_VIDEO="unmute_local_video",e$}({}),AO$1=function(e$){return e$.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e$.P2P_TOKEN_CHANGED="p2p_token_changed",e$}({});const bO$1={[yw$1.ACCESS_POINT]:{[ww$1.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[ww$1.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[ww$1.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[ww$1.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[ww$1.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[ww$1.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[ww$1.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[ww$1.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[ww$1.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[ww$1.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[ww$1.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[ww$1.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[ww$1.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[ww$1.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[ww$1.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[ww$1.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[ww$1.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[ww$1.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[yw$1.UNILBS]:{[bw$1.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[bw$1.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[bw$1.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[bw$1.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[bw$1.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[bw$1.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[bw$1.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[bw$1.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[bw$1.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[bw$1.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[bw$1.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[bw$1.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[yw$1.STRING_UID_ALLOCATOR]:{[Aw$1.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Aw$1.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Aw$1.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function wO$1(e$){const t$=bO$1[Math.floor(e$/1e4)];if(!t$)return{desc:"unknown error",retry:!1};const r$=t$[e$%1e4];if(!r$){if(Math.floor(e$/1e4)===yw$1.ACCESS_POINT){const n$=e$%1e4;if(n$.toString()[0]==="1")return{desc:e$.toString(),retry:!1};if(n$.toString()[0]==="2")return{desc:e$.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r$}const OO$1={[Ow$1.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ow$1.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ow$1.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ow$1.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ow$1.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ow$1.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ow$1.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ow$1.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ow$1.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ow$1.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ow$1.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ow$1.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ow$1.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ow$1.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ow$1.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ow$1.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ow$1.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ow$1.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ow$1.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ow$1.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ow$1.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ow$1.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ow$1.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ow$1.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ow$1.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ow$1.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ow$1.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ow$1.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ow$1.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ow$1.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ow$1.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ow$1.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ow$1.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ow$1.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ow$1.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ow$1.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ow$1.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ow$1.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ow$1.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ow$1.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ow$1.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ow$1.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ow$1.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ow$1.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ow$1.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ow$1.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ow$1.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ow$1.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ow$1.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ow$1.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ow$1.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ow$1.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ow$1.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ow$1.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ow$1.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ow$1.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ow$1.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ow$1.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ow$1.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ow$1.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ow$1.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ow$1.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ow$1.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function NO$1(e$){return OO$1[e$]||{desc:"UNKNOWN_ERROR_".concat(e$),action:"failed"}}function DO$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function PO$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?DO$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):DO$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}function LO$1(e$){return e$.every(t$=>t$.readyState===WebSocket.CLOSED||t$.readyState===WebSocket.CLOSING)}function kO$1(e$,t$){if(typeof e$=="string")return e$;const{proxy:r$,host:n$,port:i$}=e$;if(t$){const o$=XA$1("JOIN_GATEWAY_FALLBACK_PORT")||443;return o$===443?"wss://".concat(n$,"/ws/?p=").concat(Number(i$)+150):"wss://".concat(n$,":").concat(o$,"/ws/?p=").concat(Number(i$)+150)}return r$?"wss://".concat(r$,"/ws/?h=").concat(n$,"&p=").concat(i$):"wss://".concat(n$,":").concat(i$)}const MO$1=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,UO$1=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,xO$1=/wss:\/\/(.+):([0-9]+)\/?/,VO$1=/wss:\/\/(.[^\/]+)\/?/;let FO$1=0,BO$1=class{constructor(t$,r$){Fg$1(this,"id",0),Fg$1(this,"store",void 0),Fg$1(this,"recordIndex",void 0),Fg$1(this,"websockets",[]),Fg$1(this,"try443PortDuration",2e3),Fg$1(this,"forceCloseWSDuration",5e3),Fg$1(this,"try443PortTimeout",null),Fg$1(this,"forceCloseTimeout",null),Fg$1(this,"isTry443PortFailed",!1),Fg$1(this,"isNormalPortFailed",!1),Fg$1(this,"useDoubleDomain",!1),Fg$1(this,"useProxy",!1),Fg$1(this,"startTime",Date.now()),this.id=++FO$1,this.try443PortDuration=XA$1("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t$||5e3,this.store=r$}closeAllWebsockets(){this.websockets.forEach(t$=>{t$.onopen=null,t$.onclose=null,t$.onmessage=null,t$.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var t$;const r$=Date.now()-this.startTime;for(var n$=arguments.length,i$=new Array(n$),o$=0;o$<n$;o$++)i$[o$]=arguments[o$];fb$1.debug("[choose-best-ws ".concat((t$=this.store)===null||t$===void 0?void 0:t$.clientId," ").concat(this.id,"] ").concat(r$,"ms:"),...i$)}createWebSocket(t$,r$,n$){this.logger("createWebSocket:",t$,{isTry443Port:r$,hasTimeoutDetection:n$});const i$=XA$1("GATEWAY_DOMAINS"),o$=Date.now(),s$=[],a$=i$.find(l$=>{var d$;return Dn$1(d$=t$.host).call(d$,l$)});a$||(this.useDoubleDomain=!1);const c$=[];if(this.useDoubleDomain)i$.forEach(l$=>{c$.push(kO$1(PO$1(PO$1({},t$),{},{host:t$.host.replace(a$,l$)}),r$))});else{const l$=PO$1({},t$);if(r$&&a$){const d$=i$.find(h$=>h$!==a$);d$&&(l$.host=l$.host.replace(a$,d$))}c$.push(kO$1(l$,r$))}try{c$.forEach(l$=>{const d$=new WebSocket(l$);d$.binaryType="arraybuffer",s$.push(d$),this.logger("ws is connecting:",d$.url)})}catch(l$){if(this.logger("ws create failed"),s$.forEach(d$=>d$.close()),s$.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t$,r$,n$);if(!r$&&Number(t$.port)!==443)return this.createWebSocket(t$,!0,n$);throw new yb$1(Ry$1.WS_ERR,"init websocket failed! Error: ".concat(l$.toString()))}const u$=Mv$1();return this.store&&this.store.recordJoinChannelService({urls:s$.map(l$=>l$.url),service:"gateway"},this.recordIndex),s$.forEach(l$=>{l$.onopen=()=>{this.logger("onopen: ws ".concat(l$.url," open cost ").concat(Date.now()-o$,"ms")),this.websockets.forEach(d$=>{d$!==l$&&(d$.onopen=null,d$.onclose=null,d$.onmessage=null,d$.close(),this.logger("close backup websocket: ".concat(d$.url)))}),this.websockets.length=0,u$.resolve(l$)},l$.onclose=d$=>{this.logger("onclose: ws ".concat(l$.url," closed cost ").concat(Date.now()-o$,"ms state: ").concat(l$.readyState)),r$?this.isTry443PortFailed=LO$1(s$):this.isNormalPortFailed=LO$1(s$),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(r$&&this.isTry443PortFailed||!r$&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(d$.reason)),u$.reject({code:d$.code,reason:eO$1.A_ROUND_WS_FAILED}))},l$.onmessage=d$=>this.logger("".concat(l$.url," onmessage: ").concat(d$.data))}),this.websockets.push(...s$),n$||(()=>{const l$=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",u$.isResolved),this.websockets.forEach(d$=>d$.readyState!==WebSocket.OPEN&&d$.close())};if(r$||this.useProxy)return this.logger("add 5s timeout at ".concat(r$?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(l$,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",u$.isResolved),u$.isResolved)return l$();Hv$1().os===Fv$1.MAC_OS&&Zv$1()&&l$(),this.createWebSocket(t$,!0,!0).then(d$=>u$.resolve(d$)).catch(d$=>{this.isNormalPortFailed&&u$.reject(d$),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(l$,this.forceCloseWSDuration)},this.try443PortDuration)})(),u$.promise}chooseBestWebsocket(t$,r$,n$,i$){return this.useDoubleDomain=!!r$,typeof t$=="string"&&(t$=function(o$){let s$,a$,c$;return[,s$,a$,c$]=o$.match(MO$1)||[],s$||([,a$,c$]=o$.match(UO$1)||[]),a$&&c$||([,a$,c$]=o$.match(xO$1)||[]),a$&&c$||([,a$]=o$.match(VO$1)||[]),a$||fb$1.warning("un-destructible url: ",o$),{proxy:s$,host:a$,port:c$||"443"}}(t$)),this.recordIndex=i$,this.useProxy=!!t$.proxy,n$&&this.useProxy&&(fb$1.warn("cannot use 443 only when use proxy"),n$=!1),this.createWebSocket(t$,!!n$,!1).finally(()=>this.clearTimeout())}};function jO$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}let GO$1=class extends xy$1{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t$){var r$;Dn$1(r$=["tryNext","recover"]).call(r$,t$)&&this.resetReconnectCount(t$),this._reconnectMode=t$}get state(){return this._state}set state(t$){t$!==this._state&&(this._state=t$,this._state==="reconnecting"?this.emit(Uw$1.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Uw$1.CONNECTED):this._state==="closed"?this.emit(Uw$1.CLOSED):this._state==="failed"&&this.emit(Uw$1.FAILED))}resetReconnectCount(t$){fb$1.debug("websocket reset reconnect count, reason: "+t$),this.reconnectCount=0}constructor(t$,r$){let n$=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i$=arguments.length>3&&arguments[3]!==void 0&&arguments[3],o$=arguments.length>4&&arguments[4]!==void 0&&arguments[4],s$=arguments.length>5?arguments[5]:void 0;super(),Fg$1(this,"connectionID",0),Fg$1(this,"currentURLIndex",0),Fg$1(this,"urls",[]),Fg$1(this,"_reconnectMode","tryNext"),Fg$1(this,"reconnectReason",void 0),Fg$1(this,"_initMutex",new NA$1("websocket")),Fg$1(this,"name",void 0),Fg$1(this,"_state","closed"),Fg$1(this,"reconnectInterrupter",void 0),Fg$1(this,"websocket",void 0),Fg$1(this,"retryConfig",void 0),Fg$1(this,"reconnectCount",0),Fg$1(this,"forceCloseTimeout",5e3),Fg$1(this,"onlineReconnectListener",void 0),Fg$1(this,"useCompress",void 0),Fg$1(this,"tryDoubleDomain",!1),Fg$1(this,"use443PortOnly",!1),Fg$1(this,"wsInflateLength",0),Fg$1(this,"wsDeflateLength",0),Fg$1(this,"closeEstablishingWs",()=>{}),Fg$1(this,"store",void 0),Fg$1(this,"joinGatewayRecordIndex",void 0),this.store=s$,this.name=t$,this.retryConfig=function(d$){for(var h$=1;h$<arguments.length;h$++){var p$=arguments[h$]!=null?arguments[h$]:{};h$%2?jO$1(Object(p$),!0).forEach(function(_$){Fg$1(d$,_$,p$[_$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d$,Object.getOwnPropertyDescriptors(p$)):jO$1(Object(p$)).forEach(function(_$){Object.defineProperty(d$,_$,Object.getOwnPropertyDescriptor(p$,_$))})}return d$}({},r$),this.useCompress=n$,this.tryDoubleDomain=i$,this.use443PortOnly=o$;const{timeout:a$,timeoutFactor:c$}=r$,u$=Math.max(300,Math.floor(3*a$/5)),l$=Math.max(1.2,Math.floor(8*c$)/10);Xy$1.ONLINE&&(this.retryConfig.timeout=u$,this.retryConfig.timeoutFactor=l$),iA$1.on(Qy$1.NETWORK_STATE_CHANGE,(d$,h$)=>{d$!==h$&&(this.resetReconnectCount("network state change: ".concat(h$," -> ").concat(d$)),d$===Xy$1.ONLINE?(this.retryConfig.timeout=u$,this.retryConfig.timeoutFactor=l$):(this.retryConfig.timeout=a$,this.retryConfig.timeoutFactor=c$))})}getConnection(){return this.websocket||void 0}async init(t$){let r$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n$=await this._initMutex.lock();this.forceCloseTimeout=r$,this.urls=t$,this.state="connecting";try{const i$=Mv$1(),o$=this.urls[this.currentURLIndex];XA$1("ENABLE_PREALLOC_PC")&&this.emit(TO$1.PRE_CONNECT_PC),this.createWebSocketConnection(o$).then(i$.resolve).catch(i$.reject),this.once(Uw$1.CLOSED,()=>{i$.reject(new Cy$1(Ry$1.WS_DISCONNECT))}),this.once(Uw$1.CONNECTED,i$.resolve),await i$.promise}catch{}finally{n$()}}close(t$,r$){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const n$=this.websocket;r$?setTimeout(()=>n$.close(),500):n$.close(),this.websocket=void 0}this.state=t$?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t$,r$){if(!this.websocket)return void fb$1.warning("[".concat(this.name,"] can not reconnect, no websocket"));t$!==void 0&&(this.reconnectMode=t$),fb$1.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r$)]},this.joinGatewayRecordIndex);const n$=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n$&&n$.bind(this.websocket)({code:9999,reason:r$})}sendMessage(t$){let r$=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Cy$1(Ry$1.WS_ABORT,"websocket is not ready");try{r$||(t$=JSON.stringify(t$)),this.websocket.send(t$)}catch(n$){throw new Cy$1(Ry$1.WS_ERR,"send websocket message error"+n$.toString())}}setWsInflateData(t$){this.wsDeflateLength=this.wsDeflateLength+t$.originLength,this.wsInflateLength=this.wsInflateLength+t$.compressedLength}getWsInflateData(){const t$=this.wsInflateLength,r$=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t$,wsDeflateLength:r$}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t$){var r$;const n$=Mv$1();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i$=l$=>{var d$;(d$=this.store)===null||d$===void 0||d$.signalChannelOpen(),fb$1.debug("[".concat(this.name,"] websocket opened:"),l$),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n$.resolve()},o$=async l$=>{var d$;if(fb$1.debug("[".concat(this.name,"] websocket close ").concat((d$=this.websocket)===null||d$===void 0?void 0:d$.url,", code: ").concat(l$.code,", reason: ").concat(l$.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n$.reject(new Cy$1(Ry$1.WS_DISCONNECT,"websocket close: ".concat(l$.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=l$.reason,this.state="reconnecting");const h$=eA$1(this,Uw$1.WILL_RECONNECT,this.reconnectMode,l$.reason)||this.reconnectMode,p$=await this.reconnectWithAction(h$);if(this.state==="closed")return void fb$1.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!p$)return n$.reject(new Cy$1(Ry$1.WS_DISCONNECT,"websocket reconnect failed: ".concat(l$.code))),this.close(!0);n$.resolve()}},s$=l$=>{this.emit(Uw$1.ON_MESSAGE,l$)},a$=l$=>{fb$1.warn("[".concat(this.connectionID,"] ws open error ").concat(l$))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),XA$1("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t$=XA$1("GATEWAY_WSS_ADDRESS")),fb$1.debug("[".concat(this.name,"] start connect, url:"),t$);const c$=(r$=this.store)===null||r$===void 0?void 0:r$.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var u$;const l$=await this.chooseBestWebsocketConnection(t$);this.websocket=l$,i$&&i$(this.websocket.url),this.websocket.onclose=o$,this.websocket.onmessage=s$,this.websocket.onerror=a$,(u$=this.store)===null||u$===void 0||u$.recordJoinChannelService({endTs:Date.now(),status:"success"},c$),this.joinGatewayRecordIndex=c$}catch(l$){const d$=this.state==="closed",h$=l$ instanceof Cy$1,p$=h$&&l$.code===Ry$1.WS_ABORT,_$=h$&&l$.code===Ry$1.WS_ERR,f$=h$?l$.message:l$&&(l$.reason||l$.toString());fb$1.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(f$)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:p$?"aborted":"error",errors:[l$]},c$),d$||_$?(n$.reject(d$?new Cy$1(Ry$1.WS_DISCONNECT,"websocket is closed: ".concat(f$)):new Cy$1(Ry$1.WS_ERR,"init websocket failed: ".concat(f$))),_$&&fb$1.error("[".concat(this.name,"] init websocket failed: ").concat(f$))):o$&&o$(l$)}return n$.promise}async reconnectWithAction(t$){let r$=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;fb$1.warning("[choose-best-ws] action: =>",t$),this.onlineReconnectListener||iA$1.isOnline||!iA$1.onlineWaiter||(this.onlineReconnectListener=iA$1.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let n$=!0;if(this.reconnectInterrupter=()=>n$=!1,r$){const s$=LA$1(this.reconnectCount,this.retryConfig);fb$1.debug("[".concat(this.name,"] wait ").concat(s$,"ms to reconnect websocket, mode: ").concat(t$)),await Gh$1.race([mA$1(s$),this.onlineReconnectListener||new Gh$1(()=>{})])}if(this._state==="closed"||!n$)return!1;this.reconnectCount+=1;const i$=async(s$,a$)=>{this.emit(Uw$1.RECONNECT_CREATE_CONNECTION,a$),await this.createWebSocketConnection(s$)};try{if(t$==="retry")this.emit(Uw$1.RECONNECT_WAITTING_FINISH,t$),await i$(this.urls[this.currentURLIndex],t$);else if(t$==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);fb$1.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(Uw$1.RECONNECT_WAITTING_FINISH,t$),await i$(this.urls[this.currentURLIndex],t$)}else t$==="recover"&&(fb$1.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Uw$1.RECONNECT_WAITTING_FINISH,t$),this.urls=await Zy$1(this,Uw$1.REQUEST_NEW_URLS),this.currentURLIndex=0,await i$(this.urls[this.currentURLIndex],t$))}catch(s$){var o$;fb$1.error("[".concat(this.name,"] reconnect failed ").concat(s$&&s$.toString()));const a$=s$==null||(o$=s$.data)===null||o$===void 0?void 0:o$.desc;return Array.isArray(a$)&&Dn$1(a$).call(a$,"dynamic key expired")?(this.emit(Uw$1.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t$,r$)}return!0}},WO$1=class extends GO$1{constructor(t$,r$){super(t$,r$,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t$,r$){const n$=Mv$1(),i$=function(s$,a$){return new BO$1(s$,a$)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{fb$1.debug("[choose-best-ws] close establishing websockets"),i$.closeAllWebsockets(),n$.reject(new Cy$1(Ry$1.WS_ABORT,"choose best websocket aborted"))};const o$=XA$1("GATEWAY_DOMAINS");return fb$1.debug("[choose-best-ws] currentDomain: ",t$,", domains: ",o$,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i$.chooseBestWebsocket(t$,this.tryDoubleDomain,this.use443PortOnly,r$).then(n$.resolve).catch(n$.reject),n$.promise.finally(()=>{this.closeEstablishingWs=void 0})}},HO$1=class extends GO$1{constructor(t$,r$){super(t$,r$,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t$,r$){return new Gh$1((n$,i$)=>{let o$=!1;const s$=[];this.closeEstablishingWs=()=>{fb$1.debug("[choose-best-ws] close establishing websockets"),s$.forEach(_$=>{_$.onclose=null,_$.onopen=null,_$.onmessage=null,_$.close()}),i$(new Cy$1(Ry$1.WS_ABORT,"choose best websocket aborted"))};const a$=XA$1("GATEWAY_DOMAINS");let c$;const u$=t$.indexOf("?h="),l$=a$.find(_$=>u$!==-1?Dn$1(t$).call(t$,_$,u$):Dn$1(t$).call(t$,_$));fb$1.debug("[choose-best-ws] currentDomain: ",l$,", domains: ",a$);let d$=!this.tryDoubleDomain||!l$;if(!d$&&l$){var h$;const _$=Date.now();try{a$.forEach(f$=>{const m$=u$===-1?t$.replace(l$,f$):t$.substr(0,u$)+t$.substr(u$).replace(l$,f$),g$=new WebSocket(m$);g$.binaryType="arraybuffer",s$.push(g$),fb$1.debug("[choose-best-ws] ws is connecting:",g$.url)})}catch{for(fb$1.debug("[choose-best-ws] ws create failed, fallback to single url"),s$.forEach(m$=>m$.close());s$.length;)s$.pop();d$=!0}(h$=this.store)===null||h$===void 0||h$.recordJoinChannelService({urls:s$.map(f$=>f$.url),service:"gateway"},r$),s$.forEach(f$=>{f$.onopen=()=>{if(o$)return;const m$=Date.now()-_$;fb$1.debug("[choose-best-ws] ws open cost ".concat(m$,"ms")),s$.filter(g$=>g$!==f$).forEach(g$=>{fb$1.debug("[choose-best-ws]close backup websocket: ".concat(g$.url)),g$.close()}),o$=!0,n$(f$)},f$.onclose=m$=>{c$=m$,!o$&&(s$.find(g$=>!(g$.readyState===WebSocket.CLOSED||g$.readyState===WebSocket.CLOSING))||(fb$1.debug("[choose-best-ws] all websocket is closed"),o$=!0,i$(c$)))},f$.onmessage=m$=>{fb$1.debug("[choose-best-ws]".concat(f$.url," onmessage: ").concat(m$.data))}}),mA$1(this.forceCloseTimeout).then(()=>{s$.forEach(f$=>{f$.readyState!==WebSocket.OPEN&&f$.close()})})}if(d$){var p$;let _$;fb$1.debug("[choose-best-ws] use single url: ",t$),(p$=this.store)===null||p$===void 0||p$.recordJoinChannelService({urls:[t$],service:"gateway"},r$);try{_$=new WebSocket(t$),s$.push(_$),_$.binaryType="arraybuffer"}catch(f$){const m$=new Cy$1(Ry$1.WS_ERR,"init websocket failed! Error: ".concat(f$.toString()));return fb$1.error("[".concat(this.name,"]").concat(m$)),void i$(m$)}_$.onopen=()=>{n$(_$)},_$.onclose=f$=>{i$(f$)},_$.onmessage=f$=>{fb$1.debug("[choose-best-ws]".concat(_$.url," onmessage: ").concat(f$.data))},mA$1(this.forceCloseTimeout).then(()=>{_$&&_$.readyState!==WebSocket.OPEN&&_$.close()})}}).then(n$=>(this.closeEstablishingWs=void 0,n$)).catch(n$=>{throw this.closeEstablishingWs=void 0,n$})}},KO$1=class extends xy$1{get connectionState(){return this._connectionState}set connectionState(t$){t$!==this._connectionState&&(this._connectionState=t$,t$===Nw$1.CONNECTED?this.emit(Dw$1.WS_CONNECTED):t$===Nw$1.RECONNECTING?this.emit(Dw$1.WS_RECONNECTING,this._websocketReconnectReason):t$===Nw$1.CLOSED&&this.emit(Dw$1.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t$,r$){super(),Fg$1(this,"_disconnectedReason",void 0),Fg$1(this,"_websocketReconnectReason",void 0),Fg$1(this,"_connectionState",Nw$1.CLOSED),Fg$1(this,"reconnectToken",void 0),Fg$1(this,"websocket",void 0),Fg$1(this,"openConnectionTime",void 0),Fg$1(this,"clientId",void 0),Fg$1(this,"lastMsgTime",Date.now()),Fg$1(this,"uploadCache",[]),Fg$1(this,"uploadCacheInterval",void 0),Fg$1(this,"rttRolling",new MA$1(5)),Fg$1(this,"pingpongTimer",void 0),Fg$1(this,"wsInflateDataTimer",void 0),Fg$1(this,"pingpongTimeoutCount",0),Fg$1(this,"joinResponse",void 0),Fg$1(this,"multiIpOption",void 0),Fg$1(this,"initError",void 0),Fg$1(this,"spec",void 0),Fg$1(this,"store",void 0),Fg$1(this,"onWebsocketMessage",n$=>{if(n$.data instanceof ArrayBuffer)return void this.emit(Dw$1.ON_BINARY_DATA,n$.data);const i$=JSON.parse(n$.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i$,"_id")){const o$="res-@".concat(i$._id);this.emit(o$,i$._result,i$._message)}else if(Object.prototype.hasOwnProperty.call(i$,"_type")){if(this.emit(i$._type,i$._message),i$._type===kw$1.ON_NOTIFICATION&&this.handleNotification(i$._message),i$._type===kw$1.ON_USER_BANNED)switch(i$._message.error_code){case 14:this.close(Hy$1.UID_BANNED);break;case 15:this.close(Hy$1.IP_BANNED);break;case 16:this.close(Hy$1.CHANNEL_BANNED)}if(i$._type===kw$1.ON_USER_LICENSE_BANNED)switch(i$._message.error_code){case Ow$1.ERR_LICENSE_MISSING:this.close(Hy$1.LICENSE_MISSING);break;case Ow$1.ERR_LICENSE_EXPIRED:this.close(Hy$1.LICENSE_EXPIRED);break;case Ow$1.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Hy$1.LICENSE_MINUTES_EXCEEDED);break;case Ow$1.ERR_LICENSE_PERIOD_INVALID:this.close(Hy$1.LICENSE_PERIOD_INVALID);break;case Ow$1.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Hy$1.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ow$1.ERR_LICENSE_ILLEGAL:this.close(Hy$1.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t$.clientId,this.spec=t$,this.store=r$,this.websocket=new WO$1("gateway-".concat(this.clientId),this.spec.retryConfig,!0,XA$1("JOIN_GATEWAY_USE_DUAL_DOMAIN"),XA$1("JOIN_GATEWAY_USE_443PORT_ONLY"),r$),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Nw$1.CONNECTED&&this.reconnect("retry",Jy$1.OFFLINE)})}async request(t$,r$,n$,i$){const o$=TA$1(6,""),s$={_id:o$,_type:t$,_message:r$},a$=this.websocket.connectionID,c$=()=>new Gh$1((_$,f$)=>{if(this.connectionState===Nw$1.CONNECTED)return _$();const m$=()=>{this.off(Dw$1.WS_CLOSED,g$),_$()},g$=()=>{this.off(Dw$1.WS_CONNECTED,m$),f$(new yb$1(Ry$1.WS_ABORT))};this.once(Dw$1.WS_CONNECTED,m$),this.once(Dw$1.WS_CLOSED,g$),t$!==Pw$1.PUBLISH&&t$!==Pw$1.PUBLISH_DATASTREAM&&t$!==Pw$1.SUBSCRIBE&&t$!==Pw$1.SUBSCRIBE_DATASTREAM&&t$!==Pw$1.UNSUBSCRIBE&&t$!==Pw$1.UNSUBSCRIBE_DATASTREAM&&t$!==Pw$1.UNPUBLISH&&t$!==Pw$1.UNPUBLISH_DATASTREAM&&t$!==Pw$1.CONTROL&&t$!==Pw$1.RESTART_ICE||this.once(Dw$1.DISCONNECT_P2P,()=>{f$(new yb$1(Ry$1.DISCONNECT_P2P))}),t$!==Pw$1.PUBLISH&&t$!==Pw$1.RESTART_ICE||this.once(Dw$1.ABORT_P2P_EXECUTION,()=>{f$(new yb$1(Ry$1.DISCONNECT_P2P))})});if(this.connectionState!==Nw$1.CONNECTING&&this.connectionState!==Nw$1.RECONNECTING||t$===Pw$1.JOIN||t$===Pw$1.REJOIN||await c$(),this.websocket.sendMessage(s$,!0),i$)return;const u$=new Gh$1((_$,f$)=>{let m$=!1;const g$=(y$,S$)=>{m$=!0,_$({isSuccess:y$==="success",message:S$||{}}),this.off(Dw$1.WS_CLOSED,v$),this.off(Dw$1.WS_RECONNECTING,v$),this.emit(Dw$1.REQUEST_SUCCESS,t$,r$)};this.once("res-@".concat(o$),g$);const v$=()=>{f$(new yb$1(Ry$1.WS_ABORT,"type: ".concat(t$))),this.off(Dw$1.WS_CLOSED,v$),this.off(Dw$1.WS_RECONNECTING,v$),this.off("res-@".concat(o$),g$)};this.once(Dw$1.WS_CLOSED,v$),this.once(Dw$1.WS_RECONNECTING,v$),mA$1(XA$1("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a$||m$||(fb$1.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t$)),this.emit(Dw$1.REQUEST_TIMEOUT,t$,r$))})});let l$=null;try{l$=await u$}catch(_$){if(this.connectionState===Nw$1.CLOSED||t$===Pw$1.LEAVE)throw new yb$1(Ry$1.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n$?_$.throw():t$===Pw$1.JOIN||t$===Pw$1.REJOIN?null:(await c$(),await this.request(t$,r$))}if(l$.isSuccess)return l$.message;const d$=Number(l$.message.error_code||l$.message.code),h$=NO$1(d$),p$=new yb$1(Ry$1.UNEXPECTED_RESPONSE,"".concat(h$.desc,": ").concat(l$.message.error_str),{code:d$,data:l$.message,desc:h$.desc});return h$.action==="success"?l$.message:(fb$1.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t$,", error_code: ").concat(d$,", message: ").concat(h$.desc,", action: ").concat(h$.action)),d$===Ow$1.ERR_TOO_MANY_BROADCASTERS?((t$===Pw$1.JOIN||t$===Pw$1.REJOIN)&&(this.initError=p$,this.close()),p$.throw()):h$.action==="failed"?p$.throw():h$.action==="quit"?(this.initError=p$,this.close(),p$.throw()):(d$===Ow$1.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l$.message.option,fb$1.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Jy$1.MULTI_IP)):this.reconnect(h$.action,Jy$1.SERVER_ERROR),t$===Pw$1.JOIN||t$===Pw$1.REJOIN?null:await this.request(t$,r$)))}waitMessage(t$,r$){return new Gh$1(n$=>{const i$=o$=>{(!r$||r$(o$))&&(this.off(t$,i$),n$(o$))};this.on(t$,i$)})}uploadWRTCStats(t$){if(!this.store.sessionId)return void fb$1.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r$={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t$};this.upload(Lw$1.WRTC_STATS,r$)}upload(t$,r$){const n$={_type:t$,_message:r$};try{this.websocket.sendMessage(n$)}catch{const o$=XA$1("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n$),this.uploadCache.length>o$&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Nw$1.CONNECTED)return;const s$=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(s$._type,s$._message)},XA$1("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t$,r$){const n$={_type:t$,_message:r$};this.websocket.sendMessage(n$)}init(t$,r$){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Gh$1((n$,i$)=>{this.once(Dw$1.WS_CONNECTED,()=>n$(this.joinResponse)),this.once(Dw$1.WS_CLOSED,()=>i$(this.initError||new yb$1(Ry$1.WS_ABORT))),this.connectionState=Nw$1.CONNECTING,this.websocket.init(t$).catch(i$),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t$){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t$||Hy$1.LEAVE,this.connectionState=Nw$1.CLOSED,fb$1.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Dw$1.ABORT_P2P_EXECUTION);const t$=await Zy$1(this,Dw$1.REQUEST_JOIN_INFO),r$=await this.request(Pw$1.JOIN,t$);if(!r$)return this.emit(Dw$1.REPORT_JOIN_GATEWAY,eO$1.TIMEOUT,this.url||""),!1;this.joinResponse=r$,this.emit(Dw$1.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Nw$1.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new yb$1(Ry$1.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t$=tA$1(this,Dw$1.REQUEST_REJOIN_INFO);t$.token=this.reconnectToken;const r$=await this.request(Pw$1.REJOIN,t$);return!!r$&&(this.connectionState=Nw$1.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),r$.peers&&r$.peers.forEach(n$=>{this.emit(kw$1.ON_USER_ONLINE,{uid:n$.uid}),n$.audio&&this.emit(kw$1.ON_ADD_AUDIO_STREAM,{uid:n$.uid,uint_id:n$.uint_id,audio:!0,ssrcId:n$.audio_ssrc}),n$.video&&this.emit(kw$1.ON_ADD_VIDEO_STREAM,{uid:n$.uid,uint_id:n$.uint_id,video:!0,ssrcId:n$.video_ssrc}),n$.audio_mute?this.emit(kw$1.MUTE_AUDIO,{uid:n$.uid}):this.emit(kw$1.UNMUTE_AUDIO,{uid:n$.uid}),n$.video_mute?this.emit(kw$1.MUTE_VIDEO,{uid:n$.uid}):this.emit(kw$1.UNMUTE_VIDEO,{uid:n$.uid}),n$.audio_enable_local?this.emit(kw$1.ENABLE_LOCAL_AUDIO,{uid:n$.uid}):this.emit(kw$1.DISABLE_LOCAL_AUDIO,{uid:n$.uid}),n$.video_enable_local?this.emit(kw$1.ENABLE_LOCAL_VIDEO,{uid:n$.uid}):this.emit(kw$1.DISABLE_LOCAL_VIDEO,{uid:n$.uid}),n$.audio||n$.video||this.emit(kw$1.ON_REMOVE_STREAM,{uid:n$.uid,uint_id:n$.uint_id})}),!0)}reconnect(t$,r$){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t$,r$)}handleNotification(t$){fb$1.debug("[".concat(this.clientId,"] receive notification: "),t$);const r$=NO$1(t$.code);if(t$.code===28&&"detail"in t$&&(fb$1.info("[".concat(this.clientId,"] receive recover notification: "),t$.detail),this.emit(Dw$1.RECOVER_NOTIFICATION,t$.detail)),r$.action!=="success"){if(r$.action!=="failed")return r$.action==="quit"?(r$.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Hy$1.UID_BANNED),void this.close()):void this.reconnect(r$.action,Jy$1.SERVER_ERROR);fb$1.error("[".concat(this.clientId,"] ignore error: "),r$.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t$=XA$1("PING_PONG_TIME_OUT"),r$=Date.now();this.pingpongTimeoutCount>=t$&&(fb$1.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r$-this.lastMsgTime,"ms")),r$-this.lastMsgTime>XA$1("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Jy$1.TIMEOUT):this.request(Pw$1.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const n$=Date.now()-r$;this.rttRolling.add(n$),XA$1("REPORT_STATS")&&this.send(Pw$1.PING_BACK,{pingpongElapse:n$})}).catch(n$=>{})}handleWsInflateData(){const{wsInflateLength:t$,wsDeflateLength:r$}=this.websocket.getWsInflateData();t$!==0&&r$!==0&&this.upload(Lw$1.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r$,ws_inflate_length:t$})}handleWebsocketEvents(){this.websocket.on(Uw$1.RECONNECT_WAITTING_FINISH,t$=>{this.emit(Dw$1.WS_RECONNECT_WAITTING_FINISH,t$)}),this.websocket.on(Uw$1.RECONNECT_CREATE_CONNECTION,t$=>{this.emit(Dw$1.WS_RECONNECT_CREATE_CONNECTION,t$)}),this.websocket.on(Uw$1.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Uw$1.CLOSED,()=>{this.connectionState=Nw$1.CLOSED}),this.websocket.on(Uw$1.FAILED,()=>{this._disconnectedReason=Hy$1.NETWORK_ERROR,this.connectionState=Nw$1.CLOSED}),this.websocket.on(Uw$1.RECONNECTING,t$=>{this._websocketReconnectReason=t$,this.joinResponse=void 0,this.connectionState===Nw$1.CONNECTED?this.connectionState=Nw$1.RECONNECTING:this.connectionState=Nw$1.CONNECTING}),this.websocket.on(Uw$1.WILL_RECONNECT,(t$,r$,n$)=>{const i$=tA$1(this,Dw$1.IS_P2P_DISCONNECTED),o$=i$||t$!=="retry";i$&&t$==="retry"&&(fb$1.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t$="tryNext",r$=eO$1.P2P_DISCONNECTED),o$&&(fb$1.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t$)),this.emit(Dw$1.REPORT_JOIN_GATEWAY,r$||eO$1.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Dw$1.DISCONNECT_P2P)),n$(t$)}),this.websocket.on(Uw$1.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t$=>{fb$1.warning("[".concat(this.clientId,"] rejoin failed ").concat(t$)),this.reconnect("tryNext",Jy$1.SERVER_ERROR)}):this.join().catch(t$=>{if(this.emit(Dw$1.REPORT_JOIN_GATEWAY,t$,this.url||""),t$ instanceof yb$1){if(t$.code===Ry$1.UNEXPECTED_RESPONSE&&t$.data.code===Ow$1.ERR_NO_AUTHORIZED)return this.initError=new yb$1(Ry$1.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),fb$1.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Jy$1.SERVER_ERROR);fb$1.error("[".concat(this.clientId,"] join gateway request failed"),t$.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Jy$1.SERVER_ERROR):(this.initError=t$,this.close())}})}),this.websocket.on(Uw$1.REQUEST_NEW_URLS,(t$,r$)=>{Zy$1(this,Dw$1.REQUEST_RECOVER,this.multiIpOption).then(t$).catch(r$)}),this.websocket.on(Uw$1.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(kw$1.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(TO$1.PRE_CONNECT_PC,()=>{this.emit(Dw$1.PRE_CONNECT_PC)})}},YO$1=function(e$){return e$[e$.CHOOSE_SERVER=11]="CHOOSE_SERVER",e$[e$.CLOUD_PROXY=18]="CLOUD_PROXY",e$[e$.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e$[e$.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e$}({});function qO$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function zO$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?qO$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):qO$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}function JO$1(e$){return e$.match(/^[\.\:\d]+$/)?"".concat(e$.replace(/[^\d]/g,"-"),".").concat(XA$1("TURN_DOMAIN")):(fb$1.info("Unidentified as ip: ".concat(e$,", use as host")),e$)}function XO$1(e$,t$){e$.addresses||(e$.addresses=[]);const r$=function(a$,c$){if(XA$1("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return a$.map(d$=>{let{ip:h$,port:p$}=d$;return{address:"".concat(h$,":").concat(p$)}});const u$=XA$1("GATEWAY_DOMAINS");let l$=u$[1]&&Dn$1(c$).call(c$,u$[1])?1:0;return a$.map(d$=>{let{domain_prefix:h$,port:p$,ip:_$}=d$;if(h$)return{address:"".concat(h$,".").concat(u$[l$++%u$.length],":").concat(p$)};const f$=/^[\.\:\d]+$/.test(_$),m$=f$?"".concat(_$.replace(/[^\d]/g,"-"),".").concat(u$[l$++%u$.length],":").concat(p$):"".concat(_$,":").concat(p$);return f$||fb$1.info("Unidentified as ip: ".concat(_$,", use as host")),{ip:_$,port:p$,address:m$}})}(e$.addresses,t$),n$=Array.isArray(e$.detail)&&e$.detail[18];if(n$&&typeof n$=="string"){const a$=n$.split(";");for(let c$=0;c$<a$.length;c$++){var i$;const u$=jp$1(i$=a$[c$]).call(i$);r$[c$]&&u$&&(r$[c$].ip6=u$)}}const o$=e$.detail&&e$.detail.candidate;let s$;if(o$){const[a$,c$]=o$.split(":");a$&&c$&&(s$={port:Number(c$),ip:a$,address:"".concat(a$,":").concat(c$)})}return{gatewayAddrs:r$,apGatewayAddress:s$,uid:e$.uid,cid:e$.cid,cert:e$.cert,vid:e$.detail&&e$.detail[8],uni_lbs_ip:e$.detail&&e$.detail[1],res:e$,csIp:e$.detail&&e$.detail[502]}}function QO$1(e$){return typeof e$=="number"?e$:e$.exact||e$.ideal||e$.max||e$.min||0}function ZO$1(e$){const t$=e$._encoderConfig;if(!t$)return{};const r$={resolution:t$.width&&t$.height?"".concat(QO$1(t$.width),"x").concat(QO$1(t$.height)):void 0,maxVideoBW:t$.bitrateMax,minVideoBW:t$.bitrateMin};return typeof t$.frameRate=="number"?(r$.maxFrameRate=t$.frameRate,r$.minFrameRate=t$.frameRate):t$.frameRate&&(r$.maxFrameRate=t$.frameRate.max||t$.frameRate.ideal||t$.frameRate.exact||t$.frameRate.min,r$.minFrameRate=t$.frameRate.min||t$.frameRate.ideal||t$.frameRate.exact||t$.frameRate.max),r$}function $O(e$){return e$>=0&&e$<.17?1:e$>=.17&&e$<.36?2:e$>=.36&&e$<.59?3:e$>=.59&&e$<=1?4:e$>1?5:0}function eN$1(e$,t$){let r$,n$,i$;switch(t$){case YO$1.CHOOSE_SERVER:n$=4096,i$="choose server";break;case YO$1.CLOUD_PROXY:n$=1048576,i$="proxy";break;case YO$1.CLOUD_PROXY_5:n$=4194304,i$="proxy5";break;case YO$1.CLOUD_PROXY_FALLBACK:n$=4194310,i$="proxy fallback";break;default:throw new yb$1(Ry$1.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e$.detail&&e$.detail[502],retry:!1})}if(e$.response_body.forEach(o$=>{o$.buffer&&o$.buffer.flag===n$&&(r$={code:o$.buffer.code,addresses:(o$.buffer.edges_services||[]).map(s$=>zO$1(zO$1({},s$),{},{ticket:o$.buffer.cert})),server_ts:e$.enter_ts,uid:o$.buffer.uid,cid:o$.buffer.cid,cname:o$.buffer.cname,detail:zO$1(zO$1({},o$.buffer.detail),e$.detail),flag:o$.buffer.flag,opid:e$.opid,cert:o$.buffer.cert})}),!r$)throw new yb$1(Ry$1.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i$," from multi unilbs response"),{csIp:e$.detail&&e$.detail[502]});return r$}async function tN$1(e$,t$){return await Gh$1.all(e$.addresses.map(async r$=>({address:JO$1(r$.ip),tcpport:r$.port,udpport:r$.port,username:t$&&XA$1("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t$.toString():KA$1.username,password:t$&&XA$1("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Uy$1(t$.toString()):KA$1.password})))}function iN$1(e$,t$){const r$=t$.getMediaStreamTrack(!0).getSettings(),n$=t$.videoHeight||r$.height,i$=t$.videoWidth||r$.width;return n$&&i$?Math.max(Math.min(n$,i$)/Math.min(QO$1(e$.height),QO$1(e$.width)),1):(fb$1.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function nN$1(e$){let{candidateType:t$,relayProtocol:r$,type:n$,address:i$,port:o$,protocol:s$}=e$;return n$==="local-candidate"?{candidateType:t$,relayProtocol:r$,protocol:s$}:{candidateType:t$,relayProtocol:r$,address:i$,port:o$,protocol:s$}}var rN$1,oN$1=i(ew$1),sN$1=Xi$1("Array").values,aN$1=pn$1,cN=Ze,dN=l,lN=sN$1,uN=Array.prototype,hN={DOMTokenList:!0,NodeList:!0},pN$1=function(e$){var t$=e$.values;return e$===uN||dN(uN,e$)&&t$===uN.values||cN(hN,aN$1(e$))?lN:t$},_N=i(pN$1),EN=N$1,fN=d,mN=L,TN=n,SN=eo$1,gN=Br$1,RN=k,CN=Je$1,IN=K$1,vN=Object.assign,yN$1=Object.defineProperty,AN$1=fN([].concat),bN$1=!vN||TN(function(){if(EN&&vN({b:1},vN(yN$1({},"a",{enumerable:!0,get:function(){yN$1(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e$={},t$={},r$=Symbol(),n$="abcdefghijklmnopqrst";return e$[r$]=7,n$.split("").forEach(function(i$){t$[i$]=i$}),vN({},e$)[r$]!=7||SN(vN({},t$)).join("")!=n$})?function(e$,t$){for(var r$=CN(e$),n$=arguments.length,i$=1,o$=gN.f,s$=RN.f;n$>i$;)for(var a$,c$=IN(arguments[i$++]),u$=o$?AN$1(SN(c$),o$(c$)):SN(c$),l$=u$.length,d$=0;l$>d$;)a$=u$[d$++],EN&&!mN(s$,c$,a$)||(r$[a$]=c$[a$]);return r$}:vN,wN$1=ii$1,ON$1=rs,NN$1=Xt$1,DN$1=L,PN$1=Je$1,LN$1=function(e$,t$,r$,n$){try{return n$?t$(wN$1(r$)[0],r$[1]):t$(r$)}catch(i$){ON$1(e$,"throw",i$)}},kN$1=jo$1,MN$1=jc$1,UN$1=Gi$1,xN$1=E_$1,VN$1=es$1,FN$1=qo$1,BN$1=Array,jN$1=d,GN$1=2147483647,WN$1=/[^\0-\u007E]/,HN$1=/[.\u3002\uFF0E\uFF61]/g,KN$1="Overflow: input needs wider integers to process",YN$1=RangeError,qN$1=jN$1(HN$1.exec),zN$1=Math.floor,JN$1=String.fromCharCode,XN$1=jN$1("".charCodeAt),QN$1=jN$1([].join),ZN$1=jN$1([].push),$N$1=jN$1("".replace),eD$1=jN$1("".split),tD$1=jN$1("".toLowerCase),iD$1=function(e$){return e$+22+75*(e$<26)},nD$1=function(e$,t$,r$){var n$=0;for(e$=r$?zN$1(e$/700):e$>>1,e$+=zN$1(e$/t$);e$>455;)e$=zN$1(e$/35),n$+=36;return zN$1(n$+36*e$/(e$+38))},rD$1=function(e$){var t$=[];e$=function(g$){for(var v$=[],y$=0,S$=g$.length;y$<S$;){var b$=XN$1(g$,y$++);if(b$>=55296&&b$<=56319&&y$<S$){var $$=XN$1(g$,y$++);(64512&$$)==56320?ZN$1(v$,((1023&b$)<<10)+(1023&$$)+65536):(ZN$1(v$,b$),y$--)}else ZN$1(v$,b$)}return v$}(e$);var r$,n$,i$=e$.length,o$=128,s$=0,a$=72;for(r$=0;r$<e$.length;r$++)(n$=e$[r$])<128&&ZN$1(t$,JN$1(n$));var c$=t$.length,u$=c$;for(c$&&ZN$1(t$,"-");u$<i$;){var l$=GN$1;for(r$=0;r$<e$.length;r$++)(n$=e$[r$])>=o$&&n$<l$&&(l$=n$);var d$=u$+1;if(l$-o$>zN$1((GN$1-s$)/d$))throw YN$1(KN$1);for(s$+=(l$-o$)*d$,o$=l$,r$=0;r$<e$.length;r$++){if((n$=e$[r$])<o$&&++s$>GN$1)throw YN$1(KN$1);if(n$==o$){for(var h$=s$,p$=36;;){var _$=p$<=a$?1:p$>=a$+26?26:p$-a$;if(h$<_$)break;var f$=h$-_$,m$=36-_$;ZN$1(t$,JN$1(iD$1(_$+f$%m$))),h$=zN$1(f$/m$),p$+=36}ZN$1(t$,JN$1(iD$1(h$))),a$=nD$1(s$,d$,u$==c$),s$=0,u$++}}s$++,o$++}return QN$1(t$,"")},oD$1=wi$1,sD$1=N$1,aD$1=Gg$1,cD$1=h,dD$1=Xt$1,lD$1=d,uD$1=ha$1,hD$1=hc$1,pD$1=Sc$1,_D$1=Ze,ED$1=bN$1,fD$1=function(e$){var t$=PN$1(e$),r$=MN$1(this),n$=arguments.length,i$=n$>1?arguments[1]:void 0,o$=i$!==void 0;o$&&(i$=NN$1(i$,n$>2?arguments[2]:void 0));var s$,a$,c$,u$,l$,d$,h$=FN$1(t$),p$=0;if(!h$||this===BN$1&&kN$1(h$))for(s$=UN$1(t$),a$=r$?new this(s$):BN$1(s$);s$>p$;p$++)d$=o$?i$(t$[p$],p$):t$[p$],xN$1(a$,p$,d$);else for(l$=(u$=VN$1(t$,h$)).next,a$=r$?new this:[];!(c$=DN$1(l$,u$)).done;p$++)d$=o$?LN$1(u$,i$,[c$.value,p$],!0):c$.value,xN$1(a$,p$,d$);return a$.length=p$,a$},mD$1=R_$1,TD$1=Ch$1.codeAt,SD$1=function(e$){var t$,r$,n$=[],i$=eD$1($N$1(tD$1(e$),HN$1,"."),".");for(t$=0;t$<i$.length;t$++)r$=i$[t$],ZN$1(n$,qN$1(WN$1,r$)?"xn--"+rD$1(r$):r$);return QN$1(n$,".")},gD$1=fn,RD$1=Da$1,CD$1=Zc$1,ID$1=rC$1,vD$1=ra$1,yD$1=vD$1.set,AD$1=vD$1.getterFor("URL"),bD$1=ID$1.URLSearchParams,wD$1=ID$1.getState,OD$1=cD$1.URL,ND$1=cD$1.TypeError,DD$1=cD$1.parseInt,PD$1=Math.floor,LD$1=Math.pow,kD$1=lD$1("".charAt),MD$1=lD$1(/./.exec),UD$1=lD$1([].join),xD$1=lD$1(1 .toString),VD$1=lD$1([].pop),FD$1=lD$1([].push),BD$1=lD$1("".replace),jD$1=lD$1([].shift),GD$1=lD$1("".split),WD$1=lD$1("".slice),HD$1=lD$1("".toLowerCase),KD$1=lD$1([].unshift),YD$1="Invalid scheme",qD$1="Invalid host",zD$1="Invalid port",JD$1=/[a-z]/i,XD$1=/[\d+-.a-z]/i,QD$1=/\d/,ZD$1=/^0x/i,$D$1=/^[0-7]+$/,eP$1=/^\d+$/,tP$1=/^[\da-f]+$/i,iP$1=/[\0\t\n\r #%/:<>?@[\\\]^|]/,nP$1=/[\0\t\n\r #/:<>?@[\\\]^|]/,rP$1=/^[\u0000-\u0020]+/,oP$1=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,sP$1=/[\t\n\r]/g,aP$1=function(e$){var t$,r$,n$,i$;if(typeof e$=="number"){for(t$=[],r$=0;r$<4;r$++)KD$1(t$,e$%256),e$=PD$1(e$/256);return UD$1(t$,".")}if(typeof e$=="object"){for(t$="",n$=function(o$){for(var s$=null,a$=1,c$=null,u$=0,l$=0;l$<8;l$++)o$[l$]!==0?(u$>a$&&(s$=c$,a$=u$),c$=null,u$=0):(c$===null&&(c$=l$),++u$);return u$>a$&&(s$=c$,a$=u$),s$}(e$),r$=0;r$<8;r$++)i$&&e$[r$]===0||(i$&&(i$=!1),n$===r$?(t$+=r$?":":"::",i$=!0):(t$+=xD$1(e$[r$],16),r$<7&&(t$+=":")));return"["+t$+"]"}return e$},cP$1={},dP$1=ED$1({},cP$1,{" ":1,'"':1,"<":1,">":1,"`":1}),lP$1=ED$1({},dP$1,{"#":1,"?":1,"{":1,"}":1}),uP$1=ED$1({},lP$1,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),hP$1=function(e$,t$){var r$=TD$1(e$,0);return r$>32&&r$<127&&!_D$1(t$,e$)?e$:encodeURIComponent(e$)},pP$1={ftp:21,file:null,http:80,https:443,ws:80,wss:443},_P$1=function(e$,t$){var r$;return e$.length==2&&MD$1(JD$1,kD$1(e$,0))&&((r$=kD$1(e$,1))==":"||!t$&&r$=="|")},EP$1=function(e$){var t$;return e$.length>1&&_P$1(WD$1(e$,0,2))&&(e$.length==2||(t$=kD$1(e$,2))==="/"||t$==="\\"||t$==="?"||t$==="#")},fP$1=function(e$){return e$==="."||HD$1(e$)==="%2e"},mP$1={},TP$1={},SP$1={},gP$1={},RP$1={},CP$1={},IP$1={},vP$1={},yP$1={},AP$1={},bP$1={},wP$1={},OP$1={},NP$1={},DP$1={},PP$1={},LP$1={},kP$1={},MP$1={},UP$1={},xP$1={},VP$1=function(e$,t$,r$){var n$,i$,o$,s$=gD$1(e$);if(t$){if(i$=this.parse(s$))throw ND$1(i$);this.searchParams=null}else{if(r$!==void 0&&(n$=new VP$1(r$,!0)),i$=this.parse(s$,null,n$))throw ND$1(i$);(o$=wD$1(new bD$1)).bindURL(this),this.searchParams=o$}};VP$1.prototype={type:"URL",parse:function(e$,t$,r$){var n$,i$,o$,s$,a$,c$=this,u$=t$||mP$1,l$=0,d$="",h$=!1,p$=!1,_$=!1;for(e$=gD$1(e$),t$||(c$.scheme="",c$.username="",c$.password="",c$.host=null,c$.port=null,c$.path=[],c$.query=null,c$.fragment=null,c$.cannotBeABaseURL=!1,e$=BD$1(e$,rP$1,""),e$=BD$1(e$,oP$1,"$1")),e$=BD$1(e$,sP$1,""),n$=fD$1(e$);l$<=n$.length;){switch(i$=n$[l$],u$){case mP$1:if(!i$||!MD$1(JD$1,i$)){if(t$)return YD$1;u$=SP$1;continue}d$+=HD$1(i$),u$=TP$1;break;case TP$1:if(i$&&(MD$1(XD$1,i$)||i$=="+"||i$=="-"||i$=="."))d$+=HD$1(i$);else{if(i$!=":"){if(t$)return YD$1;d$="",u$=SP$1,l$=0;continue}if(t$&&(c$.isSpecial()!=_D$1(pP$1,d$)||d$=="file"&&(c$.includesCredentials()||c$.port!==null)||c$.scheme=="file"&&!c$.host))return;if(c$.scheme=d$,t$)return void(c$.isSpecial()&&pP$1[c$.scheme]==c$.port&&(c$.port=null));d$="",c$.scheme=="file"?u$=NP$1:c$.isSpecial()&&r$&&r$.scheme==c$.scheme?u$=gP$1:c$.isSpecial()?u$=vP$1:n$[l$+1]=="/"?(u$=RP$1,l$++):(c$.cannotBeABaseURL=!0,FD$1(c$.path,""),u$=MP$1)}break;case SP$1:if(!r$||r$.cannotBeABaseURL&&i$!="#")return YD$1;if(r$.cannotBeABaseURL&&i$=="#"){c$.scheme=r$.scheme,c$.path=mD$1(r$.path),c$.query=r$.query,c$.fragment="",c$.cannotBeABaseURL=!0,u$=xP$1;break}u$=r$.scheme=="file"?NP$1:CP$1;continue;case gP$1:if(i$!="/"||n$[l$+1]!="/"){u$=CP$1;continue}u$=yP$1,l$++;break;case RP$1:if(i$=="/"){u$=AP$1;break}u$=kP$1;continue;case CP$1:if(c$.scheme=r$.scheme,i$==rN$1)c$.username=r$.username,c$.password=r$.password,c$.host=r$.host,c$.port=r$.port,c$.path=mD$1(r$.path),c$.query=r$.query;else if(i$=="/"||i$=="\\"&&c$.isSpecial())u$=IP$1;else if(i$=="?")c$.username=r$.username,c$.password=r$.password,c$.host=r$.host,c$.port=r$.port,c$.path=mD$1(r$.path),c$.query="",u$=UP$1;else{if(i$!="#"){c$.username=r$.username,c$.password=r$.password,c$.host=r$.host,c$.port=r$.port,c$.path=mD$1(r$.path),c$.path.length--,u$=kP$1;continue}c$.username=r$.username,c$.password=r$.password,c$.host=r$.host,c$.port=r$.port,c$.path=mD$1(r$.path),c$.query=r$.query,c$.fragment="",u$=xP$1}break;case IP$1:if(!c$.isSpecial()||i$!="/"&&i$!="\\"){if(i$!="/"){c$.username=r$.username,c$.password=r$.password,c$.host=r$.host,c$.port=r$.port,u$=kP$1;continue}u$=AP$1}else u$=yP$1;break;case vP$1:if(u$=yP$1,i$!="/"||kD$1(d$,l$+1)!="/")continue;l$++;break;case yP$1:if(i$!="/"&&i$!="\\"){u$=AP$1;continue}break;case AP$1:if(i$=="@"){h$&&(d$="%40"+d$),h$=!0,o$=fD$1(d$);for(var f$=0;f$<o$.length;f$++){var m$=o$[f$];if(m$!=":"||_$){var g$=hP$1(m$,uP$1);_$?c$.password+=g$:c$.username+=g$}else _$=!0}d$=""}else if(i$==rN$1||i$=="/"||i$=="?"||i$=="#"||i$=="\\"&&c$.isSpecial()){if(h$&&d$=="")return"Invalid authority";l$-=fD$1(d$).length+1,d$="",u$=bP$1}else d$+=i$;break;case bP$1:case wP$1:if(t$&&c$.scheme=="file"){u$=PP$1;continue}if(i$!=":"||p$){if(i$==rN$1||i$=="/"||i$=="?"||i$=="#"||i$=="\\"&&c$.isSpecial()){if(c$.isSpecial()&&d$=="")return qD$1;if(t$&&d$==""&&(c$.includesCredentials()||c$.port!==null))return;if(s$=c$.parseHost(d$))return s$;if(d$="",u$=LP$1,t$)return;continue}i$=="["?p$=!0:i$=="]"&&(p$=!1),d$+=i$}else{if(d$=="")return qD$1;if(s$=c$.parseHost(d$))return s$;if(d$="",u$=OP$1,t$==wP$1)return}break;case OP$1:if(!MD$1(QD$1,i$)){if(i$==rN$1||i$=="/"||i$=="?"||i$=="#"||i$=="\\"&&c$.isSpecial()||t$){if(d$!=""){var v$=DD$1(d$,10);if(v$>65535)return zD$1;c$.port=c$.isSpecial()&&v$===pP$1[c$.scheme]?null:v$,d$=""}if(t$)return;u$=LP$1;continue}return zD$1}d$+=i$;break;case NP$1:if(c$.scheme="file",i$=="/"||i$=="\\")u$=DP$1;else{if(!r$||r$.scheme!="file"){u$=kP$1;continue}if(i$==rN$1)c$.host=r$.host,c$.path=mD$1(r$.path),c$.query=r$.query;else if(i$=="?")c$.host=r$.host,c$.path=mD$1(r$.path),c$.query="",u$=UP$1;else{if(i$!="#"){EP$1(UD$1(mD$1(n$,l$),""))||(c$.host=r$.host,c$.path=mD$1(r$.path),c$.shortenPath()),u$=kP$1;continue}c$.host=r$.host,c$.path=mD$1(r$.path),c$.query=r$.query,c$.fragment="",u$=xP$1}}break;case DP$1:if(i$=="/"||i$=="\\"){u$=PP$1;break}r$&&r$.scheme=="file"&&!EP$1(UD$1(mD$1(n$,l$),""))&&(_P$1(r$.path[0],!0)?FD$1(c$.path,r$.path[0]):c$.host=r$.host),u$=kP$1;continue;case PP$1:if(i$==rN$1||i$=="/"||i$=="\\"||i$=="?"||i$=="#"){if(!t$&&_P$1(d$))u$=kP$1;else if(d$==""){if(c$.host="",t$)return;u$=LP$1}else{if(s$=c$.parseHost(d$))return s$;if(c$.host=="localhost"&&(c$.host=""),t$)return;d$="",u$=LP$1}continue}d$+=i$;break;case LP$1:if(c$.isSpecial()){if(u$=kP$1,i$!="/"&&i$!="\\")continue}else if(t$||i$!="?")if(t$||i$!="#"){if(i$!=rN$1&&(u$=kP$1,i$!="/"))continue}else c$.fragment="",u$=xP$1;else c$.query="",u$=UP$1;break;case kP$1:if(i$==rN$1||i$=="/"||i$=="\\"&&c$.isSpecial()||!t$&&(i$=="?"||i$=="#")){if((a$=HD$1(a$=d$))===".."||a$==="%2e."||a$===".%2e"||a$==="%2e%2e"?(c$.shortenPath(),i$=="/"||i$=="\\"&&c$.isSpecial()||FD$1(c$.path,"")):fP$1(d$)?i$=="/"||i$=="\\"&&c$.isSpecial()||FD$1(c$.path,""):(c$.scheme=="file"&&!c$.path.length&&_P$1(d$)&&(c$.host&&(c$.host=""),d$=kD$1(d$,0)+":"),FD$1(c$.path,d$)),d$="",c$.scheme=="file"&&(i$==rN$1||i$=="?"||i$=="#"))for(;c$.path.length>1&&c$.path[0]==="";)jD$1(c$.path);i$=="?"?(c$.query="",u$=UP$1):i$=="#"&&(c$.fragment="",u$=xP$1)}else d$+=hP$1(i$,lP$1);break;case MP$1:i$=="?"?(c$.query="",u$=UP$1):i$=="#"?(c$.fragment="",u$=xP$1):i$!=rN$1&&(c$.path[0]+=hP$1(i$,cP$1));break;case UP$1:t$||i$!="#"?i$!=rN$1&&(i$=="'"&&c$.isSpecial()?c$.query+="%27":c$.query+=i$=="#"?"%23":hP$1(i$,cP$1)):(c$.fragment="",u$=xP$1);break;case xP$1:i$!=rN$1&&(c$.fragment+=hP$1(i$,dP$1))}l$++}},parseHost:function(e$){var t$,r$,n$;if(kD$1(e$,0)=="["){if(kD$1(e$,e$.length-1)!="]"||(t$=function(i$){var o$,s$,a$,c$,u$,l$,d$,h$=[0,0,0,0,0,0,0,0],p$=0,_$=null,f$=0,m$=function(){return kD$1(i$,f$)};if(m$()==":"){if(kD$1(i$,1)!=":")return;f$+=2,_$=++p$}for(;m$();){if(p$==8)return;if(m$()!=":"){for(o$=s$=0;s$<4&&MD$1(tP$1,m$());)o$=16*o$+DD$1(m$(),16),f$++,s$++;if(m$()=="."){if(s$==0||(f$-=s$,p$>6))return;for(a$=0;m$();){if(c$=null,a$>0){if(!(m$()=="."&&a$<4))return;f$++}if(!MD$1(QD$1,m$()))return;for(;MD$1(QD$1,m$());){if(u$=DD$1(m$(),10),c$===null)c$=u$;else{if(c$==0)return;c$=10*c$+u$}if(c$>255)return;f$++}h$[p$]=256*h$[p$]+c$,++a$!=2&&a$!=4||p$++}if(a$!=4)return;break}if(m$()==":"){if(f$++,!m$())return}else if(m$())return;h$[p$++]=o$}else{if(_$!==null)return;f$++,_$=++p$}}if(_$!==null)for(l$=p$-_$,p$=7;p$!=0&&l$>0;)d$=h$[p$],h$[p$--]=h$[_$+l$-1],h$[_$+--l$]=d$;else if(p$!=8)return;return h$}(WD$1(e$,1,-1)),!t$))return qD$1;this.host=t$}else if(this.isSpecial()){if(e$=SD$1(e$),MD$1(iP$1,e$)||(t$=function(i$){var o$,s$,a$,c$,u$,l$,d$,h$=GD$1(i$,".");if(h$.length&&h$[h$.length-1]==""&&h$.length--,(o$=h$.length)>4)return i$;for(s$=[],a$=0;a$<o$;a$++){if((c$=h$[a$])=="")return i$;if(u$=10,c$.length>1&&kD$1(c$,0)=="0"&&(u$=MD$1(ZD$1,c$)?16:8,c$=WD$1(c$,u$==8?1:2)),c$==="")l$=0;else{if(!MD$1(u$==10?eP$1:u$==8?$D$1:tP$1,c$))return i$;l$=DD$1(c$,u$)}FD$1(s$,l$)}for(a$=0;a$<o$;a$++)if(l$=s$[a$],a$==o$-1){if(l$>=LD$1(256,5-o$))return null}else if(l$>255)return null;for(d$=VD$1(s$),a$=0;a$<s$.length;a$++)d$+=s$[a$]*LD$1(256,3-a$);return d$}(e$),t$===null))return qD$1;this.host=t$}else{if(MD$1(nP$1,e$))return qD$1;for(t$="",r$=fD$1(e$),n$=0;n$<r$.length;n$++)t$+=hP$1(r$[n$],cP$1);this.host=t$}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return _D$1(pP$1,this.scheme)},shortenPath:function(){var e$=this.path,t$=e$.length;!t$||this.scheme=="file"&&t$==1&&_P$1(e$[0],!0)||e$.length--},serialize:function(){var e$=this,t$=e$.scheme,r$=e$.username,n$=e$.password,i$=e$.host,o$=e$.port,s$=e$.path,a$=e$.query,c$=e$.fragment,u$=t$+":";return i$!==null?(u$+="//",e$.includesCredentials()&&(u$+=r$+(n$?":"+n$:"")+"@"),u$+=aP$1(i$),o$!==null&&(u$+=":"+o$)):t$=="file"&&(u$+="//"),u$+=e$.cannotBeABaseURL?s$[0]:s$.length?"/"+UD$1(s$,"/"):"",a$!==null&&(u$+="?"+a$),c$!==null&&(u$+="#"+c$),u$},setHref:function(e$){var t$=this.parse(e$);if(t$)throw ND$1(t$);this.searchParams.update()},getOrigin:function(){var e$=this.scheme,t$=this.port;if(e$=="blob")try{return new FP$1(e$.path[0]).origin}catch{return"null"}return e$!="file"&&this.isSpecial()?e$+"://"+aP$1(this.host)+(t$!==null?":"+t$:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e$){this.parse(gD$1(e$)+":",mP$1)},getUsername:function(){return this.username},setUsername:function(e$){var t$=fD$1(gD$1(e$));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r$=0;r$<t$.length;r$++)this.username+=hP$1(t$[r$],uP$1)}},getPassword:function(){return this.password},setPassword:function(e$){var t$=fD$1(gD$1(e$));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r$=0;r$<t$.length;r$++)this.password+=hP$1(t$[r$],uP$1)}},getHost:function(){var e$=this.host,t$=this.port;return e$===null?"":t$===null?aP$1(e$):aP$1(e$)+":"+t$},setHost:function(e$){this.cannotBeABaseURL||this.parse(e$,bP$1)},getHostname:function(){var e$=this.host;return e$===null?"":aP$1(e$)},setHostname:function(e$){this.cannotBeABaseURL||this.parse(e$,wP$1)},getPort:function(){var e$=this.port;return e$===null?"":gD$1(e$)},setPort:function(e$){this.cannotHaveUsernamePasswordPort()||((e$=gD$1(e$))==""?this.port=null:this.parse(e$,OP$1))},getPathname:function(){var e$=this.path;return this.cannotBeABaseURL?e$[0]:e$.length?"/"+UD$1(e$,"/"):""},setPathname:function(e$){this.cannotBeABaseURL||(this.path=[],this.parse(e$,LP$1))},getSearch:function(){var e$=this.query;return e$?"?"+e$:""},setSearch:function(e$){(e$=gD$1(e$))==""?this.query=null:(kD$1(e$,0)=="?"&&(e$=WD$1(e$,1)),this.query="",this.parse(e$,UP$1)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e$=this.fragment;return e$?"#"+e$:""},setHash:function(e$){(e$=gD$1(e$))!=""?(kD$1(e$,0)=="#"&&(e$=WD$1(e$,1)),this.fragment="",this.parse(e$,xP$1)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var FP$1=function(e$){var t$=pD$1(this,BP$1),r$=CD$1(arguments.length,1)>1?arguments[1]:void 0,n$=yD$1(t$,new VP$1(e$,!1,r$));sD$1||(t$.href=n$.serialize(),t$.origin=n$.getOrigin(),t$.protocol=n$.getProtocol(),t$.username=n$.getUsername(),t$.password=n$.getPassword(),t$.host=n$.getHost(),t$.hostname=n$.getHostname(),t$.port=n$.getPort(),t$.pathname=n$.getPathname(),t$.search=n$.getSearch(),t$.searchParams=n$.getSearchParams(),t$.hash=n$.getHash())},BP$1=FP$1.prototype,jP$1=function(e$,t$){return{get:function(){return AD$1(this)[e$]()},set:t$&&function(r$){return AD$1(this)[t$](r$)},configurable:!0,enumerable:!0}};if(sD$1&&(hD$1(BP$1,"href",jP$1("serialize","setHref")),hD$1(BP$1,"origin",jP$1("getOrigin")),hD$1(BP$1,"protocol",jP$1("getProtocol","setProtocol")),hD$1(BP$1,"username",jP$1("getUsername","setUsername")),hD$1(BP$1,"password",jP$1("getPassword","setPassword")),hD$1(BP$1,"host",jP$1("getHost","setHost")),hD$1(BP$1,"hostname",jP$1("getHostname","setHostname")),hD$1(BP$1,"port",jP$1("getPort","setPort")),hD$1(BP$1,"pathname",jP$1("getPathname","setPathname")),hD$1(BP$1,"search",jP$1("getSearch","setSearch")),hD$1(BP$1,"searchParams",jP$1("getSearchParams")),hD$1(BP$1,"hash",jP$1("getHash","setHash"))),uD$1(BP$1,"toJSON",function(){return AD$1(this).serialize()},{enumerable:!0}),uD$1(BP$1,"toString",function(){return AD$1(this).serialize()},{enumerable:!0}),OD$1){var GP$1=OD$1.createObjectURL,WP$1=OD$1.revokeObjectURL;GP$1&&uD$1(FP$1,"createObjectURL",dD$1(GP$1,OD$1)),WP$1&&uD$1(FP$1,"revokeObjectURL",dD$1(WP$1,OD$1))}RD$1(FP$1,"URL"),oD$1({global:!0,constructor:!0,forced:!aD$1,sham:!sD$1},{URL:FP$1});var HP$1=wi$1,KP$1=n,YP$1=Zc$1,qP$1=fn,zP$1=Gg$1,JP$1=ae$1("URL");HP$1({target:"URL",stat:!0,forced:!(zP$1&&KP$1(function(){JP$1.canParse()}))},{canParse:function(e$){var t$=YP$1(arguments.length,1),r$=qP$1(e$),n$=t$<2||arguments[1]===void 0?void 0:qP$1(arguments[1]);try{return!!new JP$1(r$,n$)}catch{return!1}}});var XP$1=i(ie$1.URL);const QP$1={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function ZP$1(){return QP$1}function $P$1(){return"setSinkId"in HTMLAudioElement.prototype&&(!XA$1("RESTRICTION_SET_PLAYBACK_DEVICE")||(Jv$1()||Qv$1())&&!_y$1())}function eL$1(){return!QP$1.supportUnifiedPlan||XA$1("CHROME_FORCE_PLAN_B")&&Ey$1()}let tL$1=function(e$){return e$.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e$.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e$.IOS_INTERRUPTION_START="ios-interruption-start",e$.IOS_INTERRUPTION_END="ios-interruption-end",e$.STATE_CHANGE="state-change",e$}({});function iL$1(e$,t$,r$){return{sampleRate:e$,stereo:t$,bitrate:r$}}function nL$1(e$,t$,r$,n$,i$){return{width:e$,height:t$,frameRate:r$,bitrateMin:n$,bitrateMax:i$}}function rL$1(e$,t$,r$,n$,i$){return{width:{max:e$},height:{max:t$},frameRate:r$,bitrateMin:n$,bitrateMax:i$}}function oL$1(e$,t$){return{numSpatialLayers:e$,numTemporalLayers:t$}}const sL$1={"90p":nL$1(160,90),"90p_1":nL$1(160,90),"120p":nL$1(160,120,15,30,65),"120p_1":nL$1(160,120,15,30,65),"120p_3":nL$1(120,120,15,30,50),"120p_4":nL$1(212,120),"180p":nL$1(320,180,15,30,140),"180p_1":nL$1(320,180,15,30,140),"180p_3":nL$1(180,180,15,30,100),"180p_4":nL$1(240,180,15,30,120),"240p":nL$1(320,240,15,40,200),"240p_1":nL$1(320,240,15,40,200),"240p_3":nL$1(240,240,15,40,140),"240p_4":nL$1(424,240,15,40,220),"360p":nL$1(640,360,15,80,400),"360p_1":nL$1(640,360,15,80,400),"360p_3":nL$1(360,360,15,80,260),"360p_4":nL$1(640,360,30,80,600),"360p_6":nL$1(360,360,30,80,400),"360p_7":nL$1(480,360,15,80,320),"360p_8":nL$1(480,360,30,80,490),"360p_9":nL$1(640,360,15,80,800),"360p_10":nL$1(640,360,24,80,800),"360p_11":nL$1(640,360,24,80,1e3),"480p":nL$1(640,480,15,100,500),"480p_1":nL$1(640,480,15,100,500),"480p_2":nL$1(640,480,30,100,1e3),"480p_3":nL$1(480,480,15,100,400),"480p_4":nL$1(640,480,30,100,750),"480p_6":nL$1(480,480,30,100,600),"480p_8":nL$1(848,480,15,100,610),"480p_9":nL$1(848,480,30,100,930),"480p_10":nL$1(640,480,10,100,400),"720p":nL$1(1280,720,15,120,1130),"720p_auto":nL$1(1280,720,30,900,3e3),"720p_1":nL$1(1280,720,15,120,1130),"720p_2":nL$1(1280,720,30,120,2e3),"720p_3":nL$1(1280,720,30,120,1710),"720p_5":nL$1(960,720,15,120,910),"720p_6":nL$1(960,720,30,120,1380),"1080p":nL$1(1920,1080,15,120,2080),"1080p_1":nL$1(1920,1080,15,120,2080),"1080p_2":nL$1(1920,1080,30,120,3e3),"1080p_3":nL$1(1920,1080,30,120,3150),"1080p_5":nL$1(1920,1080,60,120,4780),"1440p":nL$1(2560,1440,30,120,4850),"1440p_1":nL$1(2560,1440,30,120,4850),"1440p_2":nL$1(2560,1440,60,120,7350),"4k":nL$1(3840,2160,30,120,8910),"4k_1":nL$1(3840,2160,30,120,8910),"4k_3":nL$1(3840,2160,60,120,13500)},aL$1={"480p":rL$1(640,480,5),"480p_1":rL$1(640,480,5),"480p_2":rL$1(640,480,30),"480p_3":rL$1(640,480,15),"720p":rL$1(1280,720,5),"720p_auto":nL$1(1280,720,30,900,3e3),"720p_1":rL$1(1280,720,5),"720p_2":rL$1(1280,720,30),"720p_3":rL$1(1280,720,15),"1080p":rL$1(1920,1080,5),"1080p_1":rL$1(1920,1080,5),"1080p_2":rL$1(1920,1080,30),"1080p_3":rL$1(1920,1080,15)},cL$1={"1SL1TL":oL$1(1,1),"3SL3TL":oL$1(3,3),"2SL3TL":oL$1(2,3)};function dL$1(e$){return e$||(e$="480p_1"),typeof e$=="string"?Object.assign({},sL$1[e$]):e$}function lL$1(e$){return typeof e$=="string"?Object.assign({},aL$1[e$]):e$}function uL$1(e$){return typeof e$=="string"?Object.assign({},cL$1[e$]):e$}const hL$1={speech_low_quality:iL$1(16e3,!1),speech_standard:iL$1(32e3,!1,18),music_standard:iL$1(48e3,!1),standard_stereo:iL$1(48e3,!0,56),high_quality:iL$1(48e3,!1,128),high_quality_stereo:iL$1(48e3,!0,192)};function pL$1(e$){return typeof e$=="string"?Object.assign({},hL$1[e$]):e$}const _L$1=[];function EL$1(e$){return vy$1(e$,"mediaSource",["screen","window","application"]),!0}let fL$1=function(e$){return e$.NEED_RENEGOTIATE="@need_renegotiate",e$.NEED_REPLACE_TRACK="@need_replace_track",e$.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e$.NEED_CLOSE="@need_close",e$.NEED_ENABLE_TRACK="@need_enable_track",e$.NEED_DISABLE_TRACK="@need_disable_track",e$.NEED_SESSION_ID="@need_sid",e$.SET_OPTIMIZATION_MODE="@set_optimization_mode",e$.GET_STATS="@get_stats",e$.GET_RTC_STATS="@get_rtc_stats",e$.GET_LOW_VIDEO_TRACK="@get_low_video_track",e$.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e$.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e$.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e$.NEED_MUTE_TRACK="@need_mute_track",e$.NEED_UNMUTE_TRACK="@need_unmute_track",e$}({}),mL$1=function(e$){return e$.SCREEN_TRACK="screen_track",e$.CUSTOM_TRACK="custome_track",e$.LOW_STREAM="low_stream",e$.SCREEN_LOW_TRACK="screen_low_track",e$}({}),TL$1=function(e$){return e$[e$.HIGH_STREAM=0]="HIGH_STREAM",e$[e$.LOW_STREAM=1]="LOW_STREAM",e$}({}),SL$1=function(e$){return e$[e$.HIGH_STREAM=0]="HIGH_STREAM",e$[e$.LOW_STREAM=1]="LOW_STREAM",e$[e$.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e$[e$.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e$[e$.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e$[e$.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e$[e$.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e$[e$.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e$}({}),gL$1=function(e$){return e$[e$.DISABLE=0]="DISABLE",e$[e$.LOW_STREAM=1]="LOW_STREAM",e$[e$.AUDIO_ONLY=2]="AUDIO_ONLY",e$[e$.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e$[e$.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e$[e$.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e$[e$.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e$[e$.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e$[e$.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e$}({}),RL$1=function(e$){return e$.TRANSCEIVER_UPDATED="transceiver-updated",e$.SEI_TO_SEND="sei-to-send",e$.SEI_RECEIVED="sei-received",e$.TRACK_UPDATED="track-updated",e$}({}),CL$1=function(e$){return e$.SOURCE_STATE_CHANGE="source-state-change",e$.TRACK_ENDED="track-ended",e$.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e$.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e$.CLOSED="closed",e$}({}),IL$1=function(e$){return e$.FIRST_FRAME_DECODED="first-frame-decoded",e$.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e$.VIDEO_STATE_CHANGED="video-state-changed",e$}({}),vL$1=function(e$){return e$.AUDIO="audio",e$.VIDEO="video",e$.DATA="data",e$}({}),yL$1=function(e$){return e$.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e$.RECEIVE_TRACK_BUFFER="receive_track_buffer",e$.ON_AUDIO_BUFFER="on_audio_buffer",e$.UPDATE_SOURCE="update_source",e$}({});(function(e$){e$.UPDATE_TRACK_SOURCE="update-track-source"})({});const AL$1={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},bL$1={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},wL$1={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},OL$1={uplinkNetworkQuality:0,downlinkNetworkQuality:0},NL$1={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let DL$1=function(e$){return e$.ON_TRACK="on_track",e$.ON_NODE="on_node",e$}({}),PL$1=function(e$){return e$.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e$.REQUEST_CONSTRAINTS="request_constraints",e$}({}),LL$1=function(e$){return e$.IDLE="IDLE",e$.INITING="INITING",e$.INITEND="INITEND",e$}({}),kL$1=function(e$){return e$.STATE_CHANGE="state_change",e$.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e$.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e$.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e$}({}),ML$1=function(e$){return e$.NONE="none",e$.INIT="init",e$.CANPLAY="canplay",e$.PLAYING="playing",e$.PAUSED="paused",e$.SUSPEND="suspend",e$.STALLED="stalled",e$.WAITING="waiting",e$.ERROR="error",e$.DESTROYED="destroyed",e$.ABORT="abort",e$.ENDED="ended",e$.EMPTIED="emptied",e$.LOADEDDATA="loadeddata",e$}({}),UL$1=function(e$){return e$[e$.VideoStateStopped=0]="VideoStateStopped",e$[e$.VideoStateStarting=1]="VideoStateStarting",e$[e$.VideoStateDecoding=2]="VideoStateDecoding",e$[e$.VideoStateFrozen=3]="VideoStateFrozen",e$}({});const xL$1={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let VL$1=function(e$){return e$.OPEN="open",e$.MESSAGE="message",e$.CLOSE="close",e$.CLOSING="closing",e$.ERROR="error",e$}({});function FL$1(e$,t$,r$,n$,i$){var o$,s$,a$={};return Object.keys(n$).forEach(function(c$){a$[c$]=n$[c$]}),a$.enumerable=!!a$.enumerable,a$.configurable=!!a$.configurable,("value"in a$||a$.initializer)&&(a$.writable=!0),a$=Jn$1(o$=oN$1(s$=r$.slice()).call(s$)).call(o$,function(c$,u$){return u$(e$,t$,c$)||c$},a$),i$&&a$.initializer!==void 0&&(a$.value=a$.initializer?a$.initializer.call(i$):void 0,a$.initializer=void 0),a$.initializer===void 0&&(Object.defineProperty(e$,t$,a$),a$=null),a$}function BL$1(e$,t$,r$){return(t$=function(n$){var i$=function(o$,s$){if(typeof o$!="object"||!o$)return o$;var a$=o$[Symbol.toPrimitive];if(a$!==void 0){var c$=a$.call(o$,"string");if(typeof c$!="object")return c$;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o$)}(n$);return typeof i$=="symbol"?i$:i$+""}(t$))in e$?Object.defineProperty(e$,t$,{value:r$,enumerable:!0,configurable:!0,writable:!0}):e$[t$]=r$,e$}function jL$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function GL$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?jL$1(Object(r$),!0).forEach(function(n$){BL$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):jL$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}let WL$1=class extends xy$1{set _mediaStreamTrack(t$){t$!==this.mediaStreamTrack&&(this.safeEmit(RL$1.TRACK_UPDATED,t$),this.mediaStreamTrack=t$)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t$,r$){super(),BL$1(this,"trackMediaType",void 0),BL$1(this,"_ID",void 0),BL$1(this,"_rtpTransceiver",void 0),BL$1(this,"_lowRtpTransceiver",void 0),BL$1(this,"_hints",[]),BL$1(this,"_isClosed",!1),BL$1(this,"_originMediaStreamTrack",void 0),BL$1(this,"mediaStreamTrack",void 0),BL$1(this,"_external",{}),this._ID=r$||TA$1(8,"track-"),this._originMediaStreamTrack=t$,this.mediaStreamTrack=t$,function(n$){Dn$1(_L$1).call(_L$1,n$)||_L$1.push(n$)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t$){return t$||dA$1(()=>{var r$;vb$1.reportApiInvoke(null,{name:By$1.GET_MEDIA_STREAM_TRACK,options:[],tag:jy$1.TRACER}).onSuccess(((r$=this._mediaStreamTrack)===null||r$===void 0?void 0:r$.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t$){return t$===TL$1.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t$){const r$=_L$1.indexOf(t$);r$!==-1&&_L$1.splice(r$,1)}(this),this.emit(CL$1.CLOSED),this.removeAllListeners(RL$1.SEI_RECEIVED)}_updateRtpTransceiver(t$,r$){if(r$===TL$1.LOW_STREAM){if(this._lowRtpTransceiver===t$)return;this._lowRtpTransceiver=t$}else{if(this._rtpTransceiver===t$)return;this._rtpTransceiver=t$}this.emit(RL$1.TRANSCEIVER_UPDATED,t$,r$)}},HL$1=class extends WL$1{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t$,r$){super(t$,r$),BL$1(this,"_enabled",!0),BL$1(this,"_muted",!1),BL$1(this,"_isExternalTrack",!1),BL$1(this,"_isClosed",!1),BL$1(this,"_enabledMutex",void 0),BL$1(this,"processor",void 0),BL$1(this,"_processorContext",void 0),BL$1(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new NA$1("".concat(this.getTrackId())),t$.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t$,r$;return(t$=(r$=this._originMediaStreamTrack)===null||r$===void 0?void 0:r$.label)!==null&&t$!==void 0?t$:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,fb$1.debug("[".concat(this.getTrackId(),"] close")),this.emit(fL$1.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t$,r$){let n$=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=n$,t$!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r$&&this._originMediaStreamTrack.stop()),t$.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t$,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $y$1(this,fL$1.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){fb$1.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(CL$1.TRACK_ENDED)}stateCheck(t$,r$){if(fb$1.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t$,": ").concat(r$,"]")),Iy$1(r$,t$),this._enabled&&this._muted&&t$==="enabled"&&r$===!1)throw new Cy$1(Ry$1.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",fb$1);if(!this._enabled&&!this._muted&&t$==="muted"&&r$===!0)throw new Cy$1(Ry$1.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",fb$1)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Gh$1.resolve([])}};const KL$1=window.AudioContext||window.webkitAudioContext;let YL$1=null;const qL$1=new class extends xy$1{constructor(){super(...arguments),BL$1(this,"prevState",void 0),BL$1(this,"curState",void 0),BL$1(this,"currentTime",void 0),BL$1(this,"currentTimeStuckAt",void 0),BL$1(this,"interruptDetectorTrack",void 0),BL$1(this,"onLocalAudioTrackMute",()=>{fb$1.info("ios15-interruption-start"),this.emit(tL$1.IOS_15_16_INTERRUPTION_START)}),BL$1(this,"onLocalAudioTrackUnmute",async()=>{fb$1.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?fb$1.info("ios15-interruption-end-canceled"):(YL$1&&await YL$1.suspend(),this.emit(tL$1.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e$){fb$1.debug("webaudio bindInterruptDetectorTrack ".concat(e$.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e$,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e$){fb$1.debug("webaudio unbindInterruptDetectorTrack ".concat(e$.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e$&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function zL$1(){if(!YL$1){if(function(){if(!KL$1)return void fb$1.error("your browser is not support web audio");fb$1.info("create audio context");const e$=GL$1({},XA$1("WEBAUDIO_INIT_OPTIONS"));fb$1.debug("audio context init option:",JSON.stringify(e$)),YL$1=new KL$1(e$),qL$1.curState=YL$1.state,YL$1.onstatechange=()=>{qL$1.prevState=qL$1.curState,qL$1.curState=YL$1?YL$1.state:void 0;const{prevState:t$,curState:r$}=qL$1,n$=r$==="running",i$=r$==="interrupted",o$=t$==="running",s$=t$==="suspended",a$=t$==="interrupted",c$=Hv$1().osVersion;($v$1()||uy$1())&&o$&&i$&&(fb$1.info("ios".concat(c$,"-interruption-start")),qL$1.emit(tL$1.IOS_INTERRUPTION_START)),($v$1()||uy$1())&&(s$||a$)&&n$&&(fb$1.info("ios".concat(c$,"-interruption-end")),qL$1.emit(tL$1.IOS_INTERRUPTION_END)),t$!==r$&&qL$1.emit(tL$1.STATE_CHANGE,r$,t$)},setInterval(()=>{var t$;const r$=(t$=YL$1)===null||t$===void 0?void 0:t$.currentTime;qL$1.currentTime!==r$?(qL$1.currentTimeStuckAt&&(fb$1.debug("AudioContext current time resume at ".concat(r$)),qL$1.currentTimeStuckAt=void 0),qL$1.currentTime=r$):(r$!==qL$1.currentTimeStuckAt&&(vb$1.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r$},tag:jy$1.TRACER}).onSuccess(),fb$1.warning("AudioContext current time stuck at ".concat(r$))),qL$1.currentTimeStuckAt=r$)},5e3),async function(t$){const r$=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let n$,i$=!1,o$=!1,s$=!1;function a$(f$){t$.state==="running"?c$(!1):$v$1()||uy$1()?t$.state==="suspended"&&(c$(!0),f$&&t$.resume().then(u$,u$)):t$.state!=="closed"&&(c$(!0),f$&&t$.resume().then(u$,u$))}function c$(f$){if(i$!==f$){i$=f$;for(let m$=0,g$=r$;m$<g$.length;m$+=1){const v$=g$[m$];f$?window.addEventListener(v$,l$,{capture:!0,passive:!0}):window.removeEventListener(v$,l$,{capture:!0,passive:!0})}}}function u$(){a$(!1)}function l$(){a$(!0)}function d$(f$){if(!s$)if(n$.paused)if(f$){let m$;h$(!1),s$=!0;try{m$=n$.play(),m$?m$.then(p$,p$):(n$.addEventListener("playing",p$),n$.addEventListener("abort",p$),n$.addEventListener("error",p$))}catch{p$()}}else h$(!0);else h$(!1)}function h$(f$){if(o$!==f$){o$=f$;for(let m$=0,g$=r$;m$<g$.length;m$++){const v$=g$[m$];f$?window.addEventListener(v$,_$,{capture:!0,passive:!0}):window.removeEventListener(v$,_$,{capture:!0,passive:!0})}}}function p$(){n$.removeEventListener("playing",p$),n$.removeEventListener("abort",p$),n$.removeEventListener("error",p$),s$=!1,d$(!1)}function _$(){d$(!0)}if($v$1()){const f$=t$.createMediaStreamDestination(),m$=document.createElement("div");m$.innerHTML="<audio x-webkit-airplay='deny'></audio>",n$=m$.children.item(0),n$.controls=!1,n$.disableRemotePlayback=!0,n$.preload="auto",n$.srcObject=f$.stream,d$(!0)}qL$1.on(tL$1.STATE_CHANGE,function(){a$(!0)}),a$(!1)}(YL$1)}(),!YL$1)throw new Cy$1(Ry$1.NOT_SUPPORTED,"can not create audio context");return YL$1}return YL$1}function JL$1(e$){if(function(){if(XL$1!==null)return XL$1;const n$=zL$1(),i$=n$.createBufferSource(),o$=n$.createGain(),s$=n$.createGain();i$.connect(o$),i$.connect(s$),i$.disconnect(o$);let a$=!1;try{i$.disconnect(o$)}catch{a$=!0}return i$.disconnect(),XL$1=a$,a$}())return;const t$=e$.connect,r$=e$.disconnect;e$.connect=(n$,i$,o$)=>{var s$;return e$._inputNodes||(e$._inputNodes=[]),Dn$1(s$=e$._inputNodes).call(s$,n$)||(n$ instanceof AudioNode?(e$._inputNodes.push(n$),t$.call(e$,n$,i$,o$)):t$.call(e$,n$,i$)),e$},e$.disconnect=(n$,i$,o$)=>{r$.call(e$),n$?nA$1(e$._inputNodes,n$):e$._inputNodes=[];for(const s$ of e$._inputNodes)t$.call(e$,s$)}}let XL$1=null;function QL$1(e$,t$){let r$=!1;const n$=1/t$;if(XA$1("DISABLE_WEBAUDIO")){const i$=window.setInterval(()=>{r$?window.clearInterval(i$):e$(performance.now()/1e3)},1e3*n$)}else{const i$=zL$1();let o$=i$.createGain();o$.gain.value=0,o$.connect(i$.destination);const s$=()=>{if(r$)return void(o$=null);const a$=i$.createOscillator();a$.onended=s$,a$.connect(o$),a$.start(0),a$.stop(i$.currentTime+n$),e$(i$.currentTime)};s$()}return()=>{r$=!0}}let ZL$1=class{constructor(){BL$1(this,"context",void 0),BL$1(this,"analyserNode",void 0),BL$1(this,"sourceNode",void 0),this.context=zL$1(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t$){if(t$!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t$,t$==null||t$.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||$v$1()||uy$1()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t$=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t$);else{const n$=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(n$);for(let i$=0;i$<t$.length;++i$)t$[i$]=n$[i$]/128-1}const r$=Jn$1(t$).call(t$,(n$,i$)=>n$+i$*i$,0)/t$.length;return Math.max(10*Math.log10(r$)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t$,r$;(t$=this.sourceNode)===null||t$===void 0||t$.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(r$=this.sourceNode)===null||r$===void 0||r$.connect(this.analyserNode)}catch{fb$1.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}},$L$1=class extends xy$1{get processSourceNode(){return this.sourceNode}set processedNode(t$){var r$;if(!this.isDestroyed&&this._processedNode!==t$){try{var n$;(n$=this.sourceNode)===null||n$===void 0||n$.disconnect(this.outputNode)}catch{}(r$=this._processedNode)===null||r$===void 0||r$.disconnect(),this._processedNode=t$,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),BL$1(this,"outputNode",void 0),BL$1(this,"outputTrack",void 0),BL$1(this,"isPlayed",!1),BL$1(this,"sourceNode",void 0),BL$1(this,"context",void 0),BL$1(this,"audioBufferNode",void 0),BL$1(this,"destNode",void 0),BL$1(this,"audioOutputLevel",0),BL$1(this,"volumeLevelAnalyser",void 0),BL$1(this,"_processedNode",void 0),BL$1(this,"playNode",void 0),BL$1(this,"isDestroyed",!1),BL$1(this,"onNoAudioInput",void 0),BL$1(this,"isNoAudioInput",!1),BL$1(this,"_noAudioInputCount",0),this.context=zL$1(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),JL$1(this.outputNode),this.volumeLevelAnalyser=new ZL$1}startGetAudioBuffer(t$){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t$),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r$=>{this.emit(yL$1.ON_AUDIO_BUFFER,function(n$){for(let i$=0;i$<n$.outputBuffer.numberOfChannels;i$+=1){const o$=n$.outputBuffer.getChannelData(i$);for(let s$=0;s$<o$.length;s$+=1)o$[s$]=0}return n$.inputBuffer}(r$))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!ZP$1().webAudioMediaStreamDest)throw new Cy$1(Ry$1.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t$){this.context.state!=="running"&&oA$1(()=>{qL$1.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t$||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t$>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;$v$1()||uy$1()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const r$=this.volumeLevelAnalyser.getAnalyserNode();let n$;r$.getFloatTimeDomainData?(n$=new Float32Array(r$.fftSize),r$.getFloatTimeDomainData(n$)):(n$=new Uint8Array(r$.fftSize),r$.getByteTimeDomainData(n$));let i$=!1;for(let o$=0;o$<n$.length;o$++)n$[o$]!==0&&(i$=!0);return i$?(this.isNoAudioInput=!1,!0):(await mA$1(200),await this.checkHasAudioInput(t$?t$+1:1)&&i$)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t$){this.outputNode.gain.setValueAtTime(t$,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t$,r$;(t$=this.processedNode)===null||t$===void 0||t$.disconnect(),(r$=this.sourceNode)===null||r$===void 0||r$.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t$;this.processedNode?(t$=this.processedNode)===null||t$===void 0||t$.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}},ek$1=class extends $L$1{get isFreeze(){return!1}constructor(t$,r$,n$){var i$;if(super(),BL$1(this,"sourceNode",void 0),BL$1(this,"track",void 0),BL$1(this,"clonedTrack",void 0),BL$1(this,"audioElement",void 0),BL$1(this,"isCurrentTrackCloned",!1),BL$1(this,"isRemoteTrack",!1),BL$1(this,"originVolumeLevelAnalyser",void 0),BL$1(this,"rebuildWebAudio",async()=>{if(fb$1.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void fb$1.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>fb$1.info("resume success")),fb$1.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const a$=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?a$.stop():this.isCurrentTrackCloned=!0;const c$=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(c$),JL$1(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const u$=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(u$,this.context.currentTime),JL$1(this.outputNode),this.emit(yL$1.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=c$,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t$.kind!=="audio")throw new Cy$1(Ry$1.UNEXPECTED_ERROR);this.track=t$;const o$=new MediaStream([this.track]);if(this.isRemoteTrack=!!r$,this.sourceNode=this.context.createMediaStreamSource(o$),JL$1(this.sourceNode),n$){const a$=n$.clone();a$.enabled=!0,this.clonedTrack=a$,fb$1.debug("create an unmuted track ".concat(a$.id," from the original track ").concat(n$.id," to get the volume"));const c$=this.context.createMediaStreamSource(new MediaStream([a$]));JL$1(c$),this.originVolumeLevelAnalyser=new ZL$1,this.originVolumeLevelAnalyser.updateSource(c$)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=o$;const s$=Hv$1();r$&&s$.os===Fv$1.IOS&&Number((i$=s$.osVersion)===null||i$===void 0?void 0:i$.split(".")[0])<15&&(qL$1.on(tL$1.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(a$=>{a$||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t$){this.sourceNode.disconnect(),this.track=t$,this.isCurrentTrackCloned=!1;const r$=new MediaStream([t$]);this.sourceNode=this.context.createMediaStreamSource(r$),JL$1(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(yL$1.UPDATE_SOURCE),this.audioElement.srcObject=r$}destroy(){var t$;this.audioElement.srcObject=null,this.audioElement.remove(),qL$1.off("state-change",this.rebuildWebAudio),(t$=this.originVolumeLevelAnalyser)===null||t$===void 0||t$.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t$){return this.context.createMediaStreamSource(new MediaStream([t$]))}updateOriginTrack(t$){const r$=t$.clone();r$.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r$),fb$1.debug("create an unmuted track ".concat(r$.id," from the original track ").concat(t$.id," to get the volume"));const n$=this.context.createMediaStreamSource(new MediaStream([r$]));JL$1(n$),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n$)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}};async function tk$1(e$,t$,r$){const n$=(o$,s$)=>o$?typeof o$!="number"?o$.max||o$.exact||o$.ideal||o$.min||s$:o$:s$,i$={audio:!!r$&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e$,maxHeight:n$(t$.height,1080),maxWidth:n$(t$.width,1920)}}};return t$.frameRate&&typeof t$.frameRate!="number"?(i$.video.mandatory.maxFrameRate=t$.frameRate.max,i$.video.mandatory.minFrameRate=t$.frameRate.min):typeof t$.frameRate=="number"&&(i$.video.mandatory.maxFrameRate=t$.frameRate),await navigator.mediaDevices.getUserMedia(i$)}async function ik$1(e$,t$){const r$=await nk$1(e$.mediaSource),{sourceId:n$,audio:i$}=await function(o$){let s$=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Gh$1((a$,c$)=>{const u$=document.createElement("div");u$.innerText="share screen",u$.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const l$=document.createElement("div");l$.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const d$=document.createElement("div");d$.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",d$.setAttribute("style","height: 12%;");const h$=document.createElement("div");h$.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const p$=document.createElement("div");p$.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const _$=document.createElement("button");_$.innerHTML="cancel",_$.setAttribute("style","width: 85px;"),_$.onclick=()=>{document.body.removeChild(g$);const v$=new Error("NotAllowedError");v$.name="NotAllowedError",c$(v$)};let f$=s$;const m$=document.createElement("div");if(s$){const v$=document.createElement("input");v$.setAttribute("type","checkbox");const y$=document.createElement("span");v$.setAttribute("style","margin-right: 6px;"),y$.innerText="Share audio",v$.checked=f$,v$.onchange=()=>{f$=v$.checked},m$.appendChild(v$),m$.appendChild(y$)}p$.appendChild(m$),p$.appendChild(_$),l$.appendChild(d$),l$.appendChild(h$),l$.appendChild(p$);const g$=document.createElement("div");g$.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),g$.appendChild(u$),g$.appendChild(l$),document.body.appendChild(g$),o$.map(v$=>{if(v$.id){const y$=document.createElement("div");y$.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let S$=v$.thumbnail;try{const{width:b$}=S$.getSize();b$>1920&&(S$=S$.resize({width:1920}))}catch(b$){throw b$&&b$.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),b$}y$.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+S$.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+v$.name.replace(/[\u00A0-\u9999<>\&]/g,function(b$){return"&#"+b$.charCodeAt(0)+";"})+"</span>",y$.onclick=()=>{document.body.removeChild(g$),a$({sourceId:v$.id,audio:f$})},h$.appendChild(y$)}})})}(r$,t$);return await tk$1(n$,e$,i$)}async function nk$1(e$){let t$=["window","screen"];e$!=="application"&&e$!=="window"||(t$=["window"]),e$==="screen"&&(t$=["screen"]);const r$=Fy$1();if(!r$)throw console.error("failed to fetch electron, please mount it to window"),new Cy$1(Ry$1.ELECTRON_IS_NULL);let n$=null;try{var i$;n$=((i$=r$.desktopCapturer)===null||i$===void 0?void 0:i$.getSources({types:t$}))||r$.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t$})}catch{n$=null}n$&&n$.then||(n$=new Gh$1((o$,s$)=>{r$.desktopCapturer.getSources({types:t$},(a$,c$)=>{a$?s$(a$):o$(c$)})}));try{return await n$}catch(o$){throw new Cy$1(Ry$1.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,o$.toString())}}const rk$1=new NA$1("safari");let ok$1=!1,sk$1=!1;async function ak$1(e$,t$){let r$=0,n$=null;for(;r$<2;)try{n$=await ck$1(e$,t$,r$>0);break}catch(i$){if(i$ instanceof Cy$1)throw fb$1.error("[".concat(t$,"] ").concat(i$.toString())),i$;const o$=dk$1(i$.name||i$.code||i$,i$.message);if(o$.code===Ry$1.MEDIA_OPTION_INVALID){fb$1.debug("[".concat(t$,"] detect media option invalid, retry")),r$+=1,await mA$1(500);continue}throw fb$1.error("[".concat(t$,"] ").concat(o$.toString())),o$}if(!n$)throw new Cy$1(Ry$1.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return n$}async function ck$1(e$,t$,r$){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Cy$1(Ry$1.NOT_SUPPORTED,"can not find getUserMedia");r$&&(e$.video&&(delete e$.video.width,delete e$.video.height),e$.screen&&(delete e$.screen.width,delete e$.screen.height));const n$=ZP$1(),i$=new MediaStream;if(e$.audioSource&&i$.addTrack(e$.audioSource),e$.videoSource&&i$.addTrack(e$.videoSource),!e$.audio&&!e$.video&&!e$.screen)return fb$1.debug("Using Video Source/ Audio Source"),i$;if(e$.screen)if(Fy$1())e$.screen.sourceId?lk$1(i$,await tk$1(e$.screen.sourceId,e$.screen,e$.screenAudio)):lk$1(i$,await ik$1(e$.screen,e$.screenAudio));else if(Jv$1()&&e$.screen.extensionId&&e$.screen.mandatory){if(!n$.getStreamFromExtension)throw new Cy$1(Ry$1.NOT_SUPPORTED,"This browser does not support screen sharing");fb$1.debug("[".concat(t$,'] Screen access on chrome stable, looking for extension"'));const h$=await(s$=e$.screen.extensionId,a$=t$,new Gh$1((p$,_$)=>{try{chrome.runtime.sendMessage(s$,{getStream:!0},f$=>{if(!f$||!f$.streamId)return fb$1.error("[".concat(a$,"] No response from Chrome Plugin. Plugin not installed properly"),f$),void _$(new Cy$1(Ry$1.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));p$(f$.streamId)})}catch(f$){fb$1.error("[".concat(a$,"] AgoraRTC screensharing plugin is not accessible(").concat(s$,")"),f$.toString()),_$(new Cy$1(Ry$1.CHROME_PLUGIN_NOT_INSTALL))}}));e$.screen.mandatory.chromeMediaSourceId=h$,lk$1(i$,await navigator.mediaDevices.getUserMedia({video:{mandatory:e$.screen.mandatory}}))}else if(n$.getDisplayMedia){var o$;e$.screen.mediaSource&&EL$1(e$.screen.mediaSource);const h$={width:e$.screen.width,height:e$.screen.height,frameRate:e$.screen.frameRate,displaySurface:(o$=e$.screen.displaySurface)!==null&&o$!==void 0?o$:e$.screen.mediaSource==="screen"?"monitor":e$.screen.mediaSource},{selfBrowserSurface:p$,surfaceSwitching:_$,systemAudio:f$}=e$.screen,m$={selfBrowserSurface:p$,surfaceSwitching:_$,systemAudio:f$};!p$&&delete m$.selfBrowserSurface,!_$&&delete m$.surfaceSwitching,!f$&&delete m$.systemAudio,fb$1.debug("[".concat(t$,"] getDisplayMedia:"),JSON.stringify({video:h$,audio:!!e$.screenAudio,controls:m$})),lk$1(i$,await navigator.mediaDevices.getDisplayMedia(GL$1({video:h$,audio:!!e$.screenAudio},m$)))}else{if(!Zv$1())throw fb$1.error("[".concat(t$,"] This browser does not support screenSharing")),new Cy$1(Ry$1.NOT_SUPPORTED,"This browser does not support screen sharing");{e$.screen.mediaSource&&EL$1(e$.screen.mediaSource);const h$={video:{mediaSource:e$.screen.mediaSource,width:e$.screen.width,height:e$.screen.height,frameRate:e$.screen.frameRate}};fb$1.debug("[".concat(t$,"] getUserMedia: ").concat(JSON.stringify(h$))),lk$1(i$,await navigator.mediaDevices.getUserMedia(h$))}}var s$,a$;if(!e$.video&&!e$.audio)return i$;let c$={video:e$.video,audio:e$.audio},u$=XA$1("MEDIA_DEVICE_CONSTRAINTS");if(u$)try{typeof u$=="string"&&(u$=JSON.parse(u$)),c$=vA$1(c$,u$)}catch{}fb$1.debug("[".concat(t$,"] GetUserMedia"),JSON.stringify(c$)),Hv$1();let l$,d$=null;(Xv$1()||$v$1()||zv$1())&&(d$=await rk$1.lock());try{l$=await navigator.mediaDevices.getUserMedia(c$)}catch(h$){throw d$&&d$(),h$}return c$.audio&&(ok$1=!0),c$.video&&(sk$1=!0),lk$1(i$,l$),d$&&d$(),i$}function dk$1(e$,t$){switch(e$){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Cy$1(Ry$1.MEDIA_OPTION_INVALID,"".concat(e$,": ").concat(t$));case"NotFoundError":case"DevicesNotFoundError":return new Cy$1(Ry$1.DEVICE_NOT_FOUND,"".concat(e$,": ").concat(t$));case"NotSupportedError":return new Cy$1(Ry$1.NOT_SUPPORTED,"".concat(e$,": ").concat(t$));case"NotReadableError":return new Cy$1(Ry$1.NOT_READABLE,"".concat(e$,": ").concat(t$));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Cy$1(Ry$1.PERMISSION_DENIED,"".concat(e$,": ").concat(t$));case"ConstraintNotSatisfiedError":return new Cy$1(Ry$1.CONSTRAINT_NOT_SATISFIED,"".concat(e$,": ").concat(t$));default:return fb$1.error("getUserMedia unexpected error",e$),new Cy$1(Ry$1.UNEXPECTED_ERROR,"".concat(e$,": ").concat(t$))}}function lk$1(e$,t$){const r$=e$.getVideoTracks()[0],n$=e$.getAudioTracks()[0],i$=t$.getVideoTracks()[0],o$=t$.getAudioTracks()[0];o$&&(n$&&e$.removeTrack(n$),e$.addTrack(o$)),i$&&(r$&&e$.removeTrack(r$),e$.addTrack(i$))}const uk$1=new class extends xy$1{get state(){return this._state}set state(e$){e$!==this._state&&(this.emit(kL$1.STATE_CHANGE,e$),this._state=e$)}constructor(){super(),BL$1(this,"_state",LL$1.IDLE),BL$1(this,"isAccessMicrophonePermission",!1),BL$1(this,"isAccessCameraPermission",!1),BL$1(this,"lastAccessMicrophonePermission",!1),BL$1(this,"lastAccessCameraPermission",!1),BL$1(this,"checkdeviceMatched",!1),BL$1(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(XA$1("ENUMERATE_DEVICES_INTERVAL")||(fy$1()||Yv$1()===Fv$1.HARMONY_OS)&&Ey$1())&&this.updateDevicesInfo()},XA$1("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e$=>fb$1.error(e$.toString()))}async enumerateDevices(e$,t$){let r$=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Cy$1(Ry$1.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const n$=await navigator.mediaDevices.enumerateDevices(),i$=this.checkMediaDeviceInfoIsOk(n$);let o$=!this.isAccessMicrophonePermission&&e$,s$=!this.isAccessCameraPermission&&t$;i$.audio&&(o$=!1),i$.video&&(s$=!1);let a$=null,c$=null,u$=null;if(!r$&&(o$||s$)){if(rk$1.isLocked&&(fb$1.debug("[device manager] wait GUM lock"),(await rk$1.lock())(),fb$1.debug("[device manager] GUM unlock")),ok$1&&(o$=!1,this.isAccessMicrophonePermission=!0),sk$1&&(s$=!1,this.isAccessCameraPermission=!0),fb$1.debug("[device manager] check media device permissions",e$,t$,o$,s$),o$&&s$){try{u$=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(l$){const d$=dk$1(l$.name||l$.code||l$,l$.message);if(d$.code===Ry$1.PERMISSION_DENIED)throw d$;fb$1.warning("getUserMedia failed in getDevices",d$)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o$){try{a$=await navigator.mediaDevices.getUserMedia({audio:e$})}catch(l$){const d$=dk$1(l$.name||l$.code||l$,l$.message);if(d$.code===Ry$1.PERMISSION_DENIED)throw d$;fb$1.warning("getUserMedia failed in getDevices",d$)}this.isAccessMicrophonePermission=!0}else if(s$){try{c$=await navigator.mediaDevices.getUserMedia({video:t$})}catch(l$){const d$=dk$1(l$.name||l$.code||l$,l$.message);if(d$.code===Ry$1.PERMISSION_DENIED)throw d$;fb$1.warning("getUserMedia failed in getDevices",d$)}this.isAccessCameraPermission=!0}fb$1.debug("[device manager] mic permission",e$,"cam permission",t$)}try{const l$=await navigator.mediaDevices.enumerateDevices();return a$&&a$.getTracks().forEach(d$=>d$.stop()),c$&&c$.getTracks().forEach(d$=>d$.stop()),u$&&u$.getTracks().forEach(d$=>d$.stop()),a$=null,c$=null,u$=null,l$}catch(l$){return a$&&a$.getTracks().forEach(d$=>d$.stop()),c$&&c$.getTracks().forEach(d$=>d$.stop()),u$&&u$.getTracks().forEach(d$=>d$.stop()),a$=null,c$=null,u$=null,new Cy$1(Ry$1.ENUMERATE_DEVICES_FAILED,l$.toString()).throw()}}async getRecordingDevices(){let e$=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e$)).filter(t$=>t$.kind==="audioinput")}async getCamerasDevices(){let e$=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e$)).filter(t$=>t$.kind==="videoinput")}async getSpeakers(){let e$=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e$)).filter(t$=>t$.kind==="audiooutput")}searchDeviceIdByName(e$){let t$=null;return this.deviceInfoMap.forEach(r$=>{r$.device.label===e$&&(t$=r$.device.deviceId)}),t$}async getDeviceById(e$){const t$=(await this.enumerateDevices(!0,!0,!0)).find(r$=>r$.deviceId===e$);if(!t$)throw new Cy$1(Ry$1.DEVICE_NOT_FOUND,"deviceId: ".concat(e$));return t$}async init(){this.state=LL$1.INITING;try{await this.updateDevicesInfo(),this.state=LL$1.INITEND}catch(e$){throw fb$1.warning("Device Detection functionality cannot start properly.",e$.toString()),this.state=LL$1.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Cy$1(Ry$1.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e$}}async updateDevicesInfo(){const e$=await this.enumerateDevices(!0,!0,!0),t$=Date.now(),r$=[];if(e$[0]&&e$[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i$=e$.find(s$=>s$.kind==="audioinput"&&s$.deviceId==="default"),o$=e$.find(s$=>s$.kind==="audiooutput"&&s$.deviceId==="default");i$&&o$?o$.groupId===i$.groupId?fb$1.debug("[device-check] default input ".concat(i$.label," and output ").concat(o$.label," is the same group")):fb$1.warning("[device-check] default input ".concat(i$.label," and output ").concat(o$.label," is not the same group")):fb$1.debug("[device-check] default input or output not found")}const n$=this.checkMediaDeviceInfoIsOk(e$);if(e$.forEach(i$=>{if(!i$.deviceId)return;const o$=this.deviceInfoMap.get("".concat(i$.kind,"_").concat(i$.deviceId));if((o$?o$.state:"INACTIVE")!=="ACTIVE"){const s$={initAt:t$,updateAt:t$,device:i$,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i$.kind,"_").concat(i$.deviceId),s$),r$.push(s$)}o$&&(o$.updateAt=t$)}),this.deviceInfoMap.forEach((i$,o$)=>{i$.state==="ACTIVE"&&i$.updateAt!==t$&&(i$.state="INACTIVE",r$.push(i$))}),this.state!==LL$1.INITEND)return n$.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(n$.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r$.forEach(i$=>{switch(i$.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(kL$1.RECORDING_DEVICE_CHANGED,i$);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(kL$1.CAMERA_DEVICE_CHANGED,i$);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(kL$1.PLAYOUT_DEVICE_CHANGED,i$)}}),n$.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),n$.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e$){const t$=e$.filter(i$=>i$.kind==="audioinput"),r$=e$.filter(i$=>i$.kind==="videoinput"),n$={audio:!1,video:!1};for(const i$ of t$)if(i$.label&&i$.deviceId){n$.audio=!0;break}for(const i$ of r$)if(i$.label&&i$.deviceId){n$.video=!0;break}return n$}};let hk$1=!1;const pk$1=new class extends xy$1{constructor(){super(...arguments),BL$1(this,"onAutoplayFailed",void 0),BL$1(this,"onAudioAutoplayFailed",void 0)}};function _k$1(){if(Hv$1(),!hk$1){const e$=t$=>{t$.preventDefault(),hk$1=!1,my$1()?document.body.removeEventListener("click",e$,!0):(document.body.removeEventListener("touchstart",e$,!0),document.body.removeEventListener("mousedown",e$,!0))};hk$1=!0,my$1()?document.body.addEventListener("click",e$,!0):(document.body.addEventListener("touchstart",e$,!0),document.body.addEventListener("mousedown",e$,!0)),fb$1.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),pk$1.onAutoplayFailed?pk$1.onAutoplayFailed():pk$1.onAudioAutoplayFailed?fb$1.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):fb$1.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),pk$1.emit("autoplay-failed")}}function Ek$1(e$,t$,r$,n$){if(!e$)return;const i$=vb$1.getBaseInfoBySessionId(e$);if(!i$)return;const o$=i$.info,s$=Date.now(),a$=GL$1(GL$1({},o$),{},{vid:o$.vid===void 0?0:Number(o$.vid),lts:s$,elapse:s$-i$.startTime,cbRegistered:pk$1.onAutoplayFailed||pk$1.onAudioAutoplayFailed?1:-1,errorMsg:r$,mediaType:t$,trackId:n$,extend:void 0});vb$1.send({type:Rb$1.AUTOPLAY_FAILED,data:a$},!0)}const fk$1=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],mk$1=new class{constructor(){BL$1(this,"onAutoplayFailed",void 0),BL$1(this,"elementMap",new Map),BL$1(this,"elementStateMap",new Map),BL$1(this,"elementsNeedToResume",[]),BL$1(this,"sinkIdMap",new Map),BL$1(this,"autoResumeAfterInterruption",e$=>{Array.from(this.elementMap.entries()).forEach(t$=>{let[r$,n$]=t$;const i$=this.elementStateMap.get(r$),o$=n$.srcObject.getAudioTracks()[0],s$=o$&&o$.readyState;if(fb$1.debug("resume after interrupted, ele: ".concat(i$," audio: ").concat(s$," ").concat(e$)),s$==="live"){if(e$)return n$.pause(),void n$.play();if(qL$1.curState==="running")return cy$1()?(n$.pause(),void n$.play()):void(i$&&i$==="paused"&&n$.play())}})}),BL$1(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e$=>{let[t$,r$]=e$;const n$=r$.srcObject.getAudioTracks()[0];n$&&n$.readyState==="live"&&(fb$1.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r$.pause(),r$.play())})}),this.autoResumeAudioElement(),qL$1.on(tL$1.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),qL$1.on(tL$1.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),qL$1.on(tL$1.STATE_CHANGE,()=>{$v$1()&&qL$1.prevState==="suspended"&&qL$1.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e$,t$){const r$=this.elementMap.get(e$);if(this.sinkIdMap.set(e$,t$),r$)try{await r$.setSinkId(t$)}catch(n$){throw new Cy$1(Ry$1.PERMISSION_DENIED,"can not set sink id: "+n$.toString())}}play(e$,t$,r$,n$){if(this.elementMap.has(t$))return;const i$=document.createElement("audio");i$.autoplay=!0,i$.srcObject=new MediaStream([e$]),this.bindAudioElementEvents(t$,i$),this.elementMap.set(t$,i$),this.elementStateMap.set(t$,ML$1.INIT),this.setVolume(t$,r$);const o$=this.sinkIdMap.get(t$);if(o$)try{i$.setSinkId(o$).catch(a$=>{fb$1.warning("[".concat(t$,"] set sink id failed"),a$.toString())})}catch(a$){fb$1.warning("[".concat(t$,"] set sink id failed"),a$.toString())}const s$=i$.play();s$&&s$.then&&s$.catch(a$=>{n$&&Ek$1(n$,"audio",a$.message,t$),fb$1.warning("audio element play warning",a$.toString()),this.elementMap.has(t$)&&a$.name==="NotAllowedError"&&(fb$1.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i$),oA$1(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),_k$1()}))})}updateTrack(e$,t$){const r$=this.elementMap.get(e$);r$&&(r$.srcObject=new MediaStream([t$]))}isPlaying(e$){return this.elementMap.has(e$)&&this.elementStateMap.get(e$)==="playing"}setVolume(e$,t$){const r$=this.elementMap.get(e$);r$&&(t$=Math.max(0,Math.min(100,t$)),r$.volume=t$/100)}stop(e$){const t$=this.elementMap.get(e$);if(this.sinkIdMap.delete(e$),!t$)return;const r$=this.elementsNeedToResume.indexOf(t$);this.elementsNeedToResume.splice(r$,1),t$.srcObject=null,t$.remove(),this.elementMap.delete(e$),this.elementStateMap.delete(e$)}bindAudioElementEvents(e$,t$){fk$1.forEach(r$=>{t$.addEventListener(r$,n$=>{const i$=this.elementStateMap.get(e$),o$=n$.type==="pause"?"paused":n$.type;if(fb$1.debug("[".concat(e$,"] audio-element-status change ").concat(i$," => ").concat(o$)),n$.type==="error"){const s$=t$==null?void 0:t$.error;s$&&fb$1.error("[".concat(e$,"] media error, code: ").concat(s$.code,", message: ").concat(s$.message))}this.elementStateMap.set(e$,o$)})})}getPlayerState(e$){return this.elementStateMap.get(e$)||"uninit"}autoResumeAudioElement(){const e$=()=>{this.elementsNeedToResume.forEach(t$=>{t$.play().then(r$=>{fb$1.debug("Auto resume audio element success")}).catch(r$=>{fb$1.warning("Auto resume audio element failed!",r$)})}),this.elementsNeedToResume=[]};new Gh$1(t$=>{document.body?t$():window.addEventListener("load",()=>t$())}).then(()=>{my$1()?document.body.addEventListener("click",e$,!0):(document.body.addEventListener("touchstart",e$,!0),document.body.addEventListener("mousedown",e$,!0))})}};function Tk$1(){return function(e$,t$,r$){const n$=r$.value;return typeof n$=="function"&&(r$.value=function(){this._isClosed&&new Cy$1(Ry$1.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",fb$1);for(var i$=arguments.length,o$=new Array(i$),s$=0;s$<i$;s$++)o$[s$]=arguments[s$];const a$=n$.apply(this,o$);return a$ instanceof Gh$1?new Gh$1((c$,u$)=>{a$.then(c$).catch(u$)}):a$}),r$}}let Sk$1=class extends xy$1{constructor(t$){super(),BL$1(this,"name","VideoProcessorDestination"),BL$1(this,"ID","0"),BL$1(this,"_source",void 0),BL$1(this,"videoContext",void 0),BL$1(this,"inputTrack",void 0),this.videoContext=t$}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Cy$1(Ry$1.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Cy$1(Ry$1.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t$){if(t$.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t$.track&&t$.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t$.track,this.emit(DL$1.ON_TRACK,t$.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(DL$1.ON_TRACK,void 0)}},gk$1=class extends xy$1{set chained(t$){this._chained=t$}get chained(){return this._chained}constructor(t$,r$){super(),BL$1(this,"constraintsMap",new Map),BL$1(this,"statsRegistry",[]),BL$1(this,"usageRegistry",[]),BL$1(this,"trackId",void 0),BL$1(this,"direction",void 0),BL$1(this,"_chained",!1),this.trackId=t$,this.direction=r$}async getConstraints(){return await Zy$1(this,PL$1.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t$,r$){var n$;return fb$1.info("processor ".concat(r$.name," requestApplyConstraints for ").concat(this.trackId)),t$&&this.constraintsMap.set(r$,t$),$y$1(this,PL$1.REQUEST_UPDATE_CONSTRAINTS,Array.from(_N(n$=this.constraintsMap).call(n$)))}async requestRevertConstraints(t$){var r$;if(this.constraintsMap.has(t$))return fb$1.info("processor ".concat(t$.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t$),$y$1(this,PL$1.REQUEST_UPDATE_CONSTRAINTS,Array.from(_N(r$=this.constraintsMap).call(r$)))}registerStats(t$,r$,n$){this.statsRegistry.find(i$=>i$.processorID===t$.ID&&i$.processorName===t$.name&&i$.type===r$)||this.statsRegistry.push({processorName:t$.name,processorID:t$.ID,type:r$,cb:n$})}unregisterStats(t$,r$){const n$=this.statsRegistry.findIndex(i$=>i$.processorID===t$.ID&&i$.processorName===t$.name&&i$.type===r$);n$!==-1&&this.statsRegistry.splice(n$,1)}gatherStats(){const t$=[];for(const{processorID:r$,processorName:n$,type:i$,cb:o$}of this.statsRegistry)try{const s$=o$();t$.push({processorID:r$,processorName:n$,type:i$,stats:s$})}catch(s$){fb$1.error(new Cy$1(Ry$1.UNEXPECTED_ERROR,s$.message))}return t$}registerUsage(t$,r$){this.usageRegistry.find(n$=>n$.processorID===t$.ID&&n$.processorName===t$.name)||this.usageRegistry.push({processorID:t$.ID,processorName:t$.name,cb:r$})}unregisterUsage(t$){const r$=this.usageRegistry.findIndex(n$=>n$.processorID===t$.ID&&n$.processorName===t$.name);r$!==-1&&this.usageRegistry.splice(r$,1)}async gatherUsage(){const t$=[];if(!this.chained)return[];for(const{cb:r$}of this.usageRegistry)try{let n$=r$();n$ instanceof Gh$1&&(n$=await n$),t$.push(GL$1(GL$1({},n$),{},{direction:this.direction}))}catch(n$){fb$1.error("gather extension usage error",n$)}return t$}getDirection(){return this.direction}},Rk$1=class extends xy$1{constructor(t$){super(),BL$1(this,"name","AudioProcessorDestination"),BL$1(this,"ID","0"),BL$1(this,"inputTrack",void 0),BL$1(this,"inputNode",void 0),BL$1(this,"audioProcessorContext",void 0),BL$1(this,"_source",void 0),this.audioProcessorContext=t$}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Cy$1(Ry$1.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Cy$1(Ry$1.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(DL$1.ON_TRACK,void 0),this.emit(DL$1.ON_NODE,void 0)}updateInput(t$){if(t$.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t$.track&&this.inputTrack!==t$.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t$.track,this.emit(DL$1.ON_TRACK,this.inputTrack)),t$.node&&this.inputNode!==t$.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t$.node,this.emit(DL$1.ON_NODE,this.inputNode))}},Ck$1=class extends xy$1{set chained(t$){this._chained=t$}get chained(){return this._chained}constructor(t$,r$,n$){super(),BL$1(this,"constraintsMap",new Map),BL$1(this,"statsRegistry",[]),BL$1(this,"audioContext",void 0),BL$1(this,"trackId",void 0),BL$1(this,"direction",void 0),BL$1(this,"usageRegistry",[]),BL$1(this,"_chained",!1),this.audioContext=t$,this.trackId=r$,this.direction=n$}async getConstraints(){return Zy$1(this,PL$1.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t$,r$){var n$;return fb$1.info("processor ".concat(r$.name," requestApplyConstraints for ").concat(this.trackId)),t$&&this.constraintsMap.set(r$,t$),$y$1(this,PL$1.REQUEST_UPDATE_CONSTRAINTS,Array.from(_N(n$=this.constraintsMap).call(n$)))}async requestRevertConstraints(t$){var r$;if(this.constraintsMap.has(t$))return this.constraintsMap.delete(t$),$y$1(this,PL$1.REQUEST_UPDATE_CONSTRAINTS,Array.from(_N(r$=this.constraintsMap).call(r$)))}registerStats(t$,r$,n$){this.statsRegistry.find(i$=>i$.processorID===t$.ID&&i$.processorName===t$.name&&i$.type===r$)||this.statsRegistry.push({processorName:t$.name,processorID:t$.ID,type:r$,cb:n$})}unregisterStats(t$,r$){const n$=this.statsRegistry.findIndex(i$=>i$.processorID===t$.ID&&i$.processorName===t$.name&&i$.type===r$);n$!==-1&&this.statsRegistry.splice(n$,1)}gatherStats(){const t$=[];for(const{processorID:r$,processorName:n$,type:i$,cb:o$}of this.statsRegistry)try{const s$=o$();t$.push({processorID:r$,processorName:n$,type:i$,stats:s$})}catch(s$){fb$1.error(new Cy$1(Ry$1.UNEXPECTED_ERROR,s$.message))}return t$}registerUsage(t$,r$){this.usageRegistry.find(n$=>n$.processorID===t$.ID&&n$.processorName===t$.name)||this.usageRegistry.push({processorID:t$.ID,processorName:t$.name,cb:r$})}unregisterUsage(t$){const r$=this.usageRegistry.findIndex(n$=>n$.processorID===t$.ID&&n$.processorName===t$.name);r$!==-1&&this.usageRegistry.splice(r$,1)}async gatherUsage(){const t$=[];if(!this.chained)return[];for(const{cb:r$}of this.usageRegistry)try{let n$=r$();n$ instanceof Gh$1&&(n$=await n$),t$.push(GL$1(GL$1({},n$),{},{direction:this.direction}))}catch(n$){fb$1.error("gather extension usage error",n$)}return t$}getDirection(){return this.direction}},Ik$1=class extends xy$1{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),BL$1(this,"context",void 0),BL$1(this,"processSourceNode",void 0),BL$1(this,"outputTrack",void 0),BL$1(this,"processedNode",void 0),BL$1(this,"clonedTrack",void 0),BL$1(this,"outputNode",void 0),this.outputNode=new vk$1}setVolume(){}createOutputTrack(){throw new Cy$1(Ry$1.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}},vk$1=class{disconnect(){}connect(){}};function yk$1(e$){return new Gh$1((t$,r$)=>{let n$=!1;const i$=document.createElement("video");i$.setAttribute("autoplay",""),i$.setAttribute("muted",""),i$.muted=!0,i$.autoplay=!0,i$.setAttribute("playsinline",""),i$.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i$);const o$=$v$1()?"canplay":"playing";i$.addEventListener(o$,()=>{const s$=i$.videoWidth,a$=i$.videoHeight;!s$&&Zv$1()||(n$=!0,i$.srcObject=null,i$.remove(),t$([s$,a$]))}),i$.srcObject=new MediaStream([e$]),i$.play().catch(gA$1),setTimeout(()=>{n$||(i$.srcObject=null,i$.remove(),t$([i$.videoWidth,i$.videoHeight]))},4e3)})}function Ak$1(e$){const t$={};e$.facingMode&&(t$.facingMode=e$.facingMode),e$.cameraId&&(t$.deviceId={exact:e$.cameraId});const r$=dL$1(e$.encoderConfig);return r$.width!=null&&(t$.width=r$.width),r$.height!=null&&(t$.height=r$.height),!py$1()&&r$.frameRate&&(t$.frameRate=r$.frameRate),Qv$1()&&typeof t$.frameRate=="object"&&(t$.frameRate.max=60),Zv$1()&&(t$.frameRate={ideal:30,max:30}),t$}function bk$1(e$){const t$={};if(py$1()||(e$.AGC!==void 0&&(t$.autoGainControl=e$.AGC),e$.AEC!==void 0&&(t$.echoCancellation=e$.AEC),e$.ANS!==void 0&&(t$.noiseSuppression=e$.ANS,Jv$1()&&e$.ANS&&(t$.googHighpassFilter=e$.ANS))),e$.encoderConfig){const r$=pL$1(e$.encoderConfig);t$.channelCount=r$.stereo?2:1,t$.sampleRate=r$.sampleRate,t$.sampleSize=r$.sampleSize}return e$.microphoneId&&(t$.deviceId={exact:e$.microphoneId}),fy$1()&&(t$.sampleRate=void 0),t$}const wk$1=e$=>{const t$=e$._encoderConfig;if(!t$)return;const{frameRate:r$,width:n$,height:i$}=e$.getMediaStreamTrackSettings();let{frameRate:o$=r$,width:s$=n$,height:a$=i$}=t$;if(!o$||!s$||!a$)return;s$=AA$1(s$),a$=AA$1(a$),o$=AA$1(o$);const{max:c$,min:u$}=function(p$,_$,f$){const m$=200*Math.pow(f$/15,.6)*Math.pow(p$*_$/640/360,.75);return{min:Math.floor(m$),max:Math.floor(4*m$)}}(s$,a$,o$),{bitrateMax:l$,bitrateMin:d$}=t$||{};l$||fb$1.debug("calculate bitrate: [w: ".concat(s$,", h: ").concat(a$,", fps: ").concat(o$,"] => [brMax: ").concat(l$,", brMin: ").concat(d$,"]"));const{maxFramerate:h$}=XA$1("ENCODER_CONFIG_LIMIT");return h$&&typeof h$=="number"&&(o$=Math.min(o$,h$)),{frameRate:o$,bitrateMax:l$||c$,bitrateMin:d$||u$,scaleResolutionDownBy:1,scale:0}},Ok$1=async(e$,t$,r$)=>await(async(n$,i$,o$)=>{const s$=function(u$){const l$=[];for(let d$=0;d$<u$.length;d$+=2)l$.push(parseInt(u$.slice(d$,d$+2),16));return Uint8Array.from(l$)}(bA$1(""+i$+o$)).slice(0,16),a$=s$.slice(0,12),c$=await window.crypto.subtle.importKey("raw",s$,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a$},c$,n$))})(e$.buffer,t$,r$),Nk$1=e$=>{const t$=document.createElement("canvas");return t$.width=2,t$.height=2,new Gh$1((r$,n$)=>{t$.toBlob(async i$=>{if(t$.remove(),i$){const o$=await Dk$1(i$);r$({buffer:o$,width:t$.width,height:t$.height})}else n$(new Cy$1(Ry$1.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e$,1)})},Dk$1=async e$=>{const t$=await e$.arrayBuffer();return new Uint8Array(t$)};var Pk$1,Lk$1,kk$1,Mk$1,Uk$1,xk$1,Vk$1,Fk$1,Bk$1,jk$1,Gk$1,Wk$1,Hk$1,Kk$1,Yk$1,qk$1,zk$1,Jk$1,Xk$1,Qk$1,Zk$1,$k$1,eM$1,tM$1,iM$1,nM$1,rM$1,oM$1,sM$1,aM$1,cM$1,dM$1,lM$1,uM$1,hM$1,pM$1,_M$1,EM$1,fM$1,mM$1;let TM$1=(Pk$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$],throttleTime:300}),Lk$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),kk$1=Tk$1(),Mk$1=DA$1("LocalAudioTrack","_enabledMutex"),Uk$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),xk$1=Tk$1(),Vk$1=DA$1("LocalAudioTrack","_enabledMutex"),Fk$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),Bk$1=Tk$1(),jk$1=Tk$1(),Gk$1=Tk$1(),Wk$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),Hk$1=Tk$1(),Kk$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),Yk$1=Tk$1(),qk$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),zk$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$.name]}),Jk$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),FL$1((Xk$1=class extends HL$1{get _source(){return this.initWebAudio()}set _source(e$){this._trackSource=e$}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?mk$1.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e$,t$,r$,n$){super(e$,r$),BL$1(this,"trackMediaType",vL$1.AUDIO),BL$1(this,"_encoderConfig",void 0),BL$1(this,"_trackSource",void 0),BL$1(this,"_enabled",!0),BL$1(this,"_volume",100),BL$1(this,"_useAudioElement",!0),BL$1(this,"_bypassWebAudio",!1),BL$1(this,"processor",void 0),BL$1(this,"_processorContext",void 0),BL$1(this,"_processorDestination",void 0),BL$1(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t$,this._getOriginVolumeLevel=!!n$,this._trackSource=new Ik$1,XA$1("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),XA$1("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Xv$1()&&!YL$1?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e$){yy$1(e$,"volume",0,1e3),this._volume=e$,this._source.setVolume(e$/100),this._useAudioElement&&mk$1.setVolume(this.getTrackId(),e$);try{if(this._bypassWebAudio)return void fb$1.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t$=this._source.createOutputTrack();this._mediaStreamTrack!==t$&&(this._mediaStreamTrack=t$,$y$1(this,fL$1.NEED_REPLACE_TRACK,this).then(()=>{fb$1.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(r$=>{fb$1.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),r$)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e$){if(!this._useAudioElement||!$P$1())throw new Cy$1(Ry$1.NOT_SUPPORTED,"your browser does not support setting the audio output device");await mk$1.setSinkID(this.getTrackId(),e$)}async setEnabled(e$,t$,r$){return this._setEnabled(e$,t$,r$)}async _setEnabled(e$,t$,r$){if(!r$){if(e$===this._enabled)return;this.stateCheck("enabled",e$)}if(fb$1.info("[".concat(this.getTrackId(),"] start setEnabled"),e$),e$){this._originMediaStreamTrack.enabled=!0;try{r$||(this._enabled=!0),await $y$1(this,fL$1.NEED_ENABLE_TRACK,this),fb$1.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e$," success"))}catch(n$){throw r$||(this._enabled=!1),fb$1.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n$.toString()),n$}}else{this._originMediaStreamTrack.enabled=!1,r$||(this._enabled=!1);try{await $y$1(this,fL$1.NEED_DISABLE_TRACK,this)}catch(n$){throw r$||(this._enabled=!0),fb$1.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n$.toString()),n$}}}async setMuted(e$){e$!==this._muted&&(this.stateCheck("muted",e$),this._muted=e$,this._originMediaStreamTrack.enabled=!e$,fb$1.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e$)),e$?await $y$1(this,fL$1.NEED_MUTE_TRACK,this):await $y$1(this,fL$1.NEED_UNMUTE_TRACK,this))}getStats(){return dA$1(()=>{fb$1.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),eA$1(this,fL$1.GET_STATS)||GL$1({},AL$1)}setAudioFrameCallback(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e$)return this._source.removeAllListeners(yL$1.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t$),this._source.removeAllListeners(yL$1.ON_AUDIO_BUFFER),this._source.on(yL$1.ON_AUDIO_BUFFER,r$=>e$(r$))}play(){fb$1.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(fb$1.debug("[".concat(this.getTrackId(),"] start audio playback in element")),mk$1.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){fb$1.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?mk$1.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e$=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];fb$1.debug("[".concat(this.getTrackId(),"] update player source track")),e$&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&mk$1.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e$,t$){this._originMediaStreamTrack!==e$&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t$&&this._originMediaStreamTrack.stop()),e$.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e$,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e$,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $y$1(this,fL$1.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e$))}renewMediaStreamTrack(e$){return Gh$1.resolve(void 0)}pipe(e$){if(this._bypassWebAudio)throw new Cy$1(Ry$1.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e$)return e$;if(e$._source)throw new Cy$1(Ry$1.INVALID_OPERATION,"Processor ".concat(e$.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e$,this.processor._source=this,e$.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e$}unpipe(){var e$;if(!this.processor)return;const t$=this.processor;(e$=this._source.processSourceNode)===null||e$===void 0||e$.disconnect(),this.processor._source=!1,this.processor=void 0,t$.reset()}bindProcessorDestinationEvents(e$){e$.on(DL$1.ON_TRACK,async t$=>{t$?t$!==this._mediaStreamTrack&&(this._mediaStreamTrack=t$,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t$),await $y$1(this,fL$1.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $y$1(this,fL$1.NEED_REPLACE_TRACK,this))}),e$.on(DL$1.ON_NODE,t$=>{this._source.processedNode=t$})}unbindProcessorDestinationEvents(e$){e$.removeAllListeners(DL$1.ON_TRACK),e$.removeAllListeners(DL$1.ON_NODE)}bindProcessorContextEvents(e$){e$.on(PL$1.REQUEST_CONSTRAINTS,async t$=>{t$(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e$){e$.removeAllListeners(PL$1.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Ik$1&&(this._trackSource=new ek$1(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e$=new Ck$1(this._source.context,this.getTrackId(),"local"),t$=new Rk$1(e$);return this._processorContext=e$,this._processorDestination=t$,this.bindProcessorContextEvents(e$),this.bindProcessorDestinationEvents(t$),this._source.on(yL$1.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e$})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(mk$1.stop(this.getTrackId()),this._source.play()),$y$1(this,fL$1.NEED_REPLACE_MIXING_TRACK,this).then(()=>{fb$1.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(r$=>{fb$1.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),r$)})),{processorContext:e$,processorDestination:t$}}}).prototype,"setVolume",[Pk$1],Object.getOwnPropertyDescriptor(Xk$1.prototype,"setVolume"),Xk$1.prototype),FL$1(Xk$1.prototype,"setPlaybackDevice",[Lk$1,kk$1],Object.getOwnPropertyDescriptor(Xk$1.prototype,"setPlaybackDevice"),Xk$1.prototype),FL$1(Xk$1.prototype,"setEnabled",[Mk$1,Uk$1,xk$1],Object.getOwnPropertyDescriptor(Xk$1.prototype,"setEnabled"),Xk$1.prototype),FL$1(Xk$1.prototype,"setMuted",[Vk$1,Fk$1,Bk$1],Object.getOwnPropertyDescriptor(Xk$1.prototype,"setMuted"),Xk$1.prototype),FL$1(Xk$1.prototype,"getStats",[jk$1],Object.getOwnPropertyDescriptor(Xk$1.prototype,"getStats"),Xk$1.prototype),FL$1(Xk$1.prototype,"setAudioFrameCallback",[Gk$1],Object.getOwnPropertyDescriptor(Xk$1.prototype,"setAudioFrameCallback"),Xk$1.prototype),FL$1(Xk$1.prototype,"play",[Wk$1,Hk$1],Object.getOwnPropertyDescriptor(Xk$1.prototype,"play"),Xk$1.prototype),FL$1(Xk$1.prototype,"stop",[Kk$1,Yk$1],Object.getOwnPropertyDescriptor(Xk$1.prototype,"stop"),Xk$1.prototype),FL$1(Xk$1.prototype,"close",[qk$1],Object.getOwnPropertyDescriptor(Xk$1.prototype,"close"),Xk$1.prototype),FL$1(Xk$1.prototype,"pipe",[zk$1],Object.getOwnPropertyDescriptor(Xk$1.prototype,"pipe"),Xk$1.prototype),FL$1(Xk$1.prototype,"unpipe",[Jk$1],Object.getOwnPropertyDescriptor(Xk$1.prototype,"unpipe"),Xk$1.prototype),Xk$1),SM$1=(Qk$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),Zk$1=Tk$1(),$k$1=DA$1("MicrophoneAudioTrack","_enabledMutex"),eM$1=Ib$1({argsMap:(e$,t$,r$)=>[e$.getTrackId(),t$,r$]}),tM$1=Tk$1(),iM$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),FL$1((nM$1=class extends TM$1{get __className__(){return"MicrophoneAudioTrack"}constructor(e$,t$,r$,n$){super(e$,t$.encoderConfig?pL$1(t$.encoderConfig):{},n$,XA$1("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),BL$1(this,"_config",void 0),BL$1(this,"_deviceName","default"),BL$1(this,"_constraints",void 0),BL$1(this,"_originalConstraints",void 0),BL$1(this,"_enabled",!0),this._config=t$,this._constraints=r$,this._originalConstraints=r$,this._deviceName=e$.label,typeof t$.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t$.bypassWebAudio),(cy$1()||dy$1())&&qL$1.bindInterruptDetectorTrack(this)}async setDevice(e$){if(fb$1.info("[".concat(this.getTrackId(),"] start set device to ").concat(e$)),this._enabled)try{const t$=await uk$1.getDeviceById(e$),r$={};r$.audio=GL$1({},this._constraints),r$.audio.deviceId={exact:e$},this._originMediaStreamTrack.stop();let n$=null;try{n$=await ak$1(r$,this.getTrackId())}catch(i$){throw fb$1.error("[".concat(this.getTrackId(),"] setDevice failed"),i$.toString()),n$=await ak$1({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n$.getAudioTracks()[0],!1),i$}await this._updateOriginMediaStreamTrack(n$.getAudioTracks()[0],!1),this._deviceName=t$.label,this._config.microphoneId=e$,this._constraints.deviceId={exact:e$}}catch(t$){throw fb$1.error("[".concat(this.getTrackId(),"] setDevice error"),t$.toString()),t$}else try{const t$=await uk$1.getDeviceById(e$);this._deviceName=t$.label,this._config.microphoneId=e$,this._constraints.deviceId={exact:e$}}catch(t$){throw fb$1.error("[".concat(this.getTrackId(),"] setDevice error"),t$.toString()),t$}fb$1.info("[".concat(this.getTrackId(),"] set device to ").concat(e$," success"))}async setEnabled(e$,t$,r$){if(t$)return fb$1.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e$);if(!r$){if(e$===this._enabled)return;this.stateCheck("enabled",e$)}if(fb$1.info("[".concat(this.getTrackId(),"] start setEnabled"),e$),XA$1("AUTO_RESET_AUDIO_ROUTE")&&($v$1()||uy$1())){const s$=navigator.audioSession;s$&&(e$||(s$.type="playback"),s$.type="auto")}if(!e$){var n$;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(n$=this._source.clonedTrack)===null||n$===void 0||n$.stop(),r$||(this._enabled=!1);try{await $y$1(this,fL$1.NEED_DISABLE_TRACK,this)}catch(s$){throw fb$1.error("[".concat(this.getTrackId(),"] setEnabled false failed"),s$.toString()),s$}return}const i$=GL$1({},this._constraints),o$=uk$1.searchDeviceIdByName(this._deviceName);o$&&!i$.deviceId&&(i$.deviceId=o$);try{r$||(this._enabled=!0);const s$=await ak$1({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s$.getAudioTracks()[0],!1),await $y$1(this,fL$1.NEED_ENABLE_TRACK,this)}catch(s$){throw r$||(this._enabled=!1),fb$1.error("[".concat(this.getTrackId(),"] setEnabled true failed"),s$.toString()),s$}fb$1.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(cy$1()||dy$1())&&qL$1.unbindInterruptDetectorTrack(this)}onTrackEnded(){if(($v$1()||uy$1())&&this._enabled&&!this._isClosed&&qL$1.duringInterruption){const e$=async()=>{qL$1.off(tL$1.IOS_INTERRUPTION_END,e$),this._enabled&&!this._isClosed&&(fb$1.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};qL$1.on(tL$1.IOS_INTERRUPTION_END,e$)}else fb$1.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(CL$1.TRACK_ENDED)}async renewMediaStreamTrack(e$){const t$=e$||this._constraints,r$=uk$1.searchDeviceIdByName(this._deviceName);if(r$&&!t$.deviceId&&(t$.deviceId=r$),this._constraints=t$,this._enabled){this._originMediaStreamTrack.stop();const n$=await ak$1({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n$.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e$){super.bindProcessorContextEvents(e$),e$.on(PL$1.REQUEST_UPDATE_CONSTRAINTS,async(t$,r$,n$)=>{try{const i$=Object.assign({},this._originalConstraints,...t$);await this.renewMediaStreamTrack(i$),r$()}catch(i$){n$(i$)}})}unbindProcessorContextEvents(e$){super.unbindProcessorContextEvents(e$),e$.removeAllListeners(PL$1.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Qk$1,Zk$1],Object.getOwnPropertyDescriptor(nM$1.prototype,"setDevice"),nM$1.prototype),FL$1(nM$1.prototype,"setEnabled",[$k$1,eM$1,tM$1],Object.getOwnPropertyDescriptor(nM$1.prototype,"setEnabled"),nM$1.prototype),FL$1(nM$1.prototype,"close",[iM$1],Object.getOwnPropertyDescriptor(nM$1.prototype,"close"),nM$1.prototype),nM$1),gM$1=(rM$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$,e$.duration]}),oM$1=Tk$1(),sM$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),aM$1=Tk$1(),cM$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),dM$1=Tk$1(),lM$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),uM$1=Tk$1(),hM$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),pM$1=Tk$1(),_M$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),EM$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),fM$1=Tk$1(),FL$1((mM$1=class extends TM$1{get __className__(){return"BufferSourceAudioTrack"}constructor(e$,t$,r$,n$){super(t$.createOutputTrack(),r$,n$),BL$1(this,"source",void 0),BL$1(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e$,this._bufferSource=t$,this._bufferSource.on(yL$1.AUDIO_SOURCE_STATE_CHANGE,i$=>{this.safeEmit(CL$1.SOURCE_STATE_CHANGE,i$)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e$){e$&&this._bufferSource.updateOptions(e$),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e$){this._bufferSource.seekAudioBuffer(e$)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e$){yy$1(e$,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e$)}}).prototype,"startProcessAudioBuffer",[rM$1,oM$1],Object.getOwnPropertyDescriptor(mM$1.prototype,"startProcessAudioBuffer"),mM$1.prototype),FL$1(mM$1.prototype,"pauseProcessAudioBuffer",[sM$1,aM$1],Object.getOwnPropertyDescriptor(mM$1.prototype,"pauseProcessAudioBuffer"),mM$1.prototype),FL$1(mM$1.prototype,"seekAudioBuffer",[cM$1,dM$1],Object.getOwnPropertyDescriptor(mM$1.prototype,"seekAudioBuffer"),mM$1.prototype),FL$1(mM$1.prototype,"resumeProcessAudioBuffer",[lM$1,uM$1],Object.getOwnPropertyDescriptor(mM$1.prototype,"resumeProcessAudioBuffer"),mM$1.prototype),FL$1(mM$1.prototype,"stopProcessAudioBuffer",[hM$1,pM$1],Object.getOwnPropertyDescriptor(mM$1.prototype,"stopProcessAudioBuffer"),mM$1.prototype),FL$1(mM$1.prototype,"close",[_M$1],Object.getOwnPropertyDescriptor(mM$1.prototype,"close"),mM$1.prototype),FL$1(mM$1.prototype,"setAudioBufferPlaybackSpeed",[EM$1,fM$1],Object.getOwnPropertyDescriptor(mM$1.prototype,"setAudioBufferPlaybackSpeed"),mM$1.prototype),mM$1),RM$1=class R5 extends TM$1{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t$ of this.trackList)if(t$._enabled&&!t$._isClosed&&!t$.muted)return!0;return!1}constructor(){const t$=zL$1().createMediaStreamDestination();super(t$.stream.getAudioTracks()[0],void 0,TA$1(8,"track-mix-")),BL$1(this,"trackList",void 0),BL$1(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t$,this.trackList=[]}hasAudioTrack(t$){return this.trackList.indexOf(t$)!==-1}addAudioTrack(t$){this.trackList.indexOf(t$)===-1?(fb$1.debug("add ".concat(t$.getTrackId()," to mixing track")),t$._source.outputNode.connect(this.destNode),this.trackList.push(t$),this.updateEncoderConfig()):fb$1.debug("track ".concat(t$.getTrackId()," is already added"))}removeAudioTrack(t$){if(this.trackList.indexOf(t$)!==-1){fb$1.debug("remove ".concat(t$.getTrackId()," from mixing track"));try{t$._source.outputNode.disconnect(this.destNode)}catch{}nA$1(this.trackList,t$),this.updateEncoderConfig()}}updateEncoderConfig(){const t$={};this.trackList.forEach(r$=>{r$._encoderConfig&&((r$._encoderConfig.bitrate||0)>(t$.bitrate||0)&&(t$.bitrate=r$._encoderConfig.bitrate),(r$._encoderConfig.sampleRate||0)>(t$.sampleRate||0)&&(t$.sampleRate=r$._encoderConfig.sampleRate),(r$._encoderConfig.sampleSize||0)>(t$.sampleSize||0)&&(t$.sampleSize=r$._encoderConfig.sampleSize),r$._encoderConfig.stereo&&(t$.stereo=!0))}),this._encoderConfig=t$}_updateRtpTransceiver(t$){this._rtpTransceiver!==t$&&(this._rtpTransceiver=t$,this.trackList.forEach(r$=>{r$ instanceof R5?r$.emit(RL$1.TRANSCEIVER_UPDATED,t$):r$._updateRtpTransceiver(t$)}))}},CM$1=class extends $L$1{set currentState(t$){t$!==this._currentState&&(this._currentState=t$,this.safeEmit(yL$1.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t$){let r$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),BL$1(this,"audioBuffer",void 0),BL$1(this,"sourceNode",void 0),BL$1(this,"startPlayTime",0),BL$1(this,"startPlayOffset",0),BL$1(this,"pausePlayTime",0),BL$1(this,"options",void 0),BL$1(this,"currentLoopCount",0),BL$1(this,"currentPlaybackSpeed",100),BL$1(this,"_currentState","stopped"),this.audioBuffer=t$,this.options=r$,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t$){this.currentState==="stopped"?(this.options=t$,this.startPlayOffset=this.options.startPlayTime||0):fb$1.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t$){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t$,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t$))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t$){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t$/100),this.currentPlaybackSpeed=t$}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t$=this.context.createBufferSource();return t$.buffer=this.audioBuffer,t$.loop=!!this.options.loop,t$.connect(this.outputNode),t$.playbackRate.value=this.currentPlaybackSpeed/100,t$}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}};const IM$1=new Map;let vM$1=class{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const t$=this.renderStats.curTs-this.renderStats.lastTs,r$=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/t$;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,r$}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t$){t$!==this._videoElementStatus&&(fb$1.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t$)),this._videoElementStatus=t$)}get videoState(){return this._videoState}set videoState(t$){var r$;t$!==this._videoState&&(this._videoState=t$,(r$=this.onVideoStateChanged)===null||r$===void 0||r$.call(this,this.videoState))}constructor(t$){BL$1(this,"trackId",void 0),BL$1(this,"config",void 0),BL$1(this,"onFirstVideoFrameDecoded",void 0),BL$1(this,"onVideoStateChanged",void 0),BL$1(this,"freezeTimeCounterList",[]),BL$1(this,"renderFreezeAccTime",0),BL$1(this,"isKeepLastFrame",!1),BL$1(this,"timeUpdatedCount",0),BL$1(this,"freezeTime",0),BL$1(this,"playbackTime",0),BL$1(this,"lastTimeUpdatedTime",0),BL$1(this,"autoplayFailed",!1),BL$1(this,"videoTrack",void 0),BL$1(this,"videoElement",void 0),BL$1(this,"cacheVideoElement",void 0),BL$1(this,"renderStats",void 0),BL$1(this,"_videoState",UL$1.VideoStateStopped),BL$1(this,"videoElementCheckInterval",void 0),BL$1(this,"videoElementFreezeTimeout",void 0),BL$1(this,"_videoElementStatus",ML$1.NONE),BL$1(this,"isGettingVideoDimensions",!1),BL$1(this,"startGetVideoDimensions",()=>{const r$=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return fb$1.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r$,500)};!this.isGettingVideoDimensions&&r$()}),BL$1(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&qL$1.curState==="running"&&(fb$1.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(qv$1())),ly$1()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),BL$1(this,"handleVideoEvents",r$=>{switch(r$.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=ML$1.PLAYING;break;case"loadeddata":if(this.videoState=UL$1.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=ML$1.CANPLAY;break;case"stalled":this.videoElementStatus=ML$1.STALLED;break;case"suspend":this.videoElementStatus=ML$1.SUSPEND;break;case"pause":this.videoElementStatus=ML$1.PAUSED,$v$1()||uy$1()||Xv$1()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(fb$1.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=ML$1.WAITING;break;case"abort":this.videoElementStatus=ML$1.ABORT;break;case"ended":this.videoElementStatus=ML$1.ENDED;break;case"emptied":this.videoElementStatus=ML$1.EMPTIED;break;case"error":{const n$=this.videoElement.error,i$=n$?"".concat(n$.message," (").concat(n$.code,")"):"";n$&&(this.videoElementStatus=ML$1.ERROR),fb$1.error("[".concat(this.trackId,"] media error: ").concat(i$," "));break}case"timeupdate":{const n$=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=n$);const i$=n$-this.lastTimeUpdatedTime,o$=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=n$,yU$1.lastVisibleTime<yU$1.lastHiddenTime||o$<yU$1.lastHiddenTime||o$<yU$1.lastVisibleTime)return;for(i$>XA$1("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i$),this.playbackTime+=i$;this.playbackTime>=6e3;){this.playbackTime-=6e3;const s$=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(s$),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),BL$1(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(fb$1.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(qv$1())),ly$1()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t$.trackId,this.config=t$,t$.element instanceof HTMLVideoElement?this.videoElement=t$.element:this.videoElement=document.createElement("video"),qL$1.on(tL$1.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),qL$1.on(tL$1.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t$;return(t$=this.videoElement.parentElement)!==null&&t$!==void 0?t$:void 0}updateConfig(t$){this.config=t$,this.trackId=t$.trackId,t$.element!==this.videoElement&&(this.destroy(),this.videoElement=t$.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t$){this.videoTrack!==t$&&(this.videoTrack=t$,this.initVideoElement())}play(t$){const r$=this.videoElement.play();r$&&r$.catch&&r$.catch(i$=>{t$&&Ek$1(t$,"video",i$.message,this.trackId),i$.name==="NotAllowedError"?(fb$1.warning("detected video element autoplay failed",i$),this.autoplayFailed=!0,this.handleAutoPlayFailed()):fb$1.warning("[".concat(this.trackId,"] play warning: "),i$)});const n$=Hv$1();if((n$.name==="Safari"&&Number(n$.version)===15||cy$1())&&r$&&r$.then){const i$=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r$.then(i$).catch(i$)}}getCurrentFrame(){const t$=document.createElement("canvas");t$.width=this.videoElement.videoWidth,t$.height=this.videoElement.videoHeight;const r$=t$.getContext("2d");if(!r$)return fb$1.error("create canvas context failed!"),new ImageData(2,2);r$.drawImage(this.videoElement,0,0,t$.width,t$.height);const n$=r$.getImageData(0,0,t$.width,t$.height);return t$.remove(),n$}async getCurrentFrameToUint8Array(t$){let r$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const n$=document.createElement("canvas");n$.width=this.videoElement.videoWidth,n$.height=this.videoElement.videoHeight;const i$=n$.getContext("2d");return i$?(i$.drawImage(this.videoElement,0,0,n$.width,n$.height),new Gh$1((o$,s$)=>{n$.toBlob(async a$=>{if(n$.remove(),a$){const c$=await Dk$1(a$);o$({buffer:c$,width:n$.width,height:n$.height})}else s$(new Cy$1(Ry$1.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t$,r$<0?.1:r$>1?1:r$)})):await Nk$1(t$)}destroy(){this.renderStats=void 0,qL$1.off(tL$1.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),qL$1.off(tL$1.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=UL$1.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=ML$1.INIT,!this.videoElementCheckInterval&&(yM$1.forEach(o$=>{this.videoElement.addEventListener(o$,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(o$){return o$!==document.body&&document.body.contains(o$)})(this.videoElement)||(this.videoElementStatus=ML$1.DESTROYED)},1e3),XA$1("ENABLE_VIDEO_FRAME_CALLBACK"))){var t$,r$;let o$;const s$=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",s$),this.videoElementFreezeTimeout=window.setTimeout(a$,XA$1("VIDEO_FREEZE_DURATION")))},a$=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===UL$1.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=UL$1.VideoStateFrozen:document.addEventListener("visibilitychange",s$))},c$=(u$,l$)=>{if(this.videoElementStatus===ML$1.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=l$.mediaTime):this.renderStats={lastTs:l$.mediaTime,curTs:l$.mediaTime,lastRenderNum:0,renderNum:0},o$){const p$=l$.presentationTime-o$.presentationTime;this.videoState===UL$1.VideoStateStarting&&(this.videoState=UL$1.VideoStateDecoding),this.videoState===UL$1.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(a$,XA$1("VIDEO_FREEZE_DURATION"))),p$<XA$1("VIDEO_FREEZE_DURATION")&&this.videoState===UL$1.VideoStateFrozen&&(this.videoState=UL$1.VideoStateDecoding),p$>XA$1("VIDEO_FREEZE_DURATION")&&yU$1.lastVisibleTime>=yU$1.lastHiddenTime&&o$.timestamp>yU$1.lastVisibleTime&&o$.timestamp>yU$1.lastHiddenTime&&(this.renderFreezeAccTime+=p$)}o$=GL$1(GL$1({},l$),{},{timestamp:u$})}var d$,h$;XA$1("ENABLE_VIDEO_FRAME_CALLBACK")&&((d$=(h$=this.videoElement).requestVideoFrameCallback)===null||d$===void 0||d$.call(h$,c$))};(t$=(r$=this.videoElement).requestVideoFrameCallback)===null||t$===void 0||t$.call(r$,c$)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),fy$1()&&!XA$1("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const n$=Hv$1();n$.name==="Safari"&&Number(n$.version)===15||cy$1()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Zv$1()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Zv$1()&&this.videoElement.load());const i$=this.videoElement.play();i$!==void 0&&i$.catch(o$=>{fb$1.debug("[".concat(this.trackId,"] playback interrupted"),o$.toString())})}resetVideoElement(){yM$1.forEach(t$=>{this.videoElement&&this.videoElement.removeEventListener(t$,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=ML$1.NONE}handleAutoPlayFailed(){const t$=r$=>{r$.preventDefault(),this.videoElement.play().then(()=>{fb$1.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(n$=>{fb$1.error(n$)}),this.autoplayFailed=!1,my$1()?document.body.removeEventListener("click",t$,!0):(document.body.removeEventListener("touchstart",t$,!0),document.body.removeEventListener("mousedown",t$,!0))};my$1()?document.body.addEventListener("click",t$,!0):(document.body.addEventListener("touchstart",t$,!0),document.body.addEventListener("mousedown",t$,!0)),_k$1()}};const yM$1=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];let AM$1=class extends vM$1{constructor(t$){super(t$),BL$1(this,"container",void 0),BL$1(this,"slot",void 0),this.slot=t$.element,this.updateConfig(t$)}updateConfig(t$){this.config=t$,this.trackId=t$.trackId;const r$=t$.element;r$!==this.slot&&(this.destroy(),this.slot=r$),this.createElements()}updateVideoTrack(t$){this.videoTrack!==t$&&(this.videoTrack=t$,this.createElements())}play(t$){var r$;(r$=this.container)!==null&&r$!==void 0&&r$.contains(this.videoElement)&&super.play(t$)}getCurrentFrame(){var t$;return(t$=this.container)!==null&&t$!==void 0&&t$.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t$){var r$;let n$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(r$=this.container)!==null&&r$!==void 0&&r$.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t$,n$):await Nk$1(t$)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",XA$1("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t$;!this.container||(t$=this.container)!==null&&t$!==void 0&&t$.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t$;if((t$=this.container)!==null&&t$!==void 0&&t$.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t$;(t$=this.container)!==null&&t$!==void 0&&t$.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}};var bM$1,wM$1,OM$1,NM$1,DM$1,PM$1,LM$1,kM$1,MM$1,UM$1,xM$1,VM$1,FM$1,BM$1,jM$1,GM$1,WM$1,HM$1,KM$1,YM$1,qM$1,zM$1,JM$1,XM$1,QM$1,ZM$1,$M$1,eU$1,tU$1,iU$1,nU$1,rU$1,oU$1,sU$1;let aU$1=(bM$1=Ib$1({argsMap:(e$,t$,r$)=>[e$.getTrackId(),typeof t$=="string"?t$:t$ instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r$]}),wM$1=Tk$1(),OM$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),NM$1=DA$1("LocalVideoTrack","_enabledMutex"),DM$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),PM$1=Tk$1(),LM$1=DA$1("LocalVideoTrack","_enabledMutex"),kM$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),MM$1=Tk$1(),UM$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),xM$1=Tk$1(),VM$1=Tk$1(),FM$1=Ib$1({argsMap:(e$,t$,r$)=>[e$.getTrackId(),t$,r$]}),BM$1=Tk$1(),jM$1=Tk$1(),GM$1=Tk$1(),WM$1=Tk$1(),HM$1=Tk$1(),KM$1=Tk$1(),YM$1=Tk$1(),qM$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$.name]}),zM$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),JM$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),XM$1=Ib$1({argsMap:(e$,t$,r$)=>[e$.getTrackId(),t$.label,r$]}),QM$1=class b5 extends HL$1{get videoHeight(){if(Xv$1()){const{height:t$}=this._mediaStreamTrack.getSettings();return this._videoHeight=t$,this._videoHeight}return this._videoHeight}get videoWidth(){if(Xv$1()){const{width:t$}=this._mediaStreamTrack.getSettings();return this._videoWidth=t$,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ML$1.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t$){this._processorContext=t$}get __className__(){return"LocalVideoTrack"}constructor(t$,r$,n$,i$,o$,s$){if(super(t$,o$),BL$1(this,"trackMediaType",vL$1.VIDEO),BL$1(this,"_player",void 0),BL$1(this,"isUseScaleResolutionDownBy",!1),BL$1(this,"_videoVisibleTimer",null),BL$1(this,"_previousVideoVisibleStatus",void 0),BL$1(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),BL$1(this,"_encoderConfig",void 0),BL$1(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),BL$1(this,"_optimizationMode",void 0),BL$1(this,"_videoHeight",void 0),BL$1(this,"_videoWidth",void 0),BL$1(this,"_forceBitrateLimit",void 0),BL$1(this,"_enabled",!0),BL$1(this,"_processorDestination",void 0),BL$1(this,"_processorContext",void 0),Xv$1()){const{width:a$,height:c$}=t$.getSettings();this._videoWidth=a$,this._videoHeight=c$}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=r$,this._scalabilityMode=n$,this._optimizationMode=i$,this._hints=s$||[],this._hints.indexOf(mL$1.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(a$,c$,u$){const l$=Hv$1();return!(l$.name!==a$||!l$.osVersion)&&Number(l$.version)===c$}(Bv$1.CHROME,115)&&Yv$1().indexOf("Windows")!==-1){const a$=function(c$,u$){if("VideoFrame"in window&&"TransformStream"in window&&ZP$1().supportWebRTCInsertableStream){const l$=new MediaStreamTrackProcessor(c$),d$=new MediaStreamTrackGenerator({kind:"video"});let h$,p$,_$=Date.now();const f$=()=>{m$&&(clearInterval(m$),m$=void 0),h$&&(h$.close(),h$=void 0),c$.stop(),p$=void 0,d$.removeEventListener("ended",f$)};let m$=window.setInterval(()=>{if(p$&&h$&&Date.now()-_$>1e3)try{d$.readyState==="live"?p$.enqueue(h$.clone()):f$()}catch{f$()}},1e3);const g$=new TransformStream({transform:(v$,y$)=>{d$.readyState==="live"?(p$=y$,_$=Date.now(),h$===void 0?(h$=v$,y$.enqueue(v$.clone())):(y$.enqueue(h$),h$=v$)):v$.close()}});return d$.addEventListener("ended",f$),l$.readable.pipeThrough(g$).pipeTo(d$.writable),d$}}(t$);a$&&(fb$1.info("local screen video track begin to inject frame"),this._mediaStreamTrack=a$)}r$&&this._hints.indexOf(mL$1.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(r$),this._processorContext=new gk$1(this.getTrackId(),"local"),this._processorDestination=new Sk$1(this.processorContext),this.bindProcessorDestinationEvents()}play(t$){let r$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t$=="string"){const i$=document.getElementById(t$);i$?t$=i$:(fb$1.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t$,'" element, use document.body')),t$=document.body)}fb$1.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t$ instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r$));const n$=GL$1(GL$1(GL$1({},this._getDefaultPlayerConfig()),r$),{},{trackId:this.getTrackId(),element:t$});this._player?this._player.updateConfig(n$):(t$ instanceof HTMLVideoElement?this._player=new vM$1(n$):this._player=new AM$1(n$),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i$=this.getVideoElementVisibleStatus();this.safeEmit(CL$1.VIDEO_ELEMENT_VISIBLE_STATUS,i$)}catch{}},XA$1("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,fb$1.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t$,r$){if(!r$){if(t$===this._enabled)return;this.stateCheck("enabled",t$)}if(fb$1.info("[".concat(this.getTrackId(),"] start setEnabled"),t$),!t$){this._originMediaStreamTrack.enabled=!1;try{await $y$1(this,fL$1.NEED_DISABLE_TRACK,this)}catch(n$){throw fb$1.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n$.toString()),n$}return r$||(this._enabled=!1),void fb$1.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await $y$1(this,fL$1.NEED_ENABLE_TRACK,this)}catch(n$){throw fb$1.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n$.toString()),n$}fb$1.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r$||(this._enabled=!0)}async setMuted(t$){t$!==this._muted&&(this.stateCheck("muted",t$),this._muted=t$,this._originMediaStreamTrack.enabled=!t$,fb$1.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t$)),t$?await $y$1(this,fL$1.NEED_MUTE_TRACK,this):await $y$1(this,fL$1.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t$,r$){if(!this._enabled)throw new Cy$1(Ry$1.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t$=dL$1(t$),this._forceBitrateLimit&&(t$.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t$.bitrateMax,t$.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t$.bitrateMin),t$.width||t$.height||t$.frameRate){const n$=Ak$1({encoderConfig:t$});(Xv$1()||$v$1()||uy$1())&&(n$.deviceId=void 0),fb$1.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t$),JSON.stringify(n$));try{await this._originMediaStreamTrack.applyConstraints(n$),this.updateMediaStreamTrackResolution()}catch(i$){const o$=new Cy$1(Ry$1.UNEXPECTED_ERROR,i$.toString());throw fb$1.error("[".concat(this.getTrackId(),"] applyConstraints error"),o$.toString()),o$}}this._encoderConfig=t$,this._hints.indexOf(mL$1.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await $y$1(this,fL$1.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n$){return n$.throw(fb$1)}}getStats(){return dA$1(()=>{fb$1.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),eA$1(this,fL$1.GET_STATS)||GL$1({},bL$1)}async setBeautyEffect(t$){fb$1.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t$){let r$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t$,r$):await Nk$1(t$)}async setBitrateLimit(t$){if(fb$1.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t$))),t$){this._forceBitrateLimit=t$,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t$.max_bitrate?this._encoderConfig.bitrateMax:t$.max_bitrate:this._encoderConfig.bitrateMax=t$.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t$.min_bitrate);try{await $y$1(this,fL$1.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r$){return r$.throw(fb$1)}}}async setOptimizationMode(t$){if(t$!=="motion"&&t$!=="detail"&&t$!=="balanced")return void fb$1.error(Ry$1.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const r$=this._optimizationMode;try{this._optimizationMode=t$,await $y$1(this,fL$1.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(n$){throw this._optimizationMode=r$,fb$1.error("[".concat(this.getTrackId(),"] set optimization mode failed"),n$.toString()),n$}fb$1.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t$,")"))}setScalabiltyMode(t$){if(t$.numSpatialLayers===1&&t$.numTemporalLayers!==1)return fb$1.error(Ry$1.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t$,fb$1.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t$,")"))}updateMediaStreamTrackResolution(){yk$1(this._originMediaStreamTrack).then(t$=>{let[r$,n$]=t$;this._videoHeight=n$,this._videoWidth=r$}).catch(gA$1)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t$){if(!this._enabled)throw new Cy$1(Ry$1.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");fb$1.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t$)),t$=dL$1(t$),this._forceBitrateLimit&&(t$.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t$.bitrateMax,t$.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t$.bitrateMin),this._encoderConfig=t$,this._hints.indexOf(mL$1.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await $y$1(this,fL$1.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r$){return r$.throw(fb$1)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t$,height:r$,frameRate:n$}=this.getMediaStreamTrackSettings();if(!t$||!r$||!n$)return;const{bitrateMax:i$,bitrateMin:o$}=this._encoderConfig;if(o$==null||i$==null){const{max:s$,min:a$}=function(c$,u$,l$,d$,h$){const p$=XA$1("BITRATE_ADAPTER_TYPE");if(p$==="DEFAULT_BITRATE")return{min:d$,max:h$};if(h$===void 0){var _$;const m$=Math.floor(200*Math.pow(l$/15,.6)*Math.pow(c$*u$/640/360,.75));h$=p$==="STANDARD_BITRATE"?4*m$:2*m$,d$=(_$=d$)!==null&&_$!==void 0?_$:m$}else{var f$;d$=(f$=d$)!==null&&f$!==void 0?f$:Math.floor(h$/10)}return{min:d$,max:h$}}(t$,r$,n$,o$,i$);this._encoderConfig.bitrateMin=a$,this._encoderConfig.bitrateMax=s$,fb$1.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t$,", h: ").concat(r$,", fps: ").concat(n$,"] => [brMax: ").concat(s$,", brMin: ").concat(a$,"]"))}}getVideoElementVisibleStatus(){try{var t$,r$;const n$=this==null||(t$=this._player)===null||t$===void 0?void 0:t$.getContainerElement(),i$={track:this,element:this==null||(r$=this._player)===null||r$===void 0?void 0:r$.getVideoElement(),slot:n$==null?void 0:n$.parentElement},{element:o$,slot:s$}=i$;if(this.isPlaying&&o$ instanceof HTMLVideoElement&&s$ instanceof HTMLElement){const a$=Ly$1.checkOneElementVisible(o$),c$=Object.assign({},a$);if(c$.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c$.visible;const u$=vb$1.reportApiInvoke(null,{tag:jy$1.TRACER,name:By$1.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});c$.visible?u$.onSuccess("Video is visible"):u$.onSuccess("Invisible because of ".concat(c$.reason))}return c$}return}catch(n$){throw new Cy$1(Ry$1.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n$.message)}}async renewMediaStreamTrack(t$){}pipe(t$){if(this.processor===t$)return t$;if(t$._source)throw new Cy$1(Ry$1.INVALID_OPERATION,"Processor ".concat(t$.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t$,this.processor._source=this,t$.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t$}unpipe(){if(!this.processor)return;const t$=this.processor;this.processor._source=void 0,this.processor=void 0,t$.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t$){let r$=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n$=this._encoderConfig;t$&&(n$=GL$1(GL$1({},n$),dL$1(t$))),n$=aA$1(n$);const i$=TA$1(8,"track-video-cloned-"),o$=new b5(r$?this._mediaStreamTrack.clone():this._mediaStreamTrack,n$,aA$1(this._scalabilityMode),this._optimizationMode,i$,aA$1(this._hints));return t$&&n$&&o$.setEncoderConfiguration(n$),fb$1.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i$,", clone ").concat(r$)),o$}async replaceTrack(t$,r$){if(!(t$ instanceof MediaStreamTrack))throw new Cy$1(Ry$1.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t$.kind!=="video")throw new Cy$1(Ry$1.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t$,r$,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t$){if(dA$1(()=>{vb$1.reportApiInvoke(null,{name:By$1.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:jy$1.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!XA$1("ENABLE_VIDEO_SEI")||!XA$1("ENABLE_ENCODED_TRANSFORM"))return void fb$1.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t$ instanceof Uint8Array==0)return new Cy$1(Ry$1.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const r$=this.getRTCRtpTransceiver();if(!r$)return void fb$1.warning("Video track is not published, SEI can not be send");const n$=r$.sender.getParameters();if(n$.codecs.length===0)return;const i$=n$.codecs[0].mimeType.toLocaleLowerCase();i$==="video/h264"?this.safeEmit("sei-to-send",t$):fb$1.warning("SEI is not supported by ".concat(i$))}bindProcessorDestinationEvents(){this.processorDestination.on(DL$1.ON_TRACK,async t$=>{t$?t$!==this._mediaStreamTrack&&(this._mediaStreamTrack=t$,this._updatePlayerSource(),await $y$1(this,fL$1.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $y$1(this,fL$1.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(DL$1.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(PL$1.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(PL$1.REQUEST_CONSTRAINTS)}},FL$1(QM$1.prototype,"play",[bM$1,wM$1],Object.getOwnPropertyDescriptor(QM$1.prototype,"play"),QM$1.prototype),FL$1(QM$1.prototype,"stop",[OM$1],Object.getOwnPropertyDescriptor(QM$1.prototype,"stop"),QM$1.prototype),FL$1(QM$1.prototype,"setEnabled",[NM$1,DM$1,PM$1],Object.getOwnPropertyDescriptor(QM$1.prototype,"setEnabled"),QM$1.prototype),FL$1(QM$1.prototype,"setMuted",[LM$1,kM$1,MM$1],Object.getOwnPropertyDescriptor(QM$1.prototype,"setMuted"),QM$1.prototype),FL$1(QM$1.prototype,"setEncoderConfiguration",[UM$1,xM$1],Object.getOwnPropertyDescriptor(QM$1.prototype,"setEncoderConfiguration"),QM$1.prototype),FL$1(QM$1.prototype,"getStats",[VM$1],Object.getOwnPropertyDescriptor(QM$1.prototype,"getStats"),QM$1.prototype),FL$1(QM$1.prototype,"setBeautyEffect",[FM$1,BM$1],Object.getOwnPropertyDescriptor(QM$1.prototype,"setBeautyEffect"),QM$1.prototype),FL$1(QM$1.prototype,"getCurrentFrameData",[jM$1],Object.getOwnPropertyDescriptor(QM$1.prototype,"getCurrentFrameData"),QM$1.prototype),FL$1(QM$1.prototype,"getCurrentFrameImage",[GM$1],Object.getOwnPropertyDescriptor(QM$1.prototype,"getCurrentFrameImage"),QM$1.prototype),FL$1(QM$1.prototype,"setBitrateLimit",[WM$1],Object.getOwnPropertyDescriptor(QM$1.prototype,"setBitrateLimit"),QM$1.prototype),FL$1(QM$1.prototype,"setOptimizationMode",[HM$1],Object.getOwnPropertyDescriptor(QM$1.prototype,"setOptimizationMode"),QM$1.prototype),FL$1(QM$1.prototype,"setScalabiltyMode",[KM$1],Object.getOwnPropertyDescriptor(QM$1.prototype,"setScalabiltyMode"),QM$1.prototype),FL$1(QM$1.prototype,"updateMediaStreamTrackResolution",[YM$1],Object.getOwnPropertyDescriptor(QM$1.prototype,"updateMediaStreamTrackResolution"),QM$1.prototype),FL$1(QM$1.prototype,"pipe",[qM$1],Object.getOwnPropertyDescriptor(QM$1.prototype,"pipe"),QM$1.prototype),FL$1(QM$1.prototype,"unpipe",[zM$1],Object.getOwnPropertyDescriptor(QM$1.prototype,"unpipe"),QM$1.prototype),FL$1(QM$1.prototype,"close",[JM$1],Object.getOwnPropertyDescriptor(QM$1.prototype,"close"),QM$1.prototype),FL$1(QM$1.prototype,"replaceTrack",[XM$1],Object.getOwnPropertyDescriptor(QM$1.prototype,"replaceTrack"),QM$1.prototype),QM$1),cU$1=(ZM$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),$M$1=Tk$1(),eU$1=DA$1("CameraVideoTrack","_enabledMutex"),tU$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),iU$1=Tk$1(),nU$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),rU$1=Tk$1(),oU$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),sU$1=class $5 extends aU$1{get __className__(){return"CameraVideoTrack"}constructor(t$,r$,n$,i$,o$,s$){super(t$,dL$1(r$.encoderConfig),i$,o$,s$),BL$1(this,"_config",void 0),BL$1(this,"_originalConstraints",void 0),BL$1(this,"_constraints",void 0),BL$1(this,"_enabled",!0),BL$1(this,"_deviceName","default"),BL$1(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(cy$1()||dy$1())&&!function(){const a$=Hv$1();if(a$.os!==Fv$1.IOS||!a$.osVersion)return!1;const c$=a$.osVersion.split(".");return Number(c$[0])===15&&Number(c$[1])>=2}()&&hy$1()&&this._enabled&&!this._isClosed&&(fb$1.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=r$,this._originalConstraints=n$,this._constraints=n$,this._deviceName=t$.label,this._encoderConfig=dL$1(this._config.encoderConfig),qL$1.on(tL$1.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),qL$1.on(tL$1.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t$){return typeof t$=="string"?this._setDeviceById(t$):t$.deviceId?this._setDeviceById(t$.deviceId):t$.facingMode?this._setDeviceByFacingModel(t$.facingMode):void 0}async _setDeviceById(t$){if(fb$1.info("[".concat(this.getTrackId(),"] set device to ").concat(t$)),this._enabled)try{const r$=await uk$1.getDeviceById(t$),n$={};n$.video=GL$1({},this._constraints),n$.video.deviceId={exact:t$},n$.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i$=null;try{i$=await ak$1(n$,this.getTrackId())}catch(o$){throw fb$1.error("[".concat(this.getTrackId(),"] setDevice failed"),o$.toString()),i$=await ak$1({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i$.getVideoTracks()[0],!1),o$}await this._updateOriginMediaStreamTrack(i$.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=r$.label,this._config.cameraId=t$,this._constraints.deviceId={exact:t$}}catch(r$){throw fb$1.error("[".concat(this.getTrackId(),"] setDevice error"),r$.toString()),r$}else try{const r$=await uk$1.getDeviceById(t$);this._deviceName=r$.label,this._config.cameraId=t$,this._constraints.deviceId={exact:t$}}catch(r$){throw fb$1.error("[".concat(this.getTrackId(),"] setDevice error"),r$.toString()),r$}fb$1.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t$){fb$1.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t$));const r$={video:GL$1(GL$1({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t$}})};if(this._enabled){this._originMediaStreamTrack.stop();let n$=null;try{n$=await ak$1(r$,this.getTrackId())}catch(i$){throw fb$1.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i$.toString()),n$=await ak$1({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n$.getVideoTracks()[0],!1),i$}await this._updateOriginMediaStreamTrack(n$.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t$,this._config.cameraId=void 0,this._constraints=GL$1({},r$.video),fb$1.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t$,r$){if(!r$){if(t$===this._enabled)return;this.stateCheck("enabled",t$)}if(fb$1.info("[".concat(this.getTrackId(),"] start setEnabled"),t$),t$){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const n$=await ak$1({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n$.getVideoTracks()[0],!1)}await $y$1(this,fL$1.NEED_ENABLE_TRACK,this)}catch(n$){throw fb$1.error("[".concat(this.getTrackId(),"] setEnabled true error"),n$.toString()),n$}this.updateMediaStreamTrackResolution(),fb$1.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r$||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),r$||(this._enabled=!1);try{await $y$1(this,fL$1.NEED_DISABLE_TRACK,this)}catch(n$){throw fb$1.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n$.toString()),n$}fb$1.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t$,r$){if(!this._enabled)throw new Cy$1(Ry$1.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t$=dL$1(t$),this._forceBitrateLimit&&(t$.bitrateMax=this._forceBitrateLimit.max_bitrate||t$.bitrateMax,t$.bitrateMin=this._forceBitrateLimit.min_bitrate||t$.bitrateMin);const n$=sA$1(this._config);n$.encoderConfig=t$;const i$=Ak$1(n$);(Xv$1()||$v$1()||uy$1())&&(i$.deviceId=void 0),fb$1.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t$),JSON.stringify(i$));try{await this._originMediaStreamTrack.applyConstraints(i$),this.updateMediaStreamTrackResolution()}catch(o$){const s$=new Cy$1(Ry$1.UNEXPECTED_ERROR,o$.toString());throw fb$1.error("[".concat(this.getTrackId(),"] applyConstraints error"),s$.toString()),s$}this._config=n$,this._constraints=i$,this._originalConstraints=i$,this._encoderConfig=t$,this._hints.indexOf(mL$1.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await $y$1(this,fL$1.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o$){return o$.throw(fb$1)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if(($v$1()||uy$1())&&this._enabled&&!this._isClosed&&qL$1.duringInterruption){const t$=async()=>{qL$1.off(tL$1.IOS_INTERRUPTION_END,t$),this._enabled&&!this._isClosed&&(fb$1.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};qL$1.on(tL$1.IOS_INTERRUPTION_END,t$)}else fb$1.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(CL$1.TRACK_ENDED)}async renewMediaStreamTrack(t$){const r$=t$||this._constraints,n$=uk$1.searchDeviceIdByName(this._deviceName);if(n$&&!r$.deviceId&&(r$.deviceId={exact:n$}),this._enabled){const i$=await ak$1({video:r$},this.getTrackId());this._constraints=r$,await this._updateOriginMediaStreamTrack(i$.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),qL$1.off(tL$1.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),qL$1.off(tL$1.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t$){let r$=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n$=this._encoderConfig;t$&&(n$=GL$1(GL$1({},n$),dL$1(t$))),n$=aA$1(n$);const i$=TA$1(8,"track-cam-cloned-"),o$=new $5(r$?this._mediaStreamTrack.clone():this._mediaStreamTrack,aA$1(GL$1(GL$1({},this._config),{},{encoderConfig:n$})),aA$1(this._constraints),aA$1(this._scalabilityMode),this._optimizationMode,i$);return t$&&n$&&o$.setEncoderConfiguration(n$),fb$1.debug("clone track from ".concat(this.getTrackId()," to ").concat(i$,", clone ").concat(r$)),o$}bindProcessorContextEvents(){this.processorContext.on(PL$1.REQUEST_UPDATE_CONSTRAINTS,async(t$,r$,n$)=>{try{const i$=Object.assign({},this._originalConstraints,...t$);await this.renewMediaStreamTrack(i$),r$()}catch(i$){n$(i$)}}),this.processorContext.on(PL$1.REQUEST_CONSTRAINTS,async t$=>{t$(this._originMediaStreamTrack.getSettings())})}},FL$1(sU$1.prototype,"setDevice",[ZM$1,$M$1],Object.getOwnPropertyDescriptor(sU$1.prototype,"setDevice"),sU$1.prototype),FL$1(sU$1.prototype,"setEnabled",[eU$1,tU$1,iU$1],Object.getOwnPropertyDescriptor(sU$1.prototype,"setEnabled"),sU$1.prototype),FL$1(sU$1.prototype,"setEncoderConfiguration",[nU$1,rU$1],Object.getOwnPropertyDescriptor(sU$1.prototype,"setEncoderConfiguration"),sU$1.prototype),FL$1(sU$1.prototype,"close",[oU$1],Object.getOwnPropertyDescriptor(sU$1.prototype,"close"),sU$1.prototype),sU$1);function dU$1(e$,t$,r$,n$){r$.optimizationMode&&(n$&&n$.width&&n$.height?(r$.encoderConfig=GL$1(GL$1({},n$),{},{bitrateMin:n$.bitrateMin,bitrateMax:n$.bitrateMax}),r$.optimizationMode!=="motion"&&r$.optimizationMode!=="detail"||(t$.contentHint=r$.optimizationMode,t$.contentHint===r$.optimizationMode?fb$1.debug("[".concat(e$,"] set content hint to"),r$.optimizationMode):fb$1.debug("[".concat(e$,"] set content hint failed")))):fb$1.warning("[".concat(e$,"] can not apply optimization mode bitrate config, no encoderConfig")))}var lU$1,uU$1,hU$1,pU$1,_U$1,EU$1,fU$1,mU$1,TU$1,SU$1,gU$1,RU$1;let CU$1=class extends WL$1{getUserId(){return this._userId}constructor(t$,r$,n$,i$){super(t$,"track-".concat(t$.kind,"-").concat(r$,"-").concat(i$.clientId,"_").concat(TA$1(5,""))),BL$1(this,"_userId",void 0),BL$1(this,"_uintId",void 0),BL$1(this,"_isDestroyed",!1),BL$1(this,"store",void 0),BL$1(this,"processor",void 0),BL$1(this,"processorContext",void 0),this._userId=r$,this._uintId=n$,this.store=i$}_updateOriginMediaStreamTrack(t$){this._originMediaStreamTrack=t$,this._mediaStreamTrack=t$,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,fb$1.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}},IU$1=(lU$1=Ib$1({argsMap:(e$,t$,r$)=>[e$.getTrackId(),typeof t$=="string"?t$:t$ instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r$]}),uU$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),hU$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$.name]}),pU$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),FL$1((_U$1=class extends CU$1{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ML$1.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e$,t$,r$,n$){super(e$,t$,r$,n$),BL$1(this,"_videoVisibleTimer",null),BL$1(this,"_previousVideoVisibleStatus",void 0),BL$1(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),BL$1(this,"trackMediaType",vL$1.VIDEO),BL$1(this,"_videoWidth",void 0),BL$1(this,"_videoHeight",void 0),BL$1(this,"_player",void 0),BL$1(this,"processorDestination",void 0),BL$1(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new gk$1(this.getTrackId(),"remote"),this.processorDestination=new Sk$1(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return dA$1(()=>{fb$1.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),eA$1(this,fL$1.GET_STATS)||GL$1({},NL$1)}play(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e$=="string"){const n$=document.getElementById(e$);n$?e$=n$:(fb$1.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e$,'" element, use document.body')),e$=document.body)}fb$1.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e$ instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t$));const r$=GL$1(GL$1({fit:"cover"},t$),{},{trackId:this.getTrackId(),element:e$});this._player?this._player.updateConfig(r$):(e$ instanceof HTMLVideoElement?this._player=new vM$1(r$):this._player=new AM$1(r$),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(IL$1.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=n$=>{this.safeEmit(IL$1.VIDEO_STATE_CHANGED,n$)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const n$=this.getVideoElementVisibleStatus();this.safeEmit(IL$1.VIDEO_ELEMENT_VISIBLE_STATUS,n$)}catch{}},XA$1("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,fb$1.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){yk$1(this._originMediaStreamTrack).then(e$=>{let[t$,r$]=e$;this._videoHeight=r$,this._videoWidth=t$}).catch(gA$1)}_updatePlayerSource(){fb$1.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e$,t$;const r$=this==null||(e$=this._player)===null||e$===void 0?void 0:e$.getContainerElement(),n$={track:this,element:this==null||(t$=this._player)===null||t$===void 0?void 0:t$.getVideoElement(),slot:r$==null?void 0:r$.parentElement},{element:i$,slot:o$}=n$;if(this.isPlaying&&i$ instanceof HTMLVideoElement&&o$ instanceof HTMLElement){const s$=Ly$1.checkOneElementVisible(i$),a$=Object.assign({},s$);if(a$.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=a$.visible;const c$=vb$1.reportApiInvoke(null,{tag:jy$1.TRACER,name:By$1.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});a$.visible?c$.onSuccess("Video is visible"):c$.onSuccess("Invisible because of ".concat(a$.reason))}return a$}return}catch(r$){throw new Cy$1(Ry$1.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r$.message)}}pipe(e$){if(this.processor===e$)return e$;if(e$._source)throw new Cy$1(Ry$1.INVALID_OPERATION,"Processor ".concat(e$.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e$,this.processor._source=this,e$.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e$}unpipe(){if(!this.processor)return;const e$=this.processor;this.processor._source=void 0,this.processor=void 0,e$.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(DL$1.ON_TRACK,async e$=>{e$?e$!==this._mediaStreamTrack&&(this._mediaStreamTrack=e$,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(DL$1.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e$){this.emit(RL$1.SEI_RECEIVED,e$)}}).prototype,"play",[lU$1],Object.getOwnPropertyDescriptor(_U$1.prototype,"play"),_U$1.prototype),FL$1(_U$1.prototype,"stop",[uU$1],Object.getOwnPropertyDescriptor(_U$1.prototype,"stop"),_U$1.prototype),FL$1(_U$1.prototype,"pipe",[hU$1],Object.getOwnPropertyDescriptor(_U$1.prototype,"pipe"),_U$1.prototype),FL$1(_U$1.prototype,"unpipe",[pU$1],Object.getOwnPropertyDescriptor(_U$1.prototype,"unpipe"),_U$1.prototype),_U$1),vU$1=(EU$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$],throttleTime:300}),fU$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),mU$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),TU$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),SU$1=Ib$1({argsMap:(e$,t$)=>[e$.getTrackId(),t$.name]}),gU$1=Ib$1({argsMap:e$=>[e$.getTrackId()]}),FL$1((RU$1=class extends CU$1{get isPlaying(){return this._useAudioElement?mk$1.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e$,t$,r$,n$){super(e$,t$,r$,n$),BL$1(this,"trackMediaType",vL$1.AUDIO),BL$1(this,"_source",void 0),BL$1(this,"_useAudioElement",!0),BL$1(this,"_volume",100),BL$1(this,"processorContext",void 0),BL$1(this,"processorDestination",void 0),BL$1(this,"_played",!1),BL$1(this,"_bypassWebAudio",!1),XA$1("DISABLE_WEBAUDIO")?(this._source=new Ik$1,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new ek$1(e$,!0),XA$1("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(yL$1.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(IL$1.FIRST_FRAME_DECODED)}),this.processorContext=new Ck$1(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Rk$1(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(yL$1.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e$)return this._source.removeAllListeners(yL$1.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t$),this._source.removeAllListeners(yL$1.ON_AUDIO_BUFFER),this._source.on(yL$1.ON_AUDIO_BUFFER,r$=>e$(r$))}setVolume(e$){this._volume=e$,this._useAudioElement?mk$1.setVolume(this.getTrackId(),e$):this._source.setVolume(e$/100)}async setPlaybackDevice(e$){if(!this._useAudioElement||!$P$1())throw new Cy$1(Ry$1.NOT_SUPPORTED,"your browser does not support setting the audio output device");await mk$1.setSinkID(this.getTrackId(),e$)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return dA$1(()=>{fb$1.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),eA$1(this,fL$1.GET_STATS)||GL$1({},wL$1)}play(){fb$1.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(fb$1.debug("[".concat(this.getTrackId(),"] use audio element to play")),mk$1.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){fb$1.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?mk$1.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e$=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];fb$1.debug("[".concat(this.getTrackId(),"] update player source track")),e$&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&mk$1.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e$){if(this._bypassWebAudio)throw new Cy$1(Ry$1.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e$)return e$;if(e$._source)throw new Cy$1(Ry$1.INVALID_OPERATION,"Processor ".concat(e$.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e$,this.processor._source=this,e$.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e$}unpipe(){var e$;if(this._bypassWebAudio)throw new Cy$1(Ry$1.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t$=this.processor;(e$=this._source.processSourceNode)===null||e$===void 0||e$.disconnect(),this.processor._source=!1,this.processor=void 0,t$.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(DL$1.ON_TRACK,async e$=>{e$?e$!==this._mediaStreamTrack&&(this._mediaStreamTrack=e$,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e$)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(DL$1.ON_NODE,e$=>{this._source.processedNode=e$;const t$=!e$;this._useAudioElement!==t$&&(this._played?(this.stop(),this._useAudioElement=t$,this.play()):this._useAudioElement=t$)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(DL$1.ON_TRACK),this.processorDestination.removeAllListeners(DL$1.ON_NODE)}}).prototype,"setVolume",[EU$1],Object.getOwnPropertyDescriptor(RU$1.prototype,"setVolume"),RU$1.prototype),FL$1(RU$1.prototype,"setPlaybackDevice",[fU$1],Object.getOwnPropertyDescriptor(RU$1.prototype,"setPlaybackDevice"),RU$1.prototype),FL$1(RU$1.prototype,"play",[mU$1],Object.getOwnPropertyDescriptor(RU$1.prototype,"play"),RU$1.prototype),FL$1(RU$1.prototype,"stop",[TU$1],Object.getOwnPropertyDescriptor(RU$1.prototype,"stop"),RU$1.prototype),FL$1(RU$1.prototype,"pipe",[SU$1],Object.getOwnPropertyDescriptor(RU$1.prototype,"pipe"),RU$1.prototype),FL$1(RU$1.prototype,"unpipe",[gU$1],Object.getOwnPropertyDescriptor(RU$1.prototype,"unpipe"),RU$1.prototype),RU$1);const yU$1=new class extends xy$1{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),BL$1(this,"_lastHiddenTime",0),BL$1(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),fb$1.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};let AU$1=class extends xy$1{constructor(t$,r$){super(),BL$1(this,"trackMediaType",vL$1.DATA),BL$1(this,"_version",1),BL$1(this,"_type",3),BL$1(this,"_config",void 0),BL$1(this,"_originDataChannel",void 0),BL$1(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),BL$1(this,"_dataStreamPacketHandler",{serialize:n$=>n$,deserialize:n$=>n$}),BL$1(this,"_datachannelEventMap",new Map),this._config=t$,r$&&(this._originDataChannel=r$,this._bandDataChannelEvents(r$)),this._initPacketHeader()}useDataStream(t$){this._dataStreamPacketHandler=t$}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return XA$1("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t$,r$;return(t$=(r$=this._originDataChannel)===null||r$===void 0?void 0:r$.readyState)!==null&&t$!==void 0?t$:"connecting"}get _originDataChannelId(){var t$,r$;return(t$=(r$=this._originDataChannel)===null||r$===void 0?void 0:r$.id)!==null&&t$!==void 0?t$:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Gh$1((t$,r$)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t$();const n$=setTimeout(()=>{var i$;r$(new Cy$1(Ry$1.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i$=this._originDataChannel)===null||i$===void 0?void 0:i$.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(n$),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t$()},this._originDataChannel.onerror=()=>{throw clearTimeout(n$),new Cy$1(Ry$1.DATACHANNEL_CONNECTION_TIMEOUT)}}else r$(new Cy$1(Ry$1.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t$){this._originDataChannel=t$,this._bandDataChannelEvents(t$)}_initPacketHeader(){const t$=new DataView(this._dataStreamPacketHeader);t$.setUint16(0,this._version),t$.setUint8(2,this._type),t$.setUint8(3,this._config.id)}_bandDataChannelEvents(t$){this._unbindDataChannelEvents(t$),[VL$1.OPEN,VL$1.CLOSE,VL$1.ERROR].forEach(r$=>{const n$=()=>{this.emit(r$)};this._datachannelEventMap.set(r$,n$),t$.addEventListener(r$,n$)})}_unbindDataChannelEvents(t$){Array.from(this._datachannelEventMap.entries()).forEach(r$=>{let[n$,i$]=r$;t$.removeEventListener(n$,i$)}),this._datachannelEventMap.clear()}},bU$1=class extends AU$1{constructor(t$){super(t$),BL$1(this,"_messageListener",void 0),this._messageListener=r$=>{if(r$.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const n$=r$.data.slice(0,this._dataStreamPacketHeader.byteLength),i$=new DataView(n$).getUint8(3);if(i$!==this.id)return void(XA$1("SHOW_DATASTREAM2_LOG")&&fb$1.debug("invalid datachannel id: ".concat(i$," !== ").concat(this.id)));let o$=r$.data.slice(this._dataStreamPacketHeader.byteLength);o$=this._dataStreamPacketHandler.deserialize(o$),this.emit(VL$1.MESSAGE,o$)}}_updateOriginDataChannel(t$){super._updateOriginDataChannel(t$),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}},wU$1=class extends AU$1{send(t$){if(this._originDataChannel){let r$=t$;r$=this._dataStreamPacketHandler.serialize(t$);const n$=new Uint8Array(this._dataStreamPacketHeader.byteLength+r$.byteLength);n$.set(new Uint8Array(this._dataStreamPacketHeader),0),n$.set(new Uint8Array(r$),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n$.buffer)}}};function OU$1(){const e$=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>XP$1.revokeObjectURL(e$),0),new Worker(XP$1.createObjectURL(e$))}const NU$1=new Map,DU$1=new Map;function PU$1(e$,t$,r$){let n$=new Uint8Array(e$,t$,r$),i$=[],o$=0;for(;i$.length<r$;)o$+3<r$&&n$[o$]===0&&n$[o$+1]===0&&n$[o$+2]===3&&(n$[o$+3]===0||n$[o$+3]===1||n$[o$+3]===2||n$[o$+3]===3)?(i$.push(n$[o$],n$[o$+1],n$[o$+3]),o$+=4):(i$.push(n$[o$]),o$++);return new Uint8Array(i$)}const LU$1=new Map;async function kU$1(e$,t$){if(!ZP$1().supportWebRTCEncodedTransform)return void fb$1.warning("browser not support video encoded transform");if(LU$1.has(e$)||!e$.track)return;const r$={track:e$.track};if(Jv$1()){if(!e$.createEncodedStreams)return void fb$1.warning("browser not support createEncodedStreams() API");let i$=null;try{i$=e$.createEncodedStreams()}catch(a$){return void fb$1.error("create video-encoded-streams error",a$&&a$.message)}let o$=[];t$.on("sei-to-send",a$=>{o$.push(a$)});const s$=new TransformStream({transform(a$,c$){r$.controller||(r$.controller=c$),e$.track&&e$.track.id!==r$.track.id&&(fb$1.debug("video track changed: ".concat(r$.track.id," => ").concat(e$.track.id)),r$.track.removeEventListener("ended",n$),r$.track=e$.track,r$.track.addEventListener("ended",n$));const u$=o$.shift();u$&&(a$.data=function(l$,d$){const h$=function(v$){const y$=v$.length;let S$=[],b$=0;for(;b$<y$;)b$+2<y$&&v$[b$]===0&&v$[b$+1]===0&&(v$[b$+2]===0||v$[b$+2]===1||v$[b$+2]===2||v$[b$+2]===3)?(S$.push(v$[b$],v$[b$+1],3,v$[b$+2]),b$+=3):(S$.push(v$[b$]),b$++);return new Uint8Array(S$)}(d$),p$=h$.length,_$=Math.floor(p$/255),f$=p$%255,m$=new Uint8Array(6+_$+1+p$+l$.byteLength);m$[0]=0,m$[1]=0,m$[2]=0,m$[3]=1,m$[4]=6,m$[5]=101;let g$=0;for(;g$<_$;)m$[6+g$]=255,g$++;return m$[6+g$]=f$,g$++,m$.set(h$,6+g$),m$.set(new Uint8Array(l$),6+g$+p$),m$.buffer}(a$.data,u$)),c$.enqueue(a$)}});i$.readable.pipeThrough(s$).pipeTo(i$.writable)}else{if(!Xv$1())return;{if(typeof RTCRtpScriptTransform>"u")return void fb$1.warning("browser not support RTCRtpScriptTransform");const i$=OU$1(),o$=new MessageChannel;await new Gh$1(a$=>i$.onmessage=c$=>{c$.data==="registered"&&a$(void 0)});const s$=new RTCRtpScriptTransform(i$,{name:"tx",port:o$.port2},[o$.port2]);e$.transform=s$,await new Gh$1(a$=>i$.onmessage=c$=>{c$.data==="started"&&a$(void 0)}),t$.on("sei-to-send",a$=>{o$.port1.postMessage({sei:a$})}),o$.port1.onmessage=a$=>{var c$;a$.data.transformed&&e$.track&&((c$=e$.track)===null||c$===void 0?void 0:c$.id)!==r$.track.id&&(fb$1.debug("video track changed: ".concat(r$.track.id," => ").concat(e$.track.id)),r$.track.removeEventListener("ended",n$),r$.track=e$.track,r$.track.addEventListener("ended",n$))},r$.worker=i$}}function n$(){if(e$.track){if(this.id!==e$.track.id)return;e$.track.removeEventListener("ended",n$)}const i$=LU$1.get(e$);if(i$){LU$1.delete(e$);try{var o$,s$;(o$=i$.controller)===null||o$===void 0||o$.terminate(),(s$=i$.worker)===null||s$===void 0||s$.terminate()}catch(a$){fb$1.warning(a$&&a$.message)}}}LU$1.set(e$,r$),e$.track.addEventListener("ended",n$)}const MU$1=new Map;(function(){const e$=Hv$1();QP$1.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),QP$1.getStreamFromExtension=e$.name===Bv$1.CHROME&&Number(e$.version)>34,QP$1.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t$=new RTCPeerConnection;let r$=!1;try{t$.addTransceiver("audio"),r$=!0}catch{}return t$.close(),r$}(),QP$1.supportMinBitrate=e$.name===Bv$1.CHROME||e$.name===Bv$1.EDGE,QP$1.supportSetRtpSenderParameters=function(){const t$=Hv$1();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Ey$1()||!(!Xv$1()&&!zv$1())||t$.name===Bv$1.FIREFOX&&Number(t$.version)>=64)}(),e$.name===Bv$1.SAFARI&&(Number(e$.version)>=14?QP$1.supportDualStream=!0:QP$1.supportDualStream=!1),QP$1.webAudioMediaStreamDest=function(){const t$=Hv$1();return!(t$.name===Bv$1.SAFARI&&Number(t$.version)<12)}(),QP$1.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",QP$1.supportWebGL=typeof WebGLRenderingContext<"u",QP$1.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Ey$1()||(QP$1.webAudioWithAEC=!0),QP$1.supportShareAudio=function(){const t$=Hv$1();return(t$.os===Fv$1.WIN_10||t$.os===Fv$1.WIN_81||t$.os===Fv$1.WIN_7||t$.os===Fv$1.LINUX||t$.os===Fv$1.MAC_OS||t$.os===Fv$1.CHROMIUM_OS)&&t$.name===Bv$1.CHROME&&Number(t$.version)>=74}(),QP$1.supportDataChannel=!!(ey$1(76)||function(t$){const r$=Hv$1();return!(r$.name!==Bv$1.FIREFOX||!r$.osVersion)&&Number(r$.version)>=t$}(68)||ny$1(14)),QP$1.supportPCSetConfiguration=function(){const t$=window.RTCPeerConnection;return!Zv$1()&&!!t$&&t$.prototype.setConfiguration instanceof Function}(),QP$1.supportWebRTCEncodedTransform=function(){const t$=Hv$1();return t$.name==="Chrome"&&Number(t$.version)>=86||t$.name==="Safari"&&Number(t$.version)>=15}(),QP$1.supportWebRTCInsertableStream=function(){const t$=Hv$1();return(t$.name===Bv$1.CHROME||t$.name===Bv$1.EDGE)&&Number(t$.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),QP$1.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,QP$1.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,oA$1(()=>{QP$1.supportDualStreamEncoding=function(){const t$=Hv$1();return!!XA$1("DISABLE_WEBAUDIO")||t$.name==="Safari"&&Number(t$.version)>=14||!!(t$.name==="Chrome"&&/Windows/i.test(t$.os||"")&&Number(t$.version)>=100&&XA$1("CHROME_DUAL_STREAM_USE_ENCODING"))}(),fb$1.info("browser compatibility",JSON.stringify(QP$1),JSON.stringify(e$))})})();let UU$1=class _5 extends xy$1{constructor(t$,r$){super(),Fg$1(this,"signal",void 0),Fg$1(this,"token",void 0),Fg$1(this,"tokenTimeout",void 0),Fg$1(this,"tokenInterval",void 0),Fg$1(this,"_sequence",0),Fg$1(this,"userMap",new Map),Fg$1(this,"encoder",new TextEncoder),this.signal=t$,this.token=r$;const n$=()=>{this.signal.connectionState===Nw$1.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(n$,1e3):this.tokenInterval=window.setTimeout(n$,3*XA$1("P2P_TOKEN_INTERVAL"))};n$()}async send(t$,r$,n$,i$,o$){var s$,a$,c$;if(this.userMap.size===0)return;const u$=Array.from(_N(s$=this.userMap).call(s$))[0].token;typeof r$!="string"&&(r$=JSON.stringify(r$)),i$=(a$=i$)!==null&&a$!==void 0?a$:TA$1(6,""),o$=(c$=o$)!==null&&c$!==void 0?c$:this._sequence++;const l$={_id:i$,_type:t$,_seq:o$,_message:r$,token:"".concat(this.token,"_").concat(u$)};XA$1("SHOW_P2P_LOG")&&fb$1.debug("send message",l$,"noNeedResponse : ".concat(n$)),this.splitMessage(JSON.stringify(l$)).forEach(h$=>{this.signal.request(Pw$1.DATA_STREAM,{payload:uA$1(this.encoder.encode(h$))})});const d$=new Gh$1((h$,p$)=>{const _$=window.setTimeout(()=>{this.off("res-@".concat(i$,"_ack"),f$),this.off("res-@".concat(i$),g$),this.off(vO$1.ABORT,m$),fb$1.debug("[external-signal] request timeout, type: ".concat(t$,", requestId: ").concat(i$)),this.userMap.size===0?p$(new Cy$1(Ry$1.INVALID_REMOTE_USER)):p$(new Cy$1(Ry$1.TIMEOUT))},XA$1("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),f$=()=>{_$&&window.clearTimeout(_$),this.off(vO$1.ABORT,m$),n$&&h$()},m$=()=>{_$&&window.clearTimeout(_$),this.off("res-@".concat(i$,"_ack"),f$),this.off("res-@".concat(i$),g$),p$(new Cy$1(Ry$1.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t$,", requestId: ").concat(i$)))};this.once(vO$1.ABORT,m$),this.once("res-@".concat(i$,"_ack"),f$);const g$=(y$,S$)=>{v$=!0,_$&&window.clearTimeout(_$),this.off("res-@".concat(i$,"_ack"),f$),this.off(vO$1.ABORT,m$),y$==="success"?h$(S$):p$(new Cy$1(Ry$1.P2P_MESSAGE_FAILED,"request ".concat(t$," failed, requestId: ").concat(i$)))};let v$=!1;n$||(this.once("res-@".concat(i$),g$),mA$1(XA$1("SIGNAL_REQUEST_TIMEOUT")).then(()=>{v$||fb$1.warning("external_signal request timeout, type: ".concat(t$,", requestId: ").concat(i$,", ").concat(l$))}))});try{return await d$}catch(h$){if(h$.code===Ry$1.TIMEOUT)return await this.send(t$,r$,n$,i$,o$);throw h$}}onMessage(t$){var r$;const{_uid:n$}=t$;let i$,o$=this.userMap.get(n$);if(o$)i$=o$.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t$)||t$._type!==IO$1.CHECK)return;const{token:u$}=t$;i$=new Map,o$={uid:n$,isStart:!0,token:u$,splitMessageMap:i$,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(n$,o$),this.signal.emit(kw$1.ON_USER_ONLINE,{uid:n$}),this.handleUserOnline()}if("id"in t$&&"total"in t$){var s$;const{id:u$,total:l$}=t$,d$=(s$=i$.get(u$))!==null&&s$!==void 0?s$:[];if(d$.push(t$),i$.has(u$)||i$.set(u$,d$),d$.length!==l$)return;{const h$=aE$1(d$).call(d$,(p$,_$)=>p$.index-_$.index).map(p$=>p$.payload).join("");i$.delete(u$),(t$=JSON.parse(h$))._uid=n$}}const{_type:a$,token:c$}=t$;if(Dn$1(r$=[IO$1.ACK,IO$1.CHECK]).call(r$,a$))return a$===IO$1.CHECK&&this.handleCheckToken(o$,c$),void this.receiveMessage(t$);c$==="".concat(o$.token,"_").concat(this.token)?this.handleReceivedMessage(t$):fb$1.debug('Receive unexpected message", '.concat(c$,", cur_token: ").concat(o$.token,"_").concat(this.token),t$)}check(){const t$={_id:TA$1(6,""),token:this.token,_type:IO$1.CHECK};XA$1("SHOW_P2P_LOG")&&fb$1.debug("send message",t$),this.signal.request(Pw$1.DATA_STREAM,{payload:uA$1(this.encoder.encode(JSON.stringify(t$)))})}ack(t$){const r$={_id:t$,_type:IO$1.ACK,token:this.token};XA$1("SHOW_P2P_LOG")&&fb$1.debug("send message",r$),this.signal.request(Pw$1.DATA_STREAM,{payload:uA$1(this.encoder.encode(JSON.stringify(r$)))})}response(t$,r$,n$){this.send(IO$1.RESPONSE,JSON.stringify({success:!n$,message:r$}),!0,t$)}handleReceivedMessage(t$){const r$=()=>{this.userMap.forEach(u$=>{const{receivedMessagesMap:l$,nextExpectedSequenceNumber:d$}=u$;for(;l$.has(d$);){const h$=l$.get(d$);l$.delete(d$),this.receiveMessage(h$),u$.nextExpectedSequenceNumber++}})};if(!t$)return void r$();const{_uid:n$,_seq:i$}=t$,o$=this.userMap.get(n$),{receivedMessagesMap:s$,isStart:a$,nextExpectedSequenceNumber:c$}=o$;if(i$<c$)return this.ack(t$._id),void fb$1.debug("[external-signal] receive old message, seq: ".concat(i$,", ").concat(t$._message));s$.set(i$,t$),a$&&i$===c$&&(this.receiveMessage(t$),s$.delete(c$),o$.nextExpectedSequenceNumber++,r$())}receiveMessage(t$){const{_id:r$,_type:n$,_message:i$,_uid:o$}=t$;if(XA$1("SHOW_P2P_LOG")&&fb$1.debug("receive message",t$),r$){let s$;switch(t$._type!==IO$1.ACK&&(i$&&(s$=JSON.parse(i$)),this.ack(t$._id)),t$._type){case IO$1.CANDIDATE:case IO$1.CONTROL:this.signal.emit(n$,s$,o$);break;case IO$1.PUBLISH:case IO$1.UNPUBLISH:case IO$1.RESTART_ICE:case IO$1.CALL:s$.uid=o$,Zy$1(this.signal,n$,s$).then(a$=>{this.response(t$._id,a$)}).catch(()=>{this.response(t$._id,void 0,!0)});break;case IO$1.ACK:this.getListeners("res-@".concat(r$,"_ack")).length>0&&this.emit("res-@".concat(r$,"_ack"));break;case IO$1.RESPONSE:{const{success:a$,message:c$}=s$;this.emit("res-@".concat(r$),a$?"success":"failed",c$);break}}}}splitMessage(t$){if(t$.length<_5.MAX_MESSAGE_SIZE)return[t$];const r$=[],{remoteToken:n$}=JSON.parse(t$),i$=TA$1(6,"");let o$=0,s$=800;const a$=Math.ceil(t$.length/s$);for(;t$.length>0;){o$++;const c$={id:i$,index:o$,total:a$,payload:t$.slice(0,s$),token:"".concat(this.token,"_").concat(n$)};JSON.stringify(c$).length>_5.MAX_MESSAGE_SIZE?s$-=50:(r$.push(c$),t$=t$.slice(s$))}return r$.map(c$=>JSON.stringify(c$))}handleCheckToken(t$,r$){return t$.token!==r$?(fb$1.debug("token changed, from ".concat(t$.token," to ").concat(r$)),this.reset(t$.uid,r$),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{fb$1.debug("token timeout, ".concat(r$)),this.reset(t$.uid)},XA$1("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t$=await Zy$1(this.signal,IO$1.CALL,void 0),r$=await this.send(IO$1.CALL,t$);this.signal.emit(Dw$1.P2P_CONNECTION,r$,!0)}async reset(t$,r$){const n$=this.userMap.get(t$);n$&&(this.emit(vO$1.ABORT),this.signal.emit(kw$1.ON_USER_OFFLINE,{uid:n$.uid,reason:AO$1.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),r$||(fb$1.debug("change local token from ".concat(r$," to ").concat(r$)),this.token=TA$1(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(vO$1.ABORT)}};Fg$1(UU$1,"MAX_SIZE",1),Fg$1(UU$1,"MAX_MESSAGE_SIZE",1024);let xU$1=class extends xy$1{get connectionState(){return this._connectionState}set connectionState(t$){t$!==this._connectionState&&(this._connectionState=t$,t$===Nw$1.CONNECTED?this.emit(Dw$1.WS_CONNECTED):t$===Nw$1.RECONNECTING?this.emit(Dw$1.WS_RECONNECTING,this._websocketReconnectReason):t$===Nw$1.CLOSED&&this.emit(Dw$1.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t$,r$){super(),Fg$1(this,"_disconnectedReason",void 0),Fg$1(this,"_websocketReconnectReason",void 0),Fg$1(this,"_connectionState",Nw$1.CLOSED),Fg$1(this,"reconnectToken",void 0),Fg$1(this,"p2pToken",void 0),Fg$1(this,"websocket",void 0),Fg$1(this,"openConnectionTime",void 0),Fg$1(this,"clientId",void 0),Fg$1(this,"lastMsgTime",Date.now()),Fg$1(this,"uploadCache",[]),Fg$1(this,"uploadCacheInterval",void 0),Fg$1(this,"rttRolling",new MA$1(5)),Fg$1(this,"pingpongTimer",void 0),Fg$1(this,"pingpongTimeoutCount",0),Fg$1(this,"joinResponse",void 0),Fg$1(this,"multiIpOption",void 0),Fg$1(this,"initError",void 0),Fg$1(this,"spec",void 0),Fg$1(this,"store",void 0),Fg$1(this,"_external_signal",void 0),Fg$1(this,"onWebsocketMessage",n$=>{if(n$.data instanceof ArrayBuffer)return void this.emit(Dw$1.ON_BINARY_DATA,n$.data);const i$=JSON.parse(n$.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i$,"_id")){const o$="res-@".concat(i$._id);this.emit(o$,i$._result,i$._message)}else if(Object.prototype.hasOwnProperty.call(i$,"_type")){switch(i$._type){case kw$1.ON_DATA_STREAM:return void this.handleDataStream(i$._message);case kw$1.MUTE_AUDIO:case kw$1.MUTE_VIDEO:case kw$1.ON_P2P_LOST:case kw$1.ON_USER_ONLINE:return;case kw$1.ON_USER_OFFLINE:const{uid:o$}=i$._message;return fb$1.debug("[".concat(this.clientId,"] user-offline uid: ").concat(o$)),void this._external_signal.reset(o$)}if(this.emit(i$._type,i$._message),i$._type===kw$1.ON_NOTIFICATION&&this.handleNotification(i$._message),i$._type===kw$1.ON_USER_BANNED)switch(i$._message.error_code){case 14:this.close(Hy$1.UID_BANNED);break;case 15:this.close(Hy$1.IP_BANNED);break;case 16:this.close(Hy$1.CHANNEL_BANNED)}if(i$._type===kw$1.ON_USER_LICENSE_BANNED)switch(i$._message.error_code){case Ow$1.ERR_LICENSE_MISSING:this.close(Hy$1.LICENSE_MISSING);break;case Ow$1.ERR_LICENSE_EXPIRED:this.close(Hy$1.LICENSE_EXPIRED);break;case Ow$1.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Hy$1.LICENSE_MINUTES_EXCEEDED);break;case Ow$1.ERR_LICENSE_PERIOD_INVALID:this.close(Hy$1.LICENSE_PERIOD_INVALID);break;case Ow$1.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Hy$1.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ow$1.ERR_LICENSE_ILLEGAL:this.close(Hy$1.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t$.clientId,this.spec=t$,this.store=r$,this.websocket=new WO$1("gateway-".concat(this.clientId),this.spec.retryConfig,!0,XA$1("JOIN_GATEWAY_USE_DUAL_DOMAIN"),XA$1("JOIN_GATEWAY_USE_443PORT_ONLY"),r$),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Nw$1.CONNECTED&&this.reconnect("retry",Jy$1.OFFLINE)}),this.p2pToken=TA$1(6,""),this._external_signal=new UU$1(this,this.p2pToken)}async request(t$,r$,n$,i$){const o$=TA$1(6,""),s$={_id:o$,_type:t$,_message:r$},a$=this.websocket.connectionID,c$=()=>new Gh$1((_$,f$)=>{if(this.connectionState===Nw$1.CONNECTED)return _$();const m$=()=>{this.off(Dw$1.WS_CLOSED,g$),_$()},g$=()=>{this.off(Dw$1.WS_CONNECTED,m$),f$(new Cy$1(Ry$1.WS_ABORT))};this.once(Dw$1.WS_CONNECTED,m$),this.once(Dw$1.WS_CLOSED,g$)});if(this.connectionState!==Nw$1.CONNECTING&&this.connectionState!==Nw$1.RECONNECTING||t$===Pw$1.JOIN||t$===Pw$1.REJOIN||await c$(),this.websocket.sendMessage(s$,!0),i$)return;const u$=new Gh$1((_$,f$)=>{let m$=!1;const g$=(y$,S$)=>{m$=!0,_$({isSuccess:y$==="success",message:S$||{}}),this.off(Dw$1.WS_CLOSED,v$),this.off(Dw$1.WS_RECONNECTING,v$),this.emit(Dw$1.REQUEST_SUCCESS,t$,r$)};this.once("res-@".concat(o$),g$);const v$=()=>{f$(new Cy$1(Ry$1.WS_ABORT,"type: ".concat(t$))),this.off(Dw$1.WS_CLOSED,v$),this.off(Dw$1.WS_RECONNECTING,v$),this.off("res-@".concat(o$),g$)};this.once(Dw$1.WS_CLOSED,v$),this.once(Dw$1.WS_RECONNECTING,v$),mA$1(XA$1("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a$||m$||(fb$1.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t$)),this.emit(Dw$1.REQUEST_TIMEOUT,t$,r$))})});let l$=null;try{l$=await u$}catch(_$){if(this.connectionState===Nw$1.CLOSED||t$===Pw$1.LEAVE)throw new Cy$1(Ry$1.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n$?_$.throw():t$===Pw$1.JOIN||t$===Pw$1.REJOIN?null:(await c$(),await this.request(t$,r$))}if(l$.isSuccess)return l$.message;const d$=Number(l$.message.error_code||l$.message.code),h$=NO$1(d$),p$=new Cy$1(Ry$1.UNEXPECTED_RESPONSE,"".concat(h$.desc,": ").concat(l$.message.error_str),{code:d$,data:l$.message,desc:h$.desc});return h$.action==="success"?l$.message:(fb$1.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t$,", error_code: ").concat(d$,", message: ").concat(h$.desc,", action: ").concat(h$.action)),d$===Ow$1.ERR_TOO_MANY_BROADCASTERS?((t$===Pw$1.JOIN||t$===Pw$1.REJOIN)&&(this.initError=p$,this.close()),p$.throw()):h$.action==="failed"?p$.throw():h$.action==="quit"?(this.initError=p$,this.close(),p$.throw()):(d$===Ow$1.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l$.message.option,fb$1.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Jy$1.MULTI_IP)):this.reconnect(h$.action,Jy$1.SERVER_ERROR),t$===Pw$1.JOIN||t$===Pw$1.REJOIN?null:await this.request(t$,r$)))}waitMessage(t$,r$){return new Gh$1(n$=>{const i$=o$=>{(!r$||r$(o$))&&(this.off(t$,i$),n$(o$))};this.on(t$,i$)})}uploadWRTCStats(t$){if(!this.store.sessionId)return void fb$1.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r$={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t$};this.upload(Lw$1.WRTC_STATS,r$)}upload(t$,r$){const n$={_type:t$,_message:r$};try{this.websocket.sendMessage(n$)}catch{const o$=XA$1("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n$),this.uploadCache.length>o$&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Nw$1.CONNECTED)return;const s$=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(s$._type,s$._message)},XA$1("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t$,r$){const n$={_type:t$,_message:r$};this.websocket.sendMessage(n$)}async sendExtensionMessage(t$,r$,n$){return await this._external_signal.send(t$,r$,n$)}init(t$){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Gh$1((r$,n$)=>{this.once(Dw$1.WS_CONNECTED,()=>r$(this.joinResponse)),this.once(Dw$1.WS_CLOSED,()=>n$(this.initError||new Cy$1(Ry$1.WS_ABORT))),this.connectionState=Nw$1.CONNECTING,this.websocket.init(t$).catch(n$)})}close(t$){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t$||Hy$1.LEAVE,this.connectionState=Nw$1.CLOSED,fb$1.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=TA$1(6,""),this._external_signal.clear(),this._external_signal=new UU$1(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Dw$1.ABORT_P2P_EXECUTION);const t$=await Zy$1(this,Dw$1.REQUEST_JOIN_INFO),r$=await this.request(Pw$1.JOIN,t$);if(!r$)return this.emit(Dw$1.REPORT_JOIN_GATEWAY,Ry$1.TIMEOUT,this.url||""),!1;this.joinResponse=r$,this.emit(Dw$1.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Nw$1.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t$,r$){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t$,r$)}handleDataStream(t$){try{var r$;const n$=lA$1(t$.payload),i$=new TextDecoder().decode(n$),o$=JSON.parse(i$);"total"in o$&&"id"in o$||Dn$1(r$=Object.values(IO$1)).call(r$,o$._type)?(o$._uid=t$.uid,this._external_signal.onMessage(o$)):this.emit(kw$1.ON_DATA_STREAM,t$)}catch{this.emit(kw$1.ON_DATA_STREAM,t$)}}handleNotification(t$){fb$1.debug("[".concat(this.clientId,"] receive notification: "),t$);const r$=NO$1(t$.code);if(r$.action!=="success"){if(r$.action!=="failed")return r$.action==="quit"?(r$.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Hy$1.UID_BANNED),void this.close()):void this.reconnect(r$.action,Jy$1.SERVER_ERROR);fb$1.error("[".concat(this.clientId,"] ignore error: "),r$.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t$=XA$1("PING_PONG_TIME_OUT"),r$=Date.now();this.pingpongTimeoutCount>=t$&&(fb$1.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r$-this.lastMsgTime,"ms")),r$-this.lastMsgTime>XA$1("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Jy$1.TIMEOUT):this.request(Pw$1.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const n$=Date.now()-r$;this.rttRolling.add(n$),XA$1("REPORT_STATS")&&this.send(Pw$1.PING_BACK,{pingpongElapse:n$})}).catch(n$=>{})}handleWebsocketEvents(){this.websocket.on(Uw$1.RECONNECT_WAITTING_FINISH,t$=>{this.emit(Dw$1.WS_RECONNECT_WAITTING_FINISH,t$)}),this.websocket.on(Uw$1.RECONNECT_CREATE_CONNECTION,t$=>{this.emit(Dw$1.WS_RECONNECT_CREATE_CONNECTION,t$)}),this.websocket.on(Uw$1.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Uw$1.CLOSED,()=>{this.connectionState=Nw$1.CLOSED}),this.websocket.on(Uw$1.FAILED,()=>{this._disconnectedReason=Hy$1.NETWORK_ERROR,this.connectionState=Nw$1.CLOSED}),this.websocket.on(Uw$1.RECONNECTING,t$=>{this._websocketReconnectReason=t$,this.joinResponse=void 0,this.connectionState===Nw$1.CONNECTED?this.connectionState=Nw$1.RECONNECTING:this.connectionState=Nw$1.CONNECTING}),this.websocket.on(Uw$1.WILL_RECONNECT,(t$,r$,n$)=>{t$!=="retry"?(fb$1.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t$)),this.reconnectToken=void 0):fb$1.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),n$(t$)}),this.websocket.on(Uw$1.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t$=>{if(this.emit(Dw$1.REPORT_JOIN_GATEWAY,t$,this.url||""),t$ instanceof Cy$1&&t$.code===Ry$1.UNEXPECTED_RESPONSE&&t$.data.code===Ow$1.ERR_NO_AUTHORIZED)return fb$1.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Jy$1.SERVER_ERROR);fb$1.error("[".concat(this.clientId,"] join gateway request failed"),t$.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Jy$1.SERVER_ERROR):(this.initError=t$,this.close())})}),this.websocket.on(Uw$1.REQUEST_NEW_URLS,(t$,r$)=>{Zy$1(this,Dw$1.REQUEST_RECOVER,this.multiIpOption).then(t$).catch(r$)}),this.websocket.on(Uw$1.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(kw$1.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}};var VU$1={exports:{}};VU$1.exports=(()=>{var e$={8:(n$,i$,o$)=>{o$.r(i$),o$.d(i$,{Parser:()=>k$,Printer:()=>L$,parse:()=>I$,print:()=>P$});const s$=`
`,a$="".concat("\r").concat(s$),c$=" ";let u$;function l$(w$){return w$>="0"&&w$<="9"}function d$(w$){return w$>="!"&&w$<="~"}function h$(w$){return d$(w$)||w$>=""&&w$<=""}function p$(w$){return w$==="!"||w$>="#"&&w$<="'"||w$>="*"&&w$<="+"||w$>="-"&&w$<="."||w$>="0"&&w$<="9"||w$>="A"&&w$<="Z"||w$>="^"&&w$<="~"}function _$(w$){return w$>="1"&&w$<="9"}function f$(w$){return w$>="A"&&w$<="Z"||w$>="a"&&w$<="z"}function m$(w$){return w$==="d"||w$==="h"||w$==="m"||w$==="s"}function g$(w$){return w$>""&&w$<"	"||w$>"\v"&&w$<"\f"||w$>""&&w$<""}function v$(w$){return f$(w$)||l$(w$)||w$==="+"||w$==="/"}function y$(w$){return l$(w$)||f$(w$)||w$==="+"||w$==="/"||w$==="-"||w$==="_"}function S$(w$){return f$(w$)||l$(w$)||w$==="+"||w$==="/"}function b$(w$,E$){var T$=Object.keys(w$);if(Object.getOwnPropertySymbols){var R$=Object.getOwnPropertySymbols(w$);E$&&(R$=R$.filter(function(D$){return Object.getOwnPropertyDescriptor(w$,D$).enumerable})),T$.push.apply(T$,R$)}return T$}function $$(w$){for(var E$=1;E$<arguments.length;E$++){var T$=arguments[E$]!=null?arguments[E$]:{};E$%2?b$(Object(T$),!0).forEach(function(R$){C$(w$,R$,T$[R$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w$,Object.getOwnPropertyDescriptors(T$)):b$(Object(T$)).forEach(function(R$){Object.defineProperty(w$,R$,Object.getOwnPropertyDescriptor(T$,R$))})}return w$}function C$(w$,E$,T$){return E$ in w$?Object.defineProperty(w$,E$,{value:T$,enumerable:!0,configurable:!0,writable:!0}):w$[E$]=T$,w$}(function(w$){w$.VERSION="v",w$.ORIGIN="o",w$.SESSION_NAME="s",w$.INFORMATION="i",w$.URI="u",w$.EMAIL="e",w$.PHONE="p",w$.CONNECTION="c",w$.BANDWIDTH="b",w$.TIME="t",w$.REPEAT="r",w$.ZONE_ADJUSTMENTS="z",w$.KEY="k",w$.ATTRIBUTE="a",w$.MEDIA="m"})(u$||(u$={}));class N${consumeText(E$,T$){let R$=T$;for(;R$<E$.length;){const D$=E$[R$];if(D$==="\0"||D$==="\r"||D$===s$)break;R$+=1}if(R$-T$==0)throw new Error("Invalid text, at ".concat(E$));return R$}consumeUnicastAddress(E$,T$,R$){return this.consumeTill(E$,T$,c$)}consumeOneOrMore(E$,T$,R$){let D$=T$;for(;R$(E$[D$]);)D$++;if(D$-T$==0)throw new Error("Invalid rule at ".concat(T$,"."));return D$}consumeSpace(E$,T$){if(E$[T$]===c$)return T$+1;throw new Error("Invalid space at ".concat(T$,"."))}consumeIP4Address(E$,T$){let R$=T$;for(let D$=0;D$<4;D$++)if(R$=this.consumeDecimalUChar(E$,R$),D$!==3){if(E$[R$]!==".")throw new Error("Invalid IP4 address.");R$++}return R$}consumeDecimalUChar(E$,T$){let R$=T$;for(let j$=0;j$<3&&l$(E$[R$]);j$++,R$++);if(R$-T$==0)throw new Error("Invalid decimal uchar.");const D$=parseInt(E$.slice(T$,R$));if(D$>=0&&D$<=255)return R$;throw new Error("Invalid decimal uchar")}consumeIP6Address(E$,T$){let R$=this.consumeHexpart(E$,T$);return E$[R$]===":"&&(R$+=1,R$=this.consumeIP4Address(E$,R$)),R$}consumeHexpart(E$,T$){let R$=T$;if(E$[R$]===":"&&E$[R$+1]===":"){R$+=2;try{R$=this.consumeHexseq(E$,R$)}catch{}return R$}if(R$=this.consumeHexseq(E$,R$),E$[R$]===":"&&E$[R$+1]===":"){R$+=2;try{R$=this.consumeHexseq(E$,R$)}catch{}return R$}return R$}consumeHexseq(E$,T$){let R$=T$;for(;R$=this.consumeHex4(E$,R$),E$[R$]===":"&&E$[R$+1]!==":";)R$+=1;return R$}consumeHex4(E$,T$){let R$=0;for(;R$<4;R$++)if(!((D$=E$[T$+R$])>="0"&&D$<="9"||D$>="a"&&D$<="f"||D$>="A"&&D$<="F")){if(R$===0)throw new Error("Invalid hex 4");break}var D$;return T$+R$}consumeFQDN(E$,T$){let R$=T$;for(;l$(E$[R$])||f$(E$[R$])||E$[R$]==="-"||E$[R$]===".";)R$+=1;if(R$-T$<4)throw new Error("Invalid FQDN");return R$}consumeExtnAddr(E$,T$){return this.consumeOneOrMore(E$,T$,h$)}consumeMulticastAddress(E$,T$,R$){switch(R$){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(E$,T$);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(E$,T$);default:try{return this.consumeFQDN(E$,T$)}catch{return this.consumeExtnAddr(E$,T$)}}}consumeIP6MulticastAddress(E$,T$){const R$=this.consumeHexpart(E$,T$);return E$[R$]==="/"?this.consumeInteger(E$,R$+1):R$}consumeIP4MulticastAddress(E$,T$){let R$=T$+3;const D$=E$.slice(T$,R$),j$=parseInt(D$);if(j$<224||j$>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let G$=0;G$<3;G$++){if(E$[R$]!==".")throw new Error("Invalid IP4 multicast address.");R$+=1,R$=this.consumeDecimalUChar(E$,R$)}return E$[R$]==="/"&&(R$+=1),R$=this.consumeTTL(E$,R$),E$[R$]==="/"&&(R$=this.consumeInteger(E$,R$)),R$}consumeInteger(E$,T$){if(!_$(E$[T$]))throw new Error("Invalid integer.");for(T$+=1;l$(E$[T$]);)T$+=1;return T$}consumeTTL(E$,T$){if(E$[T$]==="0")return T$+1;if(!_$(E$[T$]))throw new Error("Invalid TTL.");T$+=1;for(let R$=0;R$<2&&l$(E$[T$]);R$++)T$+=1;return T$}consumeToken(E$,T$){return this.consumeOneOrMore(E$,T$,p$)}consumeTime(E$,T$){let R$=T$;if(E$[R$]==="0")return R$+1;for(_$(E$[R$])&&(R$+=1);l$(E$[R$]);)R$++;if(R$-T$<10)throw new Error("Invalid time");return R$}consumeAddress(E$,T$){return this.consumeTill(E$,T$,c$)}consumeTypedTime(E$,T$){let R$=T$;return R$=this.consumeOneOrMore(E$,R$,l$),m$(E$[R$])?R$+1:R$}consumeRepeatInterval(E$,T$){if(!_$(E$[T$]))throw new Error("Invalid repeat interval");for(T$+=1;l$(E$[T$]);)T$+=1;return m$(E$[T$])&&(T$+=1),T$}consumePort(E$,T$){return this.consumeOneOrMore(E$,T$,l$)}consume(E$,T$,R$){for(let D$=0;D$<R$.length;D$++){if(T$+D$>=E$.length)throw new Error("consume exceeding value length");if(E$[T$+D$]!==R$[D$])throw new Error("consume ".concat(R$," failed at ").concat(D$))}return T$+R$.length}consumeTill(E$,T$,R$){let D$=T$;for(;D$<E$.length&&(typeof R$!="string"||E$[D$]!==R$)&&(typeof R$!="function"||!R$(E$[D$]));)D$++;return D$}}class k$ extends N${constructor(){super(),C$(this,"records",[]),C$(this,"currentLine",0)}parse(E$){const T$=this.probeEOL(E$);this.records=E$.split(T$).filter(B$=>!!jp$1(B$).call(B$)).map(this.parseLine),this.currentLine=0;const R$=this.parseVersion(),D$=this.parseOrigin(),j$=this.parseSessionName(),G$=this.parseInformation(),z$=this.parseUri(),J$=this.parseEmail(),t5=this.parsePhone(),a5=this.parseConnection(),s5=this.parseBandWidth(),t3=this.parseTimeFields(),Q$=this.parseKey(),Y$=this.parseSessionAttribute(),K$=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:R$,origin:D$,sessionName:j$,information:G$,uri:z$,emails:J$,phones:t5,connection:a5,bandwidths:s5,timeFields:t3,key:Q$,attributes:Y$,mediaDescriptions:K$}}getCurrentRecord(){const E$=this.records[this.currentLine];if(!E$)throw new Error("Record doesn't exit.");return E$}probeEOL(E$){for(let T$=0;T$<E$.length;T$++)if(E$[T$]===s$)return E$[T$-1]==="\r"?a$:s$;throw new Error("Invalid newline character.")}parseLine(E$,T$){if(E$.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const R$=E$[0];if(E$[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:R$,value:E$.slice(2),line:T$,cur:0}}parseSessionAttribute(){const E$=new U$;for(;this.currentLine<this.records.length;){const T$=this.getCurrentRecord();if(T$.type!==u$.ATTRIBUTE)break;const R$={attField:this.extractOneOrMore(T$,D$=>p$(D$)&&D$!==":"),_cur:0};T$.value[T$.cur]===":"&&(T$.cur+=1,R$.attValue=this.extractOneOrMore(T$,g$)),E$.parse(R$),this.currentLine++}return E$.digest()}parseMediaAttributes(E$){const T$=new x$(E$);for(;this.currentLine<this.records.length;){const R$=this.getCurrentRecord();if(R$.type!==u$.ATTRIBUTE)break;const D$={attField:this.extractOneOrMore(R$,j$=>p$(j$)&&j$!==":"),_cur:0};R$.value[R$.cur]===":"&&(R$.cur+=1,D$.attValue=this.extractOneOrMore(R$,g$)),T$.parse(D$),this.currentLine++}return T$.digest()}parseKey(){const E$=this.getCurrentRecord();if(E$.type===u$.KEY){if(E$.value==="prompt"||E$.value==="clear:"||E$.value==="base64:"||E$.value==="uri:")return E$.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const E$=this.getCurrentRecord();if(E$.type===u$.ZONE_ADJUSTMENTS){const T$=[];for(;;)try{const R$=this.extract(E$,this.consumeTime);this.consumeSpaceForRecord(E$);let D$=!1;E$.value[E$.cur]==="-"&&(D$=!0,E$.cur+=1);const j$=this.extract(E$,this.consumeTypedTime);T$.push({time:R$,typedTime:j$,back:D$})}catch{break}if(T$.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,T$}return[]}parseRepeat(){const E$=[];for(;;){const T$=this.getCurrentRecord();if(T$.type!==u$.REPEAT)break;{const R$=this.extract(T$,this.consumeRepeatInterval),D$=this.parseTypedTime(T$);E$.push({repeatInterval:R$,typedTimes:D$}),this.currentLine++}}return E$}parseTypedTime(E$){const T$=[];for(;;)try{this.consumeSpaceForRecord(E$),T$.push(this.extract(E$,this.consumeTypedTime))}catch{break}if(T$.length===0)throw new Error("Invalid typed time.");return T$}parseTime(){const E$=this.getCurrentRecord(),T$=this.extract(E$,this.consumeTime);this.consumeSpaceForRecord(E$);const R$=this.extract(E$,this.consumeTime);return this.currentLine++,{startTime:T$,stopTime:R$}}parseBandWidth(){const E$=[];for(;this.currentLine<this.records.length;){const T$=this.getCurrentRecord();if(T$.type!==u$.BANDWIDTH)break;{const R$=this.extractOneOrMore(T$,p$);if(T$.value[T$.cur]!==":")throw new Error("Invalid bandwidth field.");T$.cur++;const D$=this.extractOneOrMore(T$,l$);E$.push({bwtype:R$,bandwidth:D$}),this.currentLine++}}return E$}parseVersion(){const E$=this.getCurrentRecord();if(E$.type!==u$.VERSION)throw new Error("first sdp record must be version");const T$=E$.value.slice(0,this.consumeOneOrMore(E$.value,0,l$));if(T$.length!==E$.value.length)throw new Error('invalid proto version, "v='.concat(E$.value,'"'));return this.currentLine++,T$}parseOrigin(){const E$=this.getCurrentRecord();if(E$.type!==u$.ORIGIN)throw new Error("second line of sdp must be origin");const T$=this.extractOneOrMore(E$,h$);this.consumeSpaceForRecord(E$);const R$=this.extractOneOrMore(E$,l$);this.consumeSpaceForRecord(E$);const D$=this.extractOneOrMore(E$,l$);this.consumeSpaceForRecord(E$);const j$=this.extractOneOrMore(E$,p$);this.consumeSpaceForRecord(E$);const G$=this.extractOneOrMore(E$,p$);this.consumeSpaceForRecord(E$);const z$=this.extract(E$,this.consumeUnicastAddress);return this.currentLine++,{username:T$,sessId:R$,sessVersion:D$,nettype:j$,addrtype:G$,unicastAddress:z$}}parseSessionName(){const E$=this.getCurrentRecord();if(E$.type===u$.SESSION_NAME){const T$=this.extract(E$,this.consumeText);return this.currentLine++,T$}}parseInformation(){const E$=this.getCurrentRecord();if(E$.type!==u$.INFORMATION)return;const T$=this.extract(E$,this.consumeText);return this.currentLine++,T$}parseUri(){const E$=this.getCurrentRecord();if(E$.type===u$.URI)return this.currentLine++,E$.value}parseEmail(){const E$=[];for(;;){const T$=this.getCurrentRecord();if(T$.type!==u$.EMAIL)break;E$.push(T$.value),this.currentLine++}return E$}parsePhone(){const E$=[];for(;;){const T$=this.getCurrentRecord();if(T$.type!==u$.PHONE)break;E$.push(T$.value),this.currentLine++}return E$}parseConnection(){const E$=this.getCurrentRecord();if(E$.type===u$.CONNECTION){const T$=this.extractOneOrMore(E$,p$);this.consumeSpaceForRecord(E$);const R$=this.extractOneOrMore(E$,p$);this.consumeSpaceForRecord(E$);const D$=this.extract(E$,this.consumeAddress);return this.currentLine++,{nettype:T$,addrtype:R$,address:D$}}}parseMedia(){const E$=this.getCurrentRecord(),T$=this.extract(E$,this.consumeToken);this.consumeSpaceForRecord(E$);let R$=this.extract(E$,this.consumePort);E$.value[E$.cur]==="/"&&(E$.cur+=1,R$+=this.extract(E$,this.consumeInteger)),this.consumeSpaceForRecord(E$);const D$=[];for(D$.push(this.extract(E$,this.consumeToken));E$.value[E$.cur]==="/";)E$.cur+=1,D$.push(this.extract(E$,this.consumeToken));if(D$.length===0)throw new Error("Invalid proto");const j$=this.parseFmt(E$);return this.currentLine++,{mediaType:T$,port:R$,protos:D$,fmts:j$}}parseTimeFields(){const E$=[];for(;this.getCurrentRecord().type===u$.TIME;){const T$=this.parseTime(),R$=this.parseRepeat(),D$=this.parseZone();E$.push({time:T$,repeats:R$,zones:D$})}return E$}parseMediaDescription(){const E$=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===u$.MEDIA;){const T$=this.parseMedia(),R$=this.parseInformation(),D$=this.parseConnections(),j$=this.parseBandWidth(),G$=this.parseKey(),z$=this.parseMediaAttributes(T$);E$.push({media:T$,information:R$,connections:D$,bandwidths:j$,key:G$,attributes:z$})}return E$}parseConnections(){const E$=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===u$.CONNECTION;)E$.push(this.parseConnection());return E$}parseFmt(E$){const T$=[];for(;;)try{this.consumeSpaceForRecord(E$),T$.push(this.extract(E$,this.consumeToken))}catch{break}if(T$.length===0)throw new Error("Invalid fmts");return T$}extract(E$,T$){for(var R$=arguments.length,D$=new Array(R$>2?R$-2:0),j$=2;j$<R$;j$++)D$[j$-2]=arguments[j$];const G$=T$.call(this,E$.value,E$.cur,...D$),z$=E$.value.slice(E$.cur,G$);return E$.cur=G$,z$}extractOneOrMore(E$,T$){const R$=this.consumeOneOrMore(E$.value,E$.cur,T$),D$=E$.value.slice(E$.cur,R$);return E$.cur=R$,D$}consumeSpaceForRecord(E$){if(E$.value[E$.cur]!==c$)throw new Error("Invalid space at ".concat(E$.cur,"."));E$.cur+=1}}class O$ extends N${constructor(){super(...arguments),C$(this,"attributes",void 0),C$(this,"digested",!1)}extractOneOrMore(E$,T$,R$){const D$=this.consumeOneOrMore(E$.attValue,E$._cur,T$),j$=E$.attValue.slice(E$._cur,D$),[G$,z$]=R$||[];if(typeof G$=="number"&&j$.length<G$)throw new Error("error in length, should be more or equal than ".concat(G$," characters."));if(typeof z$=="number"&&j$.length>z$)throw new Error("error in length, should be less or equal than ".concat(z$," characters."));return E$._cur=D$,j$}consumeAttributeSpace(E$){if(E$.attValue[E$._cur]!==c$)throw new Error("Invalid space at ".concat(E$._cur,"."));E$._cur+=1}extract(E$,T$){if(!E$.attValue)throw new Error("Nothing to extract from attValue.");for(var R$=arguments.length,D$=new Array(R$>2?R$-2:0),j$=2;j$<R$;j$++)D$[j$-2]=arguments[j$];const G$=T$.call(this,E$.attValue,E$._cur,...D$),z$=E$.attValue.slice(E$._cur,G$);return E$._cur=G$,z$}atEnd(E$){if(!E$.attValue)throw new Error;return E$._cur>=E$.attValue.length}peekChar(E$){if(!E$.attValue)throw new Error;return E$.attValue[E$._cur]}peek(E$,T$){if(!E$.attValue)throw new Error;for(let R$=0;R$<T$.length;R$++)if(T$[R$]!==E$.attValue[E$._cur+R$])return!1;return!0}parseIceUfrag(E$){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(E$,v$,[4,256])}parseIcePwd(E$){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(E$,v$,[22,256])}parseIceOptions(E$){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const T$=[];for(;!this.atEnd(E$);){T$.push(this.extractOneOrMore(E$,v$));try{this.consumeAttributeSpace(E$)}catch(R$){if(this.atEnd(E$))break;throw R$}}this.attributes.iceOptions=T$}parseFingerprint(E$){const T$=this.extract(E$,this.consumeToken);this.consumeAttributeSpace(E$);const R$=this.extract(E$,this.consumeTill);this.attributes.fingerprints.push({hashFunction:T$,fingerprint:R$})}parseExtmap(E$){const T$=this.extractOneOrMore(E$,l$);let R$;this.peekChar(E$)==="/"&&(this.extract(E$,this.consume,"/"),R$=this.extract(E$,this.consumeToken)),this.consumeAttributeSpace(E$);const D$=this.extract(E$,this.consumeTill,c$),j$=$$($$({entry:parseInt(T$,10)},R$&&{direction:R$}),{},{extensionName:D$});this.peekChar(E$)===c$&&(this.consumeAttributeSpace(E$),j$.extensionAttributes=this.extract(E$,this.consumeTill)),this.attributes.extmaps.push(j$)}parseSetup(E$){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const T$=this.extract(E$,this.consumeTill);if(T$!=="active"&&T$!=="passive"&&T$!=="actpass"&&T$!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=T$}}class U$ extends O${constructor(){super(...arguments),C$(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(E$){if(this.digested)throw new Error("already digested");try{switch(E$.attField){case"group":this.parseGroup(E$);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(E$);break;case"ice-pwd":this.parseIcePwd(E$);break;case"ice-options":this.parseIceOptions(E$);break;case"fingerprint":this.parseFingerprint(E$);break;case"setup":this.parseSetup(E$);break;case"tls-id":this.parseTlsId(E$);break;case"identity":this.parseIdentity(E$);break;case"extmap":this.parseExtmap(E$);break;case"msid-semantic":this.parseMsidSemantic(E$);break;default:E$.ignored=!0,this.attributes.unrecognized.push(E$)}}catch(T$){throw console.error("parsing session attribute ".concat(E$.attField,' error, "a=').concat(E$.attField,":").concat(E$.attValue,'"')),T$}if(!E$.ignored&&E$.attValue&&!this.atEnd(E$))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(E$){const T$=this.extract(E$,this.consumeToken),R$=[];for(;!this.atEnd(E$)&&this.peekChar(E$)===c$;)this.consumeAttributeSpace(E$),R$.push(this.extract(E$,this.consumeToken));this.attributes.groups.push({semantic:T$,identificationTag:R$})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(E$){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(E$,y$)}parseIdentity(E$){const T$=this.extractOneOrMore(E$,S$),R$=[];for(;!this.atEnd(E$)&&this.peekChar(E$)===c$;){this.consumeAttributeSpace(E$);const D$=this.extract(E$,this.consumeToken);this.extract(E$,this.consume,"=");const j$=this.extractOneOrMore(E$,G$=>G$!==c$&&g$(G$));R$.push({name:D$,value:j$})}this.attributes.identities.push({assertionValue:T$,extensions:R$})}parseMsidSemantic(E$){this.peekChar(E$)===c$&&this.consumeAttributeSpace(E$);const T$={semantic:this.extract(E$,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(E$)}catch{break}if(this.peekChar(E$)==="*"){this.extract(E$,this.consume,"*"),T$.applyForAll=!0;break}{const R$=this.extract(E$,this.consumeTill,c$);T$.identifierList.push(R$)}}this.attributes.msidSemantic=T$}}class x$ extends O${constructor(E$){super(),C$(this,"attributes",void 0),E$.protos.indexOf("RTP")!==-1||E$.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(E$){if(this.digested)throw new Error("already digested");try{switch(E$.attField){case"extmap":this.parseExtmap(E$);break;case"setup":this.parseSetup(E$);break;case"ice-ufrag":this.parseIceUfrag(E$);break;case"ice-pwd":this.parseIcePwd(E$);break;case"ice-options":this.parseIceOptions(E$);break;case"candidate":this.parseCandidate(E$);break;case"remote-candidate":this.parseRemoteCandidate(E$);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(E$);break;case"rtpmap":this.parseRtpmap(E$);break;case"ptime":this.parsePtime(E$);break;case"maxptime":this.parseMaxPtime(E$);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(E$);break;case"ssrc":this.parseSSRC(E$);break;case"fmtp":this.parseFmtp(E$);break;case"rtcp-fb":this.parseRtcpFb(E$);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(E$);break;case"mid":this.parseMid(E$);break;case"msid":this.parseMsid(E$);break;case"imageattr":this.parseImageAttr(E$);break;case"rid":this.parseRid(E$);break;case"simulcast":this.parseSimulcast(E$);break;case"sctp-port":this.parseSctpPort(E$);break;case"max-message-size":this.parseMaxMessageSize(E$);break;case"ssrc-group":this.parseSSRCGroup(E$);break;default:E$.ignored=!0,this.attributes.unrecognized.push(E$)}}catch(T$){throw console.error("parsing media attribute ".concat(E$.attField,' error, "a=').concat(E$.attField,":").concat(E$.attValue,'"')),T$}if(!E$.ignored&&E$.attValue&&!this.atEnd(E$))throw new Error("attribute parsing error")}parseCandidate(E$){const T$=this.extractOneOrMore(E$,v$,[1,32]);this.consumeAttributeSpace(E$);const R$=this.extractOneOrMore(E$,l$,[1,5]);this.consumeAttributeSpace(E$);const D$=this.extract(E$,this.consumeToken);this.consumeAttributeSpace(E$);const j$=this.extractOneOrMore(E$,l$,[1,10]);this.consumeAttributeSpace(E$);const G$=this.extract(E$,this.consumeAddress);this.consumeAttributeSpace(E$);const z$=this.extract(E$,this.consumePort);this.consumeAttributeSpace(E$),this.extract(E$,this.consume,"typ"),this.consumeAttributeSpace(E$);const J$={foundation:T$,componentId:R$,transport:D$,priority:j$,connectionAddress:G$,port:z$,type:this.extract(E$,this.consumeToken),extension:{}};for(this.peek(E$," raddr")&&(this.extract(E$,this.consume," raddr"),this.consumeAttributeSpace(E$),J$.relAddr=this.extract(E$,this.consumeAddress)),this.peek(E$," rport")&&(this.extract(E$,this.consume," rport"),this.consumeAttributeSpace(E$),J$.relPort=this.extract(E$,this.consumePort));this.peekChar(E$)===c$;){this.consumeAttributeSpace(E$);const t5=this.extract(E$,this.consumeToken);this.consumeAttributeSpace(E$),J$.extension[t5]=this.extractOneOrMore(E$,d$)}this.attributes.candidates.push(J$)}parseRemoteCandidate(E$){const T$=[];for(;;){const R$=this.extractOneOrMore(E$,l$,[1,5]);this.consumeAttributeSpace(E$);const D$=this.extract(E$,this.consumeAddress);this.consumeAttributeSpace(E$);const j$=this.extract(E$,this.consumePort);T$.push({componentId:R$,connectionAddress:D$,port:j$});try{this.consumeAttributeSpace(E$)}catch{break}}this.attributes.remoteCandidatesList.push(T$)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(E$){const T$=this.extract(E$,this.consumeToken);this.consumeAttributeSpace(E$);const R$=this.extract(E$,this.consumeTill,"/");this.extract(E$,this.consume,"/");const D$={encodingName:R$,clockRate:this.extractOneOrMore(E$,l$)};this.atEnd(E$)||this.peekChar(E$)!=="/"||(this.extract(E$,this.consume,"/"),D$.encodingParameters=parseInt(this.extract(E$,this.consumeTill),10));const j$=this.attributes.payloads.find(G$=>G$.payloadType===parseInt(T$,10));j$?j$.rtpMap=D$:this.attributes.payloads.push({payloadType:parseInt(T$,10),rtpMap:D$,rtcpFeedbacks:[]})}parsePtime(E$){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(E$,this.consumeTill)}parseMaxPtime(E$){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(E$,this.consumeTill)}parseDirection(E$){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=E$.attField}parseSSRC(E$){const T$=this.extractOneOrMore(E$,l$);this.consumeAttributeSpace(E$);const R$=this.extract(E$,this.consumeTill,":");let D$;this.peekChar(E$)===":"&&(this.extract(E$,this.consume,":"),D$=this.extract(E$,this.consumeTill));const j$=this.attributes.ssrcs.find(G$=>G$.ssrcId===parseInt(T$,10));j$?j$.attributes[R$]=D$:this.attributes.ssrcs.push({ssrcId:parseInt(T$,10),attributes:{[R$]:D$}})}parseFmtp(E$){const T$=this.extract(E$,this.consumeTill,c$);this.consumeAttributeSpace(E$);const R$=this.extract(E$,this.consumeTill),D$={};R$.split(";").forEach(G$=>{let[z$,J$]=G$.split("=");z$=jp$1(z$).call(z$);const t5=typeof J$=="string"?jp$1(J$).call(J$):null;typeof z$=="string"&&z$.length>0&&(D$[z$]=t5)});const j$=this.attributes.payloads.find(G$=>G$.payloadType===parseInt(T$,10));j$?j$.fmtp={parameters:D$}:this.attributes.payloads.push({payloadType:parseInt(T$,10),rtcpFeedbacks:[],fmtp:{parameters:D$}})}parseFmtParameters(E$){const T$={},R$=this.extract(E$,this.consumeTill,"=");E$._cur++;const D$=this.extract(E$,this.consumeTill,";");for(T$[R$]=D$;E$.attValue[E$._cur]===";";){const j$=this.extract(E$,this.consumeTill,"=");E$._cur++;const G$=this.extract(E$,this.consumeTill,";");T$[j$]=G$}return T$}parseRtcpFb(E$){let T$="";T$=this.peekChar(E$)==="*"?this.extract(E$,this.consume,"*"):this.extract(E$,this.consumeTill,c$),this.consumeAttributeSpace(E$);const R$=this.extract(E$,this.consumeTill,c$);let D$;if(R$==="trr-int")D$={type:R$,interval:this.extract(E$,this.consumeTill)};else{const j$={type:R$};this.peekChar(E$)===c$&&(this.consumeAttributeSpace(E$),j$.parameter=this.extract(E$,this.consumeToken),this.peekChar(E$)===c$&&(j$.additional=this.extract(E$,this.consumeTill))),D$=j$}if(T$==="*")this.attributes.rtcpFeedbackWildcards.push(D$);else{const j$=this.attributes.payloads.find(G$=>G$.payloadType===parseInt(T$,10));j$?j$.rtcpFeedbacks.push(D$):this.attributes.payloads.push({payloadType:parseInt(T$,10),rtcpFeedbacks:[D$]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(E$){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const T$={port:this.extract(E$,this.consumePort)};this.peekChar(E$)===c$&&(this.consumeAttributeSpace(E$),T$.netType=this.extractOneOrMore(E$,p$),this.consumeAttributeSpace(E$),T$.addressType=this.extractOneOrMore(E$,p$),this.consumeAttributeSpace(E$),T$.address=this.extract(E$,this.consumeAddress)),this.attributes.rtcp=T$}parseMsid(E$){const T$={id:this.extractOneOrMore(E$,p$,[1,64])};this.peekChar(E$)===c$&&(this.consumeAttributeSpace(E$),T$.appdata=this.extractOneOrMore(E$,p$,[1,64])),this.attributes.msids.push(T$)}parseImageAttr(E$){this.attributes.imageattr.push(E$.attValue)}parseRid(E$){const T$=this.extractOneOrMore(E$,D$=>f$(D$)||l$(D$)||D$==="_"||D$==="-");this.consumeAttributeSpace(E$);const R$={id:T$,direction:this.extract(E$,this.consumeToken),params:[]};if(this.peekChar(E$)===c$){if(this.consumeAttributeSpace(E$),this.peek(E$,"pt=")){this.extract(E$,this.consume,"pt=");const D$=[];for(;;){const j$=this.extract(E$,this.consumeToken);D$.push(j$);try{this.extract(E$,this.consume,",")}catch{break}}R$.payloads=D$,this.peekChar(E$)===c$&&this.extract(E$,this.consume,c$)}for(;;){const D$=this.extract(E$,this.consumeToken);switch(D$){case"depend":{const j$={type:D$,rids:this.extract(E$,this.consume,"=").split(",")};R$.params.push(j$);break}default:{const j$={type:D$};this.peekChar(E$)==="="&&(this.extract(E$,this.consume,"="),j$.val=this.extract(E$,this.consumeTill,";")),R$.params.push(j$)}}try{this.extract(E$,this.consume,";")}catch{break}}}this.attributes.rids.push(R$)}parseSimulcast(E$){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=E$.attValue,this.extract(E$,this.consumeTill)}parseSctpPort(E$){this.attributes.sctpPort=this.extractOneOrMore(E$,l$,[1,5])}parseMaxMessageSize(E$){this.attributes.maxMessageSize=this.extractOneOrMore(E$,l$,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(E$){this.attributes.mid=this.extract(E$,this.consumeToken)}parseSSRCGroup(E$){const T$=this.extract(E$,this.consumeToken),R$=[];for(;;)try{this.consumeAttributeSpace(E$);const D$=this.extract(E$,this.consumeInteger);R$.push(parseInt(D$,10))}catch{break}this.attributes.ssrcGroups.push({semantic:T$,ssrcIds:R$})}}function F$(w$,E$,T$){return E$ in w$?Object.defineProperty(w$,E$,{value:T$,enumerable:!0,configurable:!0,writable:!0}):w$[E$]=T$,w$}class L${constructor(){F$(this,"eol",a$)}print(E$,T$){let R$="";return T$&&(this.eol=T$),R$+=this.printVersion(E$.version),R$+=this.printOrigin(E$.origin),R$+=this.printSessionName(E$.sessionName),R$+=this.printInformation(E$.information),R$+=this.printUri(E$.uri),R$+=this.printEmail(E$.emails),R$+=this.printPhone(E$.phones),R$+=this.printConnection(E$.connection),R$+=this.printBandwidth(E$.bandwidths),R$+=this.printTimeFields(E$.timeFields),R$+=this.printKey(E$.key),R$+=this.printSessionAttributes(E$.attributes),R$+=this.printMediaDescription(E$.mediaDescriptions),R$}printVersion(E$){return"v=".concat(E$).concat(this.eol)}printOrigin(E$){return"o=".concat(E$.username," ").concat(E$.sessId," ").concat(E$.sessVersion," ").concat(E$.nettype," ").concat(E$.addrtype," ").concat(E$.unicastAddress).concat(this.eol)}printSessionName(E$){return E$?"s=".concat(E$).concat(this.eol):""}printInformation(E$){return E$?"i=".concat(E$).concat(this.eol):""}printUri(E$){return E$?"u=".concat(E$).concat(this.eol):""}printEmail(E$){let T$="";for(const R$ of E$)T$+="e=".concat(R$).concat(this.eol);return T$}printPhone(E$){let T$="";for(const R$ of E$)T$+="e=".concat(R$).concat(this.eol);return T$}printConnection(E$){return E$?"c=".concat(E$.nettype," ").concat(E$.addrtype," ").concat(E$.address).concat(this.eol):""}printBandwidth(E$){let T$="";for(const R$ of E$)T$+="b=".concat(R$.bwtype,":").concat(R$.bandwidth).concat(this.eol);return T$}printTimeFields(E$){let T$="";for(const R$ of E$){T$+="t=".concat(R$.time.startTime," ").concat(R$.time.startTime).concat(this.eol);for(const D$ of R$.repeats)T$+="r=".concat(D$.repeatInterval," ").concat(D$.typedTimes.join(" ")).concat(this.eol);R$.zoneAdjustments&&(T$+="z=",T$+="z=".concat(R$.zoneAdjustments.map(D$=>"".concat(D$.time," ").concat(D$.back?"-":""," ").concat(D$.typedTime)).join(" ")).concat(this.eol),T$+=this.eol)}return T$}printKey(E$){return E$?"k=".concat(E$).concat(this.eol):""}printAttributes(E$){let T$="";for(const R$ of E$)T$+="a=".concat(R$.attField).concat(R$.attValue?":".concat(R$.attValue):"").concat(this.eol);return T$}printMediaDescription(E$){let T$="";for(const R$ of E$)T$+=this.printMedia(R$.media),T$+=this.printInformation(R$.information),T$+=this.printConnections(R$.connections),T$+=this.printBandwidth(R$.bandwidths),T$+=this.printKey(R$.key),T$+=this.printMediaAttributes(R$);return T$}printConnections(E$){let T$="";for(const R$ of E$)T$+=this.printConnection(R$);return T$}printMedia(E$){return"m=".concat(E$.mediaType," ").concat(E$.port," ").concat(E$.protos.join("/")," ").concat(E$.fmts.join(" ")).concat(this.eol)}printSessionAttributes(E$){return new V$(this.eol).print(E$)}printMediaAttributes(E$){return new A$(this.eol).print(E$)}}class M${constructor(E$){F$(this,"eol",void 0),this.eol=E$}printIceUfrag(E$){return E$===void 0?"":"a=ice-ufrag:".concat(E$).concat(this.eol)}printIcePwd(E$){return E$===void 0?"":"a=ice-pwd:".concat(E$).concat(this.eol)}printIceOptions(E$){return E$===void 0?"":"a=ice-options:".concat(E$.join(c$)).concat(this.eol)}printFingerprints(E$){return E$.length>0?E$.map(T$=>"a=fingerprint:".concat(T$.hashFunction).concat(c$).concat(T$.fingerprint)).join(this.eol)+this.eol:""}printExtmap(E$){return E$.map(T$=>"a=extmap:".concat(T$.entry).concat(T$.direction?"/".concat(T$.direction):"").concat(c$).concat(T$.extensionName).concat(T$.extensionAttributes?"".concat(c$).concat(T$.extensionAttributes):"").concat(this.eol)).join("")}printSetup(E$){return E$===void 0?"":"a=setup:".concat(E$).concat(this.eol)}printUnrecognized(E$){return E$.map(T$=>"a=".concat(T$.attField).concat(T$.attValue?":".concat(T$.attValue):"").concat(this.eol)).join("")}}class V$ extends M${print(E$){let T$="";return T$+=this.printGroups(E$.groups),T$+=this.printMsidSemantic(E$.msidSemantic),T$+=this.printIceLite(E$.iceLite),T$+=this.printIceUfrag(E$.iceUfrag),T$+=this.printIcePwd(E$.icePwd),T$+=this.printIceOptions(E$.iceOptions),T$+=this.printFingerprints(E$.fingerprints),T$+=this.printSetup(E$.setup),T$+=this.printTlsId(E$.tlsId),T$+=this.printIdentity(E$.identities),T$+=this.printExtmap(E$.extmaps),T$+=this.printUnrecognized(E$.unrecognized),T$}printGroups(E$){let T$="";return E$.length>0&&(T$+=E$.map(R$=>"a=group:".concat(R$.semantic).concat(R$.identificationTag.map(D$=>"".concat(c$).concat(D$)).join("")).concat(this.eol)).join("")),T$}printIceLite(E$){return E$===void 0?"":"a=ice-lite"+this.eol}printTlsId(E$){return E$?"a=tls-id:".concat(E$).concat(this.eol):""}printIdentity(E$){return E$.length===0?"":E$.map(T$=>"a=identity:".concat(T$.assertionValue).concat(T$.extensions.map(R$=>"".concat(c$).concat(R$.name).concat(R$.value?"=".concat(R$.value):"")))).join(this.eol)+this.eol}printMsidSemantic(E$){if(!E$)return"";let T$="a=msid-semantic:".concat(E$.semantic);return E$.applyForAll?T$+="".concat(c$,"*"):E$.identifierList.length>0&&(T$+=E$.identifierList.map(R$=>"".concat(c$).concat(R$))),T$+this.eol}}class A$ extends M${print(E$){const T$=E$.attributes;let R$="";return R$+=this.printRTCP(T$.rtcp),R$+=this.printIceUfrag(T$.iceUfrag),R$+=this.printIcePwd(T$.icePwd),R$+=this.printIceOptions(T$.iceOptions),R$+=this.printCandidates(T$.candidates),R$+=this.printRemoteCandidatesList(T$.remoteCandidatesList),R$+=this.printEndOfCandidates(T$.endOfCandidates),R$+=this.printFingerprints(T$.fingerprints),R$+=this.printSetup(T$.setup),R$+=this.printMid(T$.mid),R$+=this.printExtmap(T$.extmaps),R$+=this.printRTPRelated(T$),R$+=this.printPtime(T$.ptime),R$+=this.printMaxPtime(T$.maxPtime),R$+=this.printDirection(T$.direction),R$+=this.printSSRCGroups(T$.ssrcGroups),R$+=this.printSSRC(T$.ssrcs),R$+=this.printRTCPMux(T$.rtcpMux),R$+=this.printRTCPMuxOnly(T$.rtcpMuxOnly),R$+=this.printRTCPRsize(T$.rtcpRsize),R$+=this.printMSId(T$.msids),R$+=this.printImageattr(T$.imageattr),R$+=this.printRid(T$.rids),R$+=this.printSimulcast(T$.simulcast),R$+=this.printSCTPPort(T$.sctpPort),R$+=this.printMaxMessageSize(T$.maxMessageSize),R$+=this.printUnrecognized(T$.unrecognized),R$}printCandidates(E$){return E$.map(T$=>"a=candidate:".concat(T$.foundation).concat(c$).concat(T$.componentId).concat(c$).concat(T$.transport).concat(c$).concat(T$.priority).concat(c$).concat(T$.connectionAddress).concat(c$).concat(T$.port).concat(c$,"typ").concat(c$).concat(T$.type).concat(T$.relAddr?"".concat(c$,"raddr").concat(c$).concat(T$.relAddr):"").concat(T$.relPort?"".concat(c$,"rport").concat(c$).concat(T$.relPort):"").concat(Object.keys(T$.extension).map(R$=>"".concat(c$).concat(R$).concat(c$).concat(T$.extension[R$])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(E$){return E$.map(T$=>"a=remote-candidates:".concat(T$.join(c$)).concat(this.eol)).join("")}printEndOfCandidates(E$){return E$===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(E$){if(!E$.payloads)return"";const T$=E$.payloads;let R$="";R$+=E$.rtcpFeedbackWildcards.map(D$=>this.printRTCPFeedback("*",D$)).join("");for(const D$ of T$)R$+=this.printRtpMap(D$.payloadType,D$.rtpMap),R$+=this.printFmtp(D$.payloadType,D$.fmtp),R$+=D$.rtcpFeedbacks.map(j$=>this.printRTCPFeedback(D$.payloadType,j$)).join("");return R$}printFmtp(E$,T$){if(!T$)return"";const R$=Object.keys(T$.parameters);return R$.length===1&&T$.parameters[R$[0]]===null?"a=fmtp:".concat(E$).concat(c$).concat(R$[0]).concat(this.eol):"a=fmtp:".concat(E$).concat(c$).concat(Object.keys(T$.parameters).map(D$=>"".concat(D$,"=").concat(T$.parameters[D$])).join(";")).concat(this.eol)}printRtpMap(E$,T$){return T$?"a=rtpmap:".concat(E$).concat(c$).concat(T$.encodingName,"/").concat(T$.clockRate).concat(T$.encodingParameters?"/".concat(T$.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(E$,T$){let R$="a=rtcp-fb:".concat(E$).concat(c$),D$=T$;return D$.type==="trr-int"?R$+="ttr-int".concat(c$).concat(D$.interval):(R$+="".concat(D$.type),D$.parameter&&(R$+="".concat(c$).concat(D$.parameter),D$.additional&&(R$+="".concat(c$).concat(D$.additional)))),R$+this.eol}printPtime(E$){return E$===void 0?"":"a=ptime:".concat(E$).concat(this.eol)}printMaxPtime(E$){return E$===void 0?"":"a=maxptime:".concat(E$).concat(this.eol)}printDirection(E$){return E$===void 0?"":"a=".concat(E$).concat(this.eol)}printSSRC(E$){return E$.map(T$=>Object.keys(T$.attributes).map(R$=>"a=ssrc:".concat(T$.ssrcId.toString(10)).concat(c$).concat(R$).concat(T$.attributes[R$]?":".concat(T$.attributes[R$]):"").concat(this.eol)).join("")).join("")}printRTCPMux(E$){return E$===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(E$){return E$===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(E$){return E$===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(E$){if(E$===void 0)return"";let T$="a=rtcp:".concat(E$.port);return E$.netType&&(T$+="".concat(c$).concat(E$.netType)),E$.addressType&&(T$+="".concat(c$).concat(E$.addressType)),E$.address&&(T$+="".concat(c$).concat(E$.address)),T$+this.eol}printMSId(E$){return E$.map(T$=>"a=msid:".concat(T$.id).concat(T$.appdata?"".concat(c$).concat(T$.appdata):"").concat(this.eol)).join("")}printImageattr(E$){return E$.map(T$=>"a=imageattr:".concat(T$).concat(this.eol)).join("")}printRid(E$){return E$.map(T$=>{let R$="a=rid:".concat(T$.id).concat(c$).concat(T$.direction);return T$.payloads&&(R$+="".concat(c$,"pt=").concat(T$.payloads.join(","))),T$.params.length>0&&(R$+="".concat(c$).concat(T$.params.map(D$=>D$.type==="depend"?"depend=".concat(D$.rids.join(",")):"".concat(D$.type,"=").concat(D$.val)).join(";"))),R$+this.eol}).join("")}printSimulcast(E$){return E$===void 0?"":"a=simulcast:".concat(E$).concat(this.eol)}printSCTPPort(E$){return E$===void 0?"":"a=sctp-port:".concat(E$).concat(this.eol)}printMaxMessageSize(E$){return E$===void 0?"":"a=max-message-size:".concat(E$).concat(this.eol)}printMid(E$){return E$===void 0?"":"a=mid:".concat(E$).concat(this.eol)}printSSRCGroups(E$){return E$.map(T$=>"a=ssrc-group:".concat(T$.semantic).concat(T$.ssrcIds.map(R$=>"".concat(c$).concat(R$.toString(10))).join("")).concat(this.eol)).join("")}}function I$(w$){return new k$().parse(w$)}function P$(w$,E$){return new L$().print(w$,E$)}}},t$={};function r$(n$){if(t$[n$])return t$[n$].exports;var i$=t$[n$]={exports:{}};return e$[n$](i$,i$.exports,r$),i$.exports}return r$.d=(n$,i$)=>{for(var o$ in i$)r$.o(i$,o$)&&!r$.o(n$,o$)&&Object.defineProperty(n$,o$,{enumerable:!0,get:i$[o$]})},r$.o=(n$,i$)=>Object.prototype.hasOwnProperty.call(n$,i$),r$.r=n$=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n$,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n$,"__esModule",{value:!0})},r$(8)})();var FU$1=VU$1.exports;function BU$1(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:XA$1("SVC_MODE");if(XA$1("ENABLE_SVC"))return function(t$){return t$ in Iw$1}(e$)?e$:Iw$1.L1T3}function jU$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function GU$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?jU$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):jU$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}function WU$1(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n$=arguments.length>3?arguments[3]:void 0;const{filterRTX:i$,filterVideoFec:o$,filterAudioFec:s$,filterAudioCodec:a$,filterVideoCodec:c$}=t$,{useXR:u$}=r$;let l$=[],d$=[],h$=[],p$=[],_$=!1,f$=!1;if(FU$1.parse(e$).mediaDescriptions.forEach(g$=>{n$&&n$!==g$.attributes.direction||(g$.media.mediaType!=="video"||_$||(d$=g$.attributes.payloads,p$=g$.attributes.extmaps,_$=!0),g$.media.mediaType!=="audio"||f$||(l$=g$.attributes.payloads,h$=g$.attributes.extmaps,f$=!0))}),!p$||d$.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!h$||l$.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(d$.forEach(g$=>{var v$;(v$=g$.rtpMap)!==null&&v$!==void 0&&v$.clockRate&&(g$.rtpMap.clockRate=parseInt(g$.rtpMap.clockRate)),u$&&g$.rtcpFeedbacks.push({type:"rrtr"})}),l$.forEach(g$=>{var v$;(v$=g$.rtpMap)!==null&&v$!==void 0&&v$.clockRate&&(g$.rtpMap.clockRate=parseInt(g$.rtpMap.clockRate)),u$&&g$.rtcpFeedbacks.push({type:"rrtr"})}),i$&&(l$=l$.filter(g$=>{var v$;return((v$=g$.rtpMap)===null||v$===void 0?void 0:v$.encodingName.toLowerCase())!=="rtx"}),d$=d$.filter(g$=>{var v$;return((v$=g$.rtpMap)===null||v$===void 0?void 0:v$.encodingName.toLowerCase())!=="rtx"})),o$&&(d$=d$.filter(g$=>{var v$;return!/(red)|(ulpfec)|(flexfec)/i.test(((v$=g$.rtpMap)===null||v$===void 0?void 0:v$.encodingName)||"")})),s$&&(l$=l$.filter(g$=>{var v$;return!/(red)|(ulpfec)|(flexfec)/i.test(((v$=g$.rtpMap)===null||v$===void 0?void 0:v$.encodingName)||"")})),a$&&(a$==null?void 0:a$.length)>0&&(l$=l$.filter(g$=>{var v$;return Dn$1(a$).call(a$,((v$=g$.rtpMap)===null||v$===void 0?void 0:v$.encodingName.toLowerCase())||"")})),c$&&(c$==null?void 0:c$.length)>0){const g$=d$.filter(v$=>{var y$;return Dn$1(c$).call(c$,((y$=v$.rtpMap)===null||y$===void 0?void 0:y$.encodingName.toLowerCase())||"")});d$=g$.concat(i$?[]:ax$1(g$,d$))}const m$=XA$1("UNSUPPORTED_VIDEO_CODEC");return m$&&m$.length>0&&(d$=d$.filter(g$=>!(g$.rtpMap&&Dn$1(m$).call(m$,g$.rtpMap.encodingName.toLowerCase())))),{audioCodecs:l$,videoCodecs:d$,audioExtensions:h$,videoExtensions:p$}}function HU$1(e$){const t$=FU$1.parse(e$);let r$,n$;for(const i$ of t$.mediaDescriptions){if(!r$){const o$=i$.attributes.iceUfrag,s$=i$.attributes.icePwd;if(!o$||!s$)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r$={iceUfrag:o$,icePwd:s$}}if(!n$){const o$=i$.attributes.fingerprints;o$.length>0&&(n$={fingerprints:o$})}}if(!n$&&t$.attributes.fingerprints.length>0&&(n$={fingerprints:t$.attributes.fingerprints}),!n$||!r$)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r$,dtlsParameters:n$}}function KU$1(e$,t$){const r$=[],n$=e$.attributes.ssrcGroups.filter(s$=>s$.semantic==="FID"),i$=e$.attributes.ssrcGroups.find(s$=>s$.semantic==="SIM"),o$=e$.attributes.ssrcs;if(i$)i$.ssrcIds.forEach(s$=>{var a$;const c$=(a$=n$.find(u$=>u$.ssrcIds[0]===s$))===null||a$===void 0?void 0:a$.ssrcIds[1];r$.push({ssrcId:s$,rtx:t$?c$:void 0})});else if(n$.length>0){const s$=n$[0].ssrcIds[0],a$=n$[0].ssrcIds[1];r$.push({ssrcId:s$,rtx:t$?a$:void 0})}else{if(o$.length===0)throw new Error("No ssrcs found on local media description.");r$.push({ssrcId:o$[0].ssrcId})}return r$}function YU$1(e$,t$,r$){const{cname:n$}=e$;let i$=[];t$&&(i$=qU$1(t$)),i$.length===0&&(i$=e$.iceParameters.candidates.map(l$=>({foundation:l$.foundation,componentId:"1",transport:l$.protocol,priority:l$.priority.toString(),connectionAddress:l$.ip,port:l$.port.toString(),type:l$.type,extension:{}})),fb$1.debug("Using candidates from gateway."));const o$={fingerprints:e$.dtlsParameters.fingerprints.map(l$=>({hashFunction:l$.algorithm,fingerprint:l$.fingerprint}))},s$={iceUfrag:e$.iceParameters.iceUfrag,icePwd:e$.iceParameters.icePwd};let a$;switch(e$.dtlsParameters.role){case"server":a$="passive";break;case"client":a$="active";break;case"auto":a$="actpass"}const c$=rx$1(e$.rtpCapabilities),u$=[];return Array.isArray(r$)&&r$.length>0&&r$.forEach(l$=>{u$.push({kind:dO$1.VIDEO,ssrcId:l$.v,rtx:l$.v_rtx,mslabel:"".concat(l$.v,"_").concat(l$.a)},{kind:dO$1.AUDIO,ssrcId:l$.a,mslabel:"".concat(l$.v,"_").concat(l$.a)})}),{dtlsParameters:o$,iceParameters:s$,candidates:i$,rtpCapabilities:c$,setup:a$,cname:n$,preSSRCs:u$}}function qU$1(e$){let t$=[];return e$.ip&&typeof e$.port=="number"&&(t$=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e$.ip,port:e$.port.toString(),type:"host",extension:{}}],fb$1.debug("Using remote candidate from AP ".concat(e$.ip,":").concat(e$.port)),e$.ip6&&(t$.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e$.ip6,port:e$.port.toString(),type:"host",extension:{}}),fb$1.debug("Using IPV6 remote candidate from AP ".concat(e$.ip6,":").concat(e$.port)))),t$}function zU$1(e$,t$,r$){const n$=[],i$=[];return e$.forEach(o$=>{let{ssrcId:s$,rtx:a$}=o$;const c$=TA$1(8,"track-"),u$={ssrcId:s$,attributes:GU$1({label:c$,mslabel:r$=r$||TA$1(10,""),msid:"".concat(r$," ").concat(c$)},t$&&{cname:t$})};if(n$.push(u$),a$!==void 0){const l$={ssrcId:a$,attributes:GU$1({label:c$,mslabel:r$,msid:"".concat(r$," ").concat(c$)},t$&&{cname:t$})};n$.push(l$),i$.push({semantic:"FID",ssrcIds:[s$,a$]})}}),e$.length>1&&i$.push({semantic:"SIM",ssrcIds:e$.map(o$=>{let{ssrcId:s$}=o$;return s$})}),{ssrcs:n$,ssrcGroups:i$}}function JU$1(e$,t$){t$ instanceof TM$1&&e$.attributes.payloads.forEach(r$=>{var n$;const i$=(n$=r$.rtpMap)===null||n$===void 0?void 0:n$.encodingName.toLowerCase();if(!i$||["opus","pcmu","pcma","g722"].indexOf(i$)===-1)return;r$.fmtp||(r$.fmtp={parameters:{}}),r$.fmtp.parameters.minptime="10",r$.fmtp.parameters.useinbandfec="1";const o$=t$._encoderConfig;o$&&i$!=="pcmu"&&i$!=="pcma"&&i$!=="g722"&&(o$.bitrate&&!Zv$1()&&(r$.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*o$.bitrate))),o$.sampleRate&&(r$.fmtp.parameters.maxplaybackrate="".concat(o$.sampleRate),r$.fmtp.parameters["sprop-maxcapturerate"]="".concat(o$.sampleRate)),o$.stereo&&(r$.fmtp.parameters.stereo="1",r$.fmtp.parameters["sprop-stereo"]="1"))})}function XU$1(e$){const t$=e$.attributes.unrecognized.findIndex(r$=>r$.attField==="x-google-flag"&&r$.attValue==="conference");t$!==-1&&e$.attributes.unrecognized.splice(t$,1)}function QU$1(e$,t$){var r$;if(!(t$ instanceof aU$1&&t$._encoderConfig&&t$._hints.indexOf(mL$1.SCREEN_TRACK)===-1))return;const n$=t$._encoderConfig;ZP$1().supportMinBitrate&&n$.bitrateMin&&e$.attributes.payloads.forEach(i$=>{var o$,s$;Dn$1(o$=["h264","h265","vp8","vp9","av1"]).call(o$,((s$=i$.rtpMap)===null||s$===void 0?void 0:s$.encodingName.toLowerCase())||"")&&(i$.fmtp||(i$.fmtp={parameters:{}}),i$.fmtp.parameters["x-google-min-bitrate"]="".concat(n$.bitrateMin))}),ZP$1().supportMinBitrate&&!Dn$1(r$=t$._hints).call(r$,mL$1.LOW_STREAM)&&n$.bitrateMax&&e$.attributes.payloads.forEach(i$=>{var o$,s$;Dn$1(o$=["h264","h265","vp8","vp9","av1"]).call(o$,((s$=i$.rtpMap)===null||s$===void 0?void 0:s$.encodingName.toLowerCase())||"")&&(i$.fmtp||(i$.fmtp={parameters:{}}),i$.fmtp.parameters["x-google-start-bitrate"]="".concat(XA$1("X_GOOGLE_START_BITRATE")||Math.floor(n$.bitrateMax)))})}function ZU$1(e$){if(e$.media.mediaType!=="video")return;const t$=Hv$1();if(t$.name!==Bv$1.SAFARI&&t$.os!==Fv$1.IOS)return;const r$=e$.attributes.extmaps.findIndex(n$=>/video-orientation/g.test(n$.extensionName));r$!==-1&&e$.attributes.extmaps.splice(r$,1)}function $U$1(e$,t$,r$){if(!t$)return;let n$,i$;if(e$.media.mediaType==="video"?(n$=r$.videoExtensions,i$=r$.videoCodecs):(n$=r$.audioExtensions,i$=r$.audioCodecs),t$.twcc===!0){const o$=n$.find(s$=>s$.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o$&&(e$.attributes.extmaps.find(a$=>a$.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e$.attributes.extmaps.push({entry:o$.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(a$,c$){return c$.filter(u$=>!!a$.find(l$=>l$.payloadType===u$.payloadType&&!!l$.rtcpFeedbacks.find(d$=>d$.type==="transport-cc")))}(i$,e$.attributes.payloads).forEach(a$=>{a$.rtcpFeedbacks.find(c$=>c$.type==="transport-cc")||a$.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t$.twcc===!1){const o$=e$.attributes.extmaps.findIndex(s$=>s$.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o$!==-1&&e$.attributes.extmaps.splice(o$,1),e$.attributes.payloads.forEach(s$=>{const a$=s$.rtcpFeedbacks.findIndex(c$=>c$.type==="transport-cc");a$!==-1&&s$.rtcpFeedbacks.splice(a$,1)})}if(t$.remb===!0){const o$=n$.find(s$=>s$.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");o$&&(e$.attributes.extmaps.find(a$=>a$.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e$.attributes.extmaps.push({entry:o$.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(a$,c$){return c$.filter(u$=>!!a$.find(l$=>l$.payloadType===u$.payloadType&&!!l$.rtcpFeedbacks.find(d$=>d$.type==="goog-remb")))}(i$,e$.attributes.payloads).forEach(a$=>{a$.rtcpFeedbacks.find(c$=>c$.type==="goog-remb")||a$.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t$.remb===!1){const o$=e$.attributes.extmaps.findIndex(s$=>s$.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");o$!==-1&&e$.attributes.extmaps.splice(o$,1),e$.attributes.payloads.forEach(s$=>{const a$=s$.rtcpFeedbacks.findIndex(c$=>c$.type==="goog-remb");a$!==-1&&s$.rtcpFeedbacks.splice(a$,1)})}}function ex$1(e$,t$,r$){if(Zv$1()||e$.media.mediaType!=="video"||!(t$ instanceof aU$1)||r$!=="vp9"&&r$!=="vp8"||r$==="vp8"&&!XA$1("SIMULCAST")||r$==="vp9"&&XA$1("ENABLE_SVC")||t$._scalabilityMode===void 0||t$._scalabilityMode.numSpatialLayers<=1)return;const n$=r$==="vp8"?2:t$._scalabilityMode.numSpatialLayers,i$=e$.attributes.ssrcs[0],o$=e$.attributes.ssrcGroups.find(a$=>a$.semantic==="FID"&&a$.ssrcIds[0]===i$.ssrcId),s$={semantic:"SIM",ssrcIds:[i$.ssrcId]};for(let a$=1;a$<n$;a$++)e$.attributes.ssrcs.push({ssrcId:i$.ssrcId+a$,attributes:sA$1(i$.attributes)}),s$.ssrcIds.push(i$.ssrcId+a$),o$&&(e$.attributes.ssrcs.push({ssrcId:o$.ssrcIds[1]+a$,attributes:sA$1(i$.attributes)}),e$.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i$.ssrcId+a$,o$.ssrcIds[1]+a$]}));e$.attributes.ssrcGroups.unshift(s$)}async function tx$1(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r$=new RTCPeerConnection;r$.addTransceiver("video",{direction:"sendonly"}),r$.addTransceiver("audio",{direction:"sendonly"}),r$.addTransceiver("video",{direction:"recvonly"}),r$.addTransceiver("audio",{direction:"recvonly"});const n$=(await r$.createOffer()).sdp,{send:i$,recv:o$,sendrecv:s$}=function(){let a$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u$=arguments.length>2?arguments[2]:void 0;const l$=WU$1(u$,a$,c$,"sendonly"),d$=WU$1(u$,a$,c$,"recvonly"),h$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(nx$1(l$,d$,"videoExtensions",h$,p$,_$),nx$1(l$,d$,"videoCodecs",h$,p$,_$),nx$1(l$,d$,"audioExtensions",h$,p$,_$),nx$1(l$,d$,"audioCodecs",h$,p$,_$),XA$1("RAISE_H264_BASELINE_PRIORITY")){const f$=_$.videoCodecs.findIndex(m$=>{var g$,v$;return((g$=m$.rtpMap)===null||g$===void 0?void 0:g$.encodingName.toLocaleLowerCase())==="h264"&&((v$=m$.fmtp)===null||v$===void 0?void 0:v$.parameters["profile-level-id"])==="42001f"});if(f$!==-1){const m$=_$.videoCodecs.findIndex(g$=>{var v$;return((v$=g$.rtpMap)===null||v$===void 0?void 0:v$.encodingName.toLocaleLowerCase())==="h264"});if(m$<f$){fb$1.debug("raising H264 baseline profile priority");const g$=_$.videoCodecs[f$];_$.videoCodecs.splice(f$,1),_$.videoCodecs.splice(m$,0,g$)}m$!==-1&&(p$.videoCodecs=p$.videoCodecs.filter(g$=>{var v$,y$;return!(((v$=g$.rtpMap)===null||v$===void 0?void 0:v$.encodingName.toLocaleLowerCase())==="h264"&&((y$=g$.fmtp)===null||y$===void 0?void 0:y$.parameters["profile-level-id"])!=="42001f")})),m$!==-1&&XA$1("FILTER_SEND_H264_BASELINE")&&(h$.videoCodecs=h$.videoCodecs.filter(g$=>{var v$,y$;return!(((v$=g$.rtpMap)===null||v$===void 0?void 0:v$.encodingName.toLocaleLowerCase())==="h264"&&((y$=g$.fmtp)===null||y$===void 0?void 0:y$.parameters["profile-level-id"])!=="42001f")}))}}return{send:h$,recv:p$,sendrecv:_$}}(e$,t$,n$);try{r$.close()}catch{}return{send:i$,recv:o$,sendrecv:s$}}function ix$1(){const e$={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t$=WU$1(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),r$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(nx$1(e$,t$,"videoExtensions",r$,n$,i$),nx$1(e$,t$,"videoCodecs",r$,n$,i$),nx$1(e$,t$,"audioExtensions",r$,n$,i$),nx$1(e$,t$,"audioCodecs",r$,n$,i$),XA$1("RAISE_H264_BASELINE_PRIORITY")){const o$=i$.videoCodecs.findIndex(s$=>s$.rtpMap&&s$.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&s$.fmtp&&s$.fmtp.parameters["profile-level-id"]==="42001f");if(o$!==-1){const s$=i$.videoCodecs.findIndex(a$=>a$.rtpMap&&a$.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(s$<o$){fb$1.debug("raising H264 baseline profile priority");const a$=i$.videoCodecs[o$];i$.videoCodecs.splice(o$,1),i$.videoCodecs.splice(s$,0,a$)}s$!==-1&&(n$.videoCodecs=n$.videoCodecs.filter(a$=>!(a$.rtpMap&&a$.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&a$.fmtp&&a$.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:r$,recv:n$,sendrecv:i$}}function nx$1(e$,t$,r$,n$,i$,o$){if(r$==="videoExtensions"||r$==="audioExtensions"){const s$=[];return e$[r$].forEach(a$=>{t$[r$].some((c$,u$)=>{if(a$.entry===c$.entry&&a$.extensionName===c$.extensionName)return s$.push(u$),!0})?o$[r$].push(a$):n$[r$].push(a$)}),void t$[r$].forEach((a$,c$)=>{s$.indexOf(c$)===-1&&i$[r$].push(a$)})}if(r$==="videoCodecs"||r$==="audioCodecs"){const s$=[];return e$[r$].forEach(a$=>{t$[r$].some((c$,u$)=>{if(a$.payloadType===c$.payloadType&&JSON.stringify(a$)===JSON.stringify(c$))return s$.push(u$),!0})?o$[r$].push(a$):n$[r$].push(a$)}),void t$[r$].forEach((a$,c$)=>{s$.indexOf(c$)===-1&&i$[r$].push(a$)})}}function rx$1(e$){const{send:t$,recv:r$,sendrecv:n$}=e$;if(!n$){if(!t$||!r$)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t$,recv:r$}}let i$,o$;return t$?(i$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i$.audioCodecs=[...t$.audioCodecs,...n$.audioCodecs],i$.videoCodecs=[...t$.videoCodecs,...n$.videoCodecs],i$.audioExtensions=[...t$.audioExtensions,...n$.audioExtensions],i$.videoExtensions=[...t$.videoExtensions,...n$.videoExtensions]):i$=n$,r$?(o$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o$.audioCodecs=[...r$.audioCodecs,...n$.audioCodecs],o$.videoCodecs=[...r$.videoCodecs,...n$.videoCodecs],o$.audioExtensions=[...r$.audioExtensions,...n$.audioExtensions],o$.videoExtensions=[...r$.videoExtensions,...n$.videoExtensions]):o$=n$,{send:i$,recv:o$}}function ox$1(e$){e$.media.mediaType==="audio"&&e$.attributes.payloads.filter(t$=>{var r$;return((r$=t$.rtpMap)===null||r$===void 0?void 0:r$.encodingName.toLowerCase())==="opus"}).forEach(t$=>{t$.fmtp||(t$.fmtp={parameters:{}}),t$.fmtp.parameters.stereo="1",t$.fmtp.parameters["sprop-stereo"]="1"})}function sx$1(e$,t$,r$,n$){let i$=[];if(e$===dO$1.VIDEO){if(XA$1("H264_PROFILE_LEVEL_ID")&&n$==="h264"&&(i$=t$.videoCodecs.filter(o$=>{var s$;return Dn$1(s$=o$.rtpMap&&o$.rtpMap.encodingName.toLowerCase()||"").call(s$,n$)&&o$&&o$.fmtp&&o$.fmtp.parameters["profile-level-id"]===XA$1("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i$)||i$.length===0){let o$=[];const s$=[],a$=[],c$=[];if(r$.videoCodecs.forEach(u$=>{const l$=u$.rtpMap&&u$.rtpMap.encodingName.toLowerCase()||"";Dn$1(l$).call(l$,n$)?o$.push(u$):Dn$1(l$).call(l$,"vp9")?s$.push(u$):Dn$1(l$).call(l$,"vp8")?a$.push(u$):Dn$1(l$).call(l$,"h264")&&c$.push(u$)}),o$.length===0){let u$="";s$.length!==0?(o$=s$,u$="vp9"):a$.length!==0?(o$=a$,u$="vp8"):c$.length!==0&&(o$=c$,u$="h264"),fb$1.warning("codec ".concat(n$," not included in rtpCapabilities, fallback to default payloads: ").concat(u$))}o$.length!==0&&(i$=t$.videoCodecs.filter(u$=>o$.some(l$=>l$.payloadType===u$.payloadType)))}if(i$.length===0&&(fb$1.warning("codec ".concat(n$," not included in rtpCapabilities, fallback to default payloads: ").concat(t$.videoCodecs[0].rtpMap&&t$.videoCodecs[0].rtpMap.encodingName)),i$=t$.videoCodecs),XA$1("USE_PUB_RTX")||XA$1("USE_SUB_RTX")){const o$=ax$1(i$,t$.videoCodecs);i$=[...i$,...o$]}}else i$=t$.audioCodecs.filter(o$=>{var s$;return Dn$1(s$=o$.rtpMap&&o$.rtpMap.encodingName.toLowerCase()||"").call(s$,n$)}),i$.length===0&&(fb$1.warning("codec ".concat(n$," not included in rtpCapabilities, fallback to opus")),i$=t$.audioCodecs.filter(o$=>{var s$;return Dn$1(s$=o$.rtpMap&&o$.rtpMap.encodingName.toLowerCase()||"").call(s$,"opus")}));return i$}function ax$1(e$,t$){const r$=e$.map(n$=>n$.payloadType.toString());return t$.filter(n$=>n$.rtpMap&&n$.rtpMap.encodingName==="rtx"&&n$.fmtp&&n$.fmtp.parameters.apt&&Dn$1(r$).call(r$,n$.fmtp&&n$.fmtp.parameters.apt))}async function cx$1(e$,t$,r$){const n$=t$.toString(),i$=lx$1(n$,"offer","remote","exchangeSDP");await e$.setRemoteDescription({type:"offer",sdp:n$});const o$=await e$.createAnswer();if(!o$.sdp)throw new Error("cannot get answer sdp");let s$=o$.sdp;s$=dx$1(s$,r$||{}),i$==null||i$(s$||""),await e$.setLocalDescription({type:"answer",sdp:s$})}function dx$1(e$,t$,r$){const n$=FU$1.parse(e$),{useXR:i$}=t$;return n$.mediaDescriptions.forEach(o$=>{var s$;o$.attributes.mid&&(Array.isArray(r$)&&!Dn$1(r$).call(r$,o$.attributes.mid)||(o$.media.mediaType==="audio"&&ox$1(o$),i$&&Dn$1(s$=["audio","video"]).call(s$,o$.media.mediaType)&&o$.attributes.payloads.forEach(a$=>{a$.rtcpFeedbacks.findIndex(c$=>c$.type==="rrtr")===-1&&a$.rtcpFeedbacks.push({type:"rrtr"})})))}),FU$1.print(n$)}function lx$1(e$,t$,r$,n$){if(XA$1("SDP_LOGGING"))return fb$1.upload("exchanging ".concat(r$," ").concat(t$," SDP during P2PConnection.").concat(n$,`
`),e$),t$==="offer"?i$=>{lx$1(i$,"answer",r$==="local"?"remote":"local",n$)}:void 0}function ux$1(e$,t$){return typeof XA$1(e$)===t$?XA$1(e$):void 0}function hx$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function px$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?hx$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):hx$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}const _x$1=new Map;let Ex$1=class extends xy$1{get state(){return this._state}set state(t$){if(t$===this._state)return;const r$=this._state;this._state=t$,t$==="DISCONNECTED"&&this._disconnectedReason?this.emit($w$1.CONNECTION_STATE_CHANGE,t$,r$,this._disconnectedReason):this.emit($w$1.CONNECTION_STATE_CHANGE,t$,r$)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t$){fb$1.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t$)),this._joinGatewayStartTime=t$}constructor(t$,r$){super(),Fg$1(this,"store",void 0),Fg$1(this,"joinInfo",void 0),Fg$1(this,"key",void 0),Fg$1(this,"ntpOffset",0),Fg$1(this,"signal",void 0),Fg$1(this,"role",void 0),Fg$1(this,"inChannelInfo",{joinAt:null,duration:0}),Fg$1(this,"spec",void 0),Fg$1(this,"_state","DISCONNECTED"),Fg$1(this,"_statsCollector",void 0),Fg$1(this,"_disconnectedReason",void 0),Fg$1(this,"isSignalRecover",!1),Fg$1(this,"hasChangeBGPAddress",!1),Fg$1(this,"trafficStatsInterval",void 0),Fg$1(this,"networkQualityInterval",void 0),Fg$1(this,"_joinGatewayStartTime",0),Fg$1(this,"_signalTimeout",!1),Fg$1(this,"_clientRoleOptions",void 0),Fg$1(this,"_isProactiveJoin",!1),this.store=t$,this.spec=r$,this.signal=this.store.useP2P?new xU$1(px$1(px$1({},r$),{},{retryConfig:r$.websocketRetryConfig}),t$):new KO$1(px$1(px$1({},r$),{},{retryConfig:r$.websocketRetryConfig}),t$),this._statsCollector=r$.statsCollector,this.role=r$.role||"audience",this._clientRoleOptions=r$.clientRoleOptions,this.handleSignalEvents()}async join(t$,r$,n$){this.store.joinGatewayStart(),t$.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i$=Date.now();let o$=_x$1.get(t$.cname);if(o$||(o$=new Map,_x$1.set(t$.cname,o$)),this._isProactiveJoin=!0,o$.has(t$.uid)){const u$=new yb$1(Ry$1.UID_CONFLICT);throw vb$1.joinGateway(t$.sid,{lts:i$,succ:!1,ec:u$.code,addr:null,uid:t$.uid,cid:t$.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t$.proxyServer,signalChannel:"0",preload:t$.preload}),this._isProactiveJoin=!1,u$}o$.set(t$.uid,!0),this.joinInfo=t$,this.key=r$;let s$=0;this.joinGatewayStartTime=i$;const a$=t$.proxyServer;try{fb$1.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(s$));const u$=t$.gatewayAddrs.map(l$=>{let{address:d$}=l$;const[h$,p$]=d$.split(":"),_$={host:h$,port:p$};return t$.proxyServer&&(_$.proxy=t$.proxyServer),_$});s$=(await this.signal.init(u$,n$)).uid,fb$1.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(s$," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(u$){var c$;throw fb$1.error("[".concat(this.store.clientId,"] User join failed"),u$.toString()),vb$1.joinGateway(t$.sid,{lts:i$,succ:!1,ec:((c$=u$.data)===null||c$===void 0?void 0:c$.desc)||u$.code,errorMsg:u$.message,addr:this.signal.url,uid:t$.uid,cid:t$.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!a$,signalChannel:"0",preload:t$.preload}),this._isProactiveJoin=!1,o$.delete(t$.uid),this.signal.close(),u$}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),fb$1.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(u$=>{fb$1.warning("[".concat(this.store.clientId,"] get traffic stats error"),u$.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit($w$1.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit($w$1.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit($w$1.NETWORK_QUALITY,{uplinkNetworkQuality:$O(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:$O(this._statsCollector.trafficStats.B_dnq)}):this.emit($w$1.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),s$}async leave(){let t$=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r$=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){r$!==Hy$1.FALLBACK&&(this.state="DISCONNECTING");try{t$||this.signal.connectionState!==Nw$1.CONNECTED||await function(n$,i$){return i$===1/0?n$:Gh$1.race([n$,fA$1(i$)])}(this.signal.request(Pw$1.LEAVE,void 0,!0),3e3)}catch(n$){fb$1.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),n$)}this.signal.close(r$),r$!==Hy$1.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t$,r$,n$){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb$1(Ry$1.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i$={state:"offer",p2p_id:this.store.p2pId,ortc:r$,mode:this.spec.mode,extend:XA$1("PUB_EXTEND"),twcc:!!XA$1("PUBLISH_TWCC"),rtx:!!XA$1("USE_PUB_RTX")};try{return(await this.signal.request(Pw$1.PUBLISH,i$,!0))._message}catch(o$){if(n$&&o$.data&&o$.data.code===Ow$1.ERR_PUBLISH_REQUEST_INVALID)return fb$1.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),o$.toString()),await this.tryUnpubBeforeRepub(t$,r$),this.publish(t$,r$,!1);throw o$}}async publishDataChannel(t$,r$,n$){var i$;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb$1(Ry$1.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o$={stream_id:r$.streamId,ordered:r$.ordered?1:0,max_retrans_times:(i$=r$.maxRetransmits)!==null&&i$!==void 0?i$:10,channel_id:r$.channelId,metadata:r$.metadata};try{await this.signal.request(Pw$1.PUBLISH_DATASTREAM,o$,!0)}catch(s$){if(n$&&s$.data&&s$.data.code===Ow$1.ERR_PUBLISH_REQUEST_INVALID)return fb$1.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),s$.toString()),await this.tryUnpubDataChannelBeforeRepub(t$,r$),this.publishDataChannel(t$,r$,!1);throw s$}}async unpublish(t$,r$){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb$1(Ry$1.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Pw$1.UNPUBLISH,{stream_id:r$,ortc:t$},!0)}catch(n$){fb$1.warning("[".concat(this.store.clientId,"] unpublish warning: "),n$)}}async unpublishDataChannel(t$){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb$1(Ry$1.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Gh$1.all(t$.map(r$=>this.signal.request(Pw$1.UNPUBLISH_DATASTREAM,{channel_id:r$},!0)))}catch(r$){fb$1.warning("unpublish datachannels warning: ",r$)}}async presubscribe(t$,r$,n$){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb$1(Ry$1.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i$={stream_id:t$,stream_type:r$,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!XA$1("SUBSCRIBE_TWCC"),rtx:!!XA$1("USE_SUB_RTX")||void 0,extend:XA$1("SUB_EXTEND"),svc:Array.isArray(XA$1("SVC"))&&XA$1("SVC").length!==0?XA$1("SVC"):void 0};try{return await this.signal.request(Pw$1.PRE_SUBSCRIBE,i$,!0)}catch(o$){if(n$&&o$.data&&o$.data.code===Ow$1.ERR_SUBSCRIBE_REQUEST_INVALID)return fb$1.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),o$.toString()),this.presubscribe(t$,r$,!1);throw o$}}async subscribe(t$,r$,n$){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb$1(Ry$1.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i$={stream_id:t$,stream_type:r$.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!XA$1("SUBSCRIBE_TWCC"),rtx:!!XA$1("USE_SUB_RTX"),extend:XA$1("SUB_EXTEND"),ssrcId:r$.ssrcId,svc:Array.isArray(XA$1("SVC"))&&XA$1("SVC").length!==0?XA$1("SVC"):void 0};try{return(await this.signal.request(Pw$1.SUBSCRIBE,i$,!0))._message}catch(o$){if(n$&&o$.data&&o$.data.code===Ow$1.ERR_SUBSCRIBE_REQUEST_INVALID)return fb$1.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),o$.toString()),await this.tryUnsubBeforeResub(t$,r$),await this.subscribe(t$,r$,!1);throw o$}}async subscribeDataChannel(t$,r$,n$){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb$1(Ry$1.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i$={uid:t$,stream_id:r$.id,channel_id:r$.datachannelId};try{return void await this.signal.request(Pw$1.SUBSCRIBE_DATASTREAM,i$,!0)}catch(o$){if(n$&&o$.data&&o$.data.code===Ow$1.ERR_SUBSCRIBE_REQUEST_INVALID)return fb$1.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),o$.toString()),await this.tryUnsubDataChannelBeforeResub(t$,r$),await this.subscribeDataChannel(t$,r$,!1);throw o$}}async subscribeAll(t$,r$){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb$1(Ry$1.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const n$={p2p_id:this.store.p2pId,users:t$,dtx:!1,rtx:!!XA$1("USE_SUB_RTX"),twcc:!!XA$1("SUBSCRIBE_TWCC"),svc:Array.isArray(XA$1("SVC"))&&XA$1("SVC").length!==0?XA$1("SVC"):void 0};try{return await this.signal.request(Pw$1.SUBSCRIBE_STREAMS,n$,!0)}catch(i$){if(r$&&i$.data&&i$.data.code===Ow$1.ERR_SUBSCRIBE_REQUEST_INVALID)return fb$1.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i$.toString()),await this.tryMassUnsubBeforeResub(t$),await this.subscribeAll(t$,!1);throw i$}}async setVideoProfile(t$){const r$=function(n$){if(!(n$.bitrateMax&&n$.bitrateMin&&n$.frameRate&&n$.height&&n$.width))return;let i$=n$.frameRate,o$=n$.width,s$=n$.height,a$=!0;return typeof i$!="number"&&(i$=i$.exact||i$.ideal||i$.max||i$.min||0,i$||(a$=!1)),typeof o$!="number"&&(o$=o$.exact||o$.ideal||o$.max||o$.min||0,o$||(a$=!1)),typeof s$!="number"&&(s$=s$.exact||s$.ideal||s$.max||s$.min||0,i$||(a$=!1)),a$?{stream_type:0,width:o$,height:s$,fps:i$,start_bps:1e3*n$.bitrateMax,min_bps:1e3*n$.bitrateMin,target_bps:1e3*n$.bitrateMax}:void 0}(t$);if(r$)return this.signal.request(Pw$1.SET_VIDEO_PROFILE,r$);fb$1.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t$,r$){try{await this.signal.request(Pw$1.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t$,stream_id:r$},!0)}catch(n$){fb$1.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),n$)}}async unsubscribeDataChannel(t$,r$){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb$1(Ry$1.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Gh$1.all(t$.map(n$=>this.signal.request(Pw$1.UNSUBSCRIBE_DATASTREAM,{stream_id:n$,uid:r$},!0)))}catch(n$){fb$1.warning("unsubscribeDataChannel warning: ",n$)}}async massUnsubscribe(t$){try{await this.signal.request(Pw$1.UNSUBSCRIBE_STREAMS,t$,!0)}catch(r$){fb$1.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),r$)}}async reconnectPC(t$){const{iceParameters:r$,dtlsParameters:n$,rtpCapabilities:i$}=t$;return{gatewayEstablishParams:await this.signal.request(Pw$1.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:r$,dtlsParameters:n$,rtpCapabilities:i$}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Pw$1.GATEWAY_INFO)}async renewToken(t$){await this.signal.request(Pw$1.RENEW_TOKEN,t$),this.key=t$.token}async setClientRole(t$,r$){if(r$&&(this._clientRoleOptions=Object.assign({},r$)),this.state!=="CONNECTED")return void(this.role=t$);let n$,i$=0;t$==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(n$=this._clientRoleOptions.delay,i$=1):i$=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i$=0,await this.signal.request(Pw$1.SET_CLIENT_ROLE,{role:t$,level:i$,delay:n$,client_ts:Date.now()}),this.role=t$}async setRemoteVideoStreamType(t$,r$){await this.signal.request(Pw$1.SWITCH_VIDEO_STREAM,{stream_id:t$,stream_type:r$})}async setDefaultRemoteVideoStreamType(t$){await this.signal.request(Pw$1.DEFAULT_VIDEO_STREAM,{stream_type:t$})}async setStreamFallbackOption(t$,r$){await this.signal.request(Pw$1.SET_FALLBACK_OPTION,{stream_id:t$,fallback_type:r$})}async pickSVCLayer(t$,r$){await this.signal.request(Pw$1.PICK_SVC_LAYER,{stream_id:t$,spatial_layer:r$.spatialLayer,temporal_layer:r$.temporalLayer})}async setRTM2Flag(t$){await this.signal.request(Pw$1.SET_RTM2_FLAG,{rtm2_flag:t$})}async sendExtensionMessage(t$,r$,n$){if(this.signal instanceof xU$1)return this.signal.sendExtensionMessage(t$,r$,n$)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),px$1({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Pw$1.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t$=_x$1.get(this.joinInfo.cname);t$&&t$.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t$=function(r$){let n$;return n$=r$.startsWith("dc")?r$.match(/(dc\:\/\/)?([^:]+):(\d+)/):r$.match(/(wss\:\/\/)?([^:]+):(\d+)/),n$?{username:KA$1.username,password:KA$1.password,turnServerURL:n$[2],tcpport:parseInt(n$[3])+30,udpport:parseInt(n$[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t$&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(px$1(px$1({},KA$1),{},{turnServerURL:t$.turnServerURL,tcpport:t$.tcpport,udpport:t$.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t$=await this.signal.request(Pw$1.TRAFFIC_STATS,void 0,!0);t$.timestamp=Date.now(),t$.ntp_offset!=null&&(this.ntpOffset=t$.ntp_offset),t$.peer_delay.forEach(r$=>{const n$=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i$=>i$.peer_uid===r$.peer_uid);n$&&n$.B_st!==r$.B_st&&oA$1(()=>{this.emit($w$1.STREAM_TYPE_CHANGE,r$.peer_uid,r$.B_st)})}),this._statsCollector.updateTrafficStats(t$)}getJoinMessage(t$){if(!this.joinInfo||!this.key)throw new yb$1(Ry$1.UNEXPECTED_ERROR,"can not generate join message, no join info");const r$=Object.assign({},this.joinInfo.apResponse);let n$=XA$1("REPORT_APP_SCENARIO");if(typeof n$!="string")try{n$=JSON.stringify(n$)}catch{n$=void 0}n$&&n$.length>128&&(n$=void 0);const i$=!(Zv$1()||ty$1(87)||eL$1())&&typeof XA$1("ENABLE_PRE_SUB")=="boolean"&&XA$1("ENABLE_PRE_SUB"),o$=!eL$1()&&ux$1("ENABLE_PREALLOC_PC","boolean"),s$=px$1({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:GA$1,browser:navigator.userAgent,process_id:XA$1("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r$,extend:XA$1("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:n$,attributes:{userAttributes:{enablePublishedUserList:XA$1("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:XA$1("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof XA$1("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?XA$1("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof XA$1("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?XA$1("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof XA$1("ENABLE_USER_LICENSE_CHECK")=="boolean"?XA$1("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:XA$1("USE_PUB_RTX")===!0||XA$1("USE_SUB_RTX")===!0||void 0,disableFEC:XA$1("DISABLE_FEC"),enableNTPReport:!!XA$1("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!XA$1("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!XA$1("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:ux$1("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!XA$1("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!XA$1("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:ux$1("USE_XR","boolean"),enableLossbasedBwe:ux$1("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!XA$1("ENABLE_AUT_CC")||void 0,enableCCFallback:ux$1("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:o$,preSubNum:i$?ux$1("PRE_SUB_NUM","number"):void 0,enablePubTWCC:ux$1("PUBLISH_TWCC","boolean"),enableSubTWCC:ux$1("SUBSCRIBE_TWCC","boolean"),enablePubRTX:ux$1("USE_PUB_RTX","boolean"),enableSubRTX:ux$1("USE_SUB_RTX","boolean"),enableSubSVC:XA$1("ENABLE_SVC")?XA$1("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(XA$1("SVC"))&&XA$1("SVC").length!==0?XA$1("SVC"):void 0}},join_ts:this.joinGatewayStartTime},t$);return this.joinInfo.stringUid&&(s$.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(s$.aes_mode=this.joinInfo.aesmode,XA$1("ENCRYPT_AES")?(s$.aes_secret=this.joinInfo.aespassword,s$.aes_encrypt=!0):s$.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(s$.aes_salt=this.joinInfo.aessalt)),r$.addresses[this.signal.websocket.currentURLIndex]&&(s$.ap_response.ticket=r$.addresses[this.signal.websocket.currentURLIndex].ticket,delete r$.addresses),this.joinInfo.defaultVideoStream!==void 0&&(s$.default_video_stream=this.joinInfo.defaultVideoStream),s$}getRejoinMessage(){if(!this.joinInfo)throw new yb$1(Ry$1.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Dw$1.WS_RECONNECT_WAITTING_FINISH,t$=>{var r$;Dn$1(r$=["tryNext","recover"]).call(r$,t$)&&this.joinInfo&&vb$1.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(Dw$1.WS_RECONNECT_CREATE_CONNECTION,t$=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Dw$1.WS_RECONNECTING,t$=>{this.joinInfo&&vb$1.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t$||Jy$1.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",vb$1.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:2}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Dw$1.WS_CLOSED,t$=>{let r$;switch(t$){case Hy$1.LEAVE:r$=Jy$1.LEAVE;break;case Hy$1.UID_BANNED:case Hy$1.IP_BANNED:case Hy$1.CHANNEL_BANNED:case Hy$1.SERVER_ERROR:r$=Jy$1.SERVER_ERROR;break;case Hy$1.FALLBACK:r$=Jy$1.FALLBACK;break;case Hy$1.LICENSE_MISSING:case Hy$1.LICENSE_EXPIRED:case Hy$1.LICENSE_MINUTES_EXCEEDED:case Hy$1.LICENSE_PERIOD_INVALID:case Hy$1.LICENSE_MULTIPLE_SDK_SERVICE:case Hy$1.LICENSE_ILLEGAL:case Hy$1.TOKEN_EXPIRE:r$=t$;break;default:r$=Jy$1.NETWORK_ERROR}fb$1.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(r$||"undefined -> "+Jy$1.NETWORK_ERROR)),this.joinInfo&&vb$1.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t$===Hy$1.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r$}),this._disconnectedReason=t$,t$!==Hy$1.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Dw$1.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(fb$1.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),vb$1.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const t$=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t$)return void fb$1.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t$));JA$1("EVENT_REPORT_DOMAIN",t$[1]),JA$1("EVENT_REPORT_BACKUP_DOMAIN",t$[1]),JA$1("LOG_UPLOAD_SERVER","".concat(t$[1],":6444"))}}),this.signal.on(kw$1.ON_UPLINK_STATS,t$=>{this._statsCollector.updateUplinkStats(t$)}),this.signal.on(Dw$1.REQUEST_RECOVER,(t$,r$,n$)=>{if(!this.joinInfo)return n$(new yb$1(Ry$1.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t$&&(this.joinInfo.multiIP=t$,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Zy$1(this,$w$1.REQUEST_NEW_GATEWAY_LIST).then(r$).catch(n$)}),this.signal.on(Dw$1.REQUEST_JOIN_INFO,async t$=>{var r$;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t$(this.getJoinMessage({ortc:{}}));const{iceParameters:n$,dtlsParameters:i$,rtpCapabilities:o$}=await Zy$1(this,$w$1.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(r$=this.joinInfo)===null||r$===void 0?void 0:r$.turnServer});t$(this.getJoinMessage({ortc:{iceParameters:n$,dtlsParameters:i$,rtpCapabilities:o$,version:"2"}}))}),this.signal.on(Dw$1.REQUEST_REJOIN_INFO,t$=>{t$(this.getRejoinMessage())}),this.signal.on(Dw$1.REPORT_JOIN_GATEWAY,(t$,r$)=>{if(!this.joinInfo)return;let n$,i$="";var o$;t$ instanceof yb$1?(n$=((o$=t$.data)===null||o$===void 0?void 0:o$.desc)||t$.code,i$=t$.message):n$=t$,vb$1.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:n$,errorMsg:i$,addr:r$,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1}),this.signal.on(Dw$1.IS_P2P_DISCONNECTED,t$=>{t$(tA$1(this,$w$1.IS_P2P_DISCONNECTED))}),this.signal.on(Dw$1.DISCONNECT_P2P,()=>{this.emit($w$1.DISCONNECT_P2P)}),this.signal.on(Dw$1.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Dw$1.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Dw$1.JOIN_RESPONSE,t$=>{const r$=this.getCurrentGatewayAddress();this.emit($w$1.JOIN_RESPONSE,t$,r$)}),this.signal.on(Dw$1.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const t$=this.getCurrentGatewayAddress(),r$=XA$1("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(t$&&r$){const n$=qU$1(t$);this.emit($w$1.PRE_CONNECT_PC,{candidates:n$,fingerprint:r$})}}}),this.signal.on(Dw$1.RECOVER_NOTIFICATION,t$=>{this.joinInfo&&typeof XA$1("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(XA$1("AP_REQUEST_DETAIL"),";").concat(t$))})}async tryUnsubBeforeResub(t$,r$){try{await this.signal.request(Pw$1.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t$,ortc:[r$]},!0)}catch(n$){throw fb$1.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),n$),n$}}async tryUnsubDataChannelBeforeResub(t$,r$){try{await this.signal.request(Pw$1.UNSUBSCRIBE,{stream_id:r$.id},!0)}catch(n$){throw fb$1.warning("unsubscribe datachannel warning",n$),n$}}async tryUnpubBeforeRepub(t$,r$){try{await this.signal.request(Pw$1.UNPUBLISH,{stream_id:t$,ortc:r$},!0)}catch(n$){throw fb$1.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),n$),n$}}async tryUnpubDataChannelBeforeRepub(t$,r$){try{await this.signal.request(Pw$1.UNPUBLISH_DATASTREAM,{channnel_id:r$.channelId},!0)}catch(n$){throw fb$1.warning("unpublish datastream warning: ",n$),n$}}async tryMassUnsubBeforeResub(t$){const r$={users:t$.map(n$=>({stream_id:n$.stream_id,stream_type:n$.stream_type}))};try{await this.signal.request(Pw$1.UNSUBSCRIBE_STREAMS,r$,!0)}catch(n$){throw fb$1.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),n$),n$}}async muteLocal(t$,r$){const n$={action:t$.find(i$=>i$.stream_type===Zw$1.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t$,stream_id:r$};try{await this.signal.request(Pw$1.CONTROL,n$,!0,!0)}catch(i$){throw fb$1.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i$),i$}}async unmuteLocal(t$,r$){const n$={action:t$.find(i$=>i$.stream_type===Zw$1.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t$,stream_id:r$};try{await this.signal.request(Pw$1.CONTROL,n$,!0,!0)}catch(i$){throw fb$1.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i$),i$}}async muteRemote(t$,r$){const n$={action:t$===dO$1.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:r$};try{await this.signal.request(Pw$1.CONTROL,n$,!0,!0)}catch(i$){throw fb$1.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i$),i$}}async unmuteRemote(t$,r$){const n$={action:t$===dO$1.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:r$};try{await this.signal.request(Pw$1.CONTROL,n$,!0,!0)}catch(i$){throw fb$1.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i$),i$}}uploadWRTCStats(t$){this.signal.uploadWRTCStats(t$)}upload(t$,r$){this.signal.upload(t$,r$)}getSignalRTT(){return this.signal.rtt}async restartICE(t$){const r$={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t$};try{return await this.signal.request(Pw$1.RESTART_ICE,r$,!0)}catch(n$){throw fb$1.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),n$),n$}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,Jy$1.P2P_FAILED)}getCurrentGatewayAddress(){var t$,r$;if(!XA$1("GATEWAY_WSS_ADDRESS"))return XA$1("USE_CANDIDATE_FROM_AP_DETAIL")&&(t$=this.joinInfo)!==null&&t$!==void 0&&t$.apGatewayAddress?(fb$1.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(r$=this.joinInfo)!==null&&r$!==void 0&&r$.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t$){await this.signal.request(Pw$1.SET_PARAMETER,{enablePublishAudioFilter:t$})}},fx$1=0,mx$1=0;function Tx$1(e$,t$,r$,n$){return new Gh$1((i$,o$)=>{t$.timeout=t$.timeout||XA$1("HTTP_CONNECT_TIMEOUT"),t$.responseType=t$.responseType||"json",t$.data&&!r$?(t$.data=JSON.stringify(t$.data),fx$1+=_A$1(t$.data)):r$&&(t$.data.size?fx$1+=t$.data.size:t$.data instanceof FormData?fx$1+=EA$1(t$.data):fx$1+=_A$1(JSON.stringify(t$.data))),t$.headers=t$.headers||{},t$.headers["Content-Type"]=t$.headers["Content-Type"]||"application/json",t$.method="POST",t$.url=e$,Lv$1.request(t$).then(s$=>{typeof s$.data=="string"?mx$1+=_A$1(s$.data):s$.data instanceof ArrayBuffer||s$.data instanceof Uint8Array?mx$1+=s$.data.byteLength:mx$1+=_A$1(JSON.stringify(s$.data)),n$&&i$({data:s$.data,headers:s$.headers}),i$(s$.data)}).catch(s$=>{Lv$1.isCancel(s$)?o$(new yb$1(Ry$1.OPERATION_ABORTED,"cancel token canceled")):s$.code==="ECONNABORTED"?o$(new yb$1(Ry$1.NETWORK_TIMEOUT,s$.message)):s$.response?o$(new yb$1(Ry$1.NETWORK_RESPONSE_ERROR,s$.response.status)):o$(new yb$1(Ry$1.NETWORK_ERROR,s$.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e$;function t$(A$){var I$=0;return function(){return I$<A$.length?{done:!1,value:A$[I$++]}:{done:!0}}}var r$=typeof Object.defineProperties=="function"?Object.defineProperty:function(A$,I$,P$){return A$==Array.prototype||A$==Object.prototype||(A$[I$]=P$.value),A$},n$,i$=function(A$){A$=[typeof globalThis=="object"&&globalThis,A$,typeof window=="object"&&window,typeof self=="object"&&self,typeof t=="object"&&t];for(var I$=0;I$<A$.length;++I$){var P$=A$[I$];if(P$&&P$.Math==Math)return P$}throw Error("Cannot find global object")}(this);function o$(A$,I$){if(I$)e:{var P$=i$;A$=A$.split(".");for(var w$=0;w$<A$.length-1;w$++){var E$=A$[w$];if(!(E$ in P$))break e;P$=P$[E$]}(I$=I$(w$=P$[A$=A$[A$.length-1]]))!=w$&&I$!=null&&r$(P$,A$,{configurable:!0,writable:!0,value:I$})}}function s$(A$){return(A$={next:A$})[Symbol.iterator]=function(){return this},A$}function a$(A$){var I$=typeof Symbol<"u"&&Symbol.iterator&&A$[Symbol.iterator];return I$?I$.call(A$):{next:t$(A$)}}if(o$("Symbol",function(A$){function I$(E$,T$){this.A=E$,r$(this,"description",{configurable:!0,writable:!0,value:T$})}if(A$)return A$;I$.prototype.toString=function(){return this.A};var P$="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",w$=0;return function E$(T$){if(this instanceof E$)throw new TypeError("Symbol is not a constructor");return new I$(P$+(T$||"")+"_"+w$++,T$)}}),o$("Symbol.iterator",function(A$){if(A$)return A$;A$=Symbol("Symbol.iterator");for(var I$="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),P$=0;P$<I$.length;P$++){var w$=i$[I$[P$]];typeof w$=="function"&&typeof w$.prototype[A$]!="function"&&r$(w$.prototype,A$,{configurable:!0,writable:!0,value:function(){return s$(t$(this))}})}return A$}),typeof Object.setPrototypeOf=="function")n$=Object.setPrototypeOf;else{var c$;e:{var u$={};try{u$.__proto__={a:!0},c$=u$.a;break e}catch{}c$=!1}n$=c$?function(A$,I$){if(A$.__proto__=I$,A$.__proto__!==I$)throw new TypeError(A$+" is not extensible");return A$}:null}var l$=n$;function d$(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h$(A$){if(A$.m)throw new TypeError("Generator is already running");A$.m=!0}function p$(A$,I$){return A$.h=3,{value:I$}}function _$(A$){this.g=new d$,this.G=A$}function f$(A$,I$,P$,w$){try{var E$=I$.call(A$.g.j,P$);if(!(E$ instanceof Object))throw new TypeError("Iterator result "+E$+" is not an object");if(!E$.done)return A$.g.m=!1,E$;var T$=E$.value}catch(R$){return A$.g.j=null,A$.g.s(R$),m$(A$)}return A$.g.j=null,w$.call(A$.g,T$),m$(A$)}function m$(A$){for(;A$.g.h;)try{var I$=A$.G(A$.g);if(I$)return A$.g.m=!1,{value:I$.value,done:!1}}catch(P$){A$.g.v=void 0,A$.g.s(P$)}if(A$.g.m=!1,A$.g.l){if(I$=A$.g.l,A$.g.l=null,I$.F)throw I$.D;return{value:I$.return,done:!0}}return{value:void 0,done:!0}}function g$(A$){this.next=function(I$){return A$.o(I$)},this.throw=function(I$){return A$.s(I$)},this.return=function(I$){return function(P$,w$){h$(P$.g);var E$=P$.g.j;return E$?f$(P$,"return"in E$?E$.return:function(T$){return{value:T$,done:!0}},w$,P$.g.return):(P$.g.return(w$),m$(P$))}(A$,I$)},this[Symbol.iterator]=function(){return this}}function v$(A$,I$){return I$=new g$(new _$(I$)),l$&&A$.prototype&&l$(I$,A$.prototype),I$}if(d$.prototype.o=function(A$){this.v=A$},d$.prototype.s=function(A$){this.l={D:A$,F:!0},this.h=this.C||this.u},d$.prototype.return=function(A$){this.l={return:A$},this.h=this.u},_$.prototype.o=function(A$){return h$(this.g),this.g.j?f$(this,this.g.j.next,A$,this.g.o):(this.g.o(A$),m$(this))},_$.prototype.s=function(A$){return h$(this.g),this.g.j?f$(this,this.g.j.throw,A$,this.g.o):(this.g.s(A$),m$(this))},o$("Array.prototype.entries",function(A$){return A$||function(){return function(I$,P$){I$ instanceof String&&(I$+="");var w$=0,E$=!1,T$={next:function(){if(!E$&&w$<I$.length){var R$=w$++;return{value:P$(R$,I$[R$]),done:!1}}return E$=!0,{done:!0,value:void 0}}};return T$[Symbol.iterator]=function(){return T$},T$}(this,function(I$,P$){return[I$,P$]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var y$=function(A$,I$){for(var P$=0;P$<A$.length;P$++)I$(A$[P$])},S$=function(A$){return A$.replace(/\r?\n|\r/g,`\r
`)},b$=function(A$,I$,P$){return I$ instanceof Blob?(P$=P$!==void 0?P$+"":typeof I$.name=="string"?I$.name:"blob",I$.name===P$&&Object.prototype.toString.call(I$)!=="[object Blob]"||(I$=new File([I$],P$)),[String(A$),I$]):[String(A$),String(I$)]},$$=function(A$,I$){if(A$.length<I$)throw new TypeError(I$+" argument required, but only "+A$.length+" present.")},C$=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,N$=C$.FormData,k$=C$.XMLHttpRequest&&C$.XMLHttpRequest.prototype.send,O$=C$.Request&&C$.fetch,U$=C$.navigator&&C$.navigator.sendBeacon,x$=C$.Element&&C$.Element.prototype,F$=C$.Symbol&&Symbol.toStringTag;F$&&(Blob.prototype[F$]||(Blob.prototype[F$]="Blob"),"File"in C$&&!File.prototype[F$]&&(File.prototype[F$]="File"));try{new File([],"")}catch{C$.File=function(I$,P$,w$){return I$=new Blob(I$,w$||{}),Object.defineProperties(I$,{name:{value:P$},lastModified:{value:+(w$&&w$.lastModified!==void 0?new Date(w$.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),F$&&Object.defineProperty(I$,F$,{value:"File"}),I$}}var L$=function(A$){return A$.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},M$=function(A$){this.i=[];var I$=this;A$&&y$(A$.elements,function(P$){if(P$.name&&!P$.disabled&&P$.type!=="submit"&&P$.type!=="button"&&!P$.matches("form fieldset[disabled] *"))if(P$.type==="file"){var w$=P$.files&&P$.files.length?P$.files:[new File([],"",{type:"application/octet-stream"})];y$(w$,function(E$){I$.append(P$.name,E$)})}else P$.type==="select-multiple"||P$.type==="select-one"?y$(P$.options,function(E$){!E$.disabled&&E$.selected&&I$.append(P$.name,E$.value)}):P$.type==="checkbox"||P$.type==="radio"?P$.checked&&I$.append(P$.name,P$.value):(w$=P$.type==="textarea"?S$(P$.value):P$.value,I$.append(P$.name,w$))})};if((e$=M$.prototype).append=function(A$,I$,P$){$$(arguments,2),this.i.push(b$(A$,I$,P$))},e$.delete=function(A$){$$(arguments,1);var I$=[];A$=String(A$),y$(this.i,function(P$){P$[0]!==A$&&I$.push(P$)}),this.i=I$},e$.entries=function A$(){var I$,P$=this;return v$(A$,function(w$){if(w$.h==1&&(I$=0),w$.h!=3)return I$<P$.i.length?w$=p$(w$,P$.i[I$]):(w$.h=0,w$=void 0),w$;I$++,w$.h=2})},e$.forEach=function(A$,I$){$$(arguments,1);for(var P$=a$(this),w$=P$.next();!w$.done;w$=P$.next()){var E$=a$(w$.value);w$=E$.next().value,E$=E$.next().value,A$.call(I$,E$,w$,this)}},e$.get=function(A$){$$(arguments,1);var I$=this.i;A$=String(A$);for(var P$=0;P$<I$.length;P$++)if(I$[P$][0]===A$)return I$[P$][1];return null},e$.getAll=function(A$){$$(arguments,1);var I$=[];return A$=String(A$),y$(this.i,function(P$){P$[0]===A$&&I$.push(P$[1])}),I$},e$.has=function(A$){$$(arguments,1),A$=String(A$);for(var I$=0;I$<this.i.length;I$++)if(this.i[I$][0]===A$)return!0;return!1},e$.keys=function A$(){var I$,P$,w$,E$,T$=this;return v$(A$,function(R$){if(R$.h==1&&(I$=a$(T$),P$=I$.next()),R$.h!=3)return P$.done?void(R$.h=0):(w$=P$.value,E$=a$(w$),p$(R$,E$.next().value));P$=I$.next(),R$.h=2})},e$.set=function(A$,I$,P$){$$(arguments,2),A$=String(A$);var w$=[],E$=b$(A$,I$,P$),T$=!0;y$(this.i,function(R$){R$[0]===A$?T$&&(T$=!w$.push(E$)):w$.push(R$)}),T$&&w$.push(E$),this.i=w$},e$.values=function A$(){var I$,P$,w$,E$,T$=this;return v$(A$,function(R$){if(R$.h==1&&(I$=a$(T$),P$=I$.next()),R$.h!=3)return P$.done?void(R$.h=0):(w$=P$.value,(E$=a$(w$)).next(),p$(R$,E$.next().value));P$=I$.next(),R$.h=2})},M$.prototype._asNative=function(){for(var A$=new N$,I$=a$(this),P$=I$.next();!P$.done;P$=I$.next()){var w$=a$(P$.value);P$=w$.next().value,w$=w$.next().value,A$.append(P$,w$)}return A$},M$.prototype._blob=function(){var A$="----formdata-polyfill-"+Math.random(),I$=[],P$="--"+A$+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(w$,E$){return typeof w$=="string"?I$.push(P$+L$(S$(E$))+`"\r
\r
`+S$(w$)+`\r
`):I$.push(P$+L$(S$(E$))+'"; filename="'+L$(w$.name)+`"\r
Content-Type: `+(w$.type||"application/octet-stream")+`\r
\r
`,w$,`\r
`)}),I$.push("--"+A$+"--"),new Blob(I$,{type:"multipart/form-data; boundary="+A$})},M$.prototype[Symbol.iterator]=function(){return this.entries()},M$.prototype.toString=function(){return"[object FormData]"},x$&&!x$.matches&&(x$.matches=x$.matchesSelector||x$.mozMatchesSelector||x$.msMatchesSelector||x$.oMatchesSelector||x$.webkitMatchesSelector||function(A$){for(var I$=(A$=(this.document||this.ownerDocument).querySelectorAll(A$)).length;0<=--I$&&A$.item(I$)!==this;);return-1<I$}),F$&&(M$.prototype[F$]="FormData"),k$){var V$=C$.XMLHttpRequest.prototype.setRequestHeader;C$.XMLHttpRequest.prototype.setRequestHeader=function(A$,I$){V$.call(this,A$,I$),A$.toLowerCase()==="content-type"&&(this.B=!0)},C$.XMLHttpRequest.prototype.send=function(A$){A$ instanceof M$?(A$=A$._blob(),this.B||this.setRequestHeader("Content-Type",A$.type),k$.call(this,A$)):k$.call(this,A$)}}O$&&(C$.fetch=function(A$,I$){return I$&&I$.body&&I$.body instanceof M$&&(I$.body=I$.body._blob()),O$.call(this,A$,I$)}),U$&&(C$.navigator.sendBeacon=function(A$,I$){return I$ instanceof M$&&(I$=I$._asNative()),U$.call(this,A$,I$)}),C$.FormData=M$}})();const Sx$1=()=>{const e$=XA$1("AREAS");return e$.length===0&&e$.push(iO$1.GLOBAL),Jn$1(e$).call(e$,(t$,r$,n$)=>{const i$=gx$1(r$);return i$?n$===0?i$:"".concat(t$,",").concat(i$):t$},"")},gx$1=e$=>e$===iO$1.OVERSEA?"".concat(rO$1.ASIA,",").concat(rO$1.EUROPE,",").concat(rO$1.AFRICA,",").concat(rO$1.NORTH_AMERICA,",").concat(rO$1.SOUTH_AMERICA,",").concat(rO$1.OCEANIA):rO$1[e$],Rx$1=e$=>{const t$={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e$.map(r$=>{const n$=oO$1[r$],i$=Object.keys(n$);i$&&i$.map(o$=>{o$!=="CODE"&&(t$[o$]=t$[o$].concat(n$[o$]))})}),t$},Cx$1={GLOBAL:{ASIA:[iO$1.CHINA,iO$1.JAPAN,iO$1.INDIA,iO$1.KOREA,iO$1.HKMC],EUROPE:[],NORTH_AMERICA:[iO$1.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Ix$1=Object.keys(Cx$1[iO$1.GLOBAL]),vx$1=[iO$1.CHINA,iO$1.NORTH_AMERICA,iO$1.EUROPE,iO$1.ASIA,iO$1.JAPAN,iO$1.INDIA,iO$1.OCEANIA,iO$1.SOUTH_AMERICA,iO$1.AFRICA,iO$1.KOREA,iO$1.HKMC,iO$1.US],yx$1=function(e$,t$){let r$=[];if(Dn$1(e$).call(e$,iO$1.GLOBAL)){const o$=[iO$1.GLOBAL,iO$1.OVERSEA],s$=Object.keys(oO$1);if(t$===iO$1.GLOBAL)throw new yb$1(Ry$1.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t$===iO$1.CHINA)r$=[iO$1.OVERSEA];else if(i$=t$,Dn$1(Ix$1).call(Ix$1,i$)){const a$=(n$=t$,Cx$1[iO$1.GLOBAL][n$]||[]),c$=[...o$,t$,...a$];r$=s$.filter(u$=>!Dn$1(c$).call(c$,u$))}else if(function(a$){let c$=!1;return Ix$1.forEach(u$=>{var l$;Dn$1(l$=Cx$1[iO$1.GLOBAL][u$]).call(l$,a$)&&(c$=!0)}),c$}(t$)){const a$=function(u$){let l$;return Ix$1.forEach(d$=>{var h$;Dn$1(h$=Cx$1[iO$1.GLOBAL][d$]).call(h$,u$)&&(l$=d$)}),l$}(t$),c$=[...o$,a$,t$];r$=s$.filter(u$=>!Dn$1(c$).call(c$,u$))}else r$=e$;r$=function(a$){const c$=[];return vx$1.forEach(u$=>{Dn$1(a$).call(a$,u$)&&c$.push(u$)}),c$.concat(a$.filter(u$=>!Dn$1(vx$1).call(vx$1,u$)))}(r$)}else r$=e$;var n$,i$;return r$};function Ax$1(e$){var t$,r$;if(!e$&&Dn$1(t$=XA$1("AREAS")).call(t$,iO$1.EXTENSIONS))return fb$1.debug("update area from ap : reset"),void bx$1(Ab$1,!0);if(!Dn$1(r$=XA$1("AREAS")).call(r$,iO$1.GLOBAL)||!e$)return;let n$=oO$1.EXTENSIONS;n$&&(n$={CODE:gx$1(iO$1.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e$,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e$,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e$,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e$,".agora.io"),"cds-ap-web-2-".concat(e$,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e$,".agora.io"),"sua-ap-web-2-".concat(e$,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e$,".agora.io"),"uap-ap-web-2-".concat(e$,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e$,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e$,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e$,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e$,".agora.io")]},fb$1.debug("update area from ap success: ".concat(e$,",config is "),n$),JA$1("AREAS",[iO$1.EXTENSIONS],!0),Object.keys(n$).map(i$=>{i$==="LOG_UPLOAD_SERVER"||i$==="EVENT_REPORT_DOMAIN"||i$==="EVENT_REPORT_BACKUP_DOMAIN"||i$==="PROXY_SERVER_TYPE3"?JA$1(i$,n$[i$][0]):JA$1(i$,n$[i$])}))}function bx$1(e$){let t$=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r$=vb$1.reportApiInvoke(null,{name:By$1.SET_AREA,options:e$,tag:jy$1.TRACER});try{let n$=[];if(typeof e$=="string"&&(n$=[e$]),Array.isArray(e$)&&(e$.forEach(o$=>{if(!Dn$1(nO$1).call(nO$1,o$))throw new yb$1(Ry$1.INVALID_PARAMS,"invalid area code")}),n$=e$),Object.prototype.toString.call(e$)==="[object Object]"){const{areaCode:o$,excludedArea:s$}=e$;if(!o$)throw new yb$1(Ry$1.INVALID_PARAMS,"area code is needed");let a$=o$;typeof o$=="string"&&(a$=[o$]),n$=s$?yx$1(a$,s$):a$}if(!t$){if(QA$1.AREAS){const o$=new yb$1(Ry$1.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r$.onError(o$),void fb$1.warning("setArea is prohibited because of config-distribute")}if(Dn$1(n$).call(n$,iO$1.GLOBAL)&&XA$1("AREAS")===iO$1.EXTENSIONS){const o$=new yb$1(Ry$1.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r$.onError(o$),void fb$1.warning("setArea is prohibited because of ap extensions")}}JA$1("AREAS",n$,t$);const i$=Rx$1(n$);Object.keys(i$).map(o$=>{o$==="LOG_UPLOAD_SERVER"||o$==="EVENT_REPORT_DOMAIN"||o$==="EVENT_REPORT_BACKUP_DOMAIN"||o$==="PROXY_SERVER_TYPE3"?JA$1(o$,i$[o$][0]):JA$1(o$,i$[o$])}),fb$1.debug("set area success:",n$.join(","))}catch(n$){throw r$.onError(n$),n$}r$.onSuccess()}function wx$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function Ox$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?wx$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):wx$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}let Nx$1=1;function Dx$1(e$,t$,r$,n$,i$){Nx$1+=1;const o$={sid:r$.sid,command:"convergeAllocateEdge",uid:"666",appId:r$.appId,ts:Math.floor(Date.now()/1e3),seq:Nx$1,requestId:Nx$1,version:GA$1,cname:r$.cname},s$={service_name:t$,json_body:JSON.stringify(o$)};let a$,c$,u$=e$[0];return kA$1(async()=>{a$=Date.now();const l$=await Tx$1(u$,{data:s$,cancelToken:n$,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c$=Date.now()-a$,l$.code!==0){const p$=new yb$1(Ry$1.UNEXPECTED_RESPONSE,"live streaming ap error, code"+l$.code,{retry:!0,responseTime:c$});throw fb$1.error(p$.toString()),p$}const d$=JSON.parse(l$.json_body);if(d$.code!==200){const p$=new yb$1(Ry$1.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(d$.code,", reason: ").concat(d$.reason),{code:d$.code,responseTime:c$});throw fb$1.error(p$.toString()),p$}if(!d$.servers||d$.servers.length===0){const p$=new yb$1(Ry$1.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:d$.code,responseTime:c$});throw fb$1.error(p$.toString()),p$}const h$=function(p$,_$){return{addressList:p$.servers.map(f$=>"wss://".concat(f$.address.replace(/\./g,"-"),".").concat(XA$1("WORKER_DOMAIN"),":").concat(f$.wss,"?serviceName=").concat(encodeURIComponent(_$))),workerToken:p$.workerToken,vid:p$.vid}}(d$,t$);return XA$1("LIVE_STREAMING_ADDRESS")&&(h$.addressList=XA$1("LIVE_STREAMING_ADDRESS")instanceof Array?XA$1("LIVE_STREAMING_ADDRESS"):[XA$1("LIVE_STREAMING_ADDRESS")]),Ox$1(Ox$1({},h$),{},{responseTime:c$})},(l$,d$)=>(vb$1.apworkerEvent(r$.sid,{success:!0,sc:200,serviceName:t$,responseDetail:JSON.stringify(l$.addressList),firstSuccess:d$===0,responseTime:c$,serverIp:e$[d$%e$.length]}),!1),(l$,d$)=>(vb$1.apworkerEvent(r$.sid,{success:!1,sc:l$.data&&l$.data.code||200,serviceName:t$,responseTime:c$,serverIp:e$[d$%e$.length]}),!!(l$.code!==Ry$1.OPERATION_ABORTED&&l$.code!==Ry$1.UNEXPECTED_RESPONSE||l$.data&&l$.data.retry)&&(u$=e$[(d$+1)%e$.length],!0)),i$)}let Px$1=1;function Lx$1(e$,t$,r$,n$){let{url:i$,areaCode:o$}=e$;const{clientId:s$,sid:a$}=t$,c$=Date.now();let u$;const[l$,d$]=Vx$1(t$,o$,[YO$1.CHOOSE_SERVER]);let h$=iA$1.networkState;return kA$1(async()=>{h$&&iA$1.networkState===Xy$1.OFFLINE&&iA$1.onlineWaiter&&await Gh$1.race([iA$1.onlineWaiter,mA$1(n$&&n$.maxRetryTimeout||PA$1.maxRetryTimeout)]),h$=iA$1.networkState;const{data:p$,headers:_$}=await Tx$1(i$,{data:l$,cancelToken:r$,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u$=_$.http3==="1"?1:-1,vb$1.reportResourceTiming(i$,a$),Mx$1(p$,i$,t$,c$,[YO$1.CHOOSE_SERVER],u$);const f$=eN$1(p$,YO$1.CHOOSE_SERVER);return Ux$1(f$),XO$1(f$,i$)},p$=>(p$&&vb$1.joinChooseServer(a$,{lts:c$,succ:!0,csAddr:i$,opid:d$,serverList:p$.gatewayAddrs.map(_$=>_$.address),ec:null,cid:p$.cid.toString(),uid:p$.uid.toString(),csIp:p$.csIp,unilbsServerIds:[YO$1.CHOOSE_SERVER].toString(),isHttp3:u$,corssRegionTagReq:t$.apRequestDetail,corssRegionTagRes:p$.res.detail&&p$.res.detail[38]}),!1),p$=>p$.code!==Ry$1.OPERATION_ABORTED&&(p$.code===Ry$1.CAN_NOT_GET_GATEWAY_SERVER?p$.data.retry:(vb$1.joinChooseServer(a$,{lts:c$,succ:!1,csAddr:i$,serverList:null,opid:d$,ec:p$.code,csIp:p$.data&&p$.data.csIp,unilbsServerIds:[YO$1.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:h$}),isHttp3:u$,corssRegionTagReq:t$.apRequestDetail}),fb$1.warning("[".concat(s$||"sid-".concat(a$.slice(0,6)),"] Choose server network error, retry"),p$),!0)),n$)}function kx$1(e$,t$,r$,n$){let i$,{url:o$,areaCode:s$,serviceIds:a$}=e$;const c$=Date.now(),[u$,l$]=Vx$1(t$,s$,a$);let d$;return kA$1(async()=>{d$&&iA$1.networkState===Xy$1.OFFLINE&&iA$1.onlineWaiter&&await Gh$1.race([iA$1.onlineWaiter,mA$1(n$&&n$.maxRetryTimeout||PA$1.maxRetryTimeout)]),d$=iA$1.networkState;const{data:h$,headers:p$}=await Tx$1(o$,{data:u$,cancelToken:r$,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i$=p$.http3==="1"?1:-1,vb$1.reportResourceTiming(o$,t$.sid),Mx$1(h$,o$,t$,c$,a$,i$);const _$=eN$1(h$,YO$1.CHOOSE_SERVER),f$=eN$1(h$,t$.cloudProxyServer==="proxy5"?YO$1.CLOUD_PROXY_5:t$.cloudProxyServer==="proxy3"||t$.cloudProxyServer==="proxy4"?YO$1.CLOUD_PROXY:YO$1.CLOUD_PROXY_FALLBACK);return Ux$1(_$),{gatewayInfo:XO$1(_$,o$),proxyInfo:f$,url:o$}},h$=>(h$.gatewayInfo&&vb$1.joinChooseServer(t$.sid,{lts:c$,succ:!0,csAddr:o$,serverList:h$.gatewayInfo.gatewayAddrs.map(p$=>p$.address),ec:null,opid:l$,cid:h$.gatewayInfo.cid.toString(),uid:h$.gatewayInfo.uid.toString(),csIp:h$.gatewayInfo.csIp,unilbsServerIds:a$.toString(),isHttp3:i$,corssRegionTagReq:t$.apRequestDetail,corssRegionTagRes:h$.gatewayInfo.res.detail&&h$.gatewayInfo.res.detail[38]}),h$.proxyInfo&&vb$1.joinWebProxyAP(t$.sid,{lts:c$,sucess:1,apServerAddr:o$,turnServerAddrList:h$.proxyInfo.addresses.map(p$=>p$.ip).join(","),errorCode:null,eventType:t$.cloudProxyServer,unilbsServerIds:a$.toString()}),!1),h$=>h$.code!==Ry$1.OPERATION_ABORTED&&(h$.code===Ry$1.CAN_NOT_GET_GATEWAY_SERVER?h$.data.retry:(vb$1.joinWebProxyAP(t$.sid,{lts:c$,sucess:0,apServerAddr:o$,turnServerAddrList:null,errorCode:h$.code,eventType:t$.cloudProxyServer,unilbsServerIds:a$.toString(),extend:JSON.stringify({networkState:d$})}),fb$1.warning("[".concat(t$.clientId,"] multi unilbs network error, retry"),h$),!0)),n$)}const Mx$1=(e$,t$,r$,n$,i$,o$)=>{const{sid:s$,clientId:a$,cloudProxyServer:c$}=r$,u$=[],l$=d$=>{d$.flag===4096?vb$1.joinChooseServer(s$,{lts:n$,succ:!1,csAddr:t$,opid:e$.opid,serverList:null,ec:d$.error.message,csIp:d$.error.data&&d$.error.data.csIp,unilbsServerIds:i$.toString(),isHttp3:o$,corssRegionTagReq:r$.apRequestDetail}):d$.flag!==1048576&&d$.flag!==4194304&&d$.flag!==4194310||vb$1.joinWebProxyAP(s$,{lts:n$,sucess:0,apServerAddr:t$,turnServerAddrList:null,errorCode:d$.error.code,eventType:c$,unilbsServerIds:i$.toString()})};if(e$.response_body.forEach(d$=>{const h$=d$.buffer.code;if(d$.uri===23&&h$===0&&!d$.buffer.edges_services)if(d$.buffer.flag===4194310)fb$1.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),d$.buffer.edges_services=[];else{const p$={error:new yb$1(Ry$1.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e$.detail[502]}),flag:d$.buffer.flag};u$.push(p$),l$(p$)}if(h$!==0){const p$=wO$1(h$),_$={error:new yb$1(Ry$1.CAN_NOT_GET_GATEWAY_SERVER,p$.desc,{desc:p$.desc,retry:p$.retry,csIp:e$.detail[502]}),flag:d$.buffer.flag};d$.buffer.flag===4194310?fb$1.warning(_$.error.toString()):u$.push(_$),l$(_$)}}),u$.length)throw fb$1.warning("[".concat(a$||"sid-".concat(s$.slice(0,6)),"] multi unilbs ").concat(t$," failed, ").concat(u$.map(d$=>"flag: ".concat(d$.flag,", message: ").concat(d$.error.message,", retry: ").concat(d$.error.data.retry)).join(" | "))),new yb$1(Ry$1.CAN_NOT_GET_GATEWAY_SERVER,u$.map(d$=>"flag: ".concat(d$.flag,", message: ").concat(d$.error.message)).join(" | "),{retry:!!u$.find(d$=>d$.error.data.retry),csIp:e$.detail[502],desc:[...new Set(u$.map(d$=>{var h$;return d$==null||(h$=d$.error)===null||h$===void 0||(h$=h$.data)===null||h$===void 0?void 0:h$.desc}).filter(d$=>!!d$))]})},Ux$1=e$=>{var t$,r$,n$,i$;if(e$.addresses&&e$.addresses.length===0&&e$.code===0)throw new yb$1(Ry$1.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e$.detail&&e$.detail[502]});if(XA$1("AP_AREA")&&((n$=e$.detail)!==null&&n$!==void 0&&n$[23]&&typeof((i$=e$.detail)===null||i$===void 0?void 0:i$[23])=="string"?Ax$1(e$.detail[23].toLowerCase()):Ax$1()),(t$=e$.detail)!==null&&t$!==void 0&&t$[19]&&typeof((r$=e$.detail)===null||r$===void 0?void 0:r$[19])=="string"){const s$=e$.detail[19],a$=s$==null?void 0:s$.split(";");for(let c$=0;c$<a$.length;c$++){var o$;const u$=jp$1(o$=a$[c$]).call(o$);e$.addresses[c$]&&a$&&(e$.addresses[c$].fingerprint=u$)}}if(XA$1("GATEWAY_ADDRESS")&&XA$1("GATEWAY_ADDRESS").length>0){fb$1.debug("assign gateway address to",XA$1("GATEWAY_ADDRESS"));const s$=XA$1("GATEWAY_ADDRESS").map(a$=>{var c$,u$;const l$=(c$=(u$=e$.addresses.find(d$=>d$.ip===a$.ip&&d$.port===a$.port))===null||u$===void 0?void 0:u$.fingerprint)!==null&&c$!==void 0?c$:"";return{ip:a$.ip,port:a$.port,ticket:e$.addresses[0]&&e$.addresses[0].ticket,fingerprint:l$}});e$.addresses=s$}},xx$1=(e$,t$)=>{if(e$.response_body&&e$.response_body.length){const r$=e$.response_body[0];if(r$.buffer.code!==0){const n$=wO$1(r$.buffer.code);throw new yb$1(Ry$1.UPDATE_TICKET_FAILED,"[".concat(r$.buffer.code,"]: ").concat(n$.desc),{retry:n$.retry})}return r$.buffer.ticket}throw fb$1.debug("update ticket request received ap response without response body:",t$),new yb$1(Ry$1.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Vx$1=(e$,t$,r$)=>{const n$=Math.floor(Math.random()*1e12),i$={appid:e$.appId,client_ts:Date.now(),opid:n$,sid:e$.sid,request_bodies:[{uri:22,buffer:{cname:e$.cname,detail:Ox$1(Ox$1({6:e$.stringUid,11:t$,12:XA$1("USE_NEW_TOKEN")?"1":void 0,22:t$},e$.apRequestDetail?{33:e$.apRequestDetail}:{}),e$.apRTM?{26:"RTM2"}:{}),key:e$.token,service_ids:r$,uid:e$.uid||0}}]};i$.request_bodies.forEach(s$=>{e$.multiIP&&e$.multiIP.gateway_ip&&(s$.buffer.detail[5]=JSON.stringify({vocs_ip:[e$.multiIP.uni_lbs_ip],vos_ip:[e$.multiIP.gateway_ip]}))});const o$=new FormData;return o$.append("request",JSON.stringify(i$)),[o$,n$]},Fx$1=(e$,t$)=>{const r$=Math.floor(Math.random()*1e12),n$={appid:e$.appId,client_ts:Date.now(),opid:r$,sid:e$.sid,request_bodies:[{uri:28,buffer:{cname:e$.cname,detail:{1:"",6:e$.stringUid,12:"1"},token:e$.token,service_ids:t$,uid:e$.uid||0,edges_services:e$.apResponse.addresses.map(o$=>({ip:o$.ip,port:o$.port}))}}]},i$=new FormData;return i$.append("request",JSON.stringify(n$)),[i$,r$]};let Bx$1=0;function jx$1(e$){return Gh$1.all(e$.map(t$=>t$.then(r$=>{throw r$},r$=>r$))).then(t$=>{throw t$},t$=>t$)}const Gx$1=async e$=>{let{fragementLength:t$,referenceList:r$,asyncMapHandler:n$,allFailedhandler:i$,promisesCollector:o$}=e$,s$=0;const a$=t$;let c$,u$=0;const l$=async()=>{const d$=(()=>{const h$=s$*a$,p$=h$+a$;return r$.slice(h$,p$).map(n$)})();o$&&o$.push(...d$);try{c$=await jx$1(d$)}catch(h$){if(u$+=a$,s$++,!(u$>=r$.length))return void await l$();i$(h$)}d$.forEach(h$=>h$.cancel())};return await l$(),c$},Wx$1=async e$=>{let{referenceList:t$,asyncMapHandler:r$,closeFn:n$}=e$;const i$=t$.length;let o$=0;const s$=async()=>{const a$=r$(t$.shift());try{return await a$}catch(c$){if(o$++,o$>=i$||n$!=null&&n$(c$))throw c$;return s$()}};return s$()};async function Hx$1(e$,t$,r$,n$){return{gatewayInfo:await async function(o$,s$,a$,c$){let u$=null;const l$=[],d$=async()=>{const p$=XA$1("WEBCS_DOMAIN").slice(0,XA$1("AJAX_REQUEST_CONCURRENT")).map(m$=>({url:o$.proxyServer?"https://".concat(o$.proxyServer,"/ap/?url=").concat(m$+"/api/v2/transpond/webrtc?v=2"):"https://".concat(m$,"/api/v2/transpond/webrtc?v=2"),areaCode:Sx$1()})),_$=c$.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p$.map(m$=>m$.url)}),f$=await Gx$1({fragementLength:XA$1("FRAGEMENT_LENGTH"),referenceList:p$,asyncMapHandler:m$=>(fb$1.debug("[".concat(o$.clientId,"] Connect to choose_server:"),m$.url),Lx$1(m$,o$,s$,a$)),allFailedhandler:m$=>{throw c$.recordJoinChannelService({endTs:Date.now(),status:"error",errors:m$},_$),m$[0]},promisesCollector:l$});return c$.recordJoinChannelService({endTs:Date.now(),status:"success"},_$),f$},h$=async()=>{if(await mA$1(1e3),u$!==null)return u$;const p$=XA$1("WEBCS_DOMAIN_BACKUP_LIST").map(m$=>({url:o$.proxyServer?"https://".concat(o$.proxyServer,"/ap/?url=").concat(m$+"/api/v2/transpond/webrtc?v=2"):"https://".concat(m$,"/api/v2/transpond/webrtc?v=2"),areaCode:Sx$1()})),_$=c$.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:p$.map(m$=>m$.url)}),f$=await Gx$1({fragementLength:XA$1("FRAGEMENT_LENGTH"),referenceList:p$,asyncMapHandler:m$=>(fb$1.debug("[".concat(o$.clientId,"] Connect to backup choose_server:"),m$.url),Lx$1(m$,o$,s$,a$)),allFailedhandler:m$=>{throw c$.recordJoinChannelService({endTs:Date.now(),status:"error",errors:m$},_$),m$[0]},promisesCollector:l$});return c$.recordJoinChannelService({endTs:Date.now(),status:"success"},_$),f$};try{return u$=await jx$1([d$(),h$()]),l$.length&&l$.forEach(p$=>p$.cancel&&typeof p$.cancel=="function"&&p$.cancel()),u$}catch(p$){throw p$[0]}}(e$,t$,r$,n$)}}async function Kx$1(e$,t$,r$,n$,i$){const o$=e$.cloudProxyServer;if(o$==="disabled"){if(e$.useLocalAccessPoint)return await Hx$1(e$,t$,r$,i$);if(XA$1("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:h$,proxyInfo:p$}=await Xx$1(e$,t$,r$,i$);if(e$.turnServer&&e$.turnServer.mode!=="auto")return{gatewayInfo:h$};const _$=p$.map(f$=>({turnServerURL:f$.address,tcpport:f$.tcpport||KA$1.tcpport,udpport:f$.udpport||KA$1.udpport,username:f$.username||KA$1.username,password:f$.password||KA$1.password,forceturn:!1,security:!0}));if(i$.useP2P){var s$;const f$=(s$=e$.uid)!==null&&s$!==void 0?s$:h$.uid,m$="glb:".concat(f$.toString()),g$=await Uy$1(m$),v$=p$.map(y$=>({turnServerURL:y$.address,tcpport:y$.tcpport||KA$1.tcpport,udpport:y$.udpport||KA$1.udpport,username:m$,password:g$,forceturn:!1,security:!0}));_$.push(...v$)}return e$.turnServer={mode:"manual",servers:_$},{gatewayInfo:h$}}return await Hx$1(e$,t$,r$,i$)}const{proxyInfo:a$,gatewayInfo:c$}=await Xx$1(e$,t$,r$,i$),u$={gatewayInfo:c$},l$=a$.map(h$=>({turnServerURL:h$.address,tcpport:o$==="proxy3"?void 0:h$.tcpport?h$.tcpport:KA$1.tcpport,udpport:o$==="proxy4"?void 0:h$.udpport?h$.udpport:KA$1.udpport,username:h$.username||KA$1.username,password:h$.password||KA$1.password,forceturn:o$!=="proxy4",security:o$==="proxy5"}));if(i$.useP2P){var d$;const h$=(d$=e$.uid)!==null&&d$!==void 0?d$:c$.uid,p$="glb:".concat(h$.toString()),_$=await Uy$1(p$),f$=a$.map(m$=>({turnServerURL:m$.address,tcpport:o$==="proxy3"?void 0:m$.tcpport||KA$1.tcpport,udpport:o$==="proxy4"?void 0:m$.udpport||KA$1.udpport,username:p$,password:_$,forceturn:o$!=="proxy4",security:o$==="proxy5"}));l$.push(...f$)}return e$.turnServer={mode:"manual",servers:l$},fb$1.debug("[".concat(e$.clientId,"] set proxy server: ").concat(e$.proxyServer,", mode: ").concat(o$)),u$}async function Yx$1(e$,t$,r$,n$,i$){const o$=XA$1("ACCOUNT_REGISTER").slice(0,XA$1("AJAX_REQUEST_CONCURRENT"));let s$=[];s$=t$.proxyServer?o$.map(c$=>"https://".concat(t$.proxyServer,"/ap/?url=").concat(c$+"/api/v1")):o$.map(c$=>"https://".concat(c$,"/api/v1"));const a$=i$==null?void 0:i$.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:s$});try{const c$=await async function(u$,l$,d$,h$,p$){const _$=Date.now(),f$={sid:d$.sid,opid:10,appid:d$.appId,string_uid:l$};let m$=u$[0];const g$=await kA$1(()=>Tx$1(m$+"".concat(m$.indexOf("?")===-1?"?":"&","action=stringuid"),{data:f$,cancelToken:h$,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(v$,y$)=>{if(v$.code===0){if(v$.uid<=0||v$.uid>=Math.pow(2,32))throw fb$1.error("Invalid Uint Uid ".concat(l$," => ").concat(v$.uid),v$),vb$1.reqUserAccount(f$.sid,{lts:_$,success:!1,serverAddr:m$,stringUid:f$.string_uid,uid:v$.uid,errorCode:Ry$1.INVALID_UINT_UID_FROM_STRING_UID,extend:f$}),new yb$1(Ry$1.INVALID_UINT_UID_FROM_STRING_UID);return vb$1.reqUserAccount(f$.sid,{lts:_$,success:!0,serverAddr:m$,stringUid:f$.string_uid,uid:v$.uid,errorCode:null,extend:f$}),!1}const S$=wO$1(v$.code);return S$.retry&&(m$=u$[(y$+1)%u$.length]),vb$1.reqUserAccount(f$.sid,{lts:_$,success:!1,serverAddr:m$,stringUid:f$.string_uid,uid:v$.uid,errorCode:S$.desc,extend:f$}),S$.retry},(v$,y$)=>v$.code!==Ry$1.OPERATION_ABORTED&&(vb$1.reqUserAccount(f$.sid,{lts:_$,success:!1,serverAddr:m$,stringUid:f$.string_uid,uid:null,errorCode:v$.code,extend:f$}),m$=u$[(y$+1)%u$.length],!0),p$);if(g$.code!==0){const v$=wO$1(g$.code);throw new yb$1(Ry$1.UNEXPECTED_RESPONSE,v$.desc)}return g$}(s$,e$,t$,r$,n$);return i$==null||i$.recordJoinChannelService({status:"success",endTs:Date.now()},a$),c$.uid}catch(c$){throw i$==null||i$.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[c$]},a$),c$}}async function qx$1(e$,t$,r$){const n$=XA$1("ACCOUNT_REGISTER");let i$=[];i$=t$.proxyServer?n$.map(o$=>"https://".concat(t$.proxyServer,"/ap/?url=").concat(o$+"/api/v1")):n$.map(o$=>"https://".concat(o$,"/api/v1"));try{return await Wx$1({referenceList:i$,asyncMapHandler:s$=>async function(a$,c$,u$,l$){const d$=Date.now(),h$={sid:u$.sid,opid:10,appid:u$.appId,string_uid:c$};try{const p$=await Tx$1(a$+"".concat(a$.indexOf("?")===-1?"?":"&","action=stringuid"),{data:h$,cancelToken:l$,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(p$.code!==0){const _$=wO$1(p$.code);throw new yb$1(Ry$1.UNEXPECTED_RESPONSE,"preload sua error:".concat(_$.desc),_$)}if(p$.uid<=0||p$.uid>=Math.pow(2,32))throw new yb$1(Ry$1.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:d$,url:a$,req:h$,uid:p$.uid,elapse:Date.now()-d$}}catch(p$){throw p$}}(s$,e$,t$,r$),closeFn:s$=>s$.code===Ry$1.OPERATION_ABORTED||s$.code===Ry$1.UNEXPECTED_RESPONSE&&!s$.data.retry})}catch(o$){throw o$}}async function zx$1(e$,t$,r$){const n$=XA$1("CDS_AP").slice(0,XA$1("AJAX_REQUEST_CONCURRENT")).map(c$=>e$.proxyServer?"https://".concat(e$.proxyServer,"/ap/?url=").concat(c$+"/api/v1"):"https://".concat(c$,"/api/v1?action=config")),i$=n$.map(c$=>function(u$,l$,d$,h$){const p$=Hv$1(),_$={flag:64,cipher_method:0,features:{device:p$.name,system:p$.os,system_general:navigator.userAgent,vendor:l$.appId,version:GA$1,cname:l$.cname,sid:l$.sid,session_id:l$.sid,detail:"",proxyServer:l$.proxyServer}};return kA$1(()=>Tx$1(u$,{data:_$,timeout:1e3,cancelToken:d$,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,f$=>f$.code!==Ry$1.OPERATION_ABORTED,h$)}(c$,e$,t$,r$));let o$=null,s$=null,a$={};try{o$=await jx$1(i$)}catch(c$){if(c$.code===Ry$1.OPERATION_ABORTED)throw c$;s$=c$}if(i$.forEach(c$=>c$.cancel()),vb$1.reportApiInvoke(e$.sid,{name:By$1.REQUEST_CONFIG_DISTRIBUTE,options:{error:s$,res:o$}}).onSuccess(),o$&&o$.test_tags)try{a$=function(c$){if(!c$.test_tags)return{};const u$=c$.test_tags,l$=Object.keys(u$),d$={};return l$.forEach(h$=>{var p$;const _$=jp$1(p$=h$.slice(4)).call(p$),f$=JSON.parse(u$[h$])[1];d$[_$]=f$}),d$}(o$)}catch{}return a$}async function Jx$1(e$,t$){const r$=XA$1("WEBCS_DOMAIN").concat(XA$1("WEBCS_DOMAIN_BACKUP_LIST")).map(n$=>({url:"https://".concat(n$,"/api/v2/transpond/webrtc?v=2"),areaCode:Sx$1(),serviceIds:[YO$1.CHOOSE_SERVER,YO$1.CLOUD_PROXY_FALLBACK]}));try{return await Wx$1({referenceList:r$,asyncMapHandler:i$=>async function(o$,s$,a$){let c$,{url:u$,areaCode:l$,serviceIds:d$}=o$;const h$=Date.now(),[p$,_$]=Vx$1(s$,l$,d$);let f$=iA$1.networkState;try{f$&&iA$1.networkState===Xy$1.OFFLINE&&iA$1.onlineWaiter&&await Gh$1.race([iA$1.onlineWaiter,mA$1(PA$1.maxRetryTimeout)]),f$=iA$1.networkState;const{data:m$,headers:g$}=await Tx$1(u$,{data:p$,cancelToken:a$,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c$=g$.http3==="1"?1:-1,(b$=>{const $$=[];if(b$.response_body.forEach(C$=>{const N$=C$.buffer.code;if(C$.uri===23&&N$===0&&!C$.buffer.edges_services)if(C$.buffer.flag===4194310)C$.buffer.edges_services=[];else{const k$={error:new yb$1(Ry$1.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:b$.detail[502]}),flag:C$.buffer.flag};$$.push(k$)}if(N$!==0){const k$=wO$1(N$),O$={error:new yb$1(Ry$1.CAN_NOT_GET_GATEWAY_SERVER,k$.desc,{desc:k$.desc,retry:k$.retry,csIp:b$.detail[502]}),flag:C$.buffer.flag};C$.buffer.flag===4194310?fb$1.warning(O$.error.toString()):$$.push(O$)}}),$$.length)throw new yb$1(Ry$1.CAN_NOT_GET_GATEWAY_SERVER,$$.map(C$=>"flag: ".concat(C$.flag,", message: ").concat(C$.error.message)).join(" | "),{retry:!!$$.find(C$=>C$.error.data.retry),csIp:b$.detail[502],desc:[...new Set($$.map(C$=>{var N$;return C$==null||(N$=C$.error)===null||N$===void 0||(N$=N$.data)===null||N$===void 0?void 0:N$.desc}).filter(C$=>!!C$))]})})(m$);const y$=eN$1(m$,YO$1.CHOOSE_SERVER),S$=eN$1(m$,YO$1.CLOUD_PROXY_FALLBACK);return Ux$1(y$),{gatewayInfo:XO$1(y$,u$),proxyInfo:S$,opid:_$,requestTime:h$,url:u$,isHttp3:c$,elapse:Date.now()-h$}}catch(m$){throw m$}}(i$,e$,t$),closeFn:i$=>i$.code===Ry$1.OPERATION_ABORTED||i$.code===Ry$1.CAN_NOT_GET_GATEWAY_SERVER&&!i$.data.retry})}catch(n$){throw n$}}async function Xx$1(e$,t$,r$,n$){const i$=XA$1("PROXY_SERVER_TYPE3"),o$=(p$,_$,f$)=>{let m$=f$||i$;return Array.isArray(m$)&&(m$=_$%2==0?i$[1]:i$[0]),"https://".concat(m$,"/ap/?url=").concat(p$)};let s$=null;const a$=[],c$=async()=>{const p$=XA$1("WEBCS_DOMAIN").slice(0,XA$1("AJAX_REQUEST_CONCURRENT")).map((m$,g$)=>{let v$;return v$=e$.cloudProxyServer==="disabled"&&e$.proxyServer?o$("".concat(m$,"/api/v2/transpond/webrtc?v=2"),g$,e$.proxyServer):e$.cloudProxyServer==="disabled"||e$.cloudProxyServer==="fallback"?"https://".concat(m$,"/api/v2/transpond/webrtc?v=2"):o$("".concat(m$,"/api/v2/transpond/webrtc?v=2"),g$),{url:v$,areaCode:Sx$1(),serviceIds:[YO$1.CHOOSE_SERVER,e$.cloudProxyServer==="proxy5"?YO$1.CLOUD_PROXY_5:e$.cloudProxyServer==="proxy3"||e$.cloudProxyServer==="proxy4"?YO$1.CLOUD_PROXY:YO$1.CLOUD_PROXY_FALLBACK]}}),_$=n$.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p$.map(m$=>m$.url)}),f$=await Gx$1({fragementLength:XA$1("FRAGEMENT_LENGTH"),referenceList:p$,asyncMapHandler:m$=>(fb$1.debug("[".concat(e$.clientId,"] Connect to choose_server:"),m$.url),kx$1(m$,e$,t$,r$)),allFailedhandler:m$=>{throw n$.recordJoinChannelService({endTs:Date.now(),status:"error",errors:m$},_$),m$[0]},promisesCollector:a$});return n$.recordJoinChannelService({endTs:Date.now(),status:"success"},_$),f$},u$=async()=>{if(await mA$1(1e3),s$!==null)return s$;const p$=XA$1("WEBCS_DOMAIN_BACKUP_LIST").map((m$,g$)=>{let v$;return v$=e$.cloudProxyServer==="disabled"&&e$.proxyServer?o$("".concat(m$,"/api/v2/transpond/webrtc?v=2"),g$,e$.proxyServer):e$.cloudProxyServer==="disabled"||e$.cloudProxyServer==="fallback"?"https://".concat(m$,"/api/v2/transpond/webrtc?v=2"):o$("".concat(m$,"/api/v2/transpond/webrtc?v=2"),g$),{url:v$,areaCode:Sx$1(),serviceIds:[YO$1.CHOOSE_SERVER,e$.cloudProxyServer==="proxy5"?YO$1.CLOUD_PROXY_5:e$.cloudProxyServer==="proxy3"||e$.cloudProxyServer==="proxy4"?YO$1.CLOUD_PROXY:YO$1.CLOUD_PROXY_FALLBACK]}}),_$=n$.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p$.map(m$=>m$.url)}),f$=await Gx$1({fragementLength:XA$1("FRAGEMENT_LENGTH"),referenceList:p$,asyncMapHandler:m$=>(fb$1.debug("[".concat(e$.clientId,"] Connect to backup choose_server:"),m$.url),kx$1(m$,e$,t$,r$)),allFailedhandler:m$=>{throw n$.recordJoinChannelService({endTs:Date.now(),status:"error",errors:m$},_$),m$[0]},promisesCollector:a$});return n$.recordJoinChannelService({endTs:Date.now(),status:"success"},_$),f$};let l$,d$,h$;try{({gatewayInfo:l$,proxyInfo:d$,url:h$}=await jx$1([c$(),u$()]))}catch(p$){throw p$[0]}if(a$.length&&a$.forEach(p$=>p$.cancel&&typeof p$.cancel=="function"&&p$.cancel()),!l$||!d$)throw new yb$1(Ry$1.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e$.apUrl=h$,e$.cloudProxyServer!=="disabled"&&Array.isArray(i$)&&h$){const p$=/^https?:\/\/(.+?)(\/.*)?$/.exec(h$)[1];Dn$1(i$).call(i$,p$)&&(e$.proxyServer=p$,fb$1.setProxyServer(p$),vb$1.setProxyServer(p$))}return s$={gatewayInfo:l$,proxyInfo:await tN$1(d$,l$.uid)},s$}async function Qx$1(e$,t$,r$){const n$=XA$1("UAP_AP").slice(0,XA$1("AJAX_REQUEST_CONCURRENT")).map(o$=>e$.proxyServer?"https://".concat(e$.proxyServer,"/ap/?url=").concat(o$+"/api/v1?action=uap"):"https://".concat(o$,"/api/v1?action=uap")),i$=n$.map(o$=>function(s$,a$,c$,u$){const l$={command:"convergeAllocateEdge",sid:a$.sid,appId:a$.appId,token:a$.token,ts:Date.now(),version:GA$1,cname:a$.cname,uid:a$.uid.toString(),requestId:Px$1,seq:Px$1};Px$1+=1;const d$={service_name:"tele_channel",json_body:JSON.stringify(l$)};return kA$1(async()=>{const h$=await Tx$1(s$,{data:d$,cancelToken:c$,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(h$.code!==0){const _$=new yb$1(Ry$1.UNEXPECTED_RESPONSE,"cross channel ap error, code"+h$.code,{retry:!0});throw fb$1.error(_$.toString()),_$}const p$=JSON.parse(h$.json_body);if(p$.code!==200){const _$=new yb$1(Ry$1.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(p$.code,", reason: ").concat(p$.reason));throw fb$1.error(_$.toString()),_$}if(!p$.servers||p$.servers.length===0){const _$=new yb$1(Ry$1.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw fb$1.error(_$.toString()),_$}return{vid:p$.vid,workerToken:p$.workerToken,addressList:(XA$1("CHANNEL_MEDIA_RELAY_SERVERS")||p$.servers).map(_$=>"wss://".concat(_$.address.replace(/\./g,"-"),".").concat(XA$1("WORKER_DOMAIN"),":").concat(_$.wss))}},void 0,h$=>!!(h$.code!==Ry$1.OPERATION_ABORTED&&h$.code!==Ry$1.UNEXPECTED_RESPONSE||h$.data&&h$.data.retry),u$)}(o$,e$,t$,r$));try{const o$=await jx$1(i$);return i$.forEach(s$=>s$.cancel()),o$}catch(o$){throw o$[0]}}async function Zx$1(e$,t$,r$){let n$=null;const i$=[],o$=async s$=>{const a$=XA$1(s$?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(c$=>e$.proxyServer?"https://".concat(e$.proxyServer,"/ap/?url=").concat(c$+"/api/v2/transpond/webrtc?v=2"):"https://".concat(c$,"/api/v2/transpond/webrtc?v=2"));return s$&&(await mA$1(1e3),n$!==null)?n$:await Gx$1({fragementLength:XA$1("FRAGEMENT_LENGTH"),referenceList:a$,asyncMapHandler:c$=>(fb$1.debug("[".concat(e$.clientId,"] update ticket, Connect to ").concat(s$?"backup":""," choose_server:"),c$),function(u$,l$,d$,h$){const[p$]=Fx$1(l$,[YO$1.CHOOSE_SERVER]);let _$=iA$1.networkState;return kA$1(async()=>{_$&&iA$1.networkState===Xy$1.OFFLINE&&iA$1.onlineWaiter&&await Gh$1.race([iA$1.onlineWaiter,mA$1(h$&&h$.maxRetryTimeout||PA$1.maxRetryTimeout)]),_$=iA$1.networkState;const f$=await Tx$1(u$,{data:p$,cancelToken:d$,headers:{"Content-Type":"multipart/form-data;"}},!0);return xx$1(f$,u$)},()=>!1,f$=>f$.code!==Ry$1.OPERATION_ABORTED&&(f$.code===Ry$1.UPDATE_TICKET_FAILED?f$.data.retry:(fb$1.warning("[".concat(l$.clientId,"] update ticket network error, retry"),f$),!0)),h$)}(c$,e$,t$,r$)),allFailedhandler:c$=>{throw c$[0]},promisesCollector:i$})};try{return n$=await jx$1([o$(!1),o$(!0)]),i$.length&&i$.forEach(s$=>s$.cancel&&typeof s$.cancel=="function"&&s$.cancel()),n$}catch(s$){throw s$[0]}}function $x$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function eV$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?$x$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):$x$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}let tV$1=class extends xy$1{get isSuccess(){return!!this.configs}constructor(){super(),Fg$1(this,"configs",void 0),Fg$1(this,"joinInfo",void 0),Fg$1(this,"cancelToken",void 0),Fg$1(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),Fg$1(this,"interval",void 0),Fg$1(this,"mutex",new NA$1("config-distribute")),Fg$1(this,"mutableParamsRead",!1)}startGetConfigDistribute(t$,r$){this.joinInfo=t$,this.cancelToken=r$,this.interval&&this.stopGetConfigDistribute(),XA$1("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},XA$1("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,vb$1.reportApiInvoke(null,{options:void 0,name:By$1.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:jy$1.TRACER}).onSuccess(JSON.stringify(QA$1))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void fb$1.debug("[config-distribute] get config distribute interrupted have no joininfo");let t$;const r$=await this.mutex.lock();try{t$=await zx$1(this.joinInfo,this.cancelToken,this.retryConfig),fb$1.debug("[config-distribute] get config distribute",JSON.stringify(t$)),t$.limit_bitrate&&this.handleBitrateLimit(t$.limit_bitrate),this.cacheGlobalParameterConfig(t$),this.configs=t$}catch(n$){const i$=new yb$1(Ry$1.NETWORK_RESPONSE_ERROR,n$);fb$1.warning("[config-distribute] ".concat(i$.toString()))}finally{r$()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t$){var r$;(r$=t$)&&r$.uplink&&r$.id&&r$.uplink.max_bitrate!==void 0&&r$.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t$.id&&this.emit(sO$1.UPDATE_BITRATE_LIMIT,t$):this.emit(sO$1.UPDATE_BITRATE_LIMIT,t$))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&eV$1({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t$){var r$;const n$=aE$1(r$=Object.keys(t$).filter(o$=>/^webrtc_ng_global_parameter/.test(o$))).call(r$);for(let o$=0;o$<n$.length;o$++)for(let s$=n$.length-1;s$>o$;s$--){const a$=n$[s$];if(typeof t$[a$].__priority=="number"){const c$=t$[a$].__priority,u$=n$[s$-1];if(typeof t$[u$].__priority=="number"){if(!(c$>t$[u$].__priority))continue;{const l$=a$;n$[s$]=n$[s$-1],n$[s$-1]=l$}}else{const l$=a$;n$[s$]=n$[s$-1],n$[s$-1]=l$}}}const i$={};n$.forEach(o$=>{const s$=t$[o$],a$=s$.__expires;Object.keys(s$).forEach(c$=>{c$==="__priority"||c$==="__expires"||Object.prototype.hasOwnProperty.call(i$,c$)||(i$[c$]=eV$1({value:s$[c$]},a$&&{expires:a$}))})});try{(function(a$){try{const c$=Date.now();Object.keys(a$).forEach(u$=>{switch(u$){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(zA$1,u$)){const{value:l$,expires:d$}=a$[u$];if(d$&&d$<=c$)return;QA$1[u$]=l$,zA$1[u$]=l$,fb$1.debug("Update global parameters from config distribute",u$,l$)}}})}catch(c$){fb$1.error("Error update config immediately: ".concat(a$),c$.message)}})(i$);const o$=JSON.stringify(i$),s$=window.btoa(o$);window.localStorage.setItem("websdk_ng_global_parameter",s$),fb$1.debug("Caching global parameters ".concat(o$))}catch(o$){fb$1.error("Error caching global parameters:",o$.message)}}},iV$1=class extends xy$1{constructor(){super(...arguments),Fg$1(this,"resultStorage",new Map)}setLocalAudioStats(t$,r$,n$){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t$,this.checkAudioInputLevel(n$,r$)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t$,this.checkSendAudioBitrate(n$,r$))}setLocalVideoStats(t$,r$,n$){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t$,this.checkSendVideoBitrate(n$,r$)),this.record("FRAMERATE_INPUT_TOO_LOW",t$,this.checkFramerateInput(n$,r$)),this.record("FRAMERATE_SENT_TOO_LOW",t$,this.checkFramerateSent(n$))}setRemoteAudioStats(t$,r$){const n$=t$.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n$,this.checkAudioOutputLevel(r$))}setRemoteVideoStats(t$,r$){const n$=t$.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n$,this.checkVideoDecode(r$))}record(t$,r$,n$){if(XA$1("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t$)||this.resultStorage.set(t$,{result:[],isPrevNormal:!0});const i$=this.resultStorage.get(t$);if(i$&&(i$.result.push(n$),i$.result.length>=5)){var o$;const s$=Dn$1(o$=i$.result).call(o$,!0);i$.isPrevNormal&&!s$&&this.emit("exception",nV$1[t$],t$,r$),!i$.isPrevNormal&&s$&&this.emit("exception",nV$1[t$]+2e3,t$+"_RECOVER",r$),i$.isPrevNormal=s$,i$.result=[]}}checkAudioOutputLevel(t$){return!(t$.receiveBitrate>0&&t$.receiveLevel===0)}checkAudioInputLevel(t$,r$){return r$ instanceof RM$1&&!r$.isActive||!!r$.muted||t$.sendVolumeLevel!==0}checkFramerateInput(t$,r$){let n$=null;r$._encoderConfig&&r$._encoderConfig.frameRate&&(n$=QO$1(r$._encoderConfig.frameRate));const i$=t$.captureFrameRate;return!n$||!i$||!(n$>10&&i$<5||n$<10&&n$>=5&&i$<=1)}checkFramerateSent(t$){return!(t$.captureFrameRate&&t$.sendFrameRate&&t$.captureFrameRate>5&&t$.sendFrameRate<=1)}checkSendVideoBitrate(t$,r$){return!!r$.muted||t$.sendBitrate!==0}checkSendAudioBitrate(t$,r$){return r$ instanceof RM$1&&!r$.isActive||!!r$.muted||t$.sendBitrate!==0}checkVideoDecode(t$){return t$.receiveBitrate===0||t$.decodeFrameRate!==0}};const nV$1={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},rV$1=new class{markSubscribeStart(e$,t$){performance.mark("agora-web-sdk/".concat(e$,"/subscribe-").concat(t$))}markPublishStart(e$,t$){performance.mark("agora-web-sdk/".concat(e$,"/publish-").concat(t$))}measureFromSubscribeStart(e$,t$){const r$=performance.getEntriesByName("agora-web-sdk/".concat(e$,"/subscribe-").concat(t$));if(r$.length>0){const n$=r$[r$.length-1];return Math.round(performance.now()-n$.startTime)}return 0}measureFromPublishStart(e$,t$){const r$=performance.getEntriesByName("agora-web-sdk/".concat(e$,"/publish-").concat(t$));if(r$.length>0){const n$=r$[r$.length-1];return Math.round(performance.now()-n$.startTime)}return 0}};var oV$1=i(ie$1.Object.getOwnPropertySymbols),sV$1=wi$1,aV$1=qi$1.indexOf,cV$1=Bn$1,dV$1=v$1([].indexOf),lV$1=!!dV$1&&1/dV$1([1],1,-0)<0;sV$1({target:"Array",proto:!0,forced:lV$1||!cV$1("indexOf")},{indexOf:function(e$){var t$=arguments.length>1?arguments[1]:void 0;return lV$1?dV$1(this,e$,t$)||0:aV$1(this,e$,t$)}});var uV$1=Xi$1("Array").indexOf,hV$1=l,pV$1=uV$1,_V$1=Array.prototype,EV$1=function(e$){var t$=e$.indexOf;return e$===_V$1||hV$1(_V$1,e$)&&t$===_V$1.indexOf?pV$1:t$},fV$1=i(EV$1);function mV$1(e$,t$){if(e$==null)return{};var r$,n$,i$=function(s$,a$){if(s$==null)return{};var c$,u$,l$={},d$=Wb$1(s$);for(u$=0;u$<d$.length;u$++)c$=d$[u$],fV$1(a$).call(a$,c$)>=0||(l$[c$]=s$[c$]);return l$}(e$,t$);if(oV$1){var o$=oV$1(e$);for(n$=0;n$<o$.length;n$++)r$=o$[n$],fV$1(t$).call(t$,r$)>=0||Object.prototype.propertyIsEnumerable.call(e$,r$)&&(i$[r$]=e$[r$])}return i$}function TV$1(e$){if(Array.isArray(e$))return e$.map(r$=>r$);if(!SV$1(e$))return e$;const t$={};for(const r$ in e$){const n$=e$[r$];SV$1(n$)||Array.isArray(n$)?t$[r$]=TV$1(n$):t$[r$]=n$}return t$}function SV$1(e$){return!(typeof e$!="object"||Array.isArray(e$)||!e$)}let gV$1=class{constructor(t$){Fg$1(this,"input",[]),Fg$1(this,"size",void 0),this.size=t$}add(t$){this.input.push(t$),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const RV$1={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},CV$1={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:RV$1,remoteCandidate:RV$1}},IV$1={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},vV$1={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},yV$1={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},AV$1={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function bV$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function wV$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?bV$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):bV$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}let OV$1=class{constructor(t$,r$){Fg$1(this,"onFirstVideoReceived",void 0),Fg$1(this,"onFirstVideoDecoded",void 0),Fg$1(this,"onFirstAudioReceived",void 0),Fg$1(this,"onFirstVideoDecodedTimeout",void 0),Fg$1(this,"onFirstAudioDecoded",void 0),Fg$1(this,"onSelectedLocalCandidateChanged",void 0),Fg$1(this,"onSelectedRemoteCandidateChanged",void 0),Fg$1(this,"videoIsReady",!1),Fg$1(this,"videoIsReady2",{}),Fg$1(this,"pc",void 0),Fg$1(this,"options",void 0),Fg$1(this,"intervalTimer",void 0),Fg$1(this,"stats",TV$1(CV$1)),Fg$1(this,"isFirstVideoReceived",{}),Fg$1(this,"isFirstVideoDecoded",{}),Fg$1(this,"isFirstAudioReceived",{}),Fg$1(this,"isFirstAudioDecoded",{}),Fg$1(this,"isFirstVideoDecodedTimeout",{}),Fg$1(this,"lossRateWindowStats",[]),this.pc=t$,this.options=r$,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Gh$1(t$=>{t$({local:wV$1({},RV$1),remote:wV$1({},RV$1)})})}setVideoIsReady(t$){this.videoIsReady=t$}setVideoIsReady2(t$,r$){this.videoIsReady2[t$]=r$}getVideoIsReady(t$){return this.videoIsReady2[t$]||!1}setIsFirstAudioDecoded(t$){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t$){this.lossRateWindowStats.push(t$),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r$=this.lossRateWindowStats.length,n$=["videoSend","audioSend","videoRecv","audioRecv"];let i$=0,o$=0,s$=0,a$=0;for(const c$ of n$)t$[c$].forEach((u$,l$)=>{if(!this.lossRateWindowStats[r$-1][c$][l$]||!this.lossRateWindowStats[0][c$][l$])return;const d$=this.lossRateWindowStats[r$-1][c$][l$].packets-this.lossRateWindowStats[0][c$][l$].packets,h$=this.lossRateWindowStats[r$-1][c$][l$].packetsLost-this.lossRateWindowStats[0][c$][l$].packetsLost;c$==="videoSend"||c$==="audioSend"?(i$+=d$,s$+=h$):(o$+=d$,a$+=h$),Number.isNaN(d$)||Number.isNaN(d$)?u$.packetLostRate=0:u$.packetLostRate=d$<=0||h$<=0?0:h$/(d$+h$)});t$.sendPacketLossRate=i$<=0||s$<=0?0:s$/(i$+s$),t$.recvPacketLossRate=o$<=0||a$<=0?0:a$/(o$+a$)}};function NV$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function DV$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?NV$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):NV$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}let PV$1=class extends OV$1{constructor(){super(...arguments),Fg$1(this,"_stats",CV$1),Fg$1(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t$=await this._getStats(),r$=this.statsResponsesToObjects(t$);this._stats=TV$1(CV$1);const n$=r$.filter(o$=>o$.type==="ssrc");this.processSSRCStats(n$);const i$=r$.find(o$=>o$.type==="VideoBwe");i$&&this.processBandwidthStats(i$),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t$){this._stats.bitrate={actualEncoded:Number(t$.googActualEncBitrate),targetEncoded:Number(t$.googTargetEncBitrate),retransmit:Number(t$.googRetransmitBitrate),transmit:Number(t$.googTransmitBitrate)},this._stats.sendBandwidth=Number(t$.googAvailableSendBandwidth)}processSSRCStats(t$){t$.forEach(r$=>{var n$;const i$=Dn$1(n$=r$.id).call(n$,"send");switch("".concat(r$.mediaType,"_").concat(i$?"send":"recv")){case"video_send":{const o$=TV$1(vV$1);o$.codec=r$.googCodecName,o$.adaptionChangeReason="none",r$.googCpuLimitedResolution&&(o$.adaptionChangeReason="cpu"),r$.googBandwidthLimitedResolution&&(o$.adaptionChangeReason="bandwidth"),o$.avgEncodeMs=Number(r$.googAvgEncodeMs),o$.inputFrame={width:Number(r$.googFrameWidthInput)||Number(r$.googFrameWidthSent),height:Number(r$.googFrameHeightInput)||Number(r$.googFrameHeightSent),frameRate:Number(r$.googFrameRateInput)},o$.sentFrame={width:Number(r$.googFrameWidthSent),height:Number(r$.googFrameHeightSent),frameRate:Number(r$.googFrameRateInput)},o$.firsCount=Number(r$.googFirReceived),o$.nacksCount=Number(r$.googNacksReceived),o$.plisCount=Number(r$.googPlisReceived),o$.frameCount=Number(r$.framesEncoded),o$.bytes=Number(r$.bytesSent),o$.packets=Number(r$.packetsSent),o$.packetsLost=Number(r$.packetsLost),o$.ssrc=Number(r$.ssrc),o$.rttMs=Number(r$.googRtt||0),this._stats.videoSend.push(o$),this._stats.rtt=o$.rttMs;break}case"video_recv":{const o$=TV$1(IV$1),s$=this.lastDecodeVideoReceiverStats.get(Number(r$.ssrc));if(o$.codec=r$.googCodecName,o$.targetDelayMs=Number(r$.googTargetDelayMs),o$.renderDelayMs=Number(r$.googRenderDelayMs),o$.currentDelayMs=Number(r$.googCurrentDelayMs),o$.minPlayoutDelayMs=Number(r$.googMinPlayoutDelayMs),o$.decodeMs=Number(r$.googDecodeMs),o$.maxDecodeMs=Number(r$.googMaxDecodeMs),o$.receivedFrame={width:Number(r$.googFrameWidthReceived),height:Number(r$.googFrameHeightReceived),frameRate:Number(r$.googFrameRateReceived)},o$.decodedFrame={width:Number(r$.googFrameWidthReceived),height:Number(r$.googFrameHeightReceived),frameRate:Number(r$.googFrameRateDecoded)},o$.decodeFrameRate=Number(r$.googFrameRateDecoded),o$.outputFrame={width:Number(r$.googFrameWidthReceived),height:Number(r$.googFrameHeightReceived),frameRate:Number(r$.googFrameRateOutput)},o$.jitterBufferMs=Number(r$.googJitterBufferMs),o$.firsCount=Number(r$.googFirsSent),o$.nacksCount=Number(r$.googNacksSent),o$.plisCount=Number(r$.googPlisSent),o$.framesDecodeCount=Number(r$.framesDecoded),o$.bytes=Number(r$.bytesReceived),o$.packets=Number(r$.packetsReceived),o$.packetsLost=Number(r$.packetsLost),o$.ssrc=Number(r$.ssrc),o$.packets>0&&!this.isFirstVideoReceived[o$.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o$.ssrc),this.isFirstVideoReceived[o$.ssrc]=!0),o$.framesDecodeCount>0&&!this.isFirstVideoDecoded[o$.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o$.ssrc,o$.decodedFrame.width,o$.decodedFrame.height),this.isFirstVideoDecoded[o$.ssrc]=!0),s$){const a$=s$.stats,c$=Date.now()-s$.lts;o$.framesDecodeFreezeTime=a$.framesDecodeFreezeTime,o$.framesDecodeInterval=a$.framesDecodeInterval,o$.framesDecodeCount>a$.framesDecodeCount&&this.isFirstVideoDecoded[o$.ssrc]?(s$.lts=Date.now(),o$.framesDecodeInterval=c$,o$.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r$.ssrc,10))?o$.framesDecodeFreezeTime+=o$.framesDecodeInterval:this.setVideoIsReady2(parseInt(r$.ssrc,10),!0))):o$.framesDecodeCount<s$.stats.framesDecodeCount&&(o$.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(o$.ssrc,{stats:DV$1({},o$),lts:Date.now()}),this._stats.videoRecv.push(o$);break}case"audio_recv":{const o$=TV$1(AV$1);o$.codec=r$.googCodecName,o$.outputLevel=Math.abs(Number(r$.audioOutputLevel))/32767,o$.decodingCNG=Number(r$.googDecodingCNG),o$.decodingCTN=Number(r$.googDecodingCTN),o$.decodingCTSG=Number(r$.googDecodingCTSG),o$.decodingNormal=Number(r$.googDecodingNormal),o$.decodingPLC=Number(r$.googDecodingPLC),o$.decodingPLCCNG=Number(r$.googDecodingPLCCNG),o$.expandRate=Number(r$.googExpandRate),o$.accelerateRate=Number(r$.googAccelerateRate),o$.preemptiveExpandRate=Number(r$.googPreemptiveExpandRate),o$.secondaryDecodedRate=Number(r$.googSecondaryDecodedRate),o$.speechExpandRate=Number(r$.googSpeechExpandRate),o$.preferredJitterBufferMs=Number(r$.googPreferredJitterBufferMs),o$.jitterBufferMs=Number(r$.googJitterBufferMs),o$.jitterMs=Number(r$.googJitterReceived),o$.bytes=Number(r$.bytesReceived),o$.packets=Number(r$.packetsReceived),o$.packetsLost=Number(r$.packetsLost),o$.ssrc=Number(r$.ssrc),o$.receivedFrames=Number(r$.googDecodingCTN)||Number(r$.packetsReceived),o$.droppedFrames=Number(r$.googDecodingPLC)+Number(r$.googDecodingPLCCNG)||Number(r$.packetsLost),o$.receivedFrames>0&&!this.isFirstAudioReceived[o$.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o$.ssrc),this.isFirstAudioReceived[o$.ssrc]=!0),o$.decodingNormal>0&&!this.isFirstAudioDecoded[o$.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o$.ssrc),this.isFirstAudioDecoded[o$.ssrc]=!0),this._stats.audioRecv.push(o$);break}case"audio_send":{const o$=TV$1(yV$1);o$.codec=r$.googCodecName,o$.inputLevel=Math.abs(Number(r$.audioInputLevel))/32767,o$.aecReturnLoss=Number(r$.googEchoCancellationReturnLoss||0),o$.aecReturnLossEnhancement=Number(r$.googEchoCancellationReturnLossEnhancement||0),o$.residualEchoLikelihood=Number(r$.googResidualEchoLikelihood||0),o$.residualEchoLikelihoodRecentMax=Number(r$.googResidualEchoLikelihoodRecentMax||0),o$.bytes=Number(r$.bytesSent),o$.packets=Number(r$.packetsSent),o$.packetsLost=Number(r$.packetsLost),o$.ssrc=Number(r$.ssrc),o$.rttMs=Number(r$.googRtt||0),this._stats.rtt=o$.rttMs,this._stats.audioSend.push(o$);break}}})}_getStats(){return new Gh$1((t$,r$)=>{this.pc.getStats(t$,r$)})}statsResponsesToObjects(t$){const r$=[];return t$.result().forEach(n$=>{const i$={id:n$.id,timestamp:n$.timestamp.valueOf().toString(),type:n$.type};n$.names().forEach(o$=>{i$[o$]=n$.stat(o$)}),r$.push(i$)}),r$}};function LV$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function kV$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?LV$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):LV$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}let MV$1=class extends OV$1{constructor(){super(...arguments),Fg$1(this,"_stats",CV$1),Fg$1(this,"report",void 0),Fg$1(this,"lastDecodeVideoReceiverStats",new Map),Fg$1(this,"lastVideoFramesRecv",new Map),Fg$1(this,"lastVideoFramesSent",new Map),Fg$1(this,"lastVideoFramesDecode",new Map),Fg$1(this,"lastVideoFramesOutput",new Map),Fg$1(this,"lastVideoJBDelay",new Map),Fg$1(this,"lastAudioJBDelay",new Map),Fg$1(this,"mediaBytesSent",new Map),Fg$1(this,"mediaBytesRetransmit",new Map),Fg$1(this,"mediaBytesTargetEncode",new Map),Fg$1(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=TV$1(CV$1),this.report.forEach(t$=>{switch(t$.type){case vw$1.OUTBOUND:case vw$1.INBOUND:{const r$=t$.mediaType||t$.kind,n$=!r$&&"frameWidth"in t$,i$=!r$&&!("frameWidth"in t$);t$.type===vw$1.OUTBOUND?r$==="audio"||i$?this.processAudioOutboundStats(t$):(r$==="video"||n$)&&this.processVideoOutboundStats(t$):t$.type===vw$1.INBOUND&&(r$==="audio"||i$?this.processAudioInboundStats(t$):(r$==="video"||n$)&&this.processVideoInboundStats(t$));break}case vw$1.TRANSPORT:{const r$=this.report.get(t$.selectedCandidatePairId);r$&&this.processCandidatePairStats(r$);break}case vw$1.CANDIDATE_PAIR:t$.selected&&this.processCandidatePairStats(t$)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t$=await this.pc.getStats(),r$={local:kV$1({},RV$1),remote:kV$1({},RV$1)};return t$.forEach(n$=>{let i$;if(n$.type===vw$1.TRANSPORT&&(i$=t$.get(n$.selectedCandidatePairId)),n$.type===vw$1.CANDIDATE_PAIR&&n$.selected&&(i$=n$),i$){const o$=(s$,a$)=>{s$.type=a$.type,s$.id=a$.id,a$.address&&(s$.address=a$.address),a$.candidateType&&(s$.candidateType=a$.candidateType),a$.port&&(s$.port=a$.port),a$.priority&&(s$.priority=a$.priority),a$.protocol&&(s$.protocol=a$.protocol),a$.relayProtocol&&(s$.relayProtocol=a$.relayProtocol)};if(i$.localCandidateId){const s$=t$.get(i$.localCandidateId);s$&&o$(r$.local,s$)}if(i$.remoteCandidateId){const s$=t$.get(i$.remoteCandidateId);s$&&o$(r$.remote,s$)}}}),r$}processCandidatePairStats(t$){if(this._stats.sendBandwidth=t$.availableOutgoingBitrate||0,t$.currentRoundTripTime&&(this._stats.rtt=1e3*t$.currentRoundTripTime),this._stats.videoSend.forEach(r$=>{t$.currentRoundTripTime&&(r$.rttMs=1e3*t$.currentRoundTripTime)}),this._stats.audioSend.forEach(r$=>{t$.currentRoundTripTime&&(r$.rttMs=1e3*t$.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t$.id,t$.localCandidateId){const r$=this.report.get(t$.localCandidateId);r$&&this.processCandidateStats(r$)}if(t$.remoteCandidateId){const r$=this.report.get(t$.remoteCandidateId);r$&&this.processCandidateStats(r$)}}processCandidateStats(t$){let r$;t$.type===vw$1.LOCAL_CANDIDATE&&(r$=this._stats.selectedCandidatePair.localCandidate),t$.type===vw$1.REMOTE_CANDIDATE&&(r$=this._stats.selectedCandidatePair.remoteCandidate),r$&&(r$.type=t$.type,r$.id=t$.id,t$.address&&(r$.address=t$.address),t$.candidateType&&(r$.candidateType=t$.candidateType),t$.port&&(r$.port=t$.port),t$.priority&&(r$.priority=t$.priority),t$.protocol&&(r$.protocol=t$.protocol),t$.relayProtocol&&(r$.relayProtocol=t$.relayProtocol),t$.type===vw$1.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r$.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(kV$1({},r$),kV$1({},this.stats.selectedCandidatePair.localCandidate)),t$.type===vw$1.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r$.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(kV$1({},r$),kV$1({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t$){let r$=this._stats.audioRecv.find(n$=>n$.ssrc===t$.ssrc);r$||(r$=TV$1(AV$1),this._stats.audioRecv.push(r$)),r$.ssrc=t$.ssrc,r$.packets=t$.packetsReceived,r$.packetsLost=t$.packetsLost,r$.packetsDiscarded=t$.packetsDiscarded,r$.bytes=t$.bytesReceived,r$.jitterMs=1e3*t$.jitter,this.processAudioTrackReceiverStats(t$,t$.trackId,r$),t$.codecId&&(r$.codec=this.getCodecFromCodecStats(t$.codecId)),r$.receivedFrames||(r$.receivedFrames=t$.packetsReceived),r$.droppedFrames||(r$.droppedFrames=t$.packetsLost),r$.receivedFrames>0&&!this.isFirstAudioReceived[r$.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r$.ssrc),this.isFirstAudioReceived[r$.ssrc]=!0),r$.outputLevel&&r$.outputLevel>0&&!this.isFirstAudioDecoded[r$.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r$.ssrc),this.isFirstAudioDecoded[r$.ssrc]=!0),typeof t$.concealedSamples=="number"&&(r$.concealedSamples=t$.concealedSamples)}processVideoInboundStats(t$){let r$=this._stats.videoRecv.find(a$=>a$.ssrc===t$.ssrc);r$||(r$=TV$1(IV$1),this._stats.videoRecv.push(r$)),r$.ssrc=t$.ssrc,r$.packets=t$.packetsReceived,r$.packetsLost=t$.packetsLost,r$.bytes=t$.bytesReceived,r$.firsCount=t$.firCount,r$.nacksCount=t$.nackCount,r$.plisCount=t$.pliCount,r$.framesDecodeCount=t$.framesDecoded,r$.framesDroppedCount=t$.framesDropped,r$.totalInterFrameDelay=t$.totalInterFrameDelay,r$.totalSquaredInterFrameDelay=t$.totalSquaredInterFrameDelay,r$.totalFreezesDuration=t$.totalFreezesDuration;const n$=this.lastDecodeVideoReceiverStats.get(r$.ssrc),i$=this.lastVideoFramesDecode.get(r$.ssrc),o$=this.lastVideoFramesOutput.get(r$.ssrc),s$=Date.now();if(r$.framesDecodeCount>0&&!this.isFirstVideoDecoded[r$.ssrc]){const a$=r$.decodedFrame?r$.decodedFrame.width:0,c$=r$.decodedFrame?r$.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r$.ssrc,a$,c$),this.isFirstVideoDecoded[r$.ssrc]=!0}if(n$){const a$=n$.stats,c$=s$-n$.lts;r$.framesDecodeFreezeTime=a$.framesDecodeFreezeTime,r$.framesDecodeInterval=a$.framesDecodeInterval,!this.isFirstVideoDecoded[r$.ssrc]&&c$>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r$.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r$.ssrc),this.isFirstVideoDecodedTimeout[r$.ssrc]=!0),r$.framesDecodeCount>a$.framesDecodeCount&&this.isFirstVideoDecoded[r$.ssrc]?(n$.lts=Date.now(),r$.framesDecodeInterval=c$,r$.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t$.ssrc))?r$.framesDecodeFreezeTime+=r$.framesDecodeInterval:this.setVideoIsReady2(parseInt(t$.ssrc,10),!0))):r$.framesDecodeCount<a$.framesDecodeCount&&(r$.framesDecodeInterval=0),t$.framesDecoded&&t$.qpSum&&(n$.stats.framesDecodeCount>t$.framesDecoded?r$.qpSumPerFrame=t$.qpSum/t$.framesDecoded:r$.qpSumPerFrame=(t$.qpSum-n$.qpSum)/(t$.framesDecoded-n$.stats.framesDecodeCount))}i$&&s$-i$.lts>=800?(r$.decodeFrameRate=Math.round((r$.framesDecodeCount-i$.count)/((s$-i$.lts)/1e3)),this.lastVideoFramesDecode.set(r$.ssrc,{count:r$.framesDecodeCount,lts:s$,rate:r$.decodeFrameRate})):i$?r$.decodeFrameRate=i$.rate:this.lastVideoFramesDecode.set(r$.ssrc,{count:r$.framesDecodeCount,lts:s$,rate:0}),r$.framesDroppedCount&&t$.framesReceived&&(o$&&s$-o$.lts>=800?(r$.outputFrameRate=Math.round((t$.framesReceived-r$.framesDroppedCount-o$.count)/((s$-o$.lts)/1e3)),this.lastVideoFramesOutput.set(r$.ssrc,{count:t$.framesReceived-r$.framesDroppedCount,lts:s$,rate:Math.max(r$.outputFrameRate,0)})):o$?r$.outputFrameRate=o$.rate:this.lastVideoFramesOutput.set(r$.ssrc,{count:t$.framesReceived-r$.framesDroppedCount,lts:s$,rate:0})),t$.totalDecodeTime&&(r$.decodeMs=1e3*t$.totalDecodeTime),this.processVideoTrackReceiverStats(t$,t$.trackId,r$),t$.codecId&&(r$.codec=this.getCodecFromCodecStats(t$.codecId)),t$.framerateMean&&(r$.framesRateFirefox=t$.framerateMean),r$.packets>0&&!this.isFirstVideoReceived[r$.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r$.ssrc),this.isFirstVideoReceived[r$.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r$.ssrc,{stats:kV$1({},r$),lts:n$?n$.lts:Date.now(),qpSum:t$.qpSum})}processVideoOutboundStats(t$){let r$=this._stats.videoSend.find(i$=>i$.ssrc===t$.ssrc);r$||(r$=TV$1(vV$1),this._stats.videoSend.push(r$));const n$=this.mediaBytesSent.get(t$.ssrc);if(n$)n$.add(t$.bytesSent);else{const i$=new gV$1(10);i$.add(t$.bytesSent),this.mediaBytesSent.set(t$.ssrc,i$)}if(t$.retransmittedBytesSent!==void 0){const i$=this.mediaBytesRetransmit.get(t$.ssrc);if(i$)i$.add(t$.retransmittedBytesSent);else{const o$=new gV$1(10);o$.add(t$.retransmittedBytesSent),this.mediaBytesRetransmit.set(t$.ssrc,o$)}}if(t$.totalEncodedBytesTarget){const i$=this.mediaBytesTargetEncode.get(t$.ssrc);if(i$)i$.add(t$.totalEncodedBytesTarget);else{const o$=new gV$1(10);o$.add(t$.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t$.ssrc,o$)}}if(r$.ssrc=t$.ssrc,r$.bytes=t$.bytesSent,r$.packets=t$.packetsSent,r$.firsCount=t$.firCount,r$.nacksCount=t$.nackCount,r$.plisCount=t$.pliCount,r$.frameCount=t$.framesEncoded,r$.adaptionChangeReason=t$.qualityLimitationReason,r$.scalabilityMode=t$.scalabilityMode,t$.totalEncodeTime&&t$.framesEncoded){const i$=this.lastEncoderMs.get(t$.ssrc);if(!i$||i$.lastFrameCount>t$.framesEncoded)r$.avgEncodeMs=1e3*t$.totalEncodeTime/t$.framesEncoded;else{const o$=t$.framesEncoded-i$.lastFrameCount,s$=t$.totalEncodeTime-i$.lastEncoderTime;r$.avgEncodeMs=1e3*s$/o$}}if(t$.framesEncoded&&t$.qpSum){const i$=this.lastEncoderMs.get(t$.ssrc);!i$||i$.lastFrameCount>t$.framesEncoded?r$.qpSumPerFrame=t$.qpSum/t$.framesEncoded:r$.qpSumPerFrame=(t$.qpSum-i$.lastQpSum)/(t$.framesEncoded-i$.lastFrameCount)}if(this.lastEncoderMs.set(t$.ssrc,{lastFrameCount:t$.framesEncoded,lastEncoderTime:t$.totalEncodeTime,lastQpSum:t$.qpSum,lts:Date.now()}),t$.codecId&&(r$.codec=this.getCodecFromCodecStats(t$.codecId)),t$.mediaSourceId&&this.processVideoMediaSource(t$.mediaSourceId,r$),this.processVideoTrackSenderStats(t$,t$.trackId,r$),t$.remoteId)this.processRemoteInboundStats(t$.remoteId,r$);else{const i$=this.findRemoteStatsId(t$.ssrc,vw$1.REMOTE_INBOUND);i$&&this.processRemoteInboundStats(i$,r$)}}processAudioOutboundStats(t$){let r$=this._stats.audioSend.find(n$=>n$.ssrc===t$.ssrc);if(r$||(r$=TV$1(yV$1),this._stats.audioSend.push(r$)),r$.ssrc=t$.ssrc,r$.packets=t$.packetsSent,r$.bytes=t$.bytesSent,t$.mediaSourceId&&this.processAudioMediaSource(t$.mediaSourceId,r$),t$.codecId&&(r$.codec=this.getCodecFromCodecStats(t$.codecId)),this.processAudioTrackSenderStats(t$,t$.trackId,r$),t$.remoteId)this.processRemoteInboundStats(t$.remoteId,r$);else{const n$=this.findRemoteStatsId(t$.ssrc,vw$1.REMOTE_INBOUND);n$&&this.processRemoteInboundStats(n$,r$)}}findRemoteStatsId(t$,r$){var n$;const i$=Array.from(_N(n$=this.report).call(n$)).find(o$=>o$.type===r$&&o$.ssrc===t$);return i$?i$.id:null}processVideoMediaSource(t$,r$){const n$=this.report.get(t$);n$&&n$.width&&n$.height&&n$.framesPerSecond&&(r$.inputFrame={width:n$.width,height:n$.height,frameRate:n$.framesPerSecond})}processAudioMediaSource(t$,r$){const n$=this.report.get(t$);n$&&(r$.inputLevel=n$.audioLevel)}processVideoTrackSenderStats(t$,r$,n$){var i$,o$,s$,a$;const c$=r$?this.report.get(r$):void 0,u$=(i$=c$==null?void 0:c$.framesSent)!==null&&i$!==void 0?i$:t$.framesSent;if(typeof u$!="number")return;let l$=(o$=c$==null?void 0:c$.frameWidth)!==null&&o$!==void 0?o$:t$.frameWidth,d$=(s$=c$==null?void 0:c$.frameHeight)!==null&&s$!==void 0?s$:t$.frameHeight,h$=(a$=c$==null?void 0:c$.framesPerSecond)!==null&&a$!==void 0?a$:t$.framesPerSecond;if(typeof l$=="number"&&typeof d$=="number"||(l$=0,d$=0),h$==null){const p$=Date.now(),_$=this.lastVideoFramesSent.get(n$.ssrc);_$&&p$-_$.lts>=800?(h$=Math.round((u$-_$.count)/((p$-_$.lts)/1e3)),this.lastVideoFramesSent.set(n$.ssrc,{count:u$,lts:p$,rate:h$})):_$?h$=_$.rate:this.lastVideoFramesSent.set(n$.ssrc,{count:u$,lts:p$,rate:0})}n$.sentFrame={width:l$,height:d$,frameRate:Math.max(0,h$)}}processVideoTrackReceiverStats(t$,r$,n$){var i$,o$,s$,a$,c$;const u$=r$?this.report.get(r$):void 0,l$=(i$=u$==null?void 0:u$.framesReceived)!==null&&i$!==void 0?i$:t$.framesReceived,d$=(o$=u$==null?void 0:u$.frameWidth)!==null&&o$!==void 0?o$:t$.frameWidth,h$=(s$=u$==null?void 0:u$.frameHeight)!==null&&s$!==void 0?s$:t$.frameHeight,p$=(a$=u$==null?void 0:u$.jitterBufferDelay)!==null&&a$!==void 0?a$:t$.jitterBufferDelay,_$=(c$=u$==null?void 0:u$.jitterBufferEmittedCount)!==null&&c$!==void 0?c$:t$.jitterBufferEmittedCount;if(typeof l$=="number"){const f$=this.lastVideoFramesRecv.get(n$.ssrc),m$=Date.now();n$.framesReceivedCount=l$;let g$=0;f$&&m$-f$.lts>=800?(g$=Math.round((l$-f$.count)/((m$-f$.lts)/1e3)),this.lastVideoFramesRecv.set(n$.ssrc,{count:l$,lts:m$,rate:g$})):f$?g$=f$.rate:this.lastVideoFramesRecv.set(n$.ssrc,{count:l$,lts:m$,rate:0}),n$.receivedFrame={width:d$||0,height:h$||0,frameRate:g$||0},n$.decodedFrame={width:d$||0,height:h$||0,frameRate:n$.decodeFrameRate||0},n$.outputFrame={width:d$||0,height:h$||0,frameRate:n$.outputFrameRate||n$.decodeFrameRate||0}}if(p$&&_$){const f$=this.lastVideoJBDelay.get(n$.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let m$=f$.jitterBufferMs;const g$=_$-f$.jitterBufferEmittedCount;g$>0&&(m$=1e3*(p$-f$.jitterBufferDelay)/g$),n$.jitterBufferMs=m$,n$.currentDelayMs=Math.round(m$),this.lastVideoJBDelay.set(n$.ssrc,{jitterBufferDelay:p$,jitterBufferEmittedCount:_$,jitterBufferMs:n$.currentDelayMs})}}processAudioTrackSenderStats(t$,r$,n$){var i$,o$,s$,a$;const c$=r$?this.report.get(r$):void 0,u$=(i$=(o$=c$==null?void 0:c$.echoReturnLoss)!==null&&o$!==void 0?o$:t$.echoReturnLoss)!==null&&i$!==void 0?i$:0,l$=(s$=(a$=c$==null?void 0:c$.echoReturnLossEnhancement)!==null&&a$!==void 0?a$:t$.echoReturnLossEnhancement)!==null&&s$!==void 0?s$:0;n$.aecReturnLoss=u$,n$.aecReturnLossEnhancement=l$}processAudioTrackReceiverStats(t$,r$,n$){var i$,o$,s$,a$,c$,u$,l$;const d$=r$?this.report.get(r$):void 0,h$=(i$=d$==null?void 0:d$.removedSamplesForAcceleration)!==null&&i$!==void 0?i$:t$.removedSamplesForAcceleration,p$=(o$=d$==null?void 0:d$.totalSamplesReceived)!==null&&o$!==void 0?o$:t$.totalSamplesReceived,_$=(s$=d$==null?void 0:d$.jitterBufferDelay)!==null&&s$!==void 0?s$:t$.jitterBufferDelay,f$=(a$=d$==null?void 0:d$.jitterBufferEmittedCount)!==null&&a$!==void 0?a$:t$.jitterBufferEmittedCount,m$=(c$=d$==null?void 0:d$.audioLevel)!==null&&c$!==void 0?c$:t$==null?void 0:t$.audioLevel,g$=(u$=d$==null?void 0:d$.totalSamplesDuration)!==null&&u$!==void 0?u$:t$==null?void 0:t$.totalSamplesDuration,v$=(l$=d$==null?void 0:d$.concealedSamples)!==null&&l$!==void 0?l$:t$.concealedSamples;if(h$&&p$&&(n$.accelerateRate=h$/p$),_$&&f$){const S$=this.lastAudioJBDelay.get(n$.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let b$=S$.jitterBufferMs;const $$=f$-S$.jitterBufferEmittedCount;$$>0&&(b$=1e3*(_$-S$.jitterBufferDelay)/$$),n$.jitterBufferMs=Math.round(b$),this.lastAudioJBDelay.set(n$.ssrc,{jitterBufferDelay:_$,jitterBufferEmittedCount:f$,jitterBufferMs:n$.jitterBufferMs})}n$.outputLevel=m$;let y$=1920;g$&&p$&&(y$=p$/g$/50,n$.receivedFrames=Math.round(p$/y$)),v$&&(n$.droppedFrames=Math.round(v$/y$))}processRemoteInboundStats(t$,r$){const n$=this.report.get(t$);n$&&(r$.packetsLost=n$.packetsLost,n$.roundTripTime&&(r$.rttMs=1e3*n$.roundTripTime),n$.jitter&&(r$.jitterMs=1e3*n$.jitter),n$.timestamp&&(r$.timestamp=n$.timestamp))}getCodecFromCodecStats(t$){const r$=this.report.get(t$);if(!r$)return"";const n$=r$.mimeType.match(/\/(.*)$/);return n$&&n$[1]?n$[1]:""}updateSendBitrate(){let t$=0,r$=null,n$=null;this.mediaBytesSent.forEach(o$=>{t$+=o$.diffMean()}),this.mediaBytesRetransmit.forEach(o$=>{r$=r$===null?o$.diffMean():r$+o$.diffMean()}),this.mediaBytesTargetEncode.forEach(o$=>{n$=n$===null?o$.diffMean():n$+o$.diffMean()});const i$=r$!==null?t$-r$:t$;this._stats.bitrate={actualEncoded:8*i$/(this.options.updateInterval/1e3),transmit:8*t$/(this.options.updateInterval/1e3)},r$!==null&&(this._stats.bitrate.retransmit=8*r$/(this.options.updateInterval/1e3)),n$!==null&&(this._stats.bitrate.targetEncoded=8*n$/(this.options.updateInterval/1e3))}},UV$1=class extends OV$1{updateStats(){return Gh$1.resolve()}};function xV$1(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,r$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,n$=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i$=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const o$=function(){const s$=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return s$&&s$[0]?Number(s$[0].split("/")[1]):null}();return o$?o$<76?new PV$1(e$,{updateInterval:t$,lossRateInterval:r$,freezeRateLimit:n$,firstVideoDecodedTimeout:i$}):new MV$1(e$,{updateInterval:t$,lossRateInterval:r$,freezeRateLimit:n$,firstVideoDecodedTimeout:i$}):function(s$){if(!window.RTCStatsReport)return!1;const a$=s$.getStats();return!!(a$ instanceof Gh$1||function(c$){return!!c$&&(typeof c$=="object"||typeof c$=="function")&&typeof c$.then=="function"}(a$))}(e$)?new MV$1(e$,{updateInterval:t$,lossRateInterval:r$,freezeRateLimit:n$,firstVideoDecodedTimeout:i$}):new UV$1(e$,{updateInterval:t$,lossRateInterval:r$,freezeRateLimit:n$,firstVideoDecodedTimeout:i$})}let VV$1=class{get localCapabilities(){return sA$1(this._localCapabilities)}get rtpCapabilities(){return sA$1(this._rtpCapabilities)}get candidates(){return sA$1(this._candidates)}get iceParameters(){return sA$1(this._iceParameters)}get dtlsParameters(){return sA$1(this._dtlsParameters)}constructor(t$){Fg$1(this,"sessionDesc",void 0),Fg$1(this,"_localCapabilities",void 0),Fg$1(this,"_rtpCapabilities",void 0),Fg$1(this,"_candidates",void 0),Fg$1(this,"_iceParameters",void 0),Fg$1(this,"_dtlsParameters",void 0),Fg$1(this,"setup",void 0),Fg$1(this,"currentMidIndex",void 0),Fg$1(this,"cname","o/i14u9pJrxRKAsu"),Fg$1(this,"firefoxSsrcMidMap",new Map),t$=sA$1(t$);const{remoteIceParameters:r$,remoteDtlsParameters:n$,candidates:i$,remoteRTPCapabilities:o$,localCapabilities:s$,direction:a$,setup:c$,videoCodec:u$,audioCodec:l$}=t$;let d$;this.setup=c$,d$=a$===Mw$1.RECEIVE_ONLY?FU$1.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):FU$1.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=o$,this._candidates=i$,this._iceParameters=r$,this._dtlsParameters=n$,this._localCapabilities=s$;const h$=a$===Mw$1.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,p$=a$===Mw$1.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,_$=a$===Mw$1.RECEIVE_ONLY?o$.send.videoCodecs:sx$1(dO$1.VIDEO,h$,p$,u$),f$=a$===Mw$1.RECEIVE_ONLY?o$.send.audioCodecs:sx$1(dO$1.AUDIO,h$,p$,l$);for(const m$ of d$.mediaDescriptions)m$.attributes.iceUfrag=r$.iceUfrag,m$.attributes.icePwd=r$.icePwd,m$.attributes.fingerprints=n$.fingerprints,m$.attributes.candidates=i$,m$.attributes.setup=this.setup,m$.media.mediaType==="application"&&(m$.attributes.sctpPort="5000"),m$.media.mediaType==="video"&&(m$.media.fmts=_$.map(g$=>g$.payloadType.toString(10)),m$.attributes.payloads=_$,m$.attributes.extmaps=h$.videoExtensions),m$.media.mediaType==="audio"&&(m$.media.fmts=f$.map(g$=>g$.payloadType.toString(10)),m$.attributes.payloads=f$,m$.attributes.extmaps=h$.audioExtensions,ox$1(m$));this.sessionDesc=d$,this.currentMidIndex=d$.mediaDescriptions.length-1}toString(){return FU$1.print(this.sessionDesc)}hasMid(t$){return Array.isArray(t$)?t$.every(r$=>this.hasMid(r$)):this.sessionDesc.mediaDescriptions.some(r$=>r$.attributes.mid===t$)}send(t$,r$,n$,i$,o$){n$=n$.replace(/ /g,"-");const{ssrcs:s$,ssrcGroups:a$}=zU$1(r$,this.cname,XA$1("SYNC_GROUP")?n$:void 0),c$=this.findPreloadMediaDesc(s$);if(c$){if(Zv$1()&&this.firefoxSsrcMidMap.set(s$[0].ssrcId,c$.attributes.mid),o$&&(o$.twcc||o$.remb)){const u$=this.sessionDesc.mediaDescriptions.indexOf(c$);return this.sessionDesc.mediaDescriptions[u$]=this.mungSendMediaDesc(c$,o$),{mid:c$.attributes.mid,needExchangeSDP:!0}}return{mid:c$.attributes.mid,needExchangeSDP:!1}}{const u$=this.findAvailableMediaIndex(t$,s$,i$);let l$;return u$===-1?(l$=this.createOrRecycleSendMedia(t$,s$,a$,"sendonly",i$,o$),this.updateBundleMids()):(l$=sA$1(this.sessionDesc.mediaDescriptions[u$]),l$.attributes.direction="sendonly",l$.attributes.ssrcs=s$,l$.attributes.ssrcGroups=a$,this.sessionDesc.mediaDescriptions[u$]=this.mungSendMediaDesc(l$,o$)),Zv$1()&&this.firefoxSsrcMidMap.set(s$[0].ssrcId,l$.attributes.mid),{needExchangeSDP:!0,mid:l$.attributes.mid}}}stopSending(t$){const r$=this.sessionDesc.mediaDescriptions.filter(n$=>n$.attributes.mid&&t$.indexOf(n$.attributes.mid)!==-1);if(r$.length!==t$.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r$.forEach(n$=>{n$.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t$,r$,n$){const i$=[];return t$.forEach(o$=>{const s$=o$._mediaStreamTrack.kind,a$=this.findAvailableRecvMediaIndex(s$);let c$,u$=!1;a$===-1?(u$=!0,c$=this.createOrRecycleRecvMedia(o$,[],"recvonly",r$,n$),this.updateBundleMids()):(c$=sA$1(this.sessionDesc.mediaDescriptions[a$]),c$.attributes.direction="recvonly"),i$.push({mid:c$.attributes.mid,needCreateTransceiver:u$})}),i$}stopReceiving(t$){const r$=this.sessionDesc.mediaDescriptions.filter(n$=>t$.indexOf(n$.attributes.mid)!==-1);if(r$.length!==t$.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r$.forEach(n$=>{n$.media.port="0",n$.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t$){const{foundation:r$,protocol:n$,address:i$,port:o$,type:s$,relatedAddress:a$,relatedPort:c$,priority:u$}=new RTCIceCandidate(t$),l$={foundation:r$??"",componentId:"1",transport:n$??"",priority:u$?u$+"":"",connectionAddress:i$??"",port:o$?o$+"":"",type:s$?s$+"":"",relAddr:a$??"",relPort:c$?c$+"":"",extension:{}};this.candidates.some(d$=>d$.priority===l$.priority&&d$.connectionAddress===l$.connectionAddress&&d$.port===l$.port)||(this._candidates.push(l$),this.sessionDesc.mediaDescriptions.forEach(d$=>{d$.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t$,r$,n$,i$,o$){const s$=t$._mediaStreamTrack.kind,a$=this.rtpCapabilities.recv,c$=sx$1(s$,a$,this.localCapabilities.send,s$===dO$1.AUDIO?o$:i$),u$=s$===dO$1.VIDEO?a$.videoExtensions:a$.audioExtensions,l$="".concat(++this.currentMidIndex);let d$={media:{mediaType:s$,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c$.map(p$=>p$.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:u$,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r$,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c$,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n$,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l$)}};d$=this.mungRecvMediaDsec(d$,t$);const h$=this.findFirstClosedMedia(s$);if(h$){const p$=this.sessionDesc.mediaDescriptions.indexOf(h$);this.sessionDesc.mediaDescriptions[p$]=d$}else this.sessionDesc.mediaDescriptions.push(d$);return d$}muteRemote(t$){const r$=this.sessionDesc.mediaDescriptions.filter(n$=>Dn$1(t$).call(t$,n$.attributes.mid||""));if(r$.length!==t$.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r$.forEach(n$=>{n$.attributes.direction="inactive"})}unmuteRemote(t$){const r$=this.sessionDesc.mediaDescriptions.filter(n$=>Dn$1(t$).call(t$,n$.attributes.mid||""));if(r$.length!==t$.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r$.forEach(n$=>{n$.attributes.direction="recvonly"})}findAvailableMediaIndex(t$,r$,n$){return this.sessionDesc.mediaDescriptions.findIndex(i$=>{const o$=i$.media.mediaType===t$&&i$.media.port!=="0"&&(i$.attributes.direction==="sendonly"||i$.attributes.direction==="sendrecv")&&i$.attributes.ssrcs.length===0;if(Zv$1()){if(o$){const s$=this.firefoxSsrcMidMap.get(r$[0].ssrcId);return!(s$||i$.attributes.mid!=="0"&&i$.attributes.mid!=="1")||!(!s$||s$!==i$.attributes.mid)}return!1}return o$&&i$.attributes.mid===n$})}findAvailableRecvMediaIndex(t$){return this.sessionDesc.mediaDescriptions.findIndex(r$=>{const n$=r$.media.mediaType===t$&&r$.media.port!=="0"&&(r$.attributes.direction==="recvonly"||r$.attributes.direction==="sendrecv");return r$.attributes.mid!=="0"&&r$.attributes.mid!=="1"&&n$})}predictReceivingMids(t$){const r$=[];for(let n$=0;n$<t$;n$++)r$.push((this.currentMidIndex+n$+1).toString(10));return r$}restartICE(t$){t$=sA$1(t$),this._iceParameters=t$,this.sessionDesc.mediaDescriptions.forEach(r$=>{r$.attributes.iceUfrag=t$.iceUfrag,r$.attributes.icePwd=t$.icePwd})}createOrRecycleSendMedia(t$,r$,n$,i$,o$,s$){const a$=this.rtpCapabilities.send,c$=t$===dO$1.VIDEO?a$.videoCodecs:a$.audioCodecs,u$=t$===dO$1.VIDEO?a$.videoExtensions:a$.audioExtensions;Zv$1()&&(o$="".concat(++this.currentMidIndex));let l$={media:{mediaType:t$,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c$.map(h$=>h$.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:u$,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r$,ssrcGroups:n$,rtcpFeedbackWildcards:[],payloads:c$,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i$,rtcpMux:!0,rtcpRsize:!0,mid:o$}};l$=this.mungSendMediaDesc(l$,s$);const d$=this.findFirstClosedMedia(t$);if(d$){const h$=this.sessionDesc.mediaDescriptions.indexOf(d$);this.sessionDesc.mediaDescriptions[h$]=l$}else this.sessionDesc.mediaDescriptions.push(l$);return l$}mungRecvMediaDsec(t$,r$,n$){const i$=sA$1(t$);return XU$1(i$),JU$1(i$,r$),QU$1(i$,r$),ZU$1(i$),$U$1(i$,n$,this.localCapabilities.send),i$}mungSendMediaDesc(t$,r$){const n$=sA$1(t$);return $U$1(n$,r$,this.localCapabilities.recv),ox$1(n$),n$}updateRecvMedia(t$,r$){const n$=this.sessionDesc.mediaDescriptions.findIndex(i$=>i$.attributes.mid===t$);if(n$!==-1){const i$=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n$],r$);this.sessionDesc.mediaDescriptions[n$]=i$}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t$=>t$.media.port!=="0").map(t$=>t$.attributes.mid)}findPreloadMediaDesc(t$){return this.sessionDesc.mediaDescriptions.find(r$=>{var n$;return((n$=r$.attributes)===null||n$===void 0||(n$=n$.ssrcs[0])===null||n$===void 0?void 0:n$.ssrcId)===t$[0].ssrcId})}findFirstClosedMedia(t$){return this.sessionDesc.mediaDescriptions.find(r$=>Zv$1()?r$.media.port==="0"&&r$.media.mediaType===t$:r$.media.port==="0")}};const FV$1=["sdp"];var BV$1;function jV$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function GV$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?jV$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):jV$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}let WV$1=(BV$1=class c5 extends aO$1{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t$,r$;return(t$=(r$=this.peerConnection.getReceivers()[0])===null||r$===void 0||(r$=r$.transport)===null||r$===void 0?void 0:r$.state)!==null&&t$!==void 0?t$:null}get localCodecs(){return[]}set isInRestartIce(t$){this._isInRestartIce=t$}get isInRestartIce(){return this._isInRestartIce}constructor(t$,r$,n$){super(t$,r$),Fg$1(this,"direction",void 0),Fg$1(this,"name",void 0),Fg$1(this,"store",void 0),Fg$1(this,"spec",void 0),Fg$1(this,"peerConnection",void 0),Fg$1(this,"initialOffer",void 0),Fg$1(this,"transport",void 0),Fg$1(this,"statsFilter",void 0),Fg$1(this,"localCandidateCount",0),Fg$1(this,"_isInRestartIce",!1),Fg$1(this,"mutex",new NA$1("P2PConnection-mutex")),Fg$1(this,"onLocalCandidate",void 0),Fg$1(this,"remoteSDP",void 0),Fg$1(this,"pendingCandidates",[]),Fg$1(this,"localCapabilities",void 0),Fg$1(this,"isReady",!1),Fg$1(this,"restartCnt",0),Fg$1(this,"curTurnServerIndex",0),this.store=r$,this.spec=t$,this.peerConnection=new RTCPeerConnection(c5.resolvePCConfiguration(t$,r$.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=n$??Mw$1.SEND_ONLY,this.name=this.direction===Mw$1.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=xV$1(this.peerConnection,XA$1("STATS_UPDATE_INTERVAL"),void 0,Zv$1()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t$){try{const r$=await tx$1();if(this.localCapabilities=rx$1(r$),t$){const{sdp:n$}=t$,i$=mV$1(t$,FV$1),o$=function(){const l$={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},d$=WU$1(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),h$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(nx$1(d$,l$,"videoExtensions",h$,p$,_$),nx$1(d$,l$,"videoCodecs",h$,p$,_$),nx$1(d$,l$,"audioExtensions",h$,p$,_$),nx$1(d$,l$,"audioCodecs",h$,p$,_$),XA$1("RAISE_H264_BASELINE_PRIORITY")){const f$=_$.videoCodecs.findIndex(m$=>m$.rtpMap&&m$.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m$.fmtp&&m$.fmtp.parameters["profile-level-id"]==="42001f");if(f$!==-1){const m$=_$.videoCodecs.findIndex(g$=>g$.rtpMap&&g$.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(m$<f$){fb$1.debug("raising H264 baseline profile priority");const g$=_$.videoCodecs[f$];_$.videoCodecs.splice(f$,1),_$.videoCodecs.splice(m$,0,g$)}m$!==-1&&XA$1("FILTER_SEND_H264_BASELINE")&&(h$.videoCodecs=h$.videoCodecs.filter(g$=>!(g$.rtpMap&&g$.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&g$.fmtp&&g$.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:h$,recv:p$,sendrecv:_$}}({},{},n$);this.remoteSDP=new VV$1({remoteIceParameters:i$.iceParameters,remoteDtlsParameters:i$.dtlsParameters,candidates:[],remoteRTPCapabilities:o$,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const s$=await this.peerConnection.createAnswer();if(!s$.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const a$=HU$1(s$.sdp);await this.peerConnection.setLocalDescription(s$);const c$=await ix$1({},{},s$.sdp);this.localCapabilities=rx$1(c$);const u$=this.peerConnection.getTransceivers()[0];return u$!=null&&u$.receiver&&u$.receiver.transport&&this.tryBindTransportEvents(u$.receiver.transport),GV$1(GV$1({},a$),{},{sdp:s$.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const n$=await this.peerConnection.createOffer();if(!n$.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i$=HU$1(n$.sdp);return this.initialOffer=n$,GV$1(GV$1({},i$),{},{sdp:n$.sdp})}}catch(r$){throw new Cy$1(Ry$1.GET_LOCAL_CONNECTION_PARAMS_FAILED,r$.toString())}}async connect(t$){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:r$,iceParameters:n$,dtlsParameters:i$}=t$,o$=await ix$1({},{},r$);this.remoteSDP=new VV$1({remoteIceParameters:n$,remoteDtlsParameters:i$,candidates:[],remoteRTPCapabilities:o$,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const s$=this.peerConnection.getTransceivers()[0];s$!=null&&s$.sender&&s$.sender.transport&&this.tryBindTransportEvents(s$.sender.transport)}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r$.toString()))}}async addRemoteCandidate(t$){try{t$&&this.pendingCandidates.push(t$),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(r$=>{this.peerConnection.addIceCandidate(r$)}),this.pendingCandidates=[])}catch(r$){throw new Cy$1(Ry$1.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(r$.toString()))}}send(t$,r$,n$){var i$=this;return YI$1(function*(){const o$=yield qI$1(i$.mutex.lock("From P2PConnection.send"));try{if(!i$.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s$=[],a$=i$.remoteSDP.receive(t$,r$,n$);t$.forEach((m$,g$)=>{if(a$[g$].needCreateTransceiver){const v$=i$.peerConnection.addTransceiver(m$._mediaStreamTrack,{direction:"sendonly"});s$.push(v$),m$._updateRtpTransceiver(v$)}else{const v$=i$.peerConnection.getTransceivers().find(y$=>y$.mid===a$[g$].mid);if(!v$)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(a$[g$].mid));s$.push(v$),m$._updateRtpTransceiver(v$)}}),Zv$1()&&XA$1("SIMULCAST")===!0&&(yield qI$1(i$.applySimulcastForFirefox(s$,t$)));const c$=a$.map(m$=>m$.mid),u$=yield qI$1(i$.peerConnection.createOffer()),l$=i$.mungSendOfferSDP(u$.sdp,t$,c$),d$=FU$1.parse(l$),h$=c$.map(m$=>{const g$=d$.mediaDescriptions.find(v$=>v$.attributes.mid===m$);if(!g$)throw new Error("Cannot extract ssrc from mediaDescription.");return KU$1(g$,XA$1("USE_PUB_RTX"))}),p$=s$.map((m$,g$)=>{const v$=c$[g$];return{localSSRC:h$[g$],id:v$}});yield qI$1(i$.peerConnection.setLocalDescription({type:"offer",sdp:l$}));try{yield p$}catch(m$){const g$=i$.remoteSDP.toString();throw yield qI$1(i$.peerConnection.setLocalDescription({type:"offer",sdp:l$})),yield qI$1(i$.peerConnection.setRemoteDescription({type:"answer",sdp:g$})),yield qI$1(i$.stopSending(c$,!0)),m$}yield qI$1(i$.applySimulcastEncodings(s$,t$)),yield qI$1(i$.applySendEncodings(s$,t$));const _$=i$.remoteSDP.toString(),f$=i$.logSDPExchange(l$,"offer","local","send");return f$==null||f$(_$),yield qI$1(i$.setRemoteDescription({type:"answer",sdp:_$})),s$.map((m$,g$)=>{const v$=c$[g$];return{localSSRC:h$[g$],id:v$}})}catch(s$){throw s$ instanceof Cy$1?s$:new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s$.toString()))}finally{o$()}})()}async stopSending(t$,r$){const n$=r$?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i$=this.peerConnection.getTransceivers().filter(c$=>t$.indexOf(c$.mid)!==-1);if(i$.length!==t$.length)throw new Error("Transceivers' length (".concat(i$.length,") doesn't match mids' length (").concat(t$.length,") when trying to call P2PConnection.stopSending."));i$.map(c$=>{var u$;c$.direction="inactive",(u$=c$.stop)===null||u$===void 0||u$.call(c$)});const o$=await this.peerConnection.createOffer(),s$=this.logSDPExchange(o$.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o$),this.remoteSDP.stopReceiving(t$);const a$=this.remoteSDP.toString();s$==null||s$(a$),await this.setRemoteDescription({type:"answer",sdp:a$})}catch(i$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i$.toString()))}finally{n$&&n$()}}async receive(t$,r$,n$,i$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t$," before remoteSDP created."));const{mid:o$,needExchangeSDP:s$}=this.remoteSDP.send(t$,r$,n$,i$);if(s$){const c$=this.remoteSDP.toString(),u$=this.logSDPExchange(c$,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:c$});const l$=await this.peerConnection.createAnswer(),d$=this.mungReceiveAnswerSDP(l$.sdp,o$,t$);u$==null||u$(d$||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:d$}),fb$1.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t$," by exchanging SDP."))}else fb$1.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t$," no need to exchange SDP."));const a$=this.peerConnection.getTransceivers().find(c$=>c$.mid===o$);if(!a$||a$.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a$.receiver.track,mid:a$.mid,transceiver:a$}}catch(o$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o$.toString()))}}async mockReceive(t$,r$,n$,i$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t$," before remoteSDP created."));const{mid:o$,needExchangeSDP:s$}=this.remoteSDP.send(t$,r$,n$,i$);if(s$){const a$=this.remoteSDP.toString(),c$=this.logSDPExchange(a$,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:a$});const u$=await this.peerConnection.createAnswer(),l$=this.mungReceiveAnswerSDP(u$.sdp,o$,t$);c$==null||c$(l$||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:l$}),fb$1.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t$," by exchanging SDP."))}else fb$1.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t$," no need to exchange SDP."))}catch(o$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o$.toString()))}}async stopReceiving(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t$);const r$=this.remoteSDP.toString(),n$=this.logSDPExchange(r$,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:r$});const i$=await this.peerConnection.createAnswer();n$==null||n$(i$.sdp||""),await this.peerConnection.setLocalDescription(i$)}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r$.toString()))}}async restartICE(t$){try{if(this.store.p2pTransport===HA$1.Auto&&(this.store.p2pTransport=HA$1.SdRtn,ZP$1().supportPCSetConfiguration&&this.peerConnection.setConfiguration(c5.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,ZP$1().supportPCSetConfiguration&&this.peerConnection.setConfiguration(c5.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t$){this.restartCnt++,this.isReady=!1;const r$=await this.peerConnection.createOffer({iceRestart:!0});if(!r$.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:n$}=HU$1(r$.sdp);return this.store.descriptionStart(),this.direction===Mw$1.SEND_ONLY&&await this.peerConnection.setLocalDescription(r$),n$}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t$),this.store.descriptionStart(),this.direction===Mw$1.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const r$=await this.peerConnection.createAnswer();if(!r$.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:n$}=HU$1(r$.sdp);return await this.peerConnection.setLocalDescription(r$),n$}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r$.toString()))}}close(){var t$;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t$=this.onConnectionStateChange)===null||t$===void 0||t$.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t$){return this.statsFilter.getVideoIsReady(t$)}async updateEncoderConfig(t$,r$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n$=await this.peerConnection.createOffer(),i$=this.mungSendOfferSDP(n$.sdp,[r$],[t$]);this.remoteSDP.updateRecvMedia(t$,r$);const o$=this.remoteSDP.toString(),s$=this.logSDPExchange(i$,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i$}),s$==null||s$(o$),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o$})}catch(n$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,n$.toString())}}async updateSendParameters(t$,r$){const n$=this.peerConnection.getTransceivers().filter(i$=>i$.mid===t$);n$.length===1&&(this.isVP8Simulcast(r$)?Zv$1()||await this.applySimulcastEncodings(n$,[r$]):await this.applySendEncodings(n$,[r$]))}setStatsRemoteVideoIsReady(t$,r$){this.statsFilter.setVideoIsReady2(t$,r$)}async replaceTrack(t$,r$){const n$=this.peerConnection.getTransceivers().find(i$=>i$.mid===r$);n$&&await n$.sender.replaceTrack(t$._mediaStreamTrack)}async getSelectedCandidatePair(){const t$=this.peerConnection.getReceivers();if(t$.length>0&&t$[0].transport&&t$[0].transport.iceTransport&&t$[0].transport.iceTransport.getSelectedCandidatePair&&t$[0].transport.iceTransport.getSelectedCandidatePair()){const r$=t$[0].transport.iceTransport,{local:n$,remote:i$}=r$.getSelectedCandidatePair();return{local:GV$1(GV$1({},RV$1),{},{candidateType:n$.type,protocol:n$.protocol,address:n$.address,port:n$.port}),remote:GV$1(GV$1({},RV$1),{},{candidateType:i$.type,protocol:i$.protocol,address:i$.address,port:i$.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t$,r$;Dn$1(t$=["connected","completed"]).call(t$,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(r$=this.onICEConnectionStateChange)===null||r$===void 0||r$.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t$;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t$=this.onConnectionStateChange)===null||t$===void 0||t$.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t$=>{if(t$.candidate){var r$;t$.candidate.candidate&&((r$=this.onLocalCandidate)===null||r$===void 0||r$.call(this,t$.candidate.toJSON())),this.localCandidateCount+=1}else fb$1.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t$,r$){let n$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i$={iceServers:[]};var o$;return t$.iceServers?i$.iceServers=t$.iceServers:t$.turnServer&&t$.turnServer.mode!=="off"&&(Ky$1(t$.turnServer.servers)?i$.iceServers=t$.turnServer.servers:(i$.iceServers&&i$.iceServers.push(...c5.turnServerConfigToIceServers(t$.turnServer.servers,r$,n$)),XA$1("USE_TURN_SERVER_OF_GATEWAY")&&i$.iceServers&&t$.turnServer.serversFromGateway&&i$.iceServers.push(...c5.turnServerConfigToIceServers(t$.turnServer.serversFromGateway,r$,n$)),Dn$1(o$=[HA$1.Relay,HA$1.SdRtn]).call(o$,r$)&&(i$.iceTransportPolicy="relay"),XA$1("FORCE_TURN_TCP")?i$.iceTransportPolicy="relay":t$.turnServer.servers.concat(t$.turnServer.serversFromGateway||[]).forEach(s$=>{s$.forceturn&&(i$.iceTransportPolicy="relay")}))),XA$1("ENABLE_ENCODED_TRANSFORM")&&ZP$1().supportWebRTCEncodedTransform&&(i$.encodedInsertableStreams=!0),fb$1.debug("P2PConnection p2pTransport is ".concat(r$)),i$}static turnServerConfigToIceServers(t$,r$){let n$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i$=[],o$=t$.filter(a$=>a$.tcpport);fb$1.debug("P2PConnection turnServers is ".concat(o$,", current index is ").concat(n$));const s$=o$.length>n$?o$[n$]:o$[0];switch(r$){case HA$1.SdRtn:const a$=t$.filter(u$=>{var l$;return Dn$1(l$=u$.username).call(l$,"glb:")&&u$.turnServerURL==u$.turnServerURL}),c$=a$.length>n$?a$[n$]:a$[0];c$&&(i$.push({username:c$.username,credential:c$.password,credentialType:"password",urls:"turn:".concat(JO$1(c$.turnServerURL),":").concat(c$.tcpport,"?transport=udp")}),i$.push({username:c$.username,credential:c$.password,credentialType:"password",urls:"turns:".concat(JO$1(c$.turnServerURL),":").concat(c$.tcpport,"?transport=tcp")}));break;case HA$1.Relay:s$&&(i$.push({username:s$.username,credential:s$.password,credentialType:"password",urls:"turn:".concat(s$.turnServerURL,":").concat(s$.tcpport,"?transport=udp")}),i$.push({username:s$.username,credential:s$.password,credentialType:"password",urls:"turns:".concat(JO$1(s$.turnServerURL),":").concat(s$.tcpport,"?transport=tcp")}));break;default:s$&&(i$.push({username:s$.username,credential:s$.password,credentialType:"password",urls:"turn:".concat(s$.turnServerURL,":").concat(s$.tcpport,"?transport=udp")}),i$.push({username:s$.username,credential:s$.password,credentialType:"password",urls:"turns:".concat(JO$1(s$.turnServerURL),":").concat(s$.tcpport,"?transport=tcp")}),i$.push({username:s$.username,credential:s$.password,credentialType:"password",urls:"stun:".concat(s$.turnServerURL,":").concat(s$.tcpport)}))}return i$}tryBindTransportEvents(t$){if(t$){this.transport=t$,t$.onstatechange=()=>{var n$;t$!=null&&t$.state&&((n$=this.onDTLSTransportStateChange)===null||n$===void 0||n$.call(this,t$.state))},t$.onerror=n$=>{var i$;(i$=this.onDTLSTransportError)===null||i$===void 0||i$.call(this,"error"in n$?n$.error:n$)};const r$=t$.iceTransport;r$&&(r$.onstatechange=()=>{const n$=t$==null?void 0:t$.iceTransport.state;var i$;n$&&((i$=this.onICETransportStateChange)===null||i$===void 0||i$.call(this,n$))},r$.getSelectedCandidatePair&&(r$.onselectedcandidatepairchange=()=>{if(r$.getSelectedCandidatePair()){const{local:n$,remote:i$}=r$.getSelectedCandidatePair();fb$1.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:n$.type,protocol:n$.protocol}),", remote ").concat(JSON.stringify({candidateType:i$.type,protocol:i$.protocol,address:i$.address,port:i$.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t$,r$){var n$;if(r$||(r$=this.peerConnection.getSenders().find(l$=>l$.track===t$._mediaStreamTrack)),!r$)return fb$1.warn("[".concat(t$.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t$))return fb$1.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ZP$1().supportSetRtpSenderParameters)return fb$1.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i$={},o$={};switch(t$._optimizationMode){case"motion":i$.degradationPreference="maintain-framerate";break;case"detail":i$.degradationPreference="maintain-resolution";break;default:i$.degradationPreference="balanced"}if(t$._encoderConfig){var s$;const{bitrateMax:l$,frameRate:d$,scaleResolutionDownBy:h$}=t$._encoderConfig;l$&&(o$.maxBitrate=1e3*l$),Dn$1(s$=t$._hints).call(s$,mL$1.LOW_STREAM)&&(d$&&(o$.maxFramerate=QO$1(d$)),h$&&h$>=1&&(o$.scaleResolutionDownBy=h$))}if(XA$1("DSCP_TYPE")&&Ey$1()){var a$;const l$=XA$1("DSCP_TYPE");Dn$1(a$=["very-low","low","medium","high"]).call(a$,l$)&&(o$.networkPriority=l$)}const c$=r$.getParameters(),u$=(n$=c$.encodings)===null||n$===void 0?void 0:n$[0];Zv$1()&&!u$&&(i$.encodings=[o$]),u$&&Object.assign(u$,o$),Object.assign(c$,i$),fb$1.debug("[".concat(t$.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c$.encodings))),await r$.setParameters(c$)}async applySendEncodings(t$,r$){try{if(!ZP$1().supportSetRtpSenderParameters||t$.length!==r$.length)return;for(let n$=0;n$<t$.length;n$++){const i$=t$[n$],o$=r$[n$];o$ instanceof aU$1&&!this.isVP8Simulcast(o$)&&await this.updateRtpSenderEncodings(o$,i$.sender)}}catch{fb$1.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t$,r$,n$){const i$=FU$1.parse(t$);return r$.forEach((o$,s$)=>{const a$=n$[s$],c$=i$.mediaDescriptions.find(u$=>u$.attributes.mid===a$);c$&&(JU$1(c$,o$),ex$1(c$,o$,this.store.codec))}),FU$1.print(i$)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t$=>{var r$;(r$=this.onFirstAudioReceived)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstVideoReceived=t$=>{var r$;(r$=this.onFirstVideoReceived)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstAudioDecoded=t$=>{var r$;(r$=this.onFirstAudioDecoded)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstVideoDecoded=(t$,r$,n$)=>{var i$;(i$=this.onFirstVideoDecoded)===null||i$===void 0||i$.call(this,t$,r$,n$)},this.statsFilter.onSelectedLocalCandidateChanged=(t$,r$)=>{var n$;(n$=this.onSelectedLocalCandidateChanged)===null||n$===void 0||n$.call(this,t$,r$)},this.statsFilter.onSelectedRemoteCandidateChanged=(t$,r$)=>{var n$;(n$=this.onSelectedRemoteCandidateChanged)===null||n$===void 0||n$.call(this,t$,r$)},this.statsFilter.onFirstVideoDecodedTimeout=t$=>{var r$;(r$=this.onFirstVideoDecodedTimeout)===null||r$===void 0||r$.call(this,t$)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t$,r$){if(t$.length===r$.length)for(let c$=0;c$<t$.length;c$++){var n$,i$,o$,s$,a$;const u$=t$[c$],l$=r$[c$];if(l$ instanceof aU$1&&!Dn$1(n$=l$._hints).call(n$,mL$1.LOW_STREAM)&&(i$=l$._encoderConfig)!==null&&i$!==void 0&&i$.bitrateMax&&((o$=l$._encoderConfig)===null||o$===void 0?void 0:o$.bitrateMax)>200&&(s$=l$._scalabilityMode)!==null&&s$!==void 0&&s$.numSpatialLayers&&((a$=l$._scalabilityMode)===null||a$===void 0?void 0:a$.numSpatialLayers)>1&&this.store.codec==="vp8"){const d$={},h$={high:1e3*(l$._encoderConfig.bitrateMax-50),medium:5e4};d$.encodings=[{rid:"m",active:!0,maxBitrate:h$.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:h$.high}];const p$=u$.sender.getParameters();await u$.sender.setParameters(Object.assign(p$,d$))}}}async applySimulcastEncodings(t$,r$){if(!Zv$1()&&t$.length===r$.length)for(let n$=0;n$<t$.length;n$++){const i$=r$[n$];if(i$ instanceof aU$1&&this.isVP8Simulcast(i$)){const o$=t$[n$],s$={},a$={high:1e3*(i$._encoderConfig.bitrateMax-50),medium:5e4};s$.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a$.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a$.medium,scaleResolutionDownBy:4}];const c$=o$.sender.getParameters();await o$.sender.setParameters(Object.assign(c$,s$))}}}isVP8Simulcast(t$){var r$,n$,i$,o$,s$;return!!(t$ instanceof aU$1&&XA$1("SIMULCAST")&&this.store.codec==="vp8"&&!Dn$1(r$=t$._hints).call(r$,mL$1.LOW_STREAM)&&(n$=t$._encoderConfig)!==null&&n$!==void 0&&n$.bitrateMax&&((i$=t$._encoderConfig)===null||i$===void 0?void 0:i$.bitrateMax)>200&&(o$=t$._scalabilityMode)!==null&&o$!==void 0&&o$.numSpatialLayers&&((s$=t$._scalabilityMode)===null||s$===void 0?void 0:s$.numSpatialLayers)>1)}logSDPExchange(t$,r$,n$,i$){if(XA$1("SDP_LOGGING"))return fb$1.upload("[".concat(this.store.clientId,"] exchanging ").concat(n$," ").concat(r$," SDP during P2PConnection.").concat(i$,`
`),t$),r$==="offer"?o$=>{this.logSDPExchange(o$,"answer",n$==="local"?"remote":"local",i$)}:void 0}async muteLocal(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r$=this.peerConnection.getTransceivers().filter(s$=>s$.mid&&t$.indexOf(s$.mid)!==-1);if(r$.length!==t$.length)throw new Error("Transceivers' length doesn't match mids' length.");r$.map(s$=>{s$.direction="inactive"});const n$=await this.peerConnection.createOffer(),i$=this.logSDPExchange(n$.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n$),this.remoteSDP.muteRemote(t$);const o$=this.remoteSDP.toString();i$==null||i$(o$),await this.setRemoteDescription({type:"answer",sdp:o$})}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r$.toString()))}}async unmuteLocal(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r$=this.peerConnection.getTransceivers().filter(s$=>s$.mid&&t$.indexOf(s$.mid)!==-1);if(r$.length!==t$.length)throw new Error("Transceivers' length doesn't match mids' length.");r$.map(async s$=>{s$.direction="sendonly"});const n$=await this.peerConnection.createOffer(),i$=this.logSDPExchange(n$.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n$),this.remoteSDP.unmuteRemote(t$);const o$=this.remoteSDP.toString();i$==null||i$(o$),await this.setRemoteDescription({type:"answer",sdp:o$})}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r$.toString()))}}async getRemoteSSRC(t$,r$){var n$,i$;if(r$=(n$=r$)!==null&&n$!==void 0?n$:(i$=this.currentRemoteDescription)===null||i$===void 0?void 0:i$.sdp){var o$;const s$=(o$=FU$1.parse(r$).mediaDescriptions.find(a$=>a$.attributes.mid===t$))===null||o$===void 0?void 0:o$.attributes.ssrcs;return s$==null?void 0:s$[0].ssrcId}}async setRemoteDescription(t$){var r$;await this.peerConnection.setRemoteDescription(t$),Dn$1(r$=["connected","completed"]).call(r$,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t$,r$,n$){const i$=FU$1.parse(t$),o$=i$.mediaDescriptions.find(s$=>s$.attributes.mid===r$);return o$&&n$===dO$1.AUDIO&&o$.media.mediaType==="audio"&&ox$1(o$),FU$1.print(i$)}},Cw$1(BV$1.prototype,"establish",[HV$1],Object.getOwnPropertyDescriptor(BV$1.prototype,"establish"),BV$1.prototype),Cw$1(BV$1.prototype,"connect",[HV$1],Object.getOwnPropertyDescriptor(BV$1.prototype,"connect"),BV$1.prototype),Cw$1(BV$1.prototype,"receive",[HV$1],Object.getOwnPropertyDescriptor(BV$1.prototype,"receive"),BV$1.prototype),Cw$1(BV$1.prototype,"mockReceive",[HV$1],Object.getOwnPropertyDescriptor(BV$1.prototype,"mockReceive"),BV$1.prototype),Cw$1(BV$1.prototype,"stopReceiving",[HV$1],Object.getOwnPropertyDescriptor(BV$1.prototype,"stopReceiving"),BV$1.prototype),Cw$1(BV$1.prototype,"restartICE",[HV$1],Object.getOwnPropertyDescriptor(BV$1.prototype,"restartICE"),BV$1.prototype),Cw$1(BV$1.prototype,"close",[HV$1],Object.getOwnPropertyDescriptor(BV$1.prototype,"close"),BV$1.prototype),Cw$1(BV$1.prototype,"updateEncoderConfig",[HV$1],Object.getOwnPropertyDescriptor(BV$1.prototype,"updateEncoderConfig"),BV$1.prototype),Cw$1(BV$1.prototype,"updateSendParameters",[HV$1],Object.getOwnPropertyDescriptor(BV$1.prototype,"updateSendParameters"),BV$1.prototype),Cw$1(BV$1.prototype,"replaceTrack",[HV$1],Object.getOwnPropertyDescriptor(BV$1.prototype,"replaceTrack"),BV$1.prototype),Cw$1(BV$1.prototype,"muteLocal",[HV$1],Object.getOwnPropertyDescriptor(BV$1.prototype,"muteLocal"),BV$1.prototype),Cw$1(BV$1.prototype,"unmuteLocal",[HV$1],Object.getOwnPropertyDescriptor(BV$1.prototype,"unmuteLocal"),BV$1.prototype),BV$1);function HV$1(e$,t$,r$){const n$=e$[t$];if(typeof n$!="function")throw new Error("Cannot use mutex on object property.");return r$.value=async function(){const i$=this.mutex,o$=await i$.lock("From P2PConnection.".concat(t$));try{for(var s$=arguments.length,a$=new Array(s$),c$=0;c$<s$;c$++)a$[c$]=arguments[c$];return await n$.apply(this,a$)}finally{o$()}},r$}function KV$1(e$,t$){let r$=document.createElement("video"),n$=document.createElement("canvas");r$.setAttribute("style","display:none"),n$.setAttribute("style","display:none"),r$.setAttribute("muted",""),r$.muted=!0,r$.setAttribute("autoplay",""),r$.autoplay=!0,r$.setAttribute("playsinline",""),n$.width=QO$1(t$.width),n$.height=QO$1(t$.height);const i$=QO$1(t$.framerate||15);document.body.append(r$),document.body.append(n$);let o$=e$._mediaStreamTrack;r$.srcObject=new MediaStream([o$]),r$.play();const s$=n$.getContext("2d");if(!s$)throw new yb$1(Ry$1.UNEXPECTED_ERROR,"can not get canvas context");const a$=ZP$1(),c$=n$.captureStream(a$.supportRequestFrame?0:i$).getVideoTracks()[0];c$.canvas||(c$.canvas=n$),n$.startCapture=()=>{if(!r$)return n$.stopCapture&&n$.stopCapture();if(r$.paused&&r$.play(),r$.videoHeight>2&&r$.videoWidth>2){const l$=r$.videoWidth,d$=r$.videoHeight/l$,h$=n$.width*d$;Math.abs(h$-n$.height)>=2&&(fb$1.debug("adjust low stream resolution","".concat(n$.width,"x").concat(n$.height," -> ").concat(n$.width,"x").concat(h$)),n$.height=h$)}s$.drawImage(r$,0,0,n$.width,n$.height),c$.requestFrame&&c$.requestFrame(),o$!==e$._mediaStreamTrack&&(o$=e$._mediaStreamTrack,r$.srcObject=new MediaStream([o$]))},n$.stopCapture=QL$1(()=>n$.startCapture&&n$.startCapture(),i$);const u$=c$.stop;return c$.stop=()=>{u$.call(c$),r$&&(r$.remove(),r$.srcObject=null,r$=null),n$&&(n$.width=0,n$.remove(),n$.stopCapture&&n$.stopCapture(),n$.startCapture=void 0,n$.stopCapture=void 0,n$=null),fb$1.debug("clean low stream renderer")},c$}var YV$1=function(e$){return e$[e$.HEIGHT=2033]="HEIGHT",e$[e$.FRAME_RATE=2034]="FRAME_RATE",e$[e$.WIDTH=2035]="WIDTH",e$}(YV$1||{}),qV$1=function(e$){return e$[e$.FRAME_RATE=2002]="FRAME_RATE",e$[e$.WIDTH=2003]="WIDTH",e$[e$.HEIGHT=2004]="HEIGHT",e$[e$.PACKAGE_LOST=2005]="PACKAGE_LOST",e$[e$.AVG_ENCODE=2007]="AVG_ENCODE",e$[e$.NACKS=2009]="NACKS",e$[e$.PLIS=2010]="PLIS",e$[e$.FIRS=2011]="FIRS",e$[e$.BITRATE=2012]="BITRATE",e$[e$.PACKAGE_RATE=2031]="PACKAGE_RATE",e$[e$.ADAPTATION=2032]="ADAPTATION",e$[e$.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e$[e$.BANDWIDTH=2061]="BANDWIDTH",e$[e$.RETRANSMIT=2062]="RETRANSMIT",e$[e$.TARGET_ENCODED=2064]="TARGET_ENCODED",e$[e$.TRANSMIT=2066]="TRANSMIT",e$[e$.FREEZE=2082]="FREEZE",e$[e$.DISABLED=2095]="DISABLED",e$[e$.PLAYER_STATUS=2128]="PLAYER_STATUS",e$[e$.QP_SUM=2143]="QP_SUM",e$}(qV$1||{}),zV$1=function(e$){return e$[e$.BITRATE=2069]="BITRATE",e$[e$.PACKAGE_LOST=2070]="PACKAGE_LOST",e$[e$.PACKAGE_RATE=2071]="PACKAGE_RATE",e$[e$.HEIGHT=2073]="HEIGHT",e$[e$.FRAME_RATE=2075]="FRAME_RATE",e$[e$.WIDTH=2077]="WIDTH",e$}(zV$1||{}),JV$1=function(e$){return e$[e$.JITTER=-1]="JITTER",e$[e$.PACKAGE_LOST=2014]="PACKAGE_LOST",e$[e$.WIDTH=2018]="WIDTH",e$[e$.HEIGHT=2019]="HEIGHT",e$[e$.FRAME_RATE=2020]="FRAME_RATE",e$[e$.JITTER_BUFFER=2023]="JITTER_BUFFER",e$[e$.CURRENT_DELAY=2024]="CURRENT_DELAY",e$[e$.NACKS=2026]="NACKS",e$[e$.PLIS=2027]="PLIS",e$[e$.FIRS=2028]="FIRS",e$[e$.BITRATE=2029]="BITRATE",e$[e$.PACKAGE_RATE=2078]="PACKAGE_RATE",e$[e$.FREEZE=2084]="FREEZE",e$[e$.DISABLED=2101]="DISABLED",e$[e$.PLAYER_STATUS=2129]="PLAYER_STATUS",e$[e$.QP_SUM=2144]="QP_SUM",e$[e$.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e$}(JV$1||{}),XV$1=function(e$){return e$[e$.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e$[e$.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e$[e$.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e$[e$.FREEZE_TIME=2109]="FREEZE_TIME",e$[e$.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e$[e$.FREEZE_DURATION=2156]="FREEZE_DURATION",e$}(XV$1||{}),QV$1=function(e$){return e$[e$.PCM_LEVEL=2104]="PCM_LEVEL",e$}(QV$1||{}),ZV$1=function(e$){return e$[e$.PACKAGE_LOST=-1]="PACKAGE_LOST",e$[e$.LEVEL=2038]="LEVEL",e$[e$.BITRATE=2039]="BITRATE",e$[e$.PACKAGE_RATE=2040]="PACKAGE_RATE",e$[e$.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e$[e$.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e$[e$.FREEZE=2081]="FREEZE",e$[e$.DISABLED=2096]="DISABLED",e$}(ZV$1||{}),$V$1=function(e$){return e$[e$.BITRATE=2044]="BITRATE",e$[e$.PACKAGE_LOST=2045]="PACKAGE_LOST",e$[e$.PACKAGE_RATE=2046]="PACKAGE_RATE",e$[e$.CURRENT_DELAY=2047]="CURRENT_DELAY",e$[e$.JITTER_BUFFER=2054]="JITTER_BUFFER",e$[e$.JITTER=2055]="JITTER",e$[e$.FREEZE=2083]="FREEZE",e$[e$.DISABLED=2102]="DISABLED",e$[e$.PCM_LEVEL=2105]="PCM_LEVEL",e$[e$.PLAYER_STATUS=2130]="PLAYER_STATUS",e$[e$.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e$}($V$1||{}),eF$1=function(e$){return e$[e$.FREEZE_TIME=-1]="FREEZE_TIME",e$[e$.LEVEL=2043]="LEVEL",e$}(eF$1||{}),tF$1=function(e$){return e$[e$.RTT=2006]="RTT",e$[e$.CONN_TYPE=801]="CONN_TYPE",e$}(tF$1||{});const iF$1=1e3,nF$1=3;function rF$1(e$,t$,r$){r$!=null&&Number.isFinite(r$)&&(e$[t$]=Math.round(Math.max(0,r$)))}function oF$1(e$){const t$={[tF$1.CONN_TYPE]:0,[tF$1.RTT]:e$.rtt};switch(e$.selectedCandidatePair.localCandidate.candidateType){case"relay":{const r$=e$.selectedCandidatePair.localCandidate.relayProtocol;r$==="udp"&&(t$[tF$1.CONN_TYPE]=1),r$==="tcp"&&(t$[tF$1.CONN_TYPE]=3),r$==="tls"&&(t$[tF$1.CONN_TYPE]=4);break}case"srflx":t$[tF$1.CONN_TYPE]=2}return t$}function sF$1(e$){let t$=0;switch(e$){case"none":t$=0;break;case"cpu":t$=1;break;case"bandwidth":t$=2;break;case"other":t$=3}return t$}let aF$1=class extends xy$1{constructor(t$){super(),Fg$1(this,"store",void 0),Fg$1(this,"uploadWRTCStatsTimer",void 0),Fg$1(this,"uploadOutboundDenoiserStatsTimer",void 0),Fg$1(this,"uploadExtStatsTimer",void 0),Fg$1(this,"uploadExtUsageStatsTimer",void 0),Fg$1(this,"uploadInboundExtStatsTimer",void 0),Fg$1(this,"requestStats",void 0),Fg$1(this,"requestTransportStats",void 0),Fg$1(this,"requestLocalMedia",void 0),Fg$1(this,"requestRemoteMedia",void 0),Fg$1(this,"requestAllTracks",void 0),Fg$1(this,"requestVideoIsReady",void 0),Fg$1(this,"requestUploadStats",void 0),Fg$1(this,"requestUpload",void 0),Fg$1(this,"uploadOutboundStarted",!1),Fg$1(this,"uploadInboundStarted",!1),Fg$1(this,"uploadTransportStarted",!1),Fg$1(this,"uploadExtensionUsageStarted",!1),Fg$1(this,"lastRecvStats",void 0),Fg$1(this,"lastSendStats",void 0),Fg$1(this,"lastFullRecvStats",void 0),Fg$1(this,"lastFullSendStats",void 0),Fg$1(this,"needUploadRenderFreezeTime",!0),this.store=t$}uploadWRTCStats(t$){if(!this.requestStats||!this.requestUploadStats)return;let r$,n$;if(this.uploadTransportStarted&&(r$=this.requestStats(),this.store.useP2P&&(n$=this.requestStats(!0))),!r$&&this.uploadOutboundStarted&&(r$=this.requestStats()),!n$&&this.uploadInboundStarted&&(n$=this.requestStats(!0)),r$||n$){const i$={};if(this.uploadTransportStarted&&r$){const o$=this.getTransportStats(r$,n$,t$);o$&&(i$.misc=[o$])}if(this.uploadOutboundStarted&&r$){const o$=this.getOutboundStats(r$,t$?this.lastSendStats:this.lastFullSendStats,t$);o$&&(i$.outbound=[o$])}if(this.uploadInboundStarted&&n$){const o$=this.getInboundStats(n$,t$?this.lastRecvStats:this.lastFullRecvStats,t$);o$&&(i$.inbound=o$)}this.requestUploadStats(i$)}this.lastRecvStats=n$,this.lastSendStats=r$,t$||(this.lastFullRecvStats=n$,this.lastFullSendStats=r$)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let t$=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(t$!==nF$1),++t$===nF$1+1&&(t$=1)},iF$1)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(t$,r$,n$){if(!this.requestStats)return;if(n$)return t$.rtt==null?void 0:{addition:{[tF$1.RTT]:t$.rtt,[tF$1.CONN_TYPE]:void 0}};const i$=oF$1(t$);if(this.store.useP2P){if(r$){const o$=oF$1(r$);i$[tF$1.CONN_TYPE]+=o$[tF$1.CONN_TYPE]<<3}i$[tF$1.CONN_TYPE]+=110}else i$[tF$1.CONN_TYPE]+=100;return{addition:i$}}getOutboundStats(t$,r$,n$){if(!this.requestUploadStats||!this.requestLocalMedia)return;const i$=this.requestLocalMedia();if(!i$||i$.length===0)return;let o$,s$,a$;return i$.forEach(c$=>{let[u$,{track:l$,ssrcs:d$}]=c$;switch(u$){case hO$1.LocalVideoLowTrack:case hO$1.LocalVideoTrack:if(u$===hO$1.LocalVideoTrack){const h$=function(f$,m$,g$,v$,y$){const S$=m$.videoSend.find(O$=>O$.ssrc===f$);if(!S$)return;const b$={},{sentFrame:$$,inputFrame:C$}=S$;if(C$&&$$){const O$=C$.frameRate,U$=$$.frameRate;b$[qV$1.FREEZE]=function(x$,F$){let L$=!0;return L$=!(x$<=5)&&(x$<=10?F$<3:x$<=20?F$<4:F$<5),L$}(O$,U$)?1:0}if(rF$1(b$,qV$1.QP_SUM,S$.qpSumPerFrame),y$)return b$;switch($$&&(rF$1(b$,qV$1.HEIGHT,$$.height),rF$1(b$,qV$1.WIDTH,$$.width),rF$1(b$,qV$1.FRAME_RATE,$$.frameRate)),b$[qV$1.DISABLED]=v$._originMediaStreamTrack&&!v$._originMediaStreamTrack.enabled||v$._mediaStreamTrack&&!v$._mediaStreamTrack.enabled?1:0,S$.adaptionChangeReason){case"none":b$[qV$1.ADAPTATION]=0;break;case"cpu":b$[qV$1.ADAPTATION]=1;break;case"bandwidth":b$[qV$1.ADAPTATION]=2;break;case"other":b$[qV$1.ADAPTATION]=3}let N$=0;S$.adaptionChangeReason&&(N$+=sF$1(S$.adaptionChangeReason)),m$.qualityLimitationReason&&(N$+=sF$1(m$.qualityLimitationReason)<<3),b$[qV$1.ADAPTATION]=N$,b$[qV$1.PLAYER_STATUS]=xL$1[v$._player?v$._player.videoElementStatus:"uninit"],rF$1(b$,qV$1.NACKS,S$.nacksCount),rF$1(b$,qV$1.PLIS,S$.plisCount),rF$1(b$,qV$1.FIRS,S$.firsCount),rF$1(b$,qV$1.AVG_ENCODE,S$.avgEncodeMs);const k$=g$&&g$.videoSend.find(O$=>O$.ssrc===f$);if(k$){let O$=y$?iF$1:iF$1*nF$1;k$.timestamp&&S$.timestamp&&(O$=S$.timestamp-k$.timestamp),k$.packets!=null&&S$.packets!=null&&rF$1(b$,qV$1.PACKAGE_RATE,1e3*(S$.packets-k$.packets)/O$),S$.packetsLost!=null&&k$.packetsLost!=null&&rF$1(b$,qV$1.PACKAGE_LOST,S$.packetsLost-k$.packetsLost),k$.bytes!=null&&S$.bytes!=null&&rF$1(b$,qV$1.BITRATE,8*(S$.bytes-k$.bytes)/O$)}return b$}(d$[0].ssrcId,t$,r$,l$,n$),p$=n$?null:function(f$,m$,g$){const v$=m$.videoSend.find(N$=>N$.ssrc===f$);if(!v$)return null;const y$={},S$=v$.inputFrame,b$=S$&&S$.height||g$&&g$.videoHeight||0,$$=S$&&S$.width||g$&&g$.videoWidth||0,C$=S$&&S$.frameRate||0;return rF$1(y$,YV$1.HEIGHT,b$),rF$1(y$,YV$1.WIDTH,$$),rF$1(y$,YV$1.FRAME_RATE,C$),y$}(d$[0].ssrcId,t$,l$),_$=n$?null:function(f$){const m$={};return rF$1(m$,qV$1.RETRANSMIT,f$.bitrate.retransmit),rF$1(m$,qV$1.TARGET_ENCODED,f$.bitrate.targetEncoded),rF$1(m$,qV$1.ACTUAL_ENCODED,f$.bitrate.actualEncoded),rF$1(m$,qV$1.TRANSMIT,f$.bitrate.transmit),rF$1(m$,qV$1.BANDWIDTH,f$.sendBandwidth),m$}(t$);s$=Object.assign({},h$,p$,_$)}else a$=n$?void 0:function(h$,p$,_$){const f$=p$.videoSend.find(v$=>v$.ssrc===h$);if(!f$)return;const m$={},g$=f$.sentFrame;if(g$&&(rF$1(m$,zV$1.HEIGHT,g$.height),rF$1(m$,zV$1.WIDTH,g$.width),rF$1(m$,zV$1.FRAME_RATE,g$.frameRate)),_$){const v$=_$.videoSend.find(y$=>y$.ssrc===h$);if(v$){let y$=iF$1*nF$1;v$.timestamp&&f$.timestamp&&(y$=f$.timestamp-v$.timestamp),v$.packets!=null&&f$.packets!=null&&rF$1(m$,zV$1.PACKAGE_RATE,1e3*(f$.packets-v$.packets)/y$),f$.packetsLost!=null&&v$.packetsLost!=null&&rF$1(m$,zV$1.PACKAGE_LOST,f$.packetsLost-v$.packetsLost),v$.bytes!=null&&f$.bytes!=null&&rF$1(m$,zV$1.BITRATE,8*(f$.bytes-v$.bytes)/y$)}}return m$}(d$[0].ssrcId,t$,r$);break;case hO$1.LocalAudioTrack:o$=n$?void 0:function(h$,p$,_$,f$){const m$=p$.audioSend.find(b$=>b$.ssrc===h$);if(!m$)return;const g$={};g$[ZV$1.DISABLED]=f$._originMediaStreamTrack&&!f$._originMediaStreamTrack.enabled||f$._mediaStreamTrack&&!f$._mediaStreamTrack.enabled?1:0;const v$=100*f$._source.getAccurateVolumeLevel(),y$=m$.inputLevel;if(y$!=null){const b$=Math.ceil(50*Math.log10(100*y$+1));rF$1(g$,ZV$1.LEVEL,b$)}else rF$1(g$,ZV$1.LEVEL,v$);rF$1(g$,QV$1.PCM_LEVEL,v$),rF$1(g$,ZV$1.AEC_RETURN_LOSS,m$.aecReturnLoss),rF$1(g$,ZV$1.AEC_RETURN_LOSS_ENH,m$.aecReturnLossEnhancement),g$[ZV$1.FREEZE]=0;const S$=_$&&_$.audioSend.find(b$=>b$.ssrc===h$);if(S$){let b$=iF$1*nF$1;S$.timestamp&&m$.timestamp&&(b$=m$.timestamp-S$.timestamp),S$.bytes!=null&&m$.bytes!=null&&rF$1(g$,ZV$1.BITRATE,8*(m$.bytes-S$.bytes)/b$),S$.packets!=null&&m$.packets!=null&&rF$1(g$,ZV$1.PACKAGE_RATE,1e3*(m$.packets-S$.packets)/b$)}return g$}(d$[0].ssrcId,t$,r$,l$)}}),{high:s$,low:a$,audio:o$}}getInboundStats(t$,r$,n$){if(!this.requestRemoteMedia)return;const i$=this.requestRemoteMedia()||[],o$=[];return i$.forEach(s$=>{let[a$,c$]=s$;const u$={peer:a$.uid};if(c$.has(dO$1.VIDEO)&&a$.videoTrack){const l$=a$._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(a$._videoSSRC)||!1,d$=a$.videoTrack?function(h$,p$,_$,f$,m$,g$,v$){var y$;const S$=p$.videoRecv.find(U$=>U$.ssrc===h$);if(!S$)return;const b$={},{receivedFrame:$$,outputFrame:C$,decodeFrameRate:N$}=S$,k$=_$&&_$.videoRecv.find(U$=>U$.ssrc===h$);if(b$[JV$1.FREEZE]=m$&&DF$1.isRemoteVideoFreeze(f$,S$,k$)?1:0,rF$1(b$,XV$1.FRAME_RATE_DECODE,N$),rF$1(b$,JV$1.QP_SUM,S$.qpSumPerFrame),S$.framesRateFirefox&&rF$1(b$,JV$1.FRAME_RATE,S$.framesRateFirefox),$$&&rF$1(b$,JV$1.FRAME_RATE,$$.frameRate),k$){const U$=p$.timestamp-_$.timestamp||(v$?iF$1:nF$1*iF$1);S$.packetsLost!=null&&k$.packetsLost!=null&&rF$1(b$,JV$1.PACKAGE_LOST,S$.packetsLost-k$.packetsLost),k$.bytes!=null&&S$.bytes!=null&&rF$1(b$,JV$1.BITRATE,8*(S$.bytes-k$.bytes)/U$),k$.packets!=null&&S$.packets!=null&&rF$1(b$,JV$1.PACKAGE_RATE,1e3*(S$.packets-k$.packets)/U$)}if(v$)return b$;$$?(rF$1(b$,JV$1.HEIGHT,$$.height),rF$1(b$,JV$1.WIDTH,$$.width)):f$&&(rF$1(b$,JV$1.HEIGHT,f$._videoHeight||0),rF$1(b$,JV$1.WIDTH,f$._videoWidth||0)),C$&&rF$1(b$,XV$1.FRAME_RATE_OUTPUT,C$.frameRate);const O$=(y$=f$._player)===null||y$===void 0?void 0:y$.rendFrameRate.toFixed(0);if(O$&&rF$1(b$,XV$1.FRAME_RATE_RENDER,+O$),rF$1(b$,JV$1.JITTER_BUFFER,S$.jitterBufferMs),rF$1(b$,JV$1.CURRENT_DELAY,S$.currentDelayMs),rF$1(b$,JV$1.FIRS,S$.firsCount),rF$1(b$,JV$1.NACKS,S$.nacksCount),rF$1(b$,JV$1.PLIS,S$.plisCount),f$){b$[JV$1.DISABLED]=f$._originMediaStreamTrack.enabled&&f$._mediaStreamTrack.enabled?0:1;const U$=f$._player;if(U$){const{freezeTimeCounterList:x$,renderFreezeAccTime:F$,videoElementStatus:L$}=U$;if(x$&&x$.length>0&&rF$1(b$,XV$1.FREEZE_TIME,x$.splice(0,1)[0]),g$&&yU$1.visibility==="visible"&&L$===ML$1.PLAYING&&ZP$1().supportRequestVideoFrameCallback){const M$=Math.min(6e3,F$);U$.renderFreezeAccTime=Math.max(0,F$-M$),rF$1(b$,XV$1.FREEZE_TIME_RENDER,M$)}if(typeof S$.totalFreezesDuration=="number"){const M$=k$&&k$.totalFreezesDuration?S$.totalFreezesDuration-k$.totalFreezesDuration:S$.totalFreezesDuration;rF$1(b$,XV$1.FREEZE_DURATION,1e3*M$)}}}if(b$[JV$1.PLAYER_STATUS]=xL$1[f$._player?f$._player.videoElementStatus:"uninit"],k$&&S$.totalInterFrameDelay!==void 0&&S$.totalSquaredInterFrameDelay!==void 0&&k$.totalInterFrameDelay!==void 0&&k$.totalSquaredInterFrameDelay!==void 0){const U$=S$.totalInterFrameDelay-k$.totalInterFrameDelay,x$=S$.totalSquaredInterFrameDelay-k$.totalSquaredInterFrameDelay,F$=S$.framesDecodeCount-k$.framesDecodeCount,L$=U$/F$*1e3,M$=Math.round(1e3*Math.sqrt((x$-Math.pow(U$,2)/F$)/F$));!isNaN(M$)&&L$+M$>Math.max(3*L$,L$+150)&&(b$[JV$1.I_FRAME_DELAY]=M$)}return b$}(a$._videoSSRC,t$,r$,a$.videoTrack,l$===!0,this.needUploadRenderFreezeTime,n$):void 0;d$&&(u$.video=d$)}if(c$.has(dO$1.AUDIO)&&a$.audioTrack){const l$=a$.audioTrack?function(d$,h$,p$,_$,f$){const m$=h$.audioRecv.find(k$=>k$.ssrc===d$);if(!m$)return;const g$={},v$=p$&&p$.audioRecv.find(k$=>k$.ssrc===d$),{receivedFrames:y$,droppedFrames:S$}=m$;var b$,$$;if(rF$1(g$,$V$1.JITTER,m$.jitterMs),y$!=null&&S$!=null&&(g$[$V$1.FREEZE]=($$=S$,(b$=y$)===0||100*$$/b$>20?1:0)),v$){const k$=h$.timestamp-p$.timestamp||(f$?iF$1:iF$1*nF$1);m$.packets!=null&&v$.packets!=null&&rF$1(g$,$V$1.PACKAGE_RATE,1e3*(m$.packets-v$.packets)/k$),v$.bytes!=null&&m$.bytes!=null&&rF$1(g$,$V$1.BITRATE,8*(m$.bytes-v$.bytes)/k$),m$.packetsLost!=null&&v$.packetsLost!=null&&rF$1(g$,$V$1.PACKAGE_LOST,m$.packetsLost-v$.packetsLost)}if(f$)return g$;const C$=100*_$._source.getAccurateVolumeLevel(),N$=m$.outputLevel;if(N$!=null){const k$=Math.ceil(50*Math.log10(100*N$+1));rF$1(g$,eF$1.LEVEL,k$)}if(rF$1(g$,$V$1.PCM_LEVEL,C$),_$&&(g$[$V$1.DISABLED]=_$._originMediaStreamTrack.enabled&&_$._mediaStreamTrack.enabled?0:1),rF$1(g$,$V$1.JITTER_BUFFER,m$.jitterBufferMs),rF$1(g$,$V$1.CURRENT_DELAY,m$.jitterBufferMs),g$[$V$1.PLAYER_STATUS]=xL$1[mk$1.getPlayerState(_$.getTrackId())],v$){const k$=m$.concealedSamples-v$.concealedSamples;k$>0&&rF$1(g$,$V$1.CONCEALED_SAMPLES,k$)}return g$}(a$._audioSSRC,t$,r$,a$.audioTrack,n$):void 0;l$&&(u$.audio=l$)}(u$.video||u$.audio)&&o$.push(u$)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,o$}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t$=(this.requestAllTracks()||[]).find(r$=>r$ instanceof SM$1);if(t$&&t$._external.getDenoiserStats){const r$=t$._external.getDenoiserStats();r$&&this.requestUpload(Lw$1.DENOISER_STATS,r$)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t$=>{t$.getProcessorStats().forEach(r$=>{this.requestUpload&&this.requestUpload(r$.type,r$.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t$=>{let[r$,n$]=t$;n$.has(dO$1.VIDEO)&&r$.videoTrack&&r$.videoTrack.getProcessorStats().forEach(i$=>{this.requestUpload&&this.requestUpload(i$.type,i$.stats)}),n$.has(dO$1.AUDIO)&&r$.audioTrack&&r$.audioTrack.getProcessorStats().forEach(i$=>{this.requestUpload&&this.requestUpload(i$.type,i$.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t$=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const r$=Date.now(),n$={connectionInterval:XA$1("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r$};let i$=[];const o$=this.requestAllTracks&&this.requestAllTracks()||[];for(const u$ of o$)!u$.muted&&u$.enabled&&(i$=i$.concat(await u$.getProcessorUsage()));const s$=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[u$,l$]of s$)l$.has(dO$1.VIDEO)&&u$.videoTrack&&(i$=i$.concat(await u$.videoTrack.getProcessorUsage())),l$.has(dO$1.AUDIO)&&u$.audioTrack&&(i$=i$.concat(await u$.audioTrack.getProcessorUsage()));if(i$.length===0)return;n$.details=function(u$,l$){const d$={};for(const{id:f$,value:m$,level:g$,direction:v$}of u$){var h$;const y$=(h$=l$.get(f$))!==null&&h$!==void 0?h$:0,S$=m$===2?y$+XA$1("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:y$;var p$,_$;l$.set(f$,S$),d$[f$]?(m$===2&&(d$[f$].value=m$),g$>d$[f$].level&&(d$[f$].level=g$),v$==="remote"&&(d$[f$].remoteUidCount+=1),d$[f$].totalTs=(p$=l$.get(f$))!==null&&p$!==void 0?p$:0):d$[f$]={value:m$,level:g$,remoteUidCount:v$==="local"?0:1,totalTs:(_$=l$.get(f$))!==null&&_$!==void 0?_$:0}}return Object.keys(d$).map(f$=>{const{level:m$,value:g$,totalTs:v$}=d$[f$];return{id:f$,level:m$,value:g$,totalTs:v$}})}(i$,t$);const a$=Date.now(),c$=a$>r$?a$:r$+1;this.requestUpload&&this.requestUpload(Lw$1.EXTENSION_USAGE_STATS,{usageStats:n$,sendTs:c$})},XA$1("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}},cF$1=class{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t$,r$){Fg$1(this,"uid",void 0),Fg$1(this,"_uintid",void 0),Fg$1(this,"_trust_in_room_",!0),Fg$1(this,"_trust_audio_enabled_state_",!0),Fg$1(this,"_trust_video_enabled_state_",!0),Fg$1(this,"_trust_audio_mute_state_",!0),Fg$1(this,"_trust_video_mute_state_",!0),Fg$1(this,"_audio_muted_",!1),Fg$1(this,"_video_muted_",!1),Fg$1(this,"_audio_enabled_",!0),Fg$1(this,"_video_enabled_",!0),Fg$1(this,"_audio_added_",!1),Fg$1(this,"_video_added_",!1),Fg$1(this,"_is_pre_created",!1),Fg$1(this,"_video_pre_subscribed",!1),Fg$1(this,"_audio_pre_subscribed",!1),Fg$1(this,"_trust_video_stream_added_state_",!0),Fg$1(this,"_trust_audio_stream_added_state_",!0),Fg$1(this,"_audioTrack",void 0),Fg$1(this,"_videoTrack",void 0),Fg$1(this,"_dataChannels",[]),Fg$1(this,"_audioSSRC",void 0),Fg$1(this,"_videoSSRC",void 0),Fg$1(this,"_audioOrtc",void 0),Fg$1(this,"_videoOrtc",void 0),Fg$1(this,"_cname",void 0),Fg$1(this,"_rtxSsrcId",void 0),Fg$1(this,"_videoMid",void 0),Fg$1(this,"_audioMid",void 0),this.uid=t$,this._uintid=r$}},dF$1=function(e$){return e$.SEND_ONLY="SEND_ONLY",e$.RECEIVE_ONLY="RECEIVE_ONLY",e$}({});function lF$1(e$,t$){var r$;let n$;switch(t$){case hO$1.LocalAudioTrack:n$=Zw$1.Audio;break;case hO$1.LocalVideoTrack:n$=Dn$1(r$=e$._hints).call(r$,mL$1.SCREEN_TRACK)?Zw$1.Screen:Zw$1.High;break;case hO$1.LocalVideoLowTrack:n$=Zw$1.Low}return n$}function uF$1(e$){const t$=ZP$1();if(e$.some(r$=>r$._bypassWebAudio))throw new Cy$1(Ry$1.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t$.webAudioMediaStreamDest)throw new Cy$1(Ry$1.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function hF$1(e$,t$){uF$1(e$);const r$=new RM$1;return e$.forEach(n$=>r$.addAudioTrack(n$)),r$}var pF$1,_F$1,EF$1,fF$1,mF$1,TF$1,SF$1,gF$1,RF$1,CF$1,IF$1,vF$1;function yF$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function AF$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?yF$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):yF$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}let bF$1=(pF$1=wF$1(dF$1.SEND_ONLY),_F$1=wF$1(dF$1.SEND_ONLY),EF$1=wF$1(),fF$1=wF$1(dF$1.RECEIVE_ONLY),mF$1=wF$1(dF$1.RECEIVE_ONLY),TF$1=wF$1(dF$1.RECEIVE_ONLY),SF$1=wF$1(dF$1.RECEIVE_ONLY),gF$1=wF$1(dF$1.RECEIVE_ONLY),RF$1=wF$1(dF$1.RECEIVE_ONLY),CF$1=wF$1(),IF$1=wF$1(dF$1.RECEIVE_ONLY),vF$1=class extends xy$1{get state(){return this._state}set state(e$){const t$=this._state;this._state=e$,this.emit(_O$1.StateChange,t$,this._state)}constructor(e$,t$){super(),Fg$1(this,"isPlanB",!1),Fg$1(this,"store",void 0),Fg$1(this,"statsUploader",void 0),Fg$1(this,"sendConnection",void 0),Fg$1(this,"recvConnection",void 0),Fg$1(this,"localTrackMap",new Map),Fg$1(this,"remoteUserMap",new Map),Fg$1(this,"localDataChannels",[]),Fg$1(this,"pendingLocalTracks",[]),Fg$1(this,"pendingRemoteTracks",[]),Fg$1(this,"statsCollector",void 0),Fg$1(this,"dtlsFailedCount",0),Fg$1(this,"sendMutex",new NA$1("P2PChannel2-send-mutex")),Fg$1(this,"recvMutex",new NA$1("P2PChannel2-recv-mutex")),Fg$1(this,"_state",pO$1.Disconnected),Fg$1(this,"_restartStates",["disconnected","failed"]),Fg$1(this,"reconnectInterval",void 0),Fg$1(this,"uploadUnplinkStarted",!1),Fg$1(this,"uploadDownlinkStarted",!1),Fg$1(this,"uplinkStateUploadInterval",void 0),Fg$1(this,"downlinkStatsUploadInterval",void 0),Fg$1(this,"handleMuteLocalTrack",async(r$,n$,i$)=>{const o$=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==pO$1.Connected)return void i$(new Cy$1(Ry$1.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const c$=this.filterTobeMutedTracks(r$);if(c$.length===0)return void n$();const u$=c$.find(p$=>p$[0]==="videoLowTrack");u$&&u$[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(c$.map(p$=>{let[,{id:_$}]=p$;return _$}));let l$=!1;var s$,a$;r$.trackMediaType==="video"?l$=!((s$=this.localTrackMap.get(hO$1.LocalAudioTrack))===null||s$===void 0||!s$.track._muted):l$=((a$=this.localTrackMap.get(hO$1.LocalVideoTrack))===null||a$===void 0?void 0:a$.id)===void 0;const d$=this.createMuteMessage(c$);await $y$1(this,_O$1.RequestMuteLocal,d$);const h$=r$.trackMediaType==="video"?yO$1.MUTE_LOCAL_VIDEO:yO$1.MUTE_LOCAL_AUDIO;await $y$1(this,_O$1.RequestP2PMuteLocal,{action:h$,message:d$,isMuteAll:l$}),n$()}catch(c$){i$(c$)}finally{o$()}}),Fg$1(this,"handleUnmuteLocalTrack",async(r$,n$,i$)=>{const o$=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==pO$1.Connected)return void i$(new Cy$1(Ry$1.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const s$=this.filterTobeUnmutedTracks(r$);if(s$.length===0)return void n$();await this.sendConnection.unmuteLocal(s$.map(u$=>{let[,{id:l$}]=u$;return l$}));const a$=this.createUnmuteMessage(s$),c$=r$.trackMediaType==="video"?yO$1.UNMUTE_LOCAL_VIDEO:yO$1.UNMUTE_LOCAL_AUDIO;await $y$1(this,_O$1.RequestP2PMuteLocal,{action:c$,message:a$}),n$()}catch(s$){i$(s$)}finally{o$()}}),Fg$1(this,"handleUpdateVideoEncoder",async(r$,n$,i$)=>{const o$=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const s$=this.localTrackMap.get(hO$1.LocalVideoTrack);if(!this.sendConnection||!s$||s$.track!==r$||this.state!==pO$1.Connected)return void n$();const{id:a$,track:c$}=s$;a$&&(await this.sendConnection.updateSendParameters(a$,c$),await this.sendConnection.updateEncoderConfig(a$,c$),this.emit(_O$1.UpdateVideoEncoder,c$)),n$()}catch(s$){i$(s$)}finally{o$()}}),Fg$1(this,"handleUpdateVideoSendParameters",async(r$,n$,i$)=>{const o$=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const s$=this.localTrackMap.get(hO$1.LocalVideoTrack);if(!this.sendConnection||!s$||s$.track!==r$||this.state!==pO$1.Connected)return void n$();const{id:a$,track:c$}=s$;a$&&await this.sendConnection.updateSendParameters(a$,c$),n$()}catch(s$){i$(s$)}finally{o$()}}),Fg$1(this,"handleReplaceTrack",async(r$,n$,i$,o$)=>{let s$;fb$1.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(r$.getTrackId(),"]")),typeof o$=="boolean"&&o$||(s$=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var a$;const u$=Array.from(this.localTrackMap.entries()).find(l$=>{let[,{track:d$}]=l$;return r$===d$});if(!this.sendConnection||!u$||u$[1].id===void 0||this.state!==pO$1.Connected)return void n$();if(await((a$=this.sendConnection)===null||a$===void 0?void 0:a$.replaceTrack(r$,u$[1].id)),u$[0]===hO$1.LocalVideoTrack&&ZP$1().supportDualStreamEncoding){const l$=this.localTrackMap.get(hO$1.LocalVideoLowTrack);if(l$){const d$=r$._mediaStreamTrack.clone();l$.track._originMediaStreamTrack.stop(),l$.track._mediaStreamTrack=d$,l$.track._originMediaStreamTrack=d$,await new Gh$1((h$,p$)=>{this.handleReplaceTrack(l$.track,h$,p$,!0)})}}n$()}catch(u$){i$(u$)}finally{var c$;(c$=s$)===null||c$===void 0||c$()}}),Fg$1(this,"handleGetLocalVideoStats",r$=>{r$(this.statsCollector.getLocalVideoTrackStats())}),Fg$1(this,"handleGetLocalAudioStats",r$=>{r$(this.statsCollector.getLocalAudioTrackStats())}),Fg$1(this,"handleGetRemoteVideoStats",r$=>this.statsCollector.getRemoteVideoTrackStats(r$.uid)[r$.uid]),Fg$1(this,"handleGetRemoteAudioStats",r$=>this.statsCollector.getRemoteAudioTrackStats(r$.uid)[r$.uid]),this.store=e$,this.statsCollector=t$,this.statsCollector.addP2PChannel(this),this.statsUploader=new aF$1(e$),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(r$=>{r$&&(r$.iceConnectionState!=="disconnected"&&r$.iceConnectionState!=="failed"||this.handleDisconnect(r$.direction))})},XA$1("ICE_RESTART_INTERVAL"))}async startP2PConnection(e$,t$){throw new Cy$1(Ry$1.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e$){throw new Cy$1(Ry$1.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e$,t$){let r$;try{if(t$){this.recvConnection&&(fb$1.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),r$=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new WV$1(e$,this.store,Mw$1.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const n$=await this.recvConnection.establish(t$);return{iceParameters:n$.iceParameters,dtlsParameters:n$.dtlsParameters,sdp:n$.sdp}}{this.state=pO$1.New,this.sendConnection&&(fb$1.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),r$=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new WV$1(e$,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const n$=await this.sendConnection.establish();return{iceParameters:n$.iceParameters,dtlsParameters:n$.dtlsParameters,sdp:n$.sdp}}}finally{r$&&r$()}}async p2pConnect(e$){if(!this.sendConnection)throw new Cy$1(Ry$1.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e$),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=pO$1.Connected}async addRemoteCandidate(e$,t$){if(t$===Mw$1.RECEIVE_ONLY){if(!this.sendConnection)throw new Cy$1(Ry$1.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e$)}else{if(!this.recvConnection)throw new Cy$1(Ry$1.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e$)}}publish(e$,t$,r$){var n$=this;return YI$1(function*(){const i$=yield qI$1(n$.sendMutex.lock("From P2PChannel.publish"));try{if(!n$.sendConnection||n$.state!==pO$1.Connected){n$.throwIfTrackTypeNotMatch(e$);const u$=e$.filter(l$=>n$.pendingLocalTracks.indexOf(l$)===-1);return void(n$.pendingLocalTracks=n$.pendingLocalTracks.concat(u$))}n$.store.pubId=n$.store.pubId+1,rV$1.markPublishStart(n$.store.clientId,n$.store.pubId);const o$=n$.filterTobePublishedTracks(e$,t$,r$);if(o$.length===0)return void(yield qI$1(n$.tryToUnmuteAudio(e$)));o$.forEach(u$=>{let{track:l$,type:d$}=u$;const h$=Date.now();n$.store.publish(l$.getTrackId(),d$===hO$1.LocalAudioTrack?"audio":"video",h$)}),n$.bindLocalTrackEvents(o$);const s$=yield qI$1(n$.sendConnection.send(o$.map(u$=>{let{track:l$}=u$;return l$}),n$.store.codec,n$.store.audioCodec)),a$=(yield qI$1(s$.next())).value,c$=n$.createGatewayPublishMessage(o$,a$);try{yield c$}catch(u$){throw s$.throw(u$),(u$==null?void 0:u$.code)===Ry$1.WS_ABORT&&o$.forEach(l$=>{let{track:d$}=l$;n$.pendingLocalTracks.indexOf(d$)===-1&&n$.pendingLocalTracks.push(d$)}),n$.unbindLocalTrackEvents(o$),u$}yield qI$1(s$.next()),o$.forEach(u$=>{let{type:l$}=u$;n$.statsCollector.addLocalStats(l$)}),n$.statsUploader.startUploadOutboundStats(),n$.assignLocalTracks(o$,a$),o$.forEach(u$=>{let{track:l$,type:d$}=u$;const h$=Date.now();n$.store.publish(l$.getTrackId(),d$===hO$1.LocalAudioTrack?"audio":"video",void 0,h$)}),n$.startUploadUplinkState()}finally{i$()}})()}async unpublish(e$){if(!this.sendConnection||this.state!==pO$1.Connected)return void(e$.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i$=>!Dn$1(e$).call(e$,i$)));const t$=this.filterTobeUnpublishedTracks(e$);if(t$.length===0)return;const r$=t$.find(i$=>i$[0]==="videoLowTrack");r$&&r$[1].track.close();const n$=this.createGatewayUnpublishMessage(t$);if(await this.sendConnection.stopSending(t$.map(i$=>{let[,{id:o$}]=i$;return o$})),this.withdrawLocalTracks(t$),this.unbindLocalTrackEvents(t$.map(i$=>{let[o$,{track:s$}]=i$;return{type:o$,track:s$}})),t$.forEach(i$=>{let[o$]=i$;this.statsCollector.removeLocalStats(o$)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===pO$1.Connected)return r$&&r$[1].track.close(),n$;e$.forEach(i$=>{const o$=this.pendingLocalTracks.indexOf(i$);o$!==-1&&this.pendingLocalTracks.splice(o$,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e$=()=>{const t$=[],r$=[];Array.from(this.localTrackMap.entries()).forEach(n$=>{let[i$,{track:o$,ssrcs:s$}]=n$;const a$={stream_type:lF$1(o$,i$),ssrcs:s$};o$._muted||!o$._enabled?t$.push(a$):r$.push(a$)}),t$.length>0&&t$.forEach(n$=>{$y$1(this,_O$1.RequestMuteLocal,[n$])}),r$.length>0&&r$.forEach(n$=>{$y$1(this,_O$1.RequestUnmuteLocal,[n$])})};e$(),this.uplinkStateUploadInterval=window.setInterval(()=>{e$()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e$){return YI$1(function*(){throw new Cy$1(Ry$1.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(fb$1.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Zy$1(this,_O$1.RequestRePublish,this.pendingLocalTracks),this.emit(_O$1.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Cy$1(Ry$1.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e$,t$,r$,n$){var i$;if(!this.recvConnection)throw new Cy$1(Ry$1.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i$=this.remoteUserMap.get(e$))!==null&&i$!==void 0&&i$.has(t$))return;const{track:o$,mid:s$,transceiver:a$}=await this.recvConnection.receive(t$,[{ssrcId:r$}],String(e$.uid),n$);t$===dO$1.AUDIO?(e$._audioTrack?e$._audioTrack._updateOriginMediaStreamTrack(o$):(e$._audioTrack=new vU$1(o$,e$.uid,e$._uintid,this.store),fb$1.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e$._audioTrack.getTrackId()))),a$&&e$._audioTrack._updateRtpTransceiver(a$),this.bindRemoteTrackEvents(e$,e$._audioTrack)):(e$._videoSSRC=r$,e$._videoTrack?e$._videoTrack._updateOriginMediaStreamTrack(o$):(e$._videoTrack=new IU$1(o$,e$.uid,e$._uintid,this.store),fb$1.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e$._videoTrack.getTrackId()))),a$&&e$._videoTrack._updateRtpTransceiver(a$),this.bindRemoteTrackEvents(e$,e$._videoTrack));const c$=this.remoteUserMap.get(e$);c$?c$.set(t$,s$):this.remoteUserMap.set(e$,new Map([[t$,s$]])),this.statsCollector.addRemoteStats(e$.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const u$=this.pendingRemoteTracks.findIndex(l$=>{let{user:d$,kind:h$}=l$;return d$.uid===e$.uid&&t$===h$});u$!==-1&&(this.pendingRemoteTracks.splice(u$,1),this.emit(_O$1.MediaReconnectEnd,e$.uid))}async mockSubscribe(e$,t$,r$,n$){if(!this.recvConnection)throw new Cy$1(Ry$1.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t$,[{ssrcId:r$}],String(e$.uid),n$)}async unsubscribe(e$,t$,r$){const n$=this.pendingRemoteTracks.filter(o$=>{let{user:s$,kind:a$}=o$;return t$!==void 0?s$.uid===e$.uid&&t$===a$:s$.uid===e$.uid});if(n$.forEach(o$=>{const s$=this.pendingRemoteTracks.indexOf(o$);this.pendingRemoteTracks.splice(s$,1)}),this.recvConnection||r$||n$.forEach(o$=>{let{kind:s$}=o$;var a$;if(s$===dO$1.AUDIO)(a$=e$._audioTrack)===null||a$===void 0||a$._destroy(),e$._audioTrack=void 0;else if(s$===dO$1.VIDEO){var c$;(c$=e$._videoTrack)===null||c$===void 0||c$._destroy(),e$._videoTrack=void 0}}),!this.recvConnection)return;const i$=this.filterTobeUnSubscribedTracks(e$,t$);i$.length!==0&&(await this.recvConnection.stopReceiving(i$.map(o$=>{let[,{id:s$}]=o$;return s$})),this.withdrawRemoteTracks(i$),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i$.forEach(o$=>{let[s$,{kind:a$}]=o$;var c$,u$;if(a$===dO$1.VIDEO&&s$._videoSSRC&&((c$=this.recvConnection)===null||c$===void 0||c$.setStatsRemoteVideoIsReady(s$._videoSSRC,!1)),a$===dO$1.VIDEO)this.unbindRemoteTrackEvents(s$._videoTrack),r$||((u$=s$._videoTrack)===null||u$===void 0||u$._destroy(),s$._videoTrack=void 0);else if(a$===dO$1.AUDIO){var l$;this.unbindRemoteTrackEvents(s$._audioTrack),!r$&&((l$=s$._audioTrack)===null||l$===void 0||l$._destroy(),s$._audioTrack=void 0)}}),i$.forEach(o$=>{let[,{kind:s$}]=o$;$y$1(this,_O$1.RequestP2PMuteRemote,s$)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e$=()=>Array.from(this.remoteUserMap.entries()).forEach(t$=>{let[,r$]=t$;[dO$1.VIDEO,dO$1.AUDIO].forEach(n$=>{r$.has(n$)?$y$1(this,_O$1.RequestP2PUnmuteRemote,n$):$y$1(this,_O$1.RequestP2PMuteRemote,n$)})});e$(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e$()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e$){throw new Cy$1(Ry$1.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e$){throw new Cy$1(Ry$1.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e$){throw new Cy$1(Ry$1.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e$){throw new Cy$1(Ry$1.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e$,t$){if(!this.recvConnection)return;const r$=this.remoteUserMap.get(e$);if(!r$)return void fb$1.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e$.uid,"."));if(!r$.get(t$))return void fb$1.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e$.uid," media type ").concat(t$,"."));const n$=t$===dO$1.VIDEO?e$._videoSSRC:e$._audioSSRC;n$!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(n$,!1)}async unmuteRemote(e$,t$){return this.unmuteRemoteNoLock(e$,t$)}async unmuteRemoteNoLock(e$,t$){if(!this.recvConnection)return;const r$=this.remoteUserMap.get(e$);if(!r$)return void fb$1.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e$.uid,"."));r$.get(t$)||fb$1.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e$.uid," media type ").concat(t$,"."))}getAllTracks(e$){const t$=this.localTrackMap.get(hO$1.LocalAudioTrack);if((t$==null?void 0:t$.track)instanceof RM$1){const r$=t$.track;return Array.from(this.localTrackMap.entries()).filter(n$=>{let[i$]=n$;return i$!==hO$1.LocalAudioTrack}).filter(n$=>{let[i$]=n$;return!(e$&&i$===hO$1.LocalVideoLowTrack)}).map(n$=>{let[,{track:i$}]=n$;return i$}).concat(r$.trackList)}return Array.from(this.localTrackMap.entries()).filter(r$=>{let[n$]=r$;return!(e$&&n$===hO$1.LocalVideoLowTrack)}).map(r$=>{let[,{track:n$}]=r$;return n$})}reportPublishEvent(e$,t$,r$,n$,i$){if(e$){const s$=this.localTrackMap.get(hO$1.LocalAudioTrack),a$=n$?this.localTrackMap.get(hO$1.LocalVideoLowTrack):this.localTrackMap.get(hO$1.LocalVideoTrack);vb$1.publish(this.store.sessionId,{eventElapse:rV$1.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e$,ec:t$,audioName:s$==null?void 0:s$.track.getTrackLabel(),videoName:a$==null?void 0:a$.track.getTrackLabel(),screenshare:(a$==null?void 0:a$.track._hints.indexOf(mL$1.SCREEN_TRACK))!==-1,audio:!!s$,video:!!a$,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i$})}else{var o$;r$||(r$=[]);const s$=r$.find(c$=>c$ instanceof TM$1),a$=n$?(o$=this.localTrackMap.get(hO$1.LocalVideoTrack))===null||o$===void 0?void 0:o$.track:r$.find(c$=>c$ instanceof aU$1);vb$1.publish(this.store.sessionId,{eventElapse:rV$1.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e$,ec:t$,audioName:s$==null?void 0:s$.getTrackLabel(),videoName:a$==null?void 0:a$.getTrackLabel(),screenshare:(a$==null?void 0:a$._hints.indexOf(mL$1.SCREEN_TRACK))!==-1,audio:!!s$,video:!!a$,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i$})}}reportSubscribeEvent(e$,t$,r$,n$){const i$=n$===dO$1.VIDEO?r$._videoSSRC:r$._audioSSRC;i$&&vb$1.subscribe(this.store.sessionId,{succ:e$,ec:t$,video:n$===dO$1.VIDEO,audio:n$===dO$1.AUDIO,peerid:r$.uid,subscribeRequestid:n$===dO$1.VIDEO?r$._videoSSRC:r$._audioSSRC,p2pid:this.store.p2pId,eventElapse:rV$1.measureFromSubscribeStart(this.store.clientId,i$)})}reset(){fb$1.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new NA$1("P2PChannel2-send-mutex"),this.sendMutex=new NA$1("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e$=this.localTrackMap.get(hO$1.LocalAudioTrack);if((e$==null?void 0:e$.track)instanceof RM$1){if(e$.track.trackList.length>0){const t$=e$.track;e$.track.trackList.forEach(r$=>{t$.removeAudioTrack(r$)})}e$.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=pO$1.Disconnected}getStats(e$){var t$,r$;return e$?(r$=this.recvConnection)===null||r$===void 0?void 0:r$.getStats():(t$=this.sendConnection)===null||t$===void 0?void 0:t$.getStats()}getRemoteVideoIsReady(e$){var t$;return((t$=this.recvConnection)===null||t$===void 0?void 0:t$.getRemoteVideoIsReady(e$))||!1}getLocalAudioVolume(){const e$=this.localTrackMap.get(hO$1.LocalAudioTrack);if(e$)return e$.track.getVolumeLevel()}getLocalVideoSize(){const e$=this.localTrackMap.get(hO$1.LocalVideoTrack);if(e$)return{width:e$.track.videoWidth||0,height:e$.track.videoHeight||0}}getEncoderConfig(e$){const t$=this.localTrackMap.get(e$);return t$&&t$.track instanceof aU$1||t$&&t$.track instanceof TM$1?t$.track._encoderConfig:void 0}getLocalMedia(e$){return this.localTrackMap.get(e$)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e$,t$){if(!e$)return this.remoteUserMap.size>0;const r$=this.remoteUserMap.get(e$);return!!r$&&(!t$||r$.has(t$))}async hasRemoteMediaWithLock(e$,t$){if(!e$)return this.remoteUserMap.size>0;const r$=this.remoteUserMap.get(e$);return!!r$&&(!t$||r$.has(t$))}getRemoteMedia(e$){var t$;const r$=Array.from(d_$1(t$=this.remoteUserMap).call(t$)).find(n$=>n$.uid===e$);return r$?{audioTrack:r$.audioTrack,audioSSRC:r$._audioSSRC,videoTrack:r$.videoTrack,videoSSRC:r$._videoSSRC}:{}}getAudioLevels(){let e$=Array.from(this.remoteUserMap.entries()).map(r$=>{let[n$]=r$;return{uid:n$.uid,level:n$.audioTrack?100*n$.audioTrack._source.getAccurateVolumeLevel():0}});const t$=this.localTrackMap.get(hO$1.LocalAudioTrack);return t$&&e$.push({level:100*t$.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e$=aE$1(e$).call(e$,(r$,n$)=>r$.level-n$.level),e$}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(fb$1.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=pO$1.Reconnecting,XA$1("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e$=>{let[t$]=e$;var r$;t$._videoTrack&&t$._videoTrack._player&&((r$=t$._videoTrack._player.getVideoElement())===null||r$===void 0||r$.pause(),t$._videoTrack._player.isKeepLastFrame=!0,t$._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e$=>{var t$;let[r$,{track:n$}]=e$;switch(r$){case hO$1.LocalVideoTrack:Dn$1(t$=n$._hints).call(t$,mL$1.LOW_STREAM)?n$.close():this.pendingLocalTracks.push(n$);break;case hO$1.LocalAudioTrack:n$ instanceof RM$1?this.pendingLocalTracks=this.pendingLocalTracks.concat(n$.trackList):this.pendingLocalTracks.push(n$);case hO$1.LocalVideoLowTrack:}}),this.emit(_O$1.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e$=>{let[t$,r$]=e$;Array.from(d_$1(r$).call(r$)).forEach(n$=>{this.setPendingRemoteMedia(t$,n$)}),this.emit(_O$1.MediaReconnectStart,t$.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),fb$1.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e$,t$){for(const r$ of this.pendingRemoteTracks){const{user:n$,kind:i$}=r$;if((e$ instanceof cF$1?e$.uid:e$)===n$.uid&&t$===i$)return!0}return!1}setPendingRemoteMedia(e$,t$){this.hasPendingRemoteMedia(e$,t$)||this.pendingRemoteTracks.push({user:e$,kind:t$})}async restartICE(e$,t$){let r$,n$;if(e$===Mw$1.SEND_ONLY){if(!this.sendConnection)throw new Cy$1(Ry$1.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");r$=await this.sendMutex.lock("From P2PChannel.restartICE"),n$=this.sendConnection}else{if(!this.recvConnection)throw new Cy$1(Ry$1.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");r$=await this.recvMutex.lock("From P2PChannel.restartICE"),n$=this.recvConnection}try{if(t$){const i$=await n$.restartICE(t$);return n$.isInRestartIce=!1,i$}{const i$=await n$.restartICE();if(i$){const o$=await Zy$1(this,_O$1.RequestP2PRestartICE,{direction:Mw$1.RECEIVE_ONLY,iceParameter:i$});await n$.restartICE(o$),n$.isInRestartIce=!1}}}finally{r$()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e$=this.sendConnection.getStats(),t$=this.localTrackMap.get(hO$1.LocalVideoTrack),r$=this.localTrackMap.get(hO$1.LocalAudioTrack),n$=e$.videoSend.find(p$=>{var _$;return p$.ssrc===(t$==null||(_$=t$.ssrcs)===null||_$===void 0?void 0:_$[0].ssrcId)}),i$=e$.audioSend.find(p$=>{var _$;return p$.ssrc===(r$==null||(_$=r$.ssrcs)===null||_$===void 0?void 0:_$[0].ssrcId)});if(!n$||!i$)return 1;const o$=eA$1(this,_O$1.NeedSignalRTT),s$=n$?n$.rttMs:void 0,a$=i$?i$.rttMs:void 0,c$=s$&&a$?(s$+a$)/2:s$||a$,u$=(c$&&o$?(c$+o$)/2:c$||o$)||0,l$=100*e$.sendPacketLossRate*.7/50+.3*u$/1500,d$=l$<.17?1:l$<.36?2:l$<.59?3:l$<.1?4:5,h$=t$==null?void 0:t$.track;if(h$&&h$._encoderConfig&&h$._hints.indexOf(mL$1.SCREEN_TRACK)===-1){const p$=h$._encoderConfig.bitrateMax,_$=e$.bitrate.actualEncoded;if(p$&&_$){const f$=(1e3*p$-_$)/(1e3*p$);return bb$1[f$<.15?0:f$<.3?1:f$<.45?2:f$<.6?3:4][d$]}}return d$}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e$=this.recvConnection.getStats();let t$=0;return Array.from(this.remoteUserMap.entries()).forEach(r$=>{let[n$]=r$;const i$=n$._audioSSRC,o$=n$._videoSSRC,s$=e$.audioRecv.find(_$=>_$.ssrc===i$),a$=e$.videoRecv.find(_$=>_$.ssrc===o$);if(!s$&&!a$)return void(t$+=1);const c$=eA$1(this,_O$1.NeedSignalRTT),u$=e$.rtt,l$=(u$&&c$?(u$+c$)/2:u$||c$)||0,d$=s$?s$.jitterMs:void 0,h$=e$.recvPacketLossRate;let p$=.7*h$*100/50+.3*l$/1500;d$&&(p$=.6*h$*100/50+.2*l$/1500+.2*d$/400),t$+=p$<.1?1:p$<.17?2:p$<.36?3:p$<.59?4:5}),this.remoteUserMap.size>0?Math.round(t$/this.remoteUserMap.size):t$}async muteLocalTrack(e$){return new Gh$1((t$,r$)=>{this.handleMuteLocalTrack(e$,t$,r$)})}filterTobePublishedTracks(e$,t$,r$){const n$=[],i$=ZP$1(),o$=this.getAllTracks();e$=rA$1(e$=e$.filter(c$=>o$.indexOf(c$)===-1));let s$=!1,a$=!1;for(const c$ of e$){if(c$ instanceof aU$1&&(this.localTrackMap.has(hO$1.LocalVideoTrack)||s$?new Cy$1(Ry$1.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n$.push({track:c$,type:hO$1.LocalVideoTrack}),s$=!0),t$)){const u$=this.getLowVideoTrack(c$,r$);n$.push({track:u$,type:hO$1.LocalVideoLowTrack})}if(c$ instanceof TM$1){const u$=this.localTrackMap.get(hO$1.LocalAudioTrack);if(u$){if(!(u$.track instanceof RM$1))throw new Cy$1(Ry$1.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c$._bypassWebAudio)throw new Cy$1(Ry$1.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");u$.track.addAudioTrack(c$),this.bindLocalAudioTrackEvents(c$,!0)}else if(a$){const l$=n$.find(d$=>{let{type:h$}=d$;return h$===hO$1.LocalAudioTrack});if(!(l$.track instanceof RM$1))throw new Cy$1(Ry$1.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c$._bypassWebAudio)throw new Cy$1(Ry$1.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");l$.track.addAudioTrack(c$)}else{if(!i$.webAudioMediaStreamDest||c$ instanceof RM$1||c$._bypassWebAudio)n$.push({track:c$,type:hO$1.LocalAudioTrack});else{const l$=new RM$1;l$.addAudioTrack(c$),n$.push({track:l$,type:hO$1.LocalAudioTrack})}a$=!0}}}return n$}filterTobeUnpublishedTracks(e$){const t$=[],r$=this.getAllTracks();e$=rA$1(e$=e$.filter(n$=>r$.indexOf(n$)!==-1));for(const n$ of e$){if(n$ instanceof TM$1){const i$=this.localTrackMap.get(hO$1.LocalAudioTrack);if(!i$)continue;i$.track instanceof RM$1?(i$.track.removeAudioTrack(n$),this.unbindLocalAudioTrackEvents(n$),i$.track.trackList.length===0&&(t$.push([hO$1.LocalAudioTrack,i$]),i$.track.close())):t$.push([hO$1.LocalAudioTrack,i$])}if(n$ instanceof aU$1){const i$=this.localTrackMap.get(hO$1.LocalVideoTrack);if(!i$)continue;t$.push([hO$1.LocalVideoTrack,i$]);const o$=this.localTrackMap.get(hO$1.LocalVideoLowTrack);o$&&t$.push([hO$1.LocalVideoLowTrack,o$])}}return t$}bindLocalTrackEvents(e$){e$.forEach(t$=>{let{track:r$,type:n$}=t$;switch(n$){case hO$1.LocalVideoTrack:r$.addListener(fL$1.GET_STATS,this.handleGetLocalVideoStats),r$.addListener(fL$1.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r$.addListener(fL$1.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r$.addListener(fL$1.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r$.addListener(fL$1.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r$.addListener(fL$1.NEED_REPLACE_TRACK,this.handleReplaceTrack),r$.addListener(fL$1.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r$.addListener(fL$1.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case hO$1.LocalAudioTrack:this.bindLocalAudioTrackEvents(r$);case hO$1.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e$,t$){e$ instanceof RM$1?e$.trackList.forEach(r$=>{r$.addListener(fL$1.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r$.addListener(fL$1.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r$.addListener(fL$1.GET_STATS,this.handleGetLocalAudioStats),r$.addListener(fL$1.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r$.addListener(fL$1.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e$.addListener(fL$1.GET_STATS,this.handleGetLocalAudioStats),e$.addListener(fL$1.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e$.addListener(fL$1.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e$.addListener(fL$1.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e$.addListener(fL$1.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t$||e$.addListener(fL$1.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e$){e$||(e$=Array.from(this.localTrackMap.entries()).map(t$=>{let[r$,{track:n$}]=t$;return{track:n$,type:r$}})),e$.forEach(t$=>{let{track:r$,type:n$}=t$;switch(n$){case hO$1.LocalVideoTrack:r$.off(fL$1.GET_STATS,this.handleGetLocalVideoStats),r$.off(fL$1.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r$.off(fL$1.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r$.off(fL$1.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r$.off(fL$1.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r$.off(fL$1.NEED_REPLACE_TRACK,this.handleReplaceTrack),r$.off(fL$1.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r$.off(fL$1.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case hO$1.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r$);case hO$1.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e$){e$ instanceof RM$1?e$.trackList.forEach(t$=>{t$.off(fL$1.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t$.off(fL$1.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t$.off(fL$1.GET_STATS,this.handleGetLocalAudioStats),t$.off(fL$1.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t$.off(fL$1.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e$.off(fL$1.GET_STATS,this.handleGetLocalAudioStats),e$.off(fL$1.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e$.off(fL$1.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e$.off(fL$1.NEED_REPLACE_TRACK,this.handleReplaceTrack),e$.off(fL$1.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e$.off(fL$1.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e$,t$){t$ instanceof IU$1&&t$.addListener(fL$1.GET_STATS,r$=>{r$(this.handleGetRemoteVideoStats(e$))}),t$ instanceof vU$1&&t$.addListener(fL$1.GET_STATS,r$=>{r$(this.handleGetRemoteAudioStats(e$))})}unbindRemoteTrackEvents(e$){e$&&e$.removeAllListeners(fL$1.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e$=>{let[t$,r$]=e$;r$.has(dO$1.AUDIO)&&this.unbindRemoteTrackEvents(t$._audioTrack),r$.has(dO$1.VIDEO)&&this.unbindRemoteTrackEvents(t$._videoTrack)})}createGatewayPublishMessage(e$,t$){return e$.map((r$,n$)=>{var i$;let o$,{track:s$,type:a$}=r$;switch(a$){case hO$1.LocalAudioTrack:o$=Zw$1.Audio;break;case hO$1.LocalVideoTrack:o$=Dn$1(i$=s$._hints).call(i$,mL$1.SCREEN_TRACK)?Zw$1.Screen:Zw$1.High;break;case hO$1.LocalVideoLowTrack:o$=Zw$1.Low}return{kind:a$===hO$1.LocalAudioTrack?dO$1.AUDIO:dO$1.VIDEO,stream_type:o$,mid:t$[n$].id,ssrcs:t$[n$].localSSRC,isMuted:s$.muted||!s$.enabled}})}createGatewayUnpublishMessage(e$){return e$.map(t$=>{var r$;let n$,[i$,{track:o$,ssrcs:s$,id:a$}]=t$;switch(i$){case hO$1.LocalVideoTrack:n$=Dn$1(r$=o$._hints).call(r$,mL$1.SCREEN_TRACK)?Zw$1.Screen:Zw$1.High;break;case hO$1.LocalAudioTrack:n$=Zw$1.Audio;break;case hO$1.LocalVideoLowTrack:n$=Zw$1.Low}return{stream_type:n$,ssrcs:s$,mid:a$}})}assignLocalTracks(e$,t$){e$.forEach((r$,n$)=>{let{track:i$,type:o$}=r$;this.localTrackMap.set(o$,{track:i$,id:t$[n$].id,ssrcs:t$[n$].localSSRC})})}withdrawLocalTracks(e$){e$.forEach(t$=>{let[r$]=t$;this.localTrackMap.delete(r$)})}bindConnectionEvents(e$){e$.onConnectionStateChange=async t$=>{var r$;fb$1.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e$.name,".onConnectionStateChange(").concat(t$,")")),this.emit(_O$1.PeerConnectionStateChange,t$),t$!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t$==="connected"&&(e$.isInRestartIce=!1),Dn$1(r$=this._restartStates).call(r$,t$)&&!e$.isInRestartIce&&(t$==="disconnected"&&await mA$1(800),e$.iceConnectionState!=="disconnected"&&e$.iceConnectionState!=="failed"||this.handleDisconnect(e$.direction))},e$.onICEConnectionStateChange=t$=>{t$!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),fb$1.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t$,")")),vb$1.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t$,tag:jy$1.TRACER}).onSuccess(),this.emit(_O$1.IceConnectionStateChange,t$)},e$.onICETransportStateChange=t$=>{fb$1.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t$,")"))},e$.onDTLSTransportStateChange=t$=>{fb$1.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t$,")"))},e$.onDTLSTransportError=t$=>{fb$1.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t$,")"))},e$.onFirstAudioDecoded=t$=>{var r$;const n$=Array.from(d_$1(r$=this.remoteUserMap).call(r$)).find(o$=>o$._audioSSRC===t$);var i$;n$&&(this.store.subscribe(n$.uid,"audio",void 0,void 0,void 0,Date.now()),(i$=n$.audioTrack)===null||i$===void 0||i$.emit(IL$1.FIRST_FRAME_DECODED),vb$1.firstRemoteFrame(this.store.sessionId,gb$1.FIRST_AUDIO_DECODE,Rb$1.FIRST_AUDIO_DECODE,{peer:n$._uintid,subscribeElapse:rV$1.measureFromSubscribeStart(this.store.clientId,t$),subscribeRequestid:t$,p2pid:this.store.p2pId}))},e$.onFirstAudioReceived=t$=>{var r$;const n$=Array.from(d_$1(r$=this.remoteUserMap).call(r$)).find(i$=>i$._audioSSRC===t$);n$&&vb$1.firstRemoteFrame(this.store.sessionId,gb$1.FIRST_AUDIO_RECEIVED,Rb$1.FIRST_AUDIO_RECEIVED,{peer:n$._uintid,subscribeElapse:rV$1.measureFromSubscribeStart(this.store.clientId,t$),subscribeRequestid:t$,p2pid:this.store.p2pId})},e$.onFirstVideoDecoded=(t$,r$,n$)=>{this.reportVideoFirstFrameDecoded(t$,r$,n$)},e$.onFirstVideoReceived=t$=>{var r$;const n$=Array.from(d_$1(r$=this.remoteUserMap).call(r$)).find(i$=>i$._videoSSRC===t$);n$&&vb$1.firstRemoteFrame(this.store.sessionId,gb$1.FIRST_VIDEO_RECEIVED,Rb$1.FIRST_VIDEO_RECEIVED,{peer:n$._uintid,subscribeElapse:rV$1.measureFromSubscribeStart(this.store.clientId,t$),subscribeRequestid:t$,p2pid:this.store.p2pId})},e$.onSelectedLocalCandidateChanged=(t$,r$)=>{const n$=t$.candidateType==="relay",i$=r$.candidateType==="relay";r$.candidateType!=="unknown"&&n$===i$||this.emit(_O$1.ConnectionTypeChange,n$),fb$1.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(nN$1(r$))," -> ").concat(JSON.stringify(nN$1(t$)),")"))},e$.onSelectedRemoteCandidateChanged=(t$,r$)=>{fb$1.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(nN$1(r$))," -> ").concat(JSON.stringify(nN$1(t$)),")"))},e$.onFirstVideoDecodedTimeout=t$=>{this.reportVideoFirstFrameDecoded(t$,void 0,void 0,!0)},e$.onLocalCandidate=t$=>{this.emit(_O$1.LocalCandidate,{candidate:t$,direction:e$.direction})}}unbindConnectionEvents(e$){e$.onConnectionStateChange=void 0,e$.onICEConnectionStateChange=void 0,e$.onICETransportStateChange=void 0,e$.onDTLSTransportStateChange=void 0,e$.onDTLSTransportError=void 0,e$.onFirstAudioDecoded=void 0,e$.onFirstAudioReceived=void 0,e$.onFirstVideoDecoded=void 0,e$.onFirstVideoReceived=void 0,e$.onSelectedLocalCandidateChanged=void 0,e$.onSelectedRemoteCandidateChanged=void 0,e$.onFirstVideoDecodedTimeout=void 0,e$.onLocalCandidate=void 0}async handleDisconnect(e$){const t$=e$===Mw$1.SEND_ONLY?this.sendConnection:this.recvConnection;t$&&!t$.isInRestartIce&&(t$.isInRestartIce=!0,fb$1.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t$.name,"] start use restartICE")),e$===Mw$1.SEND_ONLY?this.restartICE(e$):Zy$1(this,_O$1.RequestP2PRestartICE,{direction:Mw$1.SEND_ONLY}))}filterTobeMutedTracks(e$){const t$=[];if(this.getAllTracks().indexOf(e$)===-1)return t$;const r$=this.localTrackMap.get(hO$1.LocalAudioTrack);if(e$ instanceof TM$1&&(r$==null?void 0:r$.track)instanceof RM$1)return r$.track.isActive||t$.push([hO$1.LocalAudioTrack,r$]),t$;const n$=Array.from(this.localTrackMap.entries()).find(i$=>{let[,{track:o$}]=i$;return e$===o$});if(n$&&(t$.push(n$),n$[0]===hO$1.LocalVideoTrack)){const i$=this.localTrackMap.get(hO$1.LocalVideoLowTrack);i$&&t$.push([hO$1.LocalVideoLowTrack,i$])}return t$}filterTobeUnmutedTracks(e$){const t$=[],r$=this.localTrackMap.get(hO$1.LocalAudioTrack);if(e$ instanceof TM$1&&(r$==null?void 0:r$.track)instanceof RM$1)return r$.track.isActive&&t$.push([hO$1.LocalAudioTrack,r$]),t$;const n$=Array.from(this.localTrackMap.entries()).find(i$=>{let[,{track:o$}]=i$;return e$===o$});if(n$)if(n$[0]===hO$1.LocalVideoTrack){t$.push(n$);const i$=this.localTrackMap.get(hO$1.LocalVideoLowTrack);i$&&t$.push([hO$1.LocalVideoLowTrack,i$])}else t$.push(n$);return t$}createMuteMessage(e$){return e$.map(t$=>{var r$;let n$,[i$,{track:o$,ssrcs:s$,id:a$}]=t$;switch(i$){case hO$1.LocalAudioTrack:n$=Zw$1.Audio;break;case hO$1.LocalVideoTrack:n$=Dn$1(r$=o$._hints).call(r$,mL$1.SCREEN_TRACK)?Zw$1.Screen:Zw$1.High;break;case hO$1.LocalVideoLowTrack:n$=Zw$1.Low}return{stream_type:n$,ssrcs:s$,mid:a$}})}createUnmuteMessage(e$){return e$.map(t$=>{var r$;let n$,[i$,{track:o$,ssrcs:s$,id:a$}]=t$;switch(i$){case hO$1.LocalAudioTrack:n$=Zw$1.Audio;break;case hO$1.LocalVideoTrack:n$=Dn$1(r$=o$._hints).call(r$,mL$1.SCREEN_TRACK)?Zw$1.Screen:Zw$1.High;break;case hO$1.LocalVideoLowTrack:n$=Zw$1.Low}return{stream_type:n$,ssrcs:s$,mid:a$}})}filterTobeUnSubscribedTracks(e$,t$){const r$=[],n$=this.remoteUserMap.get(e$);if(!n$)return r$;if(t$){const i$=n$.get(t$);if(!i$)return r$;r$.push([e$,{kind:t$,id:i$}])}else Array.from(n$.entries()).forEach(i$=>{let[o$,s$]=i$;r$.push([e$,{kind:o$,id:s$}])});return r$}createUnsubscribeMessage(e$){const t$=[];return e$.forEach(r$=>{let[n$,{kind:i$,id:o$}]=r$;switch(i$){case dO$1.VIDEO:return void(n$._videoSSRC&&t$.push({stream_type:dO$1.VIDEO,ssrcId:n$._videoSSRC}));case dO$1.AUDIO:return void(n$._audioSSRC&&t$.push({stream_type:dO$1.AUDIO,ssrcId:n$._audioSSRC}))}}),t$}withdrawRemoteTracks(e$){e$.forEach(t$=>{let[r$,{kind:n$}]=t$;const i$=this.remoteUserMap.get(r$);i$&&(i$.delete(n$),Array.from(i$.entries()).length===0&&this.remoteUserMap.delete(r$))})}async updateBitrateLimit(e$){const t$=this.localTrackMap.get(hO$1.LocalVideoTrack),r$=this.localTrackMap.get(hO$1.LocalVideoLowTrack);t$&&await t$.track.setBitrateLimit(e$.uplink),r$&&e$.low_stream_uplink&&await r$.track.setBitrateLimit({max_bitrate:e$.low_stream_uplink.bitrate,min_bitrate:e$.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e$=this.sendConnection.peerConnectionState,t$=this.recvConnection.peerConnectionState;return e$!=="connected"&&t$!=="connected"}return!0}async tryToUnmuteAudio(e$){for(let t$=0;t$<e$.length;t$++)if(e$[t$]instanceof TM$1){const r$=this.filterTobeUnmutedTracks(e$[t$]);if(r$.length===0)continue;const n$=this.createUnmuteMessage(r$);return void await $y$1(this,_O$1.RequestUnmuteLocal,n$)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e$=>this.getStats(e$),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e$=>{let[,{ssrcs:t$}]=e$;return!!t$}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e$=>{var t$;return!((t$=this.recvConnection)===null||t$===void 0||!t$.getRemoteVideoIsReady(e$))},this.statsUploader.requestUpload=(e$,t$)=>this.emit(_O$1.RequestUpload,e$,t$),this.statsUploader.requestUploadStats=e$=>this.emit(_O$1.RequestUploadStats,e$),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await mA$1(LA$1(this.dtlsFailedCount,PA$1)),this.emit(_O$1.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(hO$1.LocalVideoTrack)||this.pendingLocalTracks.some(e$=>e$ instanceof aU$1)}throwIfTrackTypeNotMatch(e$){if(e$.filter(t$=>t$ instanceof aU$1).length>1)throw new Cy$1(Ry$1.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e$.filter(t$=>t$ instanceof TM$1).length>1&&(e$.some(t$=>t$ instanceof TM$1&&t$._bypassWebAudio)||!ZP$1().webAudioMediaStreamDest))throw new Cy$1(Ry$1.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t$ of e$){if(t$ instanceof aU$1&&this.pendingLocalTracks.some(r$=>r$ instanceof aU$1))throw new Cy$1(Ry$1.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t$ instanceof TM$1&&this.pendingLocalTracks.some(r$=>r$ instanceof TM$1)&&(!ZP$1().webAudioMediaStreamDest||t$._bypassWebAudio||this.pendingLocalTracks.some(r$=>r$ instanceof TM$1&&r$._bypassWebAudio)))throw new Cy$1(Ry$1.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e$,t$){const r$=!XA$1("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP$1().supportDualStreamEncoding,n$=AF$1(AF$1({},{width:160,height:120,framerate:15,bitrate:50}),t$);let i$;i$=r$?e$._mediaStreamTrack.clone():KV$1(e$,n$);const o$=TA$1(8,"track-low-"),s$=new aU$1(i$,AF$1(AF$1({},r$&&{scaleResolutionDownBy:iN$1(n$,e$)}),{},{frameRate:n$.framerate,bitrateMax:n$.bitrate,bitrateMin:n$.bitrate}),void 0,void 0,o$);return s$.on(RL$1.TRANSCEIVER_UPDATED,a$=>{e$._updateRtpTransceiver(a$,TL$1.LOW_STREAM)}),s$._hints.push(mL$1.LOW_STREAM),e$.addListener(fL$1.NEED_CLOSE,()=>{s$.close()}),s$}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e$,t$,r$,n$){var i$;const o$=Array.from(d_$1(i$=this.remoteUserMap).call(i$)).find(s$=>s$._videoSSRC===e$);if(o$){n$||this.store.subscribe(o$.uid,"video",void 0,void 0,void 0,void 0,Date.now());const s$=this.store.keyMetrics,a$=s$.subscribe.find(c$=>c$.userId===o$.uid&&c$.type==="video");vb$1.firstRemoteVideoDecode(this.store.sessionId,gb$1.FIRST_VIDEO_DECODE,Rb$1.FIRST_VIDEO_DECODE,{peer:o$._uintid,videowidth:t$,videoheight:r$,subscribeElapse:rV$1.measureFromSubscribeStart(this.store.clientId,e$),subscribeRequestid:e$,p2pid:this.store.p2pId,apEnd:s$.requestAPEnd||0,apStart:s$.requestAPStart||0,joinGwEnd:s$.joinGatewayEnd||0,joinGwStart:s$.joinGatewayStart||0,pcEnd:s$.peerConnectionEnd||0,pcStart:s$.peerConnectionStart||0,subscriberEnd:(a$==null?void 0:a$.subscribeEnd)||0,subscriberStart:(a$==null?void 0:a$.subscribeStart)||0,videoAddNotify:(a$==null?void 0:a$.streamAdded)||0,state:n$?1:0})}}async remoteMediaSsrcChanged(e$,t$,r$){if(!this.recvConnection)return!1;const n$=this.remoteUserMap.get(e$);if(!n$)return!1;const i$=n$.get(t$);if(!i$)return!1;const o$=await this.recvConnection.getRemoteSSRC(i$);return o$!==void 0&&o$!==r$}isPreSubScribe(e$){return!1}async publishDataChannel(e$){throw new Cy$1(Ry$1.NOT_SUPPORTED)}async unpublishDataChannel(e$){throw new Cy$1(Ry$1.NOT_SUPPORTED)}async subscribeDataChannel(e$,t$){throw new Cy$1(Ry$1.NOT_SUPPORTED)}async unsubscribeDataChannel(e$,t$){throw new Cy$1(Ry$1.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e$,t$){throw new Cy$1(Ry$1.NOT_SUPPORTED)}setPendingRemoteDataChannel(e$,t$){throw new Cy$1(Ry$1.NOT_SUPPORTED)}async preConnect(e$){throw new Cy$1(Ry$1.NOT_SUPPORTED)}getEstablishParams(){throw new Cy$1(Ry$1.NOT_SUPPORTED)}async reSubscribe(e$){throw new Cy$1(Ry$1.NOT_SUPPORTED)}async updateVideoStreamParameter(e$,t$){throw new Cy$1(Ry$1.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e$=>{let[t$,{track:r$}]=e$;t$===hO$1.LocalVideoLowTrack?r$._updateRtpTransceiver(void 0,TL$1.LOW_STREAM):r$._updateRtpTransceiver(void 0)})}},Cw$1(vF$1.prototype,"p2pConnect",[pF$1],Object.getOwnPropertyDescriptor(vF$1.prototype,"p2pConnect"),vF$1.prototype),Cw$1(vF$1.prototype,"unpublish",[_F$1],Object.getOwnPropertyDescriptor(vF$1.prototype,"unpublish"),vF$1.prototype),Cw$1(vF$1.prototype,"unpublishLowStream",[EF$1],Object.getOwnPropertyDescriptor(vF$1.prototype,"unpublishLowStream"),vF$1.prototype),Cw$1(vF$1.prototype,"subscribe",[fF$1],Object.getOwnPropertyDescriptor(vF$1.prototype,"subscribe"),vF$1.prototype),Cw$1(vF$1.prototype,"mockSubscribe",[mF$1],Object.getOwnPropertyDescriptor(vF$1.prototype,"mockSubscribe"),vF$1.prototype),Cw$1(vF$1.prototype,"unsubscribe",[TF$1],Object.getOwnPropertyDescriptor(vF$1.prototype,"unsubscribe"),vF$1.prototype),Cw$1(vF$1.prototype,"muteRemote",[SF$1],Object.getOwnPropertyDescriptor(vF$1.prototype,"muteRemote"),vF$1.prototype),Cw$1(vF$1.prototype,"unmuteRemote",[gF$1],Object.getOwnPropertyDescriptor(vF$1.prototype,"unmuteRemote"),vF$1.prototype),Cw$1(vF$1.prototype,"hasRemoteMediaWithLock",[RF$1],Object.getOwnPropertyDescriptor(vF$1.prototype,"hasRemoteMediaWithLock"),vF$1.prototype),Cw$1(vF$1.prototype,"disconnectForReconnect",[CF$1],Object.getOwnPropertyDescriptor(vF$1.prototype,"disconnectForReconnect"),vF$1.prototype),Cw$1(vF$1.prototype,"remoteMediaSsrcChanged",[IF$1],Object.getOwnPropertyDescriptor(vF$1.prototype,"remoteMediaSsrcChanged"),vF$1.prototype),vF$1);function wF$1(e$){return function(t$,r$,n$){const i$=t$[r$];if(typeof i$!="function")throw new Error("Cannot use mutex on object property.");return n$.value=async function(){for(var o$=arguments.length,s$=new Array(o$),a$=0;a$<o$;a$++)s$[a$]=arguments[a$];switch(e$){case dF$1.SEND_ONLY:{const c$=await this.sendMutex.lock("From P2PChannel2.".concat(r$));try{return await i$.apply(this,s$)}finally{c$()}}case dF$1.RECEIVE_ONLY:{const c$=await this.recvMutex.lock("From P2PChannel2.".concat(r$));try{return await i$.apply(this,s$)}finally{c$()}}default:{const c$=await this.sendMutex.lock("From P2PChannel2.".concat(r$)),u$=await this.recvMutex.lock("From P2PChannel2.".concat(r$));try{return await i$.apply(this,s$)}finally{c$(),u$()}}}},n$}}function OF$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function NF$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?OF$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):OF$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}let DF$1=class m5{constructor(t$){Fg$1(this,"store",void 0),Fg$1(this,"onStatsException",void 0),Fg$1(this,"onUploadPublishDuration",void 0),Fg$1(this,"onStatsChanged",void 0),Fg$1(this,"localStats",new Map),Fg$1(this,"remoteStats",new Map),Fg$1(this,"updateStatsInterval",void 0),Fg$1(this,"trafficStats",void 0),Fg$1(this,"trafficStatsPeerList",[]),Fg$1(this,"uplinkStats",void 0),Fg$1(this,"exceptionMonitor",void 0),Fg$1(this,"p2pChannel",void 0),Fg$1(this,"scalabilityMode",Iw$1.L1T1),Fg$1(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t$,this.exceptionMonitor=new iV$1,this.exceptionMonitor.on("exception",(r$,n$,i$)=>{this.onStatsException&&this.onStatsException(r$,n$,i$)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(hO$1.LocalAudioTrack)||NF$1({},AL$1)}getLocalVideoTrackStats(){return this.localStats.get(hO$1.LocalVideoTrack)||NF$1({},bL$1)}getRemoteAudioTrackStats(t$){const r$=(o$,s$)=>{if(!this.trafficStats)return s$;const a$=this.trafficStats.peer_delay.find(c$=>c$.peer_uid===o$);return a$&&(s$.publishDuration=a$.B_ppad+(Date.now()-this.trafficStats.timestamp)),s$},n$={};if(t$){var i$;const o$=(i$=this.remoteStats.get(t$))===null||i$===void 0?void 0:i$.audioStats;o$&&(n$[t$]=r$(t$,o$))}else Array.from(this.remoteStats.entries()).forEach(o$=>{let[s$,{audioStats:a$}]=o$;a$&&(n$[s$]=r$(s$,a$))});return n$}getRemoteNetworkQualityStats(t$){const r$={};if(t$){var n$;const i$=(n$=this.remoteStats.get(t$))===null||n$===void 0?void 0:n$.networkStats;i$&&(r$[t$]=i$)}else Array.from(this.remoteStats.entries()).forEach(i$=>{let[o$,{networkStats:s$}]=i$;s$&&(r$[o$]=s$)});return r$}getRemoteVideoTrackStats(t$){const r$=(o$,s$)=>{if(!this.trafficStats)return s$;const a$=this.trafficStats.peer_delay.find(c$=>c$.peer_uid===o$);return a$&&(s$.publishDuration=a$.B_ppvd+(Date.now()-this.trafficStats.timestamp)),s$},n$={};if(t$){var i$;const o$=(i$=this.remoteStats.get(t$))===null||i$===void 0?void 0:i$.videoStats;o$&&(n$[t$]=r$(t$,o$))}else Array.from(this.remoteStats.entries()).forEach(o$=>{let[s$,{videoStats:a$}]=o$;a$&&(n$[s$]=r$(s$,a$))});return n$}getRTCStats(){let t$=0,r$=0,n$=0,i$=0;const o$=this.localStats.get(hO$1.LocalAudioTrack);o$&&(t$+=o$.sendBytes,r$+=o$.sendBitrate);const s$=this.localStats.get(hO$1.LocalVideoTrack);s$&&(t$+=s$.sendBytes,r$+=s$.sendBitrate);const a$=this.localStats.get(hO$1.LocalVideoLowTrack);a$&&(t$+=a$.sendBytes,r$+=a$.sendBitrate),this.remoteStats.forEach(u$=>{let{audioStats:l$,videoStats:d$}=u$;l$&&(n$+=l$.receiveBytes,i$+=l$.receiveBitrate),d$&&(n$+=d$.receiveBytes,i$+=d$.receiveBitrate)});let c$=1;return this.trafficStats&&(c$+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:c$,SendBitrate:r$,SendBytes:t$,RecvBytes:n$,RecvBitrate:i$,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t$){this.localStats.set(t$,void 0)}removeLocalStats(t$){t$?this.localStats.delete(t$):this.localStats.clear()}addRemoteStats(t$){this.remoteStats.set(t$,{})}removeRemoteStats(t$){t$?this.remoteStats.delete(t$):this.remoteStats.clear()}addP2PChannel(t$){this.p2pChannel=t$}updateTrafficStats(t$){t$.peer_delay=t$.peer_delay.filter(r$=>r$.B_ppad!==void 0||r$.B_ppvd!==void 0),t$.peer_delay.filter(r$=>this.trafficStatsPeerList.indexOf(r$.peer_uid)===-1).forEach(r$=>{var n$;const i$=(n$=this.p2pChannel)===null||n$===void 0?void 0:n$.getRemoteMedia(r$.peer_uid),o$=i$!=null&&i$.videoSSRC?rV$1.measureFromSubscribeStart(this.store.clientId,i$.videoSSRC):0,s$=i$!=null&&i$.audioSSRC?rV$1.measureFromSubscribeStart(this.store.clientId,i$.audioSSRC):0;r$.B_ppad!==void 0&&r$.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r$.peer_uid,r$.B_ppad,r$.B_ppvd,o$>s$?o$:s$),this.trafficStatsPeerList.push(r$.peer_uid))}),this.trafficStats=t$}updateUplinkStats(t$){this.uplinkStats&&this.uplinkStats.B_fir!==t$.B_fir&&fb$1.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t$.B_fir)),this.uplinkStats=t$}static isRemoteVideoFreeze(t$,r$,n$){if(!t$)return!1;const i$=!!n$&&r$.framesDecodeFreezeTime>n$.framesDecodeFreezeTime,o$=!n$||r$.framesDecodeCount>n$.framesDecodeCount;return i$||!o$}static isRemoteAudioFreeze(t$){return!!t$&&t$._isFreeze()}isLocalVideoFreeze(t$){return!(!t$.inputFrame||!t$.sentFrame)&&t$.inputFrame.frameRate>5&&t$.sentFrame.frameRate<3}updateLocalStats(t$){Array.from(this.localStats.entries()).forEach(r$=>{let[n$,i$]=r$;switch(n$){case hO$1.LocalVideoTrack:case hO$1.LocalVideoLowTrack:{const s$=i$,a$=NF$1({},bL$1),c$=t$.getStats(),u$=t$.getLocalMedia(n$);if(c$){const l$=c$.videoSend.find(d$=>d$.ssrc===(u$==null?void 0:u$.ssrcs[0].ssrcId));if(l$){const d$=t$.getLocalVideoSize(),h$=t$.getEncoderConfig(hO$1.LocalVideoTrack);l$.codec!=="H264"&&l$.codec!=="H265"&&l$.codec!=="VP8"&&l$.codec!=="VP9"&&l$.codec!=="AV1X"&&l$.codec!=="AV1"||(a$.codecType=l$.codec),a$.sendBytes=l$.bytes,a$.sendBitrate=s$?8*Math.max(0,a$.sendBytes-s$.sendBytes):0,l$.inputFrame?(a$.captureFrameRate=l$.inputFrame.frameRate,a$.captureResolutionHeight=l$.inputFrame.height,a$.captureResolutionWidth=l$.inputFrame.width):d$&&(a$.captureResolutionWidth=d$.width,a$.captureResolutionHeight=d$.height),l$.sentFrame?(a$.sendFrameRate=l$.sentFrame.frameRate,a$.sendResolutionHeight=l$.sentFrame.height,a$.sendResolutionWidth=l$.sentFrame.width):d$&&(a$.sendResolutionWidth=d$.width,a$.sendResolutionHeight=d$.height),l$.avgEncodeMs&&(a$.encodeDelay=l$.avgEncodeMs),h$&&h$.bitrateMax&&(a$.targetSendBitrate=1e3*h$.bitrateMax),a$.sendPackets=l$.packets,a$.sendPacketsLost=l$.packetsLost,a$.sendJitterMs=l$.jitterMs,a$.sendRttMs=l$.rttMs,a$.totalDuration=s$?s$.totalDuration+1:1,a$.totalFreezeTime=s$?s$.totalFreezeTime:0,this.isLocalVideoFreeze(l$)&&(a$.totalFreezeTime+=1),l$.scalabilityMode&&this.scalabilityMode!==l$.scalabilityMode&&(fb$1.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(l$.scalabilityMode)),this.scalabilityMode=l$.scalabilityMode)}this.trafficStats&&(a$.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o$;this.localStats.set(n$,a$),((s$==null?void 0:s$.sendResolutionWidth)!==a$.sendResolutionWidth||(s$==null?void 0:s$.sendResolutionHeight)!==a$.sendResolutionHeight)&&((o$=this.onStatsChanged)===null||o$===void 0||o$.call(this,"resolution",{width:a$.sendResolutionWidth,height:a$.sendResolutionHeight})),a$&&u$&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,u$.track,a$);break}case hO$1.LocalAudioTrack:{const s$=i$,a$=NF$1({},AL$1),c$=t$.getStats(),u$=t$.getLocalMedia(n$);if(c$){const l$=c$.audioSend.find(d$=>d$.ssrc===(u$==null?void 0:u$.ssrcs[0].ssrcId));if(l$){if(l$.codec!=="opus"&&l$.codec!=="aac"&&l$.codec!=="PCMU"&&l$.codec!=="PCMA"&&l$.codec!=="G722"||(a$.codecType=l$.codec),l$.inputLevel)a$.sendVolumeLevel=Math.round(32767*l$.inputLevel);else{const d$=t$.getLocalAudioVolume();d$&&(a$.sendVolumeLevel=Math.round(32767*d$))}a$.sendBytes=l$.bytes,a$.sendPackets=l$.packets,a$.sendPacketsLost=l$.packetsLost,a$.sendJitterMs=l$.jitterMs,a$.sendRttMs=l$.rttMs,a$.sendBitrate=s$?8*Math.max(0,a$.sendBytes-s$.sendBytes):0}}this.trafficStats&&(a$.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(hO$1.LocalAudioTrack,a$),a$&&u$&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,u$.track,a$);break}}})}updateRemoteStats(t$){Array.from(this.remoteStats.entries()).forEach(r$=>{var n$,i$;let[o$,{videoStats:s$,audioStats:a$,videoPcStats:c$}]=r$;const u$=a$,l$=s$,d$=c$,h$=NF$1({},wL$1),p$=NF$1({},NL$1),_$=NF$1({},OL$1),{audioTrack:f$,videoTrack:m$,audioSSRC:g$,videoSSRC:v$}=t$.getRemoteMedia(o$);let y$;y$=t$ instanceof bF$1?t$.getStats(!0):t$.getStats();const S$=(n$=y$)===null||n$===void 0?void 0:n$.audioRecv.find(C$=>C$.ssrc===g$),b$=(i$=y$)===null||i$===void 0?void 0:i$.videoRecv.find(C$=>C$.ssrc===v$),$$=this.trafficStats&&this.trafficStats.peer_delay.find(C$=>C$.peer_uid===o$);if(S$&&(S$.codec!=="opus"&&S$.codec!=="aac"&&S$.codec!=="PCMU"&&S$.codec!=="PCMA"&&S$.codec!=="G722"||(h$.codecType=S$.codec),S$.outputLevel?h$.receiveLevel=Math.round(32767*S$.outputLevel):f$&&(h$.receiveLevel=Math.round(32767*f$.getVolumeLevel())),h$.receiveBytes=S$.bytes,h$.receivePackets=S$.packets,h$.receivePacketsLost=S$.packetsLost,h$.receivePacketsDiscarded=S$.packetsDiscarded,h$.packetLossRate=h$.receivePacketsLost/(h$.receivePackets+h$.receivePacketsLost),h$.receiveBitrate=u$?8*Math.max(0,h$.receiveBytes-u$.receiveBytes):0,h$.totalDuration=u$?u$.totalDuration+1:1,h$.totalFreezeTime=u$?u$.totalFreezeTime:0,h$.freezeRate=h$.totalFreezeTime/h$.totalDuration,h$.receiveDelay=S$.jitterBufferMs,h$.totalDuration>10&&m5.isRemoteAudioFreeze(f$)&&(h$.totalFreezeTime+=1)),b$){b$.codec!=="H264"&&b$.codec!=="H265"&&b$.codec!=="VP8"&&b$.codec!=="VP9"&&b$.codec!=="AV1X"&&b$.codec!=="AV1"||(p$.codecType=b$.codec),p$.receiveBytes=b$.bytes,p$.receiveBitrate=l$?8*Math.max(0,p$.receiveBytes-l$.receiveBytes):0,p$.decodeFrameRate=b$.decodeFrameRate<0?0:b$.decodeFrameRate,p$.renderFrameRate=b$.decodeFrameRate<0?0:b$.decodeFrameRate,b$.outputFrame&&(p$.renderFrameRate=b$.outputFrame.frameRate),b$.receivedFrame?(p$.receiveFrameRate=b$.receivedFrame.frameRate,p$.receiveResolutionHeight=b$.receivedFrame.height,p$.receiveResolutionWidth=b$.receivedFrame.width):m$&&(p$.receiveResolutionHeight=m$._videoHeight||0,p$.receiveResolutionWidth=m$._videoWidth||0),b$.framesRateFirefox!==void 0&&(p$.receiveFrameRate=Math.round(b$.framesRateFirefox)),p$.receivePackets=b$.packets,p$.receivePacketsLost=b$.packetsLost,p$.packetLossRate=p$.receivePacketsLost/(p$.receivePackets+p$.receivePacketsLost),p$.totalDuration=l$?l$.totalDuration+1:1,p$.totalFreezeTime=l$?l$.totalFreezeTime:0,p$.receiveDelay=b$.jitterBufferMs||0;const C$=!!v$&&t$.getRemoteVideoIsReady(v$);m$&&C$&&m5.isRemoteVideoFreeze(m$,b$,d$)&&(p$.totalFreezeTime+=1),p$.freezeRate=p$.totalFreezeTime/p$.totalDuration}$$&&(h$.end2EndDelay=$$.B_ad,p$.end2EndDelay=$$.B_vd,h$.transportDelay=$$.B_ed,p$.transportDelay=$$.B_ed,h$.currentPacketLossRate=$$.B_ealr4/100,p$.currentPacketLossRate=$$.B_evlr4/100,_$.uplinkNetworkQuality=$$.B_punq?$$.B_punq:0,_$.downlinkNetworkQuality=$$.B_pdnq?$$.B_pdnq:0),this.remoteStats.set(o$,{audioStats:h$,videoStats:p$,videoPcStats:b$,networkStats:_$}),f$&&this.exceptionMonitor.setRemoteAudioStats(f$,h$),m$&&this.exceptionMonitor.setRemoteVideoStats(m$,p$)})}},PF$1=class{constructor(){Fg$1(this,"destChannelMediaInfos",new Map),Fg$1(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t$){qw$1(t$),this.srcChannelMediaInfo=t$}addDestChannelInfo(t$){qw$1(t$),this.destChannelMediaInfos.set(t$.channelName,t$)}removeDestChannelInfo(t$){xw$1(t$),this.destChannelMediaInfos.delete(t$)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}};function LF$1(e$){if(!(e$ instanceof PF$1))return new yb$1(Ry$1.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t$=e$.getSrcChannelMediaInfo(),r$=e$.getDestChannelMediaInfo();if(!t$)return new yb$1(Ry$1.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(r$.size===0)return new yb$1(Ry$1.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}function kF$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function MF$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?kF$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):kF$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var UF$1;function xF$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function VF$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?xF$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):xF$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}let FF$1=(UF$1=class d5 extends cO$1{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t$=>t$.rtpMap&&t$.rtpMap.encodingName.toLowerCase()||"").filter(t$=>{var r$;return Dn$1(r$=Object.keys(eb$1)).call(r$,t$)}))]}constructor(t$,r$){super(t$,r$),Fg$1(this,"store",void 0),Fg$1(this,"peerConnection",void 0),Fg$1(this,"remoteSDP",void 0),Fg$1(this,"initialOffer",void 0),Fg$1(this,"statsFilter",void 0),Fg$1(this,"useRTX",!1),Fg$1(this,"localCapabilities",void 0),Fg$1(this,"localCandidateCount",0),Fg$1(this,"allCandidatesReceived",!1),Fg$1(this,"establishPromise",void 0),Fg$1(this,"mutex",new NA$1("P2PConnection-mutex")),this.store=r$,this.peerConnection=new RTCPeerConnection(d5.resolvePCConfiguration(t$),{optional:[{googDscp:!0}]}),this.statsFilter=xV$1(this.peerConnection,XA$1("STATS_UPDATE_INTERVAL"),void 0,Zv$1()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t$=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t$.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r$=HU$1(t$.sdp),n$=WU$1(t$.sdp,{filterRTX:!this.useRTX,filterVideoFec:XA$1("FILTER_VIDEO_FEC"),filterAudioFec:XA$1("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n$,this.initialOffer=t$,VF$1(VF$1({},r$),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n$},offerSDP:t$.sdp})}catch(t$){throw new Cy$1(Ry$1.GET_LOCAL_CONNECTION_PARAMS_FAILED,t$.toString())}}async updateRemoteConnect(){}async connect(t$){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(n$){Fg$1(this,"sessionDesc",void 0),Fg$1(this,"localCapabilities",void 0),Fg$1(this,"rtpCapabilities",void 0),Fg$1(this,"candidates",void 0),Fg$1(this,"iceParameters",void 0),Fg$1(this,"dtlsParameters",void 0),Fg$1(this,"setup",void 0),Fg$1(this,"currentMidIndex",void 0),Fg$1(this,"cname",void 0),n$=sA$1(n$);const{iceParameters:i$,dtlsParameters:o$,candidates:s$,rtpCapabilities:a$,setup:c$,localCapabilities:u$,sdkCodec:l$,cname:d$}=n$,h$=FU$1.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=a$,this.candidates=s$,this.iceParameters=i$,this.dtlsParameters=o$,this.setup=c$,this.localCapabilities=u$,this.cname=d$;for(let p$=0;p$<h$.mediaDescriptions.length;p$++){const _$=h$.mediaDescriptions[p$];if(_$.attributes.iceUfrag=i$.iceUfrag,_$.attributes.icePwd=i$.icePwd,_$.attributes.fingerprints=o$.fingerprints,_$.attributes.candidates=s$,_$.attributes.setup=c$,_$.media.mediaType==="video"){_$.media.fmts=a$.videoCodecs.map(m$=>m$.payloadType.toString(10));let f$=a$.videoCodecs.filter(m$=>{var g$,v$;return(g$=m$.rtpMap)===null||g$===void 0?void 0:Dn$1(v$=g$.encodingName.toLowerCase()).call(v$,l$)});f$.length===0&&(f$=a$.videoCodecs),_$.attributes.payloads=f$,_$.attributes.extmaps=a$.videoExtensions}_$.media.mediaType==="audio"&&(_$.media.fmts=a$.audioCodecs.map(f$=>f$.payloadType.toString(10)),_$.attributes.payloads=a$.audioCodecs,_$.attributes.extmaps=a$.audioExtensions),h$.mediaDescriptions[p$]=this.mungMediaDesc(_$)}this.sessionDesc=h$,this.currentMidIndex=h$.mediaDescriptions.length-1}toString(){return FU$1.print(this.sessionDesc)}send(n$,i$,o$){const{ssrcs:s$,ssrcGroups:a$}=zU$1(i$,this.cname),c$=this.sessionDesc.mediaDescriptions.find(d$=>n$===dO$1.VIDEO?d$.media.mediaType==="video":d$.media.mediaType==="audio"),u$=s$[0].attributes.label,l$=s$[0].attributes.mslabel;return c$.attributes.ssrcs=c$.attributes.ssrcs.concat(s$),c$.attributes.ssrcGroups=c$.attributes.ssrcGroups.concat(a$),{id:u$,mslabel:l$}}batchSend(n$){return n$.map(i$=>{let{kind:o$,ssrcMsg:s$}=i$;return this.send(o$,s$,void 0)})}stopSending(n$){this.sessionDesc.mediaDescriptions.forEach(i$=>{const o$=[],s$=[],a$=[];i$.attributes.ssrcs.forEach(c$=>{Dn$1(n$).call(n$,c$.attributes.label||"")?a$.push(c$):o$.push(c$)}),i$.attributes.ssrcGroups.forEach(c$=>{var u$;Dn$1(u$=a$.map(l$=>l$.ssrcId)).call(u$,c$.ssrcIds[0])||s$.push(c$)}),i$.attributes.ssrcs=o$,i$.attributes.ssrcGroups=s$})}mute(n$){const i$=this.sessionDesc.mediaDescriptions.find(o$=>o$.attributes.mid===n$);if(!i$)throw new Error("mediaDescription not found with ".concat(n$," in remote SDP when calling RemoteSDP.mute."));i$.attributes.direction="inactive"}unmute(n$){const i$=this.sessionDesc.mediaDescriptions.find(o$=>o$.attributes.mid===n$);if(!i$)throw new Error("mediaDescription not found with ".concat(n$," in remote SDP when calling RemoteSDP.unmute."));i$.attributes.direction="sendonly"}receive(n$,i$,o$){n$.forEach((s$,a$)=>{const c$=s$._mediaStreamTrack,u$=this.sessionDesc.mediaDescriptions.findIndex(d$=>d$.attributes.mid===c$.kind),l$=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[u$],s$);this.sessionDesc.mediaDescriptions[u$]=l$})}stopReceiving(n$){}updateCandidates(n$){n$===lO$1.TCP?this.candidates.forEach(i$=>{this.candidates.findIndex(o$=>o$.transport==="tcp"&&o$.connectionAddress===i$.connectionAddress&&o$.port===i$.port)===-1&&this.candidates.push(MF$1(MF$1({},i$),{},{foundation:"tcpcandidate",priority:Number(i$.priority)-1+"",transport:"tcp",port:Number(i$.port)+90+""}))}):this.candidates=this.candidates.filter(i$=>i$.transport!=="tcp");for(const i$ of this.sessionDesc.mediaDescriptions)i$.attributes.candidates=this.candidates}restartICE(n$){n$=sA$1(n$),this.iceParameters=n$,this.sessionDesc.mediaDescriptions.forEach(i$=>{i$.attributes.iceUfrag=n$.iceUfrag,i$.attributes.icePwd=n$.icePwd})}predictReceivingMids(n$){const i$=[];for(let o$=0;o$<n$;o$++)i$.push((this.currentMidIndex+o$+1).toString(10));return i$}mungRecvMediaDsec(n$,i$){const o$=sA$1(n$);return JU$1(o$,i$),QU$1(o$,i$),o$}updateRecvMedia(n$,i$){const o$=this.sessionDesc.mediaDescriptions.findIndex(s$=>s$.attributes.mid===n$);if(o$!==-1){const s$=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o$],i$);this.sessionDesc.mediaDescriptions[o$]=s$}}bumpMid(n$){this.currentMidIndex+=n$}updateTrackLabel(n$,i$,o$){const s$=this.sessionDesc.mediaDescriptions.find(c$=>n$===dO$1.VIDEO?c$.attributes.mid==="video":c$.attributes.mid==="audio");if(s$){const c$=s$.attributes.ssrcs.find(u$=>u$.attributes.label===i$);var a$;c$&&(c$.attributes.label=o$,(a$=c$.attributes.msid)===null||a$===void 0||a$.replace(i$,o$))}}mungMediaDesc(n$){const i$=sA$1(n$);return XU$1(i$),function(o$){const s$=o$.attributes.extmaps.find(a$=>a$.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");s$&&o$.attributes.extmaps.splice(o$.attributes.extmaps.indexOf(s$),1),o$.attributes.payloads.forEach(a$=>{const c$=a$.rtcpFeedbacks.findIndex(u$=>u$.type==="transport-cc");c$!==-1&&a$.rtcpFeedbacks.splice(c$,1)})}(i$),i$}getSSRC(n$){for(const i$ of this.sessionDesc.mediaDescriptions)for(const o$ of i$.attributes.ssrcs)if(o$.attributes.label===n$)return[o$]}}(VF$1(VF$1({},t$),{},{rtpCapabilities:t$.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const r$=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r$})}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r$.toString()))}}async updateRemoteRTPCapabilities(t$,r$){throw new Cy$1(Ry$1.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t$){}send(t$,r$){var n$=this;return YI$1(function*(){const i$=yield qI$1(n$.mutex.lock());try{if(!n$.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o$=t$.map(h$=>n$.peerConnection.addTrack(h$._mediaStreamTrack)),s$=yield qI$1(n$.peerConnection.createOffer()),a$=FU$1.parse(s$.sdp),c$=t$.map(h$=>{const p$=h$._mediaStreamTrack,_$=a$.mediaDescriptions.find(f$=>f$.attributes.mid===p$.kind);if(!_$)throw new Error("Cannot extract ssrc from mediaDescription.");return function(f$,m$,g$){const v$=f$.attributes.ssrcs.filter(S$=>S$.attributes.label===m$),y$=f$.attributes.ssrcGroups;if(v$.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(y$&&v$.length>1){const S$=y$.find(b$=>b$.ssrcIds.indexOf(v$[0].ssrcId)!==-1);return S$?[{ssrcId:S$.ssrcIds[0],rtx:g$?S$.ssrcIds[1]:void 0}]:[{ssrcId:v$[0].ssrcId}]}return[{ssrcId:v$[0].ssrcId}]}(_$,p$.id,n$.useRTX)});let u$;try{u$=yield c$}catch(h$){throw o$.forEach(p$=>{Xv$1()&&p$.replaceTrack(null),n$.peerConnection.removeTrack(p$)}),h$}const l$=n$.mungSendOfferSDP(s$.sdp,t$);n$.remoteSDP.receive(t$,r$,u$);const d$=n$.remoteSDP.toString();return yield qI$1(n$.peerConnection.setLocalDescription({type:"offer",sdp:l$})),yield qI$1(n$.applySendEncodings(o$,t$)),yield qI$1(n$.peerConnection.setRemoteDescription({type:"answer",sdp:d$})),t$.map((h$,p$)=>{const _$=h$._mediaStreamTrack.id;return{localSSRC:c$[p$],id:_$}})}catch(o$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o$.toString()))}finally{i$()}})()}async stopSending(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r$=this.peerConnection.getSenders().filter(o$=>{var s$;return t$.indexOf(((s$=o$.track)===null||s$===void 0?void 0:s$.id)||"")!==-1});if(r$.length!==t$.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r$.map(o$=>{Xv$1()&&o$.replaceTrack(null),this.peerConnection.removeTrack(o$)});const n$=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n$),this.remoteSDP.stopReceiving(t$);const i$=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i$})}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r$.toString()))}}async receive(t$,r$,n$,i$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t$," before remoteSDP created."));const{id:o$,mslabel:s$}=this.remoteSDP.send(t$,r$,i$),a$=new Gh$1((l$,d$)=>{const h$=setTimeout(()=>{d$(new Error("Cannot receive track, id: ".concat(o$)))},1e4),p$=_$=>{const f$=Hv$1();if((f$.name==="Safari"&&Number(f$.version)===11||$v$1())&&_$.track.id!==o$&&_$.streams[0].id===s$){var m$;const g$=_$.streams[0].getTracks()[0];return(m$=this.remoteSDP)===null||m$===void 0||m$.updateTrackLabel(t$,o$,_$.track.id),this.peerConnection.removeEventListener("track",p$),clearTimeout(h$),void l$(g$)}if(_$.track.id===o$)return this.peerConnection.removeEventListener("track",p$),clearTimeout(h$),void l$(_$.track)};this.peerConnection.addEventListener("track",p$)}),c$=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c$});const u$=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(u$),{track:await a$,id:o$}}catch(o$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o$.toString()))}}async stopReceiving(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t$);const r$=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r$});const n$=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n$)}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r$.toString()))}}async muteRemote(t$){}async unmuteRemote(t$){}async muteLocal(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r$=this.peerConnection.getSenders().filter(n$=>{var i$;return t$.indexOf(((i$=n$.track)===null||i$===void 0?void 0:i$.id)||"")!==-1});if(r$.length!==t$.length)throw new Error("sender' length doesn't match mids' length.");r$.map(n$=>{if(Xv$1()&&n$.track)n$.track.enabled=!1;else{const i$=n$.getParameters();i$.encodings.forEach(o$=>o$.active=!1),n$.setParameters(i$)}})}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r$.toString()))}}async unmuteLocal(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r$=this.peerConnection.getSenders().filter(o$=>{var s$;return t$.indexOf(((s$=o$.track)===null||s$===void 0?void 0:s$.id)||"")!==-1});if(r$.length!==t$.length)throw new Error("Senders' length doesn't match mids' length.");r$.map(async o$=>{if(Xv$1()&&o$.track)o$.track.enabled=!0;else{const s$=o$.getParameters();s$.encodings.forEach(a$=>a$.active=!0),await o$.setParameters(s$)}});const n$=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n$);const i$=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i$})}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r$.toString()))}}restartICE(t$){var r$=this;return YI$1(function*(){const n$=yield qI$1(r$.mutex.lock("From P2PConnection.restartICE"));try{if(!r$.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ZP$1().supportPCSetConfiguration){const c$=r$.peerConnection.getConfiguration(),u$=t$===lO$1.RELAY?"relay":"all";c$.iceTransportPolicy!==u$&&(fb$1.debug("[".concat(r$.store.clientId,"] restartICE change iceTransportPolicy from [").concat(c$.iceTransportPolicy,"] to [").concat(u$,"]")),c$.iceTransportPolicy=u$,r$.peerConnection.setConfiguration(c$))}else if(t$===lO$1.RELAY)return;t$!==lO$1.RELAY&&r$.remoteSDP.updateCandidates(t$);const i$=yield qI$1(r$.peerConnection.createOffer({iceRestart:!0}));if(!i$.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o$=HU$1(i$.sdp),{remoteIceParameters:s$}=yield o$.iceParameters;r$.remoteSDP.restartICE(s$);const a$=r$.remoteSDP.toString();yield qI$1(r$.peerConnection.setLocalDescription(i$)),yield qI$1(r$.peerConnection.setRemoteDescription({type:"answer",sdp:a$}))}catch(i$){fb$1.warning("[".concat(r$.store.clientId,"] restart ICE failed, abort operation"),i$)}finally{n$()}})()}close(){var t$;this.peerConnection.close(),(t$=this.onConnectionStateChange)===null||t$===void 0||t$.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t$){return this.statsFilter.getVideoIsReady(t$)}async updateEncoderConfig(t$,r$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n$=await this.peerConnection.createOffer(),i$=this.mungSendOfferSDP(n$.sdp,[r$]);this.remoteSDP.updateRecvMedia(r$._mediaStreamTrack.kind,r$);const o$=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i$}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o$})}catch(n$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,n$.toString())}}async updateSendParameters(t$,r$){const n$=this.peerConnection.getSenders().filter(i$=>{var o$;return((o$=i$.track)===null||o$===void 0?void 0:o$.id)===t$});n$.length===1&&await this.applySendEncodings(n$,[r$])}setStatsRemoteVideoIsReady(t$,r$){this.statsFilter.setVideoIsReady2(t$,r$)}async replaceTrack(t$,r$){const n$=this.peerConnection.getSenders().find(i$=>{var o$;return((o$=i$.track)===null||o$===void 0?void 0:o$.id)===r$});n$&&await n$.replaceTrack(t$._mediaStreamTrack)}createDataChannels(t$,r$){throw new Cy$1(Ry$1.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t$){throw new Cy$1(Ry$1.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t$;(t$=this.onICEConnectionStateChange)===null||t$===void 0||t$.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t$;(t$=this.onConnectionStateChange)===null||t$===void 0||t$.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t$=>{t$.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,fb$1.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,fb$1.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},XA$1("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t$){const r$={iceServers:[],sdpSemantics:"plan-b"};return t$.iceServers?r$.iceServers=t$.iceServers:t$.turnServer&&t$.turnServer.mode!=="off"&&(Ky$1(t$.turnServer.servers)?r$.iceServers=t$.turnServer.servers:(r$.iceServers&&r$.iceServers.push(...d5.turnServerConfigToIceServers(t$.turnServer.servers)),XA$1("USE_TURN_SERVER_OF_GATEWAY")&&r$.iceServers&&t$.turnServer.serversFromGateway&&r$.iceServers.push(...d5.turnServerConfigToIceServers(t$.turnServer.serversFromGateway)),t$.turnServer.servers.concat(t$.turnServer.serversFromGateway||[]).forEach(n$=>{n$.forceturn&&(r$.iceTransportPolicy="relay")}))),r$}static turnServerConfigToIceServers(t$){const r$=[];return t$.forEach(n$=>{n$.security?n$.tcpport&&r$.push({username:n$.username,credential:n$.password,credentialType:"password",urls:"turns:".concat(n$.turnServerURL,":").concat(n$.tcpport,"?transport=tcp")}):(n$.udpport&&r$.push({username:n$.username,credential:n$.password,credentialType:"password",urls:"turn:".concat(n$.turnServerURL,":").concat(n$.udpport,"?transport=udp")}),n$.tcpport&&r$.push({username:n$.username,credential:n$.password,credentialType:"password",urls:"turn:".concat(n$.turnServerURL,":").concat(n$.tcpport,"?transport=tcp")}))}),r$}async updateRtpSenderEncodings(t$,r$){var n$;if(r$||(r$=this.peerConnection.getSenders().find(u$=>{var l$;return((l$=u$.track)===null||l$===void 0?void 0:l$.id)===t$._mediaStreamTrack.id})),!r$)return fb$1.warn("[".concat(t$.getTrackId(),"] no rtpSender found}"));if(!ZP$1().supportSetRtpSenderParameters)return fb$1.warn("Browser not support set rtp-sender parameters");const i$={},o$={};if(t$ instanceof aU$1)switch(t$._optimizationMode){case"motion":i$.degradationPreference="maintain-framerate";break;case"detail":i$.degradationPreference="maintain-resolution";break;default:i$.degradationPreference="balanced"}if(XA$1("DSCP_TYPE")&&Ey$1()){var s$;const u$=XA$1("DSCP_TYPE");Dn$1(s$=["very-low","low","medium","high"]).call(s$,u$)&&(o$.networkPriority=u$)}const a$=r$.getParameters(),c$=(n$=a$.encodings)===null||n$===void 0?void 0:n$[0];c$&&Object.assign(c$,o$),Object.assign(a$,i$),fb$1.debug("[".concat(t$.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a$.encodings))),await r$.setParameters(a$)}async applySendEncodings(t$,r$){try{if(!ZP$1().supportSetRtpSenderParameters||t$.length!==r$.length)return;for(let n$=0;n$<t$.length;n$++){const i$=t$[n$],o$=r$[n$];i$&&o$&&await this.updateRtpSenderEncodings(o$,i$)}}catch{fb$1.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t$,r$){const n$=FU$1.parse(t$);return r$.forEach((i$,o$)=>{const s$=i$._mediaStreamTrack,a$=n$.mediaDescriptions.find(c$=>c$.attributes.mid===s$.kind);a$&&JU$1(a$,i$)}),FU$1.print(n$)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t$=>{var r$;(r$=this.onFirstAudioReceived)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstVideoReceived=t$=>{var r$;(r$=this.onFirstVideoReceived)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstAudioDecoded=t$=>{var r$;(r$=this.onFirstAudioDecoded)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstVideoDecoded=(t$,r$,n$)=>{var i$;(i$=this.onFirstVideoDecoded)===null||i$===void 0||i$.call(this,t$,r$,n$)},this.statsFilter.onSelectedLocalCandidateChanged=(t$,r$)=>{var n$;(n$=this.onSelectedLocalCandidateChanged)===null||n$===void 0||n$.call(this,t$,r$)},this.statsFilter.onSelectedRemoteCandidateChanged=(t$,r$)=>{var n$;(n$=this.onSelectedRemoteCandidateChanged)===null||n$===void 0||n$.call(this,t$,r$)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const r$=this.remoteSDP.batchSend(t$).map((o$,s$)=>{let{id:a$,mslabel:c$}=o$;const{kind:u$}=t$[s$];return new Gh$1((l$,d$)=>{const h$=setTimeout(()=>{d$(new Error("Cannot receive track, id: ".concat(a$)))},1e4),p$=_$=>{const f$=Hv$1();if(f$.name==="Safari"&&Number(f$.version)===11&&_$.track.id!==a$&&_$.streams[0].id===c$){var m$;const g$=_$.streams[0].getTracks()[0];return(m$=this.remoteSDP)===null||m$===void 0||m$.updateTrackLabel(u$,a$,_$.track.id),this.peerConnection.removeEventListener("track",p$),clearTimeout(h$),void l$({track:g$,id:a$})}if(_$.track.id===a$)return this.peerConnection.removeEventListener("track",p$),clearTimeout(h$),void l$({track:_$.track,id:a$})};this.peerConnection.addEventListener("track",p$)})}),n$=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n$});const i$=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i$),await Gh$1.all(r$)}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r$.toString()))}}async getRemoteSSRC(t$){if(!this.remoteSDP)return;const r$=this.remoteSDP.getSSRC(t$);return r$==null?void 0:r$[0].ssrcId}setConfiguration(t$){if(ZP$1().supportPCSetConfiguration){const r$=d5.resolvePCConfiguration(t$);this.peerConnection.setConfiguration(r$)}}},Cw$1(UF$1.prototype,"connect",[BF$1],Object.getOwnPropertyDescriptor(UF$1.prototype,"connect"),UF$1.prototype),Cw$1(UF$1.prototype,"stopSending",[BF$1],Object.getOwnPropertyDescriptor(UF$1.prototype,"stopSending"),UF$1.prototype),Cw$1(UF$1.prototype,"receive",[BF$1],Object.getOwnPropertyDescriptor(UF$1.prototype,"receive"),UF$1.prototype),Cw$1(UF$1.prototype,"stopReceiving",[BF$1],Object.getOwnPropertyDescriptor(UF$1.prototype,"stopReceiving"),UF$1.prototype),Cw$1(UF$1.prototype,"muteRemote",[BF$1],Object.getOwnPropertyDescriptor(UF$1.prototype,"muteRemote"),UF$1.prototype),Cw$1(UF$1.prototype,"unmuteRemote",[BF$1],Object.getOwnPropertyDescriptor(UF$1.prototype,"unmuteRemote"),UF$1.prototype),Cw$1(UF$1.prototype,"muteLocal",[BF$1],Object.getOwnPropertyDescriptor(UF$1.prototype,"muteLocal"),UF$1.prototype),Cw$1(UF$1.prototype,"unmuteLocal",[BF$1],Object.getOwnPropertyDescriptor(UF$1.prototype,"unmuteLocal"),UF$1.prototype),Cw$1(UF$1.prototype,"close",[BF$1],Object.getOwnPropertyDescriptor(UF$1.prototype,"close"),UF$1.prototype),Cw$1(UF$1.prototype,"updateEncoderConfig",[BF$1],Object.getOwnPropertyDescriptor(UF$1.prototype,"updateEncoderConfig"),UF$1.prototype),Cw$1(UF$1.prototype,"updateSendParameters",[BF$1],Object.getOwnPropertyDescriptor(UF$1.prototype,"updateSendParameters"),UF$1.prototype),Cw$1(UF$1.prototype,"replaceTrack",[BF$1],Object.getOwnPropertyDescriptor(UF$1.prototype,"replaceTrack"),UF$1.prototype),Cw$1(UF$1.prototype,"getRemoteSSRC",[BF$1],Object.getOwnPropertyDescriptor(UF$1.prototype,"getRemoteSSRC"),UF$1.prototype),UF$1);function BF$1(e$,t$,r$){const n$=e$[t$];if(typeof n$!="function")throw new Error("Cannot use mutex on object property.");return r$.value=async function(){const i$=this.mutex,o$=await i$.lock("Locking from P2PConnection.".concat(t$));try{for(var s$=arguments.length,a$=new Array(s$),c$=0;c$<s$;c$++)a$[c$]=arguments[c$];return await n$.apply(this,a$)}finally{o$()}},r$}function jF$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function GF$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?jF$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):jF$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}const WF$1="9",HF$1=4e4;let KF$1=class{get localCapabilities(){return sA$1(this._localCapabilities)}get rtpCapabilities(){return sA$1(this._rtpCapabilities)}get candidates(){return sA$1(this._candidates)}get iceParameters(){return sA$1(this._iceParameters)}get dtlsParameters(){return sA$1(this._dtlsParameters)}constructor(t$){Fg$1(this,"sessionDesc",void 0),Fg$1(this,"_localCapabilities",void 0),Fg$1(this,"_rtpCapabilities",void 0),Fg$1(this,"_candidates",void 0),Fg$1(this,"_iceParameters",void 0),Fg$1(this,"_dtlsParameters",void 0),Fg$1(this,"setup",void 0),Fg$1(this,"currentMidIndex",void 0),Fg$1(this,"cname",void 0),Fg$1(this,"firefoxSsrcMidMap",new Map),t$=sA$1(t$);const{iceParameters:r$,dtlsParameters:n$,candidates:i$,rtpCapabilities:o$,setup:s$,localCapabilities:a$,cname:c$}=t$;this._rtpCapabilities=o$,this._candidates=i$,this._iceParameters=r$,this._dtlsParameters=n$,this._localCapabilities=a$,this.setup=s$,this.cname=c$,this.sessionDesc=this.updateRemoteRTPCapabilities(o$),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(t$){const r$=this.candidates,n$=this.dtlsParameters,i$=this.iceParameters,o$=this.rtpCapabilities.send;let s$=this.sessionDesc.mediaDescriptions.length-1;for(let a$=1;a$<t$;a$++){const c$=2*a$+2e4,u$=2*a$+HF$1,{ssrcs:l$,ssrcGroups:d$}=zU$1([{ssrcId:c$}],this.cname),{ssrcs:h$,ssrcGroups:p$}=zU$1([{ssrcId:u$,rtx:XA$1("USE_SUB_RTX")?u$+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:WF$1,protos:["UDP","TLS","RTP","SAVPF"],fmts:o$.videoCodecs.map(_$=>_$.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i$.iceUfrag,icePwd:i$.icePwd,unrecognized:[],candidates:r$,extmaps:o$.videoExtensions,fingerprints:n$.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h$,ssrcGroups:p$,rtcpFeedbackWildcards:[],payloads:o$.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++s$)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:WF$1,protos:["UDP","TLS","RTP","SAVPF"],fmts:o$.audioCodecs.map(_$=>_$.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i$.iceUfrag,icePwd:i$.icePwd,unrecognized:[],candidates:r$,extmaps:o$.audioExtensions,fingerprints:n$.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l$,ssrcGroups:d$,rtcpFeedbackWildcards:[],payloads:o$.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++s$)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return FU$1.print(this.sessionDesc)}send(t$,r$,n$,i$){const{ssrcs:o$,ssrcGroups:s$}=zU$1(r$,this.cname,XA$1("SYNC_GROUP")?n$:void 0),a$=this.findPreloadMediaDesc(o$);if(a$){if(Zv$1()&&this.firefoxSsrcMidMap.set(o$[0].ssrcId,a$.attributes.mid),i$&&(i$.twcc||i$.remb)){const c$=this.sessionDesc.mediaDescriptions.indexOf(a$);return this.sessionDesc.mediaDescriptions[c$]=this.mungSendMediaDesc(a$,i$),{mid:a$.attributes.mid,needExchangeSDP:!0}}return{mid:a$.attributes.mid,needExchangeSDP:!1}}{const c$=this.findAvailableMediaIndex(t$,o$);let u$;return c$===-1||c$===1&&(Xv$1()||function(){const l$=Hv$1();return!(l$.name!==Bv$1.CHROME||!l$.osVersion)&&Number(l$.version)<=90}())||c$===0&&XA$1("USE_SUB_RTX")||ay$1()?(u$=this.createOrRecycleSendMedia(t$,o$,s$,"sendonly",i$),this.updateBundleMids()):(u$=sA$1(this.sessionDesc.mediaDescriptions[c$]),u$.attributes.direction="sendonly",u$.attributes.ssrcs=o$,u$.attributes.ssrcGroups=s$,this.sessionDesc.mediaDescriptions[c$]=this.mungSendMediaDesc(u$,i$)),Zv$1()&&this.firefoxSsrcMidMap.set(o$[0].ssrcId,u$.attributes.mid),{mid:u$.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:t$,needExchangeSDP:r$}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:t$.attributes.mid,needExchangeSDP:r$}}batchSend(t$){const r$=t$.map(o$=>{let{kind:s$,ssrcMsg:a$,mslabel:c$}=o$;return this.send(s$,a$,c$)}),n$=[];let i$=!1;return r$.forEach(o$=>{let{mid:s$,needExchangeSDP:a$}=o$;a$&&(i$=!0),n$.push(s$)}),{mids:n$,needExchangeSDP:i$}}stopSending(t$){const r$=this.sessionDesc.mediaDescriptions.filter(n$=>n$.attributes.mid&&t$.indexOf(n$.attributes.mid)!==-1);if(r$.length!==t$.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r$.forEach(n$=>{n$.attributes.mid==="0"||Zv$1()||ay$1()?n$.attributes.ssrcs=[]:(n$.attributes.ssrcs=[],n$.attributes.direction="inactive",n$.media.port="0")}),this.updateBundleMids()}mute(t$){const r$=this.sessionDesc.mediaDescriptions.find(n$=>n$.attributes.mid===t$);if(!r$)throw new Error("mediaDescription not found with ".concat(t$," in remote SDP when calling RemoteSDP.mute."));r$.attributes.direction="inactive"}unmute(t$){const r$=this.sessionDesc.mediaDescriptions.find(n$=>n$.attributes.mid===t$);if(!r$)throw new Error("mediaDescription not found with ".concat(t$," in remote SDP when calling RemoteSDP.unmute."));r$.attributes.direction="sendonly"}muteRemote(t$){const r$=this.sessionDesc.mediaDescriptions.filter(n$=>Dn$1(t$).call(t$,n$.attributes.mid||""));if(r$.length!==t$.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r$.forEach(n$=>{n$.attributes.direction="inactive"})}unmuteRemote(t$){const r$=this.sessionDesc.mediaDescriptions.filter(n$=>Dn$1(t$).call(t$,n$.attributes.mid||""));if(r$.length!==t$.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r$.forEach(n$=>{n$.attributes.direction="recvonly"})}receive(t$,r$,n$,i$){t$.forEach((o$,s$)=>{this.createOrRecycleRecvMedia(o$,[],"recvonly",r$,n$,i$[s$])}),this.updateBundleMids()}stopReceiving(t$){const r$=this.sessionDesc.mediaDescriptions.filter(n$=>t$.indexOf(n$.attributes.mid)!==-1);if(r$.length!==t$.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r$.forEach(n$=>{n$.media.port="0",n$.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(t$){const r$=this.sessionDesc||FU$1.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=t$;const n$=this.rtpCapabilities.send,i$=this.localCapabilities.send;for(const o$ of r$.mediaDescriptions){if(o$.attributes.iceUfrag=this._iceParameters.iceUfrag,o$.attributes.icePwd=this._iceParameters.icePwd,o$.attributes.fingerprints=this._dtlsParameters.fingerprints,o$.attributes.candidates=this._candidates,o$.attributes.setup=this.setup,o$.media.mediaType==="application"&&(o$.attributes.sctpPort="5000"),o$.media.mediaType==="video"){if(n$.videoCodecs.length===0){const s$=i$.videoCodecs.filter(a$=>{var c$,u$;return(c$=a$.rtpMap)===null||c$===void 0?void 0:Dn$1(u$=c$.encodingName.toLowerCase()).call(u$,"vp8")})||[i$.videoCodecs[0]];o$.media.fmts=s$.map(a$=>a$.payloadType.toString(10)),o$.attributes.payloads=s$,o$.attributes.extmaps=[]}else if(o$.media.fmts=n$.videoCodecs.map(s$=>s$.payloadType.toString(10)),o$.attributes.payloads=n$.videoCodecs,o$.attributes.extmaps=n$.videoExtensions,XA$1("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:s$,ssrcGroups:a$}=zU$1([{ssrcId:HF$1,rtx:XA$1("USE_SUB_RTX")?40001:void 0}],this.cname);o$.attributes.ssrcs=s$,o$.attributes.ssrcGroups=a$}}if(o$.media.mediaType==="audio"){if(n$.audioCodecs.length===0){const s$=i$.audioCodecs.filter(a$=>{var c$,u$;return(c$=a$.rtpMap)===null||c$===void 0?void 0:Dn$1(u$=c$.encodingName.toLowerCase()).call(u$,"opus")})||[i$.audioCodecs[0]];o$.media.fmts=s$.map(a$=>a$.payloadType.toString(10)),o$.attributes.payloads=s$,o$.attributes.extmaps=[]}else if(o$.media.fmts=n$.audioCodecs.map(s$=>s$.payloadType.toString(10)),o$.attributes.payloads=n$.audioCodecs,o$.attributes.extmaps=n$.audioExtensions,ox$1(o$),XA$1("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:s$,ssrcGroups:a$}=zU$1([{ssrcId:2e4}],this.cname);o$.attributes.ssrcs=s$,o$.attributes.ssrcGroups=a$}}}return this.sessionDesc=r$,this.currentMidIndex=r$.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(t$){const r$=this._candidates.filter(n$=>n$.transport==="udp");if(t$===lO$1.TCP){if(r$.length===0)return;if(XA$1("TCP_CANDIDATE_ONLY")){const n$=this._candidates.filter(i$=>i$.transport==="tcp");r$.forEach(i$=>{n$.findIndex(o$=>o$.connectionAddress===i$.connectionAddress)===-1&&n$.push(GF$1(GF$1({},i$),{},{foundation:"tcpcandidate",priority:Number(i$.priority)-1+"",transport:"tcp",port:Number(i$.port)+90+""}))}),this._candidates=n$}else{const n$=[];r$.forEach(i$=>{n$.push(GF$1(GF$1({},i$),{},{foundation:"tcpcandidate",priority:Number(i$.priority)-1+"",transport:"tcp",port:Number(i$.port)+90+""}))}),this._candidates=[...r$,...n$]}}else if(t$===lO$1.RELAY){if(r$.length!==0)return;{const n$=this._candidates.filter(i$=>i$.transport==="tcp");n$.forEach(i$=>{r$.push(GF$1(GF$1({},i$),{},{foundation:"udpcandidate",priority:Number(i$.priority)+1+"",transport:"udp",port:Number(i$.port)-90+""}))}),this._candidates=[...r$,...n$]}}else r$.length===0?(this._candidates.filter(n$=>n$.transport==="tcp").forEach(n$=>{r$.push(GF$1(GF$1({},n$),{},{foundation:"udpcandidate",priority:Number(n$.priority)+1+"",transport:"udp",port:Number(n$.port)-90+""}))}),this._candidates=r$):this._candidates=this._candidates.filter(n$=>n$.transport!=="tcp");for(const n$ of this.sessionDesc.mediaDescriptions)n$.attributes.candidates=this.candidates}restartICE(t$){t$=sA$1(t$),this._iceParameters=t$,this.sessionDesc.mediaDescriptions.forEach(r$=>{r$.attributes.iceUfrag=t$.iceUfrag,r$.attributes.icePwd=t$.icePwd})}predictReceivingMids(t$){const r$=[];for(let n$=0;n$<t$;n$++)r$.push((this.currentMidIndex+n$+1).toString(10));return r$}findAvailableMediaIndex(t$,r$){return this.sessionDesc.mediaDescriptions.findIndex(n$=>{const i$=n$.media.mediaType===t$&&n$.media.port!=="0"&&(n$.attributes.direction==="sendonly"||n$.attributes.direction==="sendrecv")&&n$.attributes.ssrcs.length===0;if(Zv$1()){if(i$){const o$=this.firefoxSsrcMidMap.get(r$[0].ssrcId);return!(o$||n$.attributes.mid!=="0"&&n$.attributes.mid!=="1")||!(!o$||o$!==n$.attributes.mid)}return!1}return i$})}createOrRecycleDataChannel(){for(const n$ of this.sessionDesc.mediaDescriptions)if(n$.media.mediaType==="application")return{mediaDesc:n$,needExchangeSDP:!1};this.currentMidIndex+=1;const t$="".concat(this.currentMidIndex),r$={media:{mediaType:"application",port:WF$1,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(t$),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(r$),{mediaDesc:r$,needExchangeSDP:!0}}createOrRecycleRecvMedia(t$,r$,n$,i$,o$,s$){const a$=t$._mediaStreamTrack.kind,c$=this.rtpCapabilities.recv,u$=sx$1(a$,c$,this.localCapabilities.send,a$===dO$1.VIDEO?i$:o$),l$=a$===dO$1.VIDEO?c$.videoExtensions:c$.audioExtensions;this.currentMidIndex+=1;const d$="".concat(this.currentMidIndex);let h$={media:{mediaType:a$,port:WF$1,protos:["UDP","TLS","RTP","SAVPF"],fmts:u$.map(_$=>_$.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l$,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r$,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u$,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n$,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d$)}};h$=this.mungRecvMediaDsec(h$,t$,s$);const p$=this.findFirstClosedMedia(a$);if(p$){const _$=this.sessionDesc.mediaDescriptions.indexOf(p$);this.sessionDesc.mediaDescriptions[_$]=h$}else this.sessionDesc.mediaDescriptions.push(h$);return h$}updateRemoteCodec(t$,r$,n$){const i$=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(h$=>h$.rtpMap&&h$.rtpMap.encodingName.toLowerCase()||"").filter(h$=>{var p$;return Dn$1(p$=Object.keys(eb$1)).call(p$,h$)}))],o$=new Set(r$);if(i$.every(h$=>o$.has(h$)))return fb$1.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(r$)),!1;const s$=this._rtpCapabilities.recv.videoCodecs.filter(h$=>r$.some(p$=>{var _$;return Dn$1(_$=h$.rtpMap&&h$.rtpMap.encodingName.toLowerCase()||"").call(_$,p$)}));if(s$.length===0)return fb$1.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i$," codecs: ").concat(r$)),!1;const a$=[...new Set(s$.map(h$=>h$.rtpMap&&h$.rtpMap.encodingName.toLowerCase()||""))];let c$;if(fb$1.debug("updateRemoteCodec, from ".concat(i$," to ").concat(a$)),t$.length===0)c$=this.sessionDesc.mediaDescriptions.filter(h$=>h$.media.mediaType==="video"&&h$.attributes.direction==="recvonly");else if(c$=this.sessionDesc.mediaDescriptions.filter(h$=>h$.attributes.mid&&Dn$1(t$).call(t$,h$.attributes.mid)&&h$.attributes.direction==="recvonly"),c$.length!==t$.length)return fb$1.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t$,", codecs: ").concat(r$)),!1;if(XA$1("USE_PUB_RTX")||XA$1("USE_SUB_RTX")){const h$=ax$1(s$,this.rtpCapabilities.recv.videoCodecs);s$.push(...h$)}this._rtpCapabilities.recv.videoCodecs=s$;const u$=this.localCapabilities.send,l$=this.rtpCapabilities.recv,d$=sx$1(dO$1.VIDEO,l$,u$,n$);return c$.forEach(h$=>{const p$=d$.map(_$=>_$.payloadType.toString(10));fb$1.debug("updateRemoteCodec mid: ".concat(h$.attributes.mid,", from ").concat(h$.attributes.payloads," to ").concat(d$)),h$.attributes.payloads=d$,h$.media.fmts=p$}),!0}createOrRecycleSendMedia(t$,r$,n$,i$,o$){const s$=this.rtpCapabilities.send,a$=t$===dO$1.VIDEO?s$.videoCodecs:s$.audioCodecs,c$=t$===dO$1.VIDEO?s$.videoExtensions:s$.audioExtensions;this.currentMidIndex+=1;const u$="".concat(this.currentMidIndex);let l$={media:{mediaType:t$,port:WF$1,protos:["UDP","TLS","RTP","SAVPF"],fmts:a$.map(h$=>h$.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:c$,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r$,ssrcGroups:n$,rtcpFeedbackWildcards:[],payloads:a$,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i$,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u$)}};l$=this.mungSendMediaDesc(l$,o$);const d$=this.findFirstClosedMedia(t$);if(d$){const h$=this.sessionDesc.mediaDescriptions.indexOf(d$);this.sessionDesc.mediaDescriptions[h$]=l$}else this.sessionDesc.mediaDescriptions.push(l$);return l$}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t$=>t$.media.port!=="0").map(t$=>t$.attributes.mid)}mungRecvMediaDsec(t$,r$,n$){const i$=sA$1(t$);return XU$1(i$),JU$1(i$,r$),QU$1(i$,r$),ZU$1(i$),$U$1(i$,n$,this.localCapabilities.send),i$}mungSendMediaDesc(t$,r$){const n$=sA$1(t$);return $U$1(n$,r$,this.localCapabilities.recv),ox$1(n$),n$}updateRecvMedia(t$,r$){const n$=this.sessionDesc.mediaDescriptions.findIndex(i$=>i$.attributes.mid===t$);if(n$!==-1){const i$=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n$],r$);this.sessionDesc.mediaDescriptions[n$]=i$}}bumpMid(t$){this.currentMidIndex+=t$}findFirstClosedMedia(t$){return this.sessionDesc.mediaDescriptions.find(r$=>Zv$1()?r$.media.port==="0"&&r$.media.mediaType===t$:r$.media.port==="0")}findPreloadMediaDesc(t$){return this.sessionDesc.mediaDescriptions.find(r$=>{var n$;return((n$=r$.attributes)===null||n$===void 0||(n$=n$.ssrcs[0])===null||n$===void 0?void 0:n$.ssrcId)===t$[0].ssrcId})}getSSRC(t$){var r$;return(r$=this.sessionDesc.mediaDescriptions.find(n$=>n$.attributes.mid===t$))===null||r$===void 0?void 0:r$.attributes.ssrcs}};function YF$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function qF$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?YF$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):YF$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}let zF$1=function(e$){return e$.BANDWIDTH="bandwidth",e$.CPU="cpu",e$.NONE="none",e$.OTHER="other",e$}({});var JF$1=function(e$){return e$[e$.DOWN=0]="DOWN",e$[e$.UP=1]="UP",e$}(JF$1||{});const XF$1=new Map;function QF$1(e$,t$,r$,n$){let{scale:i$}=e$;if(i$===0&&n$===JF$1.UP||i$>=t$.length-1&&n$===JF$1.DOWN)return e$;let o$=qF$1(qF$1({},e$),{},{scale:n$===JF$1.DOWN?++i$:--i$});switch(r$){case"maintain-framerate":o$=qF$1(qF$1({},o$),t$[i$].motion);break;case"maintain-resolution":o$=qF$1(qF$1({},o$),t$[i$].detail);break;case"balanced":o$=qF$1(qF$1({},o$),t$[i$].balanced)}return o$}function ZF$1(e$,t$){if(t$){const r$={overUse:0,underUse:0,adaptationList:$F$1(t$)};XF$1.set(e$,r$)}else XF$1.delete(e$)}function $F$1(e$){const t$=qF$1({},e$),{bitrateMax:r$,frameRate:n$,scaleResolutionDownBy:i$,bitrateMin:o$}=t$,{MIN_FRAME_RATE:s$,MAX_THRESHOLD_FRAMERATE:a$,MAX_SCALE:c$,BITRATE_MIN_THRESHOLD:u$,BITRATE_MAX_THRESHOLD:l$,BWE_SCALE_UP_THRESHOLD:d$,BWE_SCALE_DOWN_THRESHOLD:h$,PERF_SCALE_DOWN_THRESHOLD:p$,PERF_SCALE_UP_THRESHOLD:_$,BALANCE_BITRATE_FACTOR:f$,BALANCE_FRAMERATE_FACTOR:m$,BALANCE_RESOLUTION_FACTOR:g$,MOTION_RESOLUTION_FACTOR:v$,MOTION_BITRATE_FACTOR:y$,DETAIL_FRAMERATE_FACTOR:S$,DETAIL_BITRATE_FACTOR:b$}=YA$1,$$=Math.min(t$.frameRate,a$),C$=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h$,1)*r$),bwe_up:r$,fps_down:Math.round(Math.pow(p$,1)*$$),fps_up:n$},balanced:{scaleResolutionDownBy:1,frameRate:n$,bitrateMax:r$,bitrateMin:o$},motion:{scaleResolutionDownBy:1,frameRate:n$,bitrateMax:r$,bitrateMin:o$},detail:{scaleResolutionDownBy:1,frameRate:n$,bitrateMax:r$,bitrateMin:o$}}];for(let N$=1;N$<=c$;N$++){const k$={bwe_up:Math.round(Math.pow(d$,N$)*r$),bwe_down:Math.round(Math.pow(h$,N$+1)*r$),fps_up:Math.round(Math.pow(_$,N$)*$$),fps_down:Math.round(Math.pow(p$,N$+1)*$$)},O$={scaleResolutionDownBy:i$/Math.pow(g$,N$),frameRate:Math.max(Math.round(Math.pow(m$,N$)*n$),s$),bitrateMax:Math.max(Math.round(Math.pow(f$,N$)*r$),l$),bitrateMin:Math.max(Math.round(Math.pow(f$,N$)*o$),u$)},U$={scaleResolutionDownBy:i$/Math.pow(v$,N$),frameRate:n$,bitrateMax:Math.max(Math.round(Math.pow(y$,N$)*r$),l$),bitrateMin:Math.max(Math.round(Math.pow(y$,N$)*o$),u$)},x$={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(S$,N$)*n$),s$),bitrateMax:Math.max(Math.round(Math.pow(b$,N$)*r$),l$),bitrateMin:Math.max(Math.round(Math.pow(b$,N$)*o$),u$)};C$.push({scale:N$,threshold:k$,balanced:O$,motion:U$,detail:x$})}return C$}function eB$1(e$,t$,r$,n$,i$,o$){const s$=XF$1.get(e$)||{overUse:0,underUse:0,adaptationList:$F$1(i$)},{adaptationList:a$}=s$;XF$1.set(e$,s$);const{OVERUSE_TIMES_THRESHOLD:c$,UNDERUSE_TIMES_THRESHOLD:u$}=YA$1,{scale:l$}=n$;let d$,h$;return typeof t$=="number"&&t$>0&&function(p$,_$,f$,m$){if(_$>=f$.length)return!1;let{threshold:{fps_down:g$}}=f$[_$];return XA$1("FORCE_AG_HIGH_FRAMERATE")&&m$==="maintain-framerate"&&(g$=f$[0].threshold.fps_down),p$<g$}(t$,l$,a$,o$)&&(s$.overUse++,h$=zF$1.CPU,s$.overUse>c$)||typeof r$=="number"&&r$>0&&function(p$,_$,f$){if(_$>=f$.length)return!1;const{threshold:{bwe_down:m$}}=f$[_$];return p$<m$}(r$,l$,a$)&&(s$.overUse++,h$=zF$1.BANDWIDTH,s$.overUse>c$)?(s$.overUse=0,s$.underUse=0,d$=QF$1(n$,a$,o$,JF$1.DOWN),[d$,h$]):(typeof t$=="number"&&t$>0&&typeof r$=="number"&&r$>0&&function(p$,_$,f$,m$){if(_$===0)return;let{threshold:{fps_up:g$}}=f$[_$];return XA$1("FORCE_AG_HIGH_FRAMERATE")&&m$==="maintain-framerate"&&(g$=f$[1].threshold.fps_up),p$>g$}(t$,l$,a$,o$)&&function(p$,_$,f$){if(_$===0)return;const{threshold:{bwe_up:m$}}=f$[_$];return p$>m$}(r$,l$,a$)&&(s$.underUse++,s$.underUse>u$&&(s$.overUse=0,s$.underUse=0,d$=QF$1(n$,a$,o$,JF$1.UP),d$.scale===0&&(h$=zF$1.NONE))),[d$,h$])}function tB$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function iB$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?tB$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):tB$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}function nB$1(e$){var t$;return!!XA$1("ENABLE_AG_ADAPTATION")&&!!(e$ instanceof cU$1||Dn$1(t$=e$._hints).call(t$,mL$1.CUSTOM_TRACK))&&(!!XA$1("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(r$){const n$=Hv$1();if(n$.os!==Fv$1.IOS||!n$.osVersion)return!1;const i$=n$.osVersion.split(".");return Number(i$[0])>=r$}(14)&&ry$1(17,4)||ny$1(14)&&oy$1(17,4)))}const rB$1=new Map;function oB$1(e$,t$){const r$=rB$1.get(e$);if(r$){const{timer:n$}=r$;window.clearTimeout(n$),rB$1.delete(e$)}t$.qualityLimitationReason=zF$1.NONE,ZF$1(e$)}var sB$1;function aB$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function cB$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?aB$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):aB$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}let dB$1=(sB$1=class h5 extends cO$1{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t$,r$;return(t$=(r$=this.peerConnection.getReceivers()[0])===null||r$===void 0||(r$=r$.transport)===null||r$===void 0?void 0:r$.state)!==null&&t$!==void 0?t$:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t$=>t$.rtpMap&&t$.rtpMap.encodingName.toLowerCase()||"").filter(t$=>{var r$;return Dn$1(r$=Object.keys(eb$1)).call(r$,t$)}))]}constructor(t$,r$){super(t$,r$),Fg$1(this,"store",void 0),Fg$1(this,"peerConnection",void 0),Fg$1(this,"id",TA$1(5,"connection-")),Fg$1(this,"remoteSDP",void 0),Fg$1(this,"initialOffer",void 0),Fg$1(this,"transportEventReceiver",void 0),Fg$1(this,"statsFilter",void 0),Fg$1(this,"extension",{useXR:XA$1("USE_XR")}),Fg$1(this,"localCapabilities",void 0),Fg$1(this,"remoteCodecs",void 0),Fg$1(this,"localCandidateCount",0),Fg$1(this,"allCandidatesReceived",!1),Fg$1(this,"isPreallocation",!1),Fg$1(this,"preSSRCMap",new Map),Fg$1(this,"dataStreamChannelMap",new Map),Fg$1(this,"establishPromise",void 0),Fg$1(this,"recoveredDataChannelIds",[]),Fg$1(this,"currentDataChannelId",1),Fg$1(this,"mutex",new NA$1("P2PConnection-mutex")),Fg$1(this,"qualityLimitationReason",zF$1.NONE),this.store=r$,this.peerConnection=new RTCPeerConnection(h5.resolvePCConfiguration(t$),{optional:[{googDscp:!0}]}),this.statsFilter=xV$1(this.peerConnection,XA$1("STATS_UPDATE_INTERVAL"),void 0,Zv$1()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t$){const r$=this.preSSRCMap.get(t$);if(r$!==void 0){const n$=this.peerConnection.getTransceivers().find(i$=>i$.mid===r$);if(n$)return{transceiver:n$,track:n$.receiver.track,id:r$}}}async updateRemoteRTPCapabilities(t$,r$){if(this.remoteCodecs=r$,!this.remoteSDP)return void fb$1.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r$));if(this.remoteSDP.updateRemoteCodec(t$,r$,this.store.codec)){const n$=await this.peerConnection.createOffer(),i$=this.logSDPExchange(n$.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n$);const o$=this.remoteSDP.toString();i$==null||i$(o$),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o$})}else fb$1.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const t$=await this.peerConnection.createOffer();if(!t$.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r$=HU$1(t$.sdp),n$=await tx$1({filterRTX:!XA$1("USE_PUB_RTX")&&!XA$1("USE_SUB_RTX"),filterVideoFec:XA$1("FILTER_VIDEO_FEC"),filterAudioFec:XA$1("FILTER_AUDIO_FEC"),filterVideoCodec:XA$1("FILTER_VIDEO_CODEC")},this.extension);return this.localCapabilities=rx$1(n$),this.initialOffer=t$,cB$1(cB$1({},r$),{},{rtpCapabilities:n$,offerSDP:t$.sdp})}catch(t$){throw new Cy$1(Ry$1.GET_LOCAL_CONNECTION_PARAMS_FAILED,t$.toString())}}async connect(t$){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new KF$1(cB$1(cB$1({},t$),{},{localCapabilities:this.localCapabilities})),t$.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r$=this.remoteSDP.toString(),n$=dx$1(this.initialOffer.sdp,this.extension),i$=this.logSDPExchange(n$||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:n$}),i$==null||i$(r$),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r$});const o$=this.peerConnection.getTransceivers()[0];if(o$!=null&&o$.receiver&&this.tryBindTransportEvents(o$.receiver),XA$1("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(XA$1("PRELOAD_MEDIA_COUNT"));const a$=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a$});const c$=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c$)}const{preSSRCs:s$}=t$;if(Array.isArray(s$)&&s$.length>0){const{mids:a$}=this.remoteSDP.batchSend(s$.map(c$=>({kind:c$.kind,ssrcMsg:[{ssrcId:c$.ssrcId,rtx:c$.rtx}],mslabel:c$.mslabel})));a$.forEach((c$,u$)=>{this.preSSRCMap.set(s$[u$].ssrcId,c$)}),await cx$1(this.peerConnection,this.remoteSDP,this.extension),fb$1.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r$.toString()))}}async updateRemoteConnect(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:r$}=t$;this.remoteSDP.updateRemoteRTPCapabilities(r$),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:n$}=t$;if(Array.isArray(n$)&&n$.length>0){const{mids:i$}=this.remoteSDP.batchSend(n$.map(o$=>Object.assign({},{kind:o$.kind,ssrcMsg:[{ssrcId:o$.ssrcId,rtx:o$.rtx}],mslabel:o$.mslabel})));i$.forEach((o$,s$)=>{this.preSSRCMap.set(n$[s$].ssrcId,o$)})}await cx$1(this.peerConnection,this.remoteSDP,this.extension),fb$1.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(r$.toString()))}}send(t$,r$,n$){var i$=this;return YI$1(function*(){const o$=yield qI$1(i$.mutex.lock("From P2PConnection.send"));try{if(!i$.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s$=[];t$.forEach(f$=>{const m$=i$.peerConnection.addTransceiver(f$._mediaStreamTrack,{direction:"sendonly"});s$.push(m$),f$._updateRtpTransceiver(m$)}),Zv$1()&&XA$1("SIMULCAST")===!0&&(yield qI$1(i$.applySimulcastForFirefox(s$,t$)));const a$=yield qI$1(i$.peerConnection.createOffer()),c$=i$.remoteSDP.predictReceivingMids(t$.length),u$=i$.mungSendOfferSDP(a$.sdp,t$,c$),l$=FU$1.parse(u$),d$=c$.map(f$=>{const m$=l$.mediaDescriptions.find(g$=>g$.attributes.mid===f$);if(!m$)throw new Error("Cannot extract ssrc from mediaDescription.");return KU$1(m$,XA$1("USE_PUB_RTX"))});let h$;try{h$=yield d$}catch(f$){h$=[],i$.remoteSDP.receive(t$,r$,n$,h$);const m$=i$.remoteSDP.toString();throw yield qI$1(i$.peerConnection.setLocalDescription({type:"offer",sdp:u$})),yield qI$1(i$.peerConnection.setRemoteDescription({type:"answer",sdp:m$})),yield qI$1(i$.stopSending(c$,!0)),f$}i$.remoteSDP.receive(t$,r$,n$,h$);const p$=i$.remoteSDP.toString(),_$=i$.logSDPExchange(u$,"offer","local","send");return yield qI$1(i$.peerConnection.setLocalDescription({type:"offer",sdp:u$})),yield qI$1(i$.applySimulcastEncodings(s$,t$)),yield qI$1(i$.applySendEncodings(s$,t$)),_$==null||_$(p$),yield qI$1(i$.peerConnection.setRemoteDescription({type:"answer",sdp:p$})),s$.map((f$,m$)=>{const g$=c$[m$];return{localSSRC:d$[m$],id:g$,transceiver:f$}})}catch(s$){throw s$ instanceof Cy$1?s$:new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s$.toString()))}finally{o$()}})()}async createDataChannels(t$,r$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n$=this.dataStreamChannelMap.get(t$);if(n$&&n$.readyState==="open")fb$1.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const o$=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof o$!="number")throw new Error("create DataChannel error, because cannot get dc id");n$=this.peerConnection.createDataChannel("datastream-channel",{id:o$,negotiated:!0,ordered:!1,maxRetransmits:XA$1("DATASTREAM_MAX_RETRANSMITS")}),n$.binaryType="arraybuffer",this.dataStreamChannelMap.set(t$,n$)}r$.forEach(o$=>{o$._updateOriginDataChannel(n$)});const{needExchangeSDP:i$}=this.remoteSDP.sendDataChannel();if(i$){const o$=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o$});const s$=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s$),fb$1.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else fb$1.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(n$){throw n$ instanceof Cy$1?n$:new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(n$.toString()))}}async stopDataChannels(t$){try{const r$=this.dataStreamChannelMap.get(t$);return r$&&(r$.id&&this.recoveredDataChannelIds.push(r$.id),r$.close()),void this.dataStreamChannelMap.delete(t$)}catch(r$){throw r$ instanceof Cy$1?r$:new Cy$1(Ry$1.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(r$.toString()))}}async stopSending(t$,r$){const n$=r$?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i$=this.peerConnection.getTransceivers().filter(c$=>t$.indexOf(c$.mid)!==-1);if(i$.length!==t$.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i$.map(c$=>{var u$;oB$1(this.id+c$.mid,this),c$.direction="inactive",(u$=c$.stop)===null||u$===void 0||u$.call(c$)});const o$=await this.peerConnection.createOffer(),s$=this.logSDPExchange(o$.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o$),this.remoteSDP.stopReceiving(t$);const a$=this.remoteSDP.toString();s$==null||s$(a$),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a$})}catch(i$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i$.toString()))}finally{n$&&n$()}}async receive(t$,r$,n$,i$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t$," before remoteSDP created."));const{mid:o$,needExchangeSDP:s$}=this.remoteSDP.send(t$,r$,n$,i$);s$&&(await cx$1(this.peerConnection,this.remoteSDP,this.extension),fb$1.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t$," by exchanging SDP.")));const a$=this.peerConnection.getTransceivers().find(c$=>c$.mid===o$);if(!a$)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a$.receiver.track,id:o$,transceiver:a$}}catch(o$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o$.toString()))}}async batchReceive(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:r$,needExchangeSDP:n$}=this.remoteSDP.batchSend(t$);return n$&&(await cx$1(this.peerConnection,this.remoteSDP,this.extension),fb$1.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),r$.map(i$=>{const o$=this.peerConnection.getTransceivers().find(s$=>s$.mid===i$);if(!o$)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o$.receiver.track,id:i$,transceiver:o$}})}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r$.toString()))}}async stopReceiving(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t$.forEach(o$=>{Array.from(this.preSSRCMap.entries()).some(s$=>{let[a$,c$]=s$;if(c$===o$)return this.preSSRCMap.delete(a$),!0})}),this.remoteSDP.stopSending(t$);const r$=this.remoteSDP.toString(),n$=this.logSDPExchange(r$,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r$});const i$=await this.peerConnection.createAnswer();n$==null||n$(i$.sdp||""),await this.peerConnection.setLocalDescription(i$)}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r$.toString()))}}async muteRemote(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t$," before remote SDP created."));this.remoteSDP.mute(t$);const r$=this.remoteSDP.toString(),n$=this.logSDPExchange(r$,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r$});const i$=await this.peerConnection.createAnswer();n$==null||n$(i$.sdp||""),await this.peerConnection.setLocalDescription(i$)}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(r$.toString()))}}async unmuteRemote(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t$," before remote SDP created."));this.remoteSDP.unmute(t$);const r$=this.remoteSDP.toString(),n$=this.logSDPExchange(r$,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r$});const i$=await this.peerConnection.createAnswer();n$==null||n$(i$.sdp||""),await this.peerConnection.setLocalDescription(i$)}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(r$.toString()))}}async muteLocal(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r$=this.peerConnection.getTransceivers().filter(s$=>s$.mid&&t$.indexOf(s$.mid)!==-1);if(r$.length!==t$.length)throw new Error("Transceivers' length doesn't match mids' length.");r$.map(s$=>{s$.direction="inactive"});const n$=await this.peerConnection.createOffer(),i$=this.logSDPExchange(n$.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n$),this.remoteSDP.muteRemote(t$);const o$=this.remoteSDP.toString();i$==null||i$(o$),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o$})}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r$.toString()))}}async unmuteLocal(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r$=this.peerConnection.getTransceivers().filter(s$=>s$.mid&&t$.indexOf(s$.mid)!==-1);if(r$.length!==t$.length)throw new Error("Transceivers' length doesn't match mids' length.");r$.map(async(s$,a$)=>{s$.direction="sendonly"});const n$=await this.peerConnection.createOffer(),i$=this.logSDPExchange(n$.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n$),this.remoteSDP.unmuteRemote(t$);const o$=this.remoteSDP.toString();i$==null||i$(o$),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o$})}catch(r$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r$.toString()))}}restartICE(t$){var r$=this;return YI$1(function*(){const n$=yield qI$1(r$.mutex.lock("From P2PConnection.restartICE"));try{if(!r$.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ZP$1().supportPCSetConfiguration){const u$=r$.peerConnection.getConfiguration(),l$=t$===lO$1.RELAY?"relay":"all";u$.iceTransportPolicy!==l$&&(fb$1.debug("[".concat(r$.store.clientId,"] restartICE change iceTransportPolicy from [").concat(u$.iceTransportPolicy,"] to [").concat(l$,"]")),u$.iceTransportPolicy=l$,r$.peerConnection.setConfiguration(u$))}else if(t$===lO$1.RELAY)return;r$.remoteSDP.updateCandidates(t$);const i$=yield qI$1(r$.peerConnection.createOffer({iceRestart:!0}));if(!i$.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o$=HU$1(i$.sdp),{remoteIceParameters:s$}=yield o$.iceParameters;r$.remoteSDP.restartICE(s$);const a$=r$.remoteSDP.toString(),c$=r$.logSDPExchange(i$.sdp||"","offer","local","restartICE");r$.store.descriptionStart(),yield qI$1(r$.peerConnection.setLocalDescription(i$)),c$==null||c$(a$),yield qI$1(r$.peerConnection.setRemoteDescription({type:"answer",sdp:a$}))}catch(i$){fb$1.warning("[".concat(r$.store.clientId,"] restart ICE failed, abort operation"),i$)}finally{n$()}})()}close(){var t$;this.peerConnection.getTransceivers().forEach(r$=>{oB$1(this.id+r$.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(t$=this.onConnectionStateChange)===null||t$===void 0||t$.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return cB$1(cB$1({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t$){return this.statsFilter.getVideoIsReady(t$)}async updateEncoderConfig(t$,r$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n$=await this.peerConnection.createOffer(),i$=this.mungSendOfferSDP(n$.sdp,[r$],[t$]);this.remoteSDP.updateRecvMedia(t$,r$);const o$=this.remoteSDP.toString(),s$=this.logSDPExchange(i$,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i$}),s$==null||s$(o$),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o$})}catch(n$){throw new Cy$1(Ry$1.EXCHANGE_SDP_FAILED,n$.toString())}}async updateSendParameters(t$,r$){const n$=this.peerConnection.getTransceivers().filter(i$=>i$.mid===t$);n$.length===1&&(this.isVP8Simulcast(r$)?Zv$1()||await this.applySimulcastEncodings(n$,[r$]):await this.applySendEncodings(n$,[r$]))}setStatsRemoteVideoIsReady(t$,r$){this.statsFilter.setVideoIsReady2(t$,r$)}async replaceTrack(t$,r$){const n$=this.peerConnection.getTransceivers().find(i$=>i$.mid===r$);n$&&await n$.sender.replaceTrack(t$._mediaStreamTrack)}async getSelectedCandidatePair(){const t$=this.peerConnection.getReceivers();if(t$.length>0&&t$[0].transport&&t$[0].transport.iceTransport&&t$[0].transport.iceTransport.getSelectedCandidatePair&&t$[0].transport.iceTransport.getSelectedCandidatePair()){const r$=t$[0].transport.iceTransport,{local:n$,remote:i$}=r$.getSelectedCandidatePair();return{local:cB$1(cB$1({},RV$1),{},{candidateType:n$.type,protocol:n$.protocol,address:n$.address,port:n$.port}),remote:cB$1(cB$1({},RV$1),{},{candidateType:i$.type,protocol:i$.protocol,address:i$.address,port:i$.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t$;(t$=this.onICEConnectionStateChange)===null||t$===void 0||t$.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t$;(t$=this.onConnectionStateChange)===null||t$===void 0||t$.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t$=>{t$.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,fb$1.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,fb$1.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},XA$1("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t$){const r$={iceServers:[]};return t$.iceServers?r$.iceServers=t$.iceServers:t$.turnServer&&t$.turnServer.mode!=="off"&&(Ky$1(t$.turnServer.servers)?r$.iceServers=t$.turnServer.servers:(r$.iceServers&&r$.iceServers.push(...h5.turnServerConfigToIceServers(t$.turnServer.servers)),XA$1("USE_TURN_SERVER_OF_GATEWAY")&&r$.iceServers&&t$.turnServer.serversFromGateway&&r$.iceServers.push(...h5.turnServerConfigToIceServers(t$.turnServer.serversFromGateway)),XA$1("FORCE_TURN_TCP")?r$.iceTransportPolicy="relay":t$.turnServer.servers.concat(t$.turnServer.serversFromGateway||[]).forEach(n$=>{n$.forceturn&&(r$.iceTransportPolicy="relay")}))),XA$1("ENABLE_ENCODED_TRANSFORM")&&ZP$1().supportWebRTCEncodedTransform&&(r$.encodedInsertableStreams=!0),r$}static turnServerConfigToIceServers(t$){const r$=[];return t$.forEach(n$=>{n$.security?n$.tcpport&&r$.push({username:n$.username,credential:n$.password,credentialType:"password",urls:"turns:".concat(JO$1(n$.turnServerURL),":").concat(n$.tcpport,"?transport=tcp")}):(n$.udpport&&!XA$1("FORCE_TURN_TCP")&&r$.push({username:n$.username,credential:n$.password,credentialType:"password",urls:"turn:".concat(n$.turnServerURL,":").concat(n$.udpport,"?transport=udp")}),n$.tcpport&&r$.push({username:n$.username,credential:n$.password,credentialType:"password",urls:"turn:".concat(n$.turnServerURL,":").concat(n$.tcpport,"?transport=tcp")}))}),r$}tryBindTransportEvents(t$){const r$=t$.transport;if(r$){this.transportEventReceiver=t$,r$.onstatechange=()=>{var i$;r$!=null&&r$.state&&((i$=this.onDTLSTransportStateChange)===null||i$===void 0||i$.call(this,r$.state))},r$.onerror=i$=>{var o$;(o$=this.onDTLSTransportError)===null||o$===void 0||o$.call(this,"error"in i$?i$.error:i$)};const n$=r$.iceTransport;n$&&(n$.onstatechange=()=>{const i$=r$==null?void 0:r$.iceTransport.state;var o$;i$&&((o$=this.onICETransportStateChange)===null||o$===void 0||o$.call(this,i$))},n$.getSelectedCandidatePair&&(n$.onselectedcandidatepairchange=()=>{if(n$.getSelectedCandidatePair()){const{local:i$,remote:o$}=n$.getSelectedCandidatePair();fb$1.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i$.type,protocol:i$.protocol}),", remote ").concat(JSON.stringify({candidateType:o$.type,protocol:o$.protocol,address:o$.address,port:o$.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t$,r$){var n$,i$;if(r$||(r$=this.peerConnection.getSenders().find(m$=>m$.track===t$._mediaStreamTrack)),!r$)return fb$1.warn("[".concat(t$.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t$))return fb$1.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ZP$1().supportSetRtpSenderParameters)return fb$1.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const o$={},s$={};switch(t$._optimizationMode){case"motion":o$.degradationPreference="maintain-framerate";break;case"detail":o$.degradationPreference="maintain-resolution";break;case"balanced":o$.degradationPreference="balanced"}const a$=function(f$,m$){return f$.getTransceivers().find(g$=>g$.sender.track===m$||g$.receiver.track===m$)}(this.peerConnection,t$._mediaStreamTrack),c$=wk$1(t$);if(nB$1(t$)&&a$&&r$&&c$&&this.getLocalVideoStats&&Dn$1(n$=["vp8","vp9"]).call(n$,this.store.codec)){var u$;const f$=o$.degradationPreference||(Dn$1(u$=t$._hints).call(u$,mL$1.CUSTOM_TRACK)?XA$1("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(m$,g$,v$,y$,S$,b$){if(oB$1(m$,v$),S$(g$),y$!=="balanced"&&y$!=="maintain-framerate"&&y$!=="maintain-resolution")return;let $$=-1;ZF$1(m$,g$);const C$=window.setInterval(()=>{const k$=rB$1.get(m$);if(!XA$1("ENABLE_AG_ADAPTATION")||!k$)return oB$1(m$,v$),void S$(g$);const O$=b$();if(O$.sendPackets>0&&O$.OutgoingAvailableBandwidth>0){if($$===-1)return void($$=Date.now());if(Date.now()-$$<1e3)return;const U$=O$.sendFrameRate,x$=O$.OutgoingAvailableBandwidth,[F$,L$]=eB$1(m$,U$,x$,k$.adaptationConfig,g$,y$);L$&&(v$.qualityLimitationReason=L$),F$&&k$.adaptationConfig.scale!==F$.scale&&(fb$1.debug("[".concat(m$,"] applyAdaptation: ").concat(v$.qualityLimitationReason,`
           sendFps `).concat(U$,", bwe ").concat(x$,", switch from ").concat(k$.adaptationConfig.scale," to ").concat(F$.scale," ")),k$.adaptationConfig=iB$1(iB$1({},k$.adaptationConfig),F$),S$(F$))}},XA$1("CHECK_LOCAL_STATS_INTERVAL")),N$=iB$1({},g$);rB$1.set(m$,{timer:C$,adaptationConfig:N$,originConfig:g$,adaptationFunc:S$}),fb$1.debug("[".concat(m$,"] start adaptation, originConfig: ").concat(JSON.stringify(g$),", degradationPreference: ").concat(y$))})(this.id+a$.mid,c$,this,f$,m$=>{r$&&this.updateAdaptation(r$,m$)},this.getLocalVideoStats.bind(this))}if(t$._encoderConfig){var l$;const{bitrateMax:f$,frameRate:m$,scaleResolutionDownBy:g$}=t$._encoderConfig;f$&&(s$.maxBitrate=1e3*f$),(Dn$1(l$=t$._hints).call(l$,mL$1.LOW_STREAM)||t$.isUseScaleResolutionDownBy)&&(m$&&(s$.maxFramerate=QO$1(m$)),g$&&g$>=1&&(s$.scaleResolutionDownBy=g$))}const{maxFramerate:d$}=XA$1("ENCODER_CONFIG_LIMIT");if(d$&&typeof d$=="number"&&(s$.maxFramerate=s$.maxFramerate?Math.min(s$.maxFramerate,d$):d$),XA$1("DSCP_TYPE")&&Ey$1()){var h$;const f$=XA$1("DSCP_TYPE");Dn$1(h$=["very-low","low","medium","high"]).call(h$,f$)&&(s$.networkPriority=f$)}const p$=r$.getParameters(),_$=(i$=p$.encodings)===null||i$===void 0?void 0:i$[0];Zv$1()&&!_$&&(o$.encodings=[s$]),_$&&Object.assign(_$,s$),Object.assign(p$,o$),fb$1.debug("[".concat(t$.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p$.encodings))),await r$.setParameters(p$),await async function(f$,m$,g$){try{var v$;if(!ZP$1().supportSetRtpSenderParameters||!function(C$){return C$==="vp9"}(f$)||!XA$1("ENABLE_SVC"))return;const y$={},S$={},b$=m$.getParameters(),$$=(v$=b$.encodings)===null||v$===void 0?void 0:v$[0];S$.scalabilityMode=BU$1(g$),$$&&Object.assign($$,S$),Object.assign(b$,y$),await m$.setParameters(b$),fb$1.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(b$.encodings)))}catch(y$){fb$1.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",y$)}}(this.store.codec,r$,XA$1("SVC_MODE"))}async updateAdaptation(t$,r$){var n$,i$;if(!t$)return fb$1.debug("[updateAdaptation] no rtpSender found");if(!ZP$1().supportSetRtpSenderParameters)return fb$1.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const o$={},{bitrateMax:s$,frameRate:a$,scaleResolutionDownBy:c$}=r$;s$&&(o$.maxBitrate=1e3*s$),a$&&(o$.maxFramerate=QO$1(a$)),c$&&c$>=1&&Dn$1(n$=["vp8","vp9"]).call(n$,this.store.codec)&&(o$.scaleResolutionDownBy=c$);const u$=t$.getParameters(),l$=(i$=u$.encodings)===null||i$===void 0?void 0:i$[0];l$&&Object.assign(l$,o$),Object.assign(u$,{});try{await t$.setParameters(u$),fb$1.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(u$.encodings)))}catch(d$){!("transport"in t$)||t$.transport&&t$.transport.state==="connected"?this.peerConnectionState!=="connected"?fb$1.debug("[updateAdaptation] peerConnection not connected}"):fb$1.debug("[updateAdaptation] updateRtpSenderEncodings failed",d$):fb$1.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t$,r$){try{if(!ZP$1().supportSetRtpSenderParameters||t$.length!==r$.length)return;for(let n$=0;n$<t$.length;n$++){const i$=t$[n$],o$=r$[n$];o$ instanceof aU$1&&!this.isVP8Simulcast(o$)&&await this.updateRtpSenderEncodings(o$,i$.sender)}}catch{fb$1.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t$,r$,n$){const i$=FU$1.parse(t$);return r$.forEach((o$,s$)=>{const a$=n$[s$],c$=i$.mediaDescriptions.find(u$=>u$.attributes.mid===a$);c$&&(JU$1(c$,o$),ex$1(c$,o$,this.store.codec))}),FU$1.print(i$)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t$=>{var r$;(r$=this.onFirstAudioReceived)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstVideoReceived=t$=>{var r$;(r$=this.onFirstVideoReceived)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstAudioDecoded=t$=>{var r$;(r$=this.onFirstAudioDecoded)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstVideoDecoded=(t$,r$,n$)=>{var i$;(i$=this.onFirstVideoDecoded)===null||i$===void 0||i$.call(this,t$,r$,n$)},this.statsFilter.onSelectedLocalCandidateChanged=(t$,r$)=>{var n$;(n$=this.onSelectedLocalCandidateChanged)===null||n$===void 0||n$.call(this,t$,r$)},this.statsFilter.onSelectedRemoteCandidateChanged=(t$,r$)=>{var n$;(n$=this.onSelectedRemoteCandidateChanged)===null||n$===void 0||n$.call(this,t$,r$)},this.statsFilter.onFirstVideoDecodedTimeout=t$=>{var r$;(r$=this.onFirstVideoDecodedTimeout)===null||r$===void 0||r$.call(this,t$)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t$,r$){if(t$.length===r$.length)for(let c$=0;c$<t$.length;c$++){var n$,i$,o$,s$,a$;const u$=t$[c$],l$=r$[c$];if(l$ instanceof aU$1&&!Dn$1(n$=l$._hints).call(n$,mL$1.LOW_STREAM)&&(i$=l$._encoderConfig)!==null&&i$!==void 0&&i$.bitrateMax&&((o$=l$._encoderConfig)===null||o$===void 0?void 0:o$.bitrateMax)>200&&(s$=l$._scalabilityMode)!==null&&s$!==void 0&&s$.numSpatialLayers&&((a$=l$._scalabilityMode)===null||a$===void 0?void 0:a$.numSpatialLayers)>1&&this.store.codec==="vp8"){const d$={},h$={high:1e3*(l$._encoderConfig.bitrateMax-50),medium:5e4};d$.encodings=[{rid:"m",active:!0,maxBitrate:h$.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:h$.high}];const p$=u$.sender.getParameters();await u$.sender.setParameters(Object.assign(p$,d$))}}}async applySimulcastEncodings(t$,r$){if(!Zv$1()&&t$.length===r$.length)for(let n$=0;n$<t$.length;n$++){const i$=r$[n$];if(i$ instanceof aU$1&&this.isVP8Simulcast(i$)){const o$=t$[n$],s$={},a$={high:1e3*(i$._encoderConfig.bitrateMax-50),medium:5e4};s$.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a$.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a$.medium,scaleResolutionDownBy:4}];const c$=o$.sender.getParameters();await o$.sender.setParameters(Object.assign(c$,s$))}}}isVP8Simulcast(t$){var r$,n$,i$,o$,s$;return!!(t$ instanceof aU$1&&XA$1("SIMULCAST")&&this.store.codec==="vp8"&&!Dn$1(r$=t$._hints).call(r$,mL$1.LOW_STREAM)&&(n$=t$._encoderConfig)!==null&&n$!==void 0&&n$.bitrateMax&&((i$=t$._encoderConfig)===null||i$===void 0?void 0:i$.bitrateMax)>200&&(o$=t$._scalabilityMode)!==null&&o$!==void 0&&o$.numSpatialLayers&&((s$=t$._scalabilityMode)===null||s$===void 0?void 0:s$.numSpatialLayers)>1)}logSDPExchange(t$,r$,n$,i$){if(XA$1("SDP_LOGGING"))return fb$1.upload("[".concat(this.store.clientId,"] exchanging ").concat(n$," ").concat(r$," SDP during P2PConnection.").concat(i$,`
`),t$),r$==="offer"?o$=>{this.logSDPExchange(o$,"answer",n$==="local"?"remote":"local",i$)}:void 0}async getRemoteSSRC(t$){if(!this.remoteSDP)return;const r$=this.remoteSDP.getSSRC(t$);return r$&&r$.length!==0?r$[0].ssrcId:void 0}setConfiguration(t$){if(ZP$1().supportPCSetConfiguration){const r$=h5.resolvePCConfiguration(t$);this.peerConnection.setConfiguration(r$)}}},Cw$1(sB$1.prototype,"updateRemoteRTPCapabilities",[lB$1],Object.getOwnPropertyDescriptor(sB$1.prototype,"updateRemoteRTPCapabilities"),sB$1.prototype),Cw$1(sB$1.prototype,"connect",[lB$1],Object.getOwnPropertyDescriptor(sB$1.prototype,"connect"),sB$1.prototype),Cw$1(sB$1.prototype,"updateRemoteConnect",[lB$1],Object.getOwnPropertyDescriptor(sB$1.prototype,"updateRemoteConnect"),sB$1.prototype),Cw$1(sB$1.prototype,"createDataChannels",[lB$1],Object.getOwnPropertyDescriptor(sB$1.prototype,"createDataChannels"),sB$1.prototype),Cw$1(sB$1.prototype,"receive",[lB$1],Object.getOwnPropertyDescriptor(sB$1.prototype,"receive"),sB$1.prototype),Cw$1(sB$1.prototype,"batchReceive",[lB$1],Object.getOwnPropertyDescriptor(sB$1.prototype,"batchReceive"),sB$1.prototype),Cw$1(sB$1.prototype,"stopReceiving",[lB$1],Object.getOwnPropertyDescriptor(sB$1.prototype,"stopReceiving"),sB$1.prototype),Cw$1(sB$1.prototype,"muteRemote",[lB$1],Object.getOwnPropertyDescriptor(sB$1.prototype,"muteRemote"),sB$1.prototype),Cw$1(sB$1.prototype,"unmuteRemote",[lB$1],Object.getOwnPropertyDescriptor(sB$1.prototype,"unmuteRemote"),sB$1.prototype),Cw$1(sB$1.prototype,"muteLocal",[lB$1],Object.getOwnPropertyDescriptor(sB$1.prototype,"muteLocal"),sB$1.prototype),Cw$1(sB$1.prototype,"unmuteLocal",[lB$1],Object.getOwnPropertyDescriptor(sB$1.prototype,"unmuteLocal"),sB$1.prototype),Cw$1(sB$1.prototype,"close",[lB$1],Object.getOwnPropertyDescriptor(sB$1.prototype,"close"),sB$1.prototype),Cw$1(sB$1.prototype,"updateEncoderConfig",[lB$1],Object.getOwnPropertyDescriptor(sB$1.prototype,"updateEncoderConfig"),sB$1.prototype),Cw$1(sB$1.prototype,"updateSendParameters",[lB$1],Object.getOwnPropertyDescriptor(sB$1.prototype,"updateSendParameters"),sB$1.prototype),Cw$1(sB$1.prototype,"replaceTrack",[lB$1],Object.getOwnPropertyDescriptor(sB$1.prototype,"replaceTrack"),sB$1.prototype),Cw$1(sB$1.prototype,"updateAdaptation",[lB$1],Object.getOwnPropertyDescriptor(sB$1.prototype,"updateAdaptation"),sB$1.prototype),Cw$1(sB$1.prototype,"getRemoteSSRC",[lB$1],Object.getOwnPropertyDescriptor(sB$1.prototype,"getRemoteSSRC"),sB$1.prototype),sB$1);function lB$1(e$,t$,r$){const n$=e$[t$];if(typeof n$!="function")throw new Error("Cannot use mutex on object property.");return r$.value=async function(){const i$=this.mutex,o$=await i$.lock("From P2PConnection.".concat(t$));try{for(var s$=arguments.length,a$=new Array(s$),c$=0;c$<s$;c$++)a$[c$]=arguments[c$];return await n$.apply(this,a$)}finally{o$()}},r$}var uB$1;function hB$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function pB$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?hB$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):hB$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}function _B$1(e$){var t$,r$,n$,i$=2;for(typeof Symbol<"u"&&(r$=JI$1,n$=Symbol.iterator);i$--;){if(r$&&(t$=e$[r$])!=null)return t$.call(e$);if(n$&&(t$=e$[n$])!=null)return new EB$1(t$.call(e$));r$="@@asyncIterator",n$="@@iterator"}throw new TypeError("Object is not async iterable")}function EB$1(e$){function t$(r$){if(Object(r$)!==r$)return Gh$1.reject(new TypeError(r$+" is not an object."));var n$=r$.done;return Gh$1.resolve(r$.value).then(function(i$){return{value:i$,done:n$}})}return EB$1=function(r$){this.s=r$,this.n=r$.next},EB$1.prototype={s:null,n:null,next:function(){return t$(this.n.apply(this.s,arguments))},return:function(r$){var n$=this.s.return;return n$===void 0?Gh$1.resolve({value:r$,done:!0}):t$(n$.apply(this.s,arguments))},throw:function(r$){var n$=this.s.return;return n$===void 0?Gh$1.reject(r$):t$(n$.apply(this.s,arguments))}},new EB$1(e$)}let fB$1=(uB$1=class extends xy$1{get state(){return this._state}set state(e$){const t$=this._state;this._state=e$,this.emit(_O$1.StateChange,t$,this._state)}constructor(e$,t$){super(),Fg$1(this,"isPlanB",void 0),Fg$1(this,"store",void 0),Fg$1(this,"statsUploader",void 0),Fg$1(this,"connection",void 0),Fg$1(this,"localTrackMap",new Map),Fg$1(this,"remoteUserMap",new Map),Fg$1(this,"localDataChannels",[]),Fg$1(this,"remoteDataChannelMap",new Map),Fg$1(this,"pendingLocalTracks",[]),Fg$1(this,"pendingRemoteTracks",[]),Fg$1(this,"pendingLocalDataChannels",[]),Fg$1(this,"pendingRemoteDataChannels",[]),Fg$1(this,"statsCollector",void 0),Fg$1(this,"shouldForwardP2PCreation",void 0),Fg$1(this,"iceFailedCount",0),Fg$1(this,"dtlsFailedCount",0),Fg$1(this,"mutex",new NA$1("P2PChannel-mutex")),Fg$1(this,"_state",pO$1.Disconnected),Fg$1(this,"_pcStatsUploadType",XA$1("NEW_ICE_RESTART")?uO$1.FIRST_CONNECTION:uO$1.OLD_FIRST_CONNECTION),Fg$1(this,"_isInRestartIce",!1),Fg$1(this,"_isStartRestartIce",!1),Fg$1(this,"_restartStates",["disconnected","failed"]),Fg$1(this,"_restartTimer",void 0),Fg$1(this,"_isFirstConnected",!0),Fg$1(this,"handleMuteLocalTrack",async(r$,n$,i$)=>{const o$=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==pO$1.Connected)return void i$(new Cy$1(Ry$1.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const s$=this.filterTobeMutedTracks(r$);if(s$.length===0)return void n$();const a$=s$.find(u$=>u$[0]==="videoLowTrack");a$&&a$[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(s$.map(u$=>{let[,{id:l$}]=u$;return l$}));const c$=this.createMuteMessage(s$);await $y$1(this,_O$1.RequestMuteLocal,c$),n$()}catch(s$){i$(s$)}finally{o$()}}),Fg$1(this,"handleUnmuteLocalTrack",async(r$,n$,i$)=>{const o$=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==pO$1.Connected)return void i$(new Cy$1(Ry$1.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const s$=this.filterTobeUnmutedTracks(r$);if(s$.length===0)return void n$();const a$=s$.find(u$=>u$[0]==="videoLowTrack");if(a$){const u$=a$[1];if(u$.track._originMediaStreamTrack.stop(),!XA$1("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP$1().supportDualStreamEncoding){const l$=r$._mediaStreamTrack.clone();u$.track._mediaStreamTrack=l$,u$.track._originMediaStreamTrack=l$}else{const l$=KV$1(r$,tA$1(this,_O$1.RequestLowStreamParameter));u$.track._mediaStreamTrack=l$,u$.track._originMediaStreamTrack=l$}await new Gh$1((l$,d$)=>{this.handleReplaceTrack(u$.track,l$,d$,!0)})}await this.connection.unmuteLocal(s$.map(u$=>{let[,{id:l$}]=u$;return l$}));const c$=this.createUnmuteMessage(s$);await $y$1(this,_O$1.RequestUnmuteLocal,c$),n$()}catch(s$){i$(s$)}finally{o$()}}),Fg$1(this,"handleUpdateVideoEncoder",async(r$,n$,i$)=>{const o$=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const s$=this.localTrackMap.get(hO$1.LocalVideoTrack);if(!this.connection||!s$||s$.track!==r$||this.state!==pO$1.Connected)return void n$();const{id:a$,track:c$}=s$;await this.connection.updateSendParameters(a$,c$),await this.connection.updateEncoderConfig(a$,c$),this.emit(_O$1.UpdateVideoEncoder,c$),n$()}catch(s$){i$(s$)}finally{o$()}}),Fg$1(this,"handleUpdateVideoSendParameters",async(r$,n$,i$)=>{const o$=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const s$=this.localTrackMap.get(hO$1.LocalVideoTrack);if(!this.connection||!s$||s$.track!==r$||this.state!==pO$1.Connected)return void n$();const{id:a$,track:c$}=s$;await this.connection.updateSendParameters(a$,c$),n$()}catch(s$){i$(s$)}finally{o$()}}),Fg$1(this,"handleReplaceMixingTrack",async(r$,n$,i$,o$)=>{if(!this.connection||this.state!==pO$1.Connected)return void n$();const s$=hF$1([r$]);let a$;fb$1.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(s$.getTrackId(),"]")),typeof o$=="boolean"&&o$||(a$=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(r$,s$),n$()}catch(u$){i$(u$)}finally{var c$;(c$=a$)===null||c$===void 0||c$()}}),Fg$1(this,"handleReplaceTrack",async(r$,n$,i$,o$)=>{let s$;fb$1.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(r$.getTrackId(),"]")),typeof o$=="boolean"&&o$||(s$=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var a$;const u$=Array.from(this.localTrackMap.entries()).find(l$=>{let[,{track:d$}]=l$;return r$===d$});if(!this.connection||!u$||this.state!==pO$1.Connected)return void n$();if(await((a$=this.connection)===null||a$===void 0?void 0:a$.replaceTrack(r$,u$[1].id)),this.isPlanB){const l$=u$[1];l$.id=r$._mediaStreamTrack.id,this.localTrackMap.set(u$[0],l$)}if(u$[0]===hO$1.LocalVideoTrack&&!XA$1("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP$1().supportDualStreamEncoding){const l$=this.localTrackMap.get(hO$1.LocalVideoLowTrack);if(l$){const d$=r$._mediaStreamTrack.clone();l$.track._originMediaStreamTrack.stop(),l$.track._mediaStreamTrack=d$,l$.track._originMediaStreamTrack=d$,await new Gh$1((h$,p$)=>{this.handleReplaceTrack(l$.track,h$,p$,!0)})}}n$()}catch(u$){i$(u$)}finally{var c$;(c$=s$)===null||c$===void 0||c$()}}),Fg$1(this,"handleGetRTCStats",r$=>{r$(this.statsCollector.getRTCStats())}),Fg$1(this,"handleGetLocalVideoStats",r$=>{r$(this.statsCollector.getLocalVideoTrackStats())}),Fg$1(this,"handleGetLocalAudioStats",r$=>{r$(this.statsCollector.getLocalAudioTrackStats())}),Fg$1(this,"handleGetRemoteVideoStats",r$=>this.statsCollector.getRemoteVideoTrackStats(r$.uid)[r$.uid]),Fg$1(this,"handleGetRemoteAudioStats",r$=>this.statsCollector.getRemoteAudioTrackStats(r$.uid)[r$.uid]),this.store=e$,this.statsCollector=t$,this.statsCollector.addP2PChannel(this),this.statsUploader=new aF$1(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!ZP$1().supportUnifiedPlan||XA$1("CHROME_FORCE_PLAN_B")&&Ey$1(),this.shouldForwardP2PCreation=XA$1("FORWARD_P2P_CREATION")&&ZP$1().supportPCSetConfiguration&&_y$1(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new FF$1({},this.store):new dB$1({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e$){var t$;this.state=pO$1.New;const r$=this.shouldForwardP2PCreation&&((t$=this.connection)===null||t$===void 0?void 0:t$.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!r$||(r$&&this.connection&&(fb$1.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.isPlanB?new FF$1(e$,this.store):new dB$1(e$,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new Cy$1(Ry$1.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=XA$1("NEW_ICE_RESTART")?uO$1.FIRST_CONNECTION:uO$1.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e$),this.connection.establishPromise}async connect(e$){if(!this.connection)throw new Cy$1(Ry$1.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");XA$1("ENABLE_PREALLOC_PC")&&this.state===pO$1.Connected?await this.connection.updateRemoteConnect(e$):(this.store.peerConnectionStart(),await this.connection.connect(e$),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=pO$1.Connected)}updateRemoteRTPCapabilities(e$){const t$=Array.from(this.localTrackMap.entries()).filter(i$=>{var o$;let[s$]=i$;return Dn$1(o$=[hO$1.LocalVideoLowTrack,hO$1.LocalVideoTrack]).call(o$,s$)}),r$=t$.map(i$=>{let[,{id:o$}]=i$;return o$}),n$=t$.map(i$=>{let[o$]=i$;return o$});if(this.connection instanceof dB$1){if(vb$1.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(n$),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e$)}),!Dn$1(e$).call(e$,this.store.codec)){const i$=["vp9","vp8","h264"].find(o$=>Dn$1(e$).call(e$,o$));i$&&(this.store.codec=i$,fb$1.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i$,".")))}this.connection.updateRemoteRTPCapabilities(r$,e$)}}async getEstablishParams(){var e$;if(this.connection instanceof dB$1&&this.connection.peerConnectionState!=="closed"&&Dn$1(e$=[pO$1.New,pO$1.Connected]).call(e$,this.state))return this.connection.establishPromise}async publishDataChannel(e$){if(!this.connection||this.state!==pO$1.Connected){if(this.state===pO$1.Disconnected)throw new Cy$1(Ry$1.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e$.forEach(r$=>{var n$;Dn$1(n$=this.pendingLocalDataChannels).call(n$,r$)||this.pendingLocalDataChannels.push(r$)}),[]}const t$=this.filterTobePublishedDataChannels(e$);return t$.length===0?[]:(t$.forEach(r$=>{const n$=Date.now();this.store.publish(r$.id.toString(),"datachannel",n$)}),await this.connection.createDataChannels(this.store.uid,t$),t$.forEach(r$=>{this.localDataChannels.push(r$);const n$=Date.now();this.store.publish(r$.id+"","datachannel",void 0,n$)}),e$.map(r$=>({streamId:r$.id,ordered:r$.ordered,maxRetransmits:r$.maxRetransmits,metadata:r$.metadata,channelId:r$._originDataChannelId})))}publish(e$,t$,r$){var n$=this;return YI$1(function*(){const i$=yield qI$1(n$.mutex.lock("From P2PChannel.publish"));try{if(!n$.connection||n$.state!==pO$1.Connected){if(n$.state===pO$1.Disconnected)throw new Cy$1(Ry$1.UNEXPECTED_ERROR,"PeerConnection already disconnected.");n$.throwIfTrackTypeNotMatch(e$);const s$=e$.filter(a$=>n$.pendingLocalTracks.indexOf(a$)===-1);return void(n$.pendingLocalTracks=n$.pendingLocalTracks.concat(s$))}n$.store.pubId=n$.store.pubId+1,rV$1.markPublishStart(n$.store.clientId,n$.store.pubId);const o$=n$.filterTobePublishedTracks(e$,t$,r$);if(o$.length===0)return void(yield qI$1(n$.tryToUnmuteAudio(e$)));yield*zI$1(_B$1(n$.doPublish(n$.connection,o$)))}finally{i$()}})()}doPublish(e$,t$){var r$=this;return YI$1(function*(){t$.forEach(d$=>{let{track:h$,type:p$}=d$;const _$=Date.now();r$.store.publish(h$.getTrackId(),p$===hO$1.LocalAudioTrack?"audio":"video",_$)}),r$.bindLocalTrackEvents(t$);const n$=t$.map(d$=>{let{track:h$}=d$;return h$}),i$=yield qI$1(e$.send(n$,r$.store.codec,r$.store.audioCodec)),o$=(yield qI$1(i$.next())).value,s$=r$.createGatewayPublishMessage(t$,o$);let a$;try{a$=yield s$}catch(d$){throw i$.throw(d$),(d$==null?void 0:d$.code)===Ry$1.WS_ABORT&&t$.forEach(h$=>{let{track:p$}=h$;r$.pendingLocalTracks.indexOf(p$)===-1&&r$.pendingLocalTracks.push(p$)}),r$.unbindLocalTrackEvents(t$),d$}const c$=r$.mapPubResToRemoteConfig(s$,a$,n$),u$=(yield qI$1(i$.next(c$))).value,l$=XA$1("ENABLE_VIDEO_SEI");n$.forEach(async d$=>{const h$=d$.getRTCRtpTransceiver();h$&&l$&&(d$.trackMediaType===dO$1.VIDEO?await kU$1(h$.sender,d$):d$.trackMediaType===dO$1.AUDIO&&await async function(p$){if(!ZP$1().supportWebRTCEncodedTransform)return void fb$1.warning("browser not support audio encoded transform");if(NU$1.has(p$)||!p$.track)return;const _$={track:p$.track};if(Jv$1()){if(!p$.createEncodedStreams)return void fb$1.warning("browser not support createEncodedStreams() API");let m$=null;try{m$=p$.createEncodedStreams()}catch(v$){return void fb$1.error("create audio-encoded-streams error",v$&&v$.message)}const g$=new TransformStream({transform(v$,y$){_$.controller||(_$.controller=y$),p$.track&&p$.track.id!==_$.track.id&&(fb$1.debug("audio track changed: ".concat(_$.track.id," => ").concat(p$.track.id)),_$.track.removeEventListener("ended",f$),_$.track=p$.track,_$.track.addEventListener("ended",f$)),y$.enqueue(v$)}});m$.readable.pipeThrough(g$).pipeTo(m$.writable)}else if(Xv$1()){if(typeof RTCRtpScriptTransform>"u")return void fb$1.warning("browser not support RTCRtpScriptTransform");const m$=OU$1(),g$=new MessageChannel;await new Gh$1(y$=>m$.onmessage=S$=>{S$.data==="registered"&&y$(void 0)});const v$=new RTCRtpScriptTransform(m$,{name:"tx",port:g$.port2},[g$.port2]);p$.transform=v$,await new Gh$1(y$=>m$.onmessage=S$=>{S$.data==="started"&&y$(void 0)}),g$.port1.onmessage=y$=>{var S$;y$.data.transformed&&p$.track&&((S$=p$.track)===null||S$===void 0?void 0:S$.id)!==_$.track.id&&(fb$1.debug("audio track changed: ".concat(_$.track.id," => ").concat(p$.track.id)),_$.track.removeEventListener("ended",f$),_$.track=p$.track,_$.track.addEventListener("ended",f$))},_$.worker=m$}function f$(){if(p$.track){if(this.id!==p$.track.id)return;p$.track.removeEventListener("ended",f$)}const m$=NU$1.get(p$);if(m$){NU$1.delete(p$);try{var g$,v$;(g$=m$.controller)===null||g$===void 0||g$.terminate(),(v$=m$.worker)===null||v$===void 0||v$.terminate()}catch(y$){fb$1.warning(y$&&y$.message)}}}NU$1.set(p$,_$),p$.track.addEventListener("ended",f$)}(h$.sender))}),t$.forEach(d$=>{let{type:h$}=d$;r$.statsCollector.addLocalStats(h$)}),r$.assignLocalTracks(t$,u$),r$.statsUploader.startUploadOutboundStats(),t$.forEach(d$=>{let{track:h$,type:p$}=d$;const _$=Date.now();r$.store.publish(h$.getTrackId(),p$===hO$1.LocalAudioTrack?"audio":"video",void 0,_$)})})()}async updateVideoStreamParameter(e$,t$){const r$=this.localTrackMap.get(t$);if(!r$)return;if(!(r$.track instanceof aU$1))return fb$1.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof dB$1||this.connection instanceof FF$1))return fb$1.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:n$}=r$,i$=function(o$,s$){const a$={};return o$.height&&o$.width&&(a$.scaleResolutionDownBy=iN$1(o$,s$)),a$.maxFramerate=o$.framerate?QO$1(o$.framerate):void 0,a$.maxBitrate=o$.bitrate?1e3*o$.bitrate:void 0,a$}(e$,n$);if(n$._encoderConfig||(n$._encoderConfig={}),t$!==hO$1.LocalVideoLowTrack||!XA$1("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP$1().supportDualStreamEncoding)i$.scaleResolutionDownBy!=null&&(n$._encoderConfig.scaleResolutionDownBy=i$.scaleResolutionDownBy);else{const o$=n$._originMediaStreamTrack;if(!o$.canvas)return fb$1.warn("[".concat(n$.getTrackId(),"] no canvas on track"));(function(s$,a$){const c$=s$.canvas;a$.width&&(c$.width=QO$1(a$.width)),a$.height&&(c$.height=QO$1(a$.height)),a$.framerate&&(c$.stopCapture&&c$.stopCapture(),c$.stopCapture=QL$1(()=>{!c$.startCapture&&c$.stopCapture&&c$.stopCapture(),c$.startCapture&&c$.startCapture()},QO$1(a$.framerate)))})(o$,e$)}i$.maxBitrate!=null&&(n$._encoderConfig.bitrateMax=i$.maxBitrate/1e3),i$.maxFramerate!=null&&(n$._encoderConfig.frameRate&&typeof n$._encoderConfig.frameRate=="object"?n$._encoderConfig.frameRate.max=i$.maxFramerate:n$._encoderConfig.frameRate={max:i$.maxFramerate}),fb$1.debug("[".concat(n$.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(n$._encoderConfig))),await this.connection.updateRtpSenderEncodings(n$)}publishLowStream(e$){var t$=this;return YI$1(function*(){if(!t$.connection||t$.state!==pO$1.Connected)return;const r$=yield qI$1(t$.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i$=t$.localTrackMap.get(hO$1.LocalVideoTrack);if(!i$)throw new Cy$1(Ry$1.UNEXPECTED_ERROR,"Could not find high stream");if(t$.localTrackMap.has(hO$1.LocalVideoLowTrack))throw new Cy$1(Ry$1.UNEXPECTED_ERROR,"[".concat(t$.store.clientId,"] Can't publish low stream when stream already publish"));const o$=[{track:t$.getLowVideoTrack(i$.track,e$),type:hO$1.LocalVideoLowTrack}];if(yield*zI$1(_B$1(t$.doPublish(t$.connection,o$))),i$.track.muted||!i$.track.enabled){var n$;const s$=(n$=t$.localTrackMap.get(hO$1.LocalVideoLowTrack))===null||n$===void 0?void 0:n$.id;s$!==void 0&&(yield qI$1(t$.connection.muteLocal([s$])))}}finally{r$()}})()}async republish(){this.pendingLocalTracks.length>0&&(fb$1.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Zy$1(this,_O$1.RequestRePublish,this.pendingLocalTracks),this.emit(_O$1.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(fb$1.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Zy$1(this,_O$1.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e$){for(let t$=this.pendingRemoteTracks.length-1;t$>=0;t$--){const{user:r$,kind:n$}=this.pendingRemoteTracks[t$];(n$!==dO$1.AUDIO||r$._audio_added_&&r$._audioSSRC)&&(n$!==dO$1.VIDEO||r$._video_added_&&r$._videoSSRC)||this.pendingRemoteTracks.splice(t$,1)}if(e$)await Zy$1(this,_O$1.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t$,kind:r$}of this.pendingRemoteTracks)await this.subscribe(t$,r$,r$===dO$1.VIDEO?t$._videoSSRC:t$._audioSSRC);this.pendingRemoteTracks.forEach(t$=>{let{user:r$}=t$;this.emit(_O$1.MediaReconnectEnd,r$.uid)}),this.pendingRemoteTracks=[]}async unpublish(e$){if(!this.connection||this.state!==pO$1.Connected)return void e$.forEach(n$=>{const i$=this.pendingLocalTracks.indexOf(n$);i$!==-1&&this.pendingLocalTracks.splice(i$,1)});const t$=this.filterTobeUnpublishedTracks(e$);if(t$.length===0)return;const r$=t$.find(n$=>n$[0]==="videoLowTrack");return r$&&r$[1].track.close(),this.doUnpublish(this.connection,t$)}async unpublishDataChannel(e$){if(!this.connection||this.state!==pO$1.Connected)return void e$.forEach(r$=>{const n$=this.pendingLocalDataChannels.indexOf(r$);n$!==-1&&this.pendingLocalDataChannels.splice(n$,1)});const t$=this.filterTobeUnpublishedDataChannels(e$);return t$.length!==0?(t$.forEach(r$=>{const n$=this.localDataChannels.indexOf(r$);n$!==-1&&this.localDataChannels.splice(n$,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t$.map(r$=>r$.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==pO$1.Connected)return;const e$=this.localTrackMap.get(hO$1.LocalVideoLowTrack);if(!e$)return;e$.track.close();const t$=[[hO$1.LocalVideoLowTrack,e$]];return this.doUnpublish(this.connection,t$)}async doUnpublish(e$,t$){const r$=this.createGatewayUnpublishMessage(t$);return await e$.stopSending(t$.map(n$=>{let[,{id:i$}]=n$;return i$})),this.withdrawLocalTracks(t$),this.unbindLocalTrackEvents(t$.map(n$=>{let[i$,{track:o$}]=n$;return{type:i$,track:o$}})),t$.forEach(n$=>{let[i$]=n$;this.statsCollector.removeLocalStats(i$)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),r$}async subscribeDataChannel(e$,t$){if(!this.connection||this.state!==pO$1.Connected)throw new Cy$1(Ry$1.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const r$=t$.filter(n$=>{var i$;return!((i$=this.remoteDataChannelMap.get(e$))!==null&&i$!==void 0&&i$.get(n$.id))});if(r$.length!==0)return await this.connection.createDataChannels(e$.uid,r$),r$.forEach(n$=>{var i$;this.remoteDataChannelMap.has(e$)?(i$=this.remoteDataChannelMap.get(e$))===null||i$===void 0||i$.set(n$.id,n$):this.remoteDataChannelMap.set(e$,new Map([[n$.id,n$]]));const o$=this.pendingRemoteDataChannels.findIndex(s$=>{let{user:a$,id:c$}=s$;return a$.uid===e$.uid&&c$===n$.id});o$!==-1&&this.pendingRemoteDataChannels.splice(o$,1)}),r$.map(n$=>n$.id)}async subscribe(e$,t$,r$,n$,i$){var o$;if(!this.connection||this.state!==pO$1.Connected)throw new Cy$1(Ry$1.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((o$=this.remoteUserMap.get(e$))!==null&&o$!==void 0&&o$.has(t$))return;let s$,a$,c$;const u$=this.connection.getPreMedia(r$);if(u$)fb$1.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r$,", no need to send sub to gateway.")),c$=u$.transceiver,s$=u$.track,a$=u$.id;else if(i$){const h$=i$.find(_$=>{let{stream_type:f$}=_$;return f$===t$});if(!h$)throw new Cy$1(Ry$1.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t$," for user: ").concat(e$.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t$,"."));const p$=await this.connection.receive(t$,h$.ssrcs,String(e$._uintid),h$.attributes);this.connection instanceof dB$1&&(c$=p$.transceiver),s$=p$.track,a$=p$.id}else{const h$=await this.connection.receive(t$,[{ssrcId:r$,rtx:n$}],String(e$._uintid),void 0);this.connection instanceof dB$1&&(c$=h$.transceiver),s$=h$.track,a$=h$.id}t$===dO$1.AUDIO?(e$._audioTrack?e$._audioTrack._updateOriginMediaStreamTrack(s$):(e$._audioTrack=new vU$1(s$,e$.uid,e$._uintid,this.store),fb$1.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e$._audioTrack.getTrackId()))),c$&&e$._audioTrack._updateRtpTransceiver(c$),this.bindRemoteTrackEvents(e$,e$._audioTrack)):(e$._videoTrack?e$._videoTrack._updateOriginMediaStreamTrack(s$):(e$._videoTrack=new IU$1(s$,e$.uid,e$._uintid,this.store),fb$1.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e$._videoTrack.getTrackId()))),c$&&e$._videoTrack._updateRtpTransceiver(c$),this.bindRemoteTrackEvents(e$,e$._videoTrack)),XA$1("ENABLE_VIDEO_SEI")&&c$&&(t$==dO$1.VIDEO?await async function(h$){let p$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ZP$1().supportWebRTCEncodedTransform)return void fb$1.warning("browser not support video encoded transform");if(!h$.track)return;if(MU$1.has(h$)){const m$=MU$1.get(h$);return void(m$&&(m$.onSei=p$.onSei))}const _$={track:h$.track,onSei:p$.onSei};if(Jv$1()){if(!h$.createEncodedStreams)return void fb$1.warning("browser not support createEncodedStreams() API");let m$=null;try{m$=h$.createEncodedStreams()}catch(v$){return void fb$1.error("create video-encoded-streams error",v$&&v$.message)}const g$=new TransformStream({transform(v$,y$){_$.controller||(_$.controller=y$),h$.track&&h$.track.id!==_$.track.id&&(fb$1.debug("video track changed: ".concat(_$.track.id," => ").concat(h$.track.id)),_$.track.removeEventListener("ended",f$),_$.track=h$.track,_$.track.addEventListener("ended",f$));const S$=function(b$){const $$=new DataView(b$.data);let C$=0;for(;C$+4<b$.data.byteLength;){if($$.getUint8(C$+0)===0&&$$.getUint8(C$+1)===0&&$$.getUint8(C$+2)===0&&$$.getUint8(C$+3)===1&&$$.getUint8(C$+4)===6){let N$=C$+6,k$=0,O$=0;for(;(O$=$$.getUint8(N$++))===255;)k$+=255;k$+=O$;const U$=PU$1(b$.data,N$,k$);return new Uint8Array(U$)}C$++}return null}(v$);S$&&_$.onSei&&_$.onSei(S$),y$.enqueue(v$)}});m$.readable.pipeThrough(g$).pipeTo(m$.writable)}else if(Xv$1()){if(typeof RTCRtpScriptTransform>"u")return void fb$1.warning("browser not support RTCRtpScriptTransform");const m$=OU$1(),g$=new MessageChannel;await new Gh$1(y$=>m$.onmessage=S$=>{S$.data==="registered"&&y$(void 0)});const v$=new RTCRtpScriptTransform(m$,{name:"rx",port:g$.port2},[g$.port2]);h$.transform=v$,await new Gh$1(y$=>m$.onmessage=S$=>{S$.data==="started"&&y$(void 0)}),g$.port1.onmessage=y$=>{var S$;y$.data.transformed&&h$.track&&((S$=h$.track)===null||S$===void 0?void 0:S$.id)!==_$.track.id?(fb$1.debug("video track changed: ".concat(_$.track.id," => ").concat(h$.track.id)),_$.track.removeEventListener("ended",f$),_$.track=h$.track,_$.track.addEventListener("ended",f$)):y$.data.sei&&_$.onSei&&_$.onSei(y$.data.sei)},_$.worker=m$}function f$(){if(h$.track){if(this.id!==h$.track.id)return;h$.track.removeEventListener("ended",f$)}(function(m$){const g$=MU$1.get(m$);if(g$){MU$1.delete(m$);try{var v$,y$;(v$=g$.controller)===null||v$===void 0||v$.terminate(),(y$=g$.worker)===null||y$===void 0||y$.terminate()}catch(S$){fb$1.warning(S$&&S$.message)}}})(h$)}MU$1.set(h$,_$),h$.track.addEventListener("ended",f$)}(c$.receiver,{onSei:h$=>{var p$;(p$=e$._videoTrack)===null||p$===void 0||p$._onSei(h$)}}):t$==dO$1.AUDIO&&await async function(h$){if(!ZP$1().supportWebRTCEncodedTransform)return void fb$1.warning("browser not support audio encoded transform");if(DU$1.has(h$))return;const p$={track:h$.track};if(Jv$1()){if(!h$.createEncodedStreams)return void fb$1.warning("browser not support createEncodedStreams() API");let f$=null;try{f$=h$.createEncodedStreams()}catch(g$){return void fb$1.error("create audio-encoded-streams error",g$&&g$.message)}const m$=new TransformStream({transform(g$,v$){p$.controller||(p$.controller=v$),h$.track&&h$.track.id!==p$.track.id&&(fb$1.debug("audio track changed: ".concat(p$.track.id," => ").concat(h$.track.id)),p$.track.removeEventListener("ended",_$),p$.track=h$.track,p$.track.addEventListener("ended",_$)),v$.enqueue(g$)}});f$.readable.pipeThrough(m$).pipeTo(f$.writable)}else if(Xv$1()){if(typeof RTCRtpScriptTransform>"u")return void fb$1.warning("browser not support RTCRtpScriptTransform");const f$=OU$1(),m$=new MessageChannel;await new Gh$1(v$=>f$.onmessage=y$=>{y$.data==="registered"&&v$(void 0)});const g$=new RTCRtpScriptTransform(f$,{name:"rx",port:m$.port2},[m$.port2]);h$.transform=g$,await new Gh$1(v$=>f$.onmessage=y$=>{y$.data==="started"&&v$(void 0)}),m$.port1.onmessage=v$=>{var y$;v$.data.transformed&&h$.track&&((y$=h$.track)===null||y$===void 0?void 0:y$.id)!==p$.track.id&&(fb$1.debug("audio track changed: ".concat(p$.track.id," => ").concat(h$.track.id)),p$.track.removeEventListener("ended",_$),p$.track=h$.track,p$.track.addEventListener("ended",_$))},p$.worker=f$}function _$(){h$.track.removeEventListener("ended",_$),function(f$){const m$=DU$1.get(f$);if(m$){DU$1.delete(f$);try{var g$,v$;(g$=m$.controller)===null||g$===void 0||g$.terminate(),(v$=m$.worker)===null||v$===void 0||v$.terminate()}catch(y$){fb$1.warning(y$&&y$.message)}}}(h$)}DU$1.set(h$,p$),h$.track.addEventListener("ended",_$)}(c$.receiver));const l$=this.remoteUserMap.get(e$);l$?l$.set(t$,a$):this.remoteUserMap.set(e$,new Map([[t$,a$]])),this.statsCollector.addRemoteStats(e$.uid),this.statsUploader.startUploadInboundStats();const d$=this.pendingRemoteTracks.findIndex(h$=>{let{user:p$,kind:_$}=h$;return p$.uid===e$.uid&&t$===_$});d$!==-1&&(this.pendingRemoteTracks.splice(d$,1),this.emit(_O$1.MediaReconnectEnd,e$.uid))}async massSubscribe(e$){return this.massSubscribeNoLock(e$)}async massSubscribeNoLock(e$){if(!this.connection||this.state!==pO$1.Connected)throw new Cy$1(Ry$1.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e$=e$.filter(i$=>{var o$;let{user:s$,mediaType:a$}=i$;return!((o$=this.remoteUserMap.get(s$))!==null&&o$!==void 0&&o$.has(a$))});const t$=[],r$=new Map;e$.forEach(i$=>{if(!this.connection)return;const o$=this.connection.getPreMedia(i$.ssrcId);o$?r$.set(i$.ssrcId,o$):t$.push(i$)});const n$=await this.connection.batchReceive(t$.map(i$=>{let{user:o$,mediaType:s$,ssrcId:a$,rtxSsrcId:c$}=i$;return{kind:s$,ssrcMsg:[{ssrcId:a$,rtx:c$}],mslabel:String(o$._uintid)}}));t$.forEach((i$,o$)=>{r$.set(i$.ssrcId,n$[o$])}),e$.forEach(i$=>{let{user:o$,mediaType:s$,ssrcId:a$}=i$;const c$=r$.get(a$);if(!c$)return void fb$1.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(o$.uid," subscribe data,").concat(s$,", ").concat(a$));const{track:u$,id:l$,transceiver:d$}=c$;s$===dO$1.AUDIO?(o$._audioTrack?o$._audioTrack._updateOriginMediaStreamTrack(u$):(o$._audioTrack=new vU$1(u$,o$.uid,o$._uintid,this.store),fb$1.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o$._audioTrack.getTrackId()))),d$&&o$._audioTrack._updateRtpTransceiver(d$),this.bindRemoteTrackEvents(o$,o$._audioTrack)):(o$._videoTrack?o$._videoTrack._updateOriginMediaStreamTrack(u$):(o$._videoTrack=new IU$1(u$,o$.uid,o$._uintid,this.store),fb$1.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o$._videoTrack.getTrackId()))),d$&&o$._videoTrack._updateRtpTransceiver(d$),this.bindRemoteTrackEvents(o$,o$._videoTrack));const h$=this.remoteUserMap.get(o$);h$?h$.set(s$,l$):this.remoteUserMap.set(o$,new Map([[s$,l$]])),this.statsCollector.addRemoteStats(o$.uid),this.statsUploader.startUploadInboundStats();const p$=this.pendingRemoteTracks.findIndex(_$=>{let{user:f$,kind:m$}=_$;return f$.uid===o$.uid&&s$===m$});p$!==-1&&(this.pendingRemoteTracks.splice(p$,1),this.emit(_O$1.MediaReconnectEnd,o$.uid))})}async unsubscribe(e$,t$,r$){const n$=this.pendingRemoteTracks.filter(s$=>{let{user:a$,kind:c$}=s$;return t$!==void 0?a$.uid===e$.uid&&t$===c$:a$.uid===e$.uid});if(n$.forEach(s$=>{const a$=this.pendingRemoteTracks.indexOf(s$);this.pendingRemoteTracks.splice(a$,1)}),this.connection&&this.state===pO$1.Connected||r$||n$.forEach(s$=>{let{kind:a$}=s$;var c$;if(a$===dO$1.AUDIO)(c$=e$._audioTrack)===null||c$===void 0||c$._destroy(),e$._audioTrack=void 0;else if(a$===dO$1.VIDEO){var u$;(u$=e$._videoTrack)===null||u$===void 0||u$._destroy(),e$._videoTrack=void 0}}),!this.connection||this.state!==pO$1.Connected)return;const i$=this.filterTobeUnSubscribedTracks(e$,t$);if(i$.length===0)return;await this.connection.stopReceiving(i$.map(s$=>{let[,{id:a$}]=s$;return a$}));const o$=this.createUnsubscribeMessage(i$);return this.withdrawRemoteTracks(i$),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i$.forEach(s$=>{let[a$,{kind:c$}]=s$;var u$,l$;if(c$===dO$1.VIDEO&&a$._videoSSRC&&((u$=this.connection)===null||u$===void 0||u$.setStatsRemoteVideoIsReady(a$._videoSSRC,!1)),c$===dO$1.VIDEO)this.unbindRemoteTrackEvents(a$._videoTrack),r$||((l$=a$._videoTrack)===null||l$===void 0||l$._destroy(),a$._videoTrack=void 0);else if(c$===dO$1.AUDIO){var d$;this.unbindRemoteTrackEvents(a$._audioTrack),!r$&&((d$=a$._audioTrack)===null||d$===void 0||d$._destroy(),a$._audioTrack=void 0)}}),o$}async unsubscribeDataChannel(e$,t$){if(t$.forEach(i$=>{const o$=this.pendingRemoteDataChannels.findIndex(s$=>s$.id===i$.id);o$!==-1&&this.pendingRemoteDataChannels.splice(o$,1)}),!this.connection)return;const r$=this.filterTobeUnSubscribedDataChannels(e$,t$);if(r$.length===0)return;t$.forEach(i$=>{i$._close()});const n$=this.remoteDataChannelMap.get(e$);return r$.forEach(i$=>{n$&&n$.delete(i$.id)}),n$&&n$.size===0&&(this.remoteDataChannelMap.delete(e$),await this.connection.stopDataChannels(e$.uid)),r$.map(i$=>i$.id)}async massUnsubscribe(e$){return this.massUnsubscribeNoLock(e$)}async massUnsubscribeNoLock(e$){let t$=[];for(const{user:i$,mediaType:o$}of e$){const s$=this.pendingRemoteTracks.filter(a$=>{let{user:c$,kind:u$}=a$;return o$!==void 0?c$.uid===i$.uid&&o$===u$:c$.uid===i$.uid});s$.forEach(a$=>{const c$=this.pendingRemoteTracks.indexOf(a$);this.pendingRemoteTracks.splice(c$,1)}),t$=t$.concat(s$)}if(!this.connection||this.state!==pO$1.Connected)return void t$.forEach(i$=>{let{user:o$,kind:s$}=i$;var a$;if(s$===dO$1.AUDIO)(a$=o$._audioTrack)===null||a$===void 0||a$._destroy(),o$._audioTrack=void 0;else if(s$===dO$1.VIDEO){var c$;(c$=o$._videoTrack)===null||c$===void 0||c$._destroy(),o$._videoTrack=void 0}});const r$=Jn$1(e$).call(e$,(i$,o$)=>{let{user:s$,mediaType:a$}=o$;const c$=this.filterTobeUnSubscribedTracks(s$,a$);return i$.concat(c$)},[]);if(r$.length===0)return;await this.connection.stopReceiving(r$.map(i$=>{let[,{id:o$}]=i$;return o$}));const n$=this.createUnsubscribeAllMessage(r$);return this.withdrawRemoteTracks(r$),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r$.forEach(i$=>{let[o$,{kind:s$}]=i$;var a$,c$;if(s$===dO$1.VIDEO&&o$._videoSSRC&&((a$=this.connection)===null||a$===void 0||a$.setStatsRemoteVideoIsReady(o$._videoSSRC,!1)),s$===dO$1.VIDEO)this.unbindRemoteTrackEvents(o$._videoTrack),(c$=o$._videoTrack)===null||c$===void 0||c$._destroy(),o$._videoTrack=void 0;else if(s$===dO$1.AUDIO){var u$;this.unbindRemoteTrackEvents(o$._audioTrack),(u$=o$._audioTrack)===null||u$===void 0||u$._destroy(),o$._audioTrack=void 0}}),n$}isPreSubScribe(e$){return!this.connection||this.state!==pO$1.Connected?!1:!!this.connection.getPreMedia(e$)}async muteRemote(e$,t$){if(!this.connection)return;const r$=this.remoteUserMap.get(e$);if(!r$)return void fb$1.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e$.uid,"."));if(!r$.get(t$))return void fb$1.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e$.uid," media type ").concat(t$,"."));const n$=t$===dO$1.VIDEO?e$._videoSSRC:e$._audioSSRC;n$!==void 0&&this.connection.setStatsRemoteVideoIsReady(n$,!1)}async unmuteRemote(e$,t$){return this.unmuteRemoteNoLock(e$,t$)}async unmuteRemoteNoLock(e$,t$){if(!this.connection)return;const r$=this.remoteUserMap.get(e$);if(!r$)return void fb$1.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e$.uid,"."));r$.get(t$)||fb$1.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e$.uid," media type ").concat(t$,"."))}getAllTracks(e$){const t$=this.localTrackMap.get(hO$1.LocalAudioTrack);if((t$==null?void 0:t$.track)instanceof RM$1){const r$=t$.track;return Array.from(this.localTrackMap.entries()).filter(n$=>{let[i$]=n$;return i$!==hO$1.LocalAudioTrack}).filter(n$=>{let[i$]=n$;return!(e$&&i$===hO$1.LocalVideoLowTrack)}).map(n$=>{let[,{track:i$}]=n$;return i$}).concat(r$.trackList)}return Array.from(this.localTrackMap.entries()).filter(r$=>{let[n$]=r$;return!(e$&&n$===hO$1.LocalVideoLowTrack)}).map(r$=>{let[,{track:n$}]=r$;return n$})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e$,t$,r$,n$,i$){if(e$){const s$=this.localTrackMap.get(hO$1.LocalAudioTrack),a$=n$?this.localTrackMap.get(hO$1.LocalVideoLowTrack):this.localTrackMap.get(hO$1.LocalVideoTrack);vb$1.publish(this.store.sessionId,{eventElapse:rV$1.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e$,ec:t$,audioName:s$==null?void 0:s$.track.getTrackLabel(),videoName:a$==null?void 0:a$.track.getTrackLabel(),screenshare:(a$==null?void 0:a$.track._hints.indexOf(mL$1.SCREEN_TRACK))!==-1,audio:!!s$,video:!!a$,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i$})}else{var o$;r$||(r$=[]);const s$=r$.find(c$=>c$ instanceof TM$1),a$=n$?(o$=this.localTrackMap.get(hO$1.LocalVideoTrack))===null||o$===void 0?void 0:o$.track:r$.find(c$=>c$ instanceof aU$1);vb$1.publish(this.store.sessionId,{eventElapse:rV$1.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e$,ec:t$,audioName:s$==null?void 0:s$.getTrackLabel(),videoName:a$==null?void 0:a$.getTrackLabel(),screenshare:(a$==null?void 0:a$._hints.indexOf(mL$1.SCREEN_TRACK))!==-1,audio:!!s$,video:!!a$,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i$})}}reportSubscribeEvent(e$,t$,r$,n$){const i$=n$===dO$1.VIDEO?r$._videoSSRC:r$._audioSSRC;i$&&vb$1.subscribe(this.store.sessionId,{succ:e$,ec:t$,video:n$===dO$1.VIDEO,audio:n$===dO$1.AUDIO,peerid:r$.uid,subscribeRequestid:i$,p2pid:this.store.p2pId,eventElapse:rV$1.measureFromSubscribeStart(this.store.clientId,i$),preSsrc:this.isPreSubScribe(i$)})}reset(){fb$1.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new NA$1("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new FF$1({},this.store):new dB$1({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e$=this.localTrackMap.get(hO$1.LocalAudioTrack);if((e$==null?void 0:e$.track)instanceof RM$1){if(e$.track.trackList.length>0){const t$=e$.track;e$.track.trackList.forEach(r$=>{t$.removeAudioTrack(r$)})}e$.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=pO$1.Disconnected}getStats(){var e$;return(e$=this.connection)===null||e$===void 0?void 0:e$.getStats()}getRemoteVideoIsReady(e$){var t$;return((t$=this.connection)===null||t$===void 0?void 0:t$.getRemoteVideoIsReady(e$))||!1}getLocalAudioVolume(){const e$=this.localTrackMap.get(hO$1.LocalAudioTrack);if(e$)return e$.track.getVolumeLevel()}getLocalVideoSize(){const e$=this.localTrackMap.get(hO$1.LocalVideoTrack);if(e$)return{width:e$.track.videoWidth||0,height:e$.track.videoHeight||0}}getEncoderConfig(e$){const t$=this.localTrackMap.get(e$);return t$&&t$.track instanceof aU$1||t$&&t$.track instanceof TM$1?t$.track._encoderConfig:void 0}getLocalMedia(e$){return this.localTrackMap.get(e$)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e$,t$){if(!e$)return this.remoteUserMap.size>0;const r$=this.remoteUserMap.get(e$);return!!r$&&(!t$||r$.has(t$))}async hasRemoteMediaWithLock(e$,t$){if(!e$)return this.remoteUserMap.size>0;const r$=this.remoteUserMap.get(e$);return!!r$&&(!t$||r$.has(t$))}getRemoteMedia(e$){var t$;const r$=Array.from(d_$1(t$=this.remoteUserMap).call(t$)).find(n$=>n$.uid===e$);return r$?{audioTrack:r$.audioTrack,audioSSRC:r$._audioSSRC,videoTrack:r$.videoTrack,videoSSRC:r$._videoSSRC}:{}}getAudioLevels(){let e$=Array.from(this.remoteUserMap.entries()).map(r$=>{let[n$]=r$;return{uid:n$.uid,level:n$.audioTrack?100*n$.audioTrack._source.getAccurateVolumeLevel():0}});const t$=this.localTrackMap.get(hO$1.LocalAudioTrack);return t$&&e$.push({level:100*t$.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e$=aE$1(e$).call(e$,(r$,n$)=>r$.level-n$.level),e$}async disconnectForReconnect(){this.connection&&(fb$1.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=pO$1.Reconnecting,XA$1("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e$=>{let[t$]=e$;var r$;t$._videoTrack&&t$._videoTrack._player&&((r$=t$._videoTrack._player.getVideoElement())===null||r$===void 0||r$.pause(),t$._videoTrack._player.isKeepLastFrame=!0,t$._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new FF$1({},this.store):new dB$1({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e$=>{var t$;let[r$,{track:n$}]=e$;switch(r$){case hO$1.LocalVideoTrack:Dn$1(t$=n$._hints).call(t$,mL$1.LOW_STREAM)?n$.close():this.pendingLocalTracks.push(n$);break;case hO$1.LocalAudioTrack:n$ instanceof RM$1?this.pendingLocalTracks=this.pendingLocalTracks.concat(n$.trackList):this.pendingLocalTracks.push(n$);case hO$1.LocalVideoLowTrack:}}),this.emit(_O$1.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e$=>{let[t$,r$]=e$;Array.from(d_$1(r$).call(r$)).forEach(n$=>{this.setPendingRemoteMedia(t$,n$)}),this.emit(_O$1.MediaReconnectStart,t$.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e$=>{this.pendingLocalDataChannels.push(e$)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e$=>{let[t$,r$]=e$;Array.from(d_$1(r$).call(r$)).forEach(n$=>{this.setPendingRemoteDataChannel(t$,n$)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),fb$1.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e$,t$){for(const r$ of this.pendingRemoteDataChannels){const{user:n$,id:i$}=r$;if((e$ instanceof cF$1?e$.uid:e$)===n$.uid&&i$===t$)return!0}return!1}setPendingRemoteDataChannel(e$,t$){this.hasPendingRemoteDataChannel(e$,t$)||this.pendingRemoteDataChannels.push({user:e$,id:t$})}hasPendingRemoteMedia(e$,t$){for(const r$ of this.pendingRemoteTracks){const{user:n$,kind:i$}=r$;if((e$ instanceof cF$1?e$.uid:e$)===n$.uid&&t$===i$)return!0}return!1}setPendingRemoteMedia(e$,t$){this.hasPendingRemoteMedia(e$,t$)||this.pendingRemoteTracks.push({user:e$,kind:t$})}restartICE(e$){var t$=this;return YI$1(function*(){if(!t$.connection||t$.state!==pO$1.Connected)return;const r$=yield qI$1(t$.mutex.lock("From P2PChannel.restartICE"));let n$;try{n$=yield qI$1(t$.connection.restartICE(e$));const o$=yield qI$1(n$.next());if(o$.done)return;const s$=o$.value,a$=yield s$;switch(t$.reportPCDisconnectedOrFailed(e$),e$){case lO$1.TCP:t$._pcStatsUploadType=uO$1.TCP_RESTART;break;case lO$1.RELAY:t$._pcStatsUploadType=uO$1.RELAY_RESTART;break;default:t$._pcStatsUploadType=uO$1.OLD_RESTART}t$._isInRestartIce=!0,n$.next(a$)}catch(o$){var i$;(i$=n$)===null||i$===void 0||i$.throw(o$)}finally{r$()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e$=this.connection.getStats(),t$=this.localTrackMap.get(hO$1.LocalVideoTrack),r$=this.localTrackMap.get(hO$1.LocalAudioTrack),n$=e$.videoSend.find(p$=>p$.ssrc===(t$==null?void 0:t$.ssrcs[0].ssrcId)),i$=e$.audioSend.find(p$=>p$.ssrc===(r$==null?void 0:r$.ssrcs[0].ssrcId));if(!n$||!i$)return 1;const o$=eA$1(this,_O$1.NeedSignalRTT),s$=n$?n$.rttMs:void 0,a$=i$?i$.rttMs:void 0,c$=s$&&a$?(s$+a$)/2:s$||a$,u$=(c$&&o$?(c$+o$)/2:c$||o$)||0,l$=100*e$.sendPacketLossRate*.7/50+.3*u$/1500,d$=l$<.17?1:l$<.36?2:l$<.59?3:l$<.1?4:5,h$=t$==null?void 0:t$.track;if(h$&&h$._encoderConfig&&h$._hints.indexOf(mL$1.SCREEN_TRACK)===-1){const p$=h$._encoderConfig.bitrateMax,_$=e$.bitrate.actualEncoded;if(p$&&_$){const f$=(1e3*p$-_$)/(1e3*p$);return bb$1[f$<.15?0:f$<.3?1:f$<.45?2:f$<.6?3:4][d$]}}return d$}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e$=this.connection.getStats();let t$=0;return Array.from(this.remoteUserMap.entries()).forEach(r$=>{let[n$]=r$;const i$=n$._audioSSRC,o$=n$._videoSSRC,s$=e$.audioRecv.find(_$=>_$.ssrc===i$),a$=e$.videoRecv.find(_$=>_$.ssrc===o$);if(!s$&&!a$)return void(t$+=1);const c$=eA$1(this,_O$1.NeedSignalRTT),u$=e$.rtt,l$=(u$&&c$?(u$+c$)/2:u$||c$)||0,d$=s$?s$.jitterMs:void 0,h$=e$.recvPacketLossRate;let p$=.7*h$*100/50+.3*l$/1500;d$&&(p$=.6*h$*100/50+.2*l$/1500+.2*d$/400),t$+=p$<.1?1:p$<.17?2:p$<.36?3:p$<.59?4:5}),this.remoteUserMap.size>0?Math.round(t$/this.remoteUserMap.size):t$}async muteLocalTrack(e$){return new Gh$1((t$,r$)=>{this.handleMuteLocalTrack(e$,t$,r$)})}async replaceTrack(e$,t$){var r$;if(fb$1.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e$.getTrackId(),"] to [").concat(t$.getTrackId(),"]")),!this.connection||this.state!==pO$1.Connected)return;const n$=Array.from(this.localTrackMap.entries()).find(o$=>{let[,{track:s$}]=o$;return e$===s$});if(!n$)return;const i$=n$[0];if(e$!==t$&&(this.unbindLocalTrackEvents([{track:e$,type:i$}]),this.bindLocalTrackEvents([{track:t$,type:i$}]),n$[1].track=t$),await((r$=this.connection)===null||r$===void 0?void 0:r$.replaceTrack(t$,n$[1].id)),this.isPlanB){const o$=n$[1];o$.id=t$._mediaStreamTrack.id,this.localTrackMap.set(i$,o$)}if(i$===hO$1.LocalVideoTrack&&!XA$1("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP$1().supportDualStreamEncoding){const o$=this.localTrackMap.get(hO$1.LocalVideoLowTrack);if(o$){const s$=e$._mediaStreamTrack.clone();o$.track._originMediaStreamTrack.stop(),o$.track._mediaStreamTrack=s$,o$.track._originMediaStreamTrack=s$,await new Gh$1((a$,c$)=>{this.handleReplaceTrack(o$.track,a$,c$,!0)})}}}filterTobePublishedTracks(e$,t$,r$){const n$=[],i$=this.getAllTracks();e$=rA$1(e$=e$.filter(c$=>i$.indexOf(c$)===-1));let o$,s$=!1;const a$=this.localTrackMap.get(hO$1.LocalAudioTrack);for(const c$ of e$){if(c$ instanceof aU$1&&(this.localTrackMap.has(hO$1.LocalVideoTrack)||s$?new Cy$1(Ry$1.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n$.push({track:c$,type:hO$1.LocalVideoTrack}),s$=!0),t$)){const u$=this.getLowVideoTrack(c$,r$);n$.push({track:u$,type:hO$1.LocalVideoLowTrack})}if(c$ instanceof TM$1)if(a$){const u$=a$.track;if(u$ instanceof RM$1)uF$1([c$]),u$.addAudioTrack(c$),this.bindLocalAudioTrackEvents(c$,!0);else{const l$=hF$1([u$,c$]);fb$1.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(l$.getTrackId(),"]")),this.replaceTrack(u$,l$)}}else o$ instanceof RM$1?(uF$1([c$]),o$.addAudioTrack(c$)):o$||!c$._useAudioElement&&ZP$1().webAudioMediaStreamDest&&!c$._bypassWebAudio?o$=hF$1(o$?[c$,o$]:[c$]):o$=c$}return o$&&(fb$1.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o$.getTrackId(),"]")),n$.push({track:o$,type:hO$1.LocalAudioTrack})),n$}filterTobeUnpublishedTracks(e$){const t$=[],r$=this.getAllTracks();e$=rA$1(e$=e$.filter(n$=>r$.indexOf(n$)!==-1));for(const n$ of e$){if(n$ instanceof TM$1){const i$=this.localTrackMap.get(hO$1.LocalAudioTrack);if(!i$)continue;i$.track instanceof RM$1?(i$.track.removeAudioTrack(n$),this.unbindLocalAudioTrackEvents(n$),i$.track.trackList.length===0&&(t$.push([hO$1.LocalAudioTrack,i$]),i$.track.close())):t$.push([hO$1.LocalAudioTrack,i$])}if(n$ instanceof aU$1){const i$=this.localTrackMap.get(hO$1.LocalVideoTrack);if(!i$)continue;t$.push([hO$1.LocalVideoTrack,i$]);const o$=this.localTrackMap.get(hO$1.LocalVideoLowTrack);o$&&t$.push([hO$1.LocalVideoLowTrack,o$])}}return t$}filterTobePublishedDataChannels(e$){return e$=(e$=rA$1(e$)).filter(t$=>this.localDataChannels.findIndex(r$=>r$.id===t$.id)===-1)}filterTobeUnpublishedDataChannels(e$){return e$=(e$=(e$=rA$1(e$)).filter(t$=>this.localDataChannels.indexOf(t$)!==-1)).filter(t$=>t$._originDataChannel)}bindLocalTrackEvents(e$){e$.forEach(t$=>{let{track:r$,type:n$}=t$;switch(n$){case hO$1.LocalVideoTrack:r$.addListener(fL$1.GET_STATS,this.handleGetLocalVideoStats),r$.addListener(fL$1.GET_RTC_STATS,this.handleGetRTCStats),r$.addListener(fL$1.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r$.addListener(fL$1.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r$.addListener(fL$1.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r$.addListener(fL$1.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r$.addListener(fL$1.NEED_REPLACE_TRACK,this.handleReplaceTrack),r$.addListener(fL$1.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r$.addListener(fL$1.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case hO$1.LocalAudioTrack:this.bindLocalAudioTrackEvents(r$);case hO$1.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e$,t$){e$ instanceof RM$1?e$.trackList.forEach(r$=>{r$.addListener(fL$1.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r$.addListener(fL$1.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r$.addListener(fL$1.GET_STATS,this.handleGetLocalAudioStats),r$.addListener(fL$1.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r$.addListener(fL$1.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e$.addListener(fL$1.GET_STATS,this.handleGetLocalAudioStats),e$.addListener(fL$1.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e$.addListener(fL$1.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e$.addListener(fL$1.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e$.addListener(fL$1.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t$||(e$.addListener(fL$1.NEED_REPLACE_TRACK,this.handleReplaceTrack),e$.addListener(fL$1.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e$){e$||(e$=Array.from(this.localTrackMap.entries()).map(t$=>{let[r$,{track:n$}]=t$;return{track:n$,type:r$}})),e$.forEach(t$=>{let{track:r$,type:n$}=t$;switch(n$){case hO$1.LocalVideoTrack:r$.off(fL$1.GET_STATS,this.handleGetLocalVideoStats),r$.off(fL$1.GET_RTC_STATS,this.handleGetRTCStats),r$.off(fL$1.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r$.off(fL$1.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r$.off(fL$1.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r$.off(fL$1.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r$.off(fL$1.NEED_REPLACE_TRACK,this.handleReplaceTrack),r$.off(fL$1.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r$.off(fL$1.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case hO$1.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r$);case hO$1.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e$){e$ instanceof RM$1?e$.trackList.forEach(t$=>{t$.off(fL$1.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t$.off(fL$1.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t$.off(fL$1.GET_STATS,this.handleGetLocalAudioStats),t$.off(fL$1.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t$.off(fL$1.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e$.off(fL$1.GET_STATS,this.handleGetLocalAudioStats),e$.off(fL$1.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e$.off(fL$1.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e$.off(fL$1.NEED_REPLACE_TRACK,this.handleReplaceTrack),e$.off(fL$1.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e$.off(fL$1.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e$.off(fL$1.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e$,t$){t$ instanceof IU$1&&t$.addListener(fL$1.GET_STATS,r$=>{r$(this.handleGetRemoteVideoStats(e$))}),t$ instanceof vU$1&&t$.addListener(fL$1.GET_STATS,r$=>{r$(this.handleGetRemoteAudioStats(e$))})}unbindRemoteTrackEvents(e$){e$&&e$.removeAllListeners(fL$1.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e$=>{let[t$,r$]=e$;r$.has(dO$1.AUDIO)&&this.unbindRemoteTrackEvents(t$._audioTrack),r$.has(dO$1.VIDEO)&&this.unbindRemoteTrackEvents(t$._videoTrack)})}createGatewayPublishMessage(e$,t$){return e$.map((r$,n$)=>{var i$;let o$,s$,{track:a$,type:c$}=r$;switch(c$){case hO$1.LocalAudioTrack:o$=Zw$1.Audio,s$={dtx:a$ instanceof SM$1&&a$._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case hO$1.LocalVideoTrack:o$=Dn$1(i$=a$._hints).call(i$,mL$1.SCREEN_TRACK)?Zw$1.Screen:Zw$1.High,s$=pB$1(pB$1({},ZO$1(a$)),{},{codec:this.store.codec,svc_mode:BU$1()});break;case hO$1.LocalVideoLowTrack:o$=Zw$1.Low,s$=pB$1(pB$1({},ZO$1(a$)),{},{codec:this.store.codec,svc_mode:BU$1()})}return{stream_type:o$,attributes:s$,ssrcs:t$[n$]}})}createGatewayUnpublishMessage(e$){return e$.map(t$=>{var r$;let n$,[i$,{track:o$,ssrcs:s$,id:a$}]=t$;switch(i$){case hO$1.LocalVideoTrack:n$=Dn$1(r$=o$._hints).call(r$,mL$1.SCREEN_TRACK)?Zw$1.Screen:Zw$1.High;break;case hO$1.LocalAudioTrack:n$=Zw$1.Audio;break;case hO$1.LocalVideoLowTrack:n$=Zw$1.Low}return{stream_type:n$,ssrcs:s$,mid:a$}})}assignLocalTracks(e$,t$){e$.forEach((r$,n$)=>{let{track:i$,type:o$}=r$;this.localTrackMap.set(o$,{track:i$,id:t$[n$].id,ssrcs:t$[n$].localSSRC})})}withdrawLocalTracks(e$){e$.forEach(t$=>{let[r$]=t$;this.localTrackMap.delete(r$)})}bindConnectionEvents(e$){e$.onConnectionStateChange=async t$=>{if(fb$1.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t$,")")),this.emit(_O$1.PeerConnectionStateChange,t$),t$!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t$==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),XA$1("NEW_ICE_RESTART")){var r$;if(Dn$1(r$=this._restartStates).call(r$,t$)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n$=s$=>{(e$.iceConnectionState==="disconnected"||e$.iceConnectionState==="checking"||e$.iceConnectionState==="failed")&&(fb$1.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(s$)),eA$1(this,_O$1.QueryClientConnectionState)==="CONNECTED"&&this.emit(_O$1.RequestRestartICE,s$))},i$=()=>{e$.iceConnectionState!=="disconnected"&&e$.iceConnectionState!=="checking"&&e$.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),fb$1.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(_O$1.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},o$=XA$1("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(XA$1("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&ZP$1().supportPCSetConfiguration)n$(lO$1.RELAY),this._restartTimer=window.setTimeout(i$,o$);else if(Zv$1())n$(lO$1.UDP),this._restartTimer=window.setTimeout(i$,4e3);else{if(n$(lO$1.TCP),ZP$1().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{n$(lO$1.RELAY),this._restartTimer=window.setTimeout(i$,o$)},o$));this._restartTimer=window.setTimeout(i$,o$)}},800))}}else{if(t$==="disconnected"&&e$.iceConnectionState==="disconnected")return setTimeout(()=>{e$.iceConnectionState==="disconnected"&&XA$1("ICE_RESTART")&&eA$1(this,_O$1.QueryClientConnectionState)==="CONNECTED"&&this.emit(_O$1.RequestRestartICE)},800),void setTimeout(()=>{e$.peerConnectionState==="disconnected"&&(fb$1.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(_O$1.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t$==="failed"&&(fb$1.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(_O$1.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e$.onICEConnectionStateChange=t$=>{t$!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),fb$1.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t$,")")),vb$1.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t$,tag:jy$1.TRACER}).onSuccess(),this.emit(_O$1.IceConnectionStateChange,t$)},e$.onICETransportStateChange=t$=>{fb$1.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t$,")"))},e$.onDTLSTransportStateChange=t$=>{fb$1.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t$,")"))},e$.onDTLSTransportError=t$=>{fb$1.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t$,")"))},e$.onFirstAudioDecoded=t$=>{var r$;const n$=Array.from(d_$1(r$=this.remoteUserMap).call(r$)).find(o$=>o$._audioSSRC===t$);var i$;n$&&(this.store.subscribe(n$.uid,"audio",void 0,void 0,void 0,Date.now()),(i$=n$.audioTrack)===null||i$===void 0||i$.emit(IL$1.FIRST_FRAME_DECODED),vb$1.firstRemoteFrame(this.store.sessionId,gb$1.FIRST_AUDIO_DECODE,Rb$1.FIRST_AUDIO_DECODE,{peer:n$._uintid,subscribeElapse:rV$1.measureFromSubscribeStart(this.store.clientId,t$),subscribeRequestid:t$,p2pid:this.store.p2pId}))},e$.onFirstAudioReceived=t$=>{var r$;const n$=Array.from(d_$1(r$=this.remoteUserMap).call(r$)).find(i$=>i$._audioSSRC===t$);n$&&vb$1.firstRemoteFrame(this.store.sessionId,gb$1.FIRST_AUDIO_RECEIVED,Rb$1.FIRST_AUDIO_RECEIVED,{peer:n$._uintid,subscribeElapse:rV$1.measureFromSubscribeStart(this.store.clientId,t$),subscribeRequestid:t$,p2pid:this.store.p2pId})},e$.onFirstVideoDecoded=(t$,r$,n$)=>{this.reportVideoFirstFrameDecoded(t$,r$,n$)},e$.onFirstVideoReceived=t$=>{var r$;const n$=Array.from(d_$1(r$=this.remoteUserMap).call(r$)).find(i$=>i$._videoSSRC===t$);n$&&vb$1.firstRemoteFrame(this.store.sessionId,gb$1.FIRST_VIDEO_RECEIVED,Rb$1.FIRST_VIDEO_RECEIVED,{peer:n$._uintid,subscribeElapse:rV$1.measureFromSubscribeStart(this.store.clientId,t$),subscribeRequestid:t$,p2pid:this.store.p2pId})},e$.onSelectedLocalCandidateChanged=(t$,r$)=>{const n$=t$.candidateType==="relay",i$=r$.candidateType==="relay";r$.candidateType!=="unknown"&&n$===i$||this.emit(_O$1.ConnectionTypeChange,n$),fb$1.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(nN$1(r$))," -> ").concat(JSON.stringify(nN$1(t$)),")"))},e$.onSelectedRemoteCandidateChanged=(t$,r$)=>{fb$1.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(nN$1(r$))," -> ").concat(JSON.stringify(nN$1(t$)),")"))},e$.onFirstVideoDecodedTimeout=t$=>{this.reportVideoFirstFrameDecoded(t$,void 0,void 0,!0)},e$.getLocalVideoStats=()=>{const t$=this.statsCollector.getLocalVideoTrackStats(),r$=this.statsCollector.getRTCStats();return pB$1(pB$1({},t$),r$)}}unbindConnectionEvents(e$){e$.onConnectionStateChange=void 0,e$.onICEConnectionStateChange=void 0,e$.onICETransportStateChange=void 0,e$.onDTLSTransportStateChange=void 0,e$.onDTLSTransportError=void 0,e$.onFirstAudioDecoded=void 0,e$.onFirstAudioReceived=void 0,e$.onFirstVideoDecoded=void 0,e$.onFirstVideoReceived=void 0,e$.onSelectedLocalCandidateChanged=void 0,e$.onSelectedRemoteCandidateChanged=void 0,e$.onFirstVideoDecodedTimeout=void 0,e$.getLocalVideoStats=void 0}filterTobeMutedTracks(e$){const t$=[];if(this.getAllTracks().indexOf(e$)===-1)return t$;const r$=this.localTrackMap.get(hO$1.LocalAudioTrack);if(e$ instanceof TM$1&&(r$==null?void 0:r$.track)instanceof RM$1)return r$.track.isActive||t$.push([hO$1.LocalAudioTrack,r$]),t$;const n$=Array.from(this.localTrackMap.entries()).find(i$=>{let[,{track:o$}]=i$;return e$===o$});if(n$&&(t$.push(n$),n$[0]===hO$1.LocalVideoTrack)){const i$=this.localTrackMap.get(hO$1.LocalVideoLowTrack);i$&&t$.push([hO$1.LocalVideoLowTrack,i$])}return t$}filterTobeUnmutedTracks(e$){const t$=[],r$=this.localTrackMap.get(hO$1.LocalAudioTrack);if(e$ instanceof TM$1&&(r$==null?void 0:r$.track)instanceof RM$1)return r$.track.isActive&&t$.push([hO$1.LocalAudioTrack,r$]),t$;const n$=Array.from(this.localTrackMap.entries()).find(i$=>{let[,{track:o$}]=i$;return e$===o$});if(n$)if(n$[0]===hO$1.LocalVideoTrack){t$.push(n$);const i$=this.localTrackMap.get(hO$1.LocalVideoLowTrack);i$&&t$.push([hO$1.LocalVideoLowTrack,i$])}else t$.push(n$);return t$}createMuteMessage(e$){return e$.map(t$=>{var r$;let n$,[i$,{track:o$,ssrcs:s$,id:a$}]=t$;switch(i$){case hO$1.LocalAudioTrack:n$=Zw$1.Audio;break;case hO$1.LocalVideoTrack:n$=Dn$1(r$=o$._hints).call(r$,mL$1.SCREEN_TRACK)?Zw$1.Screen:Zw$1.High;break;case hO$1.LocalVideoLowTrack:n$=Zw$1.Low}return{stream_type:n$,ssrcs:s$,mid:a$}})}createUnmuteMessage(e$){return e$.map(t$=>{var r$;let n$,[i$,{track:o$,ssrcs:s$,id:a$}]=t$;switch(i$){case hO$1.LocalAudioTrack:n$=Zw$1.Audio;break;case hO$1.LocalVideoTrack:n$=Dn$1(r$=o$._hints).call(r$,mL$1.SCREEN_TRACK)?Zw$1.Screen:Zw$1.High;break;case hO$1.LocalVideoLowTrack:n$=Zw$1.Low}return{stream_type:n$,ssrcs:s$,mid:a$}})}filterTobeUnSubscribedTracks(e$,t$){const r$=[],n$=this.remoteUserMap.get(e$);if(!n$)return r$;if(t$){const i$=n$.get(t$);if(!i$)return r$;r$.push([e$,{kind:t$,id:i$}])}else Array.from(n$.entries()).forEach(i$=>{let[o$,s$]=i$;r$.push([e$,{kind:o$,id:s$}])});return r$}filterTobeUnSubscribedDataChannels(e$,t$){const r$=[];return t$.forEach(n$=>{var i$;(i$=this.remoteDataChannelMap.get(e$))!==null&&i$!==void 0&&i$.has(n$.id)&&r$.push(n$)}),r$}createUnsubscribeMessage(e$){const t$=[];return e$.forEach(r$=>{let[n$,{kind:i$,id:o$}]=r$;switch(i$){case dO$1.VIDEO:return void(n$._videoSSRC&&t$.push({stream_type:dO$1.VIDEO,ssrcId:n$._videoSSRC}));case dO$1.AUDIO:return void(n$._audioSSRC&&t$.push({stream_type:dO$1.AUDIO,ssrcId:n$._audioSSRC}))}}),t$}createUnsubscribeAllMessage(e$){const t$=new Map;return e$.forEach(r$=>{let[n$,{kind:i$}]=r$;if(t$.has(n$)){let o$=t$.get(n$);i$===dO$1.VIDEO?o$|=tO$1.Video:o$|=tO$1.Audio,t$.set(n$,o$)}else i$===dO$1.VIDEO?t$.set(n$,tO$1.Video):t$.set(n$,tO$1.Audio)}),{users:Array.from(t$.entries()).map(r$=>{let[n$,i$]=r$;return{stream_id:n$.uid,stream_type:i$}})}}withdrawRemoteTracks(e$){e$.forEach(t$=>{let[r$,{kind:n$}]=t$;const i$=this.remoteUserMap.get(r$);i$&&(i$.delete(n$),Array.from(i$.entries()).length===0&&this.remoteUserMap.delete(r$))})}async updateBitrateLimit(e$){const t$=this.localTrackMap.get(hO$1.LocalVideoTrack),r$=this.localTrackMap.get(hO$1.LocalVideoLowTrack);t$&&await t$.track.setBitrateLimit(e$.uplink),r$&&e$.low_stream_uplink&&await r$.track.setBitrateLimit({max_bitrate:e$.low_stream_uplink.bitrate,min_bitrate:e$.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e$,t$,r$){return e$.map((n$,i$)=>{var o$;let{stream_type:s$}=n$;const a$=(o$=t$.find(c$=>{let{stream_type:u$}=c$;return s$===u$}))===null||o$===void 0?void 0:o$.attributes;if(a$&&XA$1("DISABLE_SCREEN_SHARE_REMB")){const c$=r$[i$]._hints;(Dn$1(c$).call(c$,mL$1.SCREEN_TRACK)||Dn$1(c$).call(c$,mL$1.SCREEN_LOW_TRACK))&&(a$.remb=!1,fb$1.debug("disable remb for screen share, hints:",c$))}return a$})}async tryToUnmuteAudio(e$){for(let r$=0;r$<e$.length;r$++)if(e$[r$]instanceof TM$1){var t$;const n$=this.filterTobeUnmutedTracks(e$[r$]);if(n$.length===0)continue;await((t$=this.connection)===null||t$===void 0?void 0:t$.unmuteLocal(n$.map(o$=>{let[,{id:s$}]=o$;return s$})));const i$=this.createUnmuteMessage(n$);return void await $y$1(this,_O$1.RequestUnmuteLocal,i$)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e$=>{var t$;return!((t$=this.connection)===null||t$===void 0||!t$.getRemoteVideoIsReady(e$))},this.statsUploader.requestUpload=(e$,t$)=>this.emit(_O$1.RequestUpload,e$,t$),this.statsUploader.requestUploadStats=e$=>this.emit(_O$1.RequestUploadStats,e$),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await mA$1(LA$1(this.dtlsFailedCount,PA$1)),this.emit(_O$1.RequestReconnect)}async reconnectP2P(){const e$=Array.from(this.localTrackMap.entries()),t$=this.createGatewayUnpublishMessage(e$);Array.from(this.remoteUserMap.entries()),t$.length>0&&await Zy$1(this,_O$1.RequestUnpublishForReconnectPC,t$),this.disconnectForReconnect(),this.emit(_O$1.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(hO$1.LocalVideoTrack)||this.pendingLocalTracks.some(e$=>e$ instanceof aU$1)}throwIfTrackTypeNotMatch(e$){if(e$.filter(t$=>t$ instanceof aU$1).length>1)throw new Cy$1(Ry$1.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e$.filter(t$=>t$ instanceof TM$1).length>1&&(e$.some(t$=>t$ instanceof TM$1&&t$._bypassWebAudio)||!ZP$1().webAudioMediaStreamDest))throw new Cy$1(Ry$1.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t$ of e$){if(t$ instanceof aU$1&&this.pendingLocalTracks.some(r$=>r$ instanceof aU$1))throw new Cy$1(Ry$1.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t$ instanceof TM$1&&this.pendingLocalTracks.some(r$=>r$ instanceof TM$1)&&(!ZP$1().webAudioMediaStreamDest||t$._bypassWebAudio||this.pendingLocalTracks.some(r$=>r$ instanceof TM$1&&r$._bypassWebAudio)))throw new Cy$1(Ry$1.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e$,t$){var r$;const n$=!XA$1("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP$1().supportDualStreamEncoding,i$=pB$1(pB$1({},{width:160,height:120,framerate:15,bitrate:50}),t$);let o$;o$=n$?e$._mediaStreamTrack.clone():KV$1(e$,i$);const s$=TA$1(8,"track-low-"),a$=new aU$1(o$,pB$1(pB$1({},n$&&{scaleResolutionDownBy:iN$1(i$,e$)}),{},{frameRate:i$.framerate,bitrateMax:i$.bitrate,bitrateMin:i$.bitrate}),void 0,void 0,s$);return a$.on(RL$1.TRANSCEIVER_UPDATED,c$=>{e$._updateRtpTransceiver(c$,TL$1.LOW_STREAM)}),a$._hints.push(mL$1.LOW_STREAM),Dn$1(r$=e$._hints).call(r$,mL$1.SCREEN_TRACK)&&a$._hints.push(mL$1.SCREEN_LOW_TRACK),e$.on("sei-to-send",c$=>{a$.emit("sei-to-send",c$)}),e$.addListener(fL$1.NEED_CLOSE,()=>{a$.close()}),a$}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e$,t$,r$){let n$=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof dB$1){var i$,o$,s$,a$;const c$=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:u$,dtlsTransportState:l$,peerConnectionState:d$}=this.connection,{local:h$,remote:p$}=await this.connection.getSelectedCandidatePair();vb$1.pcStats(this.store.sessionId,{startTime:c$,eventElapse:e$-c$||0,iceconnectionsate:u$,dtlsstate:l$,connectionstate:d$,intSucc:t$?1:2,error:n$,selectedLocalCandidateProtocol:(i$=h$==null?void 0:h$.protocol)!==null&&i$!==void 0?i$:"",selectedLocalCandidateType:(o$=h$.candidateType)!==null&&o$!==void 0?o$:"",selectedLocalCandidateAddress:"".concat(h$.address,":").concat(h$.port),selectedRemoteCandidateProtocol:(s$=p$.protocol)!==null&&s$!==void 0?s$:"",selectedRemoteCandidateType:(a$=p$.candidateType)!==null&&a$!==void 0?a$:"",selectedRemoteCandidateAddress:"".concat(p$.address,":").concat(p$.port),restartCnt:r$,preallocation:this.connection.isPreallocation})}}reportVideoFirstFrameDecoded(e$,t$,r$,n$){var i$;const o$=Array.from(d_$1(i$=this.remoteUserMap).call(i$)).find(s$=>s$._videoSSRC===e$);if(o$){n$||this.store.subscribe(o$.uid,"video",void 0,void 0,void 0,void 0,Date.now());const s$=this.store.keyMetrics,a$=s$.subscribe.find(c$=>c$.userId===o$.uid&&c$.type==="video");vb$1.firstRemoteVideoDecode(this.store.sessionId,gb$1.FIRST_VIDEO_DECODE,Rb$1.FIRST_VIDEO_DECODE,{peer:o$._uintid,videowidth:t$,videoheight:r$,subscribeElapse:rV$1.measureFromSubscribeStart(this.store.clientId,e$),subscribeRequestid:e$,p2pid:this.store.p2pId,apEnd:s$.requestAPEnd||0,apStart:s$.requestAPStart||0,joinGwEnd:s$.joinGatewayEnd||0,joinGwStart:s$.joinGatewayStart||0,pcEnd:s$.peerConnectionEnd||0,pcStart:s$.peerConnectionStart||0,subscriberEnd:(a$==null?void 0:a$.subscribeEnd)||0,subscriberStart:(a$==null?void 0:a$.subscribeStart)||0,videoAddNotify:(a$==null?void 0:a$.streamAdded)||0,state:n$?1:0,firstFrame:(a$==null?void 0:a$.firstFrame)||0})}}async remoteMediaSsrcChanged(e$,t$,r$){if(!this.connection)return!1;const n$=this.remoteUserMap.get(e$);if(!n$)return!1;const i$=n$.get(t$);if(!i$)return!1;const o$=await this.connection.getRemoteSSRC(i$);return o$!==void 0&&o$!==r$}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e$=>{let[t$,{track:r$}]=e$;t$===hO$1.LocalVideoLowTrack?r$._updateRtpTransceiver(void 0,TL$1.LOW_STREAM):r$._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e$){this.connection&&this.connection instanceof dB$1&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===uO$1.TCP_RESTART&&e$===lO$1.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,uO$1.DISCONNECTED_OR_FAILED)))}},Cw$1(uB$1.prototype,"startP2PConnection",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"startP2PConnection"),uB$1.prototype),Cw$1(uB$1.prototype,"connect",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"connect"),uB$1.prototype),Cw$1(uB$1.prototype,"updateRemoteRTPCapabilities",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"updateRemoteRTPCapabilities"),uB$1.prototype),Cw$1(uB$1.prototype,"publishDataChannel",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"publishDataChannel"),uB$1.prototype),Cw$1(uB$1.prototype,"unpublish",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"unpublish"),uB$1.prototype),Cw$1(uB$1.prototype,"unpublishDataChannel",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"unpublishDataChannel"),uB$1.prototype),Cw$1(uB$1.prototype,"unpublishLowStream",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"unpublishLowStream"),uB$1.prototype),Cw$1(uB$1.prototype,"subscribeDataChannel",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"subscribeDataChannel"),uB$1.prototype),Cw$1(uB$1.prototype,"subscribe",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"subscribe"),uB$1.prototype),Cw$1(uB$1.prototype,"massSubscribe",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"massSubscribe"),uB$1.prototype),Cw$1(uB$1.prototype,"unsubscribe",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"unsubscribe"),uB$1.prototype),Cw$1(uB$1.prototype,"unsubscribeDataChannel",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"unsubscribeDataChannel"),uB$1.prototype),Cw$1(uB$1.prototype,"massUnsubscribe",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"massUnsubscribe"),uB$1.prototype),Cw$1(uB$1.prototype,"muteRemote",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"muteRemote"),uB$1.prototype),Cw$1(uB$1.prototype,"unmuteRemote",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"unmuteRemote"),uB$1.prototype),Cw$1(uB$1.prototype,"hasRemoteMediaWithLock",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"hasRemoteMediaWithLock"),uB$1.prototype),Cw$1(uB$1.prototype,"disconnectForReconnect",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"disconnectForReconnect"),uB$1.prototype),Cw$1(uB$1.prototype,"updateBitrateLimit",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"updateBitrateLimit"),uB$1.prototype),Cw$1(uB$1.prototype,"remoteMediaSsrcChanged",[mB$1],Object.getOwnPropertyDescriptor(uB$1.prototype,"remoteMediaSsrcChanged"),uB$1.prototype),uB$1);function mB$1(e$,t$,r$){const n$=e$[t$];if(typeof n$!="function")throw new Error("Cannot use mutex on object property.");return r$.value=async function(){const i$=this.mutex,o$=await i$.lock("From P2PChannel.".concat(t$));try{for(var s$=arguments.length,a$=new Array(s$),c$=0;c$<s$;c$++)a$[c$]=arguments[c$];return await n$.apply(this,a$)}finally{o$()}},r$}const TB$1={};function SB$1(e$){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&fb$1.debug("install service ".concat(e$.name)),TB$1[e$.name]=e$}function gB$1(e$){const t$=TB$1[e$];if(!t$)throw new Cy$1(Ry$1.INVALID_OPERATION,"".concat(e$," not found, please use AgoraRTC.use(").concat(e$,"Service) to load it first"));return t$}function RB$1(e$,t$){return gB$1("DataStream").create(e$,t$)}function CB$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function IB$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?CB$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):CB$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}const vB$1=Date.now(),yB$1=20,AB$1=new Map,bB$1=new Map;async function wB$1(e$){const t$=AB$1.get(e$),r$=Array.isArray(t$)&&t$[t$.length-1],n$=bB$1.get(e$);if(!r$)return void(n$.isSyncing=!1);const i$={uid:r$.uid,payload:r$.payload};n$.firstRecvTs===0&&(n$.firstRecvTs=r$.recvTs,n$.firstSendTs=r$.sendTs);const o$=r$.sendTs-n$.firstSendTs,s$=o$-(Date.now()-n$.firstRecvTs);s$>0&&(n$.firstRecvTs=Date.now()-o$);let a$=r$.mediaDelay+s$;a$<=0?(t$.pop(),OB$1(r$.context,i$),a$=0):a$=Math.min(a$,yB$1),setTimeout(()=>t$.length&&wB$1(e$),a$)}function OB$1(e$,t$){e$.safeEmit(zy$1.STREAM_MESSAGE,t$.uid,t$.payload),e$.onStreamMessage&&e$.onStreamMessage(t$)}function NB$1(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r$=arguments.length>2?arguments[2]:void 0;if(!e$.syncWithAudio)return OB$1(r$,{uid:e$.uid,payload:e$.payload});const n$="".concat(r$.id,"-").concat(e$.uid),i$=AB$1.get(n$)||[],o$=i$.findIndex(u$=>e$.sendTs>=u$.sendTs),s$=IB$1(IB$1({},e$),{},{context:r$,mediaDelay:t$,recvTs:Date.now()});o$===-1?i$.push(s$):i$.splice(o$,0,s$),AB$1.set(n$,i$);let a$=!1;var c$;bB$1.has(n$)?a$=!((c$=bB$1.get(n$))===null||c$===void 0||!c$.isSyncing):bB$1.set(n$,{isSyncing:a$,firstRecvTs:0,firstSendTs:0}),a$||wB$1(n$)}const DB$1=Hv$1().name;function PB$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function LB$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?PB$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):PB$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}const kB$1="websdk_ng_cache_parameter",MB$1=XA$1("MAX_PRELOAD_ASYNC_LENGTH"),UB$1=1e4,xB$1=new Map,VB$1=[];let FB$1=null,BB$1=0,jB$1=0;const GB$1=new Map,WB$1=function(e$,t$){const r$=[];let n$=0;const i$=async()=>{const o$=r$.shift();o$&&await o$(),r$.length>0&&n$<t$?i$():n$--};return async function(){for(var o$=arguments.length,s$=new Array(o$),a$=0;a$<o$;a$++)s$[a$]=arguments[a$];return new Gh$1(async(c$,u$)=>{r$.push(async()=>{try{const l$=await e$(...s$);c$(l$)}catch(l$){u$(l$)}}),n$<t$&&(n$++,i$())})}}(KB$1,MB$1),HB$1=Lv$1.CancelToken.source();async function KB$1(e$,t$,r$,n$,i$,o$){try{if(!XA$1("ENABLE_PRELOAD"))return;if(!ZP$1().supportWebCrypto)return void dA$1(()=>{fb$1.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!r$&&r$!==null)throw new Cy$1(Ry$1.INVALID_PARAMS,"Invalid token: ".concat(r$,". If you don not use token, set it to null"));r$&&by$1(r$,"token",1,2047),by$1(e$,"appid",1,2047),xw$1(t$),n$&&Vw$1(n$);const s$=SA$1();fb$1.debug("preload channel ".concat(t$,", uid is ").concat(n$));const a$={appId:e$,cname:t$,token:r$||e$,uid:typeof n$!="string"?n$:null,sid:s$,proxyServer:i$};let c$,u$;typeof n$=="string"?(a$.stringUid=n$,[u$,c$]=await Gh$1.all([qx$1(n$,{sid:s$,appId:e$},HB$1.token),Jx$1(LB$1(LB$1({},a$),{},{token:r$||e$,uid:0}),HB$1.token)]),a$.uid=u$.uid,c$.gatewayInfo.uid=a$.uid,c$.gatewayInfo.res.uid=a$.uid):(o$&&(a$.stringUid=o$),c$=await Jx$1(a$,HB$1.token));const l$={sid:s$,appId:e$,cname:t$,token:r$||e$,uid:a$.stringUid||n$,intUid:a$.uid||c$.gatewayInfo.uid,stringUid:a$.stringUid,ts:Date.now(),sua:u$,ap:c$};await async function(d$){let h$;try{d$.uid&&qB$1({appId:d$.appId,cname:d$.cname,token:d$.token,uid:d$.uid,stringUid:d$.stringUid});const p$=$B$1(d$),_$=await async function(m$,g$){try{const v$=await window.crypto.subtle.importKey("raw",hA$1(g$),"AES-GCM",!1,["encrypt"]),y$=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},v$,lA$1(window.btoa(JSON.stringify(m$))));return uA$1(new Uint8Array(y$))}catch{return}}(d$,d$.token||d$.appId);if(!_$)return;h$=QB$1(kB$1);const f$=h$?JSON.parse(h$):[];f$.push({[p$]:_$}),f$.length>XA$1("AP_CACHE_NUM")&&f$.shift(),ZB$1(kB$1,JSON.stringify(f$))}catch(p$){fb$1.warn("Error caching server parameters:",p$.message),ZB$1(kB$1,"")}}(l$),BB$1++}catch(s$){throw jB$1++,function(a$){FB$1||(FB$1=window.setTimeout(()=>{let u$="";GB$1.forEach((l$,d$)=>{u$+="".concat(d$,": ").concat(l$," ;")}),vb$1.reportApiInvoke(null,{name:By$1.PRELOAD,options:{success:BB$1,failed:jB$1,err:u$}}).onError(a$),BB$1=0,jB$1=0,GB$1.clear(),FB$1=null},UB$1));const c$=GB$1.get(a$.code)||0;GB$1.set(a$.code,c$+1)}(s$),s$}}async function YB$1(e$){try{if(XA$1("AP_REQUEST_DETAIL"))return;const t$=qB$1(e$);if(!t$||e$.cloudProxyServer!=="disabled")return;const r$=await async function(n$,i$){try{const o$=await window.crypto.subtle.importKey("raw",hA$1(i$),"AES-GCM",!1,["decrypt"]),s$=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},o$,lA$1(n$));return JSON.parse(window.atob(uA$1(new Uint8Array(s$))))}catch{return}}(t$,e$.token||e$.appId);if(!r$||!function(n$,i$){return n$.cname===i$.cname&&n$.appId===i$.appId&&n$.token===i$.token?i$.stringUid?n$.stringUid===i$.stringUid:typeof i$.uid=="number"?n$.uid===i$.uid:n$.uid==i$.uid:!1}(r$,e$))return;if(r$&&Date.now()-r$.ts<XA$1("AP_CACHE_LIFETIME"))return r$}catch(t$){fb$1.warn("Error get preloadInfo",t$.message)}}function qB$1(e$){let t$;try{if(t$=QB$1(kB$1),!t$)return;const r$=JSON.parse(t$),n$=$B$1(e$),i$=function(s$,a$){for(let c$=s$.length-1;c$>=0;c$--)if(a$(s$[c$]))return c$;return-1}(r$,s$=>n$ in s$);if(i$===-1)return;const o$=r$.splice(i$,1)[0];return ZB$1(kB$1,JSON.stringify(r$)),o$[n$]}catch(r$){fb$1.warn("Error delete preload info: ".concat(t$),r$.message),ZB$1(kB$1,"")}}function zB$1(e$){if(e$){let t$=xB$1.get(e$);t$&&(window.clearTimeout(t$),t$=null,xB$1.delete(e$)),Dn$1(VB$1).call(VB$1,e$)||e$.cloudProxyServer!=="disabled"||VB$1.push(e$)}if(xB$1.size<XA$1("AP_CACHE_NUM")&&VB$1.length>0){const t$=VB$1.shift();xB$1.set(t$,window.setTimeout(async()=>{const{appId:r$,cname:n$,token:i$,stringUid:o$,uid:s$,proxyServer:a$}=t$;try{await WB$1(r$,n$,i$,s$,a$,o$),xB$1.has(t$)&&zB$1(t$)}catch(c$){fb$1.warn("update preload failed",c$.message),JB$1(t$)}},XA$1("AP_UPDATE_INTERVAL")))}}function JB$1(e$){const t$=VB$1.indexOf(e$);t$!==-1&&VB$1.splice(t$,1);let r$=xB$1.get(e$);r$&&(window.clearTimeout(r$),r$=null,xB$1.delete(e$),zB$1())}function XB$1(e$,t$){const r$=e$.sua,n$=e$.ap;t$&&r$&&vb$1.reqUserAccount(e$.sid,{lts:r$.requestTime,elapse:r$.elapse,success:!0,serverAddr:r$.url,stringUid:t$,uid:e$.intUid,errorCode:null,extend:r$.req}),vb$1.reportResourceTiming(e$.ap.url,e$.sid),vb$1.joinWebProxyAP(e$.sid,{lts:n$.requestTime,elapse:n$.elapse,sucess:1,apServerAddr:n$.url,turnServerAddrList:n$.proxyInfo.addresses.map(i$=>i$.ip).join(","),eventType:"disabled",unilbsServerIds:[YO$1.CHOOSE_SERVER,YO$1.CLOUD_PROXY_FALLBACK].toString()}),vb$1.joinChooseServer(e$.sid,{lts:n$.requestTime,elapse:n$.elapse,succ:!0,csAddr:n$.url,opid:n$.opid,serverList:n$.gatewayInfo.gatewayAddrs.map(i$=>i$.address),ec:null,cid:n$.gatewayInfo.cid.toString(),uid:n$.gatewayInfo.uid.toString(),csIp:n$.gatewayInfo.csIp,unilbsServerIds:[YO$1.CHOOSE_SERVER].toString(),isHttp3:n$.isHttp3})}function QB$1(e$){return window.atob(window.localStorage.getItem(e$)||"")}function ZB$1(e$,t$){window.localStorage.setItem(e$,window.btoa(t$))}function $B$1(e$){let t$="".concat(e$.appId,"_").concat(e$.cname);return typeof e$.uid=="string"&&(t$+="_s_".concat(e$.uid)),typeof e$.uid=="number"&&(t$+="_".concat(e$.uid)),e$.token&&(t$+="_".concat(e$.token)),bA$1(t$)}function ej$1(e$){let t$=function(){const r$=rj$1.pop();return r$?(r$.offset=r$.limit=0,r$):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r$,n$){let i$=r$.appId;i$!==void 0&&(Ej$1(n$,10),uj$1(n$,i$));let o$=r$.cid;o$!==void 0&&(Ej$1(n$,16),Ej$1(n$,o$));let s$=r$.cname;s$!==void 0&&(Ej$1(n$,26),uj$1(n$,s$));let a$=r$.deviceId;a$!==void 0&&(Ej$1(n$,34),uj$1(n$,a$));let c$=r$.elapse;c$!==void 0&&(Ej$1(n$,40),mj$1(n$,c$));let u$=r$.fileSize;u$!==void 0&&(Ej$1(n$,48),mj$1(n$,nj$1(u$)));let l$=r$.height;l$!==void 0&&(Ej$1(n$,56),mj$1(n$,nj$1(l$)));let d$=r$.jpg;d$!==void 0&&(Ej$1(n$,66),Ej$1(n$,d$.length),dj$1(n$,d$));let h$=r$.networkType;h$!==void 0&&(Ej$1(n$,72),mj$1(n$,nj$1(h$)));let p$=r$.osType;p$!==void 0&&(Ej$1(n$,80),mj$1(n$,nj$1(p$)));let _$=r$.requestId;_$!==void 0&&(Ej$1(n$,90),uj$1(n$,_$));let f$=r$.sdkVersion;f$!==void 0&&(Ej$1(n$,98),uj$1(n$,f$));let m$=r$.sequence;m$!==void 0&&(Ej$1(n$,104),mj$1(n$,nj$1(m$)));let g$=r$.sid;g$!==void 0&&(Ej$1(n$,114),uj$1(n$,g$));let v$=r$.timestamp;v$!==void 0&&(Ej$1(n$,120),mj$1(n$,v$));let y$=r$.uid;y$!==void 0&&(Ej$1(n$,128),Ej$1(n$,y$));let S$=r$.vid;S$!==void 0&&(Ej$1(n$,136),Ej$1(n$,S$));let b$=r$.width;b$!==void 0&&(Ej$1(n$,144),mj$1(n$,nj$1(b$)));let $$=r$.service;$$!==void 0&&(Ej$1(n$,152),Ej$1(n$,$$));let C$=r$.callbackData;C$!==void 0&&(Ej$1(n$,162),Ej$1(n$,C$.length),dj$1(n$,C$));let N$=r$.ticket;N$!==void 0&&(Ej$1(n$,170),uj$1(n$,N$));let k$=r$.vendorConfigs;k$!==void 0&&(Ej$1(n$,178),uj$1(n$,k$))}(e$,t$),function(r$){let n$=r$.bytes,i$=r$.limit;return n$.length===i$?n$:n$.subarray(0,i$)}(t$)}function tj$1(e$){return function(r$){let n$={};e:for(;!sj$1(r$);){let i$=_j$1(r$);switch(i$>>>3){case 0:break e;case 1:n$.code=_j$1(r$);break;case 2:n$.msg=lj$1(r$,_j$1(r$));break;case 3:n$.requestId=lj$1(r$,_j$1(r$));break;case 4:n$.timestamp=fj$1(r$,!1);break;default:ij$1(r$,7&i$)}}return n$}({bytes:t$=e$,offset:0,limit:t$.length});var t$}function ij$1(e$,t$){switch(t$){case 0:for(;128&hj$1(e$););break;case 2:oj$1(e$,_j$1(e$));break;case 5:oj$1(e$,4);break;case 1:oj$1(e$,8);break;default:throw new Error("Unimplemented type: "+t$)}}function nj$1(e$){return{low:e$|=0,high:e$>>31,unsigned:e$>=0}}let rj$1=[];function oj$1(e$,t$){if(e$.offset+t$>e$.limit)throw new Error("Skip past limit");e$.offset+=t$}function sj$1(e$){return e$.offset>=e$.limit}function aj$1(e$,t$){let r$=e$.bytes,n$=e$.offset,i$=e$.limit,o$=n$+t$;if(o$>r$.length){let s$=new Uint8Array(2*o$);s$.set(r$),e$.bytes=s$}return e$.offset=o$,o$>i$&&(e$.limit=o$),n$}function cj$1(e$,t$){let r$=e$.offset;if(r$+t$>e$.limit)throw new Error("Read past limit");return e$.offset+=t$,r$}function dj$1(e$,t$){let r$=aj$1(e$,t$.length);e$.bytes.set(t$,r$)}function lj$1(e$,t$){let r$=cj$1(e$,t$),n$=String.fromCharCode,i$=e$.bytes,o$="",s$="";for(let a$=0;a$<t$;a$++){let c$,u$,l$,d$,h$=i$[a$+r$];128&h$?(224&h$)==192?a$+1>=t$?s$+=o$:(c$=i$[a$+r$+1],(192&c$)!=128?s$+=o$:(d$=(31&h$)<<6|63&c$,d$<128?s$+=o$:(s$+=n$(d$),a$++))):(240&h$)==224?a$+2>=t$?s$+=o$:(c$=i$[a$+r$+1],u$=i$[a$+r$+2],(49344&(c$|u$<<8))!=32896?s$+=o$:(d$=(15&h$)<<12|(63&c$)<<6|63&u$,d$<2048||d$>=55296&&d$<=57343?s$+=o$:(s$+=n$(d$),a$+=2))):(248&h$)==240?a$+3>=t$?s$+=o$:(c$=i$[a$+r$+1],u$=i$[a$+r$+2],l$=i$[a$+r$+3],(12632256&(c$|u$<<8|l$<<16))!=8421504?s$+=o$:(d$=(7&h$)<<18|(63&c$)<<12|(63&u$)<<6|63&l$,d$<65536||d$>1114111?s$+=o$:(d$-=65536,s$+=n$(55296+(d$>>10),56320+(1023&d$)),a$+=3))):s$+=o$:s$+=n$(h$)}return s$}function uj$1(e$,t$){let r$=t$.length,n$=0;for(let s$=0;s$<r$;s$++){let a$=t$.charCodeAt(s$);a$>=55296&&a$<=56319&&s$+1<r$&&(a$=(a$<<10)+t$.charCodeAt(++s$)-56613888),n$+=a$<128?1:a$<2048?2:a$<65536?3:4}Ej$1(e$,n$);let i$=aj$1(e$,n$),o$=e$.bytes;for(let s$=0;s$<r$;s$++){let a$=t$.charCodeAt(s$);a$>=55296&&a$<=56319&&s$+1<r$&&(a$=(a$<<10)+t$.charCodeAt(++s$)-56613888),a$<128?o$[i$++]=a$:(a$<2048?o$[i$++]=a$>>6&31|192:(a$<65536?o$[i$++]=a$>>12&15|224:(o$[i$++]=a$>>18&7|240,o$[i$++]=a$>>12&63|128),o$[i$++]=a$>>6&63|128),o$[i$++]=63&a$|128)}}function hj$1(e$){return e$.bytes[cj$1(e$,1)]}function pj$1(e$,t$){let r$=aj$1(e$,1);e$.bytes[r$]=t$}function _j$1(e$){let t$,r$=0,n$=0;do t$=hj$1(e$),r$<32&&(n$|=(127&t$)<<r$),r$+=7;while(128&t$);return n$}function Ej$1(e$,t$){for(t$>>>=0;t$>=128;)pj$1(e$,127&t$|128),t$>>>=7;pj$1(e$,t$)}function fj$1(e$,t$){let r$,n$=0,i$=0,o$=0;return r$=hj$1(e$),n$=127&r$,128&r$&&(r$=hj$1(e$),n$|=(127&r$)<<7,128&r$&&(r$=hj$1(e$),n$|=(127&r$)<<14,128&r$&&(r$=hj$1(e$),n$|=(127&r$)<<21,128&r$&&(r$=hj$1(e$),i$=127&r$,128&r$&&(r$=hj$1(e$),i$|=(127&r$)<<7,128&r$&&(r$=hj$1(e$),i$|=(127&r$)<<14,128&r$&&(r$=hj$1(e$),i$|=(127&r$)<<21,128&r$&&(r$=hj$1(e$),o$=127&r$,128&r$&&(r$=hj$1(e$),o$|=(127&r$)<<7))))))))),{low:n$|i$<<28,high:i$>>>4|o$<<24,unsigned:t$}}function mj$1(e$,t$){let r$=t$.low>>>0,n$=(t$.low>>>28|t$.high<<4)>>>0,i$=t$.high>>>24,o$=i$===0?n$===0?r$<16384?r$<128?1:2:r$<1<<21?3:4:n$<16384?n$<128?5:6:n$<1<<21?7:8:i$<128?9:10,s$=aj$1(e$,o$),a$=e$.bytes;switch(o$){case 10:a$[s$+9]=i$>>>7&1;case 9:a$[s$+8]=o$!==9?128|i$:127&i$;case 8:a$[s$+7]=o$!==8?n$>>>21|128:n$>>>21&127;case 7:a$[s$+6]=o$!==7?n$>>>14|128:n$>>>14&127;case 6:a$[s$+5]=o$!==6?n$>>>7|128:n$>>>7&127;case 5:a$[s$+4]=o$!==5?128|n$:127&n$;case 4:a$[s$+3]=o$!==4?r$>>>21|128:r$>>>21&127;case 3:a$[s$+2]=o$!==3?r$>>>14|128:r$>>>14&127;case 2:a$[s$+1]=o$!==2?r$>>>7|128:r$>>>7&127;case 1:a$[s$]=o$!==1?128|r$:127&r$}}const Tj$1={},Sj$1={},gj$1=4294967296,Rj$1=gj$1*gj$1,Cj$1=Rj$1/2;wj$1(0,!0);const vj$1=wj$1(0),yj$1=Oj$1(0,-2147483648,!1),Aj$1=Oj$1(-1,2147483647,!1);function wj$1(e$,t$){let r$,n$,i$;return t$?(i$=0<=(e$>>>=0)&&e$<256)&&(n$=Sj$1[e$],n$)?n$:(r$=Oj$1(e$,0,!0),i$&&(Sj$1[e$]=r$),r$):(i$=-128<=(e$|=0)&&e$<128)&&(n$=Tj$1[e$],n$)?n$:(r$=Oj$1(e$,e$<0?-1:0,!1),i$&&(Tj$1[e$]=r$),r$)}function Oj$1(e$,t$,r$){return{low:0|e$,high:0|t$,unsigned:!!r$}}function Nj$1(e$,t$){if(isNaN(e$))return vj$1;{if(e$<=-Cj$1)return yj$1;if(e$+1>=Cj$1)return Aj$1}return e$<0?vj$1:Oj$1(e$%gj$1|0,e$/gj$1|0,t$)}function Dj$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}let Pj$1=class C5 extends xy$1{get connectionState(){return this._connectionState}set connectionState(t$){if(this._connectionState===t$)return;const r$=this._connectionState;this._connectionState=t$,this.emit(RO$1.CONNECTION_STATE_CHANGE,t$,r$)}get quality(){return this._quality}set quality(t$){this._quality=t$>1?1:t$<.1?.1:t$,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t$){var r$;super(),Fg$1(this,"name","AgoraRTCImageModeration"),Fg$1(this,"_connectionState",gO$1.CONNECTING),Fg$1(this,"_sequence",0),Fg$1(this,"_moderationStartTime",void 0),Fg$1(this,"_workerConnection",void 0),Fg$1(this,"_workerMessageLengthLimit",void 0),Fg$1(this,"_qualityRatio",void 0),Fg$1(this,"_connectInfo",void 0),Fg$1(this,"_cancelTokenSource",Lv$1.CancelToken.source()),Fg$1(this,"_retryConfig",void 0),Fg$1(this,"_moderationInterval",void 0),Fg$1(this,"_moderationTimer",null),Fg$1(this,"_moderationMode",1),Fg$1(this,"_quality",1),Fg$1(this,"_qualityTimer",null),Fg$1(this,"_ticket",void 0),Fg$1(this,"_moderationIntervalMinimum",void 0),Fg$1(this,"_uploadFailedNum",0),Fg$1(this,"_uploadNum",0),Fg$1(this,"_uploadTimer",null),Fg$1(this,"_extraInfo",void 0),Fg$1(this,"_vendor",""),Fg$1(this,"_encoder",new TextEncoder),Fg$1(this,"_moderationId",void 0),Fg$1(this,"inspectImage",()=>{if(this.connectionState!==gO$1.CONNECTED)throw new yb$1(Ry$1.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===gO$1.CONNECTED?this.requestToInspectImage():fb$1.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=TA$1(5,"image-moderation-"),this._workerMessageLengthLimit=XA$1("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=XA$1("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(r$=t$.interval)!==null&&r$!==void 0?r$:1e3,t$.extraInfo&&(this._extraInfo=this._encoder.encode(t$.extraInfo)),t$.vendor&&(this._vendor=t$.vendor),this._qualityRatio=XA$1("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new HO$1("worker-"+this._moderationId,PA$1),this.on(RO$1.STATE_CHANGE,(n$,i$)=>{fb$1.debug("[".concat(this._moderationId,"] Moderation operation :").concat(CO$1[n$]," ").concat(i$||""))}),this.handleWorkerEvents()}async init(t$,r$){this.emit(RO$1.STATE_CHANGE,CO$1.CONNECT_AP),this._connectInfo=t$;const n$=this._cancelTokenSource.token;return this._retryConfig=r$,new Gh$1((i$,o$)=>{this.on(RO$1.CONNECTION_STATE_CHANGE,(s$,a$)=>{s$===gO$1.CONNECTED&&i$()}),this.requestAP(t$,n$,r$).then(s$=>{this.connectWorker(s$)}).catch(s$=>{o$(s$)})})}updateConfig(t$){var r$;this._moderationInterval=(r$=t$.interval)!==null&&r$!==void 0?r$:1e3,t$.extraInfo&&(this._extraInfo=this._encoder.encode(t$.extraInfo)),t$.vendor&&(this._vendor=t$.vendor),fb$1.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t$))),this.connectionState===gO$1.CONNECTED&&this.inspectImage()}async requestAP(t$,r$,n$){const i$=XA$1("WEBCS_DOMAIN").map(c$=>"https://".concat(c$,"/api/v1")),o$=await function(c$,u$,l$,d$){let{appId:h$,areaCode:p$,cname:_$,sid:f$,token:m$,uid:g$}=u$;Bx$1++;const v$="moderation_plugin",y$={service_name:v$,json_body:JSON.stringify({appId:h$,areaCode:p$,cname:_$,command:"allocateEdge",requestId:Bx$1,seq:Bx$1,sid:f$,appToken:m$,ts:Date.now(),uid:g$+""})};let S$,b$,$$=c$[0];return kA$1(async()=>{S$=Date.now();const C$=await Tx$1($$,{data:y$,cancelToken:l$,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(b$=Date.now()-S$,C$.code!==0){const O$=new yb$1(Ry$1.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+C$.code,{retry:!0,responseTime:b$});throw fb$1.error(O$.toString()),O$}const N$=JSON.parse(C$.json_body);if(N$.code!==200){const O$=new yb$1(Ry$1.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(N$.code,", reason: ").concat(N$.reason),{code:N$.code,responseTime:b$});throw fb$1.error(O$.toString()),O$}if(!N$.servers||!Array.isArray(N$.servers)||N$.servers.length===0){const O$=new yb$1(Ry$1.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:N$.code,responseTime:b$});throw fb$1.error(O$.toString()),O$}if(!N$.servers.some(O$=>!!O$.wss)){const O$=new yb$1(Ry$1.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:N$.code,responseTime:b$});throw fb$1.error(O$.toString()),O$}const k$=XA$1("IMAGE_MODERATION_WORKER_HOST");return{addressList:N$.servers.map(O$=>{let{address:U$,wss:x$}=O$;if(U$&&x$)return"wss://".concat(U$.replace(/\./g,"-"),".").concat(k$,":").concat(x$,"/moderation")}).filter(O$=>!!O$),workerToken:N$.workerToken,vid:N$.vid,ticket:N$.appTicket,responseTime:b$}},(C$,N$)=>(vb$1.apworkerEvent(f$,{success:!0,sc:200,serviceName:v$,responseDetail:JSON.stringify(C$.addressList),firstSuccess:N$===0,responseTime:b$,serverIp:c$[N$%c$.length]}),!1),(C$,N$)=>(vb$1.apworkerEvent(f$,{success:!1,sc:C$.data&&C$.data.code||200,serviceName:v$,responseTime:b$,serverIp:c$[N$%c$.length]}),!!(C$.code!==Ry$1.OPERATION_ABORTED&&C$.code!==Ry$1.UNEXPECTED_RESPONSE||C$.data&&C$.data.retry)&&($$=c$[(N$+1)%c$.length],!0)),d$)}(i$,t$,r$,n$);this.emit(RO$1.STATE_CHANGE,CO$1.AP_CONNECTED);const{addressList:s$,ticket:a$}=o$;return this._ticket=a$,s$}async connectWorker(t$){this.emit(RO$1.STATE_CHANGE,CO$1.CONNECT_WORKER),await this._workerConnection.init(t$,1e4)}handleWorkerEvents(){this._workerConnection.on(Uw$1.CONNECTED,async()=>{this.emit(RO$1.STATE_CHANGE,CO$1.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=gO$1.CONNECTED}),this._workerConnection.on(Uw$1.CLOSED,()=>{this.connectionState=gO$1.CLOSED}),this._workerConnection.on(Uw$1.FAILED,()=>{this.connectionState=gO$1.CLOSED}),this._workerConnection.on(Uw$1.RECONNECTING,()=>{this.connectionState=this.connectionState===gO$1.CONNECTED?gO$1.RECONNECTING:gO$1.CONNECTING}),this._workerConnection.on(Uw$1.ON_MESSAGE,async t$=>{if(t$.data instanceof ArrayBuffer){const r$=tj$1(new Uint8Array(t$.data));XA$1("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&fb$1.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r$)),this._uploadNum++,r$.code===void 0||r$.code===0||(this._uploadFailedNum++,fb$1.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(r$.code,", msg is ").concat(r$.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{vb$1.reportApiInvoke(this._connectInfo.sid||null,{name:By$1.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,r$.code],tag:jy$1.TRACER}).onError(new yb$1(Ry$1.IMAGE_MODERATION_UPLOAD_FAILED,r$.msg)),this._uploadTimer=null},XA$1("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else fb$1.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Uw$1.WILL_RECONNECT,(t$,r$,n$)=>{t$==="recover"&&n$(t$),n$("tryNext")}),this._workerConnection.on(Uw$1.REQUEST_NEW_URLS,(t$,r$)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t$).catch(r$)})}static intToLong(t$){return{low:t$|=0,high:t$>>31,unsigned:t$>=0}}async requestToInspectImage(){const t$=eA$1(this,RO$1.CLIENT_LOCAL_VIDEO_TRACK),r$={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t$){if(!t$.isPlaying)return void(XA$1("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&fb$1.debug("Only the track being played can be inspected"));this._sequence++;const n$=await this.generateRequestData(t$,r$);this._workerConnection.sendMessage(n$,!0,!0)}else XA$1("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&fb$1.debug("Only the track being published can be inspected")}async generateRequestData(t$,r$){let{appId:n$,cname:i$,cid:o$,vid:s$,sid:a$,uid:c$}=r$;const u$=Date.now(),l$=await t$.getCurrentFrameImage("image/jpeg",this.quality),d$=await Ok$1(l$,n$,i$),h$=this._sequence+"-"+o$+"-"+c$+"-"+u$+"-"+TA$1(12,""),p$={appId:n$,cid:o$,cname:i$,deviceId:"",elapse:C5.intToLong(Number(u$-this._moderationStartTime)),fileSize:l$.buffer.byteLength,height:l$.height,width:l$.width,jpg:d$,networkType:6,osType:7,requestId:h$,sdkVersion:"4.22.1",sequence:this._sequence,sid:a$,timestamp:Nj$1(u$),uid:c$,vid:s$,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete p$.callbackData;const _$=ej$1(p$);if(_$.byteLength<this._workerMessageLengthLimit){if(XA$1("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const f$=function(m$){for(var g$=1;g$<arguments.length;g$++){var v$=arguments[g$]!=null?arguments[g$]:{};g$%2?Dj$1(Object(v$),!0).forEach(function(y$){Fg$1(m$,y$,v$[y$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m$,Object.getOwnPropertyDescriptors(v$)):Dj$1(Object(v$)).forEach(function(y$){Object.defineProperty(m$,y$,Object.getOwnPropertyDescriptor(v$,y$))})}return m$}({},p$);delete f$.jpg,fb$1.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(f$))}return _$}{const f$=this.quality*this._qualityRatio;return this.quality=f$,await this.generateRequestData(t$,{appId:n$,cname:i$,cid:o$,vid:s$,sid:a$,uid:c$})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Lv$1.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=gO$1.CLOSED,this.emit(RO$1.STATE_CHANGE,CO$1.CLOSED)}};function Lj$1(e$){if(yy$1(e$.interval,"interval",1e3,1/0),e$&&e$.extraInfo&&e$.extraInfo.length>1024)throw new yb$1(Ry$1.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e$&&e$.vendor&&e$.vendor.length>1024)throw new yb$1(Ry$1.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const kj$1={name:"ImageModeration",create:function(e$){let{config:t$}=e$;return Lj$1(t$),new Pj$1(t$)}};var Mj$1,Uj$1,xj$1,Vj$1,Fj$1,Bj$1,jj$1,Gj$1,Wj$1,Hj$1,Kj$1,Yj$1,qj$1,zj$1,Jj$1,Xj$1,Qj$1,Zj$1,$j$1,eG$1,tG$1,iG$1,nG$1,rG$1,oG$1,sG$1,aG$1,cG$1,dG$1,lG$1,uG$1,hG$1,pG$1,_G$1,EG$1,fG$1,mG$1,TG$1,SG$1,gG$1,RG$1;function CG$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function IG$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?CG$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):CG$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}NA$1.setLogger(fb$1);let vG$1=(Mj$1=Ib$1(),Uj$1=Ib$1({argsMap:(e$,t$)=>{if(!Array.isArray(t$)){if(!(t$ instanceof HL$1))return[t$];t$=[t$]}return t$.map(r$=>r$?Object(r$).toString():"null")}}),xj$1=Ib$1({argsMap:(e$,t$)=>(t$||(t$=[]),Array.isArray(t$)||t$.trackMediaType!==vL$1.DATA?(Array.isArray(t$)||(t$=[t$]),t$.map(r$=>r$.getTrackId())):[t$.getChannelId()])}),Vj$1=Ib$1({argsMap:(e$,t$,r$,n$)=>[typeof t$=="object"?t$.uid:t$,r$,n$]}),Fj$1=Ib$1({argsMap:(e$,t$,r$)=>[t$,r$]}),Bj$1=Ib$1({argsMap:(e$,t$)=>t$.map(r$=>{let{user:n$,mediaType:i$}=r$;return[n$==null?void 0:n$.uid,i$]})}),jj$1=Ib$1({argsMap:(e$,t$,r$,n$)=>[typeof t$=="object"?t$.uid:t$,r$,n$]}),Gj$1=Ib$1({argsMap:(e$,t$)=>t$.map(r$=>{let{user:n$,mediaType:i$}=r$;return{uid:n$==null?void 0:n$.uid,mediaType:i$}})}),Wj$1=Ib$1(),Hj$1=Ib$1(),Kj$1=Ib$1(),Yj$1=Ib$1(),qj$1=Ib$1(),zj$1=Ib$1(),Jj$1=Ib$1(),Xj$1=Ib$1(),Qj$1=Ib$1(),Zj$1=Ib$1(),$j$1=Ib$1(),eG$1=Ib$1(),tG$1=Ib$1(),iG$1=Ib$1(),nG$1=Ib$1({argsMap:(e$,t$)=>[t$]}),rG$1=Ib$1(),oG$1=Ib$1(),sG$1=Ib$1(),aG$1=Ib$1(),cG$1=Ib$1(),dG$1=Ib$1(),lG$1=Ib$1(),uG$1=Ib$1(),hG$1=Ib$1({argsMap:(e$,t$)=>(Array.isArray(t$)||(t$=[t$]),[JSON.stringify(t$)])}),pG$1=Ib$1(),_G$1=Ib$1(),EG$1=Ib$1(),fG$1=Ib$1(),mG$1=Ib$1(),TG$1=Ib$1(),SG$1=Ib$1({reportResult:!0}),gG$1=Ib$1(),RG$1=class extends xy$1{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e$;return((e$=this._config)===null||e$===void 0?void 0:e$.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e$){let t$;if(super(),Fg$1(this,"store",void 0),Fg$1(this,"_uid",void 0),Fg$1(this,"_channelName",void 0),Fg$1(this,"_uintUid",void 0),Fg$1(this,"_users",[]),Fg$1(this,"_config",void 0),Fg$1(this,"_clientId",void 0),Fg$1(this,"_appId",void 0),Fg$1(this,"_sessionId",null),Fg$1(this,"_key",void 0),Fg$1(this,"_rtmConfig",{}),Fg$1(this,"_joinInfo",void 0),Fg$1(this,"_gateway",void 0),Fg$1(this,"_statsCollector",void 0),Fg$1(this,"_configDistribute",void 0),Fg$1(this,"_leaveMutex",new NA$1("client-leave")),Fg$1(this,"_publishMutex",new NA$1("client-publish")),Fg$1(this,"_renewTokenMutex",new NA$1("client-renewtoken")),Fg$1(this,"_subscribeMutex",new NA$1("client-subscribe")),Fg$1(this,"_encryptionMode","none"),Fg$1(this,"_encryptionSecret",null),Fg$1(this,"_encryptionSalt",null),Fg$1(this,"_encryptDataStream",!1),Fg$1(this,"_encryptDataStreamKey",null),Fg$1(this,"_encryptDataStreamIv",null),Fg$1(this,"_proxyServer",void 0),Fg$1(this,"_turnServer",{servers:[],mode:"auto"}),Fg$1(this,"_cloudProxyServerMode","disabled"),Fg$1(this,"_isDualStreamEnabled",!1),Fg$1(this,"_defaultStreamFallbackType",void 0),Fg$1(this,"_lowStreamParameter",void 0),Fg$1(this,"_streamFallbackTypeCacheMap",new Map),Fg$1(this,"_remoteStreamTypeCacheMap",new Map),Fg$1(this,"_axiosCancelSource",Lv$1.CancelToken.source()),Fg$1(this,"_audioVolumeIndicationInterval",void 0),Fg$1(this,"_networkQualityInterval",void 0),Fg$1(this,"_userOfflineTimeout",void 0),Fg$1(this,"_streamRemovedTimeout",void 0),Fg$1(this,"_liveTranscodeStreamingClient",void 0),Fg$1(this,"_liveRawStreamingClient",void 0),Fg$1(this,"_channelMediaRelayClient",void 0),Fg$1(this,"_networkQualitySensitivity","normal"),Fg$1(this,"_p2pChannel",void 0),Fg$1(this,"_useLocalAccessPoint",!1),Fg$1(this,"_setLocalAPVersion",void 0),Fg$1(this,"_joinAndNotLeaveYet",!1),Fg$1(this,"_numberOfJoinCount",0),Fg$1(this,"_remoteDefaultVideoStreamType",void 0),Fg$1(this,"_inspect",void 0),Fg$1(this,"_moderation",void 0),Fg$1(this,"_license",void 0),Fg$1(this,"_pendingPublishedUsers",[]),Fg$1(this,"ntpAlignErrorCount",0),Fg$1(this,"remoteInboundOffset",0),Fg$1(this,"_handleLocalTrackEnable",(r$,n$,i$)=>{this.publish(r$,!1).then(n$).catch(i$)}),Fg$1(this,"_handleLocalTrackDisable",(r$,n$,i$)=>{this.unpublish(r$).then(n$).catch(i$)}),Fg$1(this,"_handleUserOnline",r$=>{if(XA$1("BLOCK_LOCAL_CLIENT")&&Ob$1(r$.uid,this.channelName))return void fb$1.debug("[".concat(r$.uid,"] will be ignored in local"));this.isStringUID&&typeof r$.uid!="string"&&fb$1.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const n$=this._users.find(i$=>i$.uid===r$.uid);if(n$)n$._trust_in_room_=!0,n$._is_pre_created&&(n$._is_pre_created=!1,this.safeEmit(zy$1.USER_JOINED,n$));else{const i$=new cF$1(r$.uid,r$.uint_id||r$.uid);this._users.push(i$),fb$1.debug("[".concat(this._clientId,"] user online"),r$.uid),this.safeEmit(zy$1.USER_JOINED,i$)}}),Fg$1(this,"_handleUserOffline",r$=>{if(XA$1("BLOCK_LOCAL_CLIENT")&&Ob$1(r$.uid,this.channelName))return;const n$=this._users.find(i$=>i$.uid===r$.uid);n$&&(this._handleRemoveStream(r$),this._handleRemoveDataChannels(r$),n$._audio_pre_subscribed||n$._video_pre_subscribed?n$._is_pre_created=!0:nA$1(this._users,n$),this._remoteStreamTypeCacheMap.delete(n$.uid),this._streamFallbackTypeCacheMap.delete(n$.uid),fb$1.debug("[".concat(this._clientId,"] user offline"),r$.uid,"reason:",r$.reason),this.safeEmit(zy$1.USER_LEAVED,n$,r$.reason))}),Fg$1(this,"_handleAddAudioOrVideoStream",(r$,n$,i$,o$,s$,a$,c$)=>{if(XA$1("BLOCK_LOCAL_CLIENT")&&Ob$1(n$,this.channelName))return;const u$=this._users.find(d$=>d$.uid===n$);if(!u$)return void fb$1.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));fb$1.debug("[".concat(this._clientId,"] stream added with uid ").concat(n$,", type ").concat(r$)),this.store.subscribe(u$.uid,r$,void 0,void 0,void 0,Date.now());const l$=r$==="audio"?u$.hasAudio:u$.hasVideo;u$._uintid||(u$._uintid=s$||n$),r$==="audio"?u$._trust_audio_stream_added_state_=!0:u$._trust_video_stream_added_state_=!0,r$==="audio"?(u$._audio_added_=!0,i$!==void 0&&(u$._audioSSRC=i$),o$!==void 0&&(u$._cname=o$),a$&&(u$._audioOrtc=a$)):(u$._video_added_=!0,i$!==void 0&&(u$._videoSSRC=i$),o$!==void 0&&(u$._cname=o$),c$!==void 0&&(u$._rtxSsrcId=c$),a$&&(u$._videoOrtc=a$)),(r$==="audio"?u$.hasAudio:u$.hasVideo)&&!l$&&(fb$1.info("[".concat(this._clientId,"] remote user ").concat(u$.uid," published ").concat(r$)),this.safeEmit(zy$1.USER_PUBLISHED,u$,r$)),r$==="video"?vb$1.onGatewayStream(this._sessionId,gb$1.ON_ADD_VIDEO_STREAM,Rb$1.ON_ADD_VIDEO_STREAM,{peer:s$||n$,ssrc:u$._videoSSRC}):vb$1.onGatewayStream(this._sessionId,gb$1.ON_ADD_AUDIO_STREAM,Rb$1.ON_ADD_AUDIO_STREAM,{peer:s$||n$,ssrc:u$._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(u$,r$,i$).then(d$=>{if(d$&&(fb$1.debug("[".concat(this._clientId,"] resubscribe ").concat(r$," for user ").concat(u$.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof fB$1))return this._p2pChannel.unsubscribe(u$,r$,!0).then(()=>this._subscribe(u$,r$,!0).catch(h$=>{fb$1.error("[".concat(this._clientId,"] resubscribe error"),h$.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(u$,r$)&&(fb$1.debug("[".concat(this._clientId,"] resubscribe ").concat(r$," for user ").concat(u$.uid," after reconnect.")),this._subscribe(u$,r$,!0).catch(d$=>{fb$1.error("[".concat(this._clientId,"] resubscribe error"),d$.toString())}))}),Fg$1(this,"_handleRemoveStream",r$=>{if(XA$1("BLOCK_LOCAL_CLIENT")&&Ob$1(r$.uid,this.channelName))return;const n$=this._users.find(o$=>o$.uid===r$.uid);if(!n$)return void fb$1.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));fb$1.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r$.uid));let i$=()=>{};n$.hasAudio&&n$.hasVideo?i$=()=>{fb$1.info("[".concat(this._clientId,"] remote user ").concat(n$.uid," unpublished audio track")),this.safeEmit(zy$1.USER_UNPUBLISHED,n$,"audio"),fb$1.info("[".concat(this._clientId,"] remote user ").concat(n$.uid," unpublished video track")),this.safeEmit(zy$1.USER_UNPUBLISHED,n$,"video")}:n$.hasVideo?i$=()=>{fb$1.info("[".concat(this._clientId,"] remote user ").concat(n$.uid," unpublished video track")),this.safeEmit(zy$1.USER_UNPUBLISHED,n$,"video")}:n$.hasAudio&&(i$=()=>{fb$1.info("[".concat(this._clientId,"] remote user ").concat(n$.uid," unpublished audio track")),this.safeEmit(zy$1.USER_UNPUBLISHED,n$,"audio")}),n$._video_pre_subscribed||n$._audio_pre_subscribed||(n$._trust_audio_stream_added_state_=!0,n$._trust_video_stream_added_state_=!0,n$._audio_added_=!1,n$._video_added_=!1,this._p2pChannel instanceof fB$1&&this._p2pChannel.unsubscribe(n$).then(o$=>{if(o$)return this._gateway.unsubscribe(o$,n$.uid)}),n$._audioSSRC=void 0,n$._videoSSRC=void 0,n$._audioOrtc=void 0,n$._videoOrtc=void 0,n$._rtxSsrcId=void 0),vb$1.onGatewayStream(this._sessionId,gb$1.ON_REMOVE_STREAM,Rb$1.ON_REMOVE_STREAM,{peer:r$.uint_id||r$.uid}),i$()}),Fg$1(this,"_handleSetStreamLocalEnable",(r$,n$,i$)=>{if(XA$1("BLOCK_LOCAL_CLIENT")&&Ob$1(n$,this.channelName))return;const o$=this._users.find(c$=>c$.uid===n$);if(!o$)return void fb$1.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));fb$1.debug("[".concat(this._clientId,"] local ").concat(r$," ").concat(i$?"enabled":"disabled"," with uid ").concat(n$));const s$=r$==="audio"?o$.hasAudio:o$.hasVideo;if(r$==="audio"){o$._trust_audio_enabled_state_=!0;const c$=o$._audio_enabled_;if(o$._audio_enabled_=i$,o$._audio_enabled_===c$)return;{const u$=o$._audio_enabled_?"enable-local-audio":"disable-local-audio";fb$1.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(n$,", msg: ").concat(u$)),this.safeEmit(zy$1.USER_INFO_UPDATED,n$,u$)}}else{o$._trust_video_enabled_state_=!0;const c$=o$._video_enabled_;if(o$._video_enabled_=i$,o$._video_enabled_===c$)return;{const u$=o$._video_enabled_?"enable-local-video":"disable-local-video";fb$1.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n$,", msg: ").concat(u$)),this.safeEmit(zy$1.USER_INFO_UPDATED,n$,u$)}}const a$=r$==="audio"?o$.hasAudio:o$.hasVideo;return s$!==a$?!s$&&a$?(fb$1.info("[".concat(this._clientId,"] remote user ").concat(n$," published ").concat(r$)),void this.safeEmit(zy$1.USER_PUBLISHED,o$,r$)):(r$==="video"&&o$._videoTrack&&o$._videoTrack._destroy(),r$==="audio"&&o$._audioTrack,this._p2pChannel.muteRemote(o$,r$),fb$1.info("[".concat(this._clientId,"] remote user ").concat(n$," unpublished ").concat(r$)),void this.safeEmit(zy$1.USER_UNPUBLISHED,o$,r$)):void 0}),Fg$1(this,"_handleMuteStream",(r$,n$,i$)=>{if(XA$1("BLOCK_LOCAL_CLIENT")&&Ob$1(r$,this.channelName))return;fb$1.debug("[".concat(this._clientId,"] receive mute message"),r$,n$,i$);const o$=this._users.find(c$=>c$.uid===r$);if(!o$)return void fb$1.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r$));const s$=n$==="audio"?o$.hasAudio:o$.hasVideo;if(n$==="audio"){o$._trust_audio_mute_state_=!0;const c$=o$._audio_muted_;if(o$._audio_muted_=i$,o$._audio_muted_===c$)return;{const u$=o$._audio_muted_?"mute-audio":"unmute-audio";fb$1.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r$,", msg: ").concat(u$)),this.safeEmit(zy$1.USER_INFO_UPDATED,r$,u$)}}else{o$._trust_video_mute_state_=!0;const c$=o$._video_muted_;if(o$._video_muted_=i$,o$._video_muted_===c$)return;{const u$=o$._video_muted_?"mute-video":"unmute-video";fb$1.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r$,", msg: ").concat(u$)),this.safeEmit(zy$1.USER_INFO_UPDATED,r$,u$)}}const a$=n$==="audio"?o$.hasAudio:o$.hasVideo;if(s$!==a$){if(!s$&&a$)return(n$==="audio"?o$._audioSSRC:o$._videoSSRC)?(fb$1.info("[".concat(this._clientId,"] remote user ").concat(r$," published ").concat(n$)),void this.safeEmit(zy$1.USER_PUBLISHED,o$,n$)):void fb$1.warning("[".concat(this._clientId,"] remote user ").concat(r$," receive ").concat(n$," unmute message  before add stream message, ").concat(n$," SSRC doesn't exist yet."));n$==="video"&&o$._videoTrack&&!o$._video_pre_subscribed&&o$._videoTrack._destroy(),n$==="audio"&&o$._audioTrack,this._p2pChannel.muteRemote(o$,n$),fb$1.info("[".concat(this._clientId,"] remote user ").concat(r$," unpublished ").concat(n$)),this.safeEmit(zy$1.USER_UNPUBLISHED,o$,n$)}}),Fg$1(this,"_handleP2PLost",async r$=>{fb$1.debug("[".concat(this._clientId,"] receive p2p lost"),r$),parseInt(r$.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():fb$1.warning("[".concat(this._clientId,"] P2PLost stream not found"),r$)}),Fg$1(this,"_handleTokenWillExpire",()=>{fb$1.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(zy$1.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),Fg$1(this,"_handleBeforeUnload",r$=>{r$.type==="beforeunload"&&r$.returnValue!==void 0&&r$.returnValue!==""||(this.leave(),fb$1.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),Fg$1(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(zy$1.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const r$={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r$.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r$.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(zy$1.NETWORK_QUALITY,r$)}),Fg$1(this,"_handleP2PAddAudioOrVideoStream",(r$,n$,i$,o$)=>{const s$=this._users.find(c$=>c$.uid===n$);if(!s$)return void fb$1.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));fb$1.debug("[".concat(this._clientId,"] stream added with uid ").concat(n$,", type ").concat(r$)),this.store.subscribe(s$.uid,r$,void 0,void 0,void 0,Date.now());const a$=r$==="audio"?s$.hasAudio:s$.hasVideo;r$==="audio"?s$._trust_audio_stream_added_state_=!0:s$._trust_video_stream_added_state_=!0,r$==="audio"?(s$._audio_added_=!0,i$!==void 0&&(s$._audioSSRC=i$),o$!==void 0&&(s$._audioMid=o$)):(s$._video_added_=!0,i$!==void 0&&(s$._videoSSRC=i$),o$!==void 0&&(s$._videoMid=o$)),(r$==="audio"?s$.hasAudio:s$.hasVideo)&&!a$&&(fb$1.info("[".concat(this._clientId,"] remote user ").concat(s$.uid," published ").concat(r$)),this.safeEmit(zy$1.USER_PUBLISHED,s$,r$)),this._p2pChannel.hasPendingRemoteMedia(s$,r$)&&(fb$1.debug("[".concat(this._clientId,"] resubscribe ").concat(r$," for user ").concat(s$.uid," after reconnect.")),this._subscribe(s$,r$,!0).catch(c$=>{fb$1.error("[".concat(this._clientId,"] resubscribe error"),c$.toString())}))}),this._config=e$,this._clientId=TA$1(5,"client-"),this.store=new $A$1(e$.codec,e$.audioCodec,e$.mode,this._clientId),this.store.clientCreated(),e$.proxyServer&&this.setProxyServer(e$.proxyServer,!0),e$.turnServer&&this.setTurnServer(e$.turnServer,!0),fb$1.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(GA$1," build: ").concat(qA$1,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e$.clientRoleOptions)try{qy$1(e$.clientRoleOptions),t$=Object.assign({},e$.clientRoleOptions)}catch(r$){fb$1.warning("[".concat(this._clientId,"] ").concat(r$.toString()))}this._statsCollector=new DF$1(this.store),this._statsCollector.onStatsException=(r$,n$,i$)=>{fb$1.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(r$,", msg: ").concat(n$,", uid: ").concat(i$)),this.safeEmit(zy$1.EXCEPTION,{code:r$,msg:n$,uid:i$})},this._statsCollector.onUploadPublishDuration=(r$,n$,i$,o$)=>{const s$=this._users.find(a$=>a$.uid===r$);s$&&vb$1.peerPublishStatus(this._sessionId,{subscribeElapse:o$,audioPublishDuration:n$,videoPublishDuration:i$,peer:s$._uintid})},this.store.useP2P=e$.mode==="p2p",this._gateway=new Ex$1(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e$.websocketRetryConfig||PA$1,httpRetryConfig:e$.httpRetryConfig||PA$1,forceWaitGatewayResponse:e$.forceWaitGatewayResponse===void 0||e$.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e$.role,clientRoleOptions:t$}),this._configDistribute=new tV$1,this.store.useP2P?(this._p2pChannel=new bF$1(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new fB$1(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e$,t$,r$,n$,i$){let o$=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],s$=arguments.length>6&&arguments[6]!==void 0&&arguments[6];JA$1("JOIN_GATEWAY_USE_443PORT_ONLY",o$),JA$1("JOIN_GATEWAY_USE_DUAL_DOMAIN",s$);const a$=this._gateway.signal.websocket;return a$ instanceof WO$1&&(a$.use443PortOnly=o$,a$.tryDoubleDomain=s$),async function(c$,u$,l$){Uv$1.get(c$)||Uv$1.set(c$,[]),xv$1.get(c$)||xv$1.set(c$,u$),Vv$1.get(c$)||Vv$1.set(c$,0);const d$=Uv$1.get(c$),h$=xv$1.get(c$);if(!d$||!h$)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Vv$1.get(c$)===h$){const g$=Mv$1();d$.push(g$),await g$.promise}Vv$1.set(c$,Vv$1.get(c$)+1);for(var p$=arguments.length,_$=new Array(p$>3?p$-3:0),f$=3;f$<p$;f$++)_$[f$-3]=arguments[f$];const m$=await l$(..._$);return Vv$1.set(c$,Vv$1.get(c$)-1),Vv$1.get(c$)===h$-1&&d$.length>0&&(d$[0].resolve(),d$.shift()),Vv$1.get(c$)===0&&(Uv$1.set(c$,[]),xv$1.set(c$,0),Vv$1.set(c$,0)),m$}("client.join",XA$1("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e$,t$,r$,n$,i$)}async join(e$,t$,r$,n$,i$){const o$=++this._numberOfJoinCount;this.store.joinStart(),n$&&(this.store.uid=n$);const s$=(UA$1||UA$1||(UA$1=(window.location.protocol.split(":")[0]||"").toUpperCase(),UA$1))==="HTTPS",a$=jA$1()?window.isSecureContext:"Browser Not Support";(!jA$1()&&!s$||!window.isSecureContext)&&fb$1.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),fb$1.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),vb$1.setAppId(e$);try{if(!r$&&r$!==null)throw new yb$1(Ry$1.INVALID_PARAMS,"Invalid token: ".concat(r$,". If you don not use token, set it to null"));r$&&by$1(r$,"token",1,2047),by$1(e$,"appid",1,2047),xw$1(t$),n$&&Vw$1(n$),i$&&by$1(i$,"optionalInfo",1,2047)}catch(f$){throw vb$1.reportApiInvoke(SA$1(),{name:By$1.JOIN,options:[e$,t$,r$,n$],states:{isHttps:s$,isSecureContext:a$},tag:jy$1.TRACER}).onError(f$),f$}if(this._leaveMutex.isLocked&&(fb$1.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),fb$1.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const f$=new yb$1(Ry$1.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw vb$1.reportApiInvoke(SA$1(),{name:By$1.JOIN,options:[e$,t$,r$,n$],states:{isHttps:s$,isSecureContext:a$},tag:jy$1.TRACER}).onError(f$),f$}this._gateway.state="CONNECTING";const c$=await YB$1({appId:e$,cname:t$,uid:n$,stringUid:typeof n$=="string"?n$:void 0,token:r$||e$,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new yb$1(Ry$1.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const u$=(c$==null?void 0:c$.sid)||SA$1();fb$1.info("[".concat(this._clientId,"] start join channel ").concat(t$,", join number: ").concat(o$)),this._sessionId||(this._sessionId=u$,this.store.sessionId=this._sessionId);const l$=vb$1.reportApiInvoke(u$,{name:By$1.JOIN,options:[e$,t$,r$,n$],states:{isHttps:s$,isSecureContext:a$},tag:jy$1.TRACER}),d$=IG$1(IG$1(IG$1({},this._rtmConfig),{},{clientId:this._clientId,appId:e$,sid:this._sessionId,cname:t$,uid:typeof n$!="string"?n$:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r$||e$,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i$,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!c$},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:XA$1("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(d$.setLocalAPVersion=this._setLocalAPVersion),typeof n$=="string"&&(d$.stringUid=n$,this._uintUid?(d$.uid=this._uintUid,this._uintUid=void 0):d$.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(d$.aesmode=this._encryptionMode,d$.aespassword=await(async f$=>{const m$=function(S$){const b$=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),$$=new Uint8Array(new ArrayBuffer(b$.length));for(let C$=0;C$<b$.length;C$+=1)$$[C$]=b$.charCodeAt(C$);return $$}(),g$=await window.crypto.subtle.importKey("spki",m$,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),v$=ky$1(f$),y$=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},g$,v$);return function(S$){let b$="";for(let $$=0;$$<S$.length;$$+=1)b$+=String.fromCharCode(S$[$$]);return window.btoa(b$)}(new Uint8Array(y$))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new yb$1(Ry$1.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(d$.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const f$=new TextEncoder,m$=XA$1("USE_PURE_ENCRYPTION_MASTER_KEY")?f$.encode(d$.appId+this._encryptionSecret+this._encryptionSecret):f$.encode(d$.appId+d$.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(g$,v$,y$){const S$=await window.crypto.subtle.importKey("raw",v$,"PBKDF2",!1,["deriveBits","deriveKey"]),b$=g$==="aes-128-gcm2"?128:256,$$=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:nb$1,hash:"SHA-256",salt:y$},S$,b$+ib$1);return new Uint8Array($$).subarray(b$/8)}(this._encryptionMode,m$,lA$1(this._encryptionSalt)),this._encryptDataStreamKey=await async function(g$,v$,y$){const S$=await window.crypto.subtle.importKey("raw",v$,"PBKDF2",!1,["deriveBits","deriveKey"]),b$=g$==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:nb$1,hash:"SHA-256",salt:y$},S$,{name:"AES-GCM",length:b$},!0,["encrypt","decrypt"])}(this._encryptionMode,m$,lA$1(this._encryptionSalt))}else a$?fb$1.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):fb$1.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,fb$1.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t$,appId:e$,stringUid:d$.stringUid});const h$=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&h$===this._sessionId&&vb$1.joinChannelTimeout(this._sessionId,5)},5e3);try{var p$;let f$;const m$=d$.cloudProxyServer;if(Dn$1(p$=["proxy3","proxy4","proxy5"]).call(p$,m$)){const b$=XA$1("PROXY_SERVER_TYPE3");Array.isArray(b$)?d$.proxyServer=b$[0]:d$.proxyServer=b$}if(vb$1.setProxyServer(d$.proxyServer),fb$1.setProxyServer(d$.proxyServer),this.store.requestAPStart(),c$){if(fb$1.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(d$.stringUid?", ".concat(d$.stringUid," => ").concat(c$.intUid):""," ")),d$.stringUid&&!d$.uid&&(d$.uid=c$.intUid),f$={gatewayInfo:c$.ap.gatewayInfo},XA$1("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&d$.turnServer.mode==="auto")if(c$.ap.proxyInfo.addresses.length===0)fb$1.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const b$=(await tN$1(c$.ap.proxyInfo,c$.ap.gatewayInfo.uid)).map($$=>({turnServerURL:$$.address,tcpport:$$.tcpport||KA$1.tcpport,udpport:$$.udpport||KA$1.udpport,username:$$.username||KA$1.username,password:$$.password||KA$1.password,forceturn:!1,security:!0}));d$.turnServer={mode:"manual",servers:b$}}XB$1(c$,d$.stringUid)}else{if(d$.stringUid&&!d$.uid){let b$;[b$,f$]=await Gh$1.all([Yx$1(d$.stringUid,d$,this._axiosCancelSource.token,this._config.httpRetryConfig||PA$1,this.store),Kx$1(d$,this._axiosCancelSource.token,this._config.httpRetryConfig||PA$1,!0,this.store)]),fb$1.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(d$.stringUid," => ").concat(b$)),d$.uid=b$,f$.gatewayInfo.uid=b$,f$.gatewayInfo.res.uid=b$}else f$=await Kx$1(d$,this._axiosCancelSource.token,this._config.httpRetryConfig||PA$1,!0,this.store);if(!this._joinAndNotLeaveYet)throw new yb$1(Ry$1.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(d$,this._axiosCancelSource.token),this._configDistribute.on(sO$1.UPDATE_BITRATE_LIMIT,b$=>{this._p2pChannel.updateBitrateLimit(b$)})},0),this._key=r$||e$;const g$=f$.gatewayInfo,v$=d$.uid?d$.uid:g$.uid;this._joinInfo=IG$1(IG$1({},d$),{},{cid:g$.cid,uid:v$,vid:g$.vid,apResponse:g$.res,apGatewayAddress:g$.apGatewayAddress,uni_lbs_ip:g$.uni_lbs_ip,gatewayAddrs:g$.gatewayAddrs}),this.store.intUid=v$;const y$=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new yb$1(Ry$1.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));l$.onSuccess(y$),this._appId=e$,this._channelName=d$.cname,this._uid=y$,this.store.uid=y$,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Xv$1()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const S$=d$.stringUid?"string uid: ".concat(d$.stringUid,",uid: ").concat(d$.uid):"uid: ".concat(this._uid);return fb$1.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t$,",").concat(S$)),setTimeout(()=>{fb$1.startUpload()},5e3),this.store.joinEnd(),_$=this,Dn$1(wb$1).call(wb$1,_$)||wb$1.push(_$),this._cloudProxyServerMode==="disabled"&&ZP$1().supportWebCrypto&&XA$1("ENABLE_PRELOAD")&&zB$1(this._joinInfo),y$}catch(f$){const m$=Array.isArray(f$)?f$[0]:f$;throw m$&&m$.code===Ry$1.OPERATION_ABORTED?fb$1.warning("[".concat(this._clientId,"] join number: ").concat(o$,", Joining channel failed, rollback"),m$):fb$1.error("[".concat(this._clientId,"] join number: ").concat(o$,", Joining channel failed, rollback"),m$),m$.code!==Ry$1.OPERATION_ABORTED&&this._numberOfJoinCount===o$&&(this._gateway.state="DISCONNECTED",this._reset()),l$.onError(m$),m$}var _$}_joinGateway(){if(!this._joinInfo||!this._key)throw new yb$1(Ry$1.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!XA$1("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){fb$1.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Xv$1()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t$){const r$=wb$1.indexOf(t$);r$!==-1&&wb$1.splice(r$,1)}(this),this._statsCollector.stopUpdateStats();const e$=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return fb$1.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e$();await this._gateway.leave(this.connectionState!=="CONNECTED"),fb$1.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e$()}async publish(e$){let t$=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e$)){if(!(e$ instanceof HL$1))return this._publishDataChannel(e$);e$=[e$]}if(e$.length===0)throw new yb$1(Ry$1.INVALID_PARAMS,"param list is empty");const r$=e$;if(this._gateway.role==="audience")throw new yb$1(Ry$1.INVALID_OPERATION,"audience can not publish stream");for(const i$ of r$){if(!(i$ instanceof HL$1))throw new yb$1(Ry$1.INVALID_PARAMS,"parameter is not local track");if(!i$._enabled&&t$)throw new yb$1(Ry$1.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i$.getTrackId()))}fb$1.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r$.map(i$=>"".concat(i$.getTrackId()," "))));const n$=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t$&&r$.forEach(i$=>{const o$=this._configDistribute.getBitrateLimit();i$ instanceof aU$1&&o$&&i$.setBitrateLimit(o$.uplink)});try{await this._publishHighStream(r$),fb$1.info("[".concat(this._clientId,"] Publish success, id ").concat(r$.map(i$=>"".concat(i$.getTrackId()," "))))}catch(i$){throw fb$1.error("[".concat(this._clientId,"] publish error"),i$.toString()),i$}finally{n$()}}async _publishDataChannel(e$){yy$1(e$.id,"id",0,65535,!0),Iy$1(e$.ordered,"ordered"),by$1(e$.metadata,"metadata",0,512),fb$1.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e$.id));const t$=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i$=>i$.id===e$.id)!==-1)throw new yb$1(Ry$1.INVALID_PARAMS,"Invalid id: ".concat(e$.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new yb$1(Ry$1.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new yb$1(Ry$1.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&XA$1("FORCE_TURN")&&!XA$1("TURN_ENABLE_TCP")&&!XA$1("TURN_ENABLE_UDP"))throw new yb$1(Ry$1.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const r$=function(i$){return RB$1(i$,!1)}(e$),n$=await this._p2pChannel.publishDataChannel([r$]);if(n$.length>0){if(typeof r$._originDataChannelId!="number")throw fb$1.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new yb$1(Ry$1.CREATE_DATACHANNEL_ERROR);try{await Gh$1.all(n$.map(i$=>this._uid&&this._gateway.publishDataChannel(this._uid,i$,!0))),await r$._waitTillOpen()}catch(i$){if(i$.code!==Ry$1.DISCONNECT_P2P)throw i$}}return fb$1.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r$.id)),r$}catch(r$){throw fb$1.error("[".concat(this._clientId,"] publish datachannels error"),r$.toString()),r$}finally{t$()}}async unpublish(e$){if(!this._joinInfo||this._uid===void 0)throw new yb$1(Ry$1.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t$=[];if(e$)if(Array.isArray(e$))t$=e$;else{if(!(e$ instanceof HL$1))return this._unpublishDataChannel([e$]);t$=[e$]}else this.store.useP2P||await this._unpublishDataChannel(),t$=this._p2pChannel.getAllTracks(!0);fb$1.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t$.map(n$=>"".concat(n$.getTrackId()," "))," "));const r$=await this._publishMutex.lock();try{if(this._p2pChannel instanceof bF$1){const n$=await this._p2pChannel.unpublish(t$);n$&&await this._gateway.sendExtensionMessage(IO$1.UNPUBLISH,{unpubMsg:n$},!0)}else{const n$=await this._p2pChannel.unpublish(t$);n$&&await this._gateway.unpublish(n$,this._uid),fb$1.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t$.map(i$=>"".concat(i$.getTrackId()))))}}catch(n$){throw fb$1.error("[".concat(this._clientId,"] unpublish error"),n$.toString()),n$}finally{r$&&r$()}}async _unpublishDataChannel(e$){e$!==void 0&&e$.length!==0||(e$=this._p2pChannel.getAllDataChannels()),fb$1.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e$.map(r$=>"".concat(r$.id," "))," "));const t$=await this._publishMutex.lock();try{const r$=await this._p2pChannel.unpublishDataChannel(e$);r$&&await this._gateway.unpublishDataChannel(r$),fb$1.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e$.map(n$=>"".concat(n$.id))))}catch(r$){throw fb$1.error("[".concat(this._clientId,"] unpublish dataChannel error"),r$.toString()),r$}finally{t$&&t$()}}async subscribe(e$,t$,r$){if(!(e$ instanceof cF$1)){const n$=this.remoteUsers.find(i$=>i$.uid===e$);if(!n$)throw new yb$1(Ry$1.INVALID_REMOTE_USER,"user is not in the channel");e$=n$}return t$==="datachannel"?this._subscribeDataChannel(e$,r$):this._subscribe(e$,t$)}async presubscribe(e$,t$){if(vy$1(t$,"mediaType",["audio","video"]),this._p2pChannel instanceof bF$1)throw new yb$1(Ry$1.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new yb$1(Ry$1.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new yb$1(Ry$1.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const r$=t$===dO$1.AUDIO,n$=t$===dO$1.VIDEO,i$=await this._subscribeMutex.lock();try{const{ssrcId:o$,ortc:s$,rtxSsrcId:a$,cname:c$,uint_id:u$}=await this._gateway.presubscribe(e$,t$,!0);if(o$==null)throw new yb$1(Ry$1.UNEXPECTED_RESPONSE,"no ssrc id");let l$=this._users.find(h$=>h$.uid===e$);l$||(l$=new cF$1(e$,u$||e$),l$._is_pre_created=!0,this._users.push(l$)),c$&&(l$._cname=c$),l$._uintid||(l$._uintid=u$||e$),r$&&(l$._audioSSRC=o$,l$._audio_pre_subscribed=!0,s$&&(l$._audioOrtc=s$)),n$&&(l$._videoSSRC=o$,l$._video_pre_subscribed=!0,s$&&(l$._videoOrtc=s$),a$!=null&&(l$._rtxSsrcId=a$)),fb$1.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(o$)),await this._p2pChannel.subscribe(l$,t$,o$,a$,s$);const d$=r$?l$._audioTrack:l$._videoTrack;if(!d$)throw new yb$1(Ry$1.UNEXPECTED_ERROR,"can not find remote track in user");return r$&&(l$._trust_audio_stream_added_state_=!0,l$._audio_added_=!0),n$&&(l$._trust_video_stream_added_state_=!0,l$._video_added_=!0),d$}catch(o$){throw fb$1.error("[".concat(this._clientId,"] presub user ").concat(e$," error"),o$),o$}finally{i$()}}async _subscribeDataChannel(e$,t$){var r$;if(yy$1(t$,"channelId",0,65535,!0),!this._joinInfo)throw new yb$1(Ry$1.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new yb$1(Ry$1.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(a$=>a$===e$))throw fb$1.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid,", this user is not in the channel")),new yb$1(Ry$1.INVALID_REMOTE_USER,"user is not in the channel");if(!e$.hasAudio&&!e$.hasVideo&&e$._dataChannels.length===0)throw fb$1.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid,", user is not published")),new yb$1(Ry$1.INVALID_REMOTE_USER,"user is not published");const i$=(r$=e$._dataChannels)===null||r$===void 0?void 0:r$.find(a$=>a$.id===t$);if(!i$)throw fb$1.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid," with mediaType datachannel, remote datachannel is not published")),new yb$1(Ry$1.REMOTE_USER_IS_NOT_PUBLISHED);const o$=await this._subscribeMutex.lock();fb$1.info("[".concat(this._clientId,"] subscribe user ").concat(e$.uid,", mediaType: datachannel"));try{const a$=await this._p2pChannel.subscribeDataChannel(e$,[i$]);if(a$&&Dn$1(a$).call(a$,i$.id))try{var s$;if(typeof i$._originDataChannelId!="number")throw fb$1.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid," with mediaType datachannel, cannot get RTCDatachannel")),new yb$1(Ry$1.CREATE_DATACHANNEL_ERROR);const c$={id:i$.id,datachannelId:i$._originDataChannelId,ordered:i$.ordered,maxRetransmits:i$.maxRetransmits,metadata:(s$=i$.metadata)!==null&&s$!==void 0?s$:""};await this._gateway.subscribeDataChannel(e$.uid,c$,!0),await i$._waitTillOpen()}catch(c$){if((c$==null?void 0:c$.code)!==Ry$1.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e$,[i$]),c$;await this._p2pChannel.unsubscribeDataChannel(e$,[i$]),this._p2pChannel.setPendingRemoteDataChannel(e$,i$.id)}return fb$1.info("[".concat(this._clientId,"] subscribe success user ").concat(e$.uid,", mediaType: datachannel")),i$}finally{o$()}}async _p2pSubscribe(e$,t$,r$){if(vy$1(t$,"mediaType",["audio","video"]),!this._joinInfo)throw new yb$1(Ry$1.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new yb$1(Ry$1.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(o$=>o$===e$)){const o$=new yb$1(Ry$1.INVALID_REMOTE_USER,"user is not in the channel");throw fb$1.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid,", this user is not in the channel")),o$}if(!e$.hasAudio&&!e$.hasVideo){const o$=new yb$1(Ry$1.INVALID_REMOTE_USER,"user is not published");throw fb$1.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid,", user is not published")),o$}if(!r$&&(t$==="audio"&&!e$.hasAudio||t$==="video"&&!e$.hasVideo)){const o$=new yb$1(Ry$1.REMOTE_USER_IS_NOT_PUBLISHED);throw fb$1.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid," with mediaType ").concat(t$,", remote track is not published")),o$}const i$=await this._subscribeMutex.lock();fb$1.info("[".concat(this._clientId,"] subscribe user ").concat(e$.uid,", mediaType: ").concat(t$));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e$,t$))await this._p2pChannel.unmuteRemote(e$,t$);else try{const s$=t$==="audio"?e$._audioSSRC:e$._videoSSRC,a$=t$==="audio"?e$._audioMid:e$._videoMid;this.store.subscribe(e$.uid,t$,Date.now()),this._p2pChannel instanceof bF$1&&await this._p2pChannel.subscribe(e$,t$,s$,a$)}catch(s$){throw s$}fb$1.info("[".concat(this._clientId,"] subscribe success user ").concat(e$.uid,", mediaType: ").concat(t$)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e$.uid,this._defaultStreamFallbackType).catch(s$=>{fb$1.warning("[".concat(this._clientId,"] auto set fallback failed"),s$)});const o$=t$==="audio"?e$._audioTrack:e$._videoTrack;if(!o$)throw new yb$1(Ry$1.UNEXPECTED_ERROR,"can not find remote track in user object");return o$}catch(o$){throw fb$1.error("[".concat(this._clientId,"] subscribe user ").concat(e$.uid," error"),o$),o$}finally{i$()}}async _subscribe(e$,t$,r$){if(this._p2pChannel instanceof bF$1)return this._p2pSubscribe(e$,t$);if(vy$1(t$,"mediaType",["audio","video"]),!this._joinInfo)throw new yb$1(Ry$1.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new yb$1(Ry$1.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u$=>u$===e$)){const u$=new yb$1(Ry$1.INVALID_REMOTE_USER,"user is not in the channel");throw fb$1.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid,", this user is not in the channel")),u$}if(!e$.hasAudio&&!e$.hasVideo){const u$=new yb$1(Ry$1.INVALID_REMOTE_USER,"user is not published");throw fb$1.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid,", user is not published")),u$}if(!(r$||(t$!=="audio"||e$.hasAudio&&e$._audioSSRC!==void 0)&&(t$!=="video"||e$.hasVideo&&e$._videoSSRC!==void 0))){const u$=new yb$1(Ry$1.REMOTE_USER_IS_NOT_PUBLISHED);throw fb$1.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid," with mediaType ").concat(t$,", remote track is not published")),u$}let i$=t$==="audio"?e$._audioSSRC:e$._videoSSRC,o$=t$==="audio"?e$._audioOrtc:e$._videoOrtc,s$=t$==="video"?e$._rtxSsrcId:void 0,a$={stream_type:t$==="audio"?dO$1.AUDIO:dO$1.VIDEO,ssrcId:i$};const c$=await this._subscribeMutex.lock();fb$1.info("[".concat(this._clientId,"] subscribe user ").concat(e$.uid,", mediaType: ").concat(t$));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e$,t$))await this._p2pChannel.unmuteRemote(e$,t$);else try{const l$=t$==="audio"?e$._audioSSRC:e$._videoSSRC;l$!==void 0&&l$!==i$&&(i$=l$,o$=t$==="audio"?e$._audioOrtc:e$._videoOrtc,s$=t$==="video"?e$._rtxSsrcId:void 0,a$={stream_type:t$==="audio"?dO$1.AUDIO:dO$1.VIDEO,ssrcId:i$}),rV$1.markSubscribeStart(this.store.clientId,i$),this.store.subscribe(e$.uid,t$,Date.now()),await this._p2pChannel.subscribe(e$,t$,i$,s$,o$);try{this._p2pChannel.isPreSubScribe(i$)||await this._gateway.subscribe(e$.uid,a$,!0)}catch(d$){if((d$==null?void 0:d$.code)!==Ry$1.WS_ABORT)throw await this._p2pChannel.unsubscribe(e$,t$),d$;await this._p2pChannel.unsubscribe(e$,t$,!0),this._p2pChannel.setPendingRemoteMedia(e$,t$)}this.store.subscribe(e$.uid,t$,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e$,t$)}catch(l$){throw this._p2pChannel.reportSubscribeEvent(!1,l$==null?void 0:l$.code,e$,t$),l$}fb$1.info("[".concat(this._clientId,"] subscribe success user ").concat(e$.uid,", mediaType: ").concat(t$)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e$.uid,this._defaultStreamFallbackType).catch(l$=>{fb$1.warning("[".concat(this._clientId,"] auto set fallback failed"),l$)});const u$=t$==="audio"?e$._audioTrack:e$._videoTrack;if(!u$)throw new yb$1(Ry$1.UNEXPECTED_ERROR,"can not find remote track in user object");return u$}catch(u$){throw fb$1.error("[".concat(this._clientId,"] subscribe user ").concat(e$.uid," error"),u$),u$}finally{c$()}}async massSubscribe(e$){if(wy$1(e$,"subscribeList"),!this._joinInfo)throw new yb$1(Ry$1.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new yb$1(Ry$1.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t$=Date.now(),r$=new Map,n$=await this._subscribeMutex.lock();fb$1.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e$.map(a$=>{let{user:c$,mediaType:u$}=a$;return"user: ".concat(c$==null?void 0:c$.uid,", mediaType: ").concat(u$)}).join("; ")));const i$=(e$=[...e$]).map(a$=>{let{user:c$,mediaType:u$}=a$;return{user:c$,mediaType:u$}}),o$=await this._p2pChannel.globalLock();try{var s$;for(let c$=e$.length-1;c$>=0;c$--){const u$=e$[c$],{user:l$,mediaType:d$}=u$;if(vy$1(d$,"mediaType",["audio","video"]),!l$){const f$=new yb$1(Ry$1.INVALID_PARAMS,"user property does not exist in subscribeList item");throw fb$1.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),f$}if(!this._users.find(f$=>f$===l$)){const f$=new yb$1(Ry$1.INVALID_REMOTE_USER,"user is not in the channel");fb$1.error("[".concat(this._clientId,"] can not massSubscribe ").concat(l$.uid,", this user is not in the channel")),i$[c$].error=f$,e$.splice(c$,1);continue}if(d$==="audio"&&(!l$.hasAudio||l$._audioSSRC===void 0)||d$==="video"&&(!l$.hasVideo||l$._videoSSRC===void 0)){const f$=new yb$1(Ry$1.REMOTE_USER_IS_NOT_PUBLISHED);fb$1.error("[".concat(this._clientId,"] can not subscribe ").concat(l$.uid," with mediaType ").concat(d$,", remote user is not published")),i$[c$].error=f$,e$.splice(c$,1);continue}const p$=tO$1.Video|tO$1.LwoVideo,_$=r$.get(l$);if(_$){if(d$==="video"?_$&p$:_$&tO$1.Audio){e$.splice(c$,1),fb$1.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(l$.uid,", mediaType:").concat(d$," twice"));continue}r$.set(l$,_$|(d$==="video"?p$:tO$1.Audio))}else r$.set(l$,d$==="video"?p$:tO$1.Audio)}for(let c$=e$.length-1;c$>=0;c$--){const u$=e$[c$],{user:l$,mediaType:d$}=u$,h$=tO$1.Video|tO$1.LwoVideo;if(this._p2pChannel.hasRemoteMedia(l$,d$)){await this._p2pChannel.unmuteRemoteNoLock(l$,d$);const p$=r$.get(l$);r$.set(l$,d$==="video"?p$^h$:p$^tO$1.Audio),e$.splice(c$,1)}}this.store.massSubscribe(e$.map(c$=>({userId:c$.user.uid,type:c$.mediaType})),t$);let a$=Jn$1(s$=Array.from(r$.entries())).call(s$,(c$,u$)=>{let[l$,d$]=u$;if(d$===0)return c$;const h$={stream_id:l$.uid,stream_type:d$};return d$&tO$1.Audio&&(h$.audio_ssrc=l$._audioSSRC),d$&tO$1.Video&&(h$.video_ssrc=l$._videoSSRC),c$.push(h$),c$},[]);try{e$.length>0&&await this._p2pChannel.massSubscribeNoLock(e$.map(u$=>{let{user:l$,mediaType:d$}=u$;return{user:l$,mediaType:d$,ssrcId:d$===dO$1.VIDEO?l$._videoSSRC:l$._audioSSRC,rtxSsrcId:d$===dO$1.VIDEO?l$._rtxSsrcId:void 0}}));const c$=new Map;if(a$=a$.filter(u$=>u$.video_ssrc&&!this._p2pChannel.isPreSubScribe(u$.video_ssrc)||u$.audio_ssrc&&!this._p2pChannel.isPreSubScribe(u$.audio_ssrc)||!u$.video_ssrc&&!u$.audio_ssrc),a$.length>0){const u$=await this._gateway.subscribeAll(a$,!0);((u$==null?void 0:u$.users)||[]).forEach(l$=>{let{stream_id:d$,video_error_code:h$,audio_error_code:p$,error_code:_$}=l$;(h$||p$||_$)&&c$.set(d$,{video_error_code:h$,audio_error_code:p$,error_code:_$})})}if(Array.from(c$.entries()).length>0){const u$=[];Array.from(c$.entries()).forEach(l$=>{let[d$,h$]=l$;const p$=this.remoteUsers.find(_$=>_$.uid===d$);if(p$){let _$;h$.error_code||h$.video_error_code&&h$.audio_error_code?_$=void 0:h$.video_error_code?_$=dO$1.VIDEO:h$.audio_error_code&&(_$=dO$1.AUDIO),u$.push({user:p$,mediaType:_$})}}),u$.length>0&&await this._p2pChannel.massUnsubscribeNoLock(u$)}for(const u$ of i$){const l$=c$.get(u$.user.uid);if(l$){const d$=l$.error_code||u$.mediaType==="audio"&&l$.audio_error_code||u$.mediaType==="video"&&l$.video_error_code;if(d$){const h$=NO$1(d$);fb$1.error("user:".concat(u$.user.uid," mediaType:").concat(u$.mediaType," has massSubscribe error ").concat(h$.desc)),u$.error=new yb$1(Ry$1.SUBSCRIBE_FAILED,"code ".concat(d$,": ").concat(h$.desc))}}u$.error||(u$.mediaType==="video"?u$.track=u$.user.videoTrack:u$.track=u$.user.audioTrack)}return this.store.massSubscribe(i$.filter(u$=>!u$.error).map(u$=>({userId:u$.user.uid,type:u$.mediaType})),void 0,Date.now()),i$.forEach(u$=>{var l$;vb$1.subscribe(this.store.sessionId,{succ:!!u$.error,ec:((l$=u$.error)===null||l$===void 0?void 0:l$.code)||null,video:u$.mediaType===dO$1.VIDEO,audio:u$.mediaType===dO$1.AUDIO,peerid:u$.user.uid,subscribeRequestid:u$.mediaType===dO$1.VIDEO?u$.user._videoSSRC:u$.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t$),preSsrc:this._p2pChannel.isPreSubScribe(u$.user._videoSSRC)},!0)}),fb$1.info("[".concat(this._clientId,"] massSubscribe success ").concat(e$.map(u$=>{let{user:l$,mediaType:d$}=u$;return"user: ".concat(l$==null?void 0:l$.uid,", mediaType: ").concat(d$)}).join("; "))),i$}catch(c$){throw await this._p2pChannel.massUnsubscribeNoLock(e$),c$}}finally{o$(),n$()}}async unsubscribe(e$,t$,r$){if(!(e$ instanceof cF$1)){const o$=this.remoteUsers.find(s$=>s$.uid===e$);if(!o$)throw new yb$1(Ry$1.INVALID_REMOTE_USER,"user is not in the channel");e$=o$}if(t$||this.store.useP2P){if(t$==="datachannel")return this._unsubscribeDataChannel(e$,r$)}else await this._unsubscribeDataChannel(e$,r$);if(t$&&vy$1(t$,"mediaType",["audio","video"]),!this._joinInfo)throw new yb$1(Ry$1.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(o$=>o$===e$)){const o$=new yb$1(Ry$1.INVALID_REMOTE_USER,"user is not in the channel");throw fb$1.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e$.uid,", user is not in the channel")),o$}fb$1.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e$.uid,", mediaType: ").concat(t$));const i$=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof bF$1)await this._p2pChannel.unsubscribe(e$,t$);else{const o$=await this._p2pChannel.unsubscribe(e$,t$);o$&&await this._gateway.unsubscribe(o$,e$.uid),t$&&t$!=="audio"||(e$._audio_pre_subscribed=!1),t$&&t$!=="video"||(e$._video_pre_subscribed=!1),e$._is_pre_created&&nA$1(this._users,e$),fb$1.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e$.uid,", mediaType: ").concat(t$))}}catch(o$){if(o$.code===Ry$1.DISCONNECT_P2P)return void fb$1.warning("disconnecting p2p, abort unsubscribe request.");throw fb$1.error("[".concat(this._clientId,"] unsubscribe user ").concat(e$.uid," error"),o$.toString()),o$}finally{i$()}}async _unsubscribeDataChannel(e$,t$){if(t$&&yy$1(t$,"id",0,65535,!0),!this._joinInfo)throw new yb$1(Ry$1.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i$=>i$===e$)){const i$=new yb$1(Ry$1.INVALID_REMOTE_USER,"user is not in the channel");throw fb$1.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e$.uid,", user is not in the channel")),i$}let n$;if(typeof t$=="number"){const i$=e$._dataChannels.find(o$=>o$.id===t$);i$&&(n$=[i$])}else n$=e$._dataChannels;if(n$===void 0){const i$=new yb$1(Ry$1.REMOTE_USER_IS_NOT_PUBLISHED);throw fb$1.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e$.uid," with channelId ").concat(t$,", remote datachannel is not published")),i$}fb$1.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e$.uid,", mediaType: datachannel, ids: ").concat(n$.map(i$=>i$.id)));try{const i$=await this._p2pChannel.unsubscribeDataChannel(e$,n$);i$&&await this._gateway.unsubscribeDataChannel(i$,e$.uid),fb$1.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e$.uid,", mediaType: datachannel, ids: ").concat(i$))}catch(i$){if(i$.code===Ry$1.DISCONNECT_P2P)return void fb$1.warning("disconnecting p2p, abort unsubscribe request.");throw fb$1.error("[".concat(this._clientId,"] unsubscribe user ").concat(e$.uid," error"),i$.toString()),i$}}async massUnsubscribe(e$){if(wy$1(e$,"unsubscribeList"),!this._joinInfo)throw new yb$1(Ry$1.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");fb$1.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e$.map(r$=>{let{user:n$,mediaType:i$}=r$;return"user: ".concat(n$==null?void 0:n$.uid,", mediaType: ").concat(i$,";")}).join())),e$=[...e$];const t$=new Map;for(let r$=e$.length-1;r$>=0;r$--){const{user:n$,mediaType:i$}=e$[r$];if(!n$){const a$=new yb$1(Ry$1.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw fb$1.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),a$}if(vy$1(i$,"mediaType",["video","audio",void 0]),!this._users.find(a$=>a$===n$)){fb$1.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(n$.uid,", user is not in the channel")),e$.splice(r$,1);continue}const s$=tO$1.Video|tO$1.LwoVideo;if(t$.has(n$)){const a$=t$.get(n$);let c$;switch(i$){case"video":c$=a$&s$;break;case"audio":c$=a$&tO$1.Audio;break;default:c$=a$&(tO$1.Audio|s$)}if(c$){fb$1.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(n$.uid,",mediaType:").concat(i$," twice.")),e$.splice(r$,1);continue}i$?i$==="audio"?t$.set(n$,a$|tO$1.Audio):i$==="video"&&t$.set(n$,a$|s$):t$.set(n$,a$|tO$1.Audio|s$)}else i$?i$==="audio"?t$.set(n$,tO$1.Audio):i$==="video"&&t$.set(n$,s$):t$.set(n$,tO$1.Audio|s$)}try{const r$=await this._p2pChannel.massUnsubscribe(e$);r$&&await this._gateway.massUnsubscribe(r$),fb$1.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e$.map(n$=>{let{user:i$,mediaType:o$}=n$;return"user: ".concat(i$==null?void 0:i$.uid,", mediaType: ").concat(o$,";")}).join()))}catch(r$){if(r$.code===Ry$1.DISCONNECT_P2P)return void fb$1.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw fb$1.error("[".concat(this._clientId,"] massUnsubscribe error"),r$.toString()),r$}}async setLowStreamParameter(e$){(function(r$){if(!r$)throw new Cy$1(Ry$1.INVALID_PARAMS);Oy$1(r$.width)||Ay$1(r$.width,"streamParameter.width"),Oy$1(r$.height)||Ay$1(r$.height,"streamParameter.height"),Oy$1(r$.framerate)||Ay$1(r$.framerate,"streamParameter.framerate"),Oy$1(r$.bitrate)||yy$1(r$.bitrate,"streamParameter.bitrate")})(e$),(!e$.width&&e$.height||e$.width&&!e$.height)&&fb$1.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),fb$1.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e$));const t$=this._configDistribute.getLowStreamConfigDistribute();if(t$&&t$.bitrate&&e$.bitrate&&t$.bitrate<e$.bitrate&&(e$.bitrate=t$.bitrate),this._lowStreamParameter=e$,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e$,hO$1.LocalVideoLowTrack)}async enableDualStream(){if(!ZP$1().supportDualStream)throw vb$1.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new yb$1(Ry$1.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new yb$1(Ry$1.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e$){throw vb$1.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e$}this._isDualStreamEnabled=!0,vb$1.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),fb$1.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new yb$1(Ry$1.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(hO$1.LocalVideoLowTrack))try{const e$=await this._p2pChannel.unpublishLowStream();e$&&await this._gateway.unpublish(e$,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e$){throw vb$1.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e$}this._isDualStreamEnabled=!1,vb$1.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),fb$1.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e$,t$){if(function(r$){vy$1(r$,"role",["audience","host"])}(e$),t$&&qy$1(t$),this.mode==="rtc"||this.mode==="p2p")throw fb$1.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new yb$1(Ry$1.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t$&&t$.level&&e$==="host")throw new yb$1(Ry$1.INVALID_OPERATION,"host mode can not set audience latency level");if(e$==="audience"&&this._p2pChannel.hasLocalMedia())throw new yb$1(Ry$1.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e$,t$),this._config.role=e$,fb$1.info("[".concat(this._clientId,"] set client role to ").concat(e$,", level: ").concat(t$&&t$.level))}getRemoteInboundOffset(){var e$;const t$=(e$=this._p2pChannel.getStats())===null||e$===void 0?void 0:e$.audioSend[0];if(!t$||!t$.timestamp)return 0;const r$=t$.timestamp-Date.now();return Math.abs(r$)>1e3+t$.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r$:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e$,t$){if(by$1(e$,"proxyServer"),!t$){if(this.connectionState!=="DISCONNECTED")throw new yb$1(Ry$1.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new yb$1(Ry$1.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e$,vb$1.setProxyServer(this._proxyServer),fb$1.setProxyServer(this._proxyServer),fb$1.info("[".concat(this._clientId,"] Set proxy server ").concat(t$?"by initialize call":""," success."))}setTurnServer(e$,t$){if(Array.isArray(e$)||(e$=[e$]),!t$){if(this.connectionState!=="DISCONNECTED")throw new yb$1(Ry$1.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new yb$1(Ry$1.INVALID_OPERATION,"You have already set the proxy")}if(Ky$1(e$))return this._turnServer={servers:e$,mode:"original-manual"},void fb$1.info("[".concat(this._clientId,"] Set original turnserver ").concat(t$?"by initialize call":""," success: ").concat(e$.map(r$=>r$.urls).join(","),"."));e$.forEach(r$=>Yy$1(r$)),this._turnServer={servers:e$,mode:"manual"},fb$1.info("[".concat(this._clientId,"] Set turnserver ").concat(t$?"by initialize call":""," success."))}setLicense(e$){if(this.connectionState!=="DISCONNECTED")throw new yb$1(Ry$1.INVALID_OPERATION,"you should set license before join channel");if(by$1(e$,"license",32,32),!/^[A-Za-z\d]+$/.test(e$))throw new yb$1(Ry$1.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e$,fb$1.info("[".concat(this._clientId,"] set license success"),e$)}startProxyServer(e$){if(this.connectionState!=="DISCONNECTED")throw new yb$1(Ry$1.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new yb$1(Ry$1.INVALID_OPERATION,"You have already set the proxy");const t$=[3,4,5];let r$;switch(e$===void 0&&(e$=3),e$){case 1:case 2:throw new yb$1(Ry$1.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:r$="proxy3";break;case 4:r$="proxy4";break;case 5:r$="proxy5";break;default:throw new yb$1(Ry$1.INVALID_PARAMS,"proxy server mode must be ".concat(t$.join("|")))}this._cloudProxyServerMode=r$,this.store.cloudProxyServerMode=r$,fb$1.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new yb$1(Ry$1.INVALID_OPERATION,"Stop proxy server after leave channel");vb$1.setProxyServer(),fb$1.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",fb$1.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e$){if(!e$.accessPoints)throw new yb$1(Ry$1.INVALID_PARAMS,"accessPoints is required.");wy$1(e$.accessPoints.serverList,"accessPoints.serverList"),by$1(e$.accessPoints.domain,"accessPoints.domain");const t$=(h$,p$)=>{yy$1(h$,p$,0,65535,!0)};let r$=443;if(e$.accessPoints.port&&(t$(e$.accessPoints.port,"accessPoints.port"),r$=e$.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new yb$1(Ry$1.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");XA$1("CLOSE_AFB_FOR_LOCAL_AP")&&(JA$1("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),JA$1("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const n$=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i$=e$.accessPoints.domain,o$=e$.accessPoints.serverList.map(h$=>n$.test(h$)?"".concat(h$.replace(/\./g,"-"),".").concat(i$):h$),s$=o$.map(h$=>"".concat(h$,":").concat(r$));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,JA$1("WEBCS_DOMAIN",s$),JA$1("WEBCS_DOMAIN_BACKUP_LIST",s$),JA$1("GATEWAY_DOMAINS",[i$]),e$.report&&e$.report.hostname&&Array.isArray(e$.report.hostname)&&e$.report.hostname.length?(wy$1(e$.report.hostname,"report.hostname"),JA$1("EVENT_REPORT_DOMAIN",e$.report.hostname[0]),JA$1("EVENT_REPORT_BACKUP_DOMAIN",e$.report.hostname[1]||e$.report.hostname[0])):(JA$1("EVENT_REPORT_DOMAIN",o$[0]),JA$1("EVENT_REPORT_BACKUP_DOMAIN",o$[1]||o$[0]));let a$=6443;e$.report&&e$.report.port&&(t$(e$.report.port,"report.port"),a$=e$.report.port),JA$1("STATS_COLLECTOR_PORT",a$),e$.report?JA$1("ENABLE_EVENT_REPORT",!0):JA$1("ENABLE_EVENT_REPORT",!1);let c$="";e$.log&&e$.log.hostname&&Array.isArray(e$.log.hostname)&&e$.log.hostname.length?(wy$1(e$.log.hostname,"log.hostname"),c$=e$.log.hostname[0]):c$=o$[0];let u$=6444;e$.log&&e$.log.port&&(t$(e$.log.port,"log.port"),u$=e$.log.port),JA$1("LOG_UPLOAD_SERVER","".concat(c$,":").concat(u$));let l$=[];e$.cds&&e$.cds.hostname&&Array.isArray(e$.cds.hostname)&&e$.cds.hostname.length?(wy$1(e$.cds.hostname,"cds.hostname"),l$=e$.cds.hostname):l$=o$;let d$=443;e$.cds&&e$.cds.port&&(t$(e$.cds.port,"cds.port"),d$=e$.cds.port),JA$1("CDS_AP",l$.map(h$=>"".concat(h$,":").concat(d$))),e$.cds?JA$1("ENABLE_CONFIG_DISTRIBUTE",!0):JA$1("ENABLE_CONFIG_DISTRIBUTE",!1),fb$1.info("set local access point v2 success")}setLocalAccessPoints(e$,t$){if(wy$1(e$,"serverList"),by$1(t$,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new yb$1(Ry$1.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const r$=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e$=e$.map(n$=>r$.test(n$)?"".concat(n$.replace(/\./g,"-"),".").concat(t$):n$),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,JA$1("WEBCS_DOMAIN",e$),JA$1("WEBCS_DOMAIN_BACKUP_LIST",e$),JA$1("GATEWAY_DOMAINS",[t$]),JA$1("EVENT_REPORT_DOMAIN",e$[0]),JA$1("EVENT_REPORT_BACKUP_DOMAIN",e$[1]||e$[0]),JA$1("LOG_UPLOAD_SERVER","".concat(e$[0],":6444")),fb$1.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e$){if(vy$1(e$,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e$,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e$),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t$){throw fb$1.error("[".concat(this._clientId,"] set default remote video stream type error"),t$.toString()),t$}else fb$1.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e$))}async setRemoteVideoStreamType(e$,t$){vy$1(t$,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e$,t$),setTimeout(()=>{const r$=this._users.find(n$=>n$.uid===e$);r$&&r$.videoTrack&&r$.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(r$){throw fb$1.error("[".concat(this._clientId,"] set remote video stream type error"),r$.toString()),r$}fb$1.info("[".concat(this._clientId,"] set remote ").concat(e$," video stream type to ").concat(t$)),this._remoteStreamTypeCacheMap.set(e$,t$)}async setStreamFallbackOption(e$,t$){vy$1(t$,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e$,t$)}catch(r$){throw fb$1.error("[".concat(this._clientId,"] set stream fallback option"),r$.toString()),r$}fb$1.info("[".concat(this._clientId,"] set remote ").concat(e$," stream fallback type to ").concat(t$)),this._streamFallbackTypeCacheMap.set(e$,t$)}setEncryptionConfig(e$,t$,r$,n$){(function(o$){vy$1(o$,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e$),by$1(t$,"secret");const i$=["aes-128-gcm2","aes-256-gcm2"];if(Dn$1(i$).call(i$,e$)){if(!r$||!(r$ instanceof Uint8Array&&r$.length===32))throw new yb$1(Ry$1.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r$)throw new yb$1(Ry$1.INVALID_PARAMS,"current encrypt mode does not need salt");if(n$){if(Iy$1(n$,"encryptDataStream"),!Dn$1(i$).call(i$,e$))throw new yb$1(Ry$1.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t$)||fb$1.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e$,this._encryptionSecret=t$,r$&&(this._encryptionSalt=uA$1(r$))}async renewToken(e$){if(by$1(e$,"token",1,2047),!this._key||!this._joinInfo)throw new yb$1(Ry$1.INVALID_OPERATION,"renewToken should not be called before user join");const t$=this._key;this._key=e$,this._joinInfo&&(this._joinInfo.token=e$);const r$=await this._renewTokenMutex.lock();try{if(XA$1("USE_NEW_TOKEN")){fb$1.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const n$=await Zx$1(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||PA$1);fb$1.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e$,ticket:n$})}else fb$1.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e$});fb$1.debug("[".concat(this._clientId,"] renewToken success"))}catch(n$){throw this._key=t$,this._joinInfo.token=t$,fb$1.error("[".concat(this._clientId,"] renewToken failed"),n$.toString()),n$}finally{r$()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?fb$1.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e$=this._p2pChannel.getAudioLevels();this.safeEmit(zy$1.VOLUME_INDICATOR,e$)},XA$1("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e$=this._statsCollector.getRTCStats(),t$=this._gateway.getInChannelInfo();return e$.Duration=Math.round(t$.duration/1e3),e$}async startLiveStreaming(e$,t$){if(!t$){if(this.codec!=="h264")throw new yb$1(Ry$1.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new yb$1(Ry$1.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e$)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e$))throw new yb$1(Ry$1.LIVE_STREAMING_TASK_CONFLICT);const r$=t$?Fw$1.TRANSCODE:Fw$1.RAW;return this._createLiveStreamingClient(r$).startLiveStreamingTask(e$,r$)}setLiveTranscoding(e$){return this._createLiveStreamingClient(Fw$1.TRANSCODE).setTranscodingConfig(e$)}async stopLiveStreaming(e$){const t$=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(r$=>r$&&r$.hasUrl(e$));if(!t$.length)throw new yb$1(Ry$1.INVALID_PARAMS,"can not find live streaming url to stop");await Gh$1.all(t$.map(r$=>r$&&r$.stopLiveStreamingTask(e$)))}async startChannelMediaRelay(e$){LF$1(e$),await this._createChannelMediaRelayClient().startChannelMediaRelay(e$)}async updateChannelMediaRelay(e$){LF$1(e$),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e$)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e$){var t$;let r$=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new yb$1(Ry$1.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e$=="string"||e$ instanceof Uint8Array)&&(e$={payload:e$}),typeof e$.payload=="string"){const i$=new TextEncoder;e$.payload=i$.encode(e$.payload)}let n$=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Dn$1(t$=["aes-128-gcm2","aes-256-gcm2"]).call(t$,this._encryptionMode)&&(n$=!0,e$.payload=await async function(i$,o$,s$){var a$;const c$=Jn$1(a$=Array.from(s$)).call(a$,(f$,m$)=>f$+m$,0),u$={serverTs:0,seq:ob$1++,length:s$.length,checkSum:c$},l$=new Uint8Array(yA$1(c$,2)),d$=new ArrayBuffer(rb$1),h$=new DataView(d$);h$.setUint32(0,u$.serverTs),h$.setUint16(4,u$.seq),h$.setUint16(6,u$.length),h$.setUint16(8,u$.checkSum);const p$=16-s$.length%16;s$=pA$1(s$,new Uint8Array(p$));const _$=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i$,tagLength:tb$1,additionalData:l$},o$,s$);return pA$1(new Uint8Array(d$),new Uint8Array(_$))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e$.payload)),new Blob([e$.payload]).size>1024)throw new yb$1(Ry$1.INVALID_PARAMS,n$?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Pw$1.DATA_STREAM,{payload:uA$1(e$.payload),syncWithAudio:e$.syncWithAudio,sendTs:Date.now()-vB$1},!r$)}sendMetadata(e$){if(!this._joinInfo)throw new yb$1(Ry$1.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e$]).size>1024)throw new yb$1(Ry$1.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Pw$1.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:uA$1(e$)})}async sendCustomReportMessage(e$){if(Array.isArray(e$)||(e$=[e$]),e$.forEach(Tb$1),!this._joinInfo)throw new yb$1(Ry$1.INVALID_OPERATION,"can not send custom report, not joined");await vb$1.sendCustomReportMessage(this._joinInfo.sid,e$)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e$,t$){vy$1(t$.spatialLayer,"spatialLayer",[0,1,2,3]),vy$1(t$.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e$,t$)}catch(r$){throw fb$1.error("[".concat(this._clientId,"] pick SVC layer failed"),r$.toString()),r$}}async setRTMConfig(e$){const{apRTM:t$=!1,rtmFlag:r$}=e$;if(Iy$1(t$,"apRTM"),yy$1(r$,"rtmFlag",0),this._rtmConfig.apRTM=t$,this._rtmConfig.rtmFlag=r$,fb$1.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e$)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t$,this._joinInfo.rtmFlag=r$,this._gateway.setRTM2Flag(r$)}_reset(){if(fb$1.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Lv$1.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&JB$1(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&vb$1.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e$=>{e$._audioTrack&&e$._audioTrack._destroy(),e$._videoTrack&&e$._videoTrack._destroy(),e$._dataChannels&&(e$._dataChannels.forEach(t$=>t$._close()),e$._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new NA$1("client-publish"),this._subscribeMutex=new NA$1("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e$,t$){var r$;const n$=e$||SA$1();e$?fb$1.debug("[".concat(this._clientId,"] new Session ").concat(n$)):fb$1.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n$));const i$=e$?"":this._sessionId||"";this._sessionId=n$,this.store.sessionId=n$,vb$1.addSid(n$);const o$={lts:new Date().getTime(),mode:this.mode,buildFormat:2,stringUid:(t$==null?void 0:t$.stringUid)||((r$=this._joinInfo)===null||r$===void 0?void 0:r$.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i$,clientRole:this.role==="audience"?2:1};vb$1.sessionInit(this._sessionId,IG$1({cname:t$.channel,appid:t$.appId},o$)),this._joinInfo&&(this._joinInfo.sid=n$),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n$)}async _publishHighStream(e$){if(!this._joinInfo||this._uid===void 0)throw new yb$1(Ry$1.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new yb$1(Ry$1.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&XA$1("FORCE_TURN")&&!XA$1("TURN_ENABLE_TCP")&&!XA$1("TURN_ENABLE_UDP"))throw new yb$1(Ry$1.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");fb$1.debug("[".concat(this._clientId,"] publish high stream"));try{const r$=await this._p2pChannel.publish(e$,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof bF$1){const n$=(await r$.next()).value;if(n$){try{await this._gateway.sendExtensionMessage(IO$1.PUBLISH,n$,!0)}catch(i$){throw r$.throw(i$),i$}await r$.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const n$=(await r$.next()).value;if(n$){var t$;let i$;try{i$=await this._gateway.publish(this._uid,n$,!0)}catch(o$){if(o$.code!==Ry$1.DISCONNECT_P2P)throw r$.throw(o$),o$}await r$.next(((t$=i$)===null||t$===void 0?void 0:t$.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i$ of e$)i$ instanceof aU$1&&i$._encoderConfig&&this._gateway.setVideoProfile(i$._encoderConfig),!i$.muted&&i$.enabled||await this._p2pChannel.muteLocalTrack(i$)}}catch(r$){if(this._p2pChannel.reportPublishEvent(!1,r$==null?void 0:r$.code,e$),(r$==null?void 0:r$.code)===Ry$1.WS_ABORT)return;throw r$}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new yb$1(Ry$1.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new yb$1(Ry$1.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));fb$1.debug("[".concat(this._clientId,"] publish low stream"));const e$=this._configDistribute.getLowStreamConfigDistribute();e$&&e$.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e$.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e$.bitrate));try{const r$=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n$=(await r$.next()).value;if(n$){var t$;let i$;try{i$=await this._gateway.publish(this._uid,n$,!0)}catch(o$){if(o$.code!==Ry$1.DISCONNECT_P2P)throw r$.throw(o$),o$}r$.next(((t$=i$)===null||t$===void 0?void 0:t$.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(r$){if(this._p2pChannel.reportPublishEvent(!1,r$==null?void 0:r$.code,void 0,!0),(r$==null?void 0:r$.code)===Ry$1.WS_ABORT)return;throw r$}}_createLiveStreamingClient(e$){const t$=()=>{if(!this._joinInfo||!this._appId)return new yb$1(Ry$1.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r$=(n$={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},gB$1("LiveStreaming").create(n$));var n$;return r$.onLiveStreamError=(i$,o$)=>{vb$1.reportApiInvoke(this._sessionId,{name:By$1.ON_LIVE_STREAM_ERROR,options:[i$,o$],tag:jy$1.TRACER}).onSuccess(),this.safeEmit(zy$1.LIVE_STREAMING_ERROR,i$,o$)},r$.onLiveStreamWarning=(i$,o$)=>{vb$1.reportApiInvoke(this._sessionId,{name:By$1.ON_LIVE_STREAM_WARNING,options:[i$,o$],tag:jy$1.TRACER}).onSuccess(),this.safeEmit(zy$1.LIVE_STREAMING_WARNING,i$,o$)},r$.on(Kw$1.REQUEST_WORKER_MANAGER_LIST,(i$,o$,s$)=>{if(!this._joinInfo)return s$(new yb$1(Ry$1.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(a$,c$,u$,l$){const d$=XA$1("UAP_AP").slice(0,XA$1("AJAX_REQUEST_CONCURRENT")).map(h$=>c$.proxyServer?"https://".concat(c$.proxyServer,"/ap/?url=").concat(h$+"/api/v1?action=uap"):"https://".concat(h$,"/api/v1?action=uap"));return await Dx$1(d$,a$,c$,u$,l$)})(i$,this._joinInfo,this._axiosCancelSource.token,PA$1).then(o$).catch(s$)}),r$};return e$===Fw$1.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t$(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t$(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new yb$1(Ry$1.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t$,sendResolutionHeight:r$}=this.getLocalVideoStats(),n$=(e$={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t$,height:r$}},gB$1("ChannelMediaRelay").create(e$));n$.on("state",i$=>{i$===Xw$1.RELAY_STATE_FAILURE&&n$&&n$.dispose(),this.safeEmit(zy$1.CHANNEL_MEDIA_RELAY_STATE,i$)}),n$.on("event",i$=>{this.safeEmit(zy$1.CHANNEL_MEDIA_RELAY_EVENT,i$)}),this._channelMediaRelayClient=n$,this._statsCollector.onStatsChanged=(i$,o$)=>{var s$;i$==="resolution"&&((s$=this._channelMediaRelayClient)===null||s$===void 0||s$.setVideoProfile(o$))}}var e$;return this._channelMediaRelayClient}_handleUpdateDataChannel(e$,t$){const{added:r$,deleted:n$}=e$,i$=[];if(t$){const o$=[];this._users.forEach(s$=>{s$._dataChannels.forEach(a$=>{r$.every(c$=>c$.uid!==s$._uintid||c$.stream_id!==a$.id)&&o$.push({uid:s$._uintid,stream_id:a$.id,ordered:a$.ordered,max_retrans_times:a$.maxRetransmits,metadata:a$.metadata})})}),o$.length>0&&this._handleUpdateDataChannel({added:[],deleted:o$})}Array.isArray(r$)&&r$.length>0&&r$.forEach(o$=>{const{uid:s$,stream_id:a$,ordered:c$,max_retrans_times:u$,metadata:l$}=o$,d$=this._users.find(h$=>h$._uintid===s$);if(!d$)return void fb$1.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(fb$1.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(s$)),Dn$1(i$).call(i$,d$)||i$.push(d$),d$._uintid||(d$._uintid=s$),d$._dataChannels.findIndex(h$=>h$.id===o$.stream_id)===-1){const h$={id:a$,ordered:!!c$,maxRetransmits:u$,metadata:l$},p$=function(_$){return RB$1(_$,!0)}(h$);d$._dataChannels.push(p$),fb$1.info("[".concat(this._clientId,"] remote user ").concat(d$.uid," published datachannel")),t$||this.safeEmit(zy$1.USER_PUBLISHED,d$,"datachannel",h$)}this._p2pChannel.hasPendingRemoteDataChannel(d$,o$.stream_id)&&(fb$1.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(d$.uid," after reconnect.")),this._subscribeDataChannel(d$,o$.stream_id).catch(h$=>{fb$1.error("[".concat(this._clientId,"] resubscribe datachannel error"),h$.toString())}))}),t$&&(this.safeEmit(zy$1.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(n$)&&n$.length>0&&n$.forEach(o$=>{const{uid:s$,stream_id:a$}=o$,c$=this._users.find(l$=>l$._uintid===s$);if(!c$)return void fb$1.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const u$=c$._dataChannels.find(l$=>l$.id===o$.stream_id);u$&&(fb$1.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(s$)),this._p2pChannel.unsubscribeDataChannel(c$,[u$]).then(l$=>{if(c$._dataChannels=c$._dataChannels.filter(d$=>d$!==u$),l$)return this._gateway.unsubscribeDataChannel(l$,c$.uid)}),fb$1.info("[".concat(this._clientId,"] remote user ").concat(s$," unpublished datachannel ,id:").concat(u$.id)),this.safeEmit(zy$1.USER_UNPUBLISHED,c$,"datachannel",u$._config))})}_handleRemoveDataChannels(e$){const t$=this._users.find(r$=>r$.uid===e$.uid);if(t$){if(t$._dataChannels!==void 0&&t$._dataChannels.length>0){fb$1.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e$.uid));const r$=()=>{fb$1.info("[".concat(this._clientId,"] remote user ").concat(t$.uid," unpublished datachannel")),t$._dataChannels.forEach(n$=>{this.safeEmit(zy$1.USER_UNPUBLISHED,t$,"datachannel",n$._config)})};this._p2pChannel.unsubscribeDataChannel(t$,t$._dataChannels).then(n$=>{if(n$)return this._gateway.unsubscribeDataChannel(n$,t$.uid)}),r$()}}else fb$1.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on($w$1.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on($w$1.CONNECTION_STATE_CHANGE,(e$,t$,r$)=>{var n$;if(r$===Hy$1.FALLBACK)return;const i$=()=>{this.safeEmit(zy$1.CONNECTION_STATE_CHANGE,e$,t$,r$)};if(vb$1.reportApiInvoke(this._sessionId||((n$=this._gateway.joinInfo)===null||n$===void 0?void 0:n$.sid)||null,{name:By$1.CONNECTION_STATE_CHANGE,options:[e$,t$,r$],tag:jy$1.TRACER}).onSuccess(JSON.stringify({cur:e$,prev:t$,reason:r$})),fb$1.info("[".concat(this._clientId,"] connection state change: ").concat(t$," -> ").concat(e$)),e$==="DISCONNECTED")return this._reset(),void i$();if(e$==="RECONNECTING")this._users.forEach(s$=>{s$._trust_in_room_=!1,s$._trust_audio_enabled_state_=!1,s$._trust_video_enabled_state_=!1,s$._trust_audio_mute_state_=!1,s$._trust_video_mute_state_=!1,s$._trust_audio_stream_added_state_=!1,s$._trust_video_stream_added_state_=!1,s$._is_pre_created||(s$._audio_pre_subscribed||(s$._audioSSRC=void 0,s$._audioOrtc=void 0),s$._video_pre_subscribed||(s$._videoSSRC=void 0,s$._videoOrtc=void 0,s$._rtxSsrcId=void 0),s$._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e$==="CONNECTED"){var o$;this._streamFallbackTypeCacheMap.forEach((s$,a$)=>{this._gateway.setStreamFallbackOption(a$,s$).catch(c$=>{fb$1.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),c$)})}),this._remoteStreamTypeCacheMap.forEach((s$,a$)=>{this._gateway.setRemoteVideoStreamType(a$,s$).catch(c$=>{fb$1.warning("[".concat(this._clientId,"] auto set remote stream type failed"),c$)})}),this._remoteDefaultVideoStreamType!==void 0&&((o$=this._joinInfo)===null||o$===void 0?void 0:o$.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{fb$1.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(s$=>{fb$1.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(s$))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(s$=>!s$._trust_in_room_).forEach(s$=>{fb$1.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(s$.uid)),this._handleUserOffline({uid:s$.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(s$=>{s$._trust_audio_mute_state_||(fb$1.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(s$.uid)),this._handleMuteStream(s$.uid,dO$1.AUDIO,!1)),s$._trust_video_mute_state_||(fb$1.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(s$.uid)),this._handleMuteStream(s$.uid,dO$1.VIDEO,!1)),s$._trust_audio_enabled_state_||(fb$1.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(s$.uid)),this._handleSetStreamLocalEnable("audio",s$.uid,!0)),s$._trust_video_enabled_state_||(fb$1.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(s$.uid)),this._handleSetStreamLocalEnable("video",s$.uid,!0)),s$._trust_video_stream_added_state_||(fb$1.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(s$.uid)),this._handleResetAddStream(s$,"video")),s$._trust_audio_stream_added_state_||(fb$1.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(s$.uid)),this._handleResetAddStream(s$,"audio")),s$._video_added_||s$._audio_added_||(fb$1.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(s$.uid)),this._handleRemoveStream({uid:s$.uid,uint_id:s$._uintid}))}))},1e3))}i$()}),this._gateway.on($w$1.REQUEST_NEW_GATEWAY_LIST,async(e$,t$)=>{if(!this._joinInfo)return t$(new yb$1(Ry$1.UNEXPECTED_ERROR,"can not recover, no join info"));try{let r$;const n$=await YB$1(IG$1(IG$1({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));n$?(r$=n$.ap,XB$1(n$),this._joinInfo.preload=!0):(r$=await Hx$1(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||PA$1,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=r$.gatewayInfo.res,this._joinInfo.gatewayAddrs=r$.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=r$.gatewayInfo.uni_lbs_ip);const i$=[];r$.gatewayInfo.gatewayAddrs.forEach(o$=>{let{address:s$}=o$;const[a$,c$]=s$.split(":");this._joinInfo&&this._joinInfo.proxyServer?i$.push({proxy:this._joinInfo.proxyServer,host:a$,port:c$}):i$.push({host:a$,port:c$})}),e$(i$)}catch(r$){t$(r$)}}),this._gateway.on($w$1.NETWORK_QUALITY,e$=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(zy$1.NETWORK_QUALITY,e$)}),this._gateway.on($w$1.STREAM_TYPE_CHANGE,(e$,t$)=>{this.safeEmit(zy$1.STREAM_TYPE_CHANGED,e$,t$),vb$1.reportApiInvoke(this._sessionId,{name:By$1.STREAM_TYPE_CHANGE,options:[e$,t$],tag:jy$1.TRACER}).onSuccess(JSON.stringify({uid:e$,streamType:t$}))}),this._gateway.on($w$1.IS_P2P_DISCONNECTED,e$=>{this._p2pChannel.isP2PDisconnected()?e$(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e$(!1):e$(!0)}),this._gateway.on($w$1.REQUEST_P2P_CONNECTION_PARAMS,async(e$,t$,r$)=>{try{let n$=await this._p2pChannel.getEstablishParams();XA$1("ENABLE_PREALLOC_PC")&&n$||(n$=await this._p2pChannel.startP2PConnection(e$)),t$(n$)}catch(n$){r$(n$)}}),this._gateway.on($w$1.JOIN_RESPONSE,(e$,t$)=>{if(this.store.useP2P)return;const r$=YU$1(e$.ortc,t$,e$.attributes.userAttributes.preSubSsrcs);this._p2pChannel.connect(r$)}),this._gateway.on($w$1.PRE_CONNECT_PC,async e$=>{const{candidates:t$,fingerprint:r$}=e$;if(this._joinInfo&&t$.length>0&&!this._p2pChannel.isPlanB){var n$;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:i$,cid:o$}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o$,"_").concat(i$),icePwd:"".concat(o$,"_").concat(i$)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(n$=XA$1("FINGERPRINT"))!==null&&n$!==void 0?n$:r$}]},candidates:t$,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(kw$1.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(kw$1.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(kw$1.ON_ADD_AUDIO_STREAM,e$=>this._handleAddAudioOrVideoStream("audio",e$.uid,e$.ssrcId,e$.cname,e$.uint_id,e$.ortc)),this._gateway.signal.on(kw$1.ON_ADD_VIDEO_STREAM,e$=>this._handleAddAudioOrVideoStream("video",e$.uid,e$.ssrcId,e$.cname,e$.uint_id,e$.ortc,e$.rtxSsrcId)),this._gateway.signal.on(kw$1.ON_REMOTE_DATASTREAM_UPDATE,e$=>{this._handleUpdateDataChannel(e$)}),this._gateway.signal.on(kw$1.ON_REMOTE_FULL_DATASTREAM_INFO,e$=>{this._handleUpdateDataChannel({added:e$.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(kw$1.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(kw$1.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(kw$1.MUTE_AUDIO,e$=>this._handleMuteStream(e$.uid,dO$1.AUDIO,!0)),this._gateway.signal.on(kw$1.UNMUTE_AUDIO,e$=>this._handleMuteStream(e$.uid,dO$1.AUDIO,!1)),this._gateway.signal.on(kw$1.MUTE_VIDEO,e$=>this._handleMuteStream(e$.uid,dO$1.VIDEO,!0)),this._gateway.signal.on(kw$1.UNMUTE_VIDEO,e$=>this._handleMuteStream(e$.uid,dO$1.VIDEO,!1)),this._gateway.signal.on(kw$1.RECEIVE_METADATA,e$=>{const t$=lA$1(e$.metadata);this.safeEmit(zy$1.RECEIVE_METADATA,e$.uid,t$)}),this._gateway.signal.on(kw$1.ON_DATA_STREAM,async e$=>{var t$;if(!e$)return;let r$=lA$1(e$.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Dn$1(t$=["aes-128-gcm2","aes-256-gcm2"]).call(t$,this._encryptionMode)){if(e$.payload.length<rb$1)throw new yb$1(Ry$1.UNEXPECTED_RESPONSE,"payload length ".concat(e$.payload.length," is less than header length ").concat(rb$1));r$=await async function(o$,s$,a$){const c$=a$.subarray(0,rb$1),u$=c$.slice(8,rb$1),l$=(u$[0]<<8)+u$[1],d$=(c$[6]<<8)+c$[7],h$=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:o$,tagLength:tb$1,additionalData:new Uint8Array(yA$1(l$,2))},s$,a$.subarray(rb$1));return new Uint8Array(h$).subarray(0,d$)}(this._encryptDataStreamIv,this._encryptDataStreamKey,r$)}let n$=0;if(e$.ordered||e$.syncWithAudio){const i$=this._p2pChannel.getStats(),o$=this.remoteUsers.find(a$=>a$.uid===e$.uid),s$=i$==null?void 0:i$.audioRecv.find(a$=>a$.ssrc===(o$==null?void 0:o$._audioSSRC));n$=s$==null?void 0:s$.jitterBufferMs}n$==null&&(n$=0),NB$1(IG$1(IG$1({},e$),{},{payload:r$}),n$,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(kw$1.ON_CRYPT_ERROR,()=>{dA$1(()=>{fb$1.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(zy$1.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(kw$1.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(kw$1.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{fb$1.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Hy$1.TOKEN_EXPIRE),this.safeEmit(zy$1.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(kw$1.ON_STREAM_FALLBACK_UPDATE,e$=>{fb$1.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e$.stream_id,", attr: ").concat(e$.stream_type)),this.safeEmit(zy$1.STREAM_FALLBACK,e$.stream_id,e$.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(kw$1.ON_PUBLISH_STREAM,e$=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e$.proxy})),fb$1.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e$))))}),this._gateway.signal.on(kw$1.ENABLE_LOCAL_VIDEO,e$=>{this._handleSetStreamLocalEnable("video",e$.uid,!0)}),this._gateway.signal.on(kw$1.DISABLE_LOCAL_VIDEO,e$=>{this._handleSetStreamLocalEnable("video",e$.uid,!1)}),this._gateway.signal.on(Dw$1.REQUEST_TIMEOUT,(e$,t$)=>{if(this._joinInfo)switch(e$){case Pw$1.PUBLISH:{if(!t$)return;const i$=t$.ortc;if(i$){var r$,n$;const o$=i$.some(c$=>{let{stream_type:u$}=c$;return u$===Zw$1.Audio}),s$=i$.some(c$=>{let{stream_type:u$}=c$;return u$!==Zw$1.Audio}),a$=i$.some(c$=>{let{stream_type:u$}=c$;return u$===Zw$1.Screen||u$===Zw$1.ScreenLow});t$.state==="offer"&&vb$1.publish(this._joinInfo.sid,{eventElapse:rV$1.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Ry$1.TIMEOUT,audio:o$,video:s$,p2pid:t$.p2p_id,publishRequestid:this.store.pubId,screenshare:a$,audioName:o$?(r$=i$.find(c$=>{let{stream_type:u$}=c$;return u$===Zw$1.Audio}))===null||r$===void 0||(r$=r$.ssrcs[0])===null||r$===void 0?void 0:r$.ssrcId.toString():void 0,videoName:s$?(n$=i$.find(c$=>{let{stream_type:u$}=c$;return u$!==Zw$1.Audio}))===null||n$===void 0||(n$=n$.ssrcs[0])===null||n$===void 0?void 0:n$.ssrcId.toString():void 0})}break}case Pw$1.SUBSCRIBE:t$&&vb$1.subscribe(this._joinInfo.sid,{succ:!1,ec:Ry$1.TIMEOUT,audio:t$.stream_type===dO$1.AUDIO,video:t$.stream_type===dO$1.VIDEO,peerid:t$.stream_id,subscribeRequestid:t$.ssrcId,p2pid:this.store.p2pId,eventElapse:rV$1.measureFromSubscribeStart(this.store.clientId,t$.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t$.ssrcId)})}}),this._gateway.signal.on(kw$1.ON_P2P_OK,e$=>{this.uid,this._uid}),this._gateway.signal.on(kw$1.ON_PUBLISHED_USER_LIST,e$=>{if(e$==null||!e$.users)return;XA$1("BLOCK_LOCAL_CLIENT")&&(e$.users=e$.users.filter(n$=>!Ob$1(n$.string_id||n$.stream_id,this.channelName)));const t$=[],r$=[];for(const n$ of e$.users){let i$=this._users.find(l$=>l$._uintid===n$.stream_id);i$?i$._trust_in_room_=!0:(i$=new cF$1(n$.string_id||n$.stream_id,n$.stream_id),this._users.push(i$),this.getListeners(zy$1.PUBLISHED_USER_LIST).length===0&&(fb$1.debug("[".concat(this._clientId,"] user online"),n$.stream_id),this.safeEmit(zy$1.USER_JOINED,i$)));const o$=tO$1.Audio&n$.stream_type,s$=(tO$1.Video|tO$1.LwoVideo)&n$.stream_type,a$=(65280&n$.stream_type)!=0,c$=o$&&i$.hasAudio,u$=s$&&i$.hasVideo;s$&&(i$._trust_video_stream_added_state_=!0,i$._video_added_=!0,i$._videoSSRC=n$.video_ssrc,i$._rtxSsrcId=n$.video_rtx),o$&&(i$._trust_audio_stream_added_state_=!0,i$._audio_added_=!0,i$._audioSSRC=n$.audio_ssrc),o$&&!c$&&this.getListeners(zy$1.PUBLISHED_USER_LIST).length===0&&(fb$1.info("[".concat(this._clientId,"] remote user ").concat(i$.uid," published audio")),this.safeEmit(zy$1.USER_PUBLISHED,i$,"audio")),s$&&!u$&&this.getListeners(zy$1.PUBLISHED_USER_LIST).length===0&&(fb$1.info("[".concat(this._clientId,"] remote user ").concat(i$.uid," published video")),this.safeEmit(zy$1.USER_PUBLISHED,i$,"video")),(o$&&!c$||s$&&!u$||a$)&&t$.push(i$),s$&&this._p2pChannel.hasPendingRemoteMedia(i$,"video")&&r$.push({user:i$,mediaType:"video"}),o$&&this._p2pChannel.hasPendingRemoteMedia(i$,"audio")&&r$.push({user:i$,mediaType:"audio"})}r$.length>0&&(fb$1.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r$.map(n$=>"user: ".concat(n$.user.uid,", mediaType: ").concat(n$.mediaType)).join("; ")," ")),this.massSubscribe(r$).catch(n$=>{fb$1.error("[".concat(this._clientId,"] mass resubscribe error"),n$.toString())})),this.getListeners(zy$1.PUBLISHED_USER_LIST).length>0?XA$1("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t$:(fb$1.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t$.map(n$=>n$.uid).join(", "))),this.safeEmit(zy$1.PUBLISHED_USER_LIST,t$)):fb$1.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t$.map(n$=>n$.uid).join(", ")))}),this._gateway.signal.on(kw$1.ON_RTP_CAPABILITY_CHANGE,e$=>{const{video_codec:t$}=e$;this._p2pChannel instanceof fB$1&&this._p2pChannel.updateRemoteRTPCapabilities(t$.map(r$=>r$.toLowerCase()).filter(r$=>{var n$;return Dn$1(n$=Object.keys(eb$1)).call(n$,r$)}))})}_handleP2PEvents(){this._gateway.signal.on(kw$1.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(IO$1.PUBLISH,(e$,t$,r$)=>{const{uid:n$}=e$;e$.forEach(i$=>{const{kind:o$,ssrcs:s$,mid:a$,isMuted:c$}=i$;this._handleP2PAddAudioOrVideoStream(o$,n$,s$[0].ssrcId,a$);const u$=this._users.find(l$=>l$.uid===n$);return u$&&this._p2pChannel instanceof bF$1?this._p2pChannel.mockSubscribe(u$,o$,s$[0].ssrcId,a$).then(()=>{t$()}).catch(r$):t$(),this._handleMuteStream(n$,o$,!!c$)})}),this._gateway.signal.on(IO$1.CALL,async(e$,t$,r$)=>{if(this._p2pChannel instanceof bF$1)try{var n$;t$(await this._p2pChannel.startP2P({turnServer:(n$=this._joinInfo)===null||n$===void 0?void 0:n$.turnServer},e$))}catch(i$){r$(i$)}}),this._gateway.signal.on(Dw$1.P2P_CONNECTION,async e$=>{this._p2pChannel instanceof bF$1&&await this._p2pChannel.p2pConnect(e$)}),this._gateway.signal.on(IO$1.UNPUBLISH,async(e$,t$,r$)=>{if(this._p2pChannel instanceof bF$1){const{unpubMsg:n$,uid:i$}=e$,o$=this._users.find(s$=>s$.uid===i$);if(!o$)return fb$1.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i$)),void t$();try{n$.forEach(async s$=>{let{stream_type:a$}=s$;const c$=a$===Zw$1.Audio?dO$1.AUDIO:dO$1.VIDEO;await this._p2pChannel.unsubscribe(o$,c$),this._handleMuteStream(i$,c$,!0)}),t$()}catch(s$){r$(s$)}}}),this._gateway.signal.on(IO$1.CONTROL,async(e$,t$)=>{const{action:r$}=e$;switch(r$){case yO$1.MUTE_LOCAL_VIDEO:this._handleMuteStream(t$,dO$1.VIDEO,!0);break;case yO$1.MUTE_LOCAL_AUDIO:this._handleMuteStream(t$,dO$1.AUDIO,!0);break;case yO$1.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t$),this._handleMuteStream(t$,dO$1.VIDEO,!1);break;case yO$1.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t$),this._handleMuteStream(t$,dO$1.AUDIO,!1)}}),this._gateway.signal.on(IO$1.RESTART_ICE,async(e$,t$,r$)=>{if(this._p2pChannel instanceof bF$1)try{const{direction:n$,iceParameter:i$}=e$;n$!==Mw$1.SEND_ONLY||i$?t$(await this._p2pChannel.restartICE(n$,i$)):(this._p2pChannel.handleDisconnect(n$),t$())}catch(n$){r$(n$)}}),this._gateway.signal.on(IO$1.CANDIDATE,e$=>{if(this._p2pChannel instanceof bF$1){const{candidate:t$,direction:r$}=e$;this._p2pChannel.addRemoteCandidate(t$,r$)}}),this._p2pChannel.on(_O$1.RequestP2PRestartICE,async(e$,t$,r$)=>{try{const{direction:n$}=e$;t$(await this._gateway.sendExtensionMessage(IO$1.RESTART_ICE,e$,n$===Mw$1.SEND_ONLY))}catch(n$){r$(n$)}}),this._p2pChannel.on(_O$1.LocalCandidate,e$=>{this._gateway.sendExtensionMessage(IO$1.CANDIDATE,JSON.stringify(e$),!0)}),this._p2pChannel.on(_O$1.RequestP2PMuteLocal,async(e$,t$,r$)=>{try{await this._gateway.sendExtensionMessage(IO$1.CONTROL,e$,!0),t$()}catch(n$){r$(n$)}}),this._p2pChannel.on(_O$1.RequestP2PUnmuteRemote,async(e$,t$,r$)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e$,this._joinInfo.stringUid||this._joinInfo.uid),t$()}catch(n$){n$.code===Ry$1.DISCONNECT_P2P?t$():r$(n$)}else t$()}),this._p2pChannel.on(_O$1.RequestP2PMuteRemote,async(e$,t$,r$)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e$,this._joinInfo.stringUid||this._joinInfo.uid),t$()}catch(n$){n$.code===Ry$1.DISCONNECT_P2P?t$():r$(n$)}else t$()}),this._p2pChannel.on(_O$1.StateChange,(e$,t$)=>{t$===pO$1.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(_O$1.RequestMuteLocal,async(e$,t$,r$)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e$,this._joinInfo.stringUid||this._joinInfo.uid),t$()}catch(n$){n$.code===Ry$1.DISCONNECT_P2P?t$():r$(n$)}else t$()}),this._p2pChannel.on(_O$1.RequestUnmuteLocal,async(e$,t$,r$)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e$,this._joinInfo.stringUid||this._joinInfo.uid),t$()}catch(n$){n$.code===Ry$1.DISCONNECT_P2P?t$():r$(n$)}else t$()}),this._p2pChannel.on(_O$1.RequestRePublish,(e$,t$,r$)=>{this.publish(e$,!1).then(t$).catch(r$)}),this._p2pChannel.on(_O$1.RequestRePublishDataChannel,(e$,t$,r$)=>{Gh$1.all(e$.map(async n$=>{const i$=await this._p2pChannel.publishDataChannel([n$]);try{i$.forEach(o$=>{this._uid&&this._gateway.publishDataChannel(this._uid,o$,!0)})}catch(o$){if(o$.code!==Ry$1.DISCONNECT_P2P)throw o$}})).then(t$).catch(r$)}),this._p2pChannel.on(_O$1.RequestReSubscribe,async(e$,t$,r$)=>{try{for(const{user:n$,kind:i$}of e$)i$===dO$1.VIDEO?await this.subscribe(n$,"video"):await this.subscribe(n$,"audio");t$()}catch(n$){r$(n$)}}),this._p2pChannel.on(_O$1.RequestUpload,(e$,t$)=>{this._gateway.upload(e$,t$)}),this._p2pChannel.on(_O$1.RequestUploadStats,e$=>{this._gateway.uploadWRTCStats(e$)}),this._p2pChannel.on(_O$1.MediaReconnectStart,e$=>{this.safeEmit(zy$1.MEDIA_RECONNECT_START,e$)}),this._p2pChannel.on(_O$1.MediaReconnectEnd,e$=>{this.safeEmit(zy$1.MEDIA_RECONNECT_END,e$)}),this._p2pChannel.on(_O$1.NeedSignalRTT,e$=>{e$(this._gateway.getSignalRTT())}),this._p2pChannel.on(_O$1.RequestRestartICE,async e$=>{if(this._p2pChannel instanceof bF$1)return;const t$=await this._p2pChannel.restartICE(e$),r$=await t$.next();if(r$.done)return;const n$=r$.value;let i$;try{i$=await this._gateway.restartICE({iceParameters:n$})}catch(s$){return void t$.throw(s$)}const{iceParameters:o$}=function(s$){const a$=s$.iceParameters;return{iceParameters:{iceUfrag:a$.iceUfrag,icePwd:a$.icePwd}}}(i$);await t$.next({remoteIceParameters:o$})}),this._p2pChannel.on(_O$1.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(_O$1.RequestReconnectPC,async()=>{var e$;const{iceParameters:t$,dtlsParameters:r$,rtpCapabilities:n$}=await this._p2pChannel.startP2PConnection({turnServer:(e$=this._joinInfo)===null||e$===void 0?void 0:e$.turnServer}),{gatewayEstablishParams:i$,gatewayAddress:o$}=await this._gateway.reconnectPC({iceParameters:t$,dtlsParameters:r$,rtpCapabilities:n$}),s$=YU$1(i$,o$);await this._p2pChannel.connect(s$),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(_O$1.RequestUnpublishForReconnectPC,async(e$,t$,r$)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e$,this._uid),t$()):r$()}),this._p2pChannel.on(_O$1.P2PLost,()=>{this.safeEmit(zy$1.P2P_LOST,this.store.uid)}),this._p2pChannel.on(_O$1.UpdateVideoEncoder,e$=>{e$._encoderConfig&&this._gateway.setVideoProfile(e$._encoderConfig)}),this._p2pChannel.on(_O$1.ConnectionTypeChange,e$=>{this.safeEmit(zy$1.IS_USING_CLOUD_PROXY,e$)}),this._p2pChannel.on(_O$1.RequestLowStreamParameter,e$=>{e$(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(_O$1.QueryClientConnectionState,e$=>{e$(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e$){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new yb$1(Ry$1.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new yb$1(Ry$1.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const r$=(t$={config:e$},gB$1("ContentInspect").create(t$));this._inspect=r$,this.handleVideoInspectEvents(r$);const{appId:n$,cname:i$,sid:o$,token:s$,uid:a$,cid:c$,vid:u$}=this._joinInfo;await r$.init({appId:n$,areaCode:"",cname:i$,sid:o$,token:s$,uid:a$,cid:c$,vid:u$?Number(u$):0},PA$1)}catch(r$){throw Array.isArray(r$)?r$[0]:r$}var t$}handleVideoInspectEvents(e$){e$.on(mO$1.CONNECTION_STATE_CHANGE,(t$,r$)=>{if(this.safeEmit(zy$1.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t$,r$),r$===EO$1.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(zy$1.CONTENT_INSPECT_ERROR,new yb$1(Ry$1.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e$.inspectImage()}}),e$.on(mO$1.INSPECT_RESULT,(t$,r$)=>{var n$;if((r$==null?void 0:r$.code)===Ry$1.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return fb$1.debug("Stop inspect content because that has left channel"),this==null||(n$=this._inspect)===null||n$===void 0||n$.close(),void(this._inspect=void 0);this.safeEmit(zy$1.CONTENT_INSPECT_RESULT,t$,r$)}),e$.on(mO$1.CLIENT_LOCAL_VIDEO_TRACK,t$=>{t$(this.localTracks.filter(r$=>r$.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new yb$1(Ry$1.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e$){throw Array.isArray(e$)?e$[0]:e$}}async setImageModeration(e$,t$){if(Iy$1(e$,"enabled"),e$){if(!t$)throw new yb$1(Ry$1.INVALID_PARAMS,"config is required");if(Lj$1(t$),!this._joinInfo)throw new yb$1(Ry$1.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t$);else{const n$=(r$={config:t$},gB$1("ImageModeration").create(r$));this._moderation=n$,this.handleImageModerationEvents(n$);const{appId:i$,cname:o$,sid:s$,token:a$,uid:c$,cid:u$,vid:l$}=this._joinInfo;await n$.init({appId:i$,areaCode:"",cname:o$,sid:s$,token:a$,uid:c$,cid:u$,vid:l$?Number(l$):0},PA$1)}}catch(n$){throw Array.isArray(n$)?n$[0]:n$}}else{var r$;if(!this._moderation)throw new yb$1(Ry$1.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(n$){throw Array.isArray(n$)?n$[0]:n$}}}handleImageModerationEvents(e$){e$.on(RO$1.CONNECTION_STATE_CHANGE,(t$,r$)=>{if(this.safeEmit(zy$1.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t$,r$),t$===gO$1.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new yb$1(Ry$1.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e$.inspectImage()}}),e$.on(RO$1.CLIENT_LOCAL_VIDEO_TRACK,t$=>{t$(this.localTracks.filter(r$=>r$.trackMediaType==="video")[0])})}setP2PTransport(e$){if(function(t$){vy$1(t$,"transport",["default","auto","relay","sd-rtn"])}(e$),this.mode!=="p2p")throw new yb$1(Ry$1.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e$,fb$1.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e$))}getJoinChannelServiceRecords(){return fb$1.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e$){Iy$1(e$,"enabled"),JA$1("ENABLE_PUBLISH_AUDIO_FILTER",e$),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e$)}_handleResetAddStream(e$,t$){switch(t$){case"audio":e$._audio_added_=!1,e$._trust_audio_stream_added_state_=!0;break;case"video":e$._video_added_=!1,e$._trust_video_stream_added_state_=!0}}},Cw$1(RG$1.prototype,"leave",[Mj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"leave"),RG$1.prototype),Cw$1(RG$1.prototype,"publish",[Uj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"publish"),RG$1.prototype),Cw$1(RG$1.prototype,"unpublish",[xj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"unpublish"),RG$1.prototype),Cw$1(RG$1.prototype,"subscribe",[Vj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"subscribe"),RG$1.prototype),Cw$1(RG$1.prototype,"presubscribe",[Fj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"presubscribe"),RG$1.prototype),Cw$1(RG$1.prototype,"massSubscribe",[Bj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"massSubscribe"),RG$1.prototype),Cw$1(RG$1.prototype,"unsubscribe",[jj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"unsubscribe"),RG$1.prototype),Cw$1(RG$1.prototype,"massUnsubscribe",[Gj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"massUnsubscribe"),RG$1.prototype),Cw$1(RG$1.prototype,"setLowStreamParameter",[Wj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"setLowStreamParameter"),RG$1.prototype),Cw$1(RG$1.prototype,"enableDualStream",[Hj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"enableDualStream"),RG$1.prototype),Cw$1(RG$1.prototype,"disableDualStream",[Kj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"disableDualStream"),RG$1.prototype),Cw$1(RG$1.prototype,"setClientRole",[Yj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"setClientRole"),RG$1.prototype),Cw$1(RG$1.prototype,"setProxyServer",[qj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"setProxyServer"),RG$1.prototype),Cw$1(RG$1.prototype,"setTurnServer",[zj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"setTurnServer"),RG$1.prototype),Cw$1(RG$1.prototype,"setLicense",[Jj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"setLicense"),RG$1.prototype),Cw$1(RG$1.prototype,"startProxyServer",[Xj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"startProxyServer"),RG$1.prototype),Cw$1(RG$1.prototype,"stopProxyServer",[Qj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"stopProxyServer"),RG$1.prototype),Cw$1(RG$1.prototype,"setLocalAccessPointsV2",[Zj$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"setLocalAccessPointsV2"),RG$1.prototype),Cw$1(RG$1.prototype,"setLocalAccessPoints",[$j$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"setLocalAccessPoints"),RG$1.prototype),Cw$1(RG$1.prototype,"setRemoteDefaultVideoStreamType",[eG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"setRemoteDefaultVideoStreamType"),RG$1.prototype),Cw$1(RG$1.prototype,"setRemoteVideoStreamType",[tG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"setRemoteVideoStreamType"),RG$1.prototype),Cw$1(RG$1.prototype,"setStreamFallbackOption",[iG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"setStreamFallbackOption"),RG$1.prototype),Cw$1(RG$1.prototype,"setEncryptionConfig",[nG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"setEncryptionConfig"),RG$1.prototype),Cw$1(RG$1.prototype,"renewToken",[rG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"renewToken"),RG$1.prototype),Cw$1(RG$1.prototype,"enableAudioVolumeIndicator",[oG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"enableAudioVolumeIndicator"),RG$1.prototype),Cw$1(RG$1.prototype,"startLiveStreaming",[sG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"startLiveStreaming"),RG$1.prototype),Cw$1(RG$1.prototype,"setLiveTranscoding",[aG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"setLiveTranscoding"),RG$1.prototype),Cw$1(RG$1.prototype,"stopLiveStreaming",[cG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"stopLiveStreaming"),RG$1.prototype),Cw$1(RG$1.prototype,"startChannelMediaRelay",[dG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"startChannelMediaRelay"),RG$1.prototype),Cw$1(RG$1.prototype,"updateChannelMediaRelay",[lG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"updateChannelMediaRelay"),RG$1.prototype),Cw$1(RG$1.prototype,"stopChannelMediaRelay",[uG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"stopChannelMediaRelay"),RG$1.prototype),Cw$1(RG$1.prototype,"sendCustomReportMessage",[hG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"sendCustomReportMessage"),RG$1.prototype),Cw$1(RG$1.prototype,"pickSVCLayer",[pG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"pickSVCLayer"),RG$1.prototype),Cw$1(RG$1.prototype,"setRTMConfig",[_G$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"setRTMConfig"),RG$1.prototype),Cw$1(RG$1.prototype,"enableContentInspect",[EG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"enableContentInspect"),RG$1.prototype),Cw$1(RG$1.prototype,"disableContentInspect",[fG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"disableContentInspect"),RG$1.prototype),Cw$1(RG$1.prototype,"setImageModeration",[mG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"setImageModeration"),RG$1.prototype),Cw$1(RG$1.prototype,"setP2PTransport",[TG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"setP2PTransport"),RG$1.prototype),Cw$1(RG$1.prototype,"getJoinChannelServiceRecords",[SG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"getJoinChannelServiceRecords"),RG$1.prototype),Cw$1(RG$1.prototype,"setPublishAudioFilterEnabled",[gG$1],Object.getOwnPropertyDescriptor(RG$1.prototype,"setPublishAudioFilterEnabled"),RG$1.prototype),RG$1),yG$1=class E5{constructor(t$,r$){Fg$1(this,"id",0),Fg$1(this,"element",void 0),Fg$1(this,"peerPair",void 0),Fg$1(this,"context",void 0),Fg$1(this,"audioPlayerElement",void 0),Fg$1(this,"audioTrack",void 0),E5.count+=1,this.id=E5.count,this.element=t$,this.context=r$}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t$=>{const r$=document.createElement("audio");r$.srcObject=new MediaStream([t$.track]),r$.play(),this.audioPlayerElement=r$}}async switchSdp(){if(!this.peerPair)return;const t$=async(n$,i$)=>{const o$=i$==="offer"?await n$.createOffer():await n$.createAnswer();return await n$.setLocalDescription(o$),n$.iceGatheringState==="complete"?n$.localDescription:new Gh$1(s$=>{n$.onicegatheringstatechange=()=>{n$.iceGatheringState==="complete"&&s$(n$.localDescription)}})},r$=async(n$,i$)=>await n$.setRemoteDescription(i$);try{const n$=await t$(this.peerPair[0],"offer");await r$(this.peerPair[1],n$);const i$=await t$(this.peerPair[1],"answer");await r$(this.peerPair[0],i$)}catch(n$){throw new yb$1(Ry$1.LOCAL_AEC_ERROR,n$.toString()).print()}}async getTracksFromMediaElement(t$){if(this.audioTrack)return this.audioTrack;let r$;try{t$ instanceof HTMLVideoElement&&(t$.captureStream?t$.captureStream():t$.mozCaptureStream()),r$=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t$).connect(r$)}catch(i$){throw new yb$1(Ry$1.LOCAL_AEC_ERROR,i$.toString()).print()}if(!r$)throw new yb$1(Ry$1.LOCAL_AEC_ERROR,"no dest node when local aec").print();const n$=r$.stream.getAudioTracks()[0];return this.audioTrack=n$,n$}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t$=this.element,r$=await this.getTracksFromMediaElement(t$);this.peerPair&&this.peerPair[0].addTrack(r$),await this.switchSdp()}close(){fb$1.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t$=>{t$.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}};var AG$1,bG$1;Fg$1(yG$1,"count",0);const wG$1=window.AudioContext||window.webkitAudioContext,OG$1=new(AG$1=Ib$1({report:vb$1}),Cw$1((bG$1=class{constructor(){Fg$1(this,"units",[]),Fg$1(this,"context",void 0)}processExternalMediaAEC(e$){if(!this._doesEnvironmentNeedAEC())return fb$1.debug("the system does not need to process local aec"),-1;this.context||(this.context=new wG$1);let t$=this.units.find(r$=>r$&&r$.getElement()===e$);return t$||(t$=new yG$1(e$,this.context),this.units.push(t$)),t$.startEchoCancellation(),fb$1.debug("start processing local audio echo cancellation, id is",t$.id),t$.id}_doesEnvironmentNeedAEC(){return Hv$1().name!==Bv$1.SAFARI}}).prototype,"processExternalMediaAEC",[AG$1],Object.getOwnPropertyDescriptor(bG$1.prototype,"processExternalMediaAEC"),bG$1.prototype),bG$1);function NG$1(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function DG$1(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?NG$1(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):NG$1(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}const PG$1=window||document;function LG$1(e$){let t$=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!PG$1)return;const r$=nq._cspEventHandlerPointer;if(r$&&t$)return void console.error(r$,t$);const n$=i$=>{if(!(i$&&i$.blockedURI&&(nq.onSecurityPolicyViolation||nq.getListeners(SO$1.SECURITY_POLICY_VIOLATION).length>0)))return;const o$=i$.blockedURI;XA$1("CSP_DETECTED_HOSTNAME_LIST").some(s$=>Dn$1(o$).call(o$,s$))&&(nq.onSecurityPolicyViolation&&typeof nq.onSecurityPolicyViolation=="function"&&nq.onSecurityPolicyViolation(i$),nq.getListeners(SO$1.SECURITY_POLICY_VIOLATION).length>0&&nq.safeEmit(SO$1.SECURITY_POLICY_VIOLATION,i$))};r$&&PG$1.removeEventListener("securitypolicyviolation",r$),(t$||e$&&typeof e$=="function"||nq.getListeners(SO$1.SECURITY_POLICY_VIOLATION).length>0)&&PG$1.addEventListener("securitypolicyviolation",n$),nq._cspEventHandlerPointer=n$}var kG$1=l,MG$1=RC$1,UG$1=RegExp.prototype,xG$1=function(e$){return e$===UG$1||kG$1(UG$1,e$)?MG$1(e$):e$.flags},VG$1=i(xG$1);function FG$1(e$){let t$=e$.length;for(;--t$>=0;)e$[t$]=0}const BG$1=256,jG$1=286,GG$1=30,WG$1=15,HG$1=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),KG$1=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),YG$1=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),qG$1=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zG$1=new Array(576);FG$1(zG$1);const JG$1=new Array(60);FG$1(JG$1);const XG$1=new Array(512);FG$1(XG$1);const QG$1=new Array(256);FG$1(QG$1);const ZG$1=new Array(29);FG$1(ZG$1);const $G$1=new Array(GG$1);function eW$1(e$,t$,r$,n$,i$){this.static_tree=e$,this.extra_bits=t$,this.extra_base=r$,this.elems=n$,this.max_length=i$,this.has_stree=e$&&e$.length}let tW$1,iW$1,nW$1;function rW$1(e$,t$){this.dyn_tree=e$,this.max_code=0,this.stat_desc=t$}FG$1($G$1);const oW$1=e$=>e$<256?XG$1[e$]:XG$1[256+(e$>>>7)],sW$1=(e$,t$)=>{e$.pending_buf[e$.pending++]=255&t$,e$.pending_buf[e$.pending++]=t$>>>8&255},aW$1=(e$,t$,r$)=>{e$.bi_valid>16-r$?(e$.bi_buf|=t$<<e$.bi_valid&65535,sW$1(e$,e$.bi_buf),e$.bi_buf=t$>>16-e$.bi_valid,e$.bi_valid+=r$-16):(e$.bi_buf|=t$<<e$.bi_valid&65535,e$.bi_valid+=r$)},cW$1=(e$,t$,r$)=>{aW$1(e$,r$[2*t$],r$[2*t$+1])},dW$1=(e$,t$)=>{let r$=0;do r$|=1&e$,e$>>>=1,r$<<=1;while(--t$>0);return r$>>>1},lW$1=(e$,t$,r$)=>{const n$=new Array(16);let i$,o$,s$=0;for(i$=1;i$<=WG$1;i$++)s$=s$+r$[i$-1]<<1,n$[i$]=s$;for(o$=0;o$<=t$;o$++){let a$=e$[2*o$+1];a$!==0&&(e$[2*o$]=dW$1(n$[a$]++,a$))}},uW$1=e$=>{let t$;for(t$=0;t$<jG$1;t$++)e$.dyn_ltree[2*t$]=0;for(t$=0;t$<GG$1;t$++)e$.dyn_dtree[2*t$]=0;for(t$=0;t$<19;t$++)e$.bl_tree[2*t$]=0;e$.dyn_ltree[512]=1,e$.opt_len=e$.static_len=0,e$.sym_next=e$.matches=0},hW$1=e$=>{e$.bi_valid>8?sW$1(e$,e$.bi_buf):e$.bi_valid>0&&(e$.pending_buf[e$.pending++]=e$.bi_buf),e$.bi_buf=0,e$.bi_valid=0},pW$1=(e$,t$,r$,n$)=>{const i$=2*t$,o$=2*r$;return e$[i$]<e$[o$]||e$[i$]===e$[o$]&&n$[t$]<=n$[r$]},_W$1=(e$,t$,r$)=>{const n$=e$.heap[r$];let i$=r$<<1;for(;i$<=e$.heap_len&&(i$<e$.heap_len&&pW$1(t$,e$.heap[i$+1],e$.heap[i$],e$.depth)&&i$++,!pW$1(t$,n$,e$.heap[i$],e$.depth));)e$.heap[r$]=e$.heap[i$],r$=i$,i$<<=1;e$.heap[r$]=n$},EW$1=(e$,t$,r$)=>{let n$,i$,o$,s$,a$=0;if(e$.sym_next!==0)do n$=255&e$.pending_buf[e$.sym_buf+a$++],n$+=(255&e$.pending_buf[e$.sym_buf+a$++])<<8,i$=e$.pending_buf[e$.sym_buf+a$++],n$===0?cW$1(e$,i$,t$):(o$=QG$1[i$],cW$1(e$,o$+BG$1+1,t$),s$=HG$1[o$],s$!==0&&(i$-=ZG$1[o$],aW$1(e$,i$,s$)),n$--,o$=oW$1(n$),cW$1(e$,o$,r$),s$=KG$1[o$],s$!==0&&(n$-=$G$1[o$],aW$1(e$,n$,s$)));while(a$<e$.sym_next);cW$1(e$,256,t$)},fW$1=(e$,t$)=>{const r$=t$.dyn_tree,n$=t$.stat_desc.static_tree,i$=t$.stat_desc.has_stree,o$=t$.stat_desc.elems;let s$,a$,c$,u$=-1;for(e$.heap_len=0,e$.heap_max=573,s$=0;s$<o$;s$++)r$[2*s$]!==0?(e$.heap[++e$.heap_len]=u$=s$,e$.depth[s$]=0):r$[2*s$+1]=0;for(;e$.heap_len<2;)c$=e$.heap[++e$.heap_len]=u$<2?++u$:0,r$[2*c$]=1,e$.depth[c$]=0,e$.opt_len--,i$&&(e$.static_len-=n$[2*c$+1]);for(t$.max_code=u$,s$=e$.heap_len>>1;s$>=1;s$--)_W$1(e$,r$,s$);c$=o$;do s$=e$.heap[1],e$.heap[1]=e$.heap[e$.heap_len--],_W$1(e$,r$,1),a$=e$.heap[1],e$.heap[--e$.heap_max]=s$,e$.heap[--e$.heap_max]=a$,r$[2*c$]=r$[2*s$]+r$[2*a$],e$.depth[c$]=(e$.depth[s$]>=e$.depth[a$]?e$.depth[s$]:e$.depth[a$])+1,r$[2*s$+1]=r$[2*a$+1]=c$,e$.heap[1]=c$++,_W$1(e$,r$,1);while(e$.heap_len>=2);e$.heap[--e$.heap_max]=e$.heap[1],((l$,d$)=>{const h$=d$.dyn_tree,p$=d$.max_code,_$=d$.stat_desc.static_tree,f$=d$.stat_desc.has_stree,m$=d$.stat_desc.extra_bits,g$=d$.stat_desc.extra_base,v$=d$.stat_desc.max_length;let y$,S$,b$,$$,C$,N$,k$=0;for($$=0;$$<=WG$1;$$++)l$.bl_count[$$]=0;for(h$[2*l$.heap[l$.heap_max]+1]=0,y$=l$.heap_max+1;y$<573;y$++)S$=l$.heap[y$],$$=h$[2*h$[2*S$+1]+1]+1,$$>v$&&($$=v$,k$++),h$[2*S$+1]=$$,S$>p$||(l$.bl_count[$$]++,C$=0,S$>=g$&&(C$=m$[S$-g$]),N$=h$[2*S$],l$.opt_len+=N$*($$+C$),f$&&(l$.static_len+=N$*(_$[2*S$+1]+C$)));if(k$!==0){do{for($$=v$-1;l$.bl_count[$$]===0;)$$--;l$.bl_count[$$]--,l$.bl_count[$$+1]+=2,l$.bl_count[v$]--,k$-=2}while(k$>0);for($$=v$;$$!==0;$$--)for(S$=l$.bl_count[$$];S$!==0;)b$=l$.heap[--y$],b$>p$||(h$[2*b$+1]!==$$&&(l$.opt_len+=($$-h$[2*b$+1])*h$[2*b$],h$[2*b$+1]=$$),S$--)}})(e$,t$),lW$1(r$,u$,e$.bl_count)},mW$1=(e$,t$,r$)=>{let n$,i$,o$=-1,s$=t$[1],a$=0,c$=7,u$=4;for(s$===0&&(c$=138,u$=3),t$[2*(r$+1)+1]=65535,n$=0;n$<=r$;n$++)i$=s$,s$=t$[2*(n$+1)+1],++a$<c$&&i$===s$||(a$<u$?e$.bl_tree[2*i$]+=a$:i$!==0?(i$!==o$&&e$.bl_tree[2*i$]++,e$.bl_tree[32]++):a$<=10?e$.bl_tree[34]++:e$.bl_tree[36]++,a$=0,o$=i$,s$===0?(c$=138,u$=3):i$===s$?(c$=6,u$=3):(c$=7,u$=4))},TW$1=(e$,t$,r$)=>{let n$,i$,o$=-1,s$=t$[1],a$=0,c$=7,u$=4;for(s$===0&&(c$=138,u$=3),n$=0;n$<=r$;n$++)if(i$=s$,s$=t$[2*(n$+1)+1],!(++a$<c$&&i$===s$)){if(a$<u$)do cW$1(e$,i$,e$.bl_tree);while(--a$!=0);else i$!==0?(i$!==o$&&(cW$1(e$,i$,e$.bl_tree),a$--),cW$1(e$,16,e$.bl_tree),aW$1(e$,a$-3,2)):a$<=10?(cW$1(e$,17,e$.bl_tree),aW$1(e$,a$-3,3)):(cW$1(e$,18,e$.bl_tree),aW$1(e$,a$-11,7));a$=0,o$=i$,s$===0?(c$=138,u$=3):i$===s$?(c$=6,u$=3):(c$=7,u$=4)}};let SW$1=!1;const gW$1=(e$,t$,r$,n$)=>{aW$1(e$,0+(n$?1:0),3),hW$1(e$),sW$1(e$,r$),sW$1(e$,~r$),r$&&e$.pending_buf.set(e$.window.subarray(t$,t$+r$),e$.pending),e$.pending+=r$};var RW$1=e$=>{SW$1||((()=>{let t$,r$,n$,i$,o$;const s$=new Array(16);for(n$=0,i$=0;i$<28;i$++)for(ZG$1[i$]=n$,t$=0;t$<1<<HG$1[i$];t$++)QG$1[n$++]=i$;for(QG$1[n$-1]=i$,o$=0,i$=0;i$<16;i$++)for($G$1[i$]=o$,t$=0;t$<1<<KG$1[i$];t$++)XG$1[o$++]=i$;for(o$>>=7;i$<GG$1;i$++)for($G$1[i$]=o$<<7,t$=0;t$<1<<KG$1[i$]-7;t$++)XG$1[256+o$++]=i$;for(r$=0;r$<=WG$1;r$++)s$[r$]=0;for(t$=0;t$<=143;)zG$1[2*t$+1]=8,t$++,s$[8]++;for(;t$<=255;)zG$1[2*t$+1]=9,t$++,s$[9]++;for(;t$<=279;)zG$1[2*t$+1]=7,t$++,s$[7]++;for(;t$<=287;)zG$1[2*t$+1]=8,t$++,s$[8]++;for(lW$1(zG$1,287,s$),t$=0;t$<GG$1;t$++)JG$1[2*t$+1]=5,JG$1[2*t$]=dW$1(t$,5);tW$1=new eW$1(zG$1,HG$1,257,jG$1,WG$1),iW$1=new eW$1(JG$1,KG$1,0,GG$1,WG$1),nW$1=new eW$1(new Array(0),YG$1,0,19,7)})(),SW$1=!0),e$.l_desc=new rW$1(e$.dyn_ltree,tW$1),e$.d_desc=new rW$1(e$.dyn_dtree,iW$1),e$.bl_desc=new rW$1(e$.bl_tree,nW$1),e$.bi_buf=0,e$.bi_valid=0,uW$1(e$)},CW$1=(e$,t$,r$,n$)=>{let i$,o$,s$=0;e$.level>0?(e$.strm.data_type===2&&(e$.strm.data_type=(a$=>{let c$,u$=4093624447;for(c$=0;c$<=31;c$++,u$>>>=1)if(1&u$&&a$.dyn_ltree[2*c$]!==0)return 0;if(a$.dyn_ltree[18]!==0||a$.dyn_ltree[20]!==0||a$.dyn_ltree[26]!==0)return 1;for(c$=32;c$<BG$1;c$++)if(a$.dyn_ltree[2*c$]!==0)return 1;return 0})(e$)),fW$1(e$,e$.l_desc),fW$1(e$,e$.d_desc),s$=(a$=>{let c$;for(mW$1(a$,a$.dyn_ltree,a$.l_desc.max_code),mW$1(a$,a$.dyn_dtree,a$.d_desc.max_code),fW$1(a$,a$.bl_desc),c$=18;c$>=3&&a$.bl_tree[2*qG$1[c$]+1]===0;c$--);return a$.opt_len+=3*(c$+1)+5+5+4,c$})(e$),i$=e$.opt_len+3+7>>>3,o$=e$.static_len+3+7>>>3,o$<=i$&&(i$=o$)):i$=o$=r$+5,r$+4<=i$&&t$!==-1?gW$1(e$,t$,r$,n$):e$.strategy===4||o$===i$?(aW$1(e$,2+(n$?1:0),3),EW$1(e$,zG$1,JG$1)):(aW$1(e$,4+(n$?1:0),3),((a$,c$,u$,l$)=>{let d$;for(aW$1(a$,c$-257,5),aW$1(a$,u$-1,5),aW$1(a$,l$-4,4),d$=0;d$<l$;d$++)aW$1(a$,a$.bl_tree[2*qG$1[d$]+1],3);TW$1(a$,a$.dyn_ltree,c$-1),TW$1(a$,a$.dyn_dtree,u$-1)})(e$,e$.l_desc.max_code+1,e$.d_desc.max_code+1,s$+1),EW$1(e$,e$.dyn_ltree,e$.dyn_dtree)),uW$1(e$),n$&&hW$1(e$)},IW$1=(e$,t$,r$)=>(e$.pending_buf[e$.sym_buf+e$.sym_next++]=t$,e$.pending_buf[e$.sym_buf+e$.sym_next++]=t$>>8,e$.pending_buf[e$.sym_buf+e$.sym_next++]=r$,t$===0?e$.dyn_ltree[2*r$]++:(e$.matches++,t$--,e$.dyn_ltree[2*(QG$1[r$]+BG$1+1)]++,e$.dyn_dtree[2*oW$1(t$)]++),e$.sym_next===e$.sym_end),vW$1=e$=>{aW$1(e$,2,3),cW$1(e$,256,zG$1),(t$=>{t$.bi_valid===16?(sW$1(t$,t$.bi_buf),t$.bi_buf=0,t$.bi_valid=0):t$.bi_valid>=8&&(t$.pending_buf[t$.pending++]=255&t$.bi_buf,t$.bi_buf>>=8,t$.bi_valid-=8)})(e$)},yW$1={_tr_init:RW$1,_tr_stored_block:gW$1,_tr_flush_block:CW$1,_tr_tally:IW$1,_tr_align:vW$1},AW$1=(e$,t$,r$,n$)=>{let i$=65535&e$|0,o$=e$>>>16&65535|0,s$=0;for(;r$!==0;){s$=r$>2e3?2e3:r$,r$-=s$;do i$=i$+t$[n$++]|0,o$=o$+i$|0;while(--s$);i$%=65521,o$%=65521}return i$|o$<<16|0};const bW$1=new Uint32Array((()=>{let e$,t$=[];for(var r$=0;r$<256;r$++){e$=r$;for(var n$=0;n$<8;n$++)e$=1&e$?3988292384^e$>>>1:e$>>>1;t$[r$]=e$}return t$})());var wW$1=(e$,t$,r$,n$)=>{const i$=bW$1,o$=n$+r$;e$^=-1;for(let s$=n$;s$<o$;s$++)e$=e$>>>8^i$[255&(e$^t$[s$])];return-1^e$},OW$1={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},NW={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:DW$1,_tr_stored_block:PW$1,_tr_flush_block:LW$1,_tr_tally:kW$1,_tr_align:MW$1}=yW$1,{Z_NO_FLUSH:UW$1,Z_PARTIAL_FLUSH:xW$1,Z_FULL_FLUSH:VW$1,Z_FINISH:FW$1,Z_BLOCK:BW$1,Z_OK:jW$1,Z_STREAM_END:GW$1,Z_STREAM_ERROR:WW$1,Z_DATA_ERROR:HW$1,Z_BUF_ERROR:KW$1,Z_DEFAULT_COMPRESSION:YW$1,Z_FILTERED:qW$1,Z_HUFFMAN_ONLY:zW$1,Z_RLE:JW$1,Z_FIXED:XW$1,Z_DEFAULT_STRATEGY:QW$1,Z_UNKNOWN:ZW$1,Z_DEFLATED:$W$1}=NW,eH$1=286,tH$1=30,iH=19,nH$1=2*eH$1+1,rH=15,oH=258,sH=262,aH=42,cH=113,dH=666,lH=(e$,t$)=>(e$.msg=OW$1[t$],t$),uH=e$=>2*e$-(e$>4?9:0),hH=e$=>{let t$=e$.length;for(;--t$>=0;)e$[t$]=0},pH=e$=>{let t$,r$,n$,i$=e$.w_size;t$=e$.hash_size,n$=t$;do r$=e$.head[--n$],e$.head[n$]=r$>=i$?r$-i$:0;while(--t$);t$=i$,n$=t$;do r$=e$.prev[--n$],e$.prev[n$]=r$>=i$?r$-i$:0;while(--t$)};let _H=(e$,t$,r$)=>(t$<<e$.hash_shift^r$)&e$.hash_mask;const EH=e$=>{const t$=e$.state;let r$=t$.pending;r$>e$.avail_out&&(r$=e$.avail_out),r$!==0&&(e$.output.set(t$.pending_buf.subarray(t$.pending_out,t$.pending_out+r$),e$.next_out),e$.next_out+=r$,t$.pending_out+=r$,e$.total_out+=r$,e$.avail_out-=r$,t$.pending-=r$,t$.pending===0&&(t$.pending_out=0))},fH=(e$,t$)=>{LW$1(e$,e$.block_start>=0?e$.block_start:-1,e$.strstart-e$.block_start,t$),e$.block_start=e$.strstart,EH(e$.strm)},mH=(e$,t$)=>{e$.pending_buf[e$.pending++]=t$},TH=(e$,t$)=>{e$.pending_buf[e$.pending++]=t$>>>8&255,e$.pending_buf[e$.pending++]=255&t$},SH=(e$,t$,r$,n$)=>{let i$=e$.avail_in;return i$>n$&&(i$=n$),i$===0?0:(e$.avail_in-=i$,t$.set(e$.input.subarray(e$.next_in,e$.next_in+i$),r$),e$.state.wrap===1?e$.adler=AW$1(e$.adler,t$,i$,r$):e$.state.wrap===2&&(e$.adler=wW$1(e$.adler,t$,i$,r$)),e$.next_in+=i$,e$.total_in+=i$,i$)},gH=(e$,t$)=>{let r$,n$,i$=e$.max_chain_length,o$=e$.strstart,s$=e$.prev_length,a$=e$.nice_match;const c$=e$.strstart>e$.w_size-sH?e$.strstart-(e$.w_size-sH):0,u$=e$.window,l$=e$.w_mask,d$=e$.prev,h$=e$.strstart+oH;let p$=u$[o$+s$-1],_$=u$[o$+s$];e$.prev_length>=e$.good_match&&(i$>>=2),a$>e$.lookahead&&(a$=e$.lookahead);do if(r$=t$,u$[r$+s$]===_$&&u$[r$+s$-1]===p$&&u$[r$]===u$[o$]&&u$[++r$]===u$[o$+1]){o$+=2,r$++;do;while(u$[++o$]===u$[++r$]&&u$[++o$]===u$[++r$]&&u$[++o$]===u$[++r$]&&u$[++o$]===u$[++r$]&&u$[++o$]===u$[++r$]&&u$[++o$]===u$[++r$]&&u$[++o$]===u$[++r$]&&u$[++o$]===u$[++r$]&&o$<h$);if(n$=oH-(h$-o$),o$=h$-oH,n$>s$){if(e$.match_start=t$,s$=n$,n$>=a$)break;p$=u$[o$+s$-1],_$=u$[o$+s$]}}while((t$=d$[t$&l$])>c$&&--i$!=0);return s$<=e$.lookahead?s$:e$.lookahead},RH=e$=>{const t$=e$.w_size;let r$,n$,i$;do{if(n$=e$.window_size-e$.lookahead-e$.strstart,e$.strstart>=t$+(t$-sH)&&(e$.window.set(e$.window.subarray(t$,t$+t$-n$),0),e$.match_start-=t$,e$.strstart-=t$,e$.block_start-=t$,e$.insert>e$.strstart&&(e$.insert=e$.strstart),pH(e$),n$+=t$),e$.strm.avail_in===0)break;if(r$=SH(e$.strm,e$.window,e$.strstart+e$.lookahead,n$),e$.lookahead+=r$,e$.lookahead+e$.insert>=3)for(i$=e$.strstart-e$.insert,e$.ins_h=e$.window[i$],e$.ins_h=_H(e$,e$.ins_h,e$.window[i$+1]);e$.insert&&(e$.ins_h=_H(e$,e$.ins_h,e$.window[i$+3-1]),e$.prev[i$&e$.w_mask]=e$.head[e$.ins_h],e$.head[e$.ins_h]=i$,i$++,e$.insert--,!(e$.lookahead+e$.insert<3)););}while(e$.lookahead<sH&&e$.strm.avail_in!==0)},CH=(e$,t$)=>{let r$,n$,i$,o$=e$.pending_buf_size-5>e$.w_size?e$.w_size:e$.pending_buf_size-5,s$=0,a$=e$.strm.avail_in;do{if(r$=65535,i$=e$.bi_valid+42>>3,e$.strm.avail_out<i$||(i$=e$.strm.avail_out-i$,n$=e$.strstart-e$.block_start,r$>n$+e$.strm.avail_in&&(r$=n$+e$.strm.avail_in),r$>i$&&(r$=i$),r$<o$&&(r$===0&&t$!==FW$1||t$===UW$1||r$!==n$+e$.strm.avail_in)))break;s$=t$===FW$1&&r$===n$+e$.strm.avail_in?1:0,PW$1(e$,0,0,s$),e$.pending_buf[e$.pending-4]=r$,e$.pending_buf[e$.pending-3]=r$>>8,e$.pending_buf[e$.pending-2]=~r$,e$.pending_buf[e$.pending-1]=~r$>>8,EH(e$.strm),n$&&(n$>r$&&(n$=r$),e$.strm.output.set(e$.window.subarray(e$.block_start,e$.block_start+n$),e$.strm.next_out),e$.strm.next_out+=n$,e$.strm.avail_out-=n$,e$.strm.total_out+=n$,e$.block_start+=n$,r$-=n$),r$&&(SH(e$.strm,e$.strm.output,e$.strm.next_out,r$),e$.strm.next_out+=r$,e$.strm.avail_out-=r$,e$.strm.total_out+=r$)}while(s$===0);return a$-=e$.strm.avail_in,a$&&(a$>=e$.w_size?(e$.matches=2,e$.window.set(e$.strm.input.subarray(e$.strm.next_in-e$.w_size,e$.strm.next_in),0),e$.strstart=e$.w_size,e$.insert=e$.strstart):(e$.window_size-e$.strstart<=a$&&(e$.strstart-=e$.w_size,e$.window.set(e$.window.subarray(e$.w_size,e$.w_size+e$.strstart),0),e$.matches<2&&e$.matches++,e$.insert>e$.strstart&&(e$.insert=e$.strstart)),e$.window.set(e$.strm.input.subarray(e$.strm.next_in-a$,e$.strm.next_in),e$.strstart),e$.strstart+=a$,e$.insert+=a$>e$.w_size-e$.insert?e$.w_size-e$.insert:a$),e$.block_start=e$.strstart),e$.high_water<e$.strstart&&(e$.high_water=e$.strstart),s$?4:t$!==UW$1&&t$!==FW$1&&e$.strm.avail_in===0&&e$.strstart===e$.block_start?2:(i$=e$.window_size-e$.strstart,e$.strm.avail_in>i$&&e$.block_start>=e$.w_size&&(e$.block_start-=e$.w_size,e$.strstart-=e$.w_size,e$.window.set(e$.window.subarray(e$.w_size,e$.w_size+e$.strstart),0),e$.matches<2&&e$.matches++,i$+=e$.w_size,e$.insert>e$.strstart&&(e$.insert=e$.strstart)),i$>e$.strm.avail_in&&(i$=e$.strm.avail_in),i$&&(SH(e$.strm,e$.window,e$.strstart,i$),e$.strstart+=i$,e$.insert+=i$>e$.w_size-e$.insert?e$.w_size-e$.insert:i$),e$.high_water<e$.strstart&&(e$.high_water=e$.strstart),i$=e$.bi_valid+42>>3,i$=e$.pending_buf_size-i$>65535?65535:e$.pending_buf_size-i$,o$=i$>e$.w_size?e$.w_size:i$,n$=e$.strstart-e$.block_start,(n$>=o$||(n$||t$===FW$1)&&t$!==UW$1&&e$.strm.avail_in===0&&n$<=i$)&&(r$=n$>i$?i$:n$,s$=t$===FW$1&&e$.strm.avail_in===0&&r$===n$?1:0,PW$1(e$,e$.block_start,r$,s$),e$.block_start+=r$,EH(e$.strm)),s$?3:1)},IH=(e$,t$)=>{let r$,n$;for(;;){if(e$.lookahead<sH){if(RH(e$),e$.lookahead<sH&&t$===UW$1)return 1;if(e$.lookahead===0)break}if(r$=0,e$.lookahead>=3&&(e$.ins_h=_H(e$,e$.ins_h,e$.window[e$.strstart+3-1]),r$=e$.prev[e$.strstart&e$.w_mask]=e$.head[e$.ins_h],e$.head[e$.ins_h]=e$.strstart),r$!==0&&e$.strstart-r$<=e$.w_size-sH&&(e$.match_length=gH(e$,r$)),e$.match_length>=3)if(n$=kW$1(e$,e$.strstart-e$.match_start,e$.match_length-3),e$.lookahead-=e$.match_length,e$.match_length<=e$.max_lazy_match&&e$.lookahead>=3){e$.match_length--;do e$.strstart++,e$.ins_h=_H(e$,e$.ins_h,e$.window[e$.strstart+3-1]),r$=e$.prev[e$.strstart&e$.w_mask]=e$.head[e$.ins_h],e$.head[e$.ins_h]=e$.strstart;while(--e$.match_length!=0);e$.strstart++}else e$.strstart+=e$.match_length,e$.match_length=0,e$.ins_h=e$.window[e$.strstart],e$.ins_h=_H(e$,e$.ins_h,e$.window[e$.strstart+1]);else n$=kW$1(e$,0,e$.window[e$.strstart]),e$.lookahead--,e$.strstart++;if(n$&&(fH(e$,!1),e$.strm.avail_out===0))return 1}return e$.insert=e$.strstart<2?e$.strstart:2,t$===FW$1?(fH(e$,!0),e$.strm.avail_out===0?3:4):e$.sym_next&&(fH(e$,!1),e$.strm.avail_out===0)?1:2},vH=(e$,t$)=>{let r$,n$,i$;for(;;){if(e$.lookahead<sH){if(RH(e$),e$.lookahead<sH&&t$===UW$1)return 1;if(e$.lookahead===0)break}if(r$=0,e$.lookahead>=3&&(e$.ins_h=_H(e$,e$.ins_h,e$.window[e$.strstart+3-1]),r$=e$.prev[e$.strstart&e$.w_mask]=e$.head[e$.ins_h],e$.head[e$.ins_h]=e$.strstart),e$.prev_length=e$.match_length,e$.prev_match=e$.match_start,e$.match_length=2,r$!==0&&e$.prev_length<e$.max_lazy_match&&e$.strstart-r$<=e$.w_size-sH&&(e$.match_length=gH(e$,r$),e$.match_length<=5&&(e$.strategy===qW$1||e$.match_length===3&&e$.strstart-e$.match_start>4096)&&(e$.match_length=2)),e$.prev_length>=3&&e$.match_length<=e$.prev_length){i$=e$.strstart+e$.lookahead-3,n$=kW$1(e$,e$.strstart-1-e$.prev_match,e$.prev_length-3),e$.lookahead-=e$.prev_length-1,e$.prev_length-=2;do++e$.strstart<=i$&&(e$.ins_h=_H(e$,e$.ins_h,e$.window[e$.strstart+3-1]),r$=e$.prev[e$.strstart&e$.w_mask]=e$.head[e$.ins_h],e$.head[e$.ins_h]=e$.strstart);while(--e$.prev_length!=0);if(e$.match_available=0,e$.match_length=2,e$.strstart++,n$&&(fH(e$,!1),e$.strm.avail_out===0))return 1}else if(e$.match_available){if(n$=kW$1(e$,0,e$.window[e$.strstart-1]),n$&&fH(e$,!1),e$.strstart++,e$.lookahead--,e$.strm.avail_out===0)return 1}else e$.match_available=1,e$.strstart++,e$.lookahead--}return e$.match_available&&(n$=kW$1(e$,0,e$.window[e$.strstart-1]),e$.match_available=0),e$.insert=e$.strstart<2?e$.strstart:2,t$===FW$1?(fH(e$,!0),e$.strm.avail_out===0?3:4):e$.sym_next&&(fH(e$,!1),e$.strm.avail_out===0)?1:2};function yH(e$,t$,r$,n$,i$){this.good_length=e$,this.max_lazy=t$,this.nice_length=r$,this.max_chain=n$,this.func=i$}const AH=[new yH(0,0,0,0,CH),new yH(4,4,8,4,IH),new yH(4,5,16,8,IH),new yH(4,6,32,32,IH),new yH(4,4,16,16,vH),new yH(8,16,32,32,vH),new yH(8,16,128,128,vH),new yH(8,32,128,256,vH),new yH(32,128,258,1024,vH),new yH(32,258,258,4096,vH)];function bH(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$W$1,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*nH$1),this.dyn_dtree=new Uint16Array(2*(2*tH$1+1)),this.bl_tree=new Uint16Array(2*(2*iH+1)),hH(this.dyn_ltree),hH(this.dyn_dtree),hH(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(rH+1),this.heap=new Uint16Array(2*eH$1+1),hH(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*eH$1+1),hH(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const wH=e$=>{if(!e$)return 1;const t$=e$.state;return!t$||t$.strm!==e$||t$.status!==aH&&t$.status!==57&&t$.status!==69&&t$.status!==73&&t$.status!==91&&t$.status!==103&&t$.status!==cH&&t$.status!==dH?1:0},OH=e$=>{if(wH(e$))return lH(e$,WW$1);e$.total_in=e$.total_out=0,e$.data_type=ZW$1;const t$=e$.state;return t$.pending=0,t$.pending_out=0,t$.wrap<0&&(t$.wrap=-t$.wrap),t$.status=t$.wrap===2?57:t$.wrap?aH:cH,e$.adler=t$.wrap===2?0:1,t$.last_flush=-2,DW$1(t$),jW$1},NH=e$=>{const t$=OH(e$);return t$===jW$1&&(r$=>{r$.window_size=2*r$.w_size,hH(r$.head),r$.max_lazy_match=AH[r$.level].max_lazy,r$.good_match=AH[r$.level].good_length,r$.nice_match=AH[r$.level].nice_length,r$.max_chain_length=AH[r$.level].max_chain,r$.strstart=0,r$.block_start=0,r$.lookahead=0,r$.insert=0,r$.match_length=r$.prev_length=2,r$.match_available=0,r$.ins_h=0})(e$.state),t$},DH=(e$,t$,r$,n$,i$,o$)=>{if(!e$)return WW$1;let s$=1;if(t$===YW$1&&(t$=6),n$<0?(s$=0,n$=-n$):n$>15&&(s$=2,n$-=16),i$<1||i$>9||r$!==$W$1||n$<8||n$>15||t$<0||t$>9||o$<0||o$>XW$1||n$===8&&s$!==1)return lH(e$,WW$1);n$===8&&(n$=9);const a$=new bH;return e$.state=a$,a$.strm=e$,a$.status=aH,a$.wrap=s$,a$.gzhead=null,a$.w_bits=n$,a$.w_size=1<<a$.w_bits,a$.w_mask=a$.w_size-1,a$.hash_bits=i$+7,a$.hash_size=1<<a$.hash_bits,a$.hash_mask=a$.hash_size-1,a$.hash_shift=~~((a$.hash_bits+3-1)/3),a$.window=new Uint8Array(2*a$.w_size),a$.head=new Uint16Array(a$.hash_size),a$.prev=new Uint16Array(a$.w_size),a$.lit_bufsize=1<<i$+6,a$.pending_buf_size=4*a$.lit_bufsize,a$.pending_buf=new Uint8Array(a$.pending_buf_size),a$.sym_buf=a$.lit_bufsize,a$.sym_end=3*(a$.lit_bufsize-1),a$.level=t$,a$.strategy=o$,a$.method=r$,NH(e$)};var PH=(e$,t$)=>{if(wH(e$)||t$>BW$1||t$<0)return e$?lH(e$,WW$1):WW$1;const r$=e$.state;if(!e$.output||e$.avail_in!==0&&!e$.input||r$.status===dH&&t$!==FW$1)return lH(e$,e$.avail_out===0?KW$1:WW$1);const n$=r$.last_flush;if(r$.last_flush=t$,r$.pending!==0){if(EH(e$),e$.avail_out===0)return r$.last_flush=-1,jW$1}else if(e$.avail_in===0&&uH(t$)<=uH(n$)&&t$!==FW$1)return lH(e$,KW$1);if(r$.status===dH&&e$.avail_in!==0)return lH(e$,KW$1);if(r$.status===aH&&r$.wrap===0&&(r$.status=cH),r$.status===aH){let i$=$W$1+(r$.w_bits-8<<4)<<8,o$=-1;if(o$=r$.strategy>=zW$1||r$.level<2?0:r$.level<6?1:r$.level===6?2:3,i$|=o$<<6,r$.strstart!==0&&(i$|=32),i$+=31-i$%31,TH(r$,i$),r$.strstart!==0&&(TH(r$,e$.adler>>>16),TH(r$,65535&e$.adler)),e$.adler=1,r$.status=cH,EH(e$),r$.pending!==0)return r$.last_flush=-1,jW$1}if(r$.status===57){if(e$.adler=0,mH(r$,31),mH(r$,139),mH(r$,8),r$.gzhead)mH(r$,(r$.gzhead.text?1:0)+(r$.gzhead.hcrc?2:0)+(r$.gzhead.extra?4:0)+(r$.gzhead.name?8:0)+(r$.gzhead.comment?16:0)),mH(r$,255&r$.gzhead.time),mH(r$,r$.gzhead.time>>8&255),mH(r$,r$.gzhead.time>>16&255),mH(r$,r$.gzhead.time>>24&255),mH(r$,r$.level===9?2:r$.strategy>=zW$1||r$.level<2?4:0),mH(r$,255&r$.gzhead.os),r$.gzhead.extra&&r$.gzhead.extra.length&&(mH(r$,255&r$.gzhead.extra.length),mH(r$,r$.gzhead.extra.length>>8&255)),r$.gzhead.hcrc&&(e$.adler=wW$1(e$.adler,r$.pending_buf,r$.pending,0)),r$.gzindex=0,r$.status=69;else if(mH(r$,0),mH(r$,0),mH(r$,0),mH(r$,0),mH(r$,0),mH(r$,r$.level===9?2:r$.strategy>=zW$1||r$.level<2?4:0),mH(r$,3),r$.status=cH,EH(e$),r$.pending!==0)return r$.last_flush=-1,jW$1}if(r$.status===69){if(r$.gzhead.extra){let i$=r$.pending,o$=(65535&r$.gzhead.extra.length)-r$.gzindex;for(;r$.pending+o$>r$.pending_buf_size;){let a$=r$.pending_buf_size-r$.pending;if(r$.pending_buf.set(r$.gzhead.extra.subarray(r$.gzindex,r$.gzindex+a$),r$.pending),r$.pending=r$.pending_buf_size,r$.gzhead.hcrc&&r$.pending>i$&&(e$.adler=wW$1(e$.adler,r$.pending_buf,r$.pending-i$,i$)),r$.gzindex+=a$,EH(e$),r$.pending!==0)return r$.last_flush=-1,jW$1;i$=0,o$-=a$}let s$=new Uint8Array(r$.gzhead.extra);r$.pending_buf.set(s$.subarray(r$.gzindex,r$.gzindex+o$),r$.pending),r$.pending+=o$,r$.gzhead.hcrc&&r$.pending>i$&&(e$.adler=wW$1(e$.adler,r$.pending_buf,r$.pending-i$,i$)),r$.gzindex=0}r$.status=73}if(r$.status===73){if(r$.gzhead.name){let i$,o$=r$.pending;do{if(r$.pending===r$.pending_buf_size){if(r$.gzhead.hcrc&&r$.pending>o$&&(e$.adler=wW$1(e$.adler,r$.pending_buf,r$.pending-o$,o$)),EH(e$),r$.pending!==0)return r$.last_flush=-1,jW$1;o$=0}i$=r$.gzindex<r$.gzhead.name.length?255&r$.gzhead.name.charCodeAt(r$.gzindex++):0,mH(r$,i$)}while(i$!==0);r$.gzhead.hcrc&&r$.pending>o$&&(e$.adler=wW$1(e$.adler,r$.pending_buf,r$.pending-o$,o$)),r$.gzindex=0}r$.status=91}if(r$.status===91){if(r$.gzhead.comment){let i$,o$=r$.pending;do{if(r$.pending===r$.pending_buf_size){if(r$.gzhead.hcrc&&r$.pending>o$&&(e$.adler=wW$1(e$.adler,r$.pending_buf,r$.pending-o$,o$)),EH(e$),r$.pending!==0)return r$.last_flush=-1,jW$1;o$=0}i$=r$.gzindex<r$.gzhead.comment.length?255&r$.gzhead.comment.charCodeAt(r$.gzindex++):0,mH(r$,i$)}while(i$!==0);r$.gzhead.hcrc&&r$.pending>o$&&(e$.adler=wW$1(e$.adler,r$.pending_buf,r$.pending-o$,o$))}r$.status=103}if(r$.status===103){if(r$.gzhead.hcrc){if(r$.pending+2>r$.pending_buf_size&&(EH(e$),r$.pending!==0))return r$.last_flush=-1,jW$1;mH(r$,255&e$.adler),mH(r$,e$.adler>>8&255),e$.adler=0}if(r$.status=cH,EH(e$),r$.pending!==0)return r$.last_flush=-1,jW$1}if(e$.avail_in!==0||r$.lookahead!==0||t$!==UW$1&&r$.status!==dH){let i$=r$.level===0?CH(r$,t$):r$.strategy===zW$1?((o$,s$)=>{let a$;for(;;){if(o$.lookahead===0&&(RH(o$),o$.lookahead===0)){if(s$===UW$1)return 1;break}if(o$.match_length=0,a$=kW$1(o$,0,o$.window[o$.strstart]),o$.lookahead--,o$.strstart++,a$&&(fH(o$,!1),o$.strm.avail_out===0))return 1}return o$.insert=0,s$===FW$1?(fH(o$,!0),o$.strm.avail_out===0?3:4):o$.sym_next&&(fH(o$,!1),o$.strm.avail_out===0)?1:2})(r$,t$):r$.strategy===JW$1?((o$,s$)=>{let a$,c$,u$,l$;const d$=o$.window;for(;;){if(o$.lookahead<=oH){if(RH(o$),o$.lookahead<=oH&&s$===UW$1)return 1;if(o$.lookahead===0)break}if(o$.match_length=0,o$.lookahead>=3&&o$.strstart>0&&(u$=o$.strstart-1,c$=d$[u$],c$===d$[++u$]&&c$===d$[++u$]&&c$===d$[++u$])){l$=o$.strstart+oH;do;while(c$===d$[++u$]&&c$===d$[++u$]&&c$===d$[++u$]&&c$===d$[++u$]&&c$===d$[++u$]&&c$===d$[++u$]&&c$===d$[++u$]&&c$===d$[++u$]&&u$<l$);o$.match_length=oH-(l$-u$),o$.match_length>o$.lookahead&&(o$.match_length=o$.lookahead)}if(o$.match_length>=3?(a$=kW$1(o$,1,o$.match_length-3),o$.lookahead-=o$.match_length,o$.strstart+=o$.match_length,o$.match_length=0):(a$=kW$1(o$,0,o$.window[o$.strstart]),o$.lookahead--,o$.strstart++),a$&&(fH(o$,!1),o$.strm.avail_out===0))return 1}return o$.insert=0,s$===FW$1?(fH(o$,!0),o$.strm.avail_out===0?3:4):o$.sym_next&&(fH(o$,!1),o$.strm.avail_out===0)?1:2})(r$,t$):AH[r$.level].func(r$,t$);if(i$!==3&&i$!==4||(r$.status=dH),i$===1||i$===3)return e$.avail_out===0&&(r$.last_flush=-1),jW$1;if(i$===2&&(t$===xW$1?MW$1(r$):t$!==BW$1&&(PW$1(r$,0,0,!1),t$===VW$1&&(hH(r$.head),r$.lookahead===0&&(r$.strstart=0,r$.block_start=0,r$.insert=0))),EH(e$),e$.avail_out===0))return r$.last_flush=-1,jW$1}return t$!==FW$1?jW$1:r$.wrap<=0?GW$1:(r$.wrap===2?(mH(r$,255&e$.adler),mH(r$,e$.adler>>8&255),mH(r$,e$.adler>>16&255),mH(r$,e$.adler>>24&255),mH(r$,255&e$.total_in),mH(r$,e$.total_in>>8&255),mH(r$,e$.total_in>>16&255),mH(r$,e$.total_in>>24&255)):(TH(r$,e$.adler>>>16),TH(r$,65535&e$.adler)),EH(e$),r$.wrap>0&&(r$.wrap=-r$.wrap),r$.pending!==0?jW$1:GW$1)},LH=(e$,t$)=>{let r$=t$.length;if(wH(e$))return WW$1;const n$=e$.state,i$=n$.wrap;if(i$===2||i$===1&&n$.status!==aH||n$.lookahead)return WW$1;if(i$===1&&(e$.adler=AW$1(e$.adler,t$,r$,0)),n$.wrap=0,r$>=n$.w_size){i$===0&&(hH(n$.head),n$.strstart=0,n$.block_start=0,n$.insert=0);let c$=new Uint8Array(n$.w_size);c$.set(t$.subarray(r$-n$.w_size,r$),0),t$=c$,r$=n$.w_size}const o$=e$.avail_in,s$=e$.next_in,a$=e$.input;for(e$.avail_in=r$,e$.next_in=0,e$.input=t$,RH(n$);n$.lookahead>=3;){let c$=n$.strstart,u$=n$.lookahead-2;do n$.ins_h=_H(n$,n$.ins_h,n$.window[c$+3-1]),n$.prev[c$&n$.w_mask]=n$.head[n$.ins_h],n$.head[n$.ins_h]=c$,c$++;while(--u$);n$.strstart=c$,n$.lookahead=2,RH(n$)}return n$.strstart+=n$.lookahead,n$.block_start=n$.strstart,n$.insert=n$.lookahead,n$.lookahead=0,n$.match_length=n$.prev_length=2,n$.match_available=0,e$.next_in=s$,e$.input=a$,e$.avail_in=o$,n$.wrap=i$,jW$1},kH={deflateInit:(e$,t$)=>DH(e$,t$,$W$1,15,8,QW$1),deflateInit2:DH,deflateReset:NH,deflateResetKeep:OH,deflateSetHeader:(e$,t$)=>wH(e$)||e$.state.wrap!==2?WW$1:(e$.state.gzhead=t$,jW$1),deflate:PH,deflateEnd:e$=>{if(wH(e$))return WW$1;const t$=e$.state.status;return e$.state=null,t$===cH?lH(e$,HW$1):jW$1},deflateSetDictionary:LH,deflateInfo:"pako deflate (from Nodeca project)"};const MH=(e$,t$)=>Object.prototype.hasOwnProperty.call(e$,t$);var UH={assign:function(e$){const t$=Array.prototype.slice.call(arguments,1);for(;t$.length;){const r$=t$.shift();if(r$){if(typeof r$!="object")throw new TypeError(r$+"must be non-object");for(const n$ in r$)MH(r$,n$)&&(e$[n$]=r$[n$])}}return e$},flattenChunks:e$=>{let t$=0;for(let n$=0,i$=e$.length;n$<i$;n$++)t$+=e$[n$].length;const r$=new Uint8Array(t$);for(let n$=0,i$=0,o$=e$.length;n$<o$;n$++){let s$=e$[n$];r$.set(s$,i$),i$+=s$.length}return r$}};let xH=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{xH=!1}const VH=new Uint8Array(256);for(let e$=0;e$<256;e$++)VH[e$]=e$>=252?6:e$>=248?5:e$>=240?4:e$>=224?3:e$>=192?2:1;VH[254]=VH[254]=1;var FH={string2buf:e$=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e$);let t$,r$,n$,i$,o$,s$=e$.length,a$=0;for(i$=0;i$<s$;i$++)r$=e$.charCodeAt(i$),(64512&r$)==55296&&i$+1<s$&&(n$=e$.charCodeAt(i$+1),(64512&n$)==56320&&(r$=65536+(r$-55296<<10)+(n$-56320),i$++)),a$+=r$<128?1:r$<2048?2:r$<65536?3:4;for(t$=new Uint8Array(a$),o$=0,i$=0;o$<a$;i$++)r$=e$.charCodeAt(i$),(64512&r$)==55296&&i$+1<s$&&(n$=e$.charCodeAt(i$+1),(64512&n$)==56320&&(r$=65536+(r$-55296<<10)+(n$-56320),i$++)),r$<128?t$[o$++]=r$:r$<2048?(t$[o$++]=192|r$>>>6,t$[o$++]=128|63&r$):r$<65536?(t$[o$++]=224|r$>>>12,t$[o$++]=128|r$>>>6&63,t$[o$++]=128|63&r$):(t$[o$++]=240|r$>>>18,t$[o$++]=128|r$>>>12&63,t$[o$++]=128|r$>>>6&63,t$[o$++]=128|63&r$);return t$},buf2string:(e$,t$)=>{const r$=t$||e$.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e$.subarray(0,t$));let n$,i$;const o$=new Array(2*r$);for(i$=0,n$=0;n$<r$;){let s$=e$[n$++];if(s$<128){o$[i$++]=s$;continue}let a$=VH[s$];if(a$>4)o$[i$++]=65533,n$+=a$-1;else{for(s$&=a$===2?31:a$===3?15:7;a$>1&&n$<r$;)s$=s$<<6|63&e$[n$++],a$--;a$>1?o$[i$++]=65533:s$<65536?o$[i$++]=s$:(s$-=65536,o$[i$++]=55296|s$>>10&1023,o$[i$++]=56320|1023&s$)}}return((s$,a$)=>{if(a$<65534&&s$.subarray&&xH)return String.fromCharCode.apply(null,s$.length===a$?s$:s$.subarray(0,a$));let c$="";for(let u$=0;u$<a$;u$++)c$+=String.fromCharCode(s$[u$]);return c$})(o$,i$)},utf8border:(e$,t$)=>{(t$=t$||e$.length)>e$.length&&(t$=e$.length);let r$=t$-1;for(;r$>=0&&(192&e$[r$])==128;)r$--;return r$<0||r$===0?t$:r$+VH[e$[r$]]>t$?r$:t$}},BH=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const jH=Object.prototype.toString,{Z_NO_FLUSH:GH,Z_SYNC_FLUSH:WH,Z_FULL_FLUSH:HH,Z_FINISH:KH,Z_OK:YH,Z_STREAM_END:qH,Z_DEFAULT_COMPRESSION:zH,Z_DEFAULT_STRATEGY:JH,Z_DEFLATED:XH}=NW;function QH(e$){this.options=UH.assign({level:zH,method:XH,chunkSize:16384,windowBits:15,memLevel:8,strategy:JH},e$||{});let t$=this.options;t$.raw&&t$.windowBits>0?t$.windowBits=-t$.windowBits:t$.gzip&&t$.windowBits>0&&t$.windowBits<16&&(t$.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new BH,this.strm.avail_out=0;let r$=kH.deflateInit2(this.strm,t$.level,t$.method,t$.windowBits,t$.memLevel,t$.strategy);if(r$!==YH)throw new Error(OW$1[r$]);if(t$.header&&kH.deflateSetHeader(this.strm,t$.header),t$.dictionary){let n$;if(n$=typeof t$.dictionary=="string"?FH.string2buf(t$.dictionary):jH.call(t$.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t$.dictionary):t$.dictionary,r$=kH.deflateSetDictionary(this.strm,n$),r$!==YH)throw new Error(OW$1[r$]);this._dict_set=!0}}function ZH(e$,t$){const r$=new QH(t$);if(r$.push(e$,!0),r$.err)throw r$.msg||OW$1[r$.err];return r$.result}QH.prototype.push=function(e$,t$){const r$=this.strm,n$=this.options.chunkSize;let i$,o$;if(this.ended)return!1;for(o$=t$===~~t$?t$:t$===!0?KH:GH,typeof e$=="string"?r$.input=FH.string2buf(e$):jH.call(e$)==="[object ArrayBuffer]"?r$.input=new Uint8Array(e$):r$.input=e$,r$.next_in=0,r$.avail_in=r$.input.length;;)if(r$.avail_out===0&&(r$.output=new Uint8Array(n$),r$.next_out=0,r$.avail_out=n$),(o$===WH||o$===HH)&&r$.avail_out<=6)this.onData(r$.output.subarray(0,r$.next_out)),r$.avail_out=0;else{if(i$=kH.deflate(r$,o$),i$===qH)return r$.next_out>0&&this.onData(r$.output.subarray(0,r$.next_out)),i$=kH.deflateEnd(this.strm),this.onEnd(i$),this.ended=!0,i$===YH;if(r$.avail_out!==0){if(o$>0&&r$.next_out>0)this.onData(r$.output.subarray(0,r$.next_out)),r$.avail_out=0;else if(r$.avail_in===0)break}else this.onData(r$.output)}return!0},QH.prototype.onData=function(e$){this.chunks.push(e$)},QH.prototype.onEnd=function(e$){e$===YH&&(this.result=UH.flattenChunks(this.chunks)),this.chunks=[],this.err=e$,this.msg=this.strm.msg};var $H$1={Deflate:QH,deflate:ZH,deflateRaw:function(e$,t$){return(t$=t$||{}).raw=!0,ZH(e$,t$)},gzip:function(e$,t$){return(t$=t$||{}).gzip=!0,ZH(e$,t$)},constants:NW};const eK=16209;var tK=function(e$,t$){let r$,n$,i$,o$,s$,a$,c$,u$,l$,d$,h$,p$,_$,f$,m$,g$,v$,y$,S$,b$,$$,C$,N$,k$;const O$=e$.state;r$=e$.next_in,N$=e$.input,n$=r$+(e$.avail_in-5),i$=e$.next_out,k$=e$.output,o$=i$-(t$-e$.avail_out),s$=i$+(e$.avail_out-257),a$=O$.dmax,c$=O$.wsize,u$=O$.whave,l$=O$.wnext,d$=O$.window,h$=O$.hold,p$=O$.bits,_$=O$.lencode,f$=O$.distcode,m$=(1<<O$.lenbits)-1,g$=(1<<O$.distbits)-1;e:do{p$<15&&(h$+=N$[r$++]<<p$,p$+=8,h$+=N$[r$++]<<p$,p$+=8),v$=_$[h$&m$];t:for(;;){if(y$=v$>>>24,h$>>>=y$,p$-=y$,y$=v$>>>16&255,y$===0)k$[i$++]=65535&v$;else{if(!(16&y$)){if(!(64&y$)){v$=_$[(65535&v$)+(h$&(1<<y$)-1)];continue t}if(32&y$){O$.mode=16191;break e}e$.msg="invalid literal/length code",O$.mode=eK;break e}S$=65535&v$,y$&=15,y$&&(p$<y$&&(h$+=N$[r$++]<<p$,p$+=8),S$+=h$&(1<<y$)-1,h$>>>=y$,p$-=y$),p$<15&&(h$+=N$[r$++]<<p$,p$+=8,h$+=N$[r$++]<<p$,p$+=8),v$=f$[h$&g$];r:for(;;){if(y$=v$>>>24,h$>>>=y$,p$-=y$,y$=v$>>>16&255,!(16&y$)){if(!(64&y$)){v$=f$[(65535&v$)+(h$&(1<<y$)-1)];continue r}e$.msg="invalid distance code",O$.mode=eK;break e}if(b$=65535&v$,y$&=15,p$<y$&&(h$+=N$[r$++]<<p$,p$+=8,p$<y$&&(h$+=N$[r$++]<<p$,p$+=8)),b$+=h$&(1<<y$)-1,b$>a$){e$.msg="invalid distance too far back",O$.mode=eK;break e}if(h$>>>=y$,p$-=y$,y$=i$-o$,b$>y$){if(y$=b$-y$,y$>u$&&O$.sane){e$.msg="invalid distance too far back",O$.mode=eK;break e}if($$=0,C$=d$,l$===0){if($$+=c$-y$,y$<S$){S$-=y$;do k$[i$++]=d$[$$++];while(--y$);$$=i$-b$,C$=k$}}else if(l$<y$){if($$+=c$+l$-y$,y$-=l$,y$<S$){S$-=y$;do k$[i$++]=d$[$$++];while(--y$);if($$=0,l$<S$){y$=l$,S$-=y$;do k$[i$++]=d$[$$++];while(--y$);$$=i$-b$,C$=k$}}}else if($$+=l$-y$,y$<S$){S$-=y$;do k$[i$++]=d$[$$++];while(--y$);$$=i$-b$,C$=k$}for(;S$>2;)k$[i$++]=C$[$$++],k$[i$++]=C$[$$++],k$[i$++]=C$[$$++],S$-=3;S$&&(k$[i$++]=C$[$$++],S$>1&&(k$[i$++]=C$[$$++]))}else{$$=i$-b$;do k$[i$++]=k$[$$++],k$[i$++]=k$[$$++],k$[i$++]=k$[$$++],S$-=3;while(S$>2);S$&&(k$[i$++]=k$[$$++],S$>1&&(k$[i$++]=k$[$$++]))}break}}break}}while(r$<n$&&i$<s$);S$=p$>>3,r$-=S$,p$-=S$<<3,h$&=(1<<p$)-1,e$.next_in=r$,e$.next_out=i$,e$.avail_in=r$<n$?n$-r$+5:5-(r$-n$),e$.avail_out=i$<s$?s$-i$+257:257-(i$-s$),O$.hold=h$,O$.bits=p$};const iK=15,nK=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),rK=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),oK=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),sK=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var aK=(e$,t$,r$,n$,i$,o$,s$,a$)=>{const c$=a$.bits;let u$,l$,d$,h$,p$,_$,f$=0,m$=0,g$=0,v$=0,y$=0,S$=0,b$=0,$$=0,C$=0,N$=0,k$=null;const O$=new Uint16Array(16),U$=new Uint16Array(16);let x$,F$,L$,M$=null;for(f$=0;f$<=iK;f$++)O$[f$]=0;for(m$=0;m$<n$;m$++)O$[t$[r$+m$]]++;for(y$=c$,v$=iK;v$>=1&&O$[v$]===0;v$--);if(y$>v$&&(y$=v$),v$===0)return i$[o$++]=20971520,i$[o$++]=20971520,a$.bits=1,0;for(g$=1;g$<v$&&O$[g$]===0;g$++);for(y$<g$&&(y$=g$),$$=1,f$=1;f$<=iK;f$++)if($$<<=1,$$-=O$[f$],$$<0)return-1;if($$>0&&(e$===0||v$!==1))return-1;for(U$[1]=0,f$=1;f$<iK;f$++)U$[f$+1]=U$[f$]+O$[f$];for(m$=0;m$<n$;m$++)t$[r$+m$]!==0&&(s$[U$[t$[r$+m$]]++]=m$);if(e$===0?(k$=M$=s$,_$=20):e$===1?(k$=nK,M$=rK,_$=257):(k$=oK,M$=sK,_$=0),N$=0,m$=0,f$=g$,p$=o$,S$=y$,b$=0,d$=-1,C$=1<<y$,h$=C$-1,e$===1&&C$>852||e$===2&&C$>592)return 1;for(;;){x$=f$-b$,s$[m$]+1<_$?(F$=0,L$=s$[m$]):s$[m$]>=_$?(F$=M$[s$[m$]-_$],L$=k$[s$[m$]-_$]):(F$=96,L$=0),u$=1<<f$-b$,l$=1<<S$,g$=l$;do l$-=u$,i$[p$+(N$>>b$)+l$]=x$<<24|F$<<16|L$|0;while(l$!==0);for(u$=1<<f$-1;N$&u$;)u$>>=1;if(u$!==0?(N$&=u$-1,N$+=u$):N$=0,m$++,--O$[f$]==0){if(f$===v$)break;f$=t$[r$+s$[m$]]}if(f$>y$&&(N$&h$)!==d$){for(b$===0&&(b$=y$),p$+=g$,S$=f$-b$,$$=1<<S$;S$+b$<v$&&($$-=O$[S$+b$],!($$<=0));)S$++,$$<<=1;if(C$+=1<<S$,e$===1&&C$>852||e$===2&&C$>592)return 1;d$=N$&h$,i$[d$]=y$<<24|S$<<16|p$-o$|0}}return N$!==0&&(i$[p$+N$]=f$-b$<<24|64<<16|0),a$.bits=y$,0};const{Z_FINISH:cK,Z_BLOCK:dK,Z_TREES:lK,Z_OK:uK,Z_STREAM_END:hK,Z_NEED_DICT:pK,Z_STREAM_ERROR:_K,Z_DATA_ERROR:EK,Z_MEM_ERROR:fK,Z_BUF_ERROR:mK,Z_DEFLATED:TK}=NW,SK=16180,gK=16190,RK=16191,CK=16192,IK=16194,vK=16199,yK=16200,AK=16206,bK=16209,wK=e$=>(e$>>>24&255)+(e$>>>8&65280)+((65280&e$)<<8)+((255&e$)<<24);function OK(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const NK=e$=>{if(!e$)return 1;const t$=e$.state;return!t$||t$.strm!==e$||t$.mode<SK||t$.mode>16211?1:0},DK=e$=>{if(NK(e$))return _K;const t$=e$.state;return e$.total_in=e$.total_out=t$.total=0,e$.msg="",t$.wrap&&(e$.adler=1&t$.wrap),t$.mode=SK,t$.last=0,t$.havedict=0,t$.flags=-1,t$.dmax=32768,t$.head=null,t$.hold=0,t$.bits=0,t$.lencode=t$.lendyn=new Int32Array(852),t$.distcode=t$.distdyn=new Int32Array(592),t$.sane=1,t$.back=-1,uK},PK=e$=>{if(NK(e$))return _K;const t$=e$.state;return t$.wsize=0,t$.whave=0,t$.wnext=0,DK(e$)},LK=(e$,t$)=>{let r$;if(NK(e$))return _K;const n$=e$.state;return t$<0?(r$=0,t$=-t$):(r$=5+(t$>>4),t$<48&&(t$&=15)),t$&&(t$<8||t$>15)?_K:(n$.window!==null&&n$.wbits!==t$&&(n$.window=null),n$.wrap=r$,n$.wbits=t$,PK(e$))},kK=(e$,t$)=>{if(!e$)return _K;const r$=new OK;e$.state=r$,r$.strm=e$,r$.window=null,r$.mode=SK;const n$=LK(e$,t$);return n$!==uK&&(e$.state=null),n$};let MK,UK,xK=!0;const VK=e$=>{if(xK){MK=new Int32Array(512),UK=new Int32Array(32);let t$=0;for(;t$<144;)e$.lens[t$++]=8;for(;t$<256;)e$.lens[t$++]=9;for(;t$<280;)e$.lens[t$++]=7;for(;t$<288;)e$.lens[t$++]=8;for(aK(1,e$.lens,0,288,MK,0,e$.work,{bits:9}),t$=0;t$<32;)e$.lens[t$++]=5;aK(2,e$.lens,0,32,UK,0,e$.work,{bits:5}),xK=!1}e$.lencode=MK,e$.lenbits=9,e$.distcode=UK,e$.distbits=5},FK=(e$,t$,r$,n$)=>{let i$;const o$=e$.state;return o$.window===null&&(o$.wsize=1<<o$.wbits,o$.wnext=0,o$.whave=0,o$.window=new Uint8Array(o$.wsize)),n$>=o$.wsize?(o$.window.set(t$.subarray(r$-o$.wsize,r$),0),o$.wnext=0,o$.whave=o$.wsize):(i$=o$.wsize-o$.wnext,i$>n$&&(i$=n$),o$.window.set(t$.subarray(r$-n$,r$-n$+i$),o$.wnext),(n$-=i$)?(o$.window.set(t$.subarray(r$-n$,r$),0),o$.wnext=n$,o$.whave=o$.wsize):(o$.wnext+=i$,o$.wnext===o$.wsize&&(o$.wnext=0),o$.whave<o$.wsize&&(o$.whave+=i$))),0};var BK=(e$,t$)=>{let r$,n$,i$,o$,s$,a$,c$,u$,l$,d$,h$,p$,_$,f$,m$,g$,v$,y$,S$,b$,$$,C$,N$=0;const k$=new Uint8Array(4);let O$,U$;const x$=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(NK(e$)||!e$.output||!e$.input&&e$.avail_in!==0)return _K;r$=e$.state,r$.mode===RK&&(r$.mode=CK),s$=e$.next_out,i$=e$.output,c$=e$.avail_out,o$=e$.next_in,n$=e$.input,a$=e$.avail_in,u$=r$.hold,l$=r$.bits,d$=a$,h$=c$,C$=uK;e:for(;;)switch(r$.mode){case SK:if(r$.wrap===0){r$.mode=CK;break}for(;l$<16;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(2&r$.wrap&&u$===35615){r$.wbits===0&&(r$.wbits=15),r$.check=0,k$[0]=255&u$,k$[1]=u$>>>8&255,r$.check=wW$1(r$.check,k$,2,0),u$=0,l$=0,r$.mode=16181;break}if(r$.head&&(r$.head.done=!1),!(1&r$.wrap)||(((255&u$)<<8)+(u$>>8))%31){e$.msg="incorrect header check",r$.mode=bK;break}if((15&u$)!==TK){e$.msg="unknown compression method",r$.mode=bK;break}if(u$>>>=4,l$-=4,$$=8+(15&u$),r$.wbits===0&&(r$.wbits=$$),$$>15||$$>r$.wbits){e$.msg="invalid window size",r$.mode=bK;break}r$.dmax=1<<r$.wbits,r$.flags=0,e$.adler=r$.check=1,r$.mode=512&u$?16189:RK,u$=0,l$=0;break;case 16181:for(;l$<16;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(r$.flags=u$,(255&VG$1(r$))!==TK){e$.msg="unknown compression method",r$.mode=bK;break}if(57344&VG$1(r$)){e$.msg="unknown header flags set",r$.mode=bK;break}r$.head&&(r$.head.text=u$>>8&1),512&VG$1(r$)&&4&r$.wrap&&(k$[0]=255&u$,k$[1]=u$>>>8&255,r$.check=wW$1(r$.check,k$,2,0)),u$=0,l$=0,r$.mode=16182;case 16182:for(;l$<32;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}r$.head&&(r$.head.time=u$),512&VG$1(r$)&&4&r$.wrap&&(k$[0]=255&u$,k$[1]=u$>>>8&255,k$[2]=u$>>>16&255,k$[3]=u$>>>24&255,r$.check=wW$1(r$.check,k$,4,0)),u$=0,l$=0,r$.mode=16183;case 16183:for(;l$<16;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}r$.head&&(r$.head.xflags=255&u$,r$.head.os=u$>>8),512&VG$1(r$)&&4&r$.wrap&&(k$[0]=255&u$,k$[1]=u$>>>8&255,r$.check=wW$1(r$.check,k$,2,0)),u$=0,l$=0,r$.mode=16184;case 16184:if(1024&VG$1(r$)){for(;l$<16;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}r$.length=u$,r$.head&&(r$.head.extra_len=u$),512&VG$1(r$)&&4&r$.wrap&&(k$[0]=255&u$,k$[1]=u$>>>8&255,r$.check=wW$1(r$.check,k$,2,0)),u$=0,l$=0}else r$.head&&(r$.head.extra=null);r$.mode=16185;case 16185:if(1024&VG$1(r$)&&(p$=r$.length,p$>a$&&(p$=a$),p$&&(r$.head&&($$=r$.head.extra_len-r$.length,r$.head.extra||(r$.head.extra=new Uint8Array(r$.head.extra_len)),r$.head.extra.set(n$.subarray(o$,o$+p$),$$)),512&VG$1(r$)&&4&r$.wrap&&(r$.check=wW$1(r$.check,n$,p$,o$)),a$-=p$,o$+=p$,r$.length-=p$),r$.length))break e;r$.length=0,r$.mode=16186;case 16186:if(2048&VG$1(r$)){if(a$===0)break e;p$=0;do $$=n$[o$+p$++],r$.head&&$$&&r$.length<65536&&(r$.head.name+=String.fromCharCode($$));while($$&&p$<a$);if(512&VG$1(r$)&&4&r$.wrap&&(r$.check=wW$1(r$.check,n$,p$,o$)),a$-=p$,o$+=p$,$$)break e}else r$.head&&(r$.head.name=null);r$.length=0,r$.mode=16187;case 16187:if(4096&VG$1(r$)){if(a$===0)break e;p$=0;do $$=n$[o$+p$++],r$.head&&$$&&r$.length<65536&&(r$.head.comment+=String.fromCharCode($$));while($$&&p$<a$);if(512&VG$1(r$)&&4&r$.wrap&&(r$.check=wW$1(r$.check,n$,p$,o$)),a$-=p$,o$+=p$,$$)break e}else r$.head&&(r$.head.comment=null);r$.mode=16188;case 16188:if(512&VG$1(r$)){for(;l$<16;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(4&r$.wrap&&u$!==(65535&r$.check)){e$.msg="header crc mismatch",r$.mode=bK;break}u$=0,l$=0}r$.head&&(r$.head.hcrc=VG$1(r$)>>9&1,r$.head.done=!0),e$.adler=r$.check=0,r$.mode=RK;break;case 16189:for(;l$<32;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}e$.adler=r$.check=wK(u$),u$=0,l$=0,r$.mode=gK;case gK:if(r$.havedict===0)return e$.next_out=s$,e$.avail_out=c$,e$.next_in=o$,e$.avail_in=a$,r$.hold=u$,r$.bits=l$,pK;e$.adler=r$.check=1,r$.mode=RK;case RK:if(t$===dK||t$===lK)break e;case CK:if(r$.last){u$>>>=7&l$,l$-=7&l$,r$.mode=AK;break}for(;l$<3;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}switch(r$.last=1&u$,u$>>>=1,l$-=1,3&u$){case 0:r$.mode=16193;break;case 1:if(VK(r$),r$.mode=vK,t$===lK){u$>>>=2,l$-=2;break e}break;case 2:r$.mode=16196;break;case 3:e$.msg="invalid block type",r$.mode=bK}u$>>>=2,l$-=2;break;case 16193:for(u$>>>=7&l$,l$-=7&l$;l$<32;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if((65535&u$)!=(u$>>>16^65535)){e$.msg="invalid stored block lengths",r$.mode=bK;break}if(r$.length=65535&u$,u$=0,l$=0,r$.mode=IK,t$===lK)break e;case IK:r$.mode=16195;case 16195:if(p$=r$.length,p$){if(p$>a$&&(p$=a$),p$>c$&&(p$=c$),p$===0)break e;i$.set(n$.subarray(o$,o$+p$),s$),a$-=p$,o$+=p$,c$-=p$,s$+=p$,r$.length-=p$;break}r$.mode=RK;break;case 16196:for(;l$<14;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(r$.nlen=257+(31&u$),u$>>>=5,l$-=5,r$.ndist=1+(31&u$),u$>>>=5,l$-=5,r$.ncode=4+(15&u$),u$>>>=4,l$-=4,r$.nlen>286||r$.ndist>30){e$.msg="too many length or distance symbols",r$.mode=bK;break}r$.have=0,r$.mode=16197;case 16197:for(;r$.have<r$.ncode;){for(;l$<3;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}r$.lens[x$[r$.have++]]=7&u$,u$>>>=3,l$-=3}for(;r$.have<19;)r$.lens[x$[r$.have++]]=0;if(r$.lencode=r$.lendyn,r$.lenbits=7,O$={bits:r$.lenbits},C$=aK(0,r$.lens,0,19,r$.lencode,0,r$.work,O$),r$.lenbits=O$.bits,C$){e$.msg="invalid code lengths set",r$.mode=bK;break}r$.have=0,r$.mode=16198;case 16198:for(;r$.have<r$.nlen+r$.ndist;){for(;N$=r$.lencode[u$&(1<<r$.lenbits)-1],m$=N$>>>24,g$=N$>>>16&255,v$=65535&N$,!(m$<=l$);){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(v$<16)u$>>>=m$,l$-=m$,r$.lens[r$.have++]=v$;else{if(v$===16){for(U$=m$+2;l$<U$;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(u$>>>=m$,l$-=m$,r$.have===0){e$.msg="invalid bit length repeat",r$.mode=bK;break}$$=r$.lens[r$.have-1],p$=3+(3&u$),u$>>>=2,l$-=2}else if(v$===17){for(U$=m$+3;l$<U$;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}u$>>>=m$,l$-=m$,$$=0,p$=3+(7&u$),u$>>>=3,l$-=3}else{for(U$=m$+7;l$<U$;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}u$>>>=m$,l$-=m$,$$=0,p$=11+(127&u$),u$>>>=7,l$-=7}if(r$.have+p$>r$.nlen+r$.ndist){e$.msg="invalid bit length repeat",r$.mode=bK;break}for(;p$--;)r$.lens[r$.have++]=$$}}if(r$.mode===bK)break;if(r$.lens[256]===0){e$.msg="invalid code -- missing end-of-block",r$.mode=bK;break}if(r$.lenbits=9,O$={bits:r$.lenbits},C$=aK(1,r$.lens,0,r$.nlen,r$.lencode,0,r$.work,O$),r$.lenbits=O$.bits,C$){e$.msg="invalid literal/lengths set",r$.mode=bK;break}if(r$.distbits=6,r$.distcode=r$.distdyn,O$={bits:r$.distbits},C$=aK(2,r$.lens,r$.nlen,r$.ndist,r$.distcode,0,r$.work,O$),r$.distbits=O$.bits,C$){e$.msg="invalid distances set",r$.mode=bK;break}if(r$.mode=vK,t$===lK)break e;case vK:r$.mode=yK;case yK:if(a$>=6&&c$>=258){e$.next_out=s$,e$.avail_out=c$,e$.next_in=o$,e$.avail_in=a$,r$.hold=u$,r$.bits=l$,tK(e$,h$),s$=e$.next_out,i$=e$.output,c$=e$.avail_out,o$=e$.next_in,n$=e$.input,a$=e$.avail_in,u$=r$.hold,l$=r$.bits,r$.mode===RK&&(r$.back=-1);break}for(r$.back=0;N$=r$.lencode[u$&(1<<r$.lenbits)-1],m$=N$>>>24,g$=N$>>>16&255,v$=65535&N$,!(m$<=l$);){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(g$&&!(240&g$)){for(y$=m$,S$=g$,b$=v$;N$=r$.lencode[b$+((u$&(1<<y$+S$)-1)>>y$)],m$=N$>>>24,g$=N$>>>16&255,v$=65535&N$,!(y$+m$<=l$);){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}u$>>>=y$,l$-=y$,r$.back+=y$}if(u$>>>=m$,l$-=m$,r$.back+=m$,r$.length=v$,g$===0){r$.mode=16205;break}if(32&g$){r$.back=-1,r$.mode=RK;break}if(64&g$){e$.msg="invalid literal/length code",r$.mode=bK;break}r$.extra=15&g$,r$.mode=16201;case 16201:if(r$.extra){for(U$=r$.extra;l$<U$;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}r$.length+=u$&(1<<r$.extra)-1,u$>>>=r$.extra,l$-=r$.extra,r$.back+=r$.extra}r$.was=r$.length,r$.mode=16202;case 16202:for(;N$=r$.distcode[u$&(1<<r$.distbits)-1],m$=N$>>>24,g$=N$>>>16&255,v$=65535&N$,!(m$<=l$);){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(!(240&g$)){for(y$=m$,S$=g$,b$=v$;N$=r$.distcode[b$+((u$&(1<<y$+S$)-1)>>y$)],m$=N$>>>24,g$=N$>>>16&255,v$=65535&N$,!(y$+m$<=l$);){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}u$>>>=y$,l$-=y$,r$.back+=y$}if(u$>>>=m$,l$-=m$,r$.back+=m$,64&g$){e$.msg="invalid distance code",r$.mode=bK;break}r$.offset=v$,r$.extra=15&g$,r$.mode=16203;case 16203:if(r$.extra){for(U$=r$.extra;l$<U$;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}r$.offset+=u$&(1<<r$.extra)-1,u$>>>=r$.extra,l$-=r$.extra,r$.back+=r$.extra}if(r$.offset>r$.dmax){e$.msg="invalid distance too far back",r$.mode=bK;break}r$.mode=16204;case 16204:if(c$===0)break e;if(p$=h$-c$,r$.offset>p$){if(p$=r$.offset-p$,p$>r$.whave&&r$.sane){e$.msg="invalid distance too far back",r$.mode=bK;break}p$>r$.wnext?(p$-=r$.wnext,_$=r$.wsize-p$):_$=r$.wnext-p$,p$>r$.length&&(p$=r$.length),f$=r$.window}else f$=i$,_$=s$-r$.offset,p$=r$.length;p$>c$&&(p$=c$),c$-=p$,r$.length-=p$;do i$[s$++]=f$[_$++];while(--p$);r$.length===0&&(r$.mode=yK);break;case 16205:if(c$===0)break e;i$[s$++]=r$.length,c$--,r$.mode=yK;break;case AK:if(r$.wrap){for(;l$<32;){if(a$===0)break e;a$--,u$|=n$[o$++]<<l$,l$+=8}if(h$-=c$,e$.total_out+=h$,r$.total+=h$,4&r$.wrap&&h$&&(e$.adler=r$.check=VG$1(r$)?wW$1(r$.check,i$,h$,s$-h$):AW$1(r$.check,i$,h$,s$-h$)),h$=c$,4&r$.wrap&&(VG$1(r$)?u$:wK(u$))!==r$.check){e$.msg="incorrect data check",r$.mode=bK;break}u$=0,l$=0}r$.mode=16207;case 16207:if(r$.wrap&&VG$1(r$)){for(;l$<32;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(4&r$.wrap&&u$!==(4294967295&r$.total)){e$.msg="incorrect length check",r$.mode=bK;break}u$=0,l$=0}r$.mode=16208;case 16208:C$=hK;break e;case bK:C$=EK;break e;case 16210:return fK;default:return _K}return e$.next_out=s$,e$.avail_out=c$,e$.next_in=o$,e$.avail_in=a$,r$.hold=u$,r$.bits=l$,(r$.wsize||h$!==e$.avail_out&&r$.mode<bK&&(r$.mode<AK||t$!==cK))&&FK(e$,e$.output,e$.next_out,h$-e$.avail_out),d$-=e$.avail_in,h$-=e$.avail_out,e$.total_in+=d$,e$.total_out+=h$,r$.total+=h$,4&r$.wrap&&h$&&(e$.adler=r$.check=VG$1(r$)?wW$1(r$.check,i$,h$,e$.next_out-h$):AW$1(r$.check,i$,h$,e$.next_out-h$)),e$.data_type=r$.bits+(r$.last?64:0)+(r$.mode===RK?128:0)+(r$.mode===vK||r$.mode===IK?256:0),(d$===0&&h$===0||t$===cK)&&C$===uK&&(C$=mK),C$},jK={inflateReset:PK,inflateReset2:LK,inflateResetKeep:DK,inflateInit:e$=>kK(e$,15),inflateInit2:kK,inflate:BK,inflateEnd:e$=>{if(NK(e$))return _K;let t$=e$.state;return t$.window&&(t$.window=null),e$.state=null,uK},inflateGetHeader:(e$,t$)=>{if(NK(e$))return _K;const r$=e$.state;return 2&r$.wrap?(r$.head=t$,t$.done=!1,uK):_K},inflateSetDictionary:(e$,t$)=>{const r$=t$.length;let n$,i$,o$;return NK(e$)?_K:(n$=e$.state,n$.wrap!==0&&n$.mode!==gK?_K:n$.mode===gK&&(i$=1,i$=AW$1(i$,t$,r$,0),i$!==n$.check)?EK:(o$=FK(e$,t$,r$,r$),o$?(n$.mode=16210,fK):(n$.havedict=1,uK)))},inflateInfo:"pako inflate (from Nodeca project)"},GK=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const WK=Object.prototype.toString,{Z_NO_FLUSH:HK,Z_FINISH:KK,Z_OK:YK,Z_STREAM_END:qK,Z_NEED_DICT:zK,Z_STREAM_ERROR:JK,Z_DATA_ERROR:XK,Z_MEM_ERROR:QK}=NW;function ZK(e$){this.options=UH.assign({chunkSize:65536,windowBits:15,to:""},e$||{});const t$=this.options;t$.raw&&t$.windowBits>=0&&t$.windowBits<16&&(t$.windowBits=-t$.windowBits,t$.windowBits===0&&(t$.windowBits=-15)),!(t$.windowBits>=0&&t$.windowBits<16)||e$&&e$.windowBits||(t$.windowBits+=32),t$.windowBits>15&&t$.windowBits<48&&!(15&t$.windowBits)&&(t$.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new BH,this.strm.avail_out=0;let r$=jK.inflateInit2(this.strm,t$.windowBits);if(r$!==YK)throw new Error(OW$1[r$]);if(this.header=new GK,jK.inflateGetHeader(this.strm,this.header),t$.dictionary&&(typeof t$.dictionary=="string"?t$.dictionary=FH.string2buf(t$.dictionary):WK.call(t$.dictionary)==="[object ArrayBuffer]"&&(t$.dictionary=new Uint8Array(t$.dictionary)),t$.raw&&(r$=jK.inflateSetDictionary(this.strm,t$.dictionary),r$!==YK)))throw new Error(OW$1[r$])}function $K(e$,t$){const r$=new ZK(t$);if(r$.push(e$),r$.err)throw r$.msg||OW$1[r$.err];return r$.result}ZK.prototype.push=function(e$,t$){const r$=this.strm,n$=this.options.chunkSize,i$=this.options.dictionary;let o$,s$,a$;if(this.ended)return!1;for(s$=t$===~~t$?t$:t$===!0?KK:HK,WK.call(e$)==="[object ArrayBuffer]"?r$.input=new Uint8Array(e$):r$.input=e$,r$.next_in=0,r$.avail_in=r$.input.length;;){for(r$.avail_out===0&&(r$.output=new Uint8Array(n$),r$.next_out=0,r$.avail_out=n$),o$=jK.inflate(r$,s$),o$===zK&&i$&&(o$=jK.inflateSetDictionary(r$,i$),o$===YK?o$=jK.inflate(r$,s$):o$===XK&&(o$=zK));r$.avail_in>0&&o$===qK&&r$.state.wrap>0&&e$[r$.next_in]!==0;)jK.inflateReset(r$),o$=jK.inflate(r$,s$);switch(o$){case JK:case XK:case zK:case QK:return this.onEnd(o$),this.ended=!0,!1}if(a$=r$.avail_out,r$.next_out&&(r$.avail_out===0||o$===qK))if(this.options.to==="string"){let c$=FH.utf8border(r$.output,r$.next_out),u$=r$.next_out-c$,l$=FH.buf2string(r$.output,c$);r$.next_out=u$,r$.avail_out=n$-u$,u$&&r$.output.set(r$.output.subarray(c$,c$+u$),0),this.onData(l$)}else this.onData(r$.output.length===r$.next_out?r$.output:r$.output.subarray(0,r$.next_out));if(o$!==YK||a$!==0){if(o$===qK)return o$=jK.inflateEnd(this.strm),this.onEnd(o$),this.ended=!0,!0;if(r$.avail_in===0)break}}return!0},ZK.prototype.onData=function(e$){this.chunks.push(e$)},ZK.prototype.onEnd=function(e$){e$===YK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=UH.flattenChunks(this.chunks)),this.chunks=[],this.err=e$,this.msg=this.strm.msg};var eY={Inflate:ZK,inflate:$K,inflateRaw:function(e$,t$){return(t$=t$||{}).raw=!0,$K(e$,t$)},ungzip:$K,constants:NW};const{Deflate:tY,deflate:iY,deflateRaw:nY,gzip:rY}=$H$1,{Inflate:oY,inflate:sY,inflateRaw:aY,ungzip:cY}=eY;var dY=iY,lY=sY,uY=function(e$){return e$[e$.ONE_BYTE=0]="ONE_BYTE",e$[e$.TWO_BYTE=1]="TWO_BYTE",e$}(uY||{});class hY{constructor(){Fg$1(this,"_sequence",0),Fg$1(this,"_startTime",Date.now()),Fg$1(this,"isUseOneByte",!0)}get startTime(){const t$=Date.now()-this._startTime;return t$<Math.pow(2,16)?t$:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t$){const r$={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t$};if(t$.byteLength>128){const a$=new Uint8Array(4);a$.set([1,0,0,0]);const c$={id:0,length:4,data:a$.buffer},u$={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[c$]};r$.commonPacketHeader.extension=1,r$.extension=u$,r$.payload=this.compress(t$),r$.commonPacketHeader.length=8+(r$.extension.length+2)+r$.payload.byteLength}else r$.commonPacketHeader.length=8+r$.payload.byteLength;XA$1("SHOW_DATASTREAM2_LOG")&&fb$1.debug("send data header: ".concat(JSON.stringify(r$.commonPacketHeader)));const n$=new ArrayBuffer(r$.commonPacketHeader.length),i$=new Uint8Array(n$),o$=new DataView(n$);let s$=0;if(o$.setUint16(s$,r$.commonPacketHeader.extension<<15|r$.commonPacketHeader.reserved<<14|r$.commonPacketHeader.length,!0),s$+=2,o$.setUint32(s$,r$.commonPacketHeader.sequence,!0),s$+=4,o$.setUint16(s$,r$.commonStreamHeader,!0),s$+=2,r$.extension){const a$=this.serializeExtension(r$.extension);i$.set(new Uint8Array(a$),s$),s$+=a$.byteLength}if(i$.set(new Uint8Array(r$.payload),s$),s$+=r$.payload.byteLength,s$!==r$.commonPacketHeader.length)throw Error("serialize error!");return n$}deserialize(t$){if(t$.byteLength<4)return new ArrayBuffer(0);const r$=new DataView(t$);let n$=0;const i$=r$.getUint16(n$,!0);n$+=2;const o$={length:16383&i$,reserved:(16384&i$)>>14,extension:(32768&i$)>>15,sequence:r$.getUint16(n$+2,!0)<<16|r$.getUint16(n$,!0)};let s$,a$;if(n$+=4,XA$1("SHOW_DATASTREAM2_LOG")&&fb$1.debug("receive data header: ".concat(JSON.stringify(o$))),r$.getUint16(n$,!0),n$+=2,o$.extension){a$=this.deserializeExtension(t$.slice(n$)),n$+=2+a$.length,s$=t$.slice(n$);let c$=!1;if(a$.datas.length>0){const u$=a$.datas.find(l$=>l$.id===0);u$&&(c$=(1&new DataView(u$.data).getUint32(0,!0))==1)}s$=c$?this.decompress(s$):s$}else s$=t$.slice(8);return s$}serializeExtension(t$){const{profile:r$,length:n$,datas:i$}=t$,o$=new ArrayBuffer(n$+2),s$=new Uint8Array(o$),a$=new DataView(o$);let c$=0;if(a$.setUint8(c$++,r$),a$.setUint8(c$++,n$),i$.forEach(u$=>{r$?(a$.setUint8(c$++,u$.id),a$.setUint8(c$++,u$.length),s$.set(new Uint8Array(u$.data),c$),c$+=u$.data.byteLength):(a$.setUint8(c$++,u$.id|u$.length<<4),s$.set(new Uint8Array(u$.data),c$),c$+=u$.data.byteLength)}),c$!==n$+2)throw Error("serialize extension error, is ".concat(c$,"!==").concat(n$+2));return o$}deserializeExtension(t$){const r$=new DataView(t$);let n$=0;const i$=r$.getUint8(n$);n$++;const o$=r$.getUint8(n$);n$++;const s$=i$===uY.TWO_BYTE,a$=[],c$=new DataView(t$,2);let u$=0;for(;u$<o$;){let l$=0,d$=0,h$=new ArrayBuffer(0);s$?(l$=c$.getUint8(u$),u$++,d$=c$.getUint8(u$),u$++):(l$=15&c$.getUint8(u$),d$=c$.getUint8(u$)>>4,u$++),d$>0&&(h$=c$.buffer.slice(u$+2,u$+2+d$),u$+=h$.byteLength),a$.push({id:l$,length:d$,data:h$})}if(u$!==o$)throw Error("parse error");return{profile:i$,length:o$,datas:a$}}decompress(t$){return lY(new Uint8Array(t$))}compress(t$){return dY(new Uint8Array(t$))}}const pY={name:"DataStream",create:(e$,t$)=>{const r$=t$?new bU$1(e$):new wU$1(e$);return r$.useDataStream(new hY),r$}};class _Y extends xy$1{constructor(t$,r$,n$){super(),Fg$1(this,"ws",void 0),Fg$1(this,"requestId",1),Fg$1(this,"heartBeatTimer",void 0),Fg$1(this,"joinInfo",void 0),Fg$1(this,"clientId",void 0),Fg$1(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),Fg$1(this,"onClose",i$=>{this.emit("close"),this.dispose()}),Fg$1(this,"onMessage",i$=>{const o$=JSON.parse(i$.data);if(!o$||o$.command!=="serverResponse"||!o$.requestId)return o$&&o$.command==="serverStatus"&&o$.serverStatus&&o$.serverStatus.command?(this.emit("status",o$.serverStatus),void this.emit(o$.serverStatus.command,o$.serverStatus)):void 0;this.emit("req_".concat(o$.requestId),o$)}),this.joinInfo=t$,this.clientId=r$,this.ws=new HO$1("cross-channel-".concat(this.clientId),n$),this.ws.on(Uw$1.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Uw$1.CONNECTED,this.onOpen),this.ws.on(Uw$1.ON_MESSAGE,this.onMessage),this.ws.on(Uw$1.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t$){const r$=this.requestId++;return t$.requestId=r$,t$.seq=r$,this.ws.sendMessage(t$),r$}waitStatus(t$){return new Gh$1((r$,n$)=>{const i$=window.setTimeout(()=>{n$(new yb$1(Ry$1.TIMEOUT,"wait status timeout, status: ".concat(t$)))},5e3);this.once(t$,o$=>{window.clearTimeout(i$),o$.state&&o$.state!==0?n$(new yb$1(Ry$1.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t$))):r$(void 0)}),this.once("dispose",()=>{window.clearTimeout(i$),n$(new yb$1(Ry$1.WS_ABORT))})})}async request(t$){if(this.ws.state==="closed")throw new yb$1(Ry$1.WS_DISCONNECT);const r$=()=>new Gh$1((s$,a$)=>{this.ws.once(Uw$1.CLOSED,()=>a$(new yb$1(Ry$1.WS_ABORT))),this.ws.once(Uw$1.CONNECTED,s$)});this.ws.state!=="connected"&&await r$();const n$=this.sendMessage(t$),i$=new Gh$1((s$,a$)=>{const c$=()=>{a$(new yb$1(Ry$1.WS_ABORT))};this.ws.once(Uw$1.RECONNECTING,c$),this.ws.once(Uw$1.CLOSED,c$),this.once("req_".concat(n$),s$),mA$1(3e3).then(()=>{this.removeAllListeners("req_".concat(n$)),this.ws.off(Uw$1.RECONNECTING,c$),this.ws.off(Uw$1.CLOSED,c$),a$(new yb$1(Ry$1.TIMEOUT,"cross channel ws request timeout"))})}),o$=await i$;if(!o$||o$.code!==200)throw new yb$1(Ry$1.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(o$)));return o$}async connect(t$){this.ws.removeAllListeners(Uw$1.REQUEST_NEW_URLS),this.ws.on(Uw$1.REQUEST_NEW_URLS,r$=>{r$(t$)}),await this.ws.init(t$)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t$){const r$=this.requestId++;return t$.requestId=r$,this.ws.sendMessage(t$),r$}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class EY extends xy$1{set state(t$){t$!==this._state&&(t$!==Xw$1.RELAY_STATE_FAILURE&&(this.errorCode=Qw$1.RELAY_OK),this.emit("state",t$,this.errorCode),this._state=t$)}get state(){return this._state}constructor(t$,r$,n$,i$,o$){super(),Fg$1(this,"joinInfo",void 0),Fg$1(this,"sid",void 0),Fg$1(this,"clientId",void 0),Fg$1(this,"cancelToken",Lv$1.CancelToken.source()),Fg$1(this,"workerToken",void 0),Fg$1(this,"requestId",0),Fg$1(this,"signal",void 0),Fg$1(this,"prevChannelMediaConfig",void 0),Fg$1(this,"httpRetryConfig",void 0),Fg$1(this,"_resolution",void 0),Fg$1(this,"_state",Xw$1.RELAY_STATE_IDLE),Fg$1(this,"errorCode",Qw$1.RELAY_OK),Fg$1(this,"onStatus",s$=>{fb$1.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(s$))),s$&&s$.command&&(s$.command==="onAudioPacketReceived"&&this.emit("event",Jw$1.PACKET_RECEIVED_AUDIO_FROM_SRC),s$.command==="onVideoPacketReceived"&&this.emit("event",Jw$1.PACKET_RECEIVED_VIDEO_FROM_SRC),s$.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Qw$1.SRC_TOKEN_EXPIRED,this.state=Xw$1.RELAY_STATE_FAILURE),s$.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Qw$1.DEST_TOKEN_EXPIRED,this.state=Xw$1.RELAY_STATE_FAILURE))}),Fg$1(this,"onReconnect",async()=>{fb$1.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Jw$1.NETWORK_DISCONNECTED),this.state=Xw$1.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(s$=>{this.state!==Xw$1.RELAY_STATE_IDLE&&(fb$1.error("auto restart channel media relay failed",s$.toString()),this.errorCode=Qw$1.SERVER_CONNECTION_LOST,this.state=Xw$1.RELAY_STATE_FAILURE)})}),this.joinInfo=t$,this.clientId=r$,this.sid=SA$1(),this.signal=new _Y(this.joinInfo,this.clientId,n$),this.httpRetryConfig=i$,this._resolution=o$}async startChannelMediaRelay(t$){if(this.state!==Xw$1.RELAY_STATE_IDLE)throw new yb$1(Ry$1.INVALID_OPERATION);this.state=Xw$1.RELAY_STATE_CONNECTING,await this.connect(),fb$1.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t$)}catch(r$){throw r$.data&&r$.data.serverResponse&&r$.data.serverResponse.command==="SetSourceChannel"?new yb$1(Ry$1.CROSS_CHANNEL_FAILED_JOIN_SRC):r$.data&&r$.data.serverResponse&&r$.serverResponse.command==="SetDestChannelStatus"?new yb$1(Ry$1.CROSS_CHANNEL_FAILED_JOIN_DEST):r$.data&&r$.data.serverResponse&&r$.serverResponse.command==="StartPacketTransfer"?new yb$1(Ry$1.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):r$}this.prevChannelMediaConfig=t$}async updateChannelMediaRelay(t$){if(this.state!==Xw$1.RELAY_STATE_RUNNING)throw new yb$1(Ry$1.INVALID_OPERATION);await this.sendUpdateMessage(t$),this.prevChannelMediaConfig=t$}async setVideoProfile(t$){if(this._resolution=t$,this.state!==Xw$1.RELAY_STATE_RUNNING)throw new yb$1(Ry$1.INVALID_OPERATION);const r$=this.genMessage(zw$1.SetVideoProfile);await this.signal.request(r$),fb$1.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),fb$1.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Xw$1.RELAY_STATE_IDLE,this.dispose()}dispose(){fb$1.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Lv$1.CancelToken.source(),this.state=Xw$1.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t$=await Qx$1(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t$.workerToken,await this.signal.connect(t$.addressList),this.emit("event",Jw$1.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t$){const r$=this.genMessage(zw$1.StopPacketTransfer);await this.signal.request(r$),await this.signal.waitStatus("Normal Quit"),fb$1.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const n$=this.genMessage(zw$1.SetSdkProfile,t$);await this.signal.request(n$),fb$1.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i$=this.genMessage(zw$1.SetSourceChannel,t$);await this.signal.request(i$),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Jw$1.PACKET_JOINED_SRC_CHANNEL),fb$1.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const o$=this.genMessage(zw$1.SetSourceUserId,t$);await this.signal.request(o$),fb$1.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const s$=this.genMessage(zw$1.SetDestChannel,t$);await this.signal.request(s$),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Jw$1.PACKET_JOINED_DEST_CHANNEL),fb$1.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const a$=this.genMessage(zw$1.StartPacketTransfer,t$);await this.signal.request(a$),this.emit("event",Jw$1.PACKET_SENT_TO_DEST_CHANNEL),this.state=Xw$1.RELAY_STATE_RUNNING,fb$1.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t$){const r$=this.genMessage(zw$1.UpdateDestChannel,t$);await this.signal.request(r$),this.emit("event",Jw$1.PACKET_UPDATE_DEST_CHANNEL),fb$1.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t$=this.genMessage(zw$1.StopPacketTransfer);await this.signal.request(t$),fb$1.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t$,r$){const n$=[],i$=[],o$=[];this.requestId+=1;const s$={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:GA$1,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};s$.sdkVersion==="4.22.1"&&(s$.sdkVersion="0.0.1");let a$=null,c$=null;switch(t$){case zw$1.SetSdkProfile:return s$.clientRequest={command:"SetSdkProfile",type:"multi_channel"},s$;case zw$1.SetSourceChannel:if(c$=r$&&r$.getSrcChannelMediaInfo(),!c$)throw new yb$1(Ry$1.UNEXPECTED_ERROR,"can not find source config");return s$.clientRequest={command:"SetSourceChannel",uid:"0",channelName:c$.channelName,token:c$.token||this.joinInfo.appId},s$;case zw$1.SetSourceUserId:if(c$=r$&&r$.getSrcChannelMediaInfo(),!c$)throw new yb$1(Ry$1.UNEXPECTED_ERROR,"can not find source config");return s$.clientRequest={command:"SetSourceUserId",uid:c$.uid+""},s$;case zw$1.SetDestChannel:if(a$=r$&&r$.getDestChannelMediaInfo(),!a$)throw new yb$1(Ry$1.UNEXPECTED_ERROR,"can not find dest config");return a$.forEach(u$=>{n$.push(u$.channelName),i$.push(u$.uid+""),o$.push(u$.token||this.joinInfo.appId)}),s$.clientRequest={command:"SetDestChannel",channelName:n$,uid:i$,token:o$},s$;case zw$1.StartPacketTransfer:return s$.clientRequest={command:"StartPacketTransfer"},s$;case zw$1.Reconnect:return s$.clientRequest={command:"Reconnect"},s$;case zw$1.StopPacketTransfer:return s$.clientRequest={command:"StopPacketTransfer"},s$;case zw$1.UpdateDestChannel:if(a$=r$&&r$.getDestChannelMediaInfo(),!a$)throw new yb$1(Ry$1.UNEXPECTED_ERROR,"can not find dest config");return a$.forEach(u$=>{n$.push(u$.channelName),i$.push(u$.uid+""),o$.push(u$.token||this.joinInfo.appId)}),s$.clientRequest={command:"UpdateDestChannel",channelName:n$,uid:i$,token:o$},s$;case zw$1.SetVideoProfile:s$.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return s$}}const fY={name:"ChannelMediaRelay",create:function(e$){return new EY(e$.joinInfo,e$.clientId,e$.websocketRetryConfig||PA$1,e$.httpRetryConfig||PA$1,e$.resolution)}};function mY(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function TY(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?mY(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):mY(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}class SY extends xy$1{constructor(t$,r$,n$,i$){super(),Fg$1(this,"spec",void 0),Fg$1(this,"token",void 0),Fg$1(this,"websocket",void 0),Fg$1(this,"pingpongTimer",void 0),Fg$1(this,"reconnectMode","retry"),Fg$1(this,"serviceMode",void 0),Fg$1(this,"reqId",0),Fg$1(this,"commandReqId",0),Fg$1(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),Fg$1(this,"handleWebSocketMessage",o$=>{if(!o$.data)return;const s$=JSON.parse(o$.data);s$.requestId?this.emit("@".concat(s$.requestId,"-").concat(s$.sid),s$):(vb$1.workerEvent(this.spec.sid,{actionType:"status",serverCode:s$.code,workerType:this.serviceMode===Fw$1.TRANSCODE?1:2}),this.emit(Hw$1.PUBLISH_STREAM_STATUS,s$))}),this.spec=r$,this.token=t$,this.serviceMode=i$,this.websocket=new HO$1("live-streaming",n$),this.websocket.on(Uw$1.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Uw$1.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Uw$1.REQUEST_NEW_URLS,(o$,s$)=>{Zy$1(this,Hw$1.REQUEST_NEW_ADDRESS).then(o$).catch(s$)}),this.websocket.on(Uw$1.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t$){return this.websocket.init(t$)}async request(t$,r$,n$,i$){this.reqId+=1,t$==="request"&&(this.commandReqId+=1);const o$=this.commandReqId,s$=this.reqId;if(!s$||!this.websocket)throw new yb$1(Ry$1.UNEXPECTED_ERROR);const a$=TY({command:t$,sdkVersion:GA$1==="4.22.1"?"0.0.1":GA$1,seq:s$,requestId:s$,allocate:n$,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r$);if(this.websocket.state==="closed")throw new yb$1(Ry$1.WS_DISCONNECT);const c$=()=>new Gh$1((h$,p$)=>{this.websocket.once(Uw$1.CLOSED,()=>p$(new yb$1(Ry$1.WS_ABORT))),this.websocket.once(Uw$1.CONNECTED,h$)});this.websocket.state!=="connected"&&await c$(),a$.clientRequest&&(a$.clientRequest.workerToken=this.token);const u$=new Gh$1((h$,p$)=>{const _$=()=>{p$(new yb$1(Ry$1.WS_ABORT))};this.websocket.once(Uw$1.RECONNECTING,_$),this.websocket.once(Uw$1.CLOSED,_$),this.once("@".concat(s$,"-").concat(this.spec.sid),f$=>{h$(f$)})});i$&&vb$1.workerEvent(this.spec.sid,TY(TY({},i$),{},{requestId:o$,actionType:"request",payload:JSON.stringify(r$.clientRequest),serverCode:0,code:0}));const l$=Date.now();this.websocket.sendMessage(a$);let d$=null;try{d$=await u$}catch(h$){if(this.websocket.state==="closed")throw h$;return await c$(),await this.request(t$,r$,n$)}return i$&&vb$1.workerEvent(this.spec.sid,TY(TY({},i$),{},{requestId:o$,actionType:"response",payload:JSON.stringify(d$.serverResponse),serverCode:d$.code,success:d$.code===200,responseTime:Date.now()-l$})),d$.code!==200&&this.handleResponseError(d$),d$}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t$=GA$1==="4.22.1"?"0.0.1":GA$1;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t$,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t$){switch(t$.code){case Yw$1.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void fb$1.warning("live stream response already exists stream");case Yw$1.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Yw$1.LIVE_STREAM_RESPONSE_BAD_STREAM:case Yw$1.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new yb$1(Ry$1.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t$.code}).throw();case Yw$1.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t$.serverResponse.command==="UnpublishStream")return;throw new yb$1(Ry$1.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Yw$1.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new yb$1(Ry$1.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t$.code}).throw();case Yw$1.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const r$=new yb$1(Ry$1.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Hw$1.WARNING,r$,t$.serverResponse.url)}case Yw$1.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const r$=new yb$1(Ry$1.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Hw$1.WARNING,r$,t$.serverResponse.url)}case Yw$1.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new yb$1(Ry$1.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Yw$1.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new yb$1(Ry$1.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t$.code}).throw();case Yw$1.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const r$=new yb$1(Ry$1.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Hw$1.WARNING,r$,t$.serverResponse.url)}case Yw$1.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new yb$1(Ry$1.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t$.code}).throw();case Yw$1.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new yb$1(Ry$1.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Yw$1.LIVE_STREAM_RESPONSE_WORKER_LOST:case Yw$1.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t$.serverResponse.command==="UnpublishStream")return;throw new yb$1(Ry$1.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Yw$1.ERROR_FAIL_SEND_MESSAGE:if(t$.serverResponse.command==="UnpublishStream")return;if(t$.serverResponse.command==="UpdateTranscoding"||t$.serverResponse.command==="ControlStream")return new yb$1(Ry$1.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t$.code}).throw();throw new yb$1(Ry$1.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Yw$1.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Yw$1.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Yw$1.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Yw$1.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new yb$1(Ry$1.LIVE_STREAMING_CDN_ERROR,"",{code:t$.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(gA$1)},6e3)}}function gY(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function RY(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?gY(Object(r$),!0).forEach(function(n$){Fg$1(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):gY(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}class CY extends xy$1{constructor(t$){let r$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:PA$1,n$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:PA$1;super(),Fg$1(this,"onLiveStreamWarning",void 0),Fg$1(this,"onLiveStreamError",void 0),Fg$1(this,"spec",void 0),Fg$1(this,"retryTimeout",1e4),Fg$1(this,"connection",void 0),Fg$1(this,"httpRetryConfig",void 0),Fg$1(this,"wsRetryConfig",void 0),Fg$1(this,"streamingTasks",new Map),Fg$1(this,"isStartingStreamingTask",!1),Fg$1(this,"taskMutex",new NA$1("live-streaming")),Fg$1(this,"cancelToken",Lv$1.CancelToken.source()),Fg$1(this,"transcodingConfig",void 0),Fg$1(this,"uapResponse",void 0),Fg$1(this,"lastTaskId",1),Fg$1(this,"statusError",new Map),this.spec=t$,this.httpRetryConfig=n$,this.wsRetryConfig=r$}async setTranscodingConfig(t$){const r$=RY(RY({},Ww$1),t$);r$.videoCodecProfile!==66&&r$.videoCodecProfile!==77&&r$.videoCodecProfile!==100&&(fb$1.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(r$.videoCodecProfile," -> 100")),r$.videoCodecProfile=100),r$.transcodingUsers||(r$.transcodingUsers=r$.userConfigs),r$.transcodingUsers&&(r$.transcodingUsers=r$.transcodingUsers.map(s$=>RY(RY(RY({},Bw$1),s$),{},{zOrder:s$.zOrder?s$.zOrder+1:1}))),function(s$){Oy$1(s$.width)||yy$1(s$.width,"config.width",0,1e4),Oy$1(s$.height)||yy$1(s$.height,"config.height",0,1e4),Oy$1(s$.videoBitrate)||yy$1(s$.videoBitrate,"config.videoBitrate",1,1e6),Oy$1(s$.videoFrameRate)||yy$1(s$.videoFrameRate,"config.videoFrameRate"),Oy$1(s$.lowLatency)||Iy$1(s$.lowLatency,"config.lowLatency"),Oy$1(s$.audioSampleRate)||vy$1(s$.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Oy$1(s$.audioBitrate)||yy$1(s$.audioBitrate,"config.audioBitrate",1,128),Oy$1(s$.audioChannels)||vy$1(s$.audioChannels,"config.audioChannels",[1,2,3,4,5]),Oy$1(s$.videoGop)||yy$1(s$.videoGop,"config.videoGop"),Oy$1(s$.videoCodecProfile)||vy$1(s$.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Oy$1(s$.userCount)||yy$1(s$.userCount,"config.userCount",0,17),Oy$1(s$.backgroundColor)||yy$1(s$.backgroundColor,"config.backgroundColor",0,16777215),Oy$1(s$.userConfigExtraInfo)||by$1(s$.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),s$.transcodingUsers&&!Oy$1(s$.transcodingUsers)&&(wy$1(s$.transcodingUsers,"config.transcodingUsers"),s$.transcodingUsers.forEach((a$,c$)=>{Vw$1(a$.uid),Oy$1(a$.x)||yy$1(a$.x,"transcodingUser[".concat(c$,"].x"),0,1e4),Oy$1(a$.y)||yy$1(a$.y,"transcodingUser[".concat(c$,"].y"),0,1e4),Oy$1(a$.width)||yy$1(a$.width,"transcodingUser[".concat(c$,"].width"),0,1e4),Oy$1(a$.height)||yy$1(a$.height,"transcodingUser[".concat(c$,"].height"),0,1e4),Oy$1(a$.zOrder)||yy$1(a$.zOrder-1,"transcodingUser[".concat(c$,"].zOrder"),0,100),Oy$1(a$.alpha)||yy$1(a$.alpha,"transcodingUser[".concat(c$,"].alpha"),0,1,!1)})),Oy$1(s$.watermark)||Gw$1(s$.watermark,"watermark"),Oy$1(s$.backgroundImage)||Gw$1(s$.backgroundImage,"backgroundImage"),s$.images&&!Oy$1(s$.images)&&(wy$1(s$.images,"config.images"),s$.images.forEach((a$,c$)=>{Gw$1(a$,"images[".concat(c$,"]"))}))}(r$);const n$=[];r$.images&&n$.push(...r$.images.map(s$=>RY(RY(RY({},jw$1),s$),{},{zOrder:255}))),r$.backgroundImage&&(n$.push(RY(RY(RY({},jw$1),r$.backgroundImage),{},{zOrder:0})),delete r$.backgroundImage),r$.watermark&&(n$.push(RY(RY(RY({},jw$1),r$.watermark),{},{zOrder:255})),delete r$.watermark),r$.images=n$,r$.transcodingUsers&&(r$.userConfigs=r$.transcodingUsers.map(s$=>RY({},s$)),r$.userCount=r$.transcodingUsers.length,delete r$.transcodingUsers);const i$=(r$.userConfigs||[]).map(s$=>typeof s$.uid=="number"?Gh$1.resolve(s$.uid):Yx$1(s$.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Gh$1.all(i$)).forEach((s$,a$)=>{r$.userConfigs&&r$.userConfigs[a$]&&(r$.userConfigs[a$].uid=s$)}),this.transcodingConfig=r$,this.connection)try{var o$;const s$=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(_N(o$=this.streamingTasks).call(o$)).map(a$=>a$.taskId).join("#")});fb$1.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(s$.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(s$){if(!s$.data||!s$.data.retry)throw s$;s$.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(a$=>{fb$1.warning("[".concat(this.spec.clientId,"] live streaming receive error"),s$.toString(),"try to republish",a$.url),this.startLiveStreamingTask(a$.url,a$.mode,s$).then(()=>{fb$1.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(a$.url," success"))}).catch(c$=>{fb$1.error("[".concat(this.spec.clientId,"] live streaming republish failed"),a$.url,c$.toString()),this.onLiveStreamError&&this.onLiveStreamError(a$.url,c$)})})}}async startLiveStreamingTask(t$,r$,n$){if(!this.transcodingConfig&&r$===Fw$1.TRANSCODE)throw new yb$1(Ry$1.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const i$={command:"PublishStream",ts:Date.now(),url:t$,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};fb$1.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t$,", mode: ").concat(r$));const o$=await this.taskMutex.lock();if(!this.connection&&n$)return void o$();if(this.streamingTasks.get(t$)&&!n$)return o$(),new yb$1(Ry$1.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(r$))}catch(a$){throw o$(),a$}switch(r$){case Fw$1.TRANSCODE:i$.transcodingConfig=RY({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(i$.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const s$=this.lastTaskId++;try{const a$=new Gh$1((u$,l$)=>{mA$1(this.retryTimeout).then(()=>{if(n$)return l$(n$);const d$=this.statusError.get(t$);return d$?(this.statusError.delete(t$),l$(d$)):void 0})}),c$=await Gh$1.race([this.connection.request("request",{clientRequest:i$},!0,{url:t$,command:"PublishStream",workerType:r$===Fw$1.TRANSCODE?1:2,requestByUser:!n$,tid:s$.toString()}),a$]);this.isStartingStreamingTask=!1,fb$1.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(c$.code)),this.streamingTasks.set(t$,{clientRequest:i$,mode:r$,url:t$,taskId:s$}),o$()}catch(a$){if(o$(),this.isStartingStreamingTask=!1,!a$.data||!a$.data.retry||n$)throw a$;return a$.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t$,r$,a$)):await this.startLiveStreamingTask(t$,r$,a$)}}stopLiveStreamingTask(t$){return new Gh$1((r$,n$)=>{const i$=this.streamingTasks.get(t$);if(!i$||!this.connection)return new yb$1(Ry$1.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const o$=i$.mode;i$.abortTask=()=>{fb$1.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t$),r$()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i$.url}},!1,{url:t$,command:"UnPublishStream",workerType:o$===Fw$1.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(s$=>{fb$1.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(s$.code)),this.streamingTasks.delete(t$),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),r$()}).catch(n$)})}resetAllTask(){var t$;const r$=Array.from(_N(t$=this.streamingTasks).call(t$));this.terminate();for(const n$ of r$)this.startLiveStreamingTask(n$.url,n$.mode).catch(i$=>{this.onLiveStreamError&&this.onLiveStreamError(n$.url,i$)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Lv$1.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t$){if(this.connection)throw new yb$1(Ry$1.UNEXPECTED_ERROR,"live streaming connection has already connected");const r$=await Zy$1(this,Kw$1.REQUEST_WORKER_MANAGER_LIST,t$);return this.uapResponse=r$,this.connection=new SY(r$.workerToken,this.spec,this.wsRetryConfig,t$),this.connection.on(Hw$1.WARNING,(n$,i$)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i$,n$)),this.connection.on(Hw$1.PUBLISH_STREAM_STATUS,n$=>this.handlePublishStreamServer(n$)),this.connection.on(Hw$1.REQUEST_NEW_ADDRESS,(n$,i$)=>{if(!this.connection)return i$(new yb$1(Ry$1.UNEXPECTED_ERROR,"can not get new live streaming address list"));Zy$1(this,Kw$1.REQUEST_WORKER_MANAGER_LIST,t$).then(o$=>{this.uapResponse=o$,n$(o$.addressList)}).catch(i$)}),await this.connection.init(r$.addressList),this.connection}handlePublishStreamServer(t$){const r$=t$.serverStatus&&t$.serverStatus.url||"empty_url",n$=this.streamingTasks.get(r$),i$=t$.reason;switch(t$.code){case Yw$1.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Yw$1.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Yw$1.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Yw$1.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const s$=new yb$1(Ry$1.LIVE_STREAMING_CDN_ERROR,"",{code:t$.code});if(n$)return fb$1.error(s$.toString()),this.onLiveStreamError&&this.onLiveStreamError(r$,s$);if(!this.isStartingStreamingTask)return;this.statusError.set(r$,s$)}case Yw$1.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s$=new yb$1(Ry$1.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i$);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r$,s$)}case Yw$1.LIVE_STREAM_RESPONSE_WORKER_LOST:case Yw$1.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var o$;if(!this.connection)return;this.connection.tryNextAddress();const s$=Array.from(_N(o$=this.streamingTasks).call(o$));for(const a$ of s$)a$.abortTask?a$.abortTask():(fb$1.warning("[".concat(this.spec.clientId,"] publish stream status code"),t$.code,"try to republish",a$.url),this.startLiveStreamingTask(a$.url,a$.mode,new yb$1(Ry$1.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t$.code})).then(()=>{fb$1.debug("[".concat(this.spec.clientId,"] republish live stream success"),a$.url)}).catch(c$=>{fb$1.error(c$.toString()),this.onLiveStreamError&&this.onLiveStreamError(a$.url,c$)}));return}}}hasUrl(t$){return this.streamingTasks.has(t$)}}const IY={name:"LiveStreaming",create:function(e$){return new CY(e$.joinInfo,e$.websocketRetryConfig||PA$1,e$.httpRetryConfig||PA$1)}};function vY(e$){let t$=MY();return function(r$,n$){let i$=r$.appId;i$!==void 0&&(JY(n$,10),GY(n$,i$));let o$=r$.cid;o$!==void 0&&(JY(n$,16),JY(n$,o$));let s$=r$.cname;s$!==void 0&&(JY(n$,26),GY(n$,s$));let a$=r$.deviceId;a$!==void 0&&(JY(n$,34),GY(n$,a$));let c$=r$.elapse;c$!==void 0&&(JY(n$,40),XY(n$,c$));let u$=r$.fileSize;u$!==void 0&&(JY(n$,48),XY(n$,LY(u$)));let l$=r$.height;l$!==void 0&&(JY(n$,56),XY(n$,LY(l$)));let d$=r$.jpg;d$!==void 0&&(JY(n$,66),JY(n$,d$.length),function(V$,A$){let I$=FY(V$,A$.length);V$.bytes.set(A$,I$)}(n$,d$));let h$=r$.networkType;h$!==void 0&&(JY(n$,72),XY(n$,LY(h$)));let p$=r$.osType;p$!==void 0&&(JY(n$,80),XY(n$,LY(p$)));let _$=r$.requestId;_$!==void 0&&(JY(n$,90),GY(n$,_$));let f$=r$.sdkVersion;f$!==void 0&&(JY(n$,98),GY(n$,f$));let m$=r$.sequence;m$!==void 0&&(JY(n$,104),XY(n$,LY(m$)));let g$=r$.sid;g$!==void 0&&(JY(n$,114),GY(n$,g$));let v$=r$.timestamp;v$!==void 0&&(JY(n$,120),XY(n$,v$));let y$=r$.uid;y$!==void 0&&(JY(n$,128),JY(n$,y$));let S$=r$.vid;S$!==void 0&&(JY(n$,136),JY(n$,S$));let b$=r$.width;b$!==void 0&&(JY(n$,144),XY(n$,LY(b$)));let $$=r$.service;$$!==void 0&&(JY(n$,152),JY(n$,$$));let C$=r$.callbackData;C$!==void 0&&(JY(n$,162),GY(n$,C$));let N$=r$.jpgEncryption;N$!==void 0&&(JY(n$,168),JY(n$,N$));let k$=r$.requestType;k$!==void 0&&(JY(n$,176),JY(n$,k$));let O$=r$.scorePorn;O$!==void 0&&(JY(n$,185),qY(n$,O$));let U$=r$.scoreSexy;U$!==void 0&&(JY(n$,193),qY(n$,U$));let x$=r$.scoreNeutral;x$!==void 0&&(JY(n$,201),qY(n$,x$));let F$=r$.scene;F$!==void 0&&(JY(n$,208),JY(n$,F$));let L$=r$.ossFilePrefix;L$!==void 0&&(JY(n$,218),GY(n$,L$));let M$=r$.serviceVendor;if(M$!==void 0)for(let V$ of M$){JY(n$,226);let A$=MY();bY(V$,A$),JY(n$,A$.limit),WY(n$,A$),UY(A$)}}(e$,t$),function(r$){let n$=r$.bytes,i$=r$.limit;return n$.length===i$?n$:n$.subarray(0,i$)}(t$)}function yY(e$){return function(r$){let n$={};e:for(;!VY(r$);){let i$=zY(r$);switch(i$>>>3){case 0:break e;case 1:n$.code=zY(r$);break;case 2:n$.msg=jY(r$,zY(r$));break;case 3:{let o$=wY(r$);n$.data=AY(r$),r$.limit=o$;break}default:OY(r$,7&i$)}}return n$}({bytes:t$=e$,offset:0,limit:t$.length});var t$}function AY(e$){let t$={};e:for(;!VY(e$);){let r$=zY(e$);switch(r$>>>3){case 0:break e;case 1:t$.requestId=jY(e$,zY(e$));break;case 2:t$.requestType=zY(e$)>>>0;break;case 3:t$.scorePorn=YY(e$);break;case 4:t$.scoreSexy=YY(e$);break;case 5:t$.scoreNeutral=YY(e$);break;case 6:t$.requestScene=zY(e$)>>>0;break;case 7:t$.scene=zY(e$)>>>0;break;default:OY(e$,7&r$)}}return t$}function bY(e$,t$){let r$=e$.service;r$!==void 0&&(JY(t$,8),JY(t$,r$));let n$=e$.vendor;n$!==void 0&&(JY(t$,16),JY(t$,n$));let i$=e$.token;i$!==void 0&&(JY(t$,26),GY(t$,i$));let o$=e$.callbackUrl;o$!==void 0&&(JY(t$,34),GY(t$,o$))}function wY(e$){let t$=zY(e$),r$=e$.limit;return e$.limit=e$.offset+t$,r$}function OY(e$,t$){switch(t$){case 0:for(;128&HY(e$););break;case 2:xY(e$,zY(e$));break;case 5:xY(e$,4);break;case 1:xY(e$,8);break;default:throw new Error("Unimplemented type: "+t$)}}let NY=new Float32Array(1);new Uint8Array(NY.buffer);let DY=new Float64Array(1),PY=new Uint8Array(DY.buffer);function LY(e$){return{low:e$|=0,high:e$>>31,unsigned:e$>=0}}let kY=[];function MY(){const e$=kY.pop();return e$?(e$.offset=e$.limit=0,e$):{bytes:new Uint8Array(64),offset:0,limit:0}}function UY(e$){kY.push(e$)}function xY(e$,t$){if(e$.offset+t$>e$.limit)throw new Error("Skip past limit");e$.offset+=t$}function VY(e$){return e$.offset>=e$.limit}function FY(e$,t$){let r$=e$.bytes,n$=e$.offset,i$=e$.limit,o$=n$+t$;if(o$>r$.length){let s$=new Uint8Array(2*o$);s$.set(r$),e$.bytes=s$}return e$.offset=o$,o$>i$&&(e$.limit=o$),n$}function BY(e$,t$){let r$=e$.offset;if(r$+t$>e$.limit)throw new Error("Read past limit");return e$.offset+=t$,r$}function jY(e$,t$){let r$=BY(e$,t$),n$=String.fromCharCode,i$=e$.bytes,o$="",s$="";for(let a$=0;a$<t$;a$++){let c$,u$,l$,d$,h$=i$[a$+r$];128&h$?(224&h$)==192?a$+1>=t$?s$+=o$:(c$=i$[a$+r$+1],(192&c$)!=128?s$+=o$:(d$=(31&h$)<<6|63&c$,d$<128?s$+=o$:(s$+=n$(d$),a$++))):(240&h$)==224?a$+2>=t$?s$+=o$:(c$=i$[a$+r$+1],u$=i$[a$+r$+2],(49344&(c$|u$<<8))!=32896?s$+=o$:(d$=(15&h$)<<12|(63&c$)<<6|63&u$,d$<2048||d$>=55296&&d$<=57343?s$+=o$:(s$+=n$(d$),a$+=2))):(248&h$)==240?a$+3>=t$?s$+=o$:(c$=i$[a$+r$+1],u$=i$[a$+r$+2],l$=i$[a$+r$+3],(12632256&(c$|u$<<8|l$<<16))!=8421504?s$+=o$:(d$=(7&h$)<<18|(63&c$)<<12|(63&u$)<<6|63&l$,d$<65536||d$>1114111?s$+=o$:(d$-=65536,s$+=n$(55296+(d$>>10),56320+(1023&d$)),a$+=3))):s$+=o$:s$+=n$(h$)}return s$}function GY(e$,t$){let r$=t$.length,n$=0;for(let s$=0;s$<r$;s$++){let a$=t$.charCodeAt(s$);a$>=55296&&a$<=56319&&s$+1<r$&&(a$=(a$<<10)+t$.charCodeAt(++s$)-56613888),n$+=a$<128?1:a$<2048?2:a$<65536?3:4}JY(e$,n$);let i$=FY(e$,n$),o$=e$.bytes;for(let s$=0;s$<r$;s$++){let a$=t$.charCodeAt(s$);a$>=55296&&a$<=56319&&s$+1<r$&&(a$=(a$<<10)+t$.charCodeAt(++s$)-56613888),a$<128?o$[i$++]=a$:(a$<2048?o$[i$++]=a$>>6&31|192:(a$<65536?o$[i$++]=a$>>12&15|224:(o$[i$++]=a$>>18&7|240,o$[i$++]=a$>>12&63|128),o$[i$++]=a$>>6&63|128),o$[i$++]=63&a$|128)}}function WY(e$,t$){let r$=FY(e$,t$.limit),n$=e$.bytes,i$=t$.bytes;for(let o$=0,s$=t$.limit;o$<s$;o$++)n$[o$+r$]=i$[o$]}function HY(e$){return e$.bytes[BY(e$,1)]}function KY(e$,t$){let r$=FY(e$,1);e$.bytes[r$]=t$}function YY(e$){let t$=BY(e$,8),r$=e$.bytes;return PY[0]=r$[t$++],PY[1]=r$[t$++],PY[2]=r$[t$++],PY[3]=r$[t$++],PY[4]=r$[t$++],PY[5]=r$[t$++],PY[6]=r$[t$++],PY[7]=r$[t$++],DY[0]}function qY(e$,t$){let r$=FY(e$,8),n$=e$.bytes;DY[0]=t$,n$[r$++]=PY[0],n$[r$++]=PY[1],n$[r$++]=PY[2],n$[r$++]=PY[3],n$[r$++]=PY[4],n$[r$++]=PY[5],n$[r$++]=PY[6],n$[r$++]=PY[7]}function zY(e$){let t$,r$=0,n$=0;do t$=HY(e$),r$<32&&(n$|=(127&t$)<<r$),r$+=7;while(128&t$);return n$}function JY(e$,t$){for(t$>>>=0;t$>=128;)KY(e$,127&t$|128),t$>>>=7;KY(e$,t$)}function XY(e$,t$){let r$=t$.low>>>0,n$=(t$.low>>>28|t$.high<<4)>>>0,i$=t$.high>>>24,o$=i$===0?n$===0?r$<16384?r$<128?1:2:r$<1<<21?3:4:n$<16384?n$<128?5:6:n$<1<<21?7:8:i$<128?9:10,s$=FY(e$,o$),a$=e$.bytes;switch(o$){case 10:a$[s$+9]=i$>>>7&1;case 9:a$[s$+8]=o$!==9?128|i$:127&i$;case 8:a$[s$+7]=o$!==8?n$>>>21|128:n$>>>21&127;case 7:a$[s$+6]=o$!==7?n$>>>14|128:n$>>>14&127;case 6:a$[s$+5]=o$!==6?n$>>>7|128:n$>>>7&127;case 5:a$[s$+4]=o$!==5?128|n$:127&n$;case 4:a$[s$+3]=o$!==4?r$>>>21|128:r$>>>21&127;case 3:a$[s$+2]=o$!==3?r$>>>14|128:r$>>>14&127;case 2:a$[s$+1]=o$!==2?r$>>>7|128:r$>>>7&127;case 1:a$[s$]=o$!==1?128|r$:127&r$}}function QY(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}const ZY=new Map([["moderation",1],["supervise",2]]);function $Y(e$){return{low:e$|=0,high:e$>>31,unsigned:e$>=0}}class eq extends xy$1{get connectionState(){return this._connectionState}set connectionState(t$){if(this._connectionState===t$)return;const r$=this._connectionState;this._connectionState=t$,this.emit(mO$1.CONNECTION_STATE_CHANGE,r$,t$)}get inspectType(){return this._inspectType}set inspectType(t$){var r$;this._inspectMode=Jn$1(r$=t$.map(n$=>ZY.get(n$)||0)).call(r$,(n$,i$)=>n$+i$),this._inspectType=t$}get quality(){return this._quality}set quality(t$){this._quality=t$>1?1:t$<.1?.1:t$,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t$){super(),Fg$1(this,"name","AgoraRTCVideoContentInspect"),Fg$1(this,"_connectionState",EO$1.CONNECTING),Fg$1(this,"_innerConnectionState",void 0),Fg$1(this,"sequence",0),Fg$1(this,"inspectStartTime",void 0),Fg$1(this,"workerManagerConnection",void 0),Fg$1(this,"workerConnection",void 0),Fg$1(this,"workerMessageLengthLimit",void 0),Fg$1(this,"inspectIntervalMinimum",void 0),Fg$1(this,"qualityRatio",void 0),Fg$1(this,"_connectInfo",void 0),Fg$1(this,"_cancelTokenSource",Lv$1.CancelToken.source()),Fg$1(this,"_retryConfig",void 0),Fg$1(this,"wmSequence",0),Fg$1(this,"inspectInterval",void 0),Fg$1(this,"inspectTimer",null),Fg$1(this,"ossFilePrefix",void 0),Fg$1(this,"extraInfo",void 0),Fg$1(this,"_inspectType",void 0),Fg$1(this,"_inspectMode",void 0),Fg$1(this,"_quality",1),Fg$1(this,"qualityTimer",null),Fg$1(this,"_inspectId",void 0),Fg$1(this,"_needWorkUrlOnly",!1),Fg$1(this,"inspectImage",()=>{if(this.connectionState!==EO$1.CONNECTED)throw new yb$1(Ry$1.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===EO$1.CONNECTED?this.requestToInspectImage():fb$1.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=TA$1(5,"inspect-"),this.workerMessageLengthLimit=XA$1("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=XA$1("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=XA$1("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t$.interval,this.ossFilePrefix=t$.ossFilePrefix,this.extraInfo=t$.extraInfo,this.inspectType=t$.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new HO$1("worker-manager-"+this._inspectId,PA$1),this.on(mO$1.STATE_CHANGE,(r$,n$)=>{this._innerConnectionState=r$,fb$1.debug("[".concat(this._inspectId,"] Inspect operation :").concat(fO$1[r$]," ").concat(n$||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new HO$1("worker-"+this._inspectId,PA$1),this.handleWorkerEvents()}async init(t$,r$){this.emit(mO$1.STATE_CHANGE,fO$1.CONNECT_AP),this._connectInfo=t$;const n$=this._cancelTokenSource.token;return this._retryConfig=r$,new Gh$1((i$,o$)=>{this.on(mO$1.CONNECTION_STATE_CHANGE,(s$,a$)=>{a$===EO$1.CONNECTED&&i$()}),this.requestAP(t$,n$,r$).then(s$=>{this.connectWorkerManager(s$)}).catch(s$=>{o$(s$)})})}async requestAP(t$,r$,n$){const i$=XA$1("WEBCS_DOMAIN").map(a$=>"https://".concat(a$,"/api/v1")),o$=await function(a$,c$,u$,l$){let{appId:d$,areaCode:h$,cname:p$,sid:_$,token:f$,uid:m$}=c$;Bx$1++;const g$="image_moderation_api",v$={service_name:g$,json_body:JSON.stringify({appId:d$,areaCode:h$,cname:p$,command:"allocateEdge",requestId:Bx$1,seq:Bx$1,sid:_$,token:f$,ts:Date.now(),uid:m$+""})};let y$,S$,b$=a$[0];return kA$1(async()=>{y$=Date.now();const $$=await Tx$1(b$,{data:v$,cancelToken:u$,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(S$=Date.now()-y$,$$.code!==0){const O$=new yb$1(Ry$1.UNEXPECTED_RESPONSE,"image inspect ap error, code"+$$.code,{retry:!0,responseTime:S$});throw fb$1.error(O$.toString()),O$}const C$=JSON.parse($$.json_body);if(C$.code!==200){const O$=new yb$1(Ry$1.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(C$.code,", reason: ").concat(C$.reason),{code:C$.code,responseTime:S$});throw fb$1.error(O$.toString()),O$}if(!C$.servers||!Array.isArray(C$.servers)||C$.servers.length===0){const O$=new yb$1(Ry$1.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:C$.code,responseTime:S$});throw fb$1.error(O$.toString()),O$}const N$=XA$1("VIDEO_INSPECT_WORKER_MANAGER_HOST"),k$=XA$1("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:C$.servers.map(O$=>{let{address:U$,wss:x$}=O$;if(U$&&x$)return"wss://".concat(U$.replace(/\./g,"-"),".").concat(N$,":").concat(k$||x$)}).filter(O$=>!!O$),workerToken:C$.workerToken,vid:C$.vid,responseTime:S$}},($$,C$)=>(vb$1.apworkerEvent(_$,{success:!0,sc:200,serviceName:g$,responseDetail:JSON.stringify($$.addressList),firstSuccess:C$===0,responseTime:S$,serverIp:a$[C$%a$.length]}),!1),($$,C$)=>(vb$1.apworkerEvent(_$,{success:!1,sc:$$.data&&$$.data.code||200,serviceName:g$,responseTime:S$,serverIp:a$[C$%a$.length]}),!!($$.code!==Ry$1.OPERATION_ABORTED&&$$.code!==Ry$1.UNEXPECTED_RESPONSE||$$.data&&$$.data.retry)&&(b$=a$[(C$+1)%a$.length],!0)),l$)}(i$,t$,r$,n$);this.emit(mO$1.STATE_CHANGE,fO$1.AP_CONNECTED);const{addressList:s$}=o$;return this.wmSequence++,s$}async connectWorkerManager(t$){let r$=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=r$,this.emit(mO$1.STATE_CHANGE,fO$1.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t$,1e4)}async connectWorker(t$){await this.workerConnection.init([t$])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Uw$1.CONNECTED,async()=>{this.emit(mO$1.STATE_CHANGE,fO$1.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.22.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Uw$1.CLOSED,()=>{this._innerConnectionState<fO$1.GET_WORKER_MANAGER_RESPONSE&&fb$1.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Uw$1.FAILED,()=>{this._innerConnectionState<fO$1.GET_WORKER_MANAGER_RESPONSE&&fb$1.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Uw$1.RECONNECTING,()=>{this._innerConnectionState<fO$1.GET_WORKER_MANAGER_RESPONSE&&fb$1.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Uw$1.ON_MESSAGE,async t$=>{this.emit(mO$1.STATE_CHANGE,fO$1.GET_WORKER_MANAGER_RESPONSE);const r$=this.workerManagerConnection.url;this.workerManagerConnection.close();const n$=JSON.parse(t$.data);if(n$.code!==200)throw fb$1.error("[".concat(this._inspectId,"] Unexpected code ").concat(n$.code," from worker manager")),new yb$1(Ry$1.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n$);if(!(n$.serverResponse&&n$.serverResponse.portWss&&r$))throw fb$1.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n$))),new yb$1(Ry$1.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n$);{const i$=XA$1("VIDEO_INSPECT_WORKER_PORT")||n$.serverResponse.portWss,o$=r$.replace(/:\d+\/?$/,":".concat(i$));this.emit(mO$1.STATE_CHANGE,fO$1.CONNECT_WORKER,o$),this._needWorkUrlOnly?this.emit(mO$1.REQUEST_NEW_WORKER_URL,o$):await this.connectWorker(o$)}}),this.workerManagerConnection.on(Uw$1.WILL_RECONNECT,(t$,r$,n$)=>{n$(t$)}),this.workerManagerConnection.on(Uw$1.REQUEST_NEW_URLS,(t$,r$)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t$).catch(r$)})}handleWorkerEvents(){this.workerConnection.on(Uw$1.CONNECTED,async()=>{this.emit(mO$1.STATE_CHANGE,fO$1.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=EO$1.CONNECTED}),this.workerConnection.on(Uw$1.ON_MESSAGE,async t$=>{if(t$.data instanceof ArrayBuffer){const n$=yY(new Uint8Array(t$.data));if(XA$1("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&fb$1.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n$)),n$.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(mO$1.INSPECT_RESULT,void 0,void 0);if(n$.data&&n$.data.scorePorn&&n$.data.scoreSexy&&n$.data.scoreNeutral){var r$;const i$={porn:n$.data.scorePorn,sexy:n$.data.scoreSexy,neutral:n$.data.scoreNeutral},o$=Jn$1(r$=Object.keys(i$)).call(r$,(a$,c$)=>i$[a$]>i$[c$]?a$:c$,"porn"),s$=Object.keys(i$).find(a$=>a$===o$);this.emit(mO$1.INSPECT_RESULT,s$)}else this.emit(mO$1.INSPECT_RESULT,void 0,new yb$1(Ry$1.UNEXPECTED_RESPONSE,n$.code+"","There is an unexpected data on message"))}else this.emit(mO$1.INSPECT_RESULT,void 0,new yb$1(Ry$1.UNEXPECTED_RESPONSE,n$.code+"",n$.msg))}else fb$1.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(mO$1.INSPECT_RESULT,void 0,new yb$1(Ry$1.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Uw$1.CLOSED,()=>{this.connectionState=EO$1.CLOSED}),this.workerConnection.on(Uw$1.FAILED,()=>{this.connectionState=EO$1.CLOSED}),this.workerConnection.on(Uw$1.RECONNECTING,()=>{this.connectionState=this.connectionState===EO$1.CONNECTED?EO$1.RECONNECTING:EO$1.CONNECTING}),this.workerConnection.on(Uw$1.WILL_RECONNECT,(t$,r$,n$)=>{t$==="recover"&&n$(t$),n$("tryNext")}),this.workerConnection.on(Uw$1.REQUEST_NEW_URLS,(t$,r$)=>{this.workerManagerConnection.close(),this.once(mO$1.REQUEST_NEW_WORKER_URL,n$=>{t$([n$])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n$=>{this.connectWorkerManager(n$,!0)}).catch(n$=>{r$(n$)})})}async requestToInspectImage(){this.sequence++;const t$=eA$1(this,mO$1.CLIENT_LOCAL_VIDEO_TRACK),r$={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t$){if(!t$.isPlaying)return void this.emit(mO$1.INSPECT_RESULT,void 0,new yb$1(Ry$1.INVALID_OPERATION,"Only the track being played can be inspected"));const n$=await this.generateRequestData(t$,r$);this.workerConnection.sendMessage(n$,!0,!0)}else this.emit(mO$1.INSPECT_RESULT,void 0,new yb$1(Ry$1.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t$,r$){let{appId:n$,cname:i$,cid:o$,vid:s$,sid:a$,uid:c$}=r$;const u$=Date.now(),l$=await t$.getCurrentFrameImage("image/jpeg",this.quality),d$=await Ok$1(l$,n$,i$),h$=this.sequence+"-"+o$+"-"+c$+"-"+u$+"-"+TA$1(12,""),p$={appId:n$,cid:o$,cname:i$,deviceId:"",elapse:$Y(Number(u$-this.inspectStartTime)),fileSize:d$.byteLength,jpgEncryption:2,height:l$.height,width:l$.width,jpg:d$,networkType:6,osType:7,requestId:h$,sdkVersion:"4.22.1",sequence:this.sequence,sid:a$,timestamp:$Y(u$),uid:c$,vid:s$,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete p$.callbackData,this.ossFilePrefix===void 0&&delete p$.ossFilePrefix;const _$=vY(p$);if(_$.byteLength<this.workerMessageLengthLimit){if(XA$1("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const f$=function(m$){for(var g$=1;g$<arguments.length;g$++){var v$=arguments[g$]!=null?arguments[g$]:{};g$%2?QY(Object(v$),!0).forEach(function(y$){Fg$1(m$,y$,v$[y$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m$,Object.getOwnPropertyDescriptors(v$)):QY(Object(v$)).forEach(function(y$){Object.defineProperty(m$,y$,Object.getOwnPropertyDescriptor(v$,y$))})}return m$}({},p$);delete f$.jpg,fb$1.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(f$))}return _$}{const f$=this.quality*this.qualityRatio;return this.quality=f$,await this.generateRequestData(t$,{appId:n$,cname:i$,cid:o$,vid:s$,sid:a$,uid:c$})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Lv$1.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=EO$1.CLOSED,this.emit(mO$1.STATE_CHANGE,fO$1.CLOSED)}}const tq={name:"ContentInspect",create:function(e$){let{config:t$}=e$;return function(r$){if(!r$)throw new yb$1(Ry$1.INVALID_PARAMS,"inspectConfig is necessary.");if(!r$.inspectType||!Array.isArray(r$.inspectType))throw new yb$1(Ry$1.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const n$=[...new Set(r$.inspectType)];n$.forEach(i$=>{var o$;if(!Dn$1(o$=["supervise","moderation"]).call(o$,i$))throw new yb$1(Ry$1.INVALID_PARAMS,"".concat(i$," is not a valid inspect type."))}),r$.inspectType=n$}if(r$&&r$.extraInfo&&r$.extraInfo.length>1024)throw new yb$1(Ry$1.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t$),new eq(t$)}};JA$1("PROCESS_ID","process-".concat(TA$1(8,""),"-").concat(TA$1(4,""),"-").concat(TA$1(4,""),"-").concat(TA$1(4,""),"-").concat(TA$1(12,""))),function(){let e$;try{e$=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t$){return void fb$1.error("Error loading sdk config",t$.message)}if(e$)try{const t$=JSON.parse(window.atob(e$)),r$=Date.now();fb$1.debug("Loading global parameters from cache",t$),Object.keys(t$).forEach(n$=>{if(Object.prototype.hasOwnProperty.call(zA$1,n$)){const{value:i$,expires:o$}=t$[n$];if(o$&&o$<=r$)return;QA$1[n$]=i$,zA$1[n$]=i$}})}catch(t$){fb$1.error("Error loading mutableParamsCache: ".concat(e$),t$.message)}}(),Array.isArray(QA$1.AREAS)&&QA$1.AREAS.length>0&&bx$1(QA$1.AREAS,!0);const iq=(e$,t$,r$)=>{fb$1.debug("setParameter key:".concat(e$,", value:").concat(JSON.stringify(t$))),JA$1(e$,t$,r$)};SB$1(fY,!1),SB$1(IY,!1),SB$1(kj$1,!1),SB$1(tq,!1),SB$1(pY,!1);const nq=function(e$){const t$=new xy$1,r$=e$,n$={getListeners:t$.getListeners.bind(t$),on:(i$,o$)=>(function(s$,a$){s$===SO$1.SECURITY_POLICY_VIOLATION&&LG$1(a$,!0)}(i$,o$),t$.on.bind(t$)(i$,o$)),addListener:t$.addListener.bind(t$),once:t$.once.bind(t$),off:t$.off.bind(t$),removeAllListeners:t$.removeAllListeners.bind(t$),emit:t$.emit.bind(t$),safeEmit:t$.safeEmit.bind(t$)};return DG$1(DG$1({},r$),n$)}({__TRACK_LIST__:_L$1,VERSION:GA$1,BUILD:qA$1,ESM_BUNDLER:!1,ESM:!0,UMD:!1,DEV:!1,setParameter:iq,getParameter:XA$1,getSupportedCodec:async function(){let e$={audio:[],video:[]};try{let t$=new RTCPeerConnection;const r$=await async function(n$){let i$;return ZP$1().supportUnifiedPlan?(n$.addTransceiver("video",{direction:"recvonly"}),n$.addTransceiver("audio",{direction:"recvonly"}),i$=(await n$.createOffer()).sdp):i$=(await n$.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i$}(t$);if(!r$)return e$;t$.close(),t$=null,e$=function(n$){const i$={video:[],audio:[]};return n$.match(/ VP8/i)&&i$.video.push("VP8"),n$.match(/ VP9/i)&&i$.video.push("VP9"),n$.match(/ AV1/i)&&i$.video.push("AV1"),n$.match(/ H264/i)&&i$.video.push("H264"),n$.match(/ H265/i)&&i$.video.push("H265"),n$.match(/ opus/i)&&i$.audio.push("OPUS"),n$.match(/ PCMU/i)&&i$.audio.push("PCMU"),n$.match(/ PCMA/i)&&i$.audio.push("PCMA"),n$.match(/ G722/i)&&i$.audio.push("G722"),i$}(r$)}catch(t$){throw new yb$1(Ry$1.CREATE_OFFER_FAILED,t$.toString&&t$.toString()).print()}return e$},checkSystemRequirements:function(){const e$=vb$1.reportApiInvoke(null,{name:By$1.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:jy$1.TRACER});let t$=!1;try{const o$=window.RTCPeerConnection,s$=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,a$=window.WebSocket;t$=!!(o$&&s$&&a$),t$&&_y$1()&&ty$1(75)&&new o$().close()}catch(o$){return fb$1.error("check system requirement failed: ",o$),!1}let r$=!1;const n$=Hv$1();n$.name===Bv$1.CHROME&&Number(n$.version)>=58&&(Gv$1.engine.name!=="WebKit"||function(){const o$=Hv$1();if(zv$1()){if(o$.os===Fv$1.MAC_OS)return!0;if(o$.os===Fv$1.IOS){const s$=Gv$1.os.version&&Gv$1.os.version.split(".");if(s$&&Number(s$[0])===14&&s$[1]&&Number(s$[1])>=3||s$&&Number(s$[0])>14)return!0}}return!1}())&&(r$=!0),(n$.name===Bv$1.FIREFOX&&Number(n$.version)>=56||n$.name===Bv$1.OPERA&&Number(n$.version)>=45||n$.name===Bv$1.SAFARI&&Number(n$.version)>=11||n$.name==="WebKit"&&($v$1()||uy$1())&&n$.osVersion&&Number(n$.osVersion.split(".")[0])>=11||hy$1()||Hv$1().name===Bv$1.QQ)&&(r$=!0),fb$1.debug("checkSystemRequirements, api:",t$,"browser",r$);const i$=t$&&r$;return e$.onSuccess(i$),i$},getDevices:function(e$){return uk$1.enumerateDevices(!0,!0,e$)},getMicrophones:function(e$){return uk$1.getRecordingDevices(e$)},getCameras:function(e$){return uk$1.getCamerasDevices(e$)},getElectronScreenSources:nk$1,getPlaybackDevices:function(e$){return uk$1.getSpeakers(e$)},createClient:function(){var e$;let t$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const r$=vb$1.reportApiInvoke(null,{name:By$1.CREATE_CLIENT,options:[t$],tag:jy$1.TRACER});try{(function(n$){vy$1(n$.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),vy$1(n$.mode,"config.mode",["rtc","live","p2p"]),n$.audioCodec!==void 0&&vy$1(n$.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),n$.proxyServer!==void 0&&by$1(n$.proxyServer,"config.proxyServer",1,1e4),n$.turnServer!==void 0&&Yy$1(n$.turnServer),n$.httpRetryConfig!==void 0&&Gy$1(n$.httpRetryConfig),n$.websocketRetryConfig!==void 0&&Gy$1(n$.websocketRetryConfig)})(t$)}catch(n$){throw r$.onError(n$),n$}return(ry$1(16,0)||oy$1(16,0))&&(t$.codec==="vp9"&&(t$.codec="vp8",fb$1.debug("browser not support vp9, force use vp8")),JA$1("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t$.audioCodec===void 0&&(t$.audioCodec="opus"),r$.onSuccess(),new vG$1(IG$1(IG$1({forceWaitGatewayResponse:!0},t$),{},{role:Dn$1(e$=["rtc","p2p"]).call(e$,t$.mode)?"host":t$.role||"audience"}))},createCameraVideoTrack:async function(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t$=XA$1("CAMERA_CAPTURE_CONFIG"),r$=vb$1.reportApiInvoke(null,{tag:jy$1.TRACER,name:By$1.CREATE_CAM_VIDEO_TRACK,options:[GL$1({},e$),t$]});t$&&(e$.encoderConfig=t$);const n$=Ak$1(e$),i$=TA$1(8,"track-cam-");let o$=null;fb$1.info("start create camera video track with config",JSON.stringify(e$),"trackId",i$);try{o$=(await ak$1({video:n$},i$)).getVideoTracks()[0]||null}catch(a$){throw r$.onError(a$),a$}if(!o$){const a$=new Cy$1(Ry$1.UNEXPECTED_ERROR,"can not find track in media stream");return r$.onError(a$),a$.throw(fb$1)}e$.optimizationMode&&dU$1(i$,o$,e$,dL$1(e$.encoderConfig));const s$=new cU$1(o$,e$,n$,e$.scalabiltyMode?uL$1(e$.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e$.optimizationMode,i$);return r$.onSuccess(s$.getTrackId()),fb$1.info("create camera video success, trackId:",i$),s$},createCustomVideoTrack:function(e$){const t$=vb$1.reportApiInvoke(null,{tag:jy$1.TRACER,name:By$1.CREATE_CUSTOM_VIDEO_TRACK,options:[e$]}),r$=new aU$1(e$.mediaStreamTrack,{width:e$.width,height:e$.height,frameRate:e$.frameRate,bitrateMax:e$.bitrateMax,bitrateMin:e$.bitrateMin},e$.scalabiltyMode?uL$1(e$.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e$.optimizationMode,TA$1(8,"track-cus-"),[mL$1.CUSTOM_TRACK]);return t$.onSuccess(r$.getTrackId()),fb$1.info("create custom video track success with config",e$,"trackId",r$.getTrackId()),r$},createScreenVideoTrack:async function(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const r$=vb$1.reportApiInvoke(null,{tag:jy$1.TRACER,name:By$1.CREATE_SCREEN_VIDEO_TRACK,options:[GL$1({},e$),t$]});e$.encoderConfig?typeof e$.encoderConfig=="string"||e$.encoderConfig.width&&e$.encoderConfig.height||(e$.encoderConfig.width={max:1920},e$.encoderConfig.height={max:1080}):e$.encoderConfig="1080p_2";const n$=function(l$){const d$={};l$.screenSourceType&&(d$.mediaSource=l$.screenSourceType),l$.extensionId&&Jv$1()&&(d$.extensionId=l$.extensionId);const{displaySurface:h$,selfBrowserSurface:p$,surfaceSwitching:_$,systemAudio:f$}=l$;(ey$1(107)||iy$1(107)||sy$1(93))&&(h$&&(vy$1(h$,"displaySurface",["browser","window","monitor"]),d$.displaySurface=h$),p$?(vy$1(p$,"selfBrowserSurface",["exclude","include"]),d$.selfBrowserSurface=p$):d$.selfBrowserSurface="include",_$&&(vy$1(_$,"surfaceSwitching",["exclude","include"]),d$.surfaceSwitching=_$)),(ey$1(105)||iy$1(105)||sy$1(91))&&f$&&(vy$1(f$,"systemAudio",["exclude","include"]),d$.systemAudio=f$),l$.electronScreenSourceId&&(d$.sourceId=l$.electronScreenSourceId);const m$=l$.encoderConfig?lL$1(l$.encoderConfig):null;return d$.mandatory={chromeMediaSource:"desktop",maxWidth:m$?m$.width:void 0,maxHeight:m$?m$.height:void 0},m$&&(m$.frameRate&&(typeof m$.frameRate=="number"?(d$.mandatory.maxFrameRate=m$.frameRate,d$.mandatory.minFrameRate=m$.frameRate):(d$.mandatory.maxFrameRate=m$.frameRate.max||m$.frameRate.ideal||m$.frameRate.exact||void 0,d$.mandatory.minFrameRate=m$.frameRate.min||m$.frameRate.ideal||m$.frameRate.exact||void 0),d$.frameRate=m$.frameRate),m$.width&&(d$.width=m$.width),m$.height&&(d$.height=m$.height)),d$}(e$),i$=TA$1(8,"track-scr-v-");let o$=null,s$=null;const a$=ZP$1();if(!a$.supportShareAudio&&t$==="enable"){const l$=new Cy$1(Ry$1.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r$.onError(l$),l$.throw(fb$1)}fb$1.info("start create screen video track with config",e$,"withAudio",t$,"trackId",i$);try{const l$=await ak$1({screen:n$,screenAudio:t$==="auto"?a$.supportShareAudio:t$==="enable"},i$);o$=l$.getVideoTracks()[0]||null,s$=l$.getAudioTracks()[0]||null}catch(l$){throw r$.onError(l$),l$}if(!o$){const l$=new Cy$1(Ry$1.UNEXPECTED_ERROR,"can not find track in media stream");return r$.onError(l$),l$.throw(fb$1)}if(!s$&&t$==="enable"){o$&&o$.stop();const l$=new Cy$1(Ry$1.SHARE_AUDIO_NOT_ALLOWED);return r$.onError(l$),l$.throw(fb$1)}e$.optimizationMode||(e$.optimizationMode="detail"),e$.optimizationMode&&(dU$1(i$,o$,e$,e$.encoderConfig&&lL$1(e$.encoderConfig)||void 0),e$.encoderConfig&&typeof e$.encoderConfig!="string"&&(e$.encoderConfig.bitrateMin=e$.encoderConfig.bitrateMax));const c$=new aU$1(o$,e$.encoderConfig?lL$1(e$.encoderConfig):{},e$.scalabiltyMode?uL$1(e$.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e$.optimizationMode,i$,[mL$1.SCREEN_TRACK]);if(!s$)return r$.onSuccess(c$.getTrackId()),fb$1.info("create screen video track success","video:",c$.getTrackId()),c$;const u$=new TM$1(s$,void 0,TA$1(8,"track-scr-a-"),!1);return r$.onSuccess([c$.getTrackId(),u$.getTrackId()]),fb$1.info("create screen video track success","video:",c$.getTrackId(),"audio:",u$.getTrackId()),[c$,u$]},createMicrophoneAndCameraTracks:async function(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r$=XA$1("CAMERA_CAPTURE_CONFIG"),n$=vb$1.reportApiInvoke(null,{tag:jy$1.TRACER,name:By$1.CREATE_MIC_AND_CAM_TRACKS,options:[e$,t$,r$]});r$&&(t$.encoderConfig=r$);const i$=Ak$1(t$),o$=bk$1(e$),s$=TA$1(8,"track-mic-"),a$=TA$1(8,"track-cam-");let c$=null,u$=null;fb$1.info("start create camera video track(".concat(a$,") and microphone audio track(").concat(s$,") with config, audio: ").concat(JSON.stringify(e$),", video: ").concat(JSON.stringify(t$)));try{const h$=await ak$1({audio:o$,video:i$},"".concat(s$,"-").concat(a$));c$=h$.getAudioTracks()[0],u$=h$.getVideoTracks()[0]}catch(h$){throw n$.onError(h$),h$}if(!c$||!u$){const h$=new Cy$1(Ry$1.UNEXPECTED_ERROR,"can not find tracks in media stream");return n$.onError(h$),h$.throw(fb$1)}t$.optimizationMode&&dU$1(a$,u$,t$,dL$1(t$.encoderConfig));const l$=new SM$1(c$,e$,o$,s$),d$=new cU$1(u$,t$,i$,t$.scalabiltyMode?uL$1(t$.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t$.optimizationMode,a$);return n$.onSuccess([l$.getTrackId(),d$.getTrackId()]),fb$1.info("create camera video track(".concat(a$,") and microphone audio track(").concat(s$,") success")),[l$,d$]},createMicrophoneAudioTrack:async function(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t$=vb$1.reportApiInvoke(null,{tag:jy$1.TRACER,name:By$1.CREATE_MIC_AUDIO_TRACK,options:[e$]}),r$=bk$1(e$),n$=TA$1(8,"track-mic-");let i$=null;fb$1.info("start create microphone audio track with config",JSON.stringify(e$),"trackId",n$);try{i$=(await ak$1({audio:r$},n$)).getAudioTracks()[0]||null}catch(s$){throw t$.onError(s$),s$}if(!i$){const s$=new Cy$1(Ry$1.UNEXPECTED_ERROR,"can not find track in media stream");return t$.onError(s$),s$.throw(fb$1)}const o$=new SM$1(i$,e$,r$,n$);return t$.onSuccess(o$.getTrackId()),fb$1.info("create microphone audio track success, trackId:",n$),o$},createCustomAudioTrack:function(e$){const t$=vb$1.reportApiInvoke(null,{tag:jy$1.TRACER,name:By$1.CREATE_CUSTOM_AUDIO_TRACK,options:[e$]}),r$=new TM$1(e$.mediaStreamTrack,e$.encoderConfig?pL$1(e$.encoderConfig):{},TA$1(8,"track-cus-"),!1);return fb$1.info("create custom audio track success with config",e$,"trackId",r$.getTrackId()),t$.onSuccess(r$.getTrackId()),r$},createBufferSourceAudioTrack:async function(e$){var t$;const{cacheOnlineFile:r$,encoderConfig:n$}=e$;let{source:i$}=e$;const o$={source:i$ instanceof AudioBuffer?"AudioBuffer":i$ instanceof File?(t$=File.name)!==null&&t$!==void 0?t$:"File":i$,cacheOnlineFile:r$,encoderConfig:n$},s$=vb$1.reportApiInvoke(null,{tag:jy$1.TRACER,name:By$1.CREATE_BUFFER_AUDIO_TRACK,options:[o$]});if(XA$1("DISABLE_WEBAUDIO"))throw new Cy$1(Ry$1.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const a$=TA$1(8,"track-buf-");fb$1.info("start create buffer source audio track with config",JSON.stringify(o$),"trackId",a$);const c$=i$;if(!(i$ instanceof AudioBuffer))try{i$=await async function(d$,h$){let p$=null;if(typeof d$=="string"){const f$=IM$1.get(d$);if(f$)return fb$1.debug("use cached audio resource: ",d$),f$;try{p$=(await kA$1(()=>Lv$1.get(d$,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(m$){throw new Cy$1(Ry$1.FETCH_AUDIO_FILE_FAILED,m$.toString())}}else p$=await new Gh$1((m$,g$)=>{const v$=new FileReader;v$.onload=y$=>{y$.target?m$(y$.target.result):g$(new Cy$1(Ry$1.READ_LOCAL_AUDIO_FILE_ERROR))},v$.onerror=()=>{g$(new Cy$1(Ry$1.READ_LOCAL_AUDIO_FILE_ERROR))},v$.readAsArrayBuffer(d$)});const _$=await function(f$){const m$=zL$1();return new Gh$1((g$,v$)=>{m$.decodeAudioData(f$,y$=>{g$(y$)},y$=>{v$(new Cy$1(Ry$1.DECODE_AUDIO_FILE_FAILED,y$.toString()))})})}(p$);return typeof d$=="string"&&h$&&IM$1.set(d$,_$),_$}(i$,r$)}catch(d$){return s$.onError(d$),d$.throw(fb$1)}const u$=new CM$1(i$),l$=new gM$1(c$,u$,n$?pL$1(n$):{},a$);return fb$1.info("create buffer source audio track success, trackId:",a$),s$.onSuccess(l$.getTrackId()),l$},setAppType:function(e$){if(fb$1.debug("setAppType: ".concat(e$)),!(Number.isInteger(e$)&&e$>=0))throw fb$1.debug("Invalid appType"),new yb$1(Ry$1.INVALID_PARAMS,"invalid app type",e$);JA$1("APP_TYPE",Math.floor(e$))},setLogLevel:function(e$){fb$1.setLogLevel(e$)},enableLogUpload:function(){XA$1("USE_NEW_LOG")?JA$1("UPLOAD_LOG",!0):fb$1.enableLogUpload()},disableLogUpload:function(){XA$1("USE_NEW_LOG")?JA$1("UPLOAD_LOG",!1):fb$1.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new PF$1},checkAudioTrackIsActive:async function(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r$=vb$1.reportApiInvoke(null,{tag:jy$1.TRACER,name:By$1.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t$]});if(!(e$ instanceof TM$1||e$ instanceof vU$1)){const c$=new yb$1(Ry$1.INVALID_TRACK,"the parameter is not a audio track");return r$.onError(c$),c$.throw()}t$&&t$<1e3&&(t$=1e3);const n$=e$ instanceof TM$1?e$.getTrackLabel():"remote_track",i$=e$.getVolumeLevel();let o$=i$,s$=i$;const a$=Date.now();return new Gh$1(c$=>{const u$=setInterval(()=>{const l$=e$.getVolumeLevel();o$=l$>o$?l$:o$,s$=l$<s$?l$:s$;const d$=o$-s$>1e-4,h$=Date.now()-a$;if(d$||h$>t$){clearInterval(u$);const p$=d$,_$={duration:h$,deviceLabel:n$,maxVolumeLevel:o$,result:p$};fb$1.info("[track-".concat(e$.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(_$))),r$.onSuccess(_$),c$(p$)}},200)})},checkVideoTrackIsActive:async function(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r$=vb$1.reportApiInvoke(null,{tag:jy$1.TRACER,name:By$1.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t$]});if(!(e$ instanceof aU$1||e$ instanceof IU$1)){const d$=new yb$1(Ry$1.INVALID_TRACK,"the parameter is not a video track");return r$.onError(d$),d$.throw()}t$&&t$<1e3&&(t$=1e3);const n$=e$ instanceof aU$1?e$.getTrackLabel():"remote_track",i$=e$.getMediaStreamTrack(!0),o$=document.createElement("video");o$.style.width="1px",o$.style.height="1px",o$.setAttribute("muted",""),o$.muted=!0,o$.setAttribute("playsinline",""),o$.controls=!1,(Xv$1()||zv$1())&&(o$.style.opacity="0.01",o$.style.position="fixed",o$.style.left="0",o$.style.top="0",document.body.appendChild(o$)),o$.srcObject=new MediaStream([i$]),o$.play();const s$=document.createElement("canvas");s$.width=160,s$.height=120;let a$=0,c$=0;try{const d$=Date.now();a$=await function(h$,p$,_$,f$){let m$,g$=0,v$=null;return new Gh$1((y$,S$)=>{function b$(){g$>f$&&m$&&(m$(),y$(g$));const $$=_$.getContext("2d");if(!$$){const k$=new yb$1(Ry$1.UNEXPECTED_ERROR,"can not get canvas 2d context.");return fb$1.error(k$.toString()),void S$(k$)}$$.drawImage(h$,0,0,160,120);const C$=$$.getImageData(0,0,_$.width,_$.height),N$=Math.floor(C$.data.length/3);if(v$){for(let k$=0;k$<N$;k$+=3)if(C$.data[k$]!==v$[k$])return g$+=1,void(v$=C$.data);v$=C$.data}else v$=C$.data}setTimeout(()=>{m$&&(m$(),y$(g$))},p$),m$=QL$1(()=>{b$()},30)})}(o$,t$,s$,4),c$=Date.now()-d$}catch(d$){throw r$.onError(d$),d$}DB$1===Bv$1.SAFARI&&(o$.pause(),o$.remove()),o$.srcObject=null;const u$=a$>4,l$={duration:c$,changedPicNum:a$,deviceLabel:n$,result:u$};return fb$1.info("[track-".concat(e$.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(l$))),r$.onSuccess(l$),u$},setArea:bx$1,audioElementPlayCenter:mk$1,resumeAudioContext:function(){mk$1.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e$){OG$1.processExternalMediaAEC(e$)},registerExtensions:function(e$){const t$=XA$1("PLUGIN_INFO")||[];e$.forEach(r$=>{"name"in r$&&!Dn$1(t$).call(t$,r$.name)&&t$.push(r$.name);const n$=r$;n$.__registered__=!0,n$.logger.hookLog=fb$1.extLog,n$.reporter.hookApiInvoke=vb$1.extApiInvoke,n$.parameters&&Object.keys(n$.parameters).forEach(i$=>{n$.parameters[i$]=XA$1(i$)})}),iq("PLUGIN_INFO",t$)},ChannelMediaRelayError:Qw$1,ChannelMediaRelayEvent:Jw$1,ChannelMediaRelayState:Xw$1,RemoteStreamFallbackType:gL$1,RemoteStreamType:SL$1,ConnectionDisconnectedReason:Hy$1,AudienceLatencyLevelType:Wy$1,AREAS:iO$1,preload:async function(e$,t$,r$,n$){return KB$1(e$,t$,r$,n$)}});Object.defineProperties(nq,{onAudioAutoplayFailed:{get:()=>pk$1.onAudioAutoplayFailed,set:e$=>{pk$1.onAudioAutoplayFailed=e$}},onAutoplayFailed:{get:()=>pk$1.onAutoplayFailed,set:e$=>{pk$1.onAutoplayFailed=e$}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>nq._onSecurityPolicyViolation,set(e$){nq._onSecurityPolicyViolation=e$,LG$1(e$)}},__CLIENT_LIST__:{get:()=>XA$1("SHOW_GLOBAL_CLIENT_LIST")?wb$1:[]}}),uk$1.on(kL$1.CAMERA_DEVICE_CHANGED,e$=>{fb$1.info("camera device changed",JSON.stringify(e$)),nq.onCameraChanged&&nq.onCameraChanged(e$),nq.safeEmit(SO$1.CAMERA_CHANGED,e$)}),uk$1.on(kL$1.RECORDING_DEVICE_CHANGED,e$=>{fb$1.info("microphone device changed",JSON.stringify(e$)),nq.onMicrophoneChanged&&nq.onMicrophoneChanged(e$),nq.safeEmit(SO$1.MICROPHONE_CHANGED,e$)}),uk$1.on(kL$1.PLAYOUT_DEVICE_CHANGED,e$=>{fb$1.debug("playout device changed",JSON.stringify(e$)),nq.onPlaybackDeviceChanged&&nq.onPlaybackDeviceChanged(e$),nq.safeEmit(SO$1.PLAYBACK_DEVICE_CHANGED,e$)}),mk$1.onAutoplayFailed=()=>{fb$1.info("detect audio element autoplay failed"),pk$1.onAudioAutoplayFailed&&pk$1.onAudioAutoplayFailed()},qL$1.on("autoplay-failed",()=>{fb$1.info("detect webaudio autoplay failed"),pk$1.onAudioAutoplayFailed&&pk$1.onAudioAutoplayFailed(),nq.safeEmit(SO$1.AUTOPLAY_FAILED)}),qL$1.on(tL$1.STATE_CHANGE,(e$,t$)=>{fb$1.info("audio context state changed: ".concat(t$," => ").concat(e$)),nq.onAudioContextStateChanged&&nq.onAudioContextStateChanged(e$,t$),nq.safeEmit(SO$1.AUDIO_CONTEXT_STATE_CHANGED,e$,t$)}),iA$1.on(Qy$1.NETWORK_STATE_CHANGE,(e$,t$)=>{fb$1.info("[network-indicator] network state changed, ".concat(t$," => ").concat(e$))}),window&&(window.__ARTC__=nq);function _objectWithoutPropertiesLoose(e$,t$){if(e$==null)return{};var r$={},n$=Object.keys(e$),i$,o$;for(o$=0;o$<n$.length;o$++)i$=n$[o$],!(t$.indexOf(i$)>=0)&&(r$[i$]=e$[i$]);return r$}var AgoraRTCErrorCode;(function(e$){e$.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e$.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e$.TIMEOUT="TIMEOUT",e$.INVALID_PARAMS="INVALID_PARAMS",e$.NOT_SUPPORTED="NOT_SUPPORTED",e$.INVALID_OPERATION="INVALID_OPERATION",e$.OPERATION_ABORTED="OPERATION_ABORTED",e$.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e$.NETWORK_ERROR="NETWORK_ERROR",e$.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e$.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e$.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e$.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e$.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e$.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e$.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e$.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e$.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e$.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e$.PERMISSION_DENIED="PERMISSION_DENIED",e$.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e$.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e$.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e$.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e$.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e$.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e$.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e$.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e$.UID_CONFLICT="UID_CONFLICT",e$.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e$.INVALID_TRACK="INVALID_TRACK",e$.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e$.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e$.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e$.ICE_FAILED="ICE_FAILED",e$.PC_CLOSED="PC_CLOSED",e$.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e$.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e$.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e$.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e$.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e$.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e$.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e$.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e$.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e$.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e$.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e$.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e$.WS_ABORT="WS_ABORT",e$.WS_DISCONNECT="WS_DISCONNECT",e$.WS_ERR="WS_ERR",e$.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e$.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e$.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e$.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e$.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e$.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e$.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e$.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e$.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e$.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e$.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e$.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e$.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e$.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e$.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e$.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e$.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e$.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"})(AgoraRTCErrorCode||(AgoraRTCErrorCode={}));var createClient=function(t$){var r$;function n$(){return r$||(r$=nq.createClient(t$)),r$}return function(){return n$()}};function createMicrophoneAndCameraTracks(e$,t$){var r$=function(){try{return Promise.resolve(nq.createMicrophoneAndCameraTracks(e$,t$)).then(function(o$){return n$=o$,n$})}catch(o$){return Promise.reject(o$)}},n$=null;return function(){var o$=reactExports.useState(!1),s$=o$[0],a$=o$[1],c$=reactExports.useState(null),u$=c$[0],l$=c$[1],d$=reactExports.useRef(n$);return reactExports.useEffect(function(){return d$.current===null?r$().then(function(h$){d$.current=h$,a$(!0)},function(h$){l$(h$)}):a$(!0),function(){n$=null}},[]),{ready:s$,tracks:d$.current,error:u$}}}var AgoraVideoPlayer=function(t$){var r$=reactExports.useRef(null),n$=t$.videoTrack,i$=t$.config,o$=_objectWithoutPropertiesLoose(t$,["videoTrack","config"]);return reactExports.useLayoutEffect(function(){return r$.current!==null&&n$.play(r$.current,i$),function(){n$.stop()}},[n$]),React.createElement("div",Object.assign({},o$,{ref:r$}))},agoraRtmSdk={exports:{}};agoraRtmSdk.exports;(function(module,exports){var define_process_env_default={};/*
 @preserve
 AgoraRTM Web SDK 1.4.3-203 - commit: v1.4.3-17-g1e27aa38
 Copyright (C) 2018-2021 Agora Lab.
 This file is licensed under the AGORA, INC. SDK LICENSE AGREEMENT
 A copy of this license may be found at https://www.agora.io/en/sdk-license-agreement/
*/(function(e$,t$){module.exports=t$()})(commonjsGlobal,function(){function be(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function ua(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?be(Object(r$),!0).forEach(function(n$){m(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):be(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}function X(e$){return(X=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t$){return typeof t$}:function(t$){return t$&&typeof Symbol=="function"&&t$.constructor===Symbol&&t$!==Symbol.prototype?"symbol":typeof t$})(e$)}function sl(e$,t$,r$,n$,i$,o$,s$){try{var a$=e$[o$](s$),c$=a$.value}catch(u$){return void r$(u$)}a$.done?t$(c$):Promise.resolve(c$).then(n$,i$)}function J(e$){return function(){var t$=this,r$=arguments;return new Promise(function(n$,i$){function o$(c$){sl(a$,n$,i$,o$,s$,"next",c$)}function s$(c$){sl(a$,n$,i$,o$,s$,"throw",c$)}var a$=e$.apply(t$,r$);o$(void 0)})}}function W(e$,t$){if(!(e$ instanceof t$))throw new TypeError("Cannot call a class as a function")}function tl(e$,t$){for(var r$=0;r$<t$.length;r$++){var n$=t$[r$];n$.enumerable=n$.enumerable||!1,n$.configurable=!0,"value"in n$&&(n$.writable=!0),Object.defineProperty(e$,n$.key,n$)}}function Ha(e$,t$,r$){return t$&&tl(e$.prototype,t$),r$&&tl(e$,r$),e$}function m(e$,t$,r$){return t$ in e$?Object.defineProperty(e$,t$,{value:r$,enumerable:!0,configurable:!0,writable:!0}):e$[t$]=r$,e$}function la(e$,t$){if(typeof t$!="function"&&t$!==null)throw new TypeError("Super expression must either be null or a function");e$.prototype=Object.create(t$&&t$.prototype,{constructor:{value:e$,writable:!0,configurable:!0}}),t$&&df(e$,t$)}function wd(e$){return(wd=Object.setPrototypeOf?Object.getPrototypeOf:function(t$){return t$.__proto__||Object.getPrototypeOf(t$)})(e$)}function df(e$,t$){return(df=Object.setPrototypeOf||function(r$,n$){return r$.__proto__=n$,r$})(e$,t$)}function ul(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Sh(e$,t$,r$){return(Sh=ul()?Reflect.construct:function(n$,i$,o$){var s$=[null];return s$.push.apply(s$,i$),n$=new(Function.bind.apply(n$,s$)),o$&&df(n$,o$.prototype),n$}).apply(null,arguments)}function ef(e$){var t$=typeof Map=="function"?new Map:void 0;return(ef=function(r$){function n$(){return Sh(r$,arguments,wd(this).constructor)}if(r$===null||Function.toString.call(r$).indexOf("[native code]")===-1)return r$;if(typeof r$!="function")throw new TypeError("Super expression must either be null or a function");if(t$!==void 0){if(t$.has(r$))return t$.get(r$);t$.set(r$,n$)}return n$.prototype=Object.create(r$.prototype,{constructor:{value:n$,enumerable:!1,writable:!0,configurable:!0}}),df(n$,r$)})(e$)}function ff(e$,t$){if(e$==null)return{};if(e$==null)var r$={};else{r$={};var n$,i$=Object.keys(e$);for(n$=0;n$<i$.length;n$++){var o$=i$[n$];0<=t$.indexOf(o$)||(r$[o$]=e$[o$])}}if(Object.getOwnPropertySymbols)for(n$=Object.getOwnPropertySymbols(e$),o$=0;o$<n$.length;o$++)i$=n$[o$],0<=t$.indexOf(i$)||Object.prototype.propertyIsEnumerable.call(e$,i$)&&(r$[i$]=e$[i$]);return r$}function n(e$){if(e$===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e$}function ma(e$){var t$=ul();return function(){var r$=wd(e$);if(t$){var n$=wd(this).constructor;r$=Reflect.construct(r$,arguments,n$)}else r$=r$.apply(this,arguments);return r$=!r$||typeof r$!="object"&&typeof r$!="function"?n(this):r$}}function Th(e$,t$,r$){return(Th=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(n$,i$,o$){for(;!Object.prototype.hasOwnProperty.call(n$,i$)&&(n$=wd(n$))!==null;);if(n$)return(i$=Object.getOwnPropertyDescriptor(n$,i$)).get?i$.get.call(o$):i$.value})(e$,t$,r$||e$)}function ra(e$,t$){var r$=Array.isArray(e$)?e$:void 0;if(!r$)if((r$=e$&&(typeof Symbol<"u"&&e$[Symbol.iterator]||e$["@@iterator"]))==null)r$=void 0;else{var n$,i$=[],o$=!0,s$=!1;try{for(r$=r$.call(e$);!(o$=(n$=r$.next()).done)&&(i$.push(n$.value),!t$||i$.length!==t$);o$=!0);}catch(c$){s$=!0;var a$=c$}finally{try{o$||r$.return==null||r$.return()}finally{if(s$)throw a$}}r$=i$}if(!(e$=r$||vl(e$,t$)))throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return e$}function G(e$){var t$=Array.isArray(e$)?Uh(e$):void 0;if(t$||(t$=typeof Symbol<"u"&&e$[Symbol.iterator]!=null||e$["@@iterator"]!=null?Array.from(e$):void 0),!(e$=t$||vl(e$)))throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return e$}function vl(e$,t$){if(e$){if(typeof e$=="string")return Uh(e$,t$);var r$=Object.prototype.toString.call(e$).slice(8,-1);if(r$==="Object"&&e$.constructor&&(r$=e$.constructor.name),r$==="Map"||r$==="Set")return Array.from(e$);if(r$==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r$))return Uh(e$,t$)}}function Uh(e$,t$){(t$==null||t$>e$.length)&&(t$=e$.length);for(var r$=0,n$=Array(t$);r$<t$;r$++)n$[r$]=e$[r$];return n$}function fa(e$,t$,r$,n$,i$){var o$={};return Object.keys(n$).forEach(function(s$){o$[s$]=n$[s$]}),o$.enumerable=!!o$.enumerable,o$.configurable=!!o$.configurable,("value"in o$||o$.initializer)&&(o$.writable=!0),o$=r$.slice().reverse().reduce(function(s$,a$){return a$(e$,t$,s$)||s$},o$),i$&&o$.initializer!==void 0&&(o$.value=o$.initializer?o$.initializer.call(i$):void 0,o$.initializer=void 0),o$.initializer===void 0&&(Object.defineProperty(e$,t$,o$),o$=null),o$}function $a(e$){var t$={exports:{}};return e$(t$,t$.exports),t$.exports}function wl(e$,t$){var r$,n$=3>arguments.length?e$:arguments[2];return va(e$)===n$?e$[t$]:(r$=Fb.f(e$,t$))?Q(r$,"value")?r$.value:r$.get===void 0?void 0:r$.get.call(n$):ha(r$=Vb(e$))?wl(r$,t$,n$):void 0}function rs(e$){var t$=e$.charCodeAt(0)<<24,r$=0|ss(~t$),n$=0,i$=0|e$.length,o$="";if(5>r$&&i$>=r$){for(t$=t$<<r$>>>24+r$,n$=1;n$<r$;n$=n$+1|0)t$=t$<<6|63&e$.charCodeAt(n$);65535>=t$?o$+=xd(t$):1114111>=t$?o$+=xd(55296+((t$=t$-65536|0)>>10)|0,56320+(1023&t$)|0):n$=0}for(;n$<i$;n$=n$+1|0)o$+="";return o$}function xl(){}function ts(e$){var t$=0|e$.charCodeAt(0);if(55296<=t$&&56319>=t$){var r$=0|e$.charCodeAt(1);if(!(r$==r$&&56320<=r$&&57343>=r$))return xd(239,191,189);if(65535<(t$=(t$-55296<<10)+r$-56320+65536|0))return xd(240|t$>>>18,128|t$>>>12&63,128|t$>>>6&63,128|63&t$)}return 127>=t$?e$:2047>=t$?xd(192|t$>>>6,128|63&t$):xd(224|t$>>>12,128|t$>>>6&63,128|63&t$)}function yl(){}function ea(){ea.init.call(this)}function ng(e$){if(typeof e$!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+X(e$))}function zl(e$,t$,r$,n$){ng(r$);var i$=e$._events;if(i$===void 0)i$=e$._events=Object.create(null),e$._eventsCount=0;else{i$.newListener!==void 0&&(e$.emit("newListener",t$,r$.listener?r$.listener:r$),i$=e$._events);var o$=i$[t$]}return o$===void 0?(i$[t$]=r$,++e$._eventsCount):(typeof o$=="function"?o$=i$[t$]=n$?[r$,o$]:[o$,r$]:n$?o$.unshift(r$):o$.push(r$),0<(r$=e$._maxListeners===void 0?ea.defaultMaxListeners:e$._maxListeners)&&o$.length>r$&&!o$.warned&&(o$.warned=!0,(r$=Error("Possible EventEmitter memory leak detected. "+o$.length+" "+String(t$)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",r$.emitter=e$,r$.type=t$,r$.count=o$.length,console&&console.warn&&console.warn(r$))),e$}function us(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Al(e$,t$,r$){return e$={fired:!1,wrapFn:void 0,target:e$,type:t$,listener:r$},(t$=us.bind(e$)).listener=r$,e$.wrapFn=t$}function Bl(e$,t$,r$){if((e$=e$._events)===void 0)return[];if((t$=e$[t$])===void 0)return[];if(typeof t$=="function")return r$?[t$.listener||t$]:[t$];if(r$)for(r$=Array(t$.length),e$=0;e$<r$.length;++e$)r$[e$]=t$[e$].listener||t$[e$];else r$=Cl(t$,t$.length);return r$}function Dl(e$){var t$=this._events;if(t$!==void 0){if(typeof(e$=t$[e$])=="function")return 1;if(e$!==void 0)return e$.length}return 0}function Cl(e$,t$){for(var r$=Array(t$),n$=0;n$<t$;++n$)r$[n$]=e$[n$];return r$}function vs(e$,t$,r$){typeof e$.on=="function"&&El(e$,"error",t$,r$)}function El(e$,t$,r$,n$){if(typeof e$.on=="function")n$.once?e$.once(t$,r$):e$.on(t$,r$);else{if(typeof e$.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+X(e$));e$.addEventListener(t$,function i$(o$){n$.once&&e$.removeEventListener(t$,i$),r$(o$)})}}function ws(e$){return e$?G(e$):xs(function(){return[]},function(t$,r$){return t$.push(r$),t$})}function Fl(e$,t$){var r$,n$,i$,o$;return w.wrap(function(s$){for(;;)switch(s$.prev=s$.next){case 0:r$=Gl(e$)([Hl,Hl,function(a$,c$){return c$}])[2],n$=0;case 2:if(!(n$<t$.length)){s$.next=17;break}if(i$=t$[n$],!((o$=r$(Vh,i$))instanceof og)){s$.next=11;break}if((o$=Wh(o$.deref()))===Vh){s$.next=10;break}return s$.next=10,o$;case 10:return s$.abrupt("return");case 11:if(o$===Vh){s$.next=14;break}return s$.next=14,o$;case 14:n$++,s$.next=2;break;case 17:case"end":return s$.stop()}},ys)}function pg(e$,t$){return t$!=null&&typeof t$[Symbol.iterator]=="function"?Fl(pg(e$),t$):function(r$){var n$=r$[2];return zs(r$,function(i$,o$){return n$(i$,e$(o$))})}}function Ac(e$){return Object.prototype.toString.call(e$).slice(8,-1)}function yd(e$){return Ac(e$)==="Object"&&e$.constructor===Object&&Object.getPrototypeOf(e$)===Object.prototype}function Il(e$){var t$;return(t$=Ac(e$)==="Boolean"||Ac(e$)==="Null"||Ac(e$)==="Undefined")||(t$=Ac(e$)==="Number"&&!isNaN(e$)),t$||Ac(e$)==="String"||Ac(e$)==="Symbol"}function zd(e$){var t$=-1,r$=e$==null?0:e$.length;for(this.clear();++t$<r$;){var n$=e$[t$];this.set(n$[0],n$[1])}}function ce(e$){var t$=-1,r$=e$==null?0:e$.length;for(this.clear();++t$<r$;){var n$=e$[t$];this.set(n$[0],n$[1])}}function de(e$){var t$=-1,r$=e$==null?0:e$.length;for(this.clear();++t$<r$;){var n$=e$[t$];this.set(n$[0],n$[1])}}function gf(e$){var t$=-1,r$=e$==null?0:e$.length;for(this.__data__=new qg;++t$<r$;)this.add(e$[t$])}function ee(e$){this.size=(this.__data__=new rg(e$)).size}function fe(e$,t$,r$,n$,i$,o$){var s$,a$=1&t$,c$=2&t$,u$=4&t$;if(r$&&(s$=i$?r$(e$,n$,i$,o$):r$(e$)),s$!==void 0)return s$;if(!lb(e$))return e$;if(n$=Va(e$)){if(s$=As(e$),!a$)return Xh(e$,s$)}else{var l$=hf(e$),d$=l$=="[object Function]"||l$=="[object GeneratorFunction]";if(jf(e$))return Jl(e$,a$);if(l$=="[object Object]"||l$=="[object Arguments]"||d$&&!i$){if(s$=c$||d$?{}:Kl(e$),!a$)return c$?Bs(e$,Cs(s$,e$)):Ds(e$,Es(s$,e$))}else{if(!wa[l$])return i$?e$:{};s$=Fs(e$,l$,a$)}}if(o$||(o$=new ge),i$=o$.get(e$))return i$;o$.set(e$,s$),Gs(e$)?e$.forEach(function(p$){s$.add(fe(p$,t$,r$,p$,e$,o$))}):Hs(e$)&&e$.forEach(function(p$,_$){s$.set(_$,fe(p$,t$,r$,_$,e$,o$))}),c$=u$?c$?Ll:Yh:c$?kf:Ad;var h$=n$?void 0:c$(e$);return Is(h$||e$,function(p$,_$){h$&&(p$=e$[_$=p$]),Ml(s$,_$,fe(p$,t$,r$,_$,e$,o$))}),s$}function Zh(e$,t$){if(typeof e$!="function"||t$!=null&&typeof t$!="function")throw new TypeError("Expected a function");var r$=function n$(){var i$=arguments,o$=t$?t$.apply(this,i$):i$[0],s$=n$.cache;return s$.has(o$)?s$.get(o$):(i$=e$.apply(this,i$),n$.cache=s$.set(o$,i$)||s$,i$)};return r$.cache=new(Zh.Cache||qg),r$}function Nl(e$){if(typeof e$=="string")return e$;if(Va(e$))return he(e$,Nl)+"";if(ie(e$))return Ol?Ol.call(e$):"";var t$=e$+"";return t$=="0"&&1/e$==-Js?"-0":t$}function $h(e$,t$,r$,n$,i$){var o$=-1,s$=e$.length;for(r$||(r$=Ks),i$||(i$=[]);++o$<s$;){var a$=e$[o$];r$(a$)?ai(i$,a$):i$[i$.length]=a$}return i$}function je(e$,t$,r$,n$,i$){if(e$===t$)t$=!0;else if(e$==null||t$==null||!gc(e$)&&!gc(t$))t$=e$!=e$&&t$!=t$;else e:{var o$=Va(e$),s$=Va(t$),a$=o$?"[object Array]":hf(e$),c$=s$?"[object Array]":hf(t$),u$=(a$=a$=="[object Arguments]"?"[object Object]":a$)=="[object Object]";if(s$=(c$=c$=="[object Arguments]"?"[object Object]":c$)=="[object Object]",(c$=a$==c$)&&jf(e$)){if(!jf(t$)){t$=!1;break e}o$=!0,u$=!1}if(c$&&!u$)i$||(i$=new ge),t$=o$||bi(e$)?Pl(e$,t$,r$,n$,je,i$):Ls(e$,t$,a$,r$,n$,je,i$);else{if(!(1&r$)&&(o$=u$&&Ql.call(e$,"__wrapped__"),a$=s$&&Ql.call(t$,"__wrapped__"),o$||a$)){e$=o$?e$.value():e$,t$=a$?t$.value():t$,i$||(i$=new ge),t$=je(e$,t$,r$,n$,i$);break e}if(c$)t:if(i$||(i$=new ge),o$=1&r$,a$=Yh(e$),s$=a$.length,c$=Yh(t$).length,s$==c$||o$){for(c$=s$;c$--;){var l$=a$[c$];if(!(o$?l$ in t$:Ms.call(t$,l$))){t$=!1;break t}}if(u$=i$.get(e$),l$=i$.get(t$),u$&&l$)t$=u$==t$&&l$==e$;else{u$=!0,i$.set(e$,t$),i$.set(t$,e$);for(var d$=o$;++c$<s$;){var h$=e$[l$=a$[c$]],p$=t$[l$];if(n$)var _$=o$?n$(p$,h$,l$,t$,e$,i$):n$(h$,p$,l$,e$,t$,i$);if(_$===void 0?h$!==p$&&!je(h$,p$,r$,n$,i$):!_$){u$=!1;break}d$||(d$=l$=="constructor")}u$&&!d$&&(r$=e$.constructor)!=(n$=t$.constructor)&&"constructor"in e$&&"constructor"in t$&&!(typeof r$=="function"&&r$ instanceof r$&&typeof n$=="function"&&n$ instanceof n$)&&(u$=!1),i$.delete(e$),i$.delete(t$),t$=u$}}else t$=!1;else t$=!1}}return t$}function xa(e$,t$,r$){this.low=0|e$,this.high=0|t$,this.unsigned=!!r$}function mb(e$){return(e$&&e$.__isLong__)===!0}function Bd(e$,t$){var r$;if(t$){if((t$=0<=(e$>>>=0)&&256>e$)&&(r$=Rl[e$]))return r$;r$=ya(e$,0>(0|e$)?-1:0,!0),t$&&(Rl[e$]=r$)}else{if((t$=-128<=(e$|=0)&&128>e$)&&(r$=Sl[e$]))return r$;r$=ya(e$,0>e$?-1:0,!1),t$&&(Sl[e$]=r$)}return r$}function Gb(e$,t$){if(isNaN(e$))return t$?Cd:Hb;if(t$){if(0>e$)return Cd;if(e$>=Tl)return Ul}else{if(e$<=-Vl)return nb;if(e$+1>=Vl)return Wl}return 0>e$?Gb(-e$,t$).neg():ya(e$%ke|0,e$/ke|0,t$)}function ya(e$,t$,r$){return new xa(e$,t$,r$)}function ci(e$,t$,r$){if(e$.length===0)throw Error("empty string");if(e$==="NaN"||e$==="Infinity"||e$==="+Infinity"||e$==="-Infinity")return Hb;if(typeof t$=="number"?(r$=t$,t$=!1):t$=!!t$,2>(r$=r$||10)||36<r$)throw RangeError("radix");var n$;if(0<(n$=e$.indexOf("-")))throw Error("interior hyphen");if(n$===0)return ci(e$.substring(1),t$,r$).neg();n$=Gb(sg(r$,8));for(var i$=Hb,o$=0;o$<e$.length;o$+=8){var s$=Math.min(8,e$.length-o$),a$=parseInt(e$.substring(o$,o$+s$),r$);8>s$?(s$=Gb(sg(r$,s$)),i$=i$.mul(s$).add(Gb(a$))):i$=(i$=i$.mul(n$)).add(Gb(a$))}return i$.unsigned=t$,i$}function Wb(e$,t$){return typeof e$=="number"?Gb(e$,t$):typeof e$=="string"?ci(e$,t$):ya(e$.low,e$.high,typeof t$=="boolean"?t$:e$.unsigned)}function O(e$,t$){function r$(){this.constructor=e$}di(e$,t$),e$.prototype=t$===null?Object.create(t$):(r$.prototype=t$.prototype,new r$)}function le(e$){return typeof e$=="function"}function me(e$){setTimeout(function(){throw e$},0)}function ei(e$){return e$!==null&&X(e$)==="object"}function Xl(e$){return e$.reduce(function(t$,r$){return t$.concat(r$ instanceof lf?r$.errors:r$)},[])}function fi(e$){for(;e$;){var t$=e$.destination,r$=e$.isStopped;if(e$.closed||r$)return!1;e$=t$&&t$ instanceof ia?t$:null}return!0}function Yc(e$){return e$}function gi(){for(var e$=[],t$=0;t$<arguments.length;t$++)e$[t$]=arguments[t$];return Yl(e$)}function Yl(e$){return e$.length===0?Yc:e$.length===1?e$[0]:function(t$){return e$.reduce(function(r$,n$){return n$(r$)},t$)}}function Zl(e$){if(e$||(e$=Ib.Promise||Promise),!e$)throw Error("no Promise impl found");return e$}function $l(){return function(e$){return e$.lift(new Ns(e$))}}function mf(e$){return e$?Os(e$):vb}function Os(e$){return new Y(function(t$){return e$.schedule(function(){return t$.complete()})})}function Zc(e$){return e$&&typeof e$.schedule=="function"}function hi(e$,t$){return new Y(function(r$){var n$=new Oa,i$=0;return n$.add(t$.schedule(function(){i$===e$.length?r$.complete():(r$.next(e$[i$++]),r$.closed||n$.add(this.schedule()))})),n$})}function nf(e$,t$){return t$?hi(e$,t$):new Y(am(e$))}function bb(){for(var e$=[],t$=0;t$<arguments.length;t$++)e$[t$]=arguments[t$];return Zc(t$=e$[e$.length-1])?(e$.pop(),hi(e$,t$)):nf(e$)}function Z(e$,t$){return new Y(t$?function(r$){return t$.schedule(Ps,0,{error:e$,subscriber:r$})}:function(r$){return r$.error(e$)})}function Ps(e$){e$.subscriber.error(e$.error)}function Qs(e$,t$){return t$===void 0&&(t$=0),function(r$){return r$.lift(new Rs(e$,t$))}}function bm(e$){return e$ in ii&&(delete ii[e$],!0)}function hc(){}function ba(e$,t$){return function(r$){if(typeof e$!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r$.lift(new Ss(e$,t$))}}function cm(e$,t$,r$){if(t$){if(!Zc(t$))return function(){for(var n$=[],i$=0;i$<arguments.length;i$++)n$[i$]=arguments[i$];return cm(e$,r$).apply(void 0,n$).pipe(ba(function(o$){return Jb(o$)?t$.apply(void 0,o$):t$(o$)}))};r$=t$}return function(){for(var n$=[],i$=0;i$<arguments.length;i$++)n$[i$]=arguments[i$];var o$,s$=this,a$={context:s$,subject:o$,callbackFunc:e$,scheduler:r$};return new Y(function(c$){if(r$)return r$.schedule(Ts,0,{args:n$,subscriber:c$,params:a$});if(!o$){o$=new of;try{e$.apply(s$,n$.concat([function(){for(var u$=[],l$=0;l$<arguments.length;l$++)u$[l$]=arguments[l$];o$.next(1>=u$.length?u$[0]:u$),o$.complete()}]))}catch(u$){fi(o$)?o$.error(u$):console.warn(u$)}}return o$.subscribe(c$)})}}function Ts(e$){var t$=this,r$=e$.args,n$=e$.subscriber,i$=e$.params;e$=i$.callbackFunc;var o$=i$.context,s$=i$.scheduler,a$=i$.subject;if(!a$){a$=i$.subject=new of,i$=function(){for(var c$=[],u$=0;u$<arguments.length;u$++)c$[u$]=arguments[u$];t$.add(s$.schedule(Us,0,{value:1>=c$.length?c$[0]:c$,subject:a$}))};try{e$.apply(o$,r$.concat([i$]))}catch(c$){a$.error(c$)}}this.add(a$.subscribe(n$))}function Us(e$){var t$=e$.subject;t$.next(e$.value),t$.complete()}function dm(e$,t$,r$){if(t$){if(!Zc(t$))return function(){for(var n$=[],i$=0;i$<arguments.length;i$++)n$[i$]=arguments[i$];return dm(e$,r$).apply(void 0,n$).pipe(ba(function(o$){return Jb(o$)?t$.apply(void 0,o$):t$(o$)}))};r$=t$}return function(){for(var n$=[],i$=0;i$<arguments.length;i$++)n$[i$]=arguments[i$];var o$={subject:void 0,args:n$,callbackFunc:e$,scheduler:r$,context:this};return new Y(function(s$){var a$=o$.context,c$=o$.subject;if(r$)return r$.schedule(Vs,0,{params:o$,subscriber:s$,context:a$});if(!c$){c$=o$.subject=new of;try{e$.apply(a$,n$.concat([function(){for(var u$=[],l$=0;l$<arguments.length;l$++)u$[l$]=arguments[l$];(l$=u$.shift())?c$.error(l$):(c$.next(1>=u$.length?u$[0]:u$),c$.complete())}]))}catch(u$){fi(c$)?c$.error(u$):console.warn(u$)}}return c$.subscribe(s$)})}}function Vs(e$){var t$=this,r$=e$.params,n$=e$.subscriber;e$=e$.context;var i$=r$.callbackFunc,o$=r$.args,s$=r$.scheduler,a$=r$.subject;if(!a$){a$=r$.subject=new of,r$=function(){for(var c$=[],u$=0;u$<arguments.length;u$++)c$[u$]=arguments[u$];(u$=c$.shift())?t$.add(s$.schedule(em,0,{err:u$,subject:a$})):t$.add(s$.schedule(Ws,0,{value:1>=c$.length?c$[0]:c$,subject:a$}))};try{i$.apply(e$,o$.concat([r$]))}catch(c$){this.add(s$.schedule(em,0,{err:c$,subject:a$}))}}this.add(a$.subscribe(n$))}function Ws(e$){var t$=e$.subject;t$.next(e$.value),t$.complete()}function em(e$){e$.subject.error(e$.err)}function fm(e$){return!!e$&&typeof e$.subscribe!="function"&&typeof e$.then=="function"}function ji(e$,t$,r$,n$,i$){if(i$===void 0&&(i$=new Xs(e$,r$,n$)),!i$.closed)return t$ instanceof Y?t$.subscribe(i$):pf(t$)(i$)}function Ys(e$,t$){return new Y(function(r$){var n$=new Oa;return n$.add(t$.schedule(function(){var i$=e$[ne]();n$.add(i$.subscribe({next:function(o$){n$.add(t$.schedule(function(){return r$.next(o$)}))},error:function(o$){n$.add(t$.schedule(function(){return r$.error(o$)}))},complete:function(){n$.add(t$.schedule(function(){return r$.complete()}))}}))})),n$})}function Zs(e$,t$){return new Y(function(r$){var n$=new Oa;return n$.add(t$.schedule(function(){return e$.then(function(i$){n$.add(t$.schedule(function(){r$.next(i$),n$.add(t$.schedule(function(){return r$.complete()}))}))},function(i$){n$.add(t$.schedule(function(){return r$.error(i$)}))})})),n$})}function $s(e$,t$){if(!e$)throw Error("Iterable cannot be null");return new Y(function(r$){var n$,i$=new Oa;return i$.add(function(){n$&&typeof n$.return=="function"&&n$.return()}),i$.add(t$.schedule(function(){n$=e$[$c](),i$.add(t$.schedule(function(){if(!r$.closed){try{var o$=n$.next(),s$=o$.value,a$=o$.done}catch(c$){return void r$.error(c$)}a$?r$.complete():(r$.next(s$),this.schedule())}}))})),i$})}function gm(e$,t$){if(e$!=null){if(e$&&typeof e$[ne]=="function")return Ys(e$,t$);if(fm(e$))return Zs(e$,t$);if(hm(e$))return hi(e$,t$);if(e$&&typeof e$[$c]=="function"||typeof e$=="string")return $s(e$,t$)}throw new TypeError((e$!==null&&X(e$)||e$)+" is not observable")}function Kb(e$,t$){return t$?gm(e$,t$):e$ instanceof Y?e$:new Y(pf(e$))}function ic(e$,t$){if(!t$.closed){if(e$ instanceof Y)return e$.subscribe(t$);try{var r$=pf(e$)(t$)}catch(n$){t$.error(n$)}return r$}}function cb(e$,t$,r$){return r$===void 0&&(r$=Number.POSITIVE_INFINITY),typeof t$=="function"?function(n$){return n$.pipe(cb(function(i$,o$){return Kb(e$(i$,o$)).pipe(ba(function(s$,a$){return t$(i$,s$,o$,a$)}))},r$))}:(typeof t$=="number"&&(r$=t$),function(n$){return n$.lift(new at(e$,r$))})}function tg(e$){return e$===void 0&&(e$=Number.POSITIVE_INFINITY),cb(Yc,e$)}function im(){for(var e$=[],t$=0;t$<arguments.length;t$++)e$[t$]=arguments[t$];return tg(1)(bb.apply(void 0,e$))}function ad(e$){return new Y(function(t$){try{var r$=e$()}catch(n$){return void t$.error(n$)}return(r$?Kb(r$):mf()).subscribe(t$)})}function jm(){for(var e$=[],t$=0;t$<arguments.length;t$++)e$[t$]=arguments[t$];if(e$.length===1){var r$=e$[0];if(Jb(r$))return ug(r$,null);if(ei(r$)&&Object.getPrototypeOf(r$)===Object.prototype)return ug((e$=Object.keys(r$)).map(function(i$){return r$[i$]}),e$)}if(typeof e$[e$.length-1]=="function"){var n$=e$.pop();return ug(e$=e$.length===1&&Jb(e$[0])?e$[0]:e$,null).pipe(ba(function(i$){return n$.apply(void 0,i$)}))}return ug(e$,null)}function ug(e$,t$){return new Y(function(r$){var n$=e$.length;if(n$===0)r$.complete();else for(var i$=Array(n$),o$=0,s$=0,a$=function(u$){var l$=Kb(e$[u$]),d$=!1;r$.add(l$.subscribe({next:function(h$){d$||(d$=!0,s$++),i$[u$]=h$},error:function(h$){return r$.error(h$)},complete:function(){++o$!==n$&&d$||(s$===n$&&r$.next(t$?t$.reduce(function(h$,p$,_$){return h$[p$]=i$[_$],h$},{}):i$),r$.complete())}}))},c$=0;c$<n$;c$++)a$(c$)})}function gb(e$,t$,r$,n$){return le(r$)&&(n$=r$,r$=void 0),n$?gb(e$,t$,r$).pipe(ba(function(i$){return Jb(i$)?n$.apply(void 0,i$):n$(i$)})):new Y(function(i$){km(e$,t$,function(o$){1<arguments.length?i$.next(Array.prototype.slice.call(arguments)):i$.next(o$)},i$,r$)})}function km(e$,t$,r$,n$,i$){if(e$&&typeof e$.addEventListener=="function"&&typeof e$.removeEventListener=="function"){e$.addEventListener(t$,r$,i$);var o$=function(){return e$.removeEventListener(t$,r$,i$)}}else if(e$&&typeof e$.on=="function"&&typeof e$.off=="function")e$.on(t$,r$),o$=function(){return e$.off(t$,r$)};else if(e$&&typeof e$.addListener=="function"&&typeof e$.removeListener=="function")e$.addListener(t$,r$),o$=function(){return e$.removeListener(t$,r$)};else{if(!e$||!e$.length)throw new TypeError("Invalid event target");for(var s$=0,a$=e$.length;s$<a$;s$++)km(e$[s$],t$,r$,n$,i$)}n$.add(o$)}function lm(e$,t$,r$){return r$?lm(e$,t$).pipe(ba(function(n$){return Jb(n$)?r$.apply(void 0,n$):r$(n$)})):new Y(function(n$){var i$=function(){for(var s$=[],a$=0;a$<arguments.length;a$++)s$[a$]=arguments[a$];return n$.next(s$.length===1?s$[0]:s$)};try{var o$=e$(i$)}catch(s$){return void n$.error(s$)}if(le(t$))return function(){return t$(i$,o$)}})}function bt(e$){var t$=e$.subscriber,r$=e$.condition;if(!t$.closed){if(e$.needIterate)try{e$.state=e$.iterate(e$.state)}catch(o$){return void t$.error(o$)}else e$.needIterate=!0;if(r$){var n$=void 0;try{n$=r$(e$.state)}catch(o$){return void t$.error(o$)}if(!n$)return void t$.complete();if(t$.closed)return}try{var i$=e$.resultSelector(e$.state)}catch(o$){return void t$.error(o$)}if(!t$.closed&&(t$.next(i$),!t$.closed))return this.schedule(e$)}}function ki(e$){return!Jb(e$)&&0<=e$-parseFloat(e$)+1}function mm(e$,t$){return e$===void 0&&(e$=0),t$===void 0&&(t$=bd),(!ki(e$)||0>e$)&&(e$=0),t$&&typeof t$.schedule=="function"||(t$=bd),new Y(function(r$){return r$.add(t$.schedule(ct,e$,{subscriber:r$,counter:0,period:e$})),r$})}function ct(e$){var t$=e$.subscriber,r$=e$.counter;e$=e$.period,t$.next(r$),this.schedule({subscriber:t$,counter:r$+1,period:e$},e$)}function Xb(){for(var e$=[],t$=0;t$<arguments.length;t$++)e$[t$]=arguments[t$];t$=Number.POSITIVE_INFINITY;var r$=null,n$=e$[e$.length-1];return Zc(n$)?(r$=e$.pop(),1<e$.length&&typeof e$[e$.length-1]=="number"&&(t$=e$.pop())):typeof n$=="number"&&(t$=e$.pop()),r$===null&&e$.length===1&&e$[0]instanceof Y?e$[0]:tg(t$)(nf(e$,r$))}function li(){for(var e$=[],t$=0;t$<arguments.length;t$++)e$[t$]=arguments[t$];if(e$.length===0)return vb;var r$=e$[0],n$=e$.slice(1);return e$.length===1&&Jb(r$)?li.apply(void 0,r$):new Y(function(i$){var o$=function(){return i$.add(li.apply(void 0,n$).subscribe(i$))};return Kb(r$).subscribe({next:function(s$){i$.next(s$)},error:o$,complete:o$})})}function dt(e$){var t$=e$.keys,r$=e$.index,n$=e$.subscriber,i$=e$.subscription;if(e$=e$.obj,!n$.closed)if(r$<t$.length){var o$=t$[r$];n$.next([o$,e$[o$]]),i$.add(this.schedule({keys:t$,index:r$+1,subscriber:n$,subscription:i$,obj:e$}))}else n$.complete()}function et(e$,t$){function r$(){return!r$.pred.apply(r$.thisArg,arguments)}return r$.pred=e$,r$.thisArg=t$,r$}function wb(e$,t$){return function(r$){return r$.lift(new ft(e$,t$))}}function Ca(){for(var e$=[],t$=0;t$<arguments.length;t$++)e$[t$]=arguments[t$];if(e$.length===1){if(!Jb(e$[0]))return e$[0];e$=e$[0]}return nf(e$,void 0).lift(new gt)}function ht(e$){var t$=e$.start,r$=e$.index,n$=e$.subscriber;r$>=e$.count?n$.complete():(n$.next(t$),n$.closed||(e$.index=r$+1,e$.start=t$+1,this.schedule(e$)))}function Bc(e$,t$,r$){e$===void 0&&(e$=0);var n$=-1;return ki(t$)?n$=1>Number(t$)?1:Number(t$):Zc(t$)&&(r$=t$),Zc(r$)||(r$=bd),new Y(function(i$){var o$=ki(e$)?e$:+e$-r$.now();return r$.schedule(it,o$,{index:0,period:n$,subscriber:i$})})}function it(e$){var t$=e$.index,r$=e$.period,n$=e$.subscriber;if(n$.next(t$),!n$.closed){if(r$===-1)return n$.complete();e$.index=t$+1,this.schedule(e$,r$)}}function mi(){for(var e$=[],t$=0;t$<arguments.length;t$++)e$[t$]=arguments[t$];return typeof(t$=e$[e$.length-1])=="function"&&e$.pop(),nf(e$,void 0).lift(new jt(t$))}function Ga(e$){return function(t$){var r$=new kt(e$);return t$=t$.lift(r$),r$.caught=t$}}function ni(e$,t$){return cb(e$,t$,1)}function nm(e$){return e$===void 0&&(e$=null),function(t$){return t$.lift(new lt(e$))}}function cd(e$,t$){t$===void 0&&(t$=bd);var r$=e$ instanceof Date&&!isNaN(+e$)?+e$-t$.now():Math.abs(e$);return function(n$){return n$.lift(new mt(r$,t$))}}function om(e$,t$){return function(r$){return r$.lift(new nt(e$,t$))}}function Dd(e$){return e$===void 0&&(e$=ot),function(t$){return t$.lift(new pt(e$))}}function ot(){return new vg}function Ka(e$){return function(t$){return e$===0?mf():t$.lift(new qt(e$))}}function pm(e$,t$){return t$?function(r$){return r$.pipe(pm(function(n$,i$){return Kb(e$(n$,i$)).pipe(ba(function(o$,s$){return t$(n$,o$,i$,s$)}))}))}:function(r$){return r$.lift(new rt(e$))}}function wg(e$){return function(t$){return t$.lift(new st(e$))}}function aa(e$,t$){var r$=2<=arguments.length;return function(n$){return n$.pipe(e$?wb(function(i$,o$){return e$(i$,o$,n$)}):Yc,Ka(1),r$?nm(t$):Dd(function(){return new vg}))}}function tt(){return function(e$){return e$.lift(new ut)}}function qm(e$){return function(t$){return e$===0?mf():t$.lift(new vt(e$))}}function qf(e$){return function(t$){return t$.lift(new wt(e$))}}function xg(e$,t$){var r$=!1;return 2<=arguments.length&&(r$=!0),function(n$){return n$.lift(new xt(e$,t$,r$))}}function rm(e$,t$){return 2<=arguments.length?function(r$){return gi(xg(e$,t$),qm(1),nm(t$))(r$)}:function(r$){return gi(xg(function(n$,i$,o$){return e$(n$,i$,o$+1)}),qm(1))(r$)}}function yt(e$,t$){return function(r$){var n$=typeof e$=="function"?e$:function(){return e$},i$=Object.create(r$,At);return i$.source=r$,i$.subjectFactory=n$,i$}}function oe(e$){return function(t$){return t$.lift(new Bt(e$,t$))}}function Ct(){return new Pa}function pe(){return function(e$){return $l()(yt(Ct)(e$))}}function sm(e$,t$,r$){var n$=e$&&X(e$)==="object"?e$:{bufferSize:e$,windowTime:t$,refCount:!1,scheduler:r$};return function(i$){return i$.lift(Dt(n$))}}function Dt(e$){var t$,r$,n$=e$.bufferSize,i$=n$===void 0?Number.POSITIVE_INFINITY:n$,o$=(n$=e$.windowTime)===void 0?Number.POSITIVE_INFINITY:n$,s$=e$.refCount,a$=e$.scheduler,c$=0,u$=!1,l$=!1;return function(d$){if(c$++,!t$||u$){u$=!1;var h$=(t$=new qe(i$,o$,a$)).subscribe(this);r$=d$.subscribe({next:function(p$){t$.next(p$)},error:function(p$){u$=!0,t$.error(p$)},complete:function(){l$=!0,r$=void 0,t$.complete()}}),l$&&(r$=void 0)}else h$=t$.subscribe(this);this.add(function(){c$--,h$.unsubscribe(),h$=void 0,r$&&!l$&&s$&&c$===0&&(r$.unsubscribe(),t$=r$=void 0)})}}function Cc(e$,t$){return typeof t$=="function"?function(r$){return r$.pipe(Cc(function(n$,i$){return Kb(e$(n$,i$)).pipe(ba(function(o$,s$){return t$(n$,o$,i$,s$)}))}))}:function(r$){return r$.lift(new Et(e$))}}function ob(e$){return function(t$){return t$.lift(new Ft(e$))}}function Gt(e$,t$){return t$===void 0&&(t$=!1),function(r$){return r$.lift(new Ht(e$,t$))}}function ca(e$,t$,r$){return function(n$){return n$.lift(new It(e$,t$,r$))}}function Jt(e$,t$,r$){return t$===void 0&&(t$=bd),r$===void 0&&(r$=Kt),function(n$){return n$.lift(new Lt(e$,t$,r$.leading,r$.trailing))}}function Mt(e$){e$.subscriber.clearThrottle()}function Nt(e$,t$,r$){return r$===void 0&&(r$=bd),function(n$){var i$=e$ instanceof Date&&!isNaN(+e$),o$=i$?+e$-r$.now():Math.abs(e$);return n$.lift(new Ot(o$,i$,t$,r$))}}function hb(e$,t$){return t$===void 0&&(t$=bd),Nt(e$,Z(new pb),t$)}function Pt(){for(var e$=[],t$=0;t$<arguments.length;t$++)e$[t$]=arguments[t$];return function(r$){var n$;return typeof e$[e$.length-1]=="function"&&(n$=e$.pop()),r$.lift(new Qt(e$,n$))}}function tm(e$,t$,r$,n$,i$){e$!==t$&&um(t$,function(o$,s$){if(i$||(i$=new ge),lb(o$)){o$=i$;var a$=oi(e$,s$),c$=oi(t$,s$),u$=o$.get(c$);if(u$)pi(e$,s$,u$);else{var l$=(u$=n$?n$(a$,c$,s$+"",e$,t$,o$):void 0)===void 0;if(l$){var d$=Va(c$),h$=!d$&&jf(c$),p$=!d$&&!h$&&bi(c$);u$=c$,d$||h$||p$?Va(a$)?u$=a$:gc(a$)&&Ed(a$)?u$=Xh(a$):h$?(l$=!1,u$=Jl(c$,!0)):p$?(l$=!1,u$=vm(c$,!0)):u$=[]:wm(c$)||rf(c$)?(u$=a$,rf(a$)?u$=re(a$,kf(a$)):lb(a$)&&!qi(a$)||(u$=Kl(c$))):l$=!1}l$&&(o$.set(c$,u$),tm(u$,c$,r$,n$,o$),o$.delete(c$)),pi(e$,s$,u$)}}else(a$=n$?n$(oi(e$,s$),o$,s$+"",e$,t$,i$):void 0)===void 0&&(a$=o$),pi(e$,s$,a$)},kf)}function Rt(e$){var t$=1,r$=ri;(1>=arguments.length?0:arguments.length-1)==1?typeof(1>=arguments.length?void 0:arguments[1])=="number"?t$=1>=arguments.length?void 0:arguments[1]:r$=1>=arguments.length?void 0:arguments[1]:(1>=arguments.length?0:arguments.length-1)==2&&(t$=1>=arguments.length?void 0:arguments[1],r$=2>=arguments.length?void 0:arguments[2]);var n$=t$||1;return function(i$){return i$.pipe(xg(function(o$,s$){var a$=r$.now(),c$=a$-e$;if((o$=o$.filter(function(d$){return d$.until>c$})).length>=n$){var u$=o$[o$.length-1],l$=o$[0].until+e$*Math.floor(o$.length/n$);o$.push({delay:u$.until<a$?l$-a$:l$-u$.until,until:l$,value:s$})}else o$.push({delay:0,until:a$,value:s$});return o$},[]),ba(function(o$){return o$[o$.length-1]}),ni(function(o$){var s$=bb(o$.value);return o$.delay?s$.pipe(cd(o$.delay,r$)):s$}))}}function St(e$,t$){var r$=(t$=t$===void 0?{protocols:xm,makeWebSocket:ym}:t$).protocols,n$=r$===void 0?xm:r$,i$=(t$=t$.makeWebSocket)===void 0?ym:t$;return new Y(function(o$){var s$,a$=new Pa,c$=i$(e$,n$),u$=!1,l$=!1,d$=function(h$){if(s$)throw u$=!0,h$=Error("Web socket message factory function called more than once"),o$.error(h$),h$;return s$=h$.subscribe(function(p$){c$.send(p$)}),a$};return c$.onopen=function(){l$?(u$=!0,c$.close()):o$.next(d$)},c$.onmessage=function(h$){a$.next(h$.data)},c$.onerror=function(h$){u$=!0,o$.error(Error(h$.message))},c$.onclose=function(h$){u$||(u$=!0,l$?(o$.complete(),a$.complete()):o$.error(Error(h$.code===1e3?"Normal closure":h$.reason)))},function(){l$=!0,s$&&s$.unsubscribe(),u$||(u$=!0,c$.close())}})}function yg(){this._listeners={}}function zm(e$){return typeof Float32Array<"u"?function(){function t$(c$,u$,l$){o$[0]=c$,u$[l$]=s$[0],u$[l$+1]=s$[1],u$[l$+2]=s$[2],u$[l$+3]=s$[3]}function r$(c$,u$,l$){o$[0]=c$,u$[l$]=s$[3],u$[l$+1]=s$[2],u$[l$+2]=s$[1],u$[l$+3]=s$[0]}function n$(c$,u$){return s$[0]=c$[u$],s$[1]=c$[u$+1],s$[2]=c$[u$+2],s$[3]=c$[u$+3],o$[0]}function i$(c$,u$){return s$[3]=c$[u$],s$[2]=c$[u$+1],s$[1]=c$[u$+2],s$[0]=c$[u$+3],o$[0]}var o$=new Float32Array([-0]),s$=new Uint8Array(o$.buffer),a$=s$[3]===128;e$.writeFloatLE=a$?t$:r$,e$.writeFloatBE=a$?r$:t$,e$.readFloatLE=a$?n$:i$,e$.readFloatBE=a$?i$:n$}():function(){function t$(n$,i$,o$,s$){var a$=0>i$?1:0;if(a$&&(i$=-i$),i$===0)n$(0<1/i$?0:2147483648,o$,s$);else if(isNaN(i$))n$(2143289344,o$,s$);else if(34028234663852886e22<i$)n$((a$<<31|2139095040)>>>0,o$,s$);else if(11754943508222875e-54>i$)n$((a$<<31|Math.round(i$/1401298464324817e-60))>>>0,o$,s$);else{var c$=Math.floor(Math.log(i$)/Math.LN2);n$((a$<<31|c$+127<<23|8388607&Math.round(i$*Math.pow(2,-c$)*8388608))>>>0,o$,s$)}}function r$(n$,i$,o$){return o$=n$(i$,o$),n$=2*(o$>>31)+1,i$=o$>>>23&255,o$&=8388607,i$===255?o$?NaN:1/0*n$:i$===0?1401298464324817e-60*n$*o$:n$*Math.pow(2,i$-150)*(o$+8388608)}e$.writeFloatLE=t$.bind(null,Am),e$.writeFloatBE=t$.bind(null,Bm),e$.readFloatLE=r$.bind(null,Cm),e$.readFloatBE=r$.bind(null,Dm)}(),typeof Float64Array<"u"?function(){function t$(c$,u$,l$){o$[0]=c$,u$[l$]=s$[0],u$[l$+1]=s$[1],u$[l$+2]=s$[2],u$[l$+3]=s$[3],u$[l$+4]=s$[4],u$[l$+5]=s$[5],u$[l$+6]=s$[6],u$[l$+7]=s$[7]}function r$(c$,u$,l$){o$[0]=c$,u$[l$]=s$[7],u$[l$+1]=s$[6],u$[l$+2]=s$[5],u$[l$+3]=s$[4],u$[l$+4]=s$[3],u$[l$+5]=s$[2],u$[l$+6]=s$[1],u$[l$+7]=s$[0]}function n$(c$,u$){return s$[0]=c$[u$],s$[1]=c$[u$+1],s$[2]=c$[u$+2],s$[3]=c$[u$+3],s$[4]=c$[u$+4],s$[5]=c$[u$+5],s$[6]=c$[u$+6],s$[7]=c$[u$+7],o$[0]}function i$(c$,u$){return s$[7]=c$[u$],s$[6]=c$[u$+1],s$[5]=c$[u$+2],s$[4]=c$[u$+3],s$[3]=c$[u$+4],s$[2]=c$[u$+5],s$[1]=c$[u$+6],s$[0]=c$[u$+7],o$[0]}var o$=new Float64Array([-0]),s$=new Uint8Array(o$.buffer),a$=s$[7]===128;e$.writeDoubleLE=a$?t$:r$,e$.writeDoubleBE=a$?r$:t$,e$.readDoubleLE=a$?n$:i$,e$.readDoubleBE=a$?i$:n$}():function(){function t$(n$,i$,o$,s$,a$,c$){var u$=0>s$?1:0;if(u$&&(s$=-s$),s$===0)n$(0,a$,c$+i$),n$(0<1/s$?0:2147483648,a$,c$+o$);else if(isNaN(s$))n$(0,a$,c$+i$),n$(2146959360,a$,c$+o$);else if(17976931348623157e292<s$)n$(0,a$,c$+i$),n$((u$<<31|2146435072)>>>0,a$,c$+o$);else if(22250738585072014e-324>s$)n$((s$/=5e-324)>>>0,a$,c$+i$),n$((u$<<31|s$/4294967296)>>>0,a$,c$+o$);else{var l$=Math.floor(Math.log(s$)/Math.LN2);l$===1024&&(l$=1023),n$(4503599627370496*(s$*=Math.pow(2,-l$))>>>0,a$,c$+i$),n$((u$<<31|l$+1023<<20|1048576*s$&1048575)>>>0,a$,c$+o$)}}function r$(n$,i$,o$,s$,a$){return i$=n$(s$,a$+i$),s$=n$(s$,a$+o$),n$=2*(s$>>31)+1,i$=4294967296*(1048575&s$)+i$,(o$=s$>>>20&2047)===2047?i$?NaN:1/0*n$:o$===0?5e-324*n$*i$:n$*Math.pow(2,o$-1075)*(i$+4503599627370496)}e$.writeDoubleLE=t$.bind(null,Am,0,4),e$.writeDoubleBE=t$.bind(null,Bm,4,0),e$.readDoubleLE=r$.bind(null,Cm,0,4),e$.readDoubleBE=r$.bind(null,Dm,4,0)}(),e$}function Am(e$,t$,r$){t$[r$]=255&e$,t$[r$+1]=e$>>>8&255,t$[r$+2]=e$>>>16&255,t$[r$+3]=e$>>>24}function Bm(e$,t$,r$){t$[r$]=e$>>>24,t$[r$+1]=e$>>>16&255,t$[r$+2]=e$>>>8&255,t$[r$+3]=255&e$}function Cm(e$,t$){return(e$[t$]|e$[t$+1]<<8|e$[t$+2]<<16|e$[t$+3]<<24)>>>0}function Dm(e$,t$){return(e$[t$]<<24|e$[t$+1]<<16|e$[t$+2]<<8|e$[t$+3])>>>0}function Wa(e$,t$){this.lo=e$>>>0,this.hi=t$>>>0}function sf(e$,t$,r$){this.fn=e$,this.len=t$,this.next=void 0,this.val=r$}function si(){}function Tt(e$){this.head=e$.head,this.tail=e$.tail,this.len=e$.len,this.next=e$.states}function ja(){this.len=0,this.tail=this.head=new sf(si,0,0),this.states=null}function ti(e$,t$,r$){t$[r$]=255&e$}function ui(e$,t$){this.len=e$,this.next=void 0,this.val=t$}function vi(e$,t$,r$){for(;e$.hi;)t$[r$++]=127&e$.lo|128,e$.lo=(e$.lo>>>7|e$.hi<<25)>>>0,e$.hi>>>=7;for(;127<e$.lo;)t$[r$++]=127&e$.lo|128,e$.lo>>>=7;t$[r$++]=e$.lo}function wi(e$,t$,r$){t$[r$]=255&e$,t$[r$+1]=e$>>>8&255,t$[r$+2]=e$>>>16&255,t$[r$+3]=e$>>>24}function jc(){xi.call(this)}function Ut(e$,t$,r$){40>e$.length?V.utf8.write(e$,t$,r$):t$.utf8Write?t$.utf8Write(e$,r$):t$.write(e$,r$)}function Yb(e$,t$){return RangeError("index out of range: "+e$.pos+" + "+(t$||1)+" > "+e$.len)}function La(e$){this.buf=e$,this.pos=0,this.len=e$.length}function yi(){var e$=new Em(0,0),t$=0;if(!(4<this.len-this.pos)){for(;3>t$;++t$){if(this.pos>=this.len)throw Yb(this);if(e$.lo=(e$.lo|(127&this.buf[this.pos])<<7*t$)>>>0,128>this.buf[this.pos++])return e$}return e$.lo=(e$.lo|(127&this.buf[this.pos++])<<7*t$)>>>0,e$}for(;4>t$;++t$)if(e$.lo=(e$.lo|(127&this.buf[this.pos])<<7*t$)>>>0,128>this.buf[this.pos++])return e$;if(e$.lo=(e$.lo|(127&this.buf[this.pos])<<28)>>>0,e$.hi=(e$.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return e$;if(t$=0,4<this.len-this.pos){for(;5>t$;++t$)if(e$.hi=(e$.hi|(127&this.buf[this.pos])<<7*t$+3)>>>0,128>this.buf[this.pos++])return e$}else for(;5>t$;++t$){if(this.pos>=this.len)throw Yb(this);if(e$.hi=(e$.hi|(127&this.buf[this.pos])<<7*t$+3)>>>0,128>this.buf[this.pos++])return e$}throw Error("invalid varint encoding")}function zg(e$,t$){return(e$[t$-4]|e$[t$-3]<<8|e$[t$-2]<<16|e$[t$-1]<<24)>>>0}function Fm(){if(this.pos+8>this.len)throw Yb(this,8);return new Em(zg(this.buf,this.pos+=4),zg(this.buf,this.pos+=4))}function Fd(e$){zi.call(this,e$)}function tf(e$,t$,r$){if(typeof e$!="function")throw TypeError("rpcImpl must be a function");V.EventEmitter.call(this),this.rpcImpl=e$,this.requestDelimited=!!t$,this.responseDelimited=!!r$}function za(e$){return typeof e$=="string"&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(e$)&&e$!=="null"}function Gm(e$){try{var t$=e$.split(".").map(function(n$){return Number(n$)})}catch{return!1}if(t$.length!==4||t$[0]===0)return!1;for(e$=0;e$<t$.length;e$++){var r$=t$[e$];if(!Number.isInteger(r$)||0>r$||255<r$)return!1}return!0}function Hm(e$,t$){if(!Array.isArray(t$)||t$.length===0||32<t$.length||t$.some(function(r$){return r$.length===0||32<r$.length}))throw new I("arguments is not valid",Ja);if(!za(e$))throw new I("ID is invalid",Ja)}function uf(e$){var t$=e$.attributes,r$=e$.attrSizeMap,n$=e$.maxAttrsCount,i$=e$.maxAttrValueSize;if(e$=e$.maxTotalSize,!yd(t$))throw new I("attributes must be an object",Ja);if(Object.keys(t$).length>n$)throw new ib("Exceed the limit of ".concat(n$," attributes"),se);if(Object.keys(t$).length===0)throw new I("The attributes is an empty object",Ja);var o$=0,s$=0;for(t$=Object.entries(t$);s$<t$.length;s$++){var a$=ra(t$[s$],2),c$=a$[1];a$=new Blob([a$[0]]).size;var u$=new Blob([c$]).size;if(a$===0||32<a$)throw new I("Invalid attribute key",Ja);if(u$>i$)throw new ib("Invalid attribute value, over the limit of ".concat(i$," bytes"),se);if(typeof c$!="string"||c$.length===0)throw new I("Invalid attribute value",Ja);o$+=a$,o$+=u$}if(o$>e$)throw new ib("The attributes size overflow",se);if(r$!==void 0){if(Object.keys(r$).length>n$)throw new ib("Exceed the limit of ".concat(n$," attributes"),se);for(o$=n$=0,r$=Object.entries(r$);o$<r$.length;o$++){if(s$=(t$=ra(r$[o$],2))[1],(t$=new Blob([t$[0]]).size)===0)throw new I("Invalid attribute key",Ja);if(s$>i$)throw new ib("Invalid attribute value, over the limit of ".concat(i$," bytes"),se);n$+=t$,n$+=s$}if(n$>e$)throw new ib("The attributes size overflow",se)}}function Ag(e$,t$){return Math.floor(Math.random()*(Math.floor(t$)-Math.ceil(e$)+1))+e$}function Bg(){var e$=Ag(0,4294967295),t$=Ag(1,4294967295);return new U(e$,t$,!0)}function Xa(e$){return e$.toString().padEnd(32,"0")}function Im(e$,t$){return new TypeError("Unexpected ".concat(e$,": ").concat(t$))}function Jm(e$,t$){return e$=e$.split(".").map(function(r$){return Number(r$)}),t$=t$.split(".").map(function(r$){return Number(r$)}),Math.sqrt(1e3*Math.pow(e$[0]-t$[0],2)+100*Math.pow(e$[1]-t$[1],2)+10*Math.pow(e$[2]-t$[2],2)+1*Math.pow(e$[3]-t$[3],2))}function Km(e$){return e$.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?e$.toNumber():e$.toString()}function Ai(e$,t$){t$="".concat(e$).concat(t$||"");var r$=Lm.get(t$)||1;return Lm.set(t$,r$+1),"".concat(e$).concat(r$)}function Mm(e$,t$){var r$=typeof t$=="number"?t$:t$!==void 0&&typeof t$!="string"?t$.code:void 0;return t$=typeof t$!="number"&&typeof t$!="string"&&t$!==void 0&&t$.serverCode!==void 0?t$.serverCode:void 0,r$="".concat(r$!==void 0?" Error Code ".concat(r$):"").concat(t$!==void 0?", server Code ".concat(t$):""),e$=typeof e$=="string"&&e$?Cg(e$):Array.isArray(e$)&&typeof e$[0]=="string"&&e$[0]?Cg(Nm.apply(void 0,[e$[0]].concat(G(e$.slice(1))))):"","".concat(r$===""?"":"".concat(r$," - ")).concat(e$)}function Om(e$){return Bi.apply(this,arguments)}function Bi(){return(Bi=J(w.mark(function e$(t$){return w.wrap(function(r$){for(;;)switch(r$.prev=r$.next){case 0:return r$.abrupt("return",new Promise(function(n$){setTimeout(function(){n$()},t$)}));case 1:case"end":return r$.stop()}},e$)}))).apply(this,arguments)}function Pm(e$){return e$ instanceof Blob||Object.prototype.toString.call(e$)==="[object Blob]"}function Dg(e$){var t$=255&e$,r$=e$>>8&255,n$=e$>>16&255;return"".concat(e$>>24&255,".").concat(n$,".").concat(r$,".").concat(t$)}function te(e$,t$,r$){return Ci.apply(this,arguments)}function Ci(){return(Ci=J(w.mark(function e$(t$,r$,n$){var i$,o$,s$,a$,c$,u$,l$,d$,h$,p$,_$,f$,m$,g$,v$,y$,S$,b$,$$,C$,N$,k$,O$,U$,x$,F$;return w.wrap(function(L$){for(;;)switch(L$.prev=L$.next){case 0:if(i$=r$.body,o$=r$.headers,s$=o$===void 0?{}:o$,a$=r$.timeout,c$=a$===void 0?1e4:a$,u$=r$.signal,l$=r$.withCredentials,d$=l$!==void 0&&l$,h$=(n$||{}).useBinaryResponse,p$=h$!==void 0&&h$,(_$=new XMLHttpRequest).open("POST",t$,!0),_$.responseType=p$?"arraybuffer":"text",_$.withCredentials=d$,_$.timeout=c$,f$=i$ instanceof FormData,m$=i$ instanceof Uint8Array,!(1<(g$=Object.keys(s$).filter(function(M$){return M$.toLowerCase()==="content-type"})).length)){L$.next=14;break}throw new RangeError("multiple content-type");case 14:g$.length===0&&(m$?s$["Content-Type"]="application/octet-stream":f$||(s$["Content-Type"]="application/json"));case 15:if("setRequestHeader"in _$){L$.next=46;break}return _$.abort(),L$.next=19,fetch(t$,{body:f$||m$?i$:JSON.stringify(i$),cache:"no-cache",credentials:d$?"include":"same-origin",headers:s$,method:"POST",mode:"cors",referrer:"no-referrer",signal:u$});case 19:if(v$=L$.sent,!(200<=(y$=v$.status)&&300>y$||y$===304)){L$.next=31;break}if(!p$){L$.next=27;break}return L$.next=25,v$.arrayBuffer();case 25:return S$=L$.sent,L$.abrupt("return",{status:y$,responseData:S$});case 27:return L$.next=29,v$.text();case 29:return b$=L$.sent,L$.abrupt("return",{status:y$,responseText:b$});case 31:return $$=new da(["Post XHR failure, status %d",y$]),L$.prev=32,L$.next=35,v$.text();case 35:throw C$=L$.sent,$$.statusCode=y$,$$.message=C$||"Request failed, status ".concat(y$),$$;case 41:throw L$.prev=41,L$.t0=L$.catch(32),$$.statusCode=y$,$$.message="Request failed, status ".concat(y$),$$;case 46:if(Object.keys(s$).length!==0)for(N$=0,k$=Object.entries(s$);N$<k$.length;N$++)O$=ra(k$[N$],2),U$=O$[0],x$=O$[1],_$.setRequestHeader(U$,x$);return u$!==void 0&&(F$=function M$(){_$.abort(),u$.removeEventListener("abort",M$)},u$.addEventListener("abort",F$)),f$||m$?_$.send(i$):_$.send(JSON.stringify(i$)),L$.abrupt("return",new Promise(function(M$,V$){_$.onload=function(){var A$=_$.status;if(200<=A$&&300>A$||A$===304)M$(p$?{status:A$,responseData:_$.response}:{status:A$,responseText:_$.responseText});else{var I$=new da(["Post XHR failure, status %d",A$]);I$.statusCode=A$,I$.message=_$.response||"Request failed, status ".concat(_$.status),V$(I$)}},_$.ontimeout=function(A$){V$(new db(["XHR request timed out after %d ms",c$],{originalError:A$}))},_$.onerror=function(){var A$=new da(["Post XHR failure, status %d",_$.status]);A$.statusCode=_$.status,A$.message=_$.response||"Request failed, status ".concat(_$.status),V$(A$)},_$.onabort=function(){try{V$(new DOMException("The request aborted.","AbortError"))}catch{var A$=Error("The request aborted.");A$.name="AbortError",V$(A$)}}}));case 50:case"end":return L$.stop()}},e$,null,[[32,41]])}))).apply(this,arguments)}function Rm(e$){return Hi.apply(this,arguments)}function Hi(){return(Hi=J(w.mark(function e$(t$){var r$;return w.wrap(function(n$){for(;;)switch(n$.prev=n$.next){case 0:return(r$=new Image).src=t$,n$.abrupt("return",new Promise(function(i$,o$){r$.onload=function(){i$({width:r$.width,height:r$.height})},r$.onerror=o$}));case 3:case"end":return n$.stop()}},e$)}))).apply(this,arguments)}function Xt(e$,t$){return Ii.apply(this,arguments)}function Ii(){return(Ii=J(w.mark(function e$(t$,r$){var n$,i$,o$,s$,a$,c$,u$,l$,d$,h$;return w.wrap(function(p$){for(;;)switch(p$.prev=p$.next){case 0:if(n$=t$.thumbnailHeight,i$=n$===void 0?0:n$,o$=t$.thumbnailWidth,s$=o$===void 0?0:o$,a$=t$.width,c$=a$===void 0?0:a$,u$=t$.height,l$=u$===void 0?0:u$,d$=t$.thumbnail,h$=[],typeof i$=="number"&&typeof s$=="number"&&typeof c$=="number"&&typeof l$=="number"){p$.next=5;break}throw new I("Invalid message params",wf);case 5:return 0>=c$&&0>=l$&&h$.push(Rm(Sm(r$)).then(function(_$){c$=_$.width,l$=_$.height})),0>=s$&&0>=i$&&d$!==void 0&&h$.push(Ji(d$).then(function(){var _$=J(w.mark(function f$(m$){var g$;return w.wrap(function(v$){for(;;)switch(v$.prev=v$.next){case 0:return v$.next=2,Rm(Sm(m$));case 2:g$=v$.sent,s$=g$.width,i$=g$.height;case 5:case"end":return v$.stop()}},f$)}));return function(f$){return _$.apply(this,arguments)}}())),p$.next=9,Promise.all(h$).catch(function(){});case 9:return p$.abrupt("return",{width:c$,height:l$,thumbnailWidth:s$,thumbnailHeight:i$});case 10:case"end":return p$.stop()}},e$)}))).apply(this,arguments)}function Tm(e$,t$){if(!yd(e$))throw new I("message object is not a plain object",t$);if(e$.messageType===void 0)if(e$.rawMessage instanceof Uint8Array){if(e$.messageType="RAW",e$.text!==void 0)throw new I("Raw messages cannot have text property. Use description instead",t$)}else{if(typeof e$.text!="string")throw new I("messageType is undefined",t$);if(e$.messageType="TEXT",e$.rawMessage!==void 0)throw new I("Text messages cannot have rawMessage property",t$)}}function Gg(e$){return Ki.apply(this,arguments)}function Ki(){return(Ki=J(w.mark(function e$(t$){var r$,n$,i$,o$,s$,a$,c$,u$,l$,d$,h$,p$,_$,f$,m$,g$,v$,y$,S$,b$,$$;return w.wrap(function(C$){for(;;)switch(C$.prev=C$.next){case 0:if(r$=t$.message,n$=t$.peerId,i$=t$.toPeer,o$=t$.session,s$=t$.errorCodes,a$=t$.diff,c$=t$.logger,u$=t$.options,o$!==void 0){C$.next=3;break}throw new K("The client is not logged in. Cannot do the operation",s$.NOT_LOGGED_IN);case 3:if(l$=!1,r$.messageType!=="TEXT"||!r$.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!i$){C$.next=11;break}if(d$=r$.text.split("_"),h$=ra(d$,3),p$=h$[0],_$=h$[1],h$[2]!==void 0&&za(_$)&&p$==="AgoraRTMLegacyEndcallCompatibleMessagePrefix"){C$.next=10;break}throw new I("Message is not valid",ve);case 10:l$=!0;case 11:if(f$=Date.now(),m$=o$.messageSentTimes.length-1,!((g$=o$.messageSentTimes[m$])&&g$+3e3<f$)){C$.next=18;break}o$.messageSentTimes=[f$],C$.next=29;break;case 18:v$=m$;case 19:if(!(0<=v$)){C$.next=28;break}if(!(o$.messageSentTimes[v$]+3e3<f$)){C$.next=23;break}return o$.messageSentTimes=o$.messageSentTimes.slice(v$+1,m$+1),C$.abrupt("break",28);case 23:if(!(180<=m$-v$+1)){C$.next=25;break}throw new ib("Message sent failed, exceeded the 180 message in 3 seconds",s$.TOO_OFTEN);case 25:v$--,C$.next=19;break;case 28:o$.messageSentTimes.push(f$);case 29:C$.t0=r$.messageType,C$.next=C$.t0==="TEXT"?32:C$.t0==="RAW"?37:C$.t0==="FILE"||C$.t0==="IMAGE"?39:40;break;case 32:if(!l$){C$.next=36;break}return y$=r$.text.split("_"),S$=ra(y$,3),b$=S$[1],$$=S$[2],c$.info("[rtm-API] EndCall message send api is called"),C$.abrupt("return",o$.sendInvitationMessage({peerId:n$,type:"CallCancel",extra:$$,channelId:b$,callId:"0"}));case 36:return C$.abrupt("return",o$.sendTextMessage(r$.text,n$,i$,u$,1e4-a$));case 37:return r$.description===void 0&&(r$.description=""),C$.abrupt("return",o$.sendRawMessage(r$.rawMessage,r$.description,n$,i$,u$,1e4-a$));case 39:return C$.abrupt("return",o$.sendMediaMessage(r$.messageType,r$,n$,i$,u$,1e4-a$));case 40:throw new I("Invalid message type",ve);case 41:case"end":return C$.stop()}},e$)}))).apply(this,arguments)}function Yt(e$){var t$=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],r$=e$.replace(/(https?:\/\/)?(www.)?/i,"");return t$||(r$=r$.split(".").slice(e$.length-2).join(".")),r$.indexOf("/")!==-1?r$.split("/")[0]:r$}function oa(e$){if(typeof e$!="string")return"[Sensitive Info]";var t$=Math.floor(.7*e$.length),r$=e$.length;return Um(e$,t$,r$,"*".repeat(r$-t$))}function Vm(e$,t$,r$){function n$(i$){if(e$===void 0)return e$;if(Il(i$))return i$;if(Array.isArray(i$))return i$.map(n$);var o$={},s$=0;for(i$=Hg(i$);s$<i$.length;s$++){var a$=ra(i$[s$],2),c$=a$[0];if(typeof(a$=a$[1])=="string"&&r$.includes(c$)){o$[c$]=typeof a$=="string"?oa(a$):"[Sensitive Info]";break}t$.includes(c$)?o$[c$]="[Hidden Info]":o$[c$]=a$==null?a$:r$.includes(c$)?"[Sensitive Info]":n$(a$)}return o$}return Array.isArray(e$)?e$.map(n$):n$(e$)}function Wm(e$){return Object.getOwnPropertyNames(e$).forEach(function(t$){X(t$=e$[t$])=="object"&&t$!==null&&Wm(t$)}),Object.freeze(e$)}function pa(e$){return new TextDecoder("utf-8").decode(e$.buffer.slice(e$.byteOffset,e$.byteOffset+e$.byteLength))}function Ig(e$){return new TextEncoder().encode(e$).length}function Xm(){for(var e$=0,t$=arguments.length,r$=Array(t$),n$=0;n$<t$;n$++)r$[n$]=arguments[n$];for(t$=0;t$<r$.length;t$++)e$+=r$[t$].length;for(e$=new Uint8Array(e$),n$=t$=0;n$<r$.length;n$++){var i$=r$[n$];e$.set(i$,t$),t$+=i$.length}return e$}function we(e$,t$,r$){var n$=e$.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(e$=n$==null?void 0:n$[1],n$=n$==null?void 0:n$[2]){var i$;for(n$=n$.substr(1).split("&"),i$=0;i$<n$.length;i$++)if(n$[i$].split("=")[0]==t$){n$[i$]=t$+"="+encodeURIComponent(r$);break}return i$==n$.length&&n$.push(t$+"="+encodeURIComponent(r$)),e$+"?"+n$.join("&")}return e$+"?"+t$+"="+encodeURIComponent(r$)}function Ji(e$){return new Promise(function(t$,r$){var n$=new FileReader;n$.onloadend=function(){var i$=n$.result||new ArrayBuffer(0);t$(i$)},n$.onerror=r$,n$.readAsArrayBuffer(e$)})}function Zt(e$,t$){e$=e$=[e$],typeof(t$=t$||{})=="string"&&(t$={type:t$});try{var r$=new Blob(e$,t$)}catch(i$){if(i$.name!=="TypeError")throw i$;r$=new(typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder);for(var n$=0;n$<e$.length;n$+=1)r$.append(e$[n$]);r$=r$.getBlob(t$.type)}return r$}function Um(e$,t$,r$,n$){return typeof e$!="string"?"[Sensitive Info]":e$.substring(0,t$)+n$+e$.substring(r$)}function Ym(e$){var t$=[];return function r$(n$){if(n$===null||X(n$)!=="object")return n$;if(t$.indexOf(n$)!==-1)return"[Circular]";if(t$.push(n$),typeof n$.toJSON=="function")try{var i$=r$(n$.toJSON());return t$.pop(),i$}catch(o$){return"[Throws: "+(o$?o$.message:"?")+"]"}return Array.isArray(n$)?(i$=n$.map(r$),t$.pop(),i$):(i$=Object.keys(n$).reduce(function(o$,s$){e:{if($t.call(n$,s$))try{var a$=n$[s$];break e}catch(c$){a$="[Throws: "+(c$?c$.message:"?")+"]";break e}a$=n$[s$]}return o$[s$]=r$(a$),o$},{}),t$.pop(),i$)}(e$)}function au(e$){if(!(100<(e$=String(e$)).length)&&(e$=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e$))){var t$=parseFloat(e$[1]);switch((e$[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*t$;case"weeks":case"week":case"w":return 6048e5*t$;case"days":case"day":case"d":return 864e5*t$;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*t$;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*t$;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*t$;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t$}}}function Jg(e$,t$,r$,n$){return Math.round(e$/r$)+" "+n$+(t$>=1.5*r$?"s":"")}function bu(e$){var t$=e$.areas,r$=e$.excludedArea;if(t$.length===1&&t$[0]===F.GLOBAL&&r$===F.CHINA)return xe([F.OVERSEA]);if(t$.includes(F.GLOBAL)){if(e$=xf(Kg).filter(function(o$){return o$!==F.GLOBAL&&o$!==F.OVERSEA}),r$ in yf){t$=yf[r$];var n$=[].concat(G(t$??[]),[r$]);return xe(e$.filter(function(o$){return!n$.includes(o$)}))}if(Zm(r$)){var i$=cu(r$);return xe(e$.filter(function(o$){return o$!==r$&&o$!==i$}))}}if(Zm(r$)||r$ in yf)return xe(t$);throw new I("Invalid excludedArea area config")}function Ma(e$,t$,r$){r$===void 0&&(r$=Object.getOwnPropertyDescriptor(e$,t$));var n$=r$.value;return r$.value=function(){for(var i$=this,o$=arguments.length,s$=Array(o$),a$=0;a$<o$;a$++)s$[a$]=arguments[a$];this.invokeTracker.apply(this,["%s: ".concat(0<s$.length?"%s with args: ".concat(s$.map(function(){return"%o"})):"%s"),this.name,t$].concat(G(s$.map(ye))));try{var c$=n$.apply(this,s$)}catch(l$){throw this.logError.apply(this,["".concat(l$.code!==void 0?"Error Code ".concat(l$.code,": "):"","%s failed").concat(0<s$.length?" with args: ".concat(s$.map(function(){return"%o"})):""),t$].concat(G(s$.map(ye)))),l$.originalError&&this.logError(l$.originalError),this.errorTracker(l$),l$}var u$=Date.now();return J(w.mark(function l$(){var d$,h$;return w.wrap(function(p$){for(;;)switch(p$.prev=p$.next){case 0:return p$.prev=0,p$.next=3,c$;case 3:d$=p$.sent,p$.next=12;break;case 6:return p$.prev=6,p$.t0=p$.catch(0),i$.logError.apply(i$,["".concat(p$.t0.code!==void 0?"Error Code ".concat(p$.t0.code,": "):"","%s failed").concat(0<s$.length?" with args: ".concat(s$.map(function(){return"%o"})):""),t$].concat(G(s$.map(ye)))),p$.t0.originalError&&i$.logError(p$.t0.originalError),i$.errorTracker(p$.t0),p$.abrupt("return");case 12:d$!==c$?d$===void 0?i$.resultTracker("%s promise resolves after %dms",t$,Date.now()-u$):i$.resultTracker("%s promise resolves after %dms, result is %o",t$,Date.now()-u$,ye(d$)):Ac(d$)!=="Object"||yd(d$)?i$.resultTracker("%s result is %o",t$,ye(d$)):i$.resultTracker("%s result is %s",t$,d$.name||((h$=d$.constructor)===null||h$===void 0?void 0:h$.name));case 13:case"end":return p$.stop()}},l$,null,[[0,6]])}))(),c$},r$}function Nb(e$,t$,r$){r$===void 0&&(r$=Object.getOwnPropertyDescriptor(e$,t$));var n$=r$.value;return r$.value=function(){for(var i$=this,o$=arguments.length,s$=Array(o$),a$=0;a$<o$;a$++)s$[a$]=arguments[a$];this.invokeTracker.apply(this,["%s: ".concat(0<s$.length?"%s with args: ".concat(s$.map(function(){return"%o"})):"%s"),this.name,t$].concat(s$));try{var c$=n$.apply(this,s$)}catch(l$){throw this.logError.apply(this,["".concat(l$.code!==void 0?"Error Code ".concat(l$.code,": "):"","%s failed").concat(0<s$.length?" with args: ".concat(s$.map(function(){return"%o"})):""),t$].concat(s$)),l$.originalError&&this.logError(l$.originalError),this.errorTracker(l$),l$}var u$=Date.now();return J(w.mark(function l$(){var d$,h$;return w.wrap(function(p$){for(;;)switch(p$.prev=p$.next){case 0:return p$.prev=0,p$.next=3,c$;case 3:d$=p$.sent,p$.next=12;break;case 6:return p$.prev=6,p$.t0=p$.catch(0),i$.logError.apply(i$,["".concat(p$.t0.code!==void 0?"Error Code ".concat(p$.t0.code,": "):"","%s failed").concat(0<s$.length?" with args: ".concat(s$.map(function(){return"%o"})):""),t$].concat(s$)),p$.t0.originalError&&i$.logError(p$.t0.originalError),i$.errorTracker(p$.t0),p$.abrupt("return");case 12:d$!==c$?d$===void 0?i$.resultTracker("%s promise resolves after %dms",t$,Date.now()-u$):i$.resultTracker("%s promise resolves after %dms, result is %o",t$,Date.now()-u$,d$):Ac(d$)!=="Object"||yd(d$)?i$.resultTracker("%s result is %o",t$,d$):i$.resultTracker("%s result is %s",t$,d$.name||((h$=d$.constructor)===null||h$===void 0?void 0:h$.name));case 13:case"end":return p$.stop()}},l$,null,[[0,6]])}))(),c$},r$}function du(e$,t$){var r$="".concat(e$,"Uri");if(typeof(r$=Li[r$])!="number"||r$===0)throw new TypeError("Got Unknown URI Name");return t$=new(e$=$m[e$])(t$),t$=e$.encode(t$).finish(),new eu({uri:r$,data:t$})}function an(e$,t$){return"".concat(e$.split(".").join("-"),".edge.").concat(t$?"sd-rtn.com":"agora.io")}function eb(e$,t$,r$){return Mi.apply(this,arguments)}function Mi(){return(Mi=J(w.mark(function e$(t$,r$,n$){var i$,o$;return w.wrap(function(s$){for(;;)switch(s$.prev=s$.next){case 0:s$.next=2;break;case 2:return i$=fu[t$].encode(r$).finish(),o$=function(){var a$=J(w.mark(function c$(u$){var l$,d$,h$,p$=arguments;return w.wrap(function(_$){for(;;)switch(_$.prev=_$.next){case 0:if(!(3<(d$=1<p$.length&&p$[1]!==void 0?p$[1]:0))){_$.next=3;break}return _$.abrupt("return");case 3:return h$=we(h$=n$?"https://".concat((l$=M==null?void 0:M.PROXY_NGINX[0])!==null&&l$!==void 0?l$:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(u$,"&p=6443&d=events/proto-raw"):"https://".concat(u$,":6443/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),h$=we(h$,"id",gu[t$].toString()),_$.next=8,te(h$,{body:i$,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch(function(f$){return o$(u$,d$+1)});case 8:case"end":return _$.stop()}},c$)}));return function(c$){return a$.apply(this,arguments)}}(),s$.prev=4,s$.next=7,o$((M==null?void 0:M.EVENT_REPORT_DOMAIN[0])||"webcollector-rtm.agora.io");case 7:s$.next=13;break;case 9:return s$.prev=9,s$.t0=s$.catch(4),s$.next=13,o$(M&&bn(1<(M==null?void 0:M.EVENT_REPORT_DOMAIN.length)?M==null?void 0:M.EVENT_REPORT_DOMAIN.slice(1):M==null?void 0:M.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 13:case"end":return s$.stop()}},e$,null,[[4,9]])}))).apply(this,arguments)}function fb(e$){return e$===void 0?U.fromNumber(0):U.fromNumber(Date.now()-e$)}function hu(e$){return btoa(String.fromCharCode.apply({},e$.replace(/\r|\n/g,"").replace(/([\dA-Fa-f]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ").map(function(t$){return parseInt(t$,16)}))).replace(/={1,2}$/,"")}function Lg(e$,t$){return U.fromValue(e$).eq(t$)}function Mg(e$,t$){var r$=t$===void 0?e$.val:t$,n$=e$.isBoolean;t$=e$.isNumber;var i$=e$.oneof,o$=e$.len;if([n$,t$,i$].filter(function(s$){return!s$}).length!==2)throw new TypeError("invalid field type");if(r$!==void 0&&(e$=!1,i$!==void 0&&(i$=Ni(i$),iu(i$,Lg).length===i$.length&&ju(i$,function(s$){return Lg(r$,s$)})!==void 0&&(e$=!0)),n$=n$!==void 0&&(r$===0||r$===1)&&o$===1,t$=t$!==void 0&&r$.toString(2).length<=o$,!(e$||n$||t$)))throw Error("invalid field value")}function cn(e$){return function(){var t$=e$();if(!t$)throw new K("Client is not logged in. Cannot do the operation");return t$}}var Ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{},Ng=function(e$){return e$&&e$.Math==Math&&e$},y=Ng(typeof globalThis=="object"&&globalThis)||Ng(typeof window=="object"&&window)||Ng(typeof self=="object"&&self)||Ng(typeof Ya=="object"&&Ya)||function(){return this}()||Function("return this")(),R=function(e$){try{return!!e$()}catch{return!0}},ka=!R(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),dn={}.propertyIsEnumerable,en=Object.getOwnPropertyDescriptor,zf=en&&!dn.call({1:2},1)?function(e$){return!!(e$=en(this,e$))&&e$.enumerable}:dn,dd=function(e$,t$){return{enumerable:!(1&e$),configurable:!(2&e$),writable:!(4&e$),value:t$}},ku={}.toString,Zb=function(e$){return ku.call(e$).slice(8,-1)},lu="".split,Af=R(function(){return!Object("z").propertyIsEnumerable(0)})?function(e$){return Zb(e$)=="String"?lu.call(e$,""):Object(e$)}:Object,jb=function(e$){if(e$==null)throw TypeError("Can't call method on "+e$);return e$},qb=function(e$){return Af(jb(e$))},ha=function(e$){return typeof e$=="object"?e$!==null:typeof e$=="function"},lc=function(e$,t$){if(!ha(e$))return e$;var r$,n$;if(t$&&typeof(r$=e$.toString)=="function"&&!ha(n$=r$.call(e$))||typeof(r$=e$.valueOf)=="function"&&!ha(n$=r$.call(e$))||!t$&&typeof(r$=e$.toString)=="function"&&!ha(n$=r$.call(e$)))return n$;throw TypeError("Can't convert object to primitive value")},Qa=function(e$){return Object(jb(e$))},mu={}.hasOwnProperty,Q=function(e$,t$){return mu.call(Qa(e$),t$)},ze=y.document,Og=ha(ze)&&ha(ze.createElement),fn=!ka&&!R(function(){return Object.defineProperty(Og?ze.createElement("div"):{},"a",{get:function(){return 7}}).a!=7}),gn=Object.getOwnPropertyDescriptor,Fb={f:ka?gn:function(e$,t$){if(e$=qb(e$),t$=lc(t$,!0),fn)try{return gn(e$,t$)}catch{}if(Q(e$,t$))return dd(!zf.call(e$,t$),e$[t$])}},va=function(e$){if(!ha(e$))throw TypeError(String(e$)+" is not an object");return e$},hn=Object.defineProperty,Ra={f:ka?hn:function(e$,t$,r$){if(va(e$),t$=lc(t$,!0),va(r$),fn)try{return hn(e$,t$,r$)}catch{}if("get"in r$||"set"in r$)throw TypeError("Accessors not supported");return"value"in r$&&(e$[t$]=r$.value),e$}},Na=ka?function(e$,t$,r$){return Ra.f(e$,t$,dd(1,r$))}:function(e$,t$,r$){return e$[t$]=r$,e$},Oi=function(e$,t$){try{Na(y,e$,t$)}catch{y[e$]=t$}return t$},ed=y["__core-js_shared__"]||Oi("__core-js_shared__",{}),nu=Function.toString;typeof ed.inspectSource!="function"&&(ed.inspectSource=function(e$){return nu.call(e$)});var Pi=ed.inspectSource,jn=y.WeakMap,ou=typeof jn=="function"&&/native code/.test(Pi(jn)),fd=$a(function(e$){(e$.exports=function(t$,r$){return ed[t$]||(ed[t$]=r$!==void 0?r$:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:" 2021 Denis Pushkarev (zloirock.ru)"})}),pu=0,qu=Math.random(),Ae=function(e$){return"Symbol("+String(e$===void 0?"":e$)+")_"+(++pu+qu).toString(36)},kn=fd("keys"),Pg=function(e$){return kn[e$]||(kn[e$]=Ae(e$))},Be={},ru=y.WeakMap;if(ou||ed.state)var Gd=ed.state||(ed.state=new ru),su=Gd.get,ln=Gd.has,tu=Gd.set,Qi=function(e$,t$){if(ln.call(Gd,e$))throw new TypeError("Object already initialized");return t$.facade=e$,tu.call(Gd,e$,t$),t$},Qg=function(e$){return su.call(Gd,e$)||{}},Ri=function(e$){return ln.call(Gd,e$)};else{var Ce=Pg("state");Be[Ce]=!0,Qi=function(e$,t$){if(Q(e$,Ce))throw new TypeError("Object already initialized");return t$.facade=e$,Na(e$,Ce,t$),t$},Qg=function(e$){return Q(e$,Ce)?e$[Ce]:{}},Ri=function(e$){return Q(e$,Ce)}}var Za={set:Qi,get:Qg,has:Ri,enforce:function(e$){return Ri(e$)?Qg(e$):Qi(e$,{})},getterFor:function(e$){return function(t$){var r$;if(!ha(t$)||(r$=Qg(t$)).type!==e$)throw TypeError("Incompatible receiver, "+e$+" required");return r$}}},Ta=$a(function(e$){var t$=Za.get,r$=Za.enforce,n$=String(String).split("String");(e$.exports=function(i$,o$,s$,a$){var c$=!!a$&&!!a$.unsafe,u$=!!a$&&!!a$.enumerable;if(a$=!!a$&&!!a$.noTargetGet,typeof s$=="function"){typeof o$!="string"||Q(s$,"name")||Na(s$,"name",o$);var l$=r$(s$);l$.source||(l$.source=n$.join(typeof o$=="string"?o$:""))}i$===y?u$?i$[o$]=s$:Oi(o$,s$):(c$?!a$&&i$[o$]&&(u$=!0):delete i$[o$],u$?i$[o$]=s$:Na(i$,o$,s$))})(Function.prototype,"toString",function(){return typeof this=="function"&&t$(this).source||Pi(this)})}),mn=function(e$){return typeof e$=="function"?e$:void 0},mc=function(e$,t$){return 2>arguments.length?mn(y[e$])||mn(y[e$]):y[e$]&&y[e$][t$]||y[e$]&&y[e$][t$]},uu=Math.ceil,vu=Math.floor,$b=function(e$){return isNaN(e$=+e$)?0:(0<e$?vu:uu)(e$)},wu=Math.min,ta=function(e$){return 0<e$?wu($b(e$),9007199254740991):0},xu=Math.max,yu=Math.min,xb=function(e$,t$){return 0>(e$=$b(e$))?xu(e$+t$,0):yu(e$,t$)},nn=function(e$){return function(t$,r$,n$){t$=qb(t$);var i$=ta(t$.length);if(n$=xb(n$,i$),e$&&r$!=r$){for(;i$>n$;)if((r$=t$[n$++])!=r$)return!0}else for(;i$>n$;n$++)if((e$||n$ in t$)&&t$[n$]===r$)return e$||n$||0;return!e$&&-1}},on=nn(!0),Si=nn(!1),pn=function(e$,t$){e$=qb(e$);var r$,n$=0,i$=[];for(r$ in e$)!Q(Be,r$)&&Q(e$,r$)&&i$.push(r$);for(;t$.length>n$;)Q(e$,r$=t$[n$++])&&(~Si(i$,r$)||i$.push(r$));return i$},Rg="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),zu=Rg.concat("length","prototype"),Hd={f:Object.getOwnPropertyNames||function(e$){return pn(e$,zu)}},Bf={f:Object.getOwnPropertySymbols},qn=mc("Reflect","ownKeys")||function(e$){var t$=Hd.f(va(e$)),r$=Bf.f;return r$?t$.concat(r$(e$)):t$},rn=function(e$,t$){for(var r$=qn(t$),n$=Ra.f,i$=Fb.f,o$=0;o$<r$.length;o$++){var s$=r$[o$];Q(e$,s$)||n$(e$,s$,i$(t$,s$))}},Au=/#|\.prototype\./,nc=function(e$,t$){return(e$=Bu[Cu(e$)])==Du||e$!=Eu&&(typeof t$=="function"?R(t$):!!t$)},Cu=nc.normalize=function(e$){return String(e$).replace(Au,".").toLowerCase()},Bu=nc.data={},Eu=nc.NATIVE="N",Du=nc.POLYFILL="P",Fu=Fb.f,N=function(e$,t$){var r$,n$,i$,o$=e$.target,s$=e$.global,a$=e$.stat;if(n$=s$?y:a$?y[o$]||Oi(o$,{}):(y[o$]||{}).prototype)for(i$ in t$){var c$=t$[i$],u$=e$.noTargetGet?(r$=Fu(n$,i$))&&r$.value:n$[i$];if(!(r$=nc(s$?i$:o$+(a$?".":"#")+i$,e$.forced))&&u$!==void 0){if(typeof c$==typeof u$)continue;rn(c$,u$)}(e$.sham||u$&&u$.sham)&&Na(c$,"sham",!0);try{Ta(n$,i$,c$,e$)}catch{}}},yb=function(e$){if(typeof e$!="function")throw TypeError(String(e$)+" is not a function");return e$},Id=function(e$,t$,r$){if(yb(e$),t$===void 0)return e$;switch(r$){case 0:return function(){return e$.call(t$)};case 1:return function(n$){return e$.call(t$,n$)};case 2:return function(n$,i$){return e$.call(t$,n$,i$)};case 3:return function(n$,i$,o$){return e$.call(t$,n$,i$,o$)}}return function(){return e$.apply(t$,arguments)}},gd=Array.isArray||function(e$){return Zb(e$)=="Array"},De=mc("navigator","userAgent")||"",sn=y.process,tn=sn&&sn.versions,un=tn&&tn.v8;if(un)var hd=un.split("."),Ti=4>hd[0]?1:hd[0]+hd[1];else De&&(hd=De.match(/Edge\/(\d+)/),(!hd||74<=hd[1])&&(hd=De.match(/Chrome\/(\d+)/))&&(Ti=hd[1]));var id=Ti&&+Ti,oc=!!Object.getOwnPropertySymbols&&!R(function(){return!String(Symbol())||!Symbol.sham&&id&&41>id}),vn=oc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Cf=fd("wks"),Df=y.Symbol,Gu=vn?Df:Df&&Df.withoutSetter||Ae,qa=function(e$){return Q(Cf,e$)&&(oc||typeof Cf[e$]=="string")||(oc&&Q(Df,e$)?Cf[e$]=Df[e$]:Cf[e$]=Gu("Symbol."+e$)),Cf[e$]},Hu=qa("species"),Sg=function(e$,t$){if(gd(e$)){var r$=e$.constructor;typeof r$!="function"||r$!==Array&&!gd(r$.prototype)?ha(r$)&&(r$=r$[Hu])===null&&(r$=void 0):r$=void 0}return new(r$===void 0?Array:r$)(t$===0?0:t$)},wn=[].push,jd=function(e$){var t$=e$==1,r$=e$==2,n$=e$==3,i$=e$==4,o$=e$==6,s$=e$==7,a$=e$==5||o$;return function(c$,u$,l$,d$){var h$=Qa(c$),p$=Af(h$);u$=Id(u$,l$,3),l$=ta(p$.length);var _$,f$=0;for(d$=d$||Sg,c$=t$?d$(c$,l$):r$||s$?d$(c$,0):void 0;l$>f$;f$++)if((a$||f$ in p$)&&(_$=u$(d$=p$[f$],f$,h$),e$))if(t$)c$[f$]=_$;else if(_$)switch(e$){case 3:return!0;case 5:return d$;case 6:return f$;case 2:wn.call(c$,d$)}else switch(e$){case 4:return!1;case 7:wn.call(c$,d$)}return o$?-1:n$||i$?i$:c$}},Jd=jd(0),xn=jd(1),yn=jd(2),Iu=jd(3),Ju=jd(4),zn=jd(5),An=jd(6),Ku=qa("species"),Ef=function(e$){return 51<=id||!R(function(){var t$=[];return(t$.constructor={})[Ku]=function(){return{foo:1}},t$[e$](Boolean).foo!==1})},Lu=Ef("filter");N({target:"Array",proto:!0,forced:!Lu},{filter:function(e$){return yn(this,e$,1<arguments.length?arguments[1]:void 0)}});var Dc=Object.keys||function(e$){return pn(e$,Rg)},Mu=R(function(){Dc(1)});N({target:"Object",stat:!0,forced:Mu},{keys:function(e$){return Dc(Qa(e$))}});var Ee=function(e$,t$){var r$=[][e$];return!!r$&&R(function(){r$.call(null,t$||function(){throw 1},1)})},Nu=[].join,Ou=Af!=Object,Pu=Ee("join",",");N({target:"Array",proto:!0,forced:Ou||!Pu},{join:function(e$){return Nu.call(qb(this),e$===void 0?",":e$)}});var Qu=Ef("map");N({target:"Array",proto:!0,forced:!Qu},{map:function(e$){return xn(this,e$,1<arguments.length?arguments[1]:void 0)}});var Ui=function(e$){var t$=e$.return;if(t$!==void 0)return va(t$.call(e$)).value},Fe={},Ru=qa("iterator"),Su=Array.prototype,Vi=function(e$){return e$!==void 0&&(Fe.Array===e$||Su[Ru]===e$)},Ge=function(e$,t$,r$){(t$=lc(t$))in e$?Ra.f(e$,t$,dd(0,r$)):e$[t$]=r$},Tu=qa("toStringTag"),Bn={};Bn[Tu]="z";var Wi=String(Bn)==="[object z]",Uu=qa("toStringTag"),Vu=Zb(function(){return arguments}())=="Arguments",Ff=Wi?Zb:function(e$){var t$;if(e$===void 0)var r$="Undefined";else{if(e$===null)var n$="Null";else{e:{var i$=e$=Object(e$);try{n$=i$[Uu];break e}catch{}n$=void 0}n$=typeof(r$=n$)=="string"?r$:Vu?Zb(e$):(t$=Zb(e$))=="Object"&&typeof e$.callee=="function"?"Arguments":t$}r$=n$}return r$},Wu=qa("iterator"),Xi=function(e$){if(e$!=null)return e$[Wu]||e$["@@iterator"]||Fe[Ff(e$)]},Cn=qa("iterator"),Dn=!1;try{var Xu=0,En={next:function(){return{done:!!Xu++}},return:function(){Dn=!0}};En[Cn]=function(){return this},Array.from(En,function(){throw 2})}catch(e$){}var Tg=function(e$,t$){if(!t$&&!Dn)return!1;var r$=!1;try{(t$={})[Cn]=function(){return{next:function(){return{done:r$=!0}}}},e$(t$)}catch{}return r$},Yu=!Tg(function(e$){Array.from(e$)});N({target:"Array",stat:!0,forced:Yu},{from:function(e$){var t$,r$=Qa(e$),n$=typeof this=="function"?this:Array,i$=arguments.length,o$=1<i$?arguments[1]:void 0,s$=o$!==void 0,a$=Xi(r$),c$=0;if(s$&&(o$=Id(o$,2<i$?arguments[2]:void 0,2)),a$==null||n$==Array&&Vi(a$)){var u$=ta(r$.length);for(n$=new n$(u$);u$>c$;c$++)a$=s$?o$(r$[c$],c$):r$[c$],Ge(n$,c$,a$)}else for(i$=(r$=a$.call(r$)).next,n$=new n$;!(t$=i$.call(r$)).done;c$++){if(s$){a$=r$;var l$=o$;t$=[t$.value,c$];try{u$=l$(va(t$)[0],t$[1])}catch(d$){throw Ui(a$),d$}}else u$=t$.value;Ge(n$,c$,a$=u$)}return n$.length=c$,n$}});var Fn=function(e$){return function(t$,r$){t$=String(jb(t$)),r$=$b(r$);var n$,i$=t$.length;if(0>r$||r$>=i$)return e$?"":void 0;var o$=t$.charCodeAt(r$);return 55296>o$||56319<o$||r$+1===i$||56320>(n$=t$.charCodeAt(r$+1))||57343<n$?e$?t$.charAt(r$):o$:e$?t$.slice(r$,r$+2):n$-56320+(o$-55296<<10)+65536}},Gn=Fn(!0),Hn=!R(function(){function e$(){}return e$.prototype.constructor=null,Object.getPrototypeOf(new e$)!==e$.prototype}),In=Pg("IE_PROTO"),Zu=Object.prototype,Vb=Hn?Object.getPrototypeOf:function(e$){return e$=Qa(e$),Q(e$,In)?e$[In]:typeof e$.constructor=="function"&&e$ instanceof e$.constructor?e$.constructor.prototype:e$ instanceof Object?Zu:null},Yi=qa("iterator"),Jn=!1,$u=function(){return this},Kd;if([].keys){var Kn=[].keys();if("next"in Kn){var Ln=Vb(Vb(Kn));Ln!==Object.prototype&&(Kd=Ln)}else Jn=!0}(Kd==null||R(function(){var e$={};return Kd[Yi].call(e$)!==e$}))&&(Kd={}),Q(Kd,Yi)||Na(Kd,Yi,$u);var Ug=Kd,Vg=Jn,av=ka?Object.defineProperties:function(e$,t$){va(e$);for(var r$,n$=Dc(t$),i$=n$.length,o$=0;i$>o$;)Ra.f(e$,r$=n$[o$++],t$[r$]);return e$},Zi=mc("document","documentElement"),Mn=Pg("IE_PROTO"),$i=function(){},aj,Wg=function(){try{aj=document.domain&&new ActiveXObject("htmlfile")}catch{}if(aj){var e$=aj;e$.write("<script><\/script>"),e$.close(),e$=e$.parentWindow.Object}else(e$=Og?ze.createElement("iframe"):{}).style.display="none",Zi.appendChild(e$),e$.src="javascript:",(e$=e$.contentWindow.document).open(),e$.write("<script>document.F=Object<\/script>"),e$.close(),e$=e$.F;for(Wg=e$,e$=Rg.length;e$--;)delete Wg.prototype[Rg[e$]];return Wg()};Be[Mn]=!0;var ac=Object.create||function(e$,t$){if(e$!==null){$i.prototype=va(e$);var r$=new $i;$i.prototype=null,r$[Mn]=e$}else r$=Wg();return t$===void 0?r$:av(r$,t$)},bv=Ra.f,Nn=qa("toStringTag"),Ec=function(e$,t$,r$){e$&&!Q(e$=r$?e$:e$.prototype,Nn)&&bv(e$,Nn,{configurable:!0,value:t$})},cv=function(){return this},dv=function(e$,t$,r$){return t$+=" Iterator",e$.prototype=ac(Ug,{next:dd(1,r$)}),Ec(e$,t$,!1),Fe[t$]=cv,e$},Ua=Object.setPrototypeOf||("__proto__"in{}?function(){var e$=!1,t$={};try{var r$=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;r$.call(t$,[]),e$=t$ instanceof Array}catch{}return function(n$,i$){if(va(n$),!ha(i$)&&i$!==null)throw TypeError("Can't set "+String(i$)+" as a prototype");return e$?r$.call(n$,i$):n$.__proto__=i$,n$}}():void 0),Gf=qa("iterator"),ev=function(){return this},bj=function(e$,t$,r$,n$,i$,o$,s$){dv(r$,t$,n$),n$=function(f$){if(f$===i$&&h$)return h$;if(!Vg&&f$ in l$)return l$[f$];switch(f$){case"keys":case"values":case"entries":return function(){return new r$(this,f$)}}return function(){return new r$(this)}};var a$,c$=t$+" Iterator",u$=!1,l$=e$.prototype,d$=l$[Gf]||l$["@@iterator"]||i$&&l$[i$],h$=!Vg&&d$||n$(i$),p$=t$=="Array"&&l$.entries||d$;if(p$&&(e$=Vb(p$.call(new e$)),Ug!==Object.prototype&&e$.next&&(Vb(e$)!==Ug&&(Ua?Ua(e$,Ug):typeof e$[Gf]!="function"&&Na(e$,Gf,ev)),Ec(e$,c$,!0))),i$=="values"&&d$&&d$.name!=="values"&&(u$=!0,h$=function(){return d$.call(this)}),l$[Gf]!==h$&&Na(l$,Gf,h$),Fe[t$]=h$,i$){var _$={values:n$("values"),keys:o$?h$:n$("keys"),entries:n$("entries")};if(s$)for(a$ in _$)!Vg&&!u$&&a$ in l$||Ta(l$,a$,_$[a$]);else N({target:t$,proto:!0,forced:Vg||u$},_$)}return _$},fv=Za.set,gv=Za.getterFor("String Iterator");bj(String,"String",function(e$){fv(this,{type:"String Iterator",string:String(e$),index:0})},function(){var e$=gv(this),t$=e$.string,r$=e$.index;return r$>=t$.length?{value:void 0,done:!0}:(t$=Gn(t$,r$),e$.index+=t$.length,{value:t$,done:!1})});var cj=qa("unscopables"),dj=Array.prototype;dj[cj]==null&&Ra.f(dj,cj,{configurable:!0,value:ac(null)});var Ld=function(e$){dj[cj][e$]=!0},On=!0;"find"in[]&&Array(1).find(function(){On=!1}),N({target:"Array",proto:!0,forced:On},{find:function(e$){return zn(this,e$,1<arguments.length?arguments[1]:void 0)}}),Ld("find");var Pn=function(e$){var t$=String(jb(this)),r$="";if(0>(e$=$b(e$))||e$==1/0)throw RangeError("Wrong number of repetitions");for(;0<e$;(e$>>>=1)&&(t$+=t$))1&e$&&(r$+=t$);return r$};N({target:"String",proto:!0},{repeat:Pn}),N({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),N({target:"Number",stat:!0},{isNaN:function(e$){return e$!=e$}}),y.Number.isNaN;var hv=Wi?{}.toString:function(){return"[object "+Ff(this)+"]"};Wi||Ta(Object.prototype,"toString",hv,{unsafe:!0});var Fc=y.Promise,Hf=function(e$,t$,r$){for(var n$ in t$)Ta(e$,n$,t$[n$],r$);return e$},Qn=qa("species"),If=function(e$){e$=mc(e$);var t$=Ra.f;ka&&e$&&!e$[Qn]&&t$(e$,Qn,{configurable:!0,get:function(){return this}})},Gc=function(e$,t$,r$){if(!(e$ instanceof t$))throw TypeError("Incorrect "+(r$?r$+" ":"")+"invocation");return e$},Jf=function(e$,t$){this.stopped=e$,this.result=t$},Xg=function(e$,t$,r$){var n$,i$=!(!r$||!r$.AS_ENTRIES),o$=!(!r$||!r$.IS_ITERATOR),s$=!(!r$||!r$.INTERRUPTED),a$=Id(t$,r$&&r$.that,1+i$+s$),c$=function(l$){return u$&&Ui(u$),new Jf(!0,l$)};if(t$=function(l$){return i$?(va(l$),s$?a$(l$[0],l$[1],c$):a$(l$[0],l$[1])):s$?a$(l$,c$):a$(l$)},o$)var u$=e$;else{if(typeof(o$=Xi(e$))!="function")throw TypeError("Target is not iterable");if(Vi(o$)){for(o$=0,r$=ta(e$.length);r$>o$;o$++)if((n$=t$(e$[o$]))&&n$ instanceof Jf)return n$;return new Jf(!1)}u$=o$.call(e$)}for(e$=u$.next;!(o$=e$.call(u$)).done;){try{n$=t$(o$.value)}catch(l$){throw Ui(u$),l$}if(typeof n$=="object"&&n$&&n$ instanceof Jf)return n$}return new Jf(!1)},iv=qa("species"),kd=function(e$,t$){var r$;return(e$=va(e$).constructor)===void 0||(r$=va(e$)[iv])==null?t$:yb(r$)},Rn=/(?:iphone|ipod|ipad).*applewebkit/i.test(De),Hc=Zb(y.process)=="process",Yg=y.location,ej=y.setImmediate,Sn=y.clearImmediate,jv=y.process,Tn=y.MessageChannel,fj=y.Dispatch,gj=0,Kf={},hj=function(e$){if(Kf.hasOwnProperty(e$)){var t$=Kf[e$];delete Kf[e$],t$()}},ij=function(e$){return function(){hj(e$)}},Un=function(e$){hj(e$.data)},Vn=function(e$){y.postMessage(e$+"",Yg.protocol+"//"+Yg.host)};if(!ej||!Sn)if(ej=function(e$){for(var t$=[],r$=1;arguments.length>r$;)t$.push(arguments[r$++]);return Kf[++gj]=function(){(typeof e$=="function"?e$:Function(e$)).apply(void 0,t$)},Lf(gj),gj},Sn=function(e$){delete Kf[e$]},Hc)var Lf=function(e$){jv.nextTick(ij(e$))};else if(fj&&fj.now)Lf=function(e$){fj.now(ij(e$))};else if(Tn&&!Rn){var Wn=new Tn,Xn=Wn.port2;Wn.port1.onmessage=Un,Lf=Id(Xn.postMessage,Xn,1)}else y.addEventListener&&typeof postMessage=="function"&&!y.importScripts&&Yg&&Yg.protocol!=="file:"&&!R(Vn)?(Lf=Vn,y.addEventListener("message",Un,!1)):Lf="onreadystatechange"in(Og?ze.createElement("script"):{})?function(e$){Zi.appendChild(Og?ze.createElement("script"):{}).onreadystatechange=function(){Zi.removeChild(this),hj(e$)}}:function(e$){setTimeout(ij(e$),0)};var jj=ej,kv=/web0s(?!.*chrome)/i.test(De),lv=Fb.f,Yn=y.MutationObserver||y.WebKitMutationObserver,Zn=y.document,$n=y.process,Zg=y.Promise,ao=lv(y,"queueMicrotask"),bo=ao&&ao.value,Md,Mf;if(!bo){var ah=function(){var e$;for(Hc&&(e$=$n.domain)&&e$.exit();Md;){var t$=Md.fn;Md=Md.next;try{t$()}catch(r$){throw Md?$g():Mf=void 0,r$}}Mf=void 0,e$&&e$.enter()};if(Rn||Hc||kv||!Yn||!Zn)if(Zg&&Zg.resolve){var kj=Zg.resolve(void 0);kj.constructor=Zg;var mv=kj.then,$g=function(){mv.call(kj,ah)}}else $g=Hc?function(){$n.nextTick(ah)}:function(){jj.call(y,ah)};else{var co=!0,eo=Zn.createTextNode("");new Yn(ah).observe(eo,{characterData:!0}),$g=function(){eo.data=co=!co}}}var fo=bo||function(e$){e$={fn:e$,next:void 0},Mf&&(Mf.next=e$),Md||(Md=e$,$g()),Mf=e$},nv=function(e$){var t$,r$;this.promise=new e$(function(n$,i$){if(t$!==void 0||r$!==void 0)throw TypeError("Bad Promise constructor");t$=n$,r$=i$}),this.resolve=yb(t$),this.reject=yb(r$)},lj={f:function(e$){return new nv(e$)}},mj=function(e$,t$){return va(e$),ha(t$)&&t$.constructor===e$?t$:((0,(e$=lj.f(e$)).resolve)(t$),e$.promise)},ov=function(e$,t$){var r$=y.console;r$&&r$.error&&(arguments.length===1?r$.error(e$):r$.error(e$,t$))},nj=function(e$){try{return{error:!1,value:e$()}}catch(t$){return{error:!0,value:t$}}},pv=typeof window=="object",qv=qa("species"),go=Za.get,rv=Za.set,sv=Za.getterFor("Promise"),Nd=Fc&&Fc.prototype,zb=Fc,bh=Nd,ho=y.TypeError,oj=y.document,pj=y.process,He=lj.f,tv=He,uv=!!(oj&&oj.createEvent&&y.dispatchEvent),io=typeof PromiseRejectionEvent=="function",jo=!1,Nf=nc("Promise",function(){var e$=Pi(zb)!==String(zb);if(!e$&&id===66)return!0;if(51<=id&&/native code/.test(zb))return!1;var t$=new zb(function(n$){n$(1)}),r$=function(n$){n$(function(){},function(){})};return(t$.constructor={})[qv]=r$,!(jo=t$.then(function(){})instanceof r$)||!e$&&pv&&!io}),vv=Nf||!Tg(function(e$){zb.all(e$).catch(function(){})}),ko=function(e$){var t$;return!(!ha(e$)||typeof(t$=e$.then)!="function")&&t$},qj=function(e$,t$){if(!e$.notified){e$.notified=!0;var r$=e$.reactions;fo(function(){for(var n$=e$.value,i$=e$.state==1,o$=0;r$.length>o$;){var s$,a$=r$[o$++],c$=i$?a$.ok:a$.fail,u$=a$.resolve,l$=a$.reject,d$=a$.domain;try{if(c$){if(i$||(e$.rejection===2&&wv(e$),e$.rejection=1),c$===!0)var h$=n$;else if(d$&&d$.enter(),h$=c$(n$),d$){d$.exit();var p$=!0}h$===a$.promise?l$(ho("Promise-chain cycle")):(s$=ko(h$))?s$.call(h$,u$,l$):u$(h$)}else l$(n$)}catch(_$){d$&&!p$&&d$.exit(),l$(_$)}}e$.reactions=[],e$.notified=!1,t$&&!e$.rejection&&xv(e$)})}},lo=function(e$,t$,r$){var n$;if(uv){var i$=oj.createEvent("Event");i$.promise=t$,i$.reason=r$,i$.initEvent(e$,!1,!0),y.dispatchEvent(i$)}else i$={promise:t$,reason:r$};!io&&(n$=y["on"+e$])?n$(i$):e$==="unhandledrejection"&&ov("Unhandled promise rejection",r$)},xv=function(e$){jj.call(y,function(){var t$=e$.facade,r$=e$.value;if(e$.rejection!==1&&!e$.parent){var n$=nj(function(){Hc?pj.emit("unhandledRejection",r$,t$):lo("unhandledrejection",t$,r$)});if(e$.rejection=Hc||e$.rejection!==1&&!e$.parent?2:1,n$.error)throw n$.value}})},wv=function(e$){jj.call(y,function(){var t$=e$.facade;Hc?pj.emit("rejectionHandled",t$):lo("rejectionhandled",t$,e$.value)})},Ie=function(e$,t$,r$){return function(n$){e$(t$,n$,r$)}},Je=function(e$,t$,r$){e$.done||(e$.done=!0,r$&&(e$=r$),e$.value=t$,e$.state=2,qj(e$,!0))},rj=function(e$,t$,r$){if(!e$.done){e$.done=!0,r$&&(e$=r$);try{if(e$.facade===t$)throw ho("Promise can't be resolved itself");var n$=ko(t$);n$?fo(function(){var i$={done:!1};try{n$.call(t$,Ie(rj,i$,e$),Ie(Je,i$,e$))}catch(o$){Je(i$,o$,e$)}}):(e$.value=t$,e$.state=1,qj(e$,!1))}catch(i$){Je({done:!1},i$,e$)}}};if(Nf){zb=function(e$){Gc(this,zb,"Promise"),yb(e$),sj.call(this);var t$=go(this);try{e$(Ie(rj,t$),Ie(Je,t$))}catch(r$){Je(t$,r$)}},bh=zb.prototype;var sj=function(e$){rv(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};sj.prototype=Hf(bh,{then:function(e$,t$){var r$=sv(this),n$=He(kd(this,zb));return n$.ok=typeof e$!="function"||e$,n$.fail=typeof t$=="function"&&t$,n$.domain=Hc?pj.domain:void 0,r$.parent=!0,r$.reactions.push(n$),r$.state!=0&&qj(r$,!1),n$.promise},catch:function(e$){return this.then(void 0,e$)}});var yv=function(){var e$=new sj,t$=go(e$);this.promise=e$,this.resolve=Ie(rj,t$),this.reject=Ie(Je,t$)};if(lj.f=He=function(e$){return e$===zb||e$===zv?new yv(e$):tv(e$)},typeof Fc=="function"&&Nd!==Object.prototype){var Av=Nd.then;jo||(Ta(Nd,"then",function(e$,t$){var r$=this;return new zb(function(n$,i$){Av.call(r$,n$,i$)}).then(e$,t$)},{unsafe:!0}),Ta(Nd,"catch",bh.catch,{unsafe:!0}));try{delete Nd.constructor}catch{}Ua&&Ua(Nd,bh)}}N({global:!0,wrap:!0,forced:Nf},{Promise:zb}),Ec(zb,"Promise",!1),If("Promise");var zv=mc("Promise");N({target:"Promise",stat:!0,forced:Nf},{reject:function(e$){var t$=He(this);return t$.reject.call(void 0,e$),t$.promise}}),N({target:"Promise",stat:!0,forced:Nf},{resolve:function(e$){return mj(this,e$)}}),N({target:"Promise",stat:!0,forced:vv},{all:function(e$){var t$=this,r$=He(t$),n$=r$.resolve,i$=r$.reject,o$=nj(function(){var s$=yb(t$.resolve),a$=[],c$=0,u$=1;Xg(e$,function(l$){var d$=c$++,h$=!1;a$.push(void 0),u$++,s$.call(t$,l$).then(function(p$){h$||(h$=!0,a$[d$]=p$,--u$||n$(a$))},i$)}),--u$||n$(a$)});return o$.error&&i$(o$.value),r$.promise},race:function(e$){var t$=this,r$=He(t$),n$=r$.reject,i$=nj(function(){var o$=yb(t$.resolve);Xg(e$,function(s$){o$.call(t$,s$).then(r$.resolve,n$)})});return i$.error&&n$(i$.value),r$.promise}});var mo=[].indexOf,no=!!mo&&0>1/[1].indexOf(1,-0),Bv=Ee("indexOf");N({target:"Array",proto:!0,forced:no||!Bv},{indexOf:function(e$){return no?mo.apply(this,arguments)||0:Si(this,e$,1<arguments.length?arguments[1]:void 0)}});var tj=function(){var e$=va(this),t$="";return e$.global&&(t$+="g"),e$.ignoreCase&&(t$+="i"),e$.multiline&&(t$+="m"),e$.dotAll&&(t$+="s"),e$.unicode&&(t$+="u"),e$.sticky&&(t$+="y"),t$},pc=R(function(){var e$=RegExp("a","y");return e$.lastIndex=2,e$.exec("abcd")!=null}),Cv=R(function(){var e$=RegExp("^r","gy");return e$.lastIndex=2,e$.exec("str")!=null}),ch=RegExp.prototype.exec,Dv=fd("native-string-replace",String.prototype.replace),oo=ch,uj=(c=/a/,a=/b*/g,ch.call(c,"a"),ch.call(a,"a"),c.lastIndex!==0||a.lastIndex!==0),po=pc||Cv,vj=/()??/.exec("")[1]!==void 0,c,a;(uj||vj||po)&&(oo=function(e$){var t$,r$=po&&this.sticky,n$=tj.call(this),i$=this.source,o$=0,s$=e$;if(r$){(n$=n$.replace("y","")).indexOf("g")===-1&&(n$+="g"),s$=String(e$).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&e$[this.lastIndex-1]!==`
`)&&(i$="(?: "+i$+")",s$=" "+s$,o$++);var a$=new RegExp("^(?:"+i$+")",n$)}if(vj&&(a$=new RegExp("^"+i$+"$(?!\\s)",n$)),uj)var c$=this.lastIndex;var u$=ch.call(r$?a$:this,s$);return r$?u$?(u$.input=u$.input.slice(o$),u$[0]=u$[0].slice(o$),u$.index=this.lastIndex,this.lastIndex+=u$[0].length):this.lastIndex=0:uj&&u$&&(this.lastIndex=this.global?u$.index+u$[0].length:c$),vj&&u$&&1<u$.length&&Dv.call(u$[0],a$,function(){for(t$=1;t$<arguments.length-2;t$++)arguments[t$]===void 0&&(u$[t$]=void 0)}),u$});var Of=oo;N({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Ev=qa("species"),wj=RegExp.prototype,Fv=!R(function(){var e$=/./;return e$.exec=function(){var t$=[];return t$.groups={a:"7"},t$},"".replace(e$,"$<a>")!=="7"}),qo="a".replace(/./,"$0")==="$0",ro=qa("replace"),so=!!/./[ro]&&/./[ro]("a","$0")==="",Gv=!R(function(){var e$=/(?:)/,t$=e$.exec;return e$.exec=function(){return t$.apply(this,arguments)},(e$="ab".split(e$)).length!==2||e$[0]!=="a"||e$[1]!=="b"}),dh=function(e$,t$,r$,n$){var i$=qa(e$),o$=!R(function(){var u$={};return u$[i$]=function(){return 7},""[e$](u$)!=7}),s$=o$&&!R(function(){var u$=!1,l$=/a/;return e$==="split"&&((l$={constructor:{}}).constructor[Ev]=function(){return l$},l$.flags="",l$[i$]=/./[i$]),l$.exec=function(){return u$=!0,null},l$[i$](""),!u$});if(!o$||!s$||e$==="replace"&&(!Fv||!qo||so)||e$==="split"&&!Gv){var a$=/./[i$],c$=(r$=r$(i$,""[e$],function(u$,l$,d$,h$,p$){var _$=l$.exec;return _$===Of||_$===wj.exec?o$&&!p$?{done:!0,value:a$.call(l$,d$,h$)}:{done:!0,value:u$.call(d$,l$,h$)}:{done:!1}},{REPLACE_KEEPS_$0:qo,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:so}))[1];Ta(String.prototype,e$,r$[0]),Ta(wj,i$,t$==2?function(u$,l$){return c$.call(u$,this,l$)}:function(u$){return c$.call(u$,this)})}n$&&Na(wj[i$],"sham",!0)},xj=function(e$,t$,r$){return t$+(r$?Gn(e$,t$).length:1)},Hv=Math.floor,Iv="".replace,Jv=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Kv=/\$([$&'`]|\d{1,2})/g,Lv=function(e$,t$,r$,n$,i$,o$){var s$=r$+e$.length,a$=n$.length,c$=Kv;return i$!==void 0&&(i$=Qa(i$),c$=Jv),Iv.call(o$,c$,function(u$,l$){switch(l$.charAt(0)){case"$":return"$";case"&":return e$;case"`":return t$.slice(0,r$);case"'":return t$.slice(s$);case"<":u$=i$[l$.slice(1,-1)];break;default:var d$=+l$;if(d$===0)return u$;if(d$>a$)return(d$=Hv(d$/10))===0?u$:d$<=a$?n$[d$-1]===void 0?l$.charAt(1):n$[d$-1]+l$.charAt(1):u$;u$=n$[d$-1]}return u$===void 0?"":u$})},Ke=function(e$,t$){var r$=e$.exec;if(typeof r$=="function"){if(typeof(e$=r$.call(e$,t$))!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return e$}if(Zb(e$)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return Of.call(e$,t$)},Mv=Math.max,Nv=Math.min,Ov=function(e$){return e$===void 0?e$:String(e$)};dh("replace",2,function(e$,t$,r$,n$){var i$=n$.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,o$=n$.REPLACE_KEEPS_$0,s$=i$?"$":"$0";return[function(a$,c$){var u$=jb(this),l$=a$==null?void 0:a$[e$];return l$!==void 0?l$.call(a$,u$,c$):t$.call(String(u$),a$,c$)},function(a$,c$){if(!i$&&o$||typeof c$=="string"&&c$.indexOf(s$)===-1){var u$=r$(t$,a$,this,c$);if(u$.done)return u$.value}var l$=va(a$);a$=String(this),(u$=typeof c$=="function")||(c$=String(c$));var d$=l$.global;if(d$){var h$=l$.unicode;l$.lastIndex=0}for(var p$=[];;){var _$=Ke(l$,a$);if(_$===null||(p$.push(_$),!d$))break;String(_$[0])===""&&(l$.lastIndex=xj(a$,ta(l$.lastIndex),h$))}for(h$="",d$=l$=0;d$<p$.length;d$++){_$=p$[d$];for(var f$=String(_$[0]),m$=Mv(Nv($b(_$.index),a$.length),0),g$=[],v$=1;v$<_$.length;v$++)g$.push(Ov(_$[v$]));_$=_$.groups,u$?(g$=[f$].concat(g$,m$,a$),_$!==void 0&&g$.push(_$),_$=String(c$.apply(void 0,g$))):_$=Lv(f$,a$,m$,g$,_$,c$),m$>=l$&&(h$+=a$.slice(l$,m$)+_$,l$=m$+f$.length)}return h$+a$.slice(l$)}]});var Pv=Ef("slice"),Qv=qa("species"),Rv=[].slice,Sv=Math.max;N({target:"Array",proto:!0,forced:!Pv},{slice:function(e$,t$){var r$=qb(this),n$=ta(r$.length);if(e$=xb(e$,n$),t$=xb(t$===void 0?n$:t$,n$),gd(r$)){var i$=r$.constructor;if(typeof i$!="function"||i$!==Array&&!gd(i$.prototype)?ha(i$)&&(i$=i$[Qv])===null&&(i$=void 0):i$=void 0,i$===Array||i$===void 0)return Rv.call(r$,e$,t$)}for(i$=new(i$===void 0?Array:i$)(Sv(t$-e$,0)),n$=0;e$<t$;e$++,n$++)e$ in r$&&Ge(i$,n$,r$[e$]);return i$.length=n$,i$}});var Tv=Za.set,Uv=Za.getterFor("Array Iterator"),ld=bj(Array,"Array",function(e$,t$){Tv(this,{type:"Array Iterator",target:qb(e$),index:0,kind:t$})},function(){var e$=Uv(this),t$=e$.target,r$=e$.kind,n$=e$.index++;return!t$||n$>=t$.length?(e$.target=void 0,{value:void 0,done:!0}):r$=="keys"?{value:n$,done:!1}:r$=="values"?{value:t$[n$],done:!1}:{value:[n$,t$[n$]],done:!1}},"values");Fe.Arguments=Fe.Array,Ld("keys"),Ld("values"),Ld("entries");var to=typeof ArrayBuffer<"u"&&typeof DataView<"u",Le=function(e$){if(e$===void 0)return 0;e$=$b(e$);var t$=ta(e$);if(e$!==t$)throw RangeError("Wrong length or index");return t$},Vv=Math.abs,Ic=Math.pow,Wv=Math.floor,Xv=Math.log,Yv=Math.LN2,yj=function(e$){var t$=Qa(this),r$=ta(t$.length),n$=arguments.length,i$=xb(1<n$?arguments[1]:void 0,r$);for(r$=(n$=2<n$?arguments[2]:void 0)===void 0?r$:xb(n$,r$);r$>i$;)t$[i$++]=e$;return t$},Zv=Hd.f,$v=Ra.f,Me=Za.get,uo=Za.set,bc=y.ArrayBuffer,Ab=bc,cc=y.DataView,eh=cc&&cc.prototype,vo=Object.prototype,fh=y.RangeError,wo=function(e$,t$,r$){var n$,i$=Array(r$),o$=(1<<(r$=8*r$-t$-1))-1,s$=o$>>1,a$=t$===23?Ic(2,-24)-Ic(2,-77):0,c$=0>e$||e$===0&&0>1/e$?1:0,u$=0;if((e$=Vv(e$))!=e$||e$===1/0){e$=e$!=e$?1:0;var l$=o$}else l$=Wv(Xv(e$)/Yv),1>e$*(n$=Ic(2,-l$))&&(l$--,n$*=2),2<=(e$=1<=l$+s$?e$+a$/n$:e$+a$*Ic(2,1-s$))*n$&&(l$++,n$/=2),l$+s$>=o$?(e$=0,l$=o$):1<=l$+s$?(e$=(e$*n$-1)*Ic(2,t$),l$+=s$):(e$=e$*Ic(2,s$-1)*Ic(2,t$),l$=0);for(;8<=t$;i$[u$++]=255&e$,e$/=256,t$-=8);for(l$=l$<<t$|e$,r$+=t$;0<r$;i$[u$++]=255&l$,l$/=256,r$-=8);return i$[--u$]|=128*c$,i$},xo=function(e$,t$){var r$=e$.length,n$=8*r$-t$-1,i$=(1<<n$)-1,o$=i$>>1;n$-=7,--r$;var s$=e$[r$--],a$=127&s$;for(s$>>=7;0<n$;a$=256*a$+e$[r$],r$--,n$-=8);var c$=a$&(1<<-n$)-1;for(a$>>=-n$,n$+=t$;0<n$;c$=256*c$+e$[r$],r$--,n$-=8);if(a$===0)a$=1-o$;else{if(a$===i$)return c$?NaN:s$?-1/0:1/0;c$+=Ic(2,t$),a$-=o$}return(s$?-1:1)*c$*Ic(2,a$-t$)},yo=function(e$){return[255&e$]},zo=function(e$){return[255&e$,e$>>8&255]},Ao=function(e$){return[255&e$,e$>>8&255,e$>>16&255,e$>>24&255]},Bo=function(e$){return e$[3]<<24|e$[2]<<16|e$[1]<<8|e$[0]},aw=function(e$){return wo(e$,23,4)},bw=function(e$){return wo(e$,52,8)},gh=function(e$,t$){$v(e$.prototype,t$,{get:function(){return Me(this)[t$]}})},md=function(e$,t$,r$,n$){r$=Le(r$);var i$=Me(e$);if(r$+t$>i$.byteLength)throw fh("Wrong index");return e$=Me(i$.buffer).bytes,r$+=i$.byteOffset,t$=e$.slice(r$,r$+t$),n$?t$:t$.reverse()},nd=function(e$,t$,r$,n$,i$,o$){r$=Le(r$);var s$=Me(e$);if(r$+t$>s$.byteLength)throw fh("Wrong index");for(e$=Me(s$.buffer).bytes,r$+=s$.byteOffset,n$=n$(+i$),i$=0;i$<t$;i$++)e$[r$+i$]=n$[o$?i$:t$-i$-1]};if(to){if(!R(function(){bc(1)})||!R(function(){new bc(-1)})||R(function(){return new bc,new bc(1.5),new bc(NaN),bc.name!="ArrayBuffer"})){Ab=function(e$){return Gc(this,Ab),new bc(Le(e$))};for(var cw=Ab.prototype=bc.prototype,Co=Zv(bc),Do=0,zj;Co.length>Do;)(zj=Co[Do++])in Ab||Na(Ab,zj,bc[zj]);cw.constructor=Ab}Ua&&Vb(eh)!==vo&&Ua(eh,vo);var hh=new cc(new Ab(2)),Eo=eh.setInt8;hh.setInt8(0,2147483648),hh.setInt8(1,2147483649),!hh.getInt8(0)&&hh.getInt8(1)||Hf(eh,{setInt8:function(e$,t$){Eo.call(this,e$,t$<<24>>24)},setUint8:function(e$,t$){Eo.call(this,e$,t$<<24>>24)}},{unsafe:!0})}else Ab=function(e$){Gc(this,Ab,"ArrayBuffer"),e$=Le(e$),uo(this,{bytes:yj.call(Array(e$),0),byteLength:e$}),ka||(this.byteLength=e$)},cc=function(e$,t$,r$){Gc(this,cc,"DataView"),Gc(e$,Ab,"DataView");var n$=Me(e$).byteLength;if(0>(t$=$b(t$))||t$>n$)throw fh("Wrong offset");if(t$+(r$=r$===void 0?n$-t$:ta(r$))>n$)throw fh("Wrong length");uo(this,{buffer:e$,byteLength:r$,byteOffset:t$}),ka||(this.buffer=e$,this.byteLength=r$,this.byteOffset=t$)},ka&&(gh(Ab,"byteLength"),gh(cc,"buffer"),gh(cc,"byteLength"),gh(cc,"byteOffset")),Hf(cc.prototype,{getInt8:function(e$){return md(this,1,e$)[0]<<24>>24},getUint8:function(e$){return md(this,1,e$)[0]},getInt16:function(e$){var t$=md(this,2,e$,1<arguments.length?arguments[1]:void 0);return(t$[1]<<8|t$[0])<<16>>16},getUint16:function(e$){var t$=md(this,2,e$,1<arguments.length?arguments[1]:void 0);return t$[1]<<8|t$[0]},getInt32:function(e$){return Bo(md(this,4,e$,1<arguments.length?arguments[1]:void 0))},getUint32:function(e$){return Bo(md(this,4,e$,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(e$){return xo(md(this,4,e$,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(e$){return xo(md(this,8,e$,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(e$,t$){nd(this,1,e$,yo,t$)},setUint8:function(e$,t$){nd(this,1,e$,yo,t$)},setInt16:function(e$,t$){nd(this,2,e$,zo,t$,2<arguments.length?arguments[2]:void 0)},setUint16:function(e$,t$){nd(this,2,e$,zo,t$,2<arguments.length?arguments[2]:void 0)},setInt32:function(e$,t$){nd(this,4,e$,Ao,t$,2<arguments.length?arguments[2]:void 0)},setUint32:function(e$,t$){nd(this,4,e$,Ao,t$,2<arguments.length?arguments[2]:void 0)},setFloat32:function(e$,t$){nd(this,4,e$,aw,t$,2<arguments.length?arguments[2]:void 0)},setFloat64:function(e$,t$){nd(this,8,e$,bw,t$,2<arguments.length?arguments[2]:void 0)}});Ec(Ab,"ArrayBuffer"),Ec(cc,"DataView");var Pf={ArrayBuffer:Ab,DataView:cc},Aj=Pf.ArrayBuffer,Fo=Pf.DataView,Go=Aj.prototype.slice,dw=R(function(){return!new Aj(2).slice(1,void 0).byteLength});N({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:dw},{slice:function(e$,t$){if(Go!==void 0&&t$===void 0)return Go.call(va(this),e$);var r$=va(this).byteLength;e$=xb(e$,r$),t$=xb(t$===void 0?r$:t$,r$),r$=new(kd(this,Aj))(ta(t$-e$));for(var n$=new Fo(this),i$=new Fo(r$),o$=0;e$<t$;)i$.setUint8(o$++,n$.getUint8(e$++));return r$}});var ew=Ra.f,ih=y.Int8Array,Bj=ih&&ih.prototype,Ho=y.Uint8ClampedArray,Io=Ho&&Ho.prototype,qc=ih&&Vb(ih),dc=Bj&&Vb(Bj),Jo=Object.prototype,Ko=Jo.isPrototypeOf,Lo=qa("toStringTag"),Cj=Ae("TYPED_ARRAY_TAG"),Jc=to&&!!Ua&&Ff(y.opera)!=="Opera",Mo=!1,Bb,rc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},fw={BigInt64Array:8,BigUint64Array:8},jh=function(e$){return!!ha(e$)&&(e$=Ff(e$),Q(rc,e$)||Q(fw,e$))};for(Bb in rc)y[Bb]||(Jc=!1);if((!Jc||typeof qc!="function"||qc===Function.prototype)&&(qc=function(){throw TypeError("Incorrect invocation")},Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb],qc);if((!Jc||!dc||dc===Jo)&&(dc=qc.prototype,Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb].prototype,dc);if(Jc&&Vb(Io)!==dc&&Ua(Io,dc),ka&&!Q(dc,Lo))for(Bb in Mo=!0,ew(dc,Lo,{get:function(){return ha(this)?this[Cj]:void 0}}),rc)y[Bb]&&Na(y[Bb],Cj,Bb);var Qf=Jc,No=Mo&&Cj,Da=function(e$){if(jh(e$))return e$;throw TypeError("Target is not a typed array")},Ne=function(e$){if(Ua){if(Ko.call(qc,e$))return e$}else for(var t$ in rc)if(Q(rc,Bb)){var r$=y[t$];if(r$&&(e$===r$||Ko.call(r$,e$)))return e$}throw TypeError("Target is not a typed array constructor")},Aa=function(e$,t$,r$){if(ka){if(r$)for(var n$ in rc){var i$=y[n$];if(i$&&Q(i$.prototype,e$))try{delete i$.prototype[e$]}catch{}}dc[e$]&&!r$||Ta(dc,e$,r$?t$:Jc&&Bj[e$]||t$)}},Oo=function(e$,t$,r$){var n$,i$;if(ka){if(Ua){if(r$){for(n$ in rc)if((i$=y[n$])&&Q(i$,e$))try{delete i$[e$]}catch{}}if(qc[e$]&&!r$)return;try{return Ta(qc,e$,r$?t$:Jc&&qc[e$]||t$)}catch{}}for(n$ in rc)!(i$=y[n$])||i$[e$]&&!r$||Ta(i$,e$,t$)}},Po=qc,Rf=dc,gw=y.ArrayBuffer,Od=y.Int8Array,Dj=!Qf||!R(function(){Od(1)})||!R(function(){new Od(-1)})||!Tg(function(e$){new Od,new Od(null),new Od(1.5),new Od(e$)},!0)||R(function(){return new Od(new gw(2),1,void 0).length!==1}),kh=function(e$,t$){if(0>(e$=$b(e$)))throw RangeError("The argument can't be less than 0");if(e$%t$)throw RangeError("Wrong offset");return e$},Ej=function(e$){var t$=Qa(e$),r$=arguments.length,n$=1<r$?arguments[1]:void 0,i$=n$!==void 0,o$=Xi(t$);if(o$!=null&&!Vi(o$)){var s$=o$.call(t$),a$=s$.next;for(t$=[];!(o$=a$.call(s$)).done;)t$.push(o$.value)}for(i$&&2<r$&&(n$=Id(n$,arguments[2],2)),o$=ta(t$.length),s$=new(Ne(this))(o$),r$=0;o$>r$;r$++)s$[r$]=i$?n$(t$[r$],r$):t$[r$];return s$},lh=function(e$,t$,r$){var n$,i$;return Ua&&typeof(n$=t$.constructor)=="function"&&n$!==r$&&ha(i$=n$.prototype)&&i$!==r$.prototype&&Ua(e$,i$),e$},Sf=$a(function(e$){var t$=Hd.f,r$=Za.get,n$=Za.set,i$=Ra.f,o$=Fb.f,s$=Math.round,a$=y.RangeError,c$=Pf.ArrayBuffer,u$=Pf.DataView,l$=function(m$,g$){var v$=0,y$=g$.length;for(m$=new(Ne(m$))(y$);y$>v$;)m$[v$]=g$[v$++];return m$},d$=function(m$,g$){i$(m$,g$,{get:function(){return r$(this)[g$]}})},h$=function(m$){var g$;return m$ instanceof c$||(g$=Ff(m$))=="ArrayBuffer"||g$=="SharedArrayBuffer"},p$=function(m$,g$){return jh(m$)&&typeof g$!="symbol"&&g$ in m$&&String(+g$)==String(g$)},_$=function(m$,g$){return p$(m$,g$=lc(g$,!0))?dd(2,m$[g$]):o$(m$,g$)},f$=function(m$,g$,v$){return!(p$(m$,g$=lc(g$,!0))&&ha(v$)&&Q(v$,"value"))||Q(v$,"get")||Q(v$,"set")||v$.configurable||Q(v$,"writable")&&!v$.writable||Q(v$,"enumerable")&&!v$.enumerable?i$(m$,g$,v$):(m$[g$]=v$.value,m$)};ka?(Qf||(Fb.f=_$,Ra.f=f$,d$(Rf,"buffer"),d$(Rf,"byteOffset"),d$(Rf,"byteLength"),d$(Rf,"length")),N({target:"Object",stat:!0,forced:!Qf},{getOwnPropertyDescriptor:_$,defineProperty:f$}),e$.exports=function(m$,g$,v$){var y$=m$.match(/\d+$/)[0]/8,S$=m$+(v$?"Clamped":"")+"Array",b$="get"+m$,$$="set"+m$,C$=y[S$],N$=C$;m$=N$&&N$.prototype;var k$={},O$=function(U$,x$){i$(U$,x$,{get:function(){var F$=r$(this);return F$.view[b$](x$*y$+F$.byteOffset,!0)},set:function(F$){var L$=r$(this);v$&&(F$=0>(F$=s$(F$))?0:255<F$?255:255&F$),L$.view[$$](x$*y$+L$.byteOffset,F$,!0)},enumerable:!0})};Qf?Dj&&(N$=g$(function(U$,x$,F$,L$){return Gc(U$,N$,S$),lh(ha(x$)?h$(x$)?L$!==void 0?new C$(x$,kh(F$,y$),L$):F$!==void 0?new C$(x$,kh(F$,y$)):new C$(x$):jh(x$)?l$(N$,x$):Ej.call(N$,x$):new C$(Le(x$)),U$,N$)}),Ua&&Ua(N$,Po),Jd(t$(C$),function(U$){U$ in N$||Na(N$,U$,C$[U$])}),N$.prototype=m$):(N$=g$(function(U$,x$,F$,L$){Gc(U$,N$,S$);var M$=0,V$=0;if(ha(x$)){if(!h$(x$))return jh(x$)?l$(N$,x$):Ej.call(N$,x$);var A$=x$;if(V$=kh(F$,y$),x$=x$.byteLength,L$===void 0){if(x$%y$||0>(L$=x$-V$))throw a$("Wrong length")}else if((L$=ta(L$)*y$)+V$>x$)throw a$("Wrong length");x$=L$/y$}else x$=Le(x$),A$=new c$(L$=x$*y$);for(n$(U$,{buffer:A$,byteOffset:V$,byteLength:L$,length:x$,view:new u$(A$)});M$<x$;)O$(U$,M$++)}),Ua&&Ua(N$,Po),m$=N$.prototype=ac(Rf)),m$.constructor!==N$&&Na(m$,"constructor",N$),No&&Na(m$,No,S$),k$[S$]=N$,N({global:!0,forced:N$!=C$,sham:!Qf},k$),"BYTES_PER_ELEMENT"in N$||Na(N$,"BYTES_PER_ELEMENT",y$),"BYTES_PER_ELEMENT"in m$||Na(m$,"BYTES_PER_ELEMENT",y$),If(S$)}):e$.exports=function(){}});Sf("Uint8",function(e$){return function(t$,r$,n$){return e$(this,t$,r$,n$)}});var hw=Math.min,iw=[].copyWithin||function(e$,t$){var r$=Qa(this),n$=ta(r$.length),i$=xb(e$,n$),o$=xb(t$,n$),s$=2<arguments.length?arguments[2]:void 0;for(n$=hw((s$===void 0?n$:xb(s$,n$))-o$,n$-i$),s$=1,o$<i$&&i$<o$+n$&&(s$=-1,o$+=n$-1,i$+=n$-1);0<n$--;)o$ in r$?r$[i$]=r$[o$]:delete r$[i$],i$+=s$,o$+=s$;return r$};Aa("copyWithin",function(e$,t$){return iw.call(Da(this),e$,t$,2<arguments.length?arguments[2]:void 0)}),Aa("every",function(e$){return Ju(Da(this),e$,1<arguments.length?arguments[1]:void 0)}),Aa("fill",function(e$){return yj.apply(Da(this),arguments)}),Aa("filter",function(e$){var t$=yn(Da(this),e$,1<arguments.length?arguments[1]:void 0),r$=kd(this,this.constructor),n$=0,i$=t$.length;for(r$=new(Ne(r$))(i$);i$>n$;)r$[n$]=t$[n$++];return r$}),Aa("find",function(e$){return zn(Da(this),e$,1<arguments.length?arguments[1]:void 0)}),Aa("findIndex",function(e$){return An(Da(this),e$,1<arguments.length?arguments[1]:void 0)}),Aa("forEach",function(e$){Jd(Da(this),e$,1<arguments.length?arguments[1]:void 0)}),Aa("includes",function(e$){return on(Da(this),e$,1<arguments.length?arguments[1]:void 0)}),Aa("indexOf",function(e$){return Si(Da(this),e$,1<arguments.length?arguments[1]:void 0)});var Qo=qa("iterator"),Ro=y.Uint8Array,jw=ld.values,kw=ld.keys,lw=ld.entries,Fj=Ro&&Ro.prototype[Qo],So=!!Fj&&(Fj.name=="values"||Fj.name==null),To=function(){return jw.call(Da(this))};Aa("entries",function(){return lw.call(Da(this))}),Aa("keys",function(){return kw.call(Da(this))}),Aa("values",To,!So),Aa(Qo,To,!So);var mw=[].join;Aa("join",function(e$){return mw.apply(Da(this),arguments)});var nw=Math.min,Gj=[].lastIndexOf,Uo=!!Gj&&0>1/[1].lastIndexOf(1,-0),ow=Ee("lastIndexOf"),pw=Uo||!ow?function(e$){if(Uo)return Gj.apply(this,arguments)||0;var t$=qb(this),r$=ta(t$.length),n$=r$-1;for(1<arguments.length&&(n$=nw(n$,$b(arguments[1]))),0>n$&&(n$=r$+n$);0<=n$;n$--)if(n$ in t$&&t$[n$]===e$)return n$||0;return-1}:Gj;Aa("lastIndexOf",function(e$){return pw.apply(Da(this),arguments)}),Aa("map",function(e$){return xn(Da(this),e$,1<arguments.length?arguments[1]:void 0,function(t$,r$){return new(Ne(kd(t$,t$.constructor)))(r$)})});var Vo=function(e$){return function(t$,r$,n$,i$){yb(r$),t$=Qa(t$);var o$=Af(t$),s$=ta(t$.length),a$=e$?s$-1:0,c$=e$?-1:1;if(2>n$)for(;;){if(a$ in o$){i$=o$[a$],a$+=c$;break}if(a$+=c$,e$?0>a$:s$<=a$)throw TypeError("Reduce of empty array with no initial value")}for(;e$?0<=a$:s$>a$;a$+=c$)a$ in o$&&(i$=r$(i$,o$[a$],a$,t$));return i$}},Wo=Vo(!1),qw=Vo(!0);Aa("reduce",function(e$){return Wo(Da(this),e$,arguments.length,1<arguments.length?arguments[1]:void 0)}),Aa("reduceRight",function(e$){return qw(Da(this),e$,arguments.length,1<arguments.length?arguments[1]:void 0)});var rw=Math.floor;Aa("reverse",function(){for(var e$,t$=Da(this).length,r$=rw(t$/2),n$=0;n$<r$;)e$=this[n$],this[n$++]=this[--t$],this[t$]=e$;return this});var sw=R(function(){new Int8Array(1).set({})});Aa("set",function(e$){Da(this);var t$=kh(1<arguments.length?arguments[1]:void 0,1),r$=this.length,n$=Qa(e$),i$=ta(n$.length),o$=0;if(i$+t$>r$)throw RangeError("Wrong length");for(;o$<i$;)this[t$+o$]=n$[o$++]},sw);var tw=[].slice,uw=R(function(){new Int8Array(1).slice()});Aa("slice",function(e$,t$){e$=tw.call(Da(this),e$,t$);var r$=kd(this,this.constructor);t$=0;var n$=e$.length;for(r$=new(Ne(r$))(n$);n$>t$;)r$[t$]=e$[t$++];return r$},uw),Aa("some",function(e$){return Iu(Da(this),e$,1<arguments.length?arguments[1]:void 0)});var vw=[].sort;Aa("sort",function(e$){return vw.call(Da(this),e$)}),Aa("subarray",function(e$,t$){var r$=Da(this),n$=r$.length;return e$=xb(e$,n$),new(kd(r$,r$.constructor))(r$.buffer,r$.byteOffset+e$*r$.BYTES_PER_ELEMENT,ta((t$===void 0?n$:xb(t$,n$))-e$))});var mh=y.Int8Array,Xo=[].toLocaleString,ww=[].slice,xw=!!mh&&R(function(){Xo.call(new mh(1))}),yw=R(function(){return[1,2].toLocaleString()!=new mh([1,2]).toLocaleString()})||!R(function(){mh.prototype.toLocaleString.call([1,2])});Aa("toLocaleString",function(){return Xo.apply(xw?ww.call(Da(this)):Da(this),arguments)},yw);var Yo=y.Uint8Array,zw=Yo&&Yo.prototype||{},nh=[].toString,Aw=[].join;R(function(){nh.call({})})&&(nh=function(){return Aw.call(this)}),Aa("toString",nh,zw.toString!=nh);var Zo=Pf.ArrayBuffer;N({global:!0,forced:y.ArrayBuffer!==Zo},{ArrayBuffer:Zo}),If("ArrayBuffer");var Bw=Ra.f,Hj=Function.prototype,Cw=Hj.toString,Dw=/^\s*function ([^ (]*)/;!ka||"name"in Hj||Bw(Hj,"name",{configurable:!0,get:function(){try{return Cw.call(this).match(Dw)[1]}catch{return""}}});var $o=RegExp.prototype,ap=$o.toString,Ew=R(function(){return ap.call({source:"a",flags:"b"})!="/a/b"}),Fw=ap.name!="toString";(Ew||Fw)&&Ta(RegExp.prototype,"toString",function(){var e$=va(this),t$=String(e$.source),r$=e$.flags;return"/"+t$+"/"+(e$=String(r$===void 0&&e$ instanceof RegExp&&!("flags"in $o)?tj.call(e$):r$))},{unsafe:!0});var Gw=Ef("splice"),Hw=Math.max,Iw=Math.min;N({target:"Array",proto:!0,forced:!Gw},{splice:function(e$,t$){var r$,n$,i$=Qa(this),o$=ta(i$.length),s$=xb(e$,o$),a$=arguments.length;if(a$===0?a$=r$=0:a$===1?(a$=0,r$=o$-s$):(a$-=2,r$=Iw(Hw($b(t$),0),o$-s$)),9007199254740991<o$+a$-r$)throw TypeError("Maximum allowed length exceeded");var c$=Sg(i$,r$);for(n$=0;n$<r$;n$++){var u$=s$+n$;u$ in i$&&Ge(c$,n$,i$[u$])}if(c$.length=r$,a$<r$){for(n$=s$;n$<o$-r$;n$++){var l$=n$+a$;(u$=n$+r$)in i$?i$[l$]=i$[u$]:delete i$[l$]}for(n$=o$;n$>o$-r$+a$;n$--)delete i$[n$-1]}else if(a$>r$)for(n$=o$-r$;n$>s$;n$--)l$=n$+a$-1,(u$=n$+r$-1)in i$?i$[l$]=i$[u$]:delete i$[l$];for(n$=0;n$<a$;n$++)i$[n$+s$]=arguments[n$+2];return i$.length=o$-r$+a$,c$}});var Ij={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Jj=qa("iterator"),bp=qa("toStringTag"),Kj=ld.values,oh;for(oh in Ij){var cp=y[oh],Kc=cp&&cp.prototype;if(Kc){if(Kc[Jj]!==Kj)try{Na(Kc,Jj,Kj)}catch{Kc[Jj]=Kj}if(Kc[bp]||Na(Kc,bp,oh),Ij[oh]){for(var Oe in ld)if(Kc[Oe]!==ld[Oe])try{Na(Kc,Oe,ld[Oe])}catch{Kc[Oe]=ld[Oe]}}}}var dp=Object.is||function(e$,t$){return e$===t$?e$!==0||1/e$==1/t$:e$!=e$&&t$!=t$};dh("search",1,function(e$,t$,r$){return[function(n$){var i$=jb(this),o$=n$==null?void 0:n$[e$];return o$!==void 0?o$.call(n$,i$):new RegExp(n$)[e$](String(i$))},function(n$){var i$=r$(t$,n$,this);if(i$.done)return i$.value;n$=va(n$);var o$=String(this);return i$=n$.lastIndex,dp(i$,0)||(n$.lastIndex=0),o$=Ke(n$,o$),dp(n$.lastIndex,i$)||(n$.lastIndex=i$),o$===null?-1:o$.index}]}),$a(function(e$){(function(t$,r$){e$.exports?e$.exports=r$(t$):r$(t$)})(typeof self<"u"?self:Ya,function(t$){function r$(O$){return btoa(O$).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function n$(O$){return O$=(O$+="===").slice(0,-O$.length%4),atob(O$.replace(/-/g,"+").replace(/_/g,"/"))}function i$(O$){for(var U$=new Uint8Array(O$.length),x$=0;x$<O$.length;x$++)U$[x$]=O$.charCodeAt(x$);return U$}function o$(O$){return O$ instanceof ArrayBuffer&&(O$=new Uint8Array(O$)),String.fromCharCode.apply(String,O$)}function s$(O$){var U$={name:(O$.name||O$||"").toUpperCase().replace("V","v")};switch(U$.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":O$.length&&(U$.length=O$.length);break;case"HMAC":O$.hash&&(U$.hash=s$(O$.hash)),O$.length&&(U$.length=O$.length);break;case"RSAES-PKCS1-v1_5":O$.publicExponent&&(U$.publicExponent=new Uint8Array(O$.publicExponent)),O$.modulusLength&&(U$.modulusLength=O$.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":O$.hash&&(U$.hash=s$(O$.hash)),O$.publicExponent&&(U$.publicExponent=new Uint8Array(O$.publicExponent)),O$.modulusLength&&(U$.modulusLength=O$.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return U$}function a$(O$){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[O$.name][(O$.hash||{}).name||O$.length||""]}function c$(O$){(O$ instanceof ArrayBuffer||O$ instanceof Uint8Array)&&(O$=JSON.parse(decodeURIComponent(escape(o$(O$)))));var U$={kty:O$.kty,alg:O$.alg,ext:O$.ext||O$.extractable};switch(U$.kty){case"oct":U$.k=O$.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach(function(x$){x$ in O$&&(U$[x$]=O$[x$])});break;default:throw new TypeError("Unsupported key type")}return U$}function u$(O$){return O$=c$(O$),b$&&(O$.extractable=O$.ext,delete O$.ext),i$(unescape(encodeURIComponent(JSON.stringify(O$)))).buffer}function l$(O$){var U$=d$(O$),x$=!1;switch(2<U$.length&&(x$=!0,U$.shift()),O$={ext:!0},U$[0][0]){case"1.2.840.113549.1.1.1":var F$="n e d p q dp dq qi".split(" ");for(U$=d$(U$[1]),x$&&U$.shift(),x$=0;x$<U$.length;x$++)U$[x$][0]||(U$[x$]=U$[x$].subarray(1)),O$[F$[x$]]=r$(o$(U$[x$]));O$.kty="RSA";break;default:throw new TypeError("Unsupported key type")}return O$}function d$(O$,U$){if(O$ instanceof ArrayBuffer&&(O$=new Uint8Array(O$)),U$||(U$={pos:0,end:O$.length}),2>U$.end-U$.pos||U$.end>O$.length)throw new RangeError("Malformed DER");var x$=O$[U$.pos++],F$=O$[U$.pos++];if(128<=F$){if(F$&=127,U$.end-U$.pos<F$)throw new RangeError("Malformed DER");for(var L$=0;F$--;)L$<<=8,L$|=O$[U$.pos++];F$=L$}if(U$.end-U$.pos<F$)throw new RangeError("Malformed DER");switch(x$){case 2:x$=O$.subarray(U$.pos,U$.pos+=F$);break;case 3:if(O$[U$.pos++])throw Error("Unsupported bit string");F$--;case 4:x$=new Uint8Array(O$.subarray(U$.pos,U$.pos+=F$)).buffer;break;case 5:x$=null;break;case 6:if(!((O$=btoa(o$(O$.subarray(U$.pos,U$.pos+=F$))))in C$))throw Error("Unsupported OBJECT ID "+O$);x$=C$[O$];break;case 48:for(x$=[],F$=U$.pos+F$;U$.pos<F$;)x$.push(d$(O$,U$));break;default:throw Error("Unsupported DER tag 0x"+x$.toString(16))}return x$}function h$(O$,U$){U$||(U$=[]);var x$=U$.length+2;if(U$.push(0,0),O$ instanceof Uint8Array)for(var F$=2,L$=O$.length,M$=0;M$<L$;M$++)U$.push(O$[M$]);else if(O$ instanceof ArrayBuffer)for(F$=4,L$=O$.byteLength,O$=new Uint8Array(O$),M$=0;M$<L$;M$++)U$.push(O$[M$]);else if(O$===null)F$=5,L$=0;else if(typeof O$=="string"&&O$ in N$)for(F$=6,L$=(O$=i$(atob(N$[O$]))).length,M$=0;M$<L$;M$++)U$.push(O$[M$]);else if(O$ instanceof Array){for(M$=0;M$<O$.length;M$++)h$(O$[M$],U$);F$=48,L$=U$.length-x$}else{if(!(X(O$)==="object"&&O$.tag===3&&O$.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+O$);for(F$=3,L$=(O$=new Uint8Array(O$.value)).byteLength,U$.push(0),M$=0;M$<L$;M$++)U$.push(O$[M$]);L$++}if(128<=L$){for(M$=L$,L$=4,U$.splice(x$,0,M$>>24&255,M$>>16&255,M$>>8&255,255&M$);1<L$&&!(M$>>24);)M$<<=8,L$--;4>L$&&U$.splice(x$,4-L$),L$|=128}return U$.splice(x$-2,2,F$,L$),U$}function p$(O$,U$,x$,F$){Object.defineProperties(this,{_key:{value:O$},type:{value:O$.type,enumerable:!0},extractable:{value:x$===void 0?O$.extractable:x$,enumerable:!0},algorithm:{value:U$===void 0?O$.algorithm:U$,enumerable:!0},usages:{value:F$===void 0?O$.usages:F$,enumerable:!0}})}function _$(O$){return O$==="verify"||O$==="encrypt"||O$==="wrapKey"}function f$(O$){return O$==="sign"||O$==="decrypt"||O$==="unwrapKey"}if(typeof Promise!="function")throw"Promise support required";var m$=t$.crypto||t$.msCrypto;if(m$){var g$=m$.subtle||m$.webkitSubtle;if(g$){var v$=t$.Crypto||m$.constructor||Object,y$=t$.SubtleCrypto||g$.constructor||Object;t$.CryptoKey||t$.Key;var S$=-1<t$.navigator.userAgent.indexOf("Edge/"),b$=!!t$.msCrypto&&!S$,$$=!m$.subtle&&!!m$.webkitSubtle;if(b$||$$){var C$={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},N$={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach(function(O$){var U$=g$[O$];g$[O$]=function(x$,F$,L$){var M$=[].slice.call(arguments);switch(O$){case"generateKey":var V$=s$(x$),A$=F$,I$=L$;break;case"importKey":V$=s$(L$),A$=M$[3],I$=M$[4],x$==="jwk"&&((F$=c$(F$)).alg||(F$.alg=a$(V$)),F$.key_ops||(F$.key_ops=F$.kty!=="oct"?"d"in F$?I$.filter(f$):I$.filter(_$):I$.slice()),M$[1]=u$(F$));break;case"unwrapKey":V$=M$[4],A$=M$[5],I$=M$[6],M$[2]=L$._key}if(O$==="generateKey"&&V$.name==="HMAC"&&V$.hash)return V$.length=V$.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[V$.hash.name],g$.importKey("raw",m$.getRandomValues(new Uint8Array(V$.length+7>>3)),V$,A$,I$);if($$&&O$==="generateKey"&&V$.name==="RSASSA-PKCS1-v1_5"&&(!V$.modulusLength||2048<=V$.modulusLength))return(x$=s$(x$)).name="RSAES-PKCS1-v1_5",delete x$.hash,g$.generateKey(x$,!0,["encrypt","decrypt"]).then(function(w$){return Promise.all([g$.exportKey("jwk",w$.publicKey),g$.exportKey("jwk",w$.privateKey)])}).then(function(w$){return w$[0].alg=w$[1].alg=a$(V$),w$[0].key_ops=I$.filter(_$),w$[1].key_ops=I$.filter(f$),Promise.all([g$.importKey("jwk",w$[0],V$,!0,w$[0].key_ops),g$.importKey("jwk",w$[1],V$,A$,w$[1].key_ops)])}).then(function(w$){return{publicKey:w$[0],privateKey:w$[1]}});if(($$||b$&&(V$.hash||{}).name==="SHA-1")&&O$==="importKey"&&x$==="jwk"&&V$.name==="HMAC"&&F$.kty==="oct")return g$.importKey("raw",i$(n$(F$.k)),L$,M$[3],M$[4]);if($$&&O$==="importKey"&&(x$==="spki"||x$==="pkcs8"))return g$.importKey("jwk",l$(F$),L$,M$[3],M$[4]);if(b$&&O$==="unwrapKey")return g$.decrypt(M$[3],L$,F$).then(function(w$){return g$.importKey(x$,w$,M$[4],M$[5],M$[6])});try{var P$=U$.apply(g$,M$)}catch(w$){return Promise.reject(w$)}return b$&&(P$=new Promise(function(w$,E$){P$.onabort=P$.onerror=function(T$){E$(T$)},P$.oncomplete=function(T$){w$(T$.target.result)}})),P$=P$.then(function(w$){return V$.name!=="HMAC"||V$.length||(V$.length=8*w$.algorithm.length),V$.name.search("RSA")==0&&(V$.modulusLength||(V$.modulusLength=(w$.publicKey||w$).algorithm.modulusLength),V$.publicExponent||(V$.publicExponent=(w$.publicKey||w$).algorithm.publicExponent)),w$.publicKey&&w$.privateKey?{publicKey:new p$(w$.publicKey,V$,A$,I$.filter(_$)),privateKey:new p$(w$.privateKey,V$,A$,I$.filter(f$))}:new p$(w$,V$,A$,I$)})}}),["exportKey","wrapKey"].forEach(function(O$){var U$=g$[O$];g$[O$]=function(x$,F$,L$){var M$=[].slice.call(arguments);switch(O$){case"exportKey":M$[1]=F$._key;break;case"wrapKey":M$[1]=F$._key,M$[2]=L$._key}if(($$||b$&&(F$.algorithm.hash||{}).name==="SHA-1")&&O$==="exportKey"&&x$==="jwk"&&F$.algorithm.name==="HMAC"&&(M$[0]="raw"),!$$||O$!=="exportKey"||x$!=="spki"&&x$!=="pkcs8"||(M$[0]="jwk"),b$&&O$==="wrapKey")return g$.exportKey(x$,F$).then(function(A$){return x$==="jwk"&&(A$=i$(unescape(encodeURIComponent(JSON.stringify(c$(A$)))))),g$.encrypt(M$[3],L$,A$)});try{var V$=U$.apply(g$,M$)}catch(A$){return Promise.reject(A$)}return b$&&(V$=new Promise(function(A$,I$){V$.onabort=V$.onerror=function(P$){I$(P$)},V$.oncomplete=function(P$){A$(P$.target.result)}})),O$==="exportKey"&&x$==="jwk"&&(V$=V$.then(function(A$){return($$||b$&&(F$.algorithm.hash||{}).name==="SHA-1")&&F$.algorithm.name==="HMAC"?{kty:"oct",alg:a$(F$.algorithm),key_ops:F$.usages.slice(),ext:!0,k:r$(o$(A$))}:((A$=c$(A$)).alg||(A$.alg=a$(F$.algorithm)),A$.key_ops||(A$.key_ops=F$.type==="public"?F$.usages.filter(_$):F$.type==="private"?F$.usages.filter(f$):F$.usages.slice()),A$)})),!$$||O$!=="exportKey"||x$!=="spki"&&x$!=="pkcs8"||(V$=V$.then(function(A$){var I$=[["",null]],P$=!1;switch((A$=c$(A$)).kty){case"RSA":for(var w$="n e d p q dp dq qi".split(" "),E$=[],T$=0;T$<w$.length&&w$[T$]in A$;T$++){var R$=E$[T$]=i$(n$(A$[w$[T$]]));128&R$[0]&&(E$[T$]=new Uint8Array(R$.length+1),E$[T$].set(R$,1))}2<E$.length&&(P$=!0,E$.unshift(new Uint8Array([0]))),I$[0][0]="1.2.840.113549.1.1.1";break;default:throw new TypeError("Unsupported key type")}return I$.push(new Uint8Array(h$(E$)).buffer),P$?I$.unshift(new Uint8Array([0])):I$[1]={tag:3,value:I$[1]},new Uint8Array(h$(I$)).buffer})),V$}}),["encrypt","decrypt","sign","verify"].forEach(function(O$){var U$=g$[O$];g$[O$]=function(x$,F$,L$,M$){if(b$&&(!L$.byteLength||M$&&!M$.byteLength))throw Error("Empty input is not allowed");var V$=[].slice.call(arguments),A$=s$(x$);if(!b$||O$!=="sign"&&O$!=="verify"||x$!=="RSASSA-PKCS1-v1_5"&&x$!=="HMAC"||(V$[0]={name:x$}),b$&&F$.algorithm.hash&&(V$[0].hash=V$[0].hash||F$.algorithm.hash),b$&&O$==="decrypt"&&A$.name==="AES-GCM"){var I$=x$.tagLength>>3;V$[2]=(L$.buffer||L$).slice(0,L$.byteLength-I$),x$.tag=(L$.buffer||L$).slice(L$.byteLength-I$)}b$&&A$.name==="AES-GCM"&&V$[0].tagLength===void 0&&(V$[0].tagLength=128),V$[1]=F$._key;try{var P$=U$.apply(g$,V$)}catch(w$){return Promise.reject(w$)}return b$&&(P$=new Promise(function(w$,E$){P$.onabort=P$.onerror=function(T$){E$(T$)},P$.oncomplete=function(T$){if(T$=T$.target.result,O$==="encrypt"&&T$ instanceof AesGcmEncryptResult){var R$=T$.ciphertext,D$=T$.tag;(T$=new Uint8Array(R$.byteLength+D$.byteLength)).set(new Uint8Array(R$),0),T$.set(new Uint8Array(D$),R$.byteLength),T$=T$.buffer}w$(T$)}})),P$}}),b$){var k$=g$.digest;g$.digest=function(O$,U$){if(!U$.byteLength)throw Error("Empty input is not allowed");try{var x$=k$.call(g$,O$,U$)}catch(F$){return Promise.reject(F$)}return x$=new Promise(function(F$,L$){x$.onabort=x$.onerror=function(M$){L$(M$)},x$.oncomplete=function(M$){F$(M$.target.result)}})},t$.crypto=Object.create(m$,{getRandomValues:{value:function(O$){return m$.getRandomValues(O$)}},subtle:{value:g$}}),t$.CryptoKey=p$}$$&&(m$.subtle=g$,t$.Crypto=v$,t$.SubtleCrypto=y$,t$.CryptoKey=p$)}}}})});var Jw=qa("match"),Lj=function(e$){var t$;return ha(e$)&&((t$=e$[Jw])!==void 0?!!t$:Zb(e$)=="RegExp")},Kw=[].push,Lw=Math.min;dh("split",2,function(e$,t$,r$){var n$="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||1<".".split(/()()/).length||"".split(/.?/).length?function(i$,o$){var s$=String(jb(this));if((o$=o$===void 0?4294967295:o$>>>0)===0)return[];if(i$===void 0)return[s$];if(!Lj(i$))return t$.call(s$,i$,o$);var a$,c$,u$,l$=[],d$=0;for(i$=new RegExp(i$.source,(i$.ignoreCase?"i":"")+(i$.multiline?"m":"")+(i$.unicode?"u":"")+(i$.sticky?"y":"")+"g");(a$=Of.call(i$,s$))&&!((c$=i$.lastIndex)>d$&&(l$.push(s$.slice(d$,a$.index)),1<a$.length&&a$.index<s$.length&&Kw.apply(l$,a$.slice(1)),u$=a$[0].length,d$=c$,l$.length>=o$));)i$.lastIndex===a$.index&&i$.lastIndex++;return d$===s$.length?(u$||!i$.test(""))&&l$.push(""):l$.push(s$.slice(d$)),l$.length>o$?l$.slice(0,o$):l$}:"0".split(void 0,0).length?function(i$,o$){return i$===void 0&&o$===0?[]:t$.call(this,i$,o$)}:t$;return[function(i$,o$){var s$=jb(this),a$=i$==null?void 0:i$[e$];return a$!==void 0?a$.call(i$,s$,o$):n$.call(String(s$),i$,o$)},function(i$,o$){var s$=r$(n$,i$,this,o$,n$!==t$);if(s$.done)return s$.value;var a$=va(i$);i$=String(this);var c$=kd(a$,RegExp);if(s$=a$.unicode,a$=new c$(pc?"^(?:"+a$.source+")":a$,(a$.ignoreCase?"i":"")+(a$.multiline?"m":"")+(a$.unicode?"u":"")+(pc?"g":"y")),(o$=o$===void 0?4294967295:o$>>>0)===0)return[];if(i$.length===0)return Ke(a$,i$)===null?[i$]:[];var u$=0,l$=0;for(c$=[];l$<i$.length;){a$.lastIndex=pc?0:l$;var d$,h$=Ke(a$,pc?i$.slice(l$):i$);if(h$===null||(d$=Lw(ta(a$.lastIndex+(pc?l$:0)),i$.length))===u$)l$=xj(i$,l$,s$);else{if(c$.push(i$.slice(u$,l$)),c$.length===o$)return c$;for(u$=1;u$<=h$.length-1;u$++)if(c$.push(h$[u$]),c$.length===o$)return c$;l$=u$=d$}}return c$.push(i$.slice(u$)),c$}]},pc),function(e$){e$.console||(e$.console={}),e$=e$.console;for(var t$,r$=function(){},n$=["memory"],i$="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");t$=n$.pop();)e$[t$]||(e$[t$]={});for(;t$=i$.pop();)e$[t$]||(e$[t$]=r$)}(typeof window>"u"?Ya:window),N({target:"Object",stat:!0},{setPrototypeOf:Ua});var Mw=R(function(){Vb(1)});N({target:"Object",stat:!0,forced:Mw,sham:!Hn},{getPrototypeOf:function(e$){return Vb(Qa(e$))}});var ep=[].slice,Mj={},Nw=Function.bind||function(e$){var t$=yb(this),r$=ep.call(arguments,1),n$=function(){var i$=r$.concat(ep.call(arguments));if(this instanceof n$){var o$=i$.length;if(!(o$ in Mj)){for(var s$=[],a$=0;a$<o$;a$++)s$[a$]="a["+a$+"]";Mj[o$]=Function("C,a","return new C("+s$.join(",")+")")}i$=Mj[o$](t$,i$)}else i$=t$.apply(e$,i$);return i$};return ha(t$.prototype)&&(n$.prototype=t$.prototype),n$},Nj=mc("Reflect","construct"),fp=R(function(){function e$(){}return!(Nj(function(){},[],e$)instanceof e$)}),gp=!R(function(){Nj(function(){})}),hp=fp||gp;N({target:"Reflect",stat:!0,forced:hp,sham:hp},{construct:function(e$,t$){yb(e$),va(t$);var r$=3>arguments.length?e$:yb(arguments[2]);if(gp&&!fp)return Nj(e$,t$,r$);if(e$==r$){switch(t$.length){case 0:return new e$;case 1:return new e$(t$[0]);case 2:return new e$(t$[0],t$[1]);case 3:return new e$(t$[0],t$[1],t$[2]);case 4:return new e$(t$[0],t$[1],t$[2],t$[3])}return(r$=[null]).push.apply(r$,t$),new(Nw.apply(e$,r$))}r$=r$.prototype,r$=ac(ha(r$)?r$:Object.prototype);var n$=Function.apply.call(e$,r$,t$);return ha(n$)?n$:r$}}),N({target:"Reflect",stat:!0},{get:wl});var ip=Fb.f,Ow=R(function(){ip(1)});N({target:"Object",stat:!0,forced:!ka||Ow,sham:!ka},{getOwnPropertyDescriptor:function(e$,t$){return ip(qb(e$),t$)}});var jp=Hd.f,Pw={}.toString,kp=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Oj=function(e$){if(kp&&Pw.call(e$)=="[object Window]")try{var t$=jp(e$)}catch{t$=kp.slice()}else t$=jp(qb(e$));return t$},lp={f:qa},Qw=Ra.f,ph=function(e$){var t$=y.Symbol||(y.Symbol={});Q(t$,e$)||Qw(t$,e$,{value:lp.f(e$)})},rb=Pg("hidden"),mp=qa("toPrimitive"),Rw=Za.set,np=Za.getterFor("Symbol"),Ob=Object.prototype,sb=y.Symbol,Tf=mc("JSON","stringify"),op=Fb.f,od=Ra.f,pp=Oj,Sw=zf,Lc=fd("symbols"),Uf=fd("op-symbols"),Pj=fd("string-to-symbol-registry"),Qj=fd("symbol-to-string-registry"),Tw=fd("wks"),Rj=y.QObject,Sj=!Rj||!Rj.prototype||!Rj.prototype.findChild,Tj=ka&&R(function(){return ac(od({},"a",{get:function(){return od(this,"a",{value:7}).a}})).a!=7})?function(e$,t$,r$){var n$=op(Ob,t$);n$&&delete Ob[t$],od(e$,t$,r$),n$&&e$!==Ob&&od(Ob,t$,n$)}:od,Uj=function(e$,t$){var r$=Lc[e$]=ac(sb.prototype);return Rw(r$,{type:"Symbol",tag:e$,description:t$}),ka||(r$.description=t$),r$},Vj=vn?function(e$){return typeof e$=="symbol"}:function(e$){return Object(e$)instanceof sb},qh=function(e$,t$,r$){return e$===Ob&&qh(Uf,t$,r$),va(e$),t$=lc(t$,!0),va(r$),Q(Lc,t$)?(r$.enumerable?(Q(e$,rb)&&e$[rb][t$]&&(e$[rb][t$]=!1),r$=ac(r$,{enumerable:dd(0,!1)})):(Q(e$,rb)||od(e$,rb,dd(1,{})),e$[rb][t$]=!0),Tj(e$,t$,r$)):od(e$,t$,r$)},qp=function(e$,t$){va(e$);var r$=qb(t$);return t$=Dc(r$).concat(Wj(r$)),Jd(t$,function(n$){ka&&!Xj.call(r$,n$)||qh(e$,n$,r$[n$])}),e$},Xj=function(e$){e$=lc(e$,!0);var t$=Sw.call(this,e$);return!(this===Ob&&Q(Lc,e$)&&!Q(Uf,e$))&&(!(t$||!Q(this,e$)||!Q(Lc,e$)||Q(this,rb)&&this[rb][e$])||t$)},rp=function(e$,t$){if(e$=qb(e$),t$=lc(t$,!0),e$!==Ob||!Q(Lc,t$)||Q(Uf,t$)){var r$=op(e$,t$);return!r$||!Q(Lc,t$)||Q(e$,rb)&&e$[rb][t$]||(r$.enumerable=!0),r$}},sp=function(e$){e$=pp(qb(e$));var t$=[];return Jd(e$,function(r$){Q(Lc,r$)||Q(Be,r$)||t$.push(r$)}),t$},Wj=function(e$){var t$=e$===Ob;e$=pp(t$?Uf:qb(e$));var r$=[];return Jd(e$,function(n$){!Q(Lc,n$)||t$&&!Q(Ob,n$)||r$.push(Lc[n$])}),r$};if(oc||(sb=function(){if(this instanceof sb)throw TypeError("Symbol is not a constructor");var e$=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,t$=Ae(e$),r$=function(n$){this===Ob&&r$.call(Uf,n$),Q(this,rb)&&Q(this[rb],t$)&&(this[rb][t$]=!1),Tj(this,t$,dd(1,n$))};return ka&&Sj&&Tj(Ob,t$,{configurable:!0,set:r$}),Uj(t$,e$)},Ta(sb.prototype,"toString",function(){return np(this).tag}),Ta(sb,"withoutSetter",function(e$){return Uj(Ae(e$),e$)}),zf=Xj,Ra.f=qh,Fb.f=rp,Hd.f=Oj=sp,Bf.f=Wj,lp.f=function(e$){return Uj(qa(e$),e$)},ka&&(od(sb.prototype,"description",{configurable:!0,get:function(){return np(this).description}}),Ta(Ob,"propertyIsEnumerable",Xj,{unsafe:!0}))),N({global:!0,wrap:!0,forced:!oc,sham:!oc},{Symbol:sb}),Jd(Dc(Tw),function(e$){ph(e$)}),N({target:"Symbol",stat:!0,forced:!oc},{for:function(e$){if(e$=String(e$),Q(Pj,e$))return Pj[e$];var t$=sb(e$);return Pj[e$]=t$,Qj[t$]=e$,t$},keyFor:function(e$){if(!Vj(e$))throw TypeError(e$+" is not a symbol");if(Q(Qj,e$))return Qj[e$]},useSetter:function(){Sj=!0},useSimple:function(){Sj=!1}}),N({target:"Object",stat:!0,forced:!oc,sham:!ka},{create:function(e$,t$){return t$===void 0?ac(e$):qp(ac(e$),t$)},defineProperty:qh,defineProperties:qp,getOwnPropertyDescriptor:rp}),N({target:"Object",stat:!0,forced:!oc},{getOwnPropertyNames:sp,getOwnPropertySymbols:Wj}),N({target:"Object",stat:!0,forced:R(function(){Bf.f(1)})},{getOwnPropertySymbols:function(e$){return Bf.f(Qa(e$))}}),Tf){var Uw=!oc||R(function(){var e$=sb();return Tf([e$])!="[null]"||Tf({a:e$})!="{}"||Tf(Object(e$))!="{}"});N({target:"JSON",stat:!0,forced:Uw},{stringify:function(e$,t$,r$){for(var n$,i$=[e$],o$=1;arguments.length>o$;)i$.push(arguments[o$++]);if(n$=t$,(ha(t$)||e$!==void 0)&&!Vj(e$))return gd(t$)||(t$=function(s$,a$){if(typeof n$=="function"&&(a$=n$.call(this,s$,a$)),!Vj(a$))return a$}),i$[1]=t$,Tf.apply(null,i$)}})}sb.prototype[mp]||Na(sb.prototype,mp,sb.prototype.valueOf),Ec(sb,"Symbol"),Be[rb]=!0;var Vw=Ra.f,Mc=y.Symbol;if(ka&&typeof Mc=="function"&&(!("description"in Mc.prototype)||Mc().description!==void 0)){var tp={},Vf=function(){var e$=1>arguments.length||arguments[0]===void 0?void 0:String(arguments[0]),t$=this instanceof Vf?new Mc(e$):e$===void 0?Mc():Mc(e$);return e$===""&&(tp[t$]=!0),t$};rn(Vf,Mc);var Yj=Vf.prototype=Mc.prototype;Yj.constructor=Vf;var Ww=Yj.toString,Xw=String(Mc("test"))=="Symbol(test)",Yw=/^Symbol\((.*)\)[^)]+$/;Vw(Yj,"description",{configurable:!0,get:function(){var e$=ha(this)?this.valueOf():this,t$=Ww.call(e$);return Q(tp,e$)?"":(e$=Xw?t$.slice(7,-1):t$.replace(Yw,"$1"))===""?void 0:e$}}),N({global:!0,forced:!0},{Symbol:Vf})}ph("toStringTag"),Ec(y.JSON,"JSON",!0),Ec(Math,"Math",!0),function(){function e$(h$,p$){if(!(h$ instanceof p$))throw new TypeError("Cannot call a class as a function")}function t$(h$,p$){for(var _$=0;_$<p$.length;_$++){var f$=p$[_$];f$.enumerable=f$.enumerable||!1,f$.configurable=!0,"value"in f$&&(f$.writable=!0),Object.defineProperty(h$,f$.key,f$)}}function r$(h$,p$,_$){return p$&&t$(h$.prototype,p$),h$}function n$(h$,p$){if(typeof p$!="function"&&p$!==null)throw new TypeError("Super expression must either be null or a function");h$.prototype=Object.create(p$&&p$.prototype,{constructor:{value:h$,writable:!0,configurable:!0}}),p$&&o$(h$,p$)}function i$(h$){return(i$=Object.setPrototypeOf?Object.getPrototypeOf:function(p$){return p$.__proto__||Object.getPrototypeOf(p$)})(h$)}function o$(h$,p$){return(o$=Object.setPrototypeOf||function(_$,f$){return _$.__proto__=f$,_$})(h$,p$)}function s$(h$){if(h$===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h$}function a$(h$){var p$=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var _$=i$(h$);if(p$){var f$=i$(this).constructor;_$=Reflect.construct(_$,arguments,f$)}else _$=_$.apply(this,arguments);return _$=!_$||X(_$)!=="object"&&typeof _$!="function"?s$(this):_$}}function c$(h$,p$,_$){return(c$=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(f$,m$,g$){for(;!Object.prototype.hasOwnProperty.call(f$,m$)&&(f$=i$(f$))!==null;);if(f$)return(m$=Object.getOwnPropertyDescriptor(f$,m$)).get?m$.get.call(g$):m$.value})(h$,p$,_$||h$)}var u$=function(){function h$(){e$(this,h$),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return r$(h$,[{key:"addEventListener",value:function(p$,_$,f$){p$ in this.listeners||(this.listeners[p$]=[]),this.listeners[p$].push({callback:_$,options:f$})}},{key:"removeEventListener",value:function(p$,_$){if(p$ in this.listeners){for(var f$=0,m$=(p$=this.listeners[p$]).length;f$<m$;f$++)if(p$[f$].callback===_$){p$.splice(f$,1);break}}}},{key:"dispatchEvent",value:function(p$){if(p$.type in this.listeners){for(var _$=this.listeners[p$.type].slice(),f$=0,m$=_$.length;f$<m$;f$++){var g$=_$[f$];try{g$.callback.call(this,p$)}catch(v$){Promise.resolve().then(function(){throw v$})}g$.options&&g$.options.once&&this.removeEventListener(p$.type,g$.callback)}return!p$.defaultPrevented}}}]),h$}(),l$=function(h$){function p$(){e$(this,p$);var f$=_$.call(this);return f$.listeners||u$.call(s$(f$)),Object.defineProperty(s$(f$),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(s$(f$),"onabort",{value:null,writable:!0,configurable:!0}),f$}n$(p$,h$);var _$=a$(p$);return r$(p$,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(f$){f$.type==="abort"&&(this.aborted=!0,typeof this.onabort=="function"&&this.onabort.call(this,f$)),c$(i$(p$.prototype),"dispatchEvent",this).call(this,f$)}}]),p$}(u$),d$=function(){function h$(){e$(this,h$),Object.defineProperty(this,"signal",{value:new l$,writable:!0,configurable:!0})}return r$(h$,[{key:"abort",value:function(){try{var p$=new Event("abort")}catch{typeof document<"u"?document.createEvent?(p$=document.createEvent("Event")).initEvent("abort",!1,!1):(p$=document.createEventObject()).type="abort":p$={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(p$)}},{key:"toString",value:function(){return"[object AbortController]"}}]),h$}();typeof Symbol<"u"&&Symbol.toStringTag&&(d$.prototype[Symbol.toStringTag]="AbortController",l$.prototype[Symbol.toStringTag]="AbortSignal"),function(h$){if(h$.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var p$=!0}else p$=typeof h$.Request=="function"&&!h$.Request.prototype.hasOwnProperty("signal")||!h$.AbortController;p$&&(h$.AbortController=d$,h$.AbortSignal=l$)}(typeof self<"u"?self:Ya)}();var Zw=Math.floor,$w=Math.log,ax=Math.LOG2E;N({target:"Math",stat:!0},{clz32:function(e$){return(e$>>>=0)?31-Zw($w(e$+.5)*ax):32}});var bx=Math.log,cx=Math.LN2,ss=Math.clz32||function(e$){return 31-bx(e$>>>0)/cx|0},xd=String.fromCharCode,up={}.toString,Zj=window.Uint8Array,ak=Zj||Array,dx=up.call((window.ArrayBuffer||ak).prototype),bk;xl.prototype.decode=function(e$){if(e$=e$&&e$.buffer||e$,up.call(e$)!==dx)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var t$="",r$=0,n$=0|(e$=Zj?new ak(e$):e$).length;r$<n$;r$=r$+32768|0)t$+=xd.apply(0,e$[Zj?"slice":"subarray"](r$,r$+32768|0));return t$.replace(/[\xc0-\xff][\x80-\xbf]*/g,rs)},window.TextDecoder||(window.TextDecoder=xl),yl.prototype.encode=function(e$){for(var t$=0|(e$=e$===void 0?"":(""+e$).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,ts)).length,r$=new ak(t$),n$=0;n$<t$;n$=n$+1|0)r$[n$]=e$.charCodeAt(n$);return r$},window.TextEncoder||(window.TextEncoder=yl),function(e$){var t$,r$,n$,i$,o$,s$,a$,c$,u$,l$,d$;(function(h$){h$.LOGIN="LOGIN",h$.LOGIN_SUCCESS="LOGIN_SUCCESS",h$.LOGIN_FAILURE="LOGIN_FAILURE",h$.LOGIN_TIMEOUT="LOGIN_TIMEOUT",h$.INTERRUPTED="INTERRUPTED",h$.LOGOUT="LOGOUT",h$.BANNED_BY_SERVER="BANNED_BY_SERVER",h$.REMOTE_LOGIN="REMOTE_LOGIN"})(t$||(t$={})),e$.ConnectionChangeReason=t$,function(h$){h$.DISCONNECTED="DISCONNECTED",h$.CONNECTING="CONNECTING",h$.CONNECTED="CONNECTED",h$.RECONNECTING="RECONNECTING",h$.ABORTED="ABORTED"}(r$||(r$={})),e$.ConnectionState=r$,function(h$){h$.IDLE="IDLE",h$.SENT_TO_REMOTE="SENT_TO_REMOTE",h$.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",h$.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",h$.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",h$.CANCELED="CANCELED",h$.FAILURE="FAILURE"}(n$||(n$={})),e$.LocalInvitationState=n$,function(h$){h$.INVITATION_RECEIVED="INVITATION_RECEIVED",h$.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",h$.REFUSED="REFUSED",h$.ACCEPTED="ACCEPTED",h$.CANCELED="CANCELED",h$.FAILURE="FAILURE"}(i$||(i$={})),e$.RemoteInvitationState=i$,function(h$){h$.UNKNOWN="UNKNOWN",h$.PEER_NO_RESPONSE="PEER_NO_RESPONSE",h$.INVITATION_EXPIRE="INVITATION_EXPIRE",h$.PEER_OFFLINE="PEER_OFFLINE",h$.NOT_LOGGEDIN="NOT_LOGGEDIN"}(o$||(o$={})),e$.LocalInvitationFailureReason=o$,function(h$){h$.UNKNOWN="UNKNOWN",h$.PEER_OFFLINE="PEER_OFFLINE",h$.ACCEPT_FAILURE="ACCEPT_FAILURE",h$.INVITATION_EXPIRE="INVITATION_EXPIRE"}(s$||(s$={})),e$.RemoteInvitationFailureReason=s$,function(h$){h$.ONLINE="ONLINE",h$.UNREACHABLE="UNREACHABLE",h$.OFFLINE="OFFLINE"}(a$||(a$={})),e$.PeerOnlineState=a$,(c$||(c$={})).ONLINE_STATUS="ONLINE_STATUS",e$.PeerSubscriptionOption=c$,function(h$){h$.TEXT="TEXT",h$.RAW="RAW",h$.IMAGE="IMAGE",h$.FILE="FILE"}(u$||(u$={})),e$.MessageType=u$,function(h$){h$.CN="CN",h$.NA="NA",h$.EU="EU",h$.AS="AS",h$.JP="JP",h$.IN="IN",h$.GLOB="GLOB",h$.OC="OC",h$.SA="SA",h$.AF="AF",h$.OVS="OVS"}(l$||(l$={})),e$.LegacyAreaCode=l$,function(h$){h$.GLOBAL="GLOBAL",h$.INDIA="INDIA",h$.JAPAN="JAPAN",h$.ASIA="ASIA",h$.EUROPE="EUROPE",h$.CHINA="CHINA",h$.NORTH_AMERICA="NORTH_AMERICA"}(d$||(d$={})),e$.AreaCode=d$}(bk||(bk={}));var S=bk;N({target:"Array",proto:!0},{includes:function(e$){return on(this,e$,1<arguments.length?arguments[1]:void 0)}}),Ld("includes");var ck=function(e$){if(Lj(e$))throw TypeError("The method doesn't accept regular expressions");return e$},ex=qa("match"),dk=function(e$){var t$=/./;try{"/./"[e$](t$)}catch{try{return t$[ex]=!1,"/./"[e$](t$)}catch{}}return!1};N({target:"String",proto:!0,forced:!dk("includes")},{includes:function(e$){return!!~String(jb(this)).indexOf(ck(e$),1<arguments.length?arguments[1]:void 0)}});var Nc={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0};ph("iterator"),ph("asyncIterator");var ek=Ee("forEach")?[].forEach:function(e$){return Jd(this,e$,1<arguments.length?arguments[1]:void 0)},vp;for(vp in Ij){var wp=y[vp],rh=wp&&wp.prototype;if(rh&&rh.forEach!==ek)try{Na(rh,"forEach",ek)}catch{rh.forEach=ek}}var fx=[].reverse,xp=[1,2];N({target:"Array",proto:!0,forced:String(xp)===String(xp.reverse())},{reverse:function(){return gd(this)&&(this.length=this.length),fx.call(this)}});var w=$a(function(e$){e$=function(t$){function r$(L$,M$,V$){return Object.defineProperty(L$,M$,{value:V$,enumerable:!0,configurable:!0,writable:!0}),L$[M$]}function n$(L$,M$,V$,A$){return M$=Object.create((M$&&M$.prototype instanceof o$?M$:o$).prototype),A$=new p$(A$||[]),M$._invoke=function(I$,P$,w$){var E$=C$;return function(T$,R$){if(E$===k$)throw Error("Generator is already running");if(E$===O$){if(T$==="throw")throw R$;return f$()}for(w$.method=T$,w$.arg=R$;;){if((T$=w$.delegate)&&(T$=l$(T$,w$))){if(T$===U$)continue;return T$}if(w$.method==="next")w$.sent=w$._sent=w$.arg;else if(w$.method==="throw"){if(E$===C$)throw E$=O$,w$.arg;w$.dispatchException(w$.arg)}else w$.method==="return"&&w$.abrupt("return",w$.arg);if(E$=k$,(T$=i$(I$,P$,w$)).type==="normal"){if(E$=w$.done?O$:N$,T$.arg===U$)continue;return{value:T$.arg,done:w$.done}}T$.type==="throw"&&(E$=O$,w$.method="throw",w$.arg=T$.arg)}}}(L$,V$,A$),M$}function i$(L$,M$,V$){try{return{type:"normal",arg:L$.call(M$,V$)}}catch(A$){return{type:"throw",arg:A$}}}function o$(){}function s$(){}function a$(){}function c$(L$){["next","throw","return"].forEach(function(M$){r$(L$,M$,function(V$){return this._invoke(M$,V$)})})}function u$(L$,M$){function V$(I$,P$,w$,E$){if((I$=i$(L$[I$],L$,P$)).type!=="throw"){var T$=I$.arg;return(I$=T$.value)&&X(I$)==="object"&&v$.call(I$,"__await")?M$.resolve(I$.__await).then(function(R$){V$("next",R$,w$,E$)},function(R$){V$("throw",R$,w$,E$)}):M$.resolve(I$).then(function(R$){T$.value=R$,w$(T$)},function(R$){return V$("throw",R$,w$,E$)})}E$(I$.arg)}var A$;this._invoke=function(I$,P$){function w$(){return new M$(function(E$,T$){V$(I$,P$,E$,T$)})}return A$=A$?A$.then(w$,w$):w$()}}function l$(L$,M$){var V$=L$.iterator[M$.method];if(V$===m$){if(M$.delegate=null,M$.method==="throw"){if(L$.iterator.return&&(M$.method="return",M$.arg=m$,l$(L$,M$),M$.method==="throw"))return U$;M$.method="throw",M$.arg=new TypeError("The iterator does not provide a 'throw' method")}return U$}return(V$=i$(V$,L$.iterator,M$.arg)).type==="throw"?(M$.method="throw",M$.arg=V$.arg,M$.delegate=null,U$):(V$=V$.arg)?V$.done?(M$[L$.resultName]=V$.value,M$.next=L$.nextLoc,M$.method!=="return"&&(M$.method="next",M$.arg=m$),M$.delegate=null,U$):V$:(M$.method="throw",M$.arg=new TypeError("iterator result is not an object"),M$.delegate=null,U$)}function d$(L$){var M$={tryLoc:L$[0]};1 in L$&&(M$.catchLoc=L$[1]),2 in L$&&(M$.finallyLoc=L$[2],M$.afterLoc=L$[3]),this.tryEntries.push(M$)}function h$(L$){var M$=L$.completion||{};M$.type="normal",delete M$.arg,L$.completion=M$}function p$(L$){this.tryEntries=[{tryLoc:"root"}],L$.forEach(d$,this),this.reset(!0)}function _$(L$){if(L$){var M$=L$[S$];if(M$)return M$.call(L$);if(typeof L$.next=="function")return L$;if(!isNaN(L$.length)){var V$=-1;return(M$=function A$(){for(;++V$<L$.length;)if(v$.call(L$,V$))return A$.value=L$[V$],A$.done=!1,A$;return A$.value=m$,A$.done=!0,A$}).next=M$}}return{next:f$}}function f$(){return{value:m$,done:!0}}var m$,g$=Object.prototype,v$=g$.hasOwnProperty,y$=typeof Symbol=="function"?Symbol:{},S$=y$.iterator||"@@iterator",b$=y$.asyncIterator||"@@asyncIterator",$$=y$.toStringTag||"@@toStringTag";try{r$({},"")}catch{r$=function(M$,V$,A$){return M$[V$]=A$}}t$.wrap=n$;var C$="suspendedStart",N$="suspendedYield",k$="executing",O$="completed",U$={};r$(y$={},S$,function(){return this});var x$=Object.getPrototypeOf;(x$=x$&&x$(x$(_$([]))))&&x$!==g$&&v$.call(x$,S$)&&(y$=x$);var F$=a$.prototype=o$.prototype=Object.create(y$);return s$.prototype=a$,r$(F$,"constructor",a$),r$(a$,"constructor",s$),s$.displayName=r$(a$,$$,"GeneratorFunction"),t$.isGeneratorFunction=function(L$){return!!(L$=typeof L$=="function"&&L$.constructor)&&(L$===s$||(L$.displayName||L$.name)==="GeneratorFunction")},t$.mark=function(L$){return Object.setPrototypeOf?Object.setPrototypeOf(L$,a$):(L$.__proto__=a$,r$(L$,$$,"GeneratorFunction")),L$.prototype=Object.create(F$),L$},t$.awrap=function(L$){return{__await:L$}},c$(u$.prototype),r$(u$.prototype,b$,function(){return this}),t$.AsyncIterator=u$,t$.async=function(L$,M$,V$,A$,I$){I$===void 0&&(I$=Promise);var P$=new u$(n$(L$,M$,V$,A$),I$);return t$.isGeneratorFunction(M$)?P$:P$.next().then(function(w$){return w$.done?w$.value:P$.next()})},c$(F$),r$(F$,$$,"Generator"),r$(F$,S$,function(){return this}),r$(F$,"toString",function(){return"[object Generator]"}),t$.keys=function(L$){var M$,V$=[];for(M$ in L$)V$.push(M$);return V$.reverse(),function A$(){for(;V$.length;){var I$=V$.pop();if(I$ in L$)return A$.value=I$,A$.done=!1,A$}return A$.done=!0,A$}},t$.values=_$,p$.prototype={constructor:p$,reset:function(L$){if(this.next=this.prev=0,this.sent=this._sent=m$,this.done=!1,this.delegate=null,this.method="next",this.arg=m$,this.tryEntries.forEach(h$),!L$)for(var M$ in this)M$.charAt(0)==="t"&&v$.call(this,M$)&&!isNaN(+M$.slice(1))&&(this[M$]=m$)},stop:function(){this.done=!0;var L$=this.tryEntries[0].completion;if(L$.type==="throw")throw L$.arg;return this.rval},dispatchException:function(L$){function M$(T$,R$){return P$.type="throw",P$.arg=L$,V$.next=T$,R$&&(V$.method="next",V$.arg=m$),!!R$}if(this.done)throw L$;for(var V$=this,A$=this.tryEntries.length-1;0<=A$;--A$){var I$=this.tryEntries[A$],P$=I$.completion;if(I$.tryLoc==="root")return M$("end");if(I$.tryLoc<=this.prev){var w$=v$.call(I$,"catchLoc"),E$=v$.call(I$,"finallyLoc");if(w$&&E$){if(this.prev<I$.catchLoc)return M$(I$.catchLoc,!0);if(this.prev<I$.finallyLoc)return M$(I$.finallyLoc)}else if(w$){if(this.prev<I$.catchLoc)return M$(I$.catchLoc,!0)}else{if(!E$)throw Error("try statement without catch or finally");if(this.prev<I$.finallyLoc)return M$(I$.finallyLoc)}}}},abrupt:function(L$,M$){for(var V$=this.tryEntries.length-1;0<=V$;--V$){var A$=this.tryEntries[V$];if(A$.tryLoc<=this.prev&&v$.call(A$,"finallyLoc")&&this.prev<A$.finallyLoc){var I$=A$;break}}return I$&&(L$==="break"||L$==="continue")&&I$.tryLoc<=M$&&M$<=I$.finallyLoc&&(I$=null),(V$=I$?I$.completion:{}).type=L$,V$.arg=M$,I$?(this.method="next",this.next=I$.finallyLoc,U$):this.complete(V$)},complete:function(L$,M$){if(L$.type==="throw")throw L$.arg;return L$.type==="break"||L$.type==="continue"?this.next=L$.arg:L$.type==="return"?(this.rval=this.arg=L$.arg,this.method="return",this.next="end"):L$.type==="normal"&&M$&&(this.next=M$),U$},finish:function(L$){for(var M$=this.tryEntries.length-1;0<=M$;--M$){var V$=this.tryEntries[M$];if(V$.finallyLoc===L$)return this.complete(V$.completion,V$.afterLoc),h$(V$),U$}},catch:function(L$){for(var M$=this.tryEntries.length-1;0<=M$;--M$){var V$=this.tryEntries[M$];if(V$.tryLoc===L$){if((L$=V$.completion).type==="throw"){var A$=L$.arg;h$(V$)}return A$}}throw Error("illegal catch attempt")},delegateYield:function(L$,M$,V$){return this.delegate={iterator:_$(L$),resultName:M$,nextLoc:V$},this.method==="next"&&(this.arg=m$),U$}},t$}(e$.exports);try{regeneratorRuntime=e$}catch{(typeof globalThis>"u"?"undefined":X(globalThis))==="object"?globalThis.regeneratorRuntime=e$:Function("r","regeneratorRuntime = r")(e$)}}),yp=!R(function(){return Object.isExtensible(Object.preventExtensions({}))}),fk=$a(function(e$){var t$=Ra.f,r$=Ae("meta"),n$=0,i$=Object.isExtensible||function(){return!0},o$=function(a$){t$(a$,r$,{value:{objectID:"O"+ ++n$,weakData:{}}})},s$=e$.exports={REQUIRED:!1,fastKey:function(a$,c$){if(!ha(a$))return typeof a$=="symbol"?a$:(typeof a$=="string"?"S":"P")+a$;if(!Q(a$,r$)){if(!i$(a$))return"F";if(!c$)return"E";o$(a$)}return a$[r$].objectID},getWeakData:function(a$,c$){if(!Q(a$,r$)){if(!i$(a$))return!0;if(!c$)return!1;o$(a$)}return a$[r$].weakData},onFreeze:function(a$){return yp&&s$.REQUIRED&&i$(a$)&&!Q(a$,r$)&&o$(a$),a$}};Be[r$]=!0}),zp=function(e$,t$,r$){var n$=e$.indexOf("Map")!==-1,i$=e$.indexOf("Weak")!==-1,o$=n$?"set":"add",s$=y[e$],a$=s$&&s$.prototype,c$=s$,u$={},l$=function(m$){var g$=a$[m$];Ta(a$,m$,m$=="add"?function(v$){return g$.call(this,v$===0?0:v$),this}:m$=="delete"?function(v$){return!(i$&&!ha(v$))&&g$.call(this,v$===0?0:v$)}:m$=="get"?function(v$){return i$&&!ha(v$)?void 0:g$.call(this,v$===0?0:v$)}:m$=="has"?function(v$){return!(i$&&!ha(v$))&&g$.call(this,v$===0?0:v$)}:function(v$,y$){return g$.call(this,v$===0?0:v$,y$),this})};if(nc(e$,typeof s$!="function"||!(i$||a$.forEach&&!R(function(){new s$().entries().next()}))))c$=r$.getConstructor(t$,e$,n$,o$),fk.REQUIRED=!0;else if(nc(e$,!0)){var d$=new c$,h$=d$[o$](i$?{}:-0,1)!=d$,p$=R(function(){d$.has(1)}),_$=Tg(function(m$){new s$(m$)}),f$=!i$&&R(function(){for(var m$=new s$,g$=5;g$--;)m$[o$](g$,g$);return!m$.has(-0)});_$||((c$=t$(function(m$,g$){return Gc(m$,c$,e$),m$=lh(new s$,m$,c$),g$!=null&&Xg(g$,m$[o$],{that:m$,AS_ENTRIES:n$}),m$})).prototype=a$,a$.constructor=c$),(p$||f$)&&(l$("delete"),l$("has"),n$&&l$("get")),(f$||h$)&&l$(o$),i$&&a$.clear&&delete a$.clear}return u$[e$]=c$,N({global:!0,forced:c$!=s$},u$),Ec(c$,e$),i$||r$.setStrong(c$,e$,n$),c$},gx=Ra.f,Ap=fk.fastKey,Bp=Za.set,gk=Za.getterFor,Cp={getConstructor:function(e$,t$,r$,n$){var i$=e$(function(c$,u$){Gc(c$,i$,t$),Bp(c$,{type:t$,index:ac(null),first:void 0,last:void 0,size:0}),ka||(c$.size=0),u$!=null&&Xg(u$,c$[n$],{that:c$,AS_ENTRIES:r$})}),o$=gk(t$),s$=function(c$,u$,l$){var d$,h$=o$(c$),p$=a$(c$,u$);return p$?p$.value=l$:(h$.last=p$={index:d$=Ap(u$,!0),key:u$,value:l$,previous:u$=h$.last,next:void 0,removed:!1},h$.first||(h$.first=p$),u$&&(u$.next=p$),ka?h$.size++:c$.size++,d$!=="F"&&(h$.index[d$]=p$)),c$},a$=function(c$,u$){c$=o$(c$);var l$=Ap(u$);if(l$!=="F")return c$.index[l$];for(c$=c$.first;c$;c$=c$.next)if(c$.key==u$)return c$};return Hf(i$.prototype,{clear:function(){for(var c$=o$(this),u$=c$.index,l$=c$.first;l$;)l$.removed=!0,l$.previous&&(l$.previous=l$.previous.next=void 0),delete u$[l$.index],l$=l$.next;c$.first=c$.last=void 0,ka?c$.size=0:this.size=0},delete:function(c$){var u$=o$(this);if(c$=a$(this,c$)){var l$=c$.next,d$=c$.previous;delete u$.index[c$.index],c$.removed=!0,d$&&(d$.next=l$),l$&&(l$.previous=d$),u$.first==c$&&(u$.first=l$),u$.last==c$&&(u$.last=d$),ka?u$.size--:this.size--}return!!c$},forEach:function(c$){for(var u$,l$=o$(this),d$=Id(c$,1<arguments.length?arguments[1]:void 0,3);u$=u$?u$.next:l$.first;)for(d$(u$.value,u$.key,this);u$&&u$.removed;)u$=u$.previous},has:function(c$){return!!a$(this,c$)}}),Hf(i$.prototype,r$?{get:function(c$){return(c$=a$(this,c$))&&c$.value},set:function(c$,u$){return s$(this,c$===0?0:c$,u$)}}:{add:function(c$){return s$(this,c$=c$===0?0:c$,c$)}}),ka&&gx(i$.prototype,"size",{get:function(){return o$(this).size}}),i$},setStrong:function(e$,t$,r$){var n$=t$+" Iterator",i$=gk(t$),o$=gk(n$);bj(e$,t$,function(s$,a$){Bp(this,{type:n$,target:s$,state:i$(s$),kind:a$,last:void 0})},function(){for(var s$=o$(this),a$=s$.kind,c$=s$.last;c$&&c$.removed;)c$=c$.previous;return s$.target&&(s$.last=c$=c$?c$.next:s$.state.first)?a$=="keys"?{value:c$.key,done:!1}:a$=="values"?{value:c$.value,done:!1}:{value:[c$.key,c$.value],done:!1}:(s$.target=void 0,{value:void 0,done:!0})},r$?"entries":"values",!r$,!0),If(t$)}};zp("Set",function(e$){return function(){return e$(this,arguments.length?arguments[0]:void 0)}},Cp);var hx=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,ix=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,hk=function(e$){return function(t$){return t$=String(jb(t$)),1&e$&&(t$=t$.replace(hx,"")),2&e$&&(t$=t$.replace(ix,"")),t$}},ik=hk(3),sh=y.parseInt,jx=/^[+-]?0[Xx]/,Dp=sh(`	
\v\f\r \u2028\u2029\uFEFF08`)!==8||sh(`	
\v\f\r \u2028\u2029\uFEFF0x16`)!==22?function(e$,t$){return e$=ik(String(e$)),sh(e$,t$>>>0||(jx.test(e$)?16:10))}:sh;N({global:!0,forced:parseInt!=Dp},{parseInt:Dp});var kx=Hd.f,lx=Fb.f,mx=Ra.f,pd=y.Number,th=pd.prototype,nx=Zb(ac(th))=="Number",Ep=function(e$){var t$,r$=lc(e$,!1);if(typeof r$=="string"&&2<r$.length){if((e$=(r$=ik(r$)).charCodeAt(0))===43||e$===45){if((e$=r$.charCodeAt(2))===88||e$===120)return NaN}else if(e$===48){switch(r$.charCodeAt(1)){case 66:case 98:e$=2;var n$=49;break;case 79:case 111:e$=8,n$=55;break;default:return+r$}var i$=(r$=r$.slice(2)).length;for(t$=0;t$<i$;t$++){var o$=r$.charCodeAt(t$);if(48>o$||o$>n$)return NaN}return parseInt(r$,e$)}}return+r$};if(nc("Number",!pd(" 0o1")||!pd("0b1")||pd("+0x1"))){for(var Pd=function(e$){var t$=1>arguments.length?0:e$,r$=this;return r$ instanceof Pd&&(nx?R(function(){th.valueOf.call(r$)}):Zb(r$)!="Number")?lh(new pd(Ep(t$)),r$,Pd):Ep(t$)},Fp=ka?kx(pd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),jk=0,uh;Fp.length>jk;jk++)Q(pd,uh=Fp[jk])&&!Q(Pd,uh)&&mx(Pd,uh,lx(pd,uh));Pd.prototype=th,th.constructor=Pd,Ta(y,"Number",Pd)}var Gp=qa("isConcatSpreadable"),ox=51<=id||!R(function(){var e$=[];return e$[Gp]=!1,e$.concat()[0]!==e$}),px=Ef("concat");N({target:"Array",proto:!0,forced:!ox||!px},{concat:function(e$){var t$,r$=Qa(this),n$=Sg(r$,0),i$=0,o$=-1;for(t$=arguments.length;o$<t$;o$++){var s$=o$===-1?r$:arguments[o$],a$=s$;if(ha(a$)){var c$=a$[Gp];a$=c$!==void 0?!!c$:gd(a$)}else a$=!1;if(a$){if(9007199254740991<i$+(c$=ta(s$.length)))throw TypeError("Maximum allowed index exceeded");for(a$=0;a$<c$;a$++,i$++)a$ in s$&&Ge(n$,i$,s$[a$])}else{if(9007199254740991<=i$)throw TypeError("Maximum allowed index exceeded");Ge(n$,i$++,s$)}}return n$.length=i$,n$}});var kk=mc("Reflect","apply"),qx=Function.apply,rx=!R(function(){kk(function(){})});N({target:"Reflect",stat:!0,forced:rx},{apply:function(e$,t$,r$){return yb(e$),va(r$),kk?kk(e$,t$,r$):qx.call(e$,t$,r$)}}),N({target:"Reflect",stat:!0},{ownKeys:qn});var sx=Oj,tx=R(function(){return!Object.getOwnPropertyNames(1)});N({target:"Object",stat:!0,forced:tx},{getOwnPropertyNames:sx});var Pe=(typeof Reflect>"u"?"undefined":X(Reflect))==="object"?Reflect:null,Hp=Pe&&typeof Pe.apply=="function"?Pe.apply:function(e$,t$,r$){return Function.prototype.apply.call(e$,t$,r$)},ux=Pe&&typeof Pe.ownKeys=="function"?Pe.ownKeys:Object.getOwnPropertySymbols?function(e$){return Object.getOwnPropertyNames(e$).concat(Object.getOwnPropertySymbols(e$))}:function(e$){return Object.getOwnPropertyNames(e$)},Ip=Number.isNaN||function(e$){return e$!=e$};ea.EventEmitter=ea,ea.prototype._events=void 0,ea.prototype._eventsCount=0,ea.prototype._maxListeners=void 0;var Jp=10;Object.defineProperty(ea,"defaultMaxListeners",{enumerable:!0,get:function(){return Jp},set:function(e$){if(typeof e$!="number"||0>e$||Ip(e$))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e$+".");Jp=e$}}),ea.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ea.prototype.setMaxListeners=function(e$){if(typeof e$!="number"||0>e$||Ip(e$))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e$+".");return this._maxListeners=e$,this},ea.prototype.getMaxListeners=function(){return this._maxListeners===void 0?ea.defaultMaxListeners:this._maxListeners},ea.prototype.emit=function(e$){for(var t$=[],r$=1;r$<arguments.length;r$++)t$.push(arguments[r$]);r$=e$==="error";var n$=this._events;if(n$!==void 0)r$=r$&&n$.error===void 0;else if(!r$)return!1;if(r$){var i$;throw 0<t$.length&&(i$=t$[0]),i$ instanceof Error?i$:((t$=Error("Unhandled error."+(i$?" ("+i$.message+")":""))).context=i$,t$)}if((r$=n$[e$])===void 0)return!1;if(typeof r$=="function")Hp(r$,this,t$);else for(n$=Cl(r$,i$=r$.length),r$=0;r$<i$;++r$)Hp(n$[r$],this,t$);return!0},ea.prototype.addListener=function(e$,t$){return zl(this,e$,t$,!1)},ea.prototype.on=ea.prototype.addListener,ea.prototype.prependListener=function(e$,t$){return zl(this,e$,t$,!0)},ea.prototype.once=function(e$,t$){return ng(t$),this.on(e$,Al(this,e$,t$)),this},ea.prototype.prependOnceListener=function(e$,t$){return ng(t$),this.prependListener(e$,Al(this,e$,t$)),this},ea.prototype.removeListener=function(e$,t$){var r$;ng(t$);var n$=this._events;if(n$===void 0)return this;var i$=n$[e$];if(i$===void 0)return this;if(i$===t$||i$.listener===t$)--this._eventsCount==0?this._events=Object.create(null):(delete n$[e$],n$.removeListener&&this.emit("removeListener",e$,i$.listener||t$));else if(typeof i$!="function"){var o$=-1;for(r$=i$.length-1;0<=r$;r$--)if(i$[r$]===t$||i$[r$].listener===t$){var s$=i$[r$].listener;o$=r$;break}if(0>o$)return this;if(o$===0)i$.shift();else{for(;o$+1<i$.length;o$++)i$[o$]=i$[o$+1];i$.pop()}i$.length===1&&(n$[e$]=i$[0]),n$.removeListener!==void 0&&this.emit("removeListener",e$,s$||t$)}return this},ea.prototype.off=ea.prototype.removeListener,ea.prototype.removeAllListeners=function(e$){var t$=this._events;if(t$===void 0)return this;if(t$.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):t$[e$]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete t$[e$]),this;if(arguments.length===0){var r$=Object.keys(t$);for(t$=0;t$<r$.length;++t$){var n$=r$[t$];n$!=="removeListener"&&this.removeAllListeners(n$)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(r$=t$[e$])=="function")this.removeListener(e$,r$);else if(r$!==void 0)for(t$=r$.length-1;0<=t$;t$--)this.removeListener(e$,r$[t$]);return this},ea.prototype.listeners=function(e$){return Bl(this,e$,!0)},ea.prototype.rawListeners=function(e$){return Bl(this,e$,!1)},ea.listenerCount=function(e$,t$){return typeof e$.listenerCount=="function"?e$.listenerCount(t$):Dl.call(e$,t$)},ea.prototype.listenerCount=Dl,ea.prototype.eventNames=function(){return 0<this._eventsCount?ux(this._events):[]},ea.once=function(e$,t$){return new Promise(function(r$,n$){function i$(s$){e$.removeListener(t$,o$),n$(s$)}function o$(){typeof e$.removeListener=="function"&&e$.removeListener("error",i$),r$([].slice.call(arguments))}El(e$,t$,o$,{once:!0}),t$!=="error"&&vs(e$,i$,{once:!0})})};var Qe=Object.assign,Kp=Object.defineProperty,Lp=!Qe||R(function(){if(ka&&Qe({b:1},Qe(Kp({},"a",{enumerable:!0,get:function(){Kp(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e$={},t$={},r$=Symbol();return e$[r$]=7,"abcdefghijklmnopqrst".split("").forEach(function(n$){t$[n$]=n$}),Qe({},e$)[r$]!=7||Dc(Qe({},t$)).join("")!="abcdefghijklmnopqrst"})?function(e$,t$){for(var r$=Qa(e$),n$=arguments.length,i$=1,o$=Bf.f,s$=zf;n$>i$;)for(var a$,c$=Af(arguments[i$++]),u$=o$?Dc(c$).concat(o$(c$)):Dc(c$),l$=u$.length,d$=0;l$>d$;)a$=u$[d$++],(!ka||s$.call(c$,a$))&&(r$[a$]=c$[a$]);return r$}:Qe;N({target:"Object",stat:!0,forced:Object.assign!==Lp},{assign:Lp}),zp("Map",function(e$){return function(){return e$(this,arguments.length?arguments[0]:void 0)}},Cp);var vx=Math.log,wx=Math.LN2;N({target:"Math",stat:!0},{log2:function(e$){return vx(e$)/wx}});var xx=Ra.f,yx=Hd.f,zx=Za.enforce,Ax=qa("match"),sc=y.RegExp,lk=sc.prototype,Wf=/a/g,mk=/a/g,nk=new sc(Wf)!==Wf;if(ka&&nc("RegExp",!nk||pc||R(function(){return mk[Ax]=!1,sc(Wf)!=Wf||sc(mk)==mk||sc(Wf,"i")!="/a/i"}))){for(var Oc=function(e$,t$){var r$,n$=this instanceof Oc,i$=Lj(e$),o$=t$===void 0;return!n$&&i$&&e$.constructor===Oc&&o$||(nk?i$&&!o$&&(e$=e$.source):e$ instanceof Oc&&(o$&&(t$=tj.call(e$)),e$=e$.source),pc&&(r$=!!t$&&-1<t$.indexOf("y"))&&(t$=t$.replace(/y/g,"")),e$=lh(nk?new sc(e$,t$):sc(e$,t$),n$?this:lk,Oc),pc&&r$&&(zx(e$).sticky=!0)),e$},Bx=function(e$){e$ in Oc||xx(Oc,e$,{configurable:!0,get:function(){return sc[e$]},set:function(t$){sc[e$]=t$}})},Mp=yx(sc),Np=0;Mp.length>Np;)Bx(Mp[Np++]);lk.constructor=Oc,Oc.prototype=lk,Ta(y,"RegExp",Oc)}If("RegExp"),Sf("Float32",function(e$){return function(t$,r$,n$){return e$(this,t$,r$,n$)}}),Sf("Float64",function(e$){return function(t$,r$,n$){return e$(this,t$,r$,n$)}}),Sf("Uint32",function(e$){return function(t$,r$,n$){return e$(this,t$,r$,n$)}}),Sf("Uint16",function(e$){return function(t$,r$,n$){return e$(this,t$,r$,n$)}});var ok=function(e$,t$){return e$===t$?0:e$==null?t$==null?0:-1:t$==null?e$==null?0:1:typeof e$.compare=="function"?e$.compare(t$):typeof t$.compare=="function"?-t$.compare(e$):e$<t$?-1:e$>t$?1:0},pk=[],Op=pk.sort,Cx=R(function(){pk.sort(void 0)}),Dx=R(function(){pk.sort(null)}),Ex=Ee("sort");N({target:"Array",proto:!0,forced:Cx||!Dx||!Ex},{sort:function(e$){return e$===void 0?Op.call(Qa(this)):Op.call(Qa(this),yb(e$))}});var Pp=Object.getPrototypeOf({}),Xf=function(e$,t$){var r$;return e$===t$||(e$==null?e$==t$:X(e$.equiv)==="function"?e$.equiv(t$):t$==null?e$==t$:X(t$.equiv)==="function"?t$.equiv(e$):X(e$)!=="string"&&X(t$)!=="string"&&((r$=Object.getPrototypeOf(e$))!=null&&r$!==Pp||(r$=Object.getPrototypeOf(t$))!=null&&r$!==Pp?X(e$)!=="function"&&e$.length!==void 0&&X(t$)!=="function"&&t$.length!==void 0?Gx(e$,t$):e$ instanceof Set&&t$ instanceof Set?Hx(e$,t$):e$ instanceof Map&&t$ instanceof Map?Ix(e$,t$):e$ instanceof Date&&t$ instanceof Date?e$.getTime()===t$.getTime():e$ instanceof RegExp&&t$ instanceof RegExp?e$.toString()===t$.toString():e$!=e$&&t$!=t$:Fx(e$,t$)))},Gx=function(e$,t$){var r$=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf,n$=e$.length;if(n$===t$.length)for(;0<=--n$&&r$(e$[n$],t$[n$]););return 0>n$},Hx=function(e$,t$){var r$=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return e$.size===t$.size&&r$(G(e$.keys()).sort(),G(t$.keys()).sort())},Ix=function(e$,t$){var r$=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return e$.size===t$.size&&r$(G(e$).sort(),G(t$).sort())},Fx=function(e$,t$){var r$=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;if(Object.keys(e$).length!==Object.keys(t$).length)return!1;for(var n$ in e$)if(!t$.hasOwnProperty(n$)||!r$(e$[n$],t$[n$]))return!1;return!0},Qp=function(e$){var t$=1<arguments.length&&arguments[1]!==void 0?arguments[1]:function(r$){return r$!==void 0?": "+r$:""};return function(r$){function n$(o$){return W(this,n$),i$.call(this,e$(o$)+t$(o$))}la(n$,r$);var i$=ma(n$);return n$}(ef(Error))},Jx=Qp(function(){return"illegal argument(s)"}),vh=function(e$){throw new Jx(e$)},qk=Qp(function(){return"index out of bounds"}),Rp=1/4294967295,Kx=function(){function e$(){W(this,e$)}return Ha(e$,[{key:"float",value:function(){var t$=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return this.int()*Rp*t$}},{key:"norm",value:function(){var t$=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(this.int()*Rp-.5)*t$}},{key:"minmax",value:function(t$,r$){return this.float()*(r$-t$)+t$}}]),e$}(),rk=Math.random,Lx=new(function(e$){function t$(){return W(this,t$),r$.apply(this,arguments)}la(t$,e$);var r$=ma(t$);return Ha(t$,[{key:"int",value:function(){return 4294967296*rk()>>>0}},{key:"float",value:function(){var n$=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return rk()*n$}},{key:"norm",value:function(){var n$=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(rk()-.5)*n$}}]),t$}(Kx)),Vh=Symbol(),Hl=function(){},Mx=fk.onFreeze,sk=Object.freeze,Nx=R(function(){sk(1)});N({target:"Object",stat:!0,forced:Nx,sham:!yp},{freeze:function(e$){return sk&&ha(e$)?sk(Mx(e$)):e$}});var Ox=Ee("reduce"),Px=!Hc&&79<id&&83>id;N({target:"Array",proto:!0,forced:!Ox||Px},{reduce:function(e$){return Wo(this,e$,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Gl=function(e$){return e$!=null&&typeof e$.xform=="function"?e$.xform():e$},og=function(){function e$(t$){W(this,e$),this.value=t$}return Ha(e$,[{key:"deref",value:function(){return this.value}}]),e$}(),Wh=function(e$){return e$ instanceof og?e$.deref():e$},xs=function(e$,t$){return[e$,function(r$){return r$},t$]},Qx=w.mark(function(e$,t$){var r$,n$,i$,o$,s$,a$;return w.wrap(function(c$){for(;;)switch(c$.prev=c$.next){case 0:r$=Gl(e$)(ws()),n$=r$[1],i$=r$[2],o$=0;case 4:if(!(o$<t$.length)){c$.next=15;break}if(s$=t$[o$],!((a$=i$([],s$))instanceof og)){c$.next=10;break}return c$.delegateYield(Wh(n$(a$.deref())),"t0",9);case 9:return c$.abrupt("return");case 10:if(!a$.length){c$.next=12;break}return c$.delegateYield(a$,"t1",12);case 12:o$++,c$.next=4;break;case 15:return c$.delegateYield(Wh(n$([])),"t2",16);case 16:case"end":return c$.stop()}},Qx)}),ys=w.mark(Fl),zs=function(e$,t$){return[e$[0],e$[1],t$]},Sp=!0;"findIndex"in[]&&Array(1).findIndex(function(){Sp=!1}),N({target:"Array",proto:!0,forced:Sp},{findIndex:function(e$){return An(this,e$,1<arguments.length?arguments[1]:void 0)}}),Ld("findIndex"),N({target:"Array",proto:!0},{fill:yj}),Ld("fill");var Rx=function(){function e$(t$){W(this,e$),this._length=0,t$&&this.into(t$)}return Ha(e$,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new e$(this)}},{key:"empty",value:function(){return new e$}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var t$,r$=this.head;r$;)t$=r$.next,delete r$.value,delete r$.prev,delete r$.next,r$=t$;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(t$){var r$=this._length;if(r$<t$._length)return-1;if(r$>t$._length)return 1;if(r$===0)return 0;r$=this.head,t$=t$.head;for(var n$=0;r$&&n$==0;)n$=ok(r$.value,t$.value),r$=r$.next,t$=t$.next;return n$}},{key:"equiv",value:function(t$){if(!(t$ instanceof e$||t$!=null&&typeof t$!="function"&&t$.length!==void 0)||this._length!==t$.length)return!1;if(!this._length||this===t$)return!0;for(var r$=this.head,n$=0;n$<t$.length;n$++){if(!Xf(r$.value,t$[n$]))return!1;r$=r$.next}return!0}},{key:Symbol.iterator,value:w.mark(function t$(){var r$;return w.wrap(function(n$){for(;;)switch(n$.prev=n$.next){case 0:r$=this.head;case 1:if(!r$){n$.next=7;break}return n$.next=4,r$.value;case 4:r$=r$.next,n$.next=1;break;case 7:case"end":return n$.stop()}},t$,this)})},{key:"seq",value:function(){var t$=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,r$=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;if(!(t$>=r$||0>t$)){t$=this.nthCell(t$);var n$=this.nthCell(r$-1);return r$=function i$(o$){return{first:function(){return o$.value},next:function(){return o$!==n$&&o$.next?i$(o$.next):void 0}}},t$?r$(t$):void 0}}},{key:"cycle",value:w.mark(function t$(){return w.wrap(function(r$){for(;;)switch(r$.prev=r$.next){case 0:return r$.delegateYield(this,"t0",2);case 2:r$.next=0;break;case 4:case"end":return r$.stop()}},t$,this)})},{key:"$reduce",value:function(t$,r$){for(var n$=this.head;n$&&!(r$ instanceof og);)r$=t$(r$,n$.value),n$=n$.next;return r$}},{key:"drop",value:function(){var t$=this.head;if(t$)return(this.head=t$.next)?delete this.head.prev:delete this.tail,this._length--,t$.value}},{key:"cons",value:function(t$){return t$={value:t$,next:this.head},this.head?this.head.prev=t$:this.tail=t$,this.head=t$,this._length++,this}},{key:"insertBefore",value:function(t$,r$){return t$||vh("cell is undefined"),r$={value:r$,next:t$,prev:t$.prev},t$.prev?t$.prev.next=r$:this.head=r$,t$.prev=r$,this._length++,this}},{key:"insertAfter",value:function(t$,r$){return t$||vh("cell is undefined"),r$={value:r$,next:t$.next,prev:t$},t$.next?t$.next.prev=r$:this.tail=r$,t$.next=r$,this._length++,this}},{key:"insertBeforeNth",value:function(t$,r$){if(0>t$&&(t$+=this._length),0>=t$)return this.cons(r$);if(0>t$||t$>=this._length)throw new qk(t$);return this.insertBefore(this.nthCellUnsafe(t$),r$)}},{key:"insertAfterNth",value:function(t$,r$){if(0>t$&&(t$+=this._length),t$>=this._length-1)return this.push(r$);if(0>t$||t$>=this._length)throw new qk(t$);return this.insertAfter(this.nthCellUnsafe(t$),r$)}},{key:"insertSorted",value:function(t$,r$){r$=r$||ok;for(var n$=this.head;n$;){if(0>=r$(t$,n$.value))return this.insertBefore(n$,t$);n$=n$.next}return this.push(t$)}},{key:"find",value:function(t$){for(var r$=this.head;r$;){if(r$.value===t$)return r$;r$=r$.next}}},{key:"findWith",value:function(t$){for(var r$=this.head;r$;){if(t$(r$.value))return r$;r$=r$.next}}},{key:"concat",value:function(){for(var t$=this.copy(),r$=arguments.length,n$=Array(r$),i$=0;i$<r$;i$++)n$[i$]=arguments[i$];for(r$=0;r$<n$.length;r$++)t$.into(n$[r$]);return t$}},{key:"into",value:function(t$){for(var r$=0;r$<t$.length;r$++)this.push(t$[r$])}},{key:"slice",value:function(){var t$=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,r$=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;t$=0>t$?t$+this._length:t$,r$=0>r$?r$+this._length:r$,(0>t$||0>r$)&&vh("invalid indices: ${from} / ${to}");for(var n$=new e$,i$=this.nthCell(t$);i$&&++t$<=r$;)n$.push(i$.value),i$=i$.next;return n$}},{key:"splice",value:function(t$){var r$=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,n$=2<arguments.length?arguments[2]:void 0;if(typeof t$=="number"){if(0>t$&&(t$+=this._length),0>t$||t$>=this._length)throw new qk(t$);var i$=this.nthCellUnsafe(t$)}else i$=t$;var o$=new e$;if(0<r$)for(;i$&&0<r$--;)this.remove(i$),o$.push(i$.value),i$=i$.next;else i$&&(i$=i$.next);if(n$)if(i$)for(r$=0;r$<n$.length;r$++)this.insertBefore(i$,n$[r$]);else for(i$=0;i$<n$.length;i$++)this.push(n$[i$]);return o$}},{key:"remove",value:function(t$){return t$.prev?t$.prev.next=t$.next:this.head=t$.next,t$.next?t$.next.prev=t$.prev:this.tail=t$.prev,this._length--,this}},{key:"swap",value:function(t$,r$){if(t$!==r$){var n$=t$.value;t$.value=r$.value,r$.value=n$}return this}},{key:"push",value:function(t$){return this.tail?(t$={value:t$,prev:this.tail},this.tail=this.tail.next=t$,this._length++,this):this.cons(t$)}},{key:"pop",value:function(){var t$=this.tail;if(t$)return(this.tail=t$.prev)?delete this.tail.next:delete this.head,this._length--,t$.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(t$){return this.head?(this.head.value=t$,this):this.cons(t$)}},{key:"setTail",value:function(t$){return this.tail?(this.tail.value=t$,this):this.push(t$)}},{key:"setNth",value:function(t$,r$){var n$=this.nthCell(t$);return!n$&&vh("index out of bounds: ".concat(t$)),n$.value=r$,this}},{key:"nth",value:function(t$,r$){return(t$=this.nthCell(t$))?t$.value:r$}},{key:"nthCell",value:function(t$){if(0>t$&&(t$+=this._length),!(0>t$||t$>=this._length))return this.nthCellUnsafe(t$)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var t$=this.peek();return this.pop(),this.cons(t$)}}},{key:"map",value:function(t$){for(var r$=new e$,n$=this.head;n$;)r$.push(t$(n$.value)),n$=n$.next;return r$}},{key:"filter",value:function(t$){for(var r$=new e$,n$=this.head;n$;)t$(n$.value)&&r$.push(n$.value),n$=n$.next;return r$}},{key:"reduce",value:function(t$,r$){for(var n$=this.head;n$;)r$=t$(r$,n$.value),n$=n$.next;return r$}},{key:"shuffle",value:function(t$){var r$=1<arguments.length&&arguments[1]!==void 0?arguments[1]:Lx;if(2>this._length)return this;for(t$=t$??Math.ceil(1.5*Math.log2(this._length));0<t$;t$--)for(var n$=this.head;n$;){var i$=n$.next;.5>r$.float()?this.asHead(n$):this.asTail(n$),n$=i$}return this}},{key:"sort",value:function(){var t$=0<arguments.length&&arguments[0]!==void 0?arguments[0]:ok;if(!this._length)return this;for(var r$=1;;){var n$=this.head;this.tail=this.head=void 0;for(var i$=0;n$;){i$++;for(var o$=n$,s$=0,a$=0;a$<r$&&(s$++,o$=o$.next);a$++);for(a$=r$;0<s$||0<a$&&o$;){if(s$===0){var c$=o$;o$=o$.next,a$--}else o$&&a$!==0?0>=t$(n$.value,o$.value)?(c$=n$,n$=n$.next,s$--):(c$=o$,o$=o$.next,a$--):(c$=n$,n$=n$.next,s$--);this.tail?this.tail.next=c$:this.head=c$,c$.prev=this.tail,this.tail=c$}n$=o$}if(this.tail.next=void 0,1>=i$)return this;r$*=2}}},{key:"reverse",value:function(){for(var t$=this.head,r$=this.tail,n$=(this._length>>>1)+(1&this._length);t$&&r$&&0<n$;){var i$=t$.value;t$.value=r$.value,r$.value=i$,t$=t$.next,r$=r$.prev,n$--}return this}},{key:"asHead",value:function(t$){return t$===this.head||(this.remove(t$),this.head.prev=t$,t$.next=this.head,t$.prev=void 0,this.head=t$,this._length++),this}},{key:"asTail",value:function(t$){return t$===this.tail||(this.remove(t$),this.tail.next=t$,t$.prev=this.tail,t$.next=void 0,this.tail=t$,this._length++),this}},{key:"toString",value:function(){for(var t$=[],r$=this.head;r$;)t$.push(String(r$.value)),r$=r$.next;return t$.join(", ")}},{key:"toJSON",value:function(){return G(this)}},{key:"nthCellUnsafe",value:function(t$){if(t$<=this._length>>1)var r$=this.head,n$="next";else r$=this.tail,n$="prev",t$=this._length-t$-1;for(;0<t$--&&r$;)r$=r$[n$];return r$}}]),e$}(),tc=function(){function e$(t$,r$){W(this,e$),r$=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},r$),this.map=r$.map(),this.items=new Rx,this._size=0,this.opts=r$,t$&&this.into(t$)}return Ha(e$,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return pg(function(t$){return[t$.k,t$]},this.items)}},{key:"keys",value:function(){return pg(function(t$){return t$.k},this.items)}},{key:"values",value:function(){return pg(function(t$){return t$.v},this.items)}},{key:"copy",value:function(){var t$=this.empty();t$.items=this.items.copy();for(var r$=t$.items.head;r$;)t$.map.set(r$.value.k,r$),r$=r$.next;return t$}},{key:"empty",value:function(){return new e$(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var t$=this.opts.release;if(t$){for(var r$;r$=this.items.drop();)t$(r$.k,r$.v);return!0}return this.items.release()}},{key:"has",value:function(t$){return this.map.has(t$)}},{key:"get",value:function(t$,r$){return(t$=this.map.get(t$))?this.resetEntry(t$):r$}},{key:"set",value:function(t$,r$){var n$=this.opts.ksize(t$)+this.opts.vsize(r$),i$=this.map.get(t$);return this._size+=Math.max(0,n$-(i$?i$.value.s:0)),this.ensureSize()&&this.doSetEntry(i$,t$,r$,n$),r$}},{key:"into",value:function(t$){for(var r$=0;r$<t$.length;r$++){var n$=t$[r$];this.set(n$[0],n$[1])}return this}},{key:"getSet",value:function(t$,r$){var n$=this,i$=this.map.get(t$);return i$?Promise.resolve(this.resetEntry(i$)):r$().then(function(o$){return n$.set(t$,o$)})}},{key:"delete",value:function(t$){return!!(t$=this.map.get(t$))&&(this.removeEntry(t$),!0)}},{key:"resetEntry",value:function(t$){return this.items.asTail(t$),t$.value.v}},{key:"ensureSize",value:function(){for(var t$=this.opts.release,r$=this.opts.maxsize,n$=this.opts.maxlen;this._size>r$||this.length>=n$;){var i$=this.items.drop();if(!i$)return!1;this.map.delete(i$.k),t$&&t$(i$.k,i$.v),this._size-=i$.s}return!0}},{key:"removeEntry",value:function(t$){var r$=t$.value;this.map.delete(r$.k),this.items.remove(t$),this.opts.release&&this.opts.release(r$.k,r$.v),this._size-=r$.s}},{key:"doSetEntry",value:function(t$,r$,n$,i$){t$?(t$.value.v=n$,t$.value.s=i$,this.items.asTail(t$)):(this.items.push({k:r$,v:n$,s:i$}),this.map.set(r$,this.items.tail))}}]),e$}(),Sx=function(e$){function t$(n$,i$){return W(this,t$),i$=Object.assign({ttl:36e5},i$),r$.call(this,n$,i$)}la(t$,e$);var r$=ma(t$);return Ha(t$,[{key:"empty",value:function(){return new t$(null,this.opts)}},{key:"has",value:function(n$){return this.get(n$)!==void 0}},{key:"get",value:function(n$,i$){if(n$=this.map.get(n$)){if(n$.value.t>=Date.now())return this.resetEntry(n$);this.removeEntry(n$)}return i$}},{key:"set",value:function(n$,i$){var o$=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,s$=this.opts.ksize(n$)+this.opts.vsize(i$),a$=this.map.get(n$);return this._size+=Math.max(0,s$-(a$?a$.value.s:0)),this.ensureSize()&&(o$=Date.now()+o$,a$?(a$.value.v=i$,a$.value.s=s$,a$.value.t=o$,this.items.asTail(a$)):(this.items.push({k:n$,v:i$,s:s$,t:o$}),this.map.set(n$,this.items.tail))),i$}},{key:"getSet",value:function(n$,i$){var o$=this,s$=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,a$=this.get(n$);return a$?Promise.resolve(a$):i$().then(function(c$){return o$.set(n$,c$,s$)})}},{key:"prune",value:function(){for(var n$=Date.now(),i$=this.items.head;i$;)i$.value.t<n$&&this.removeEntry(i$),i$=i$.next}},{key:"ensureSize",value:function(){for(var n$=this.opts.maxsize,i$=this.opts.maxlen,o$=Date.now(),s$=this.items.head;s$&&(this._size>n$||this.length>=i$);)s$.value.t<o$&&this.removeEntry(s$),s$=s$.next;return Th(wd(t$.prototype),"ensureSize",this).call(this)}}]),t$}(tc),Tp=X(Ya)=="object"&&Ya&&Ya.Object===Object&&Ya,Tx=(typeof self>"u"?"undefined":X(self))=="object"&&self&&self.Object===Object&&self,Cb=Tp||Tx||Function("return this")(),Pb=Cb.Symbol,Up=Object.prototype,Ux=Up.hasOwnProperty,Vx=Up.toString,Yf=Pb?Pb.toStringTag:void 0,Wx=Object.prototype.toString,Vp=Pb?Pb.toStringTag:void 0,Qd=function(e$){if(e$==null)e$=e$===void 0?"[object Undefined]":"[object Null]";else if(Vp&&Vp in Object(e$)){var t$=Ux.call(e$,Yf),r$=e$[Yf];try{e$[Yf]=void 0;var n$=!0}catch{}var i$=Vx.call(e$);n$&&(t$?e$[Yf]=r$:delete e$[Yf]),e$=i$}else e$=Wx.call(e$);return e$},lb=function(e$){var t$=X(e$);return e$!=null&&(t$=="object"||t$=="function")},qi=function(e$){return!!lb(e$)&&((e$=Qd(e$))=="[object Function]"||e$=="[object GeneratorFunction]"||e$=="[object AsyncFunction]"||e$=="[object Proxy]")},tk=Cb["__core-js_shared__"],Wp=function(){var e$=/[^.]+$/.exec(tk&&tk.keys&&tk.keys.IE_PROTO||"");return e$?"Symbol(src)_1."+e$:""}(),Xx=Function.prototype.toString,Rd=function(e$){if(e$!=null){try{return Xx.call(e$)}catch{}return e$+""}return""},Yx=/^\[object .+?Constructor\]$/,Zx=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Sd=function(e$,t$){return e$=e$==null?void 0:e$[t$],!lb(e$)||Wp&&Wp in e$||!(qi(e$)?Zx:Yx).test(Rd(e$))?void 0:e$},Zf=Sd(Object,"create"),$x=Object.prototype.hasOwnProperty,ay=Object.prototype.hasOwnProperty;zd.prototype.clear=function(){this.__data__=Zf?Zf(null):{},this.size=0},zd.prototype.delete=function(e$){return e$=this.has(e$)&&delete this.__data__[e$],this.size-=e$?1:0,e$},zd.prototype.get=function(e$){var t$=this.__data__;return Zf?(e$=t$[e$])==="__lodash_hash_undefined__"?void 0:e$:$x.call(t$,e$)?t$[e$]:void 0},zd.prototype.has=function(e$){var t$=this.__data__;return Zf?t$[e$]!==void 0:ay.call(t$,e$)},zd.prototype.set=function(e$,t$){var r$=this.__data__;return this.size+=this.has(e$)?0:1,r$[e$]=Zf&&t$===void 0?"__lodash_hash_undefined__":t$,this};var $f=function(e$,t$){return e$===t$||e$!=e$&&t$!=t$},wh=function(e$,t$){for(var r$=e$.length;r$--;)if($f(e$[r$][0],t$))return r$;return-1},by=Array.prototype.splice;ce.prototype.clear=function(){this.__data__=[],this.size=0},ce.prototype.delete=function(e$){var t$=this.__data__;return!(0>(e$=wh(t$,e$)))&&(e$==t$.length-1?t$.pop():by.call(t$,e$,1),--this.size,!0)},ce.prototype.get=function(e$){var t$=this.__data__;return 0>(e$=wh(t$,e$))?void 0:t$[e$][1]},ce.prototype.has=function(e$){return-1<wh(this.__data__,e$)},ce.prototype.set=function(e$,t$){var r$=this.__data__,n$=wh(r$,e$);return 0>n$?(++this.size,r$.push([e$,t$])):r$[n$][1]=t$,this};var rg=ce,ag=Sd(Cb,"Map"),xh=function(e$,t$){e$=e$.__data__;var r$=X(t$);return(r$=="string"||r$=="number"||r$=="symbol"||r$=="boolean"?t$!=="__proto__":t$===null)?e$[typeof t$=="string"?"string":"hash"]:e$.map};de.prototype.clear=function(){this.size=0,this.__data__={hash:new zd,map:new(ag||rg),string:new zd}},de.prototype.delete=function(e$){return e$=xh(this,e$).delete(e$),this.size-=e$?1:0,e$},de.prototype.get=function(e$){return xh(this,e$).get(e$)},de.prototype.has=function(e$){return xh(this,e$).has(e$)},de.prototype.set=function(e$,t$){var r$=xh(this,e$),n$=r$.size;return r$.set(e$,t$),this.size+=r$.size==n$?0:1,this};var qg=de;gf.prototype.add=gf.prototype.push=function(e$){return this.__data__.set(e$,"__lodash_hash_undefined__"),this},gf.prototype.has=function(e$){return this.__data__.has(e$)};var Xp=function(e$,t$,r$,n$){var i$=e$.length;for(r$+=-1;++r$<i$;)if(t$(e$[r$],r$,e$))return r$;return-1},cy=function(e$){return e$!=e$},dy=function(e$,t$){var r$;if(r$=!(e$==null||!e$.length)){if(t$==t$)e:{r$=-1;for(var n$=e$.length;++r$<n$;)if(e$[r$]===t$){e$=r$;break e}e$=-1}else e$=Xp(e$,cy,0);r$=-1<e$}return r$},ey=function(e$,t$,r$){for(var n$=-1,i$=e$==null?0:e$.length;++n$<i$;)if(r$(t$,e$[n$]))return!0;return!1},fy=function(e$,t$){return e$.has(t$)},Re=Sd(Cb,"Set"),gy=function(){},uk=function(e$){var t$=-1,r$=Array(e$.size);return e$.forEach(function(n$){r$[++t$]=n$}),r$},hy=1/0,iy=Re&&1/uk(new Re([,-0]))[1]==hy?function(e$){return new Re(e$)}:gy,vk=function(e$,t$,r$){var n$=-1,i$=dy,o$=e$.length,s$=!0,a$=[],c$=a$;if(r$)s$=!1,i$=ey;else if(200<=o$){if(i$=iy(e$))return uk(i$);s$=!1,i$=fy,c$=new gf}else c$=a$;e:for(;++n$<o$;){var u$=e$[n$],l$=u$;if(u$=r$||u$!==0?u$:0,s$&&l$==l$){for(var d$=c$.length;d$--;)if(c$[d$]===l$)continue e;a$.push(u$)}else i$(c$,l$,r$)||(c$!==a$&&c$.push(l$),a$.push(u$))}return a$},Yp=function(e$){for(var t$=-1,r$=e$==null?0:e$.length,n$={};++t$<r$;){var i$=e$[t$];n$[i$[0]]=i$[1]}return n$},he=function(e$,t$){for(var r$=-1,n$=e$==null?0:e$.length,i$=Array(n$);++r$<n$;)i$[r$]=t$(e$[r$],r$,e$);return i$};ee.prototype.clear=function(){this.__data__=new rg,this.size=0},ee.prototype.delete=function(e$){var t$=this.__data__;return e$=t$.delete(e$),this.size=t$.size,e$},ee.prototype.get=function(e$){return this.__data__.get(e$)},ee.prototype.has=function(e$){return this.__data__.has(e$)},ee.prototype.set=function(e$,t$){var r$=this.__data__;if(r$ instanceof rg){var n$=r$.__data__;if(!ag||199>n$.length)return n$.push([e$,t$]),this.size=++r$.size,this;r$=this.__data__=new qg(n$)}return r$.set(e$,t$),this.size=r$.size,this};var ge=ee,Is=function(e$,t$){for(var r$=-1,n$=e$==null?0:e$.length;++r$<n$&&t$(e$[r$],r$,e$)!==!1;);return e$},yh=function(){try{var e$=Sd(Object,"defineProperty");return e$({},"",{}),e$}catch{}}(),bg=function(e$,t$,r$){t$=="__proto__"&&yh?yh(e$,t$,{configurable:!0,enumerable:!0,value:r$,writable:!0}):e$[t$]=r$},jy=Object.prototype.hasOwnProperty,Ml=function(e$,t$,r$){var n$=e$[t$];jy.call(e$,t$)&&$f(n$,r$)&&(r$!==void 0||t$ in e$)||bg(e$,t$,r$)},re=function(e$,t$,r$,n$){var i$=!r$;r$||(r$={});for(var o$=-1,s$=t$.length;++o$<s$;){var a$=t$[o$],c$=void 0;c$===void 0&&(c$=e$[a$]),i$?bg(r$,a$,c$):Ml(r$,a$,c$)}return r$},gc=function(e$){return e$!=null&&X(e$)=="object"},Zp=function(e$){return gc(e$)&&Qd(e$)=="[object Arguments]"},$p=Object.prototype,ky=$p.hasOwnProperty,ly=$p.propertyIsEnumerable,rf=Zp(function(){return arguments}())?Zp:function(e$){return gc(e$)&&ky.call(e$,"callee")&&!ly.call(e$,"callee")},Va=Array.isArray,my=function(){return!1},jf=$a(function(e$,t$){var r$=(t$=t$&&!t$.nodeType&&t$)&&e$&&!e$.nodeType&&e$;t$=r$&&r$.exports===t$?Cb.Buffer:void 0,e$.exports=(t$?t$.isBuffer:void 0)||my}),ny=/^(?:0|[1-9]\d*)$/,wk=function(e$,t$){var r$=X(e$);return!!(t$=t$??9007199254740991)&&(r$=="number"||r$!="symbol"&&ny.test(e$))&&-1<e$&&e$%1==0&&e$<t$},xk=function(e$){return typeof e$=="number"&&-1<e$&&e$%1==0&&9007199254740991>=e$},Ea={};Ea["[object Float32Array]"]=Ea["[object Float64Array]"]=Ea["[object Int8Array]"]=Ea["[object Int16Array]"]=Ea["[object Int32Array]"]=Ea["[object Uint8Array]"]=Ea["[object Uint8ClampedArray]"]=Ea["[object Uint16Array]"]=Ea["[object Uint32Array]"]=!0,Ea["[object Arguments]"]=Ea["[object Array]"]=Ea["[object ArrayBuffer]"]=Ea["[object Boolean]"]=Ea["[object DataView]"]=Ea["[object Date]"]=Ea["[object Error]"]=Ea["[object Function]"]=Ea["[object Map]"]=Ea["[object Number]"]=Ea["[object Object]"]=Ea["[object RegExp]"]=Ea["[object Set]"]=Ea["[object String]"]=Ea["[object WeakMap]"]=!1;var oy=function(e$){return gc(e$)&&xk(e$.length)&&!!Ea[Qd(e$)]},zh=function(e$){return function(t$){return e$(t$)}},Se=$a(function(e$,t$){var r$=t$&&!t$.nodeType&&t$;r$=(t$=r$&&e$&&!e$.nodeType&&e$)&&t$.exports===r$&&Tp.process;e:{try{var n$=t$&&t$.require&&t$.require("util").types;if(n$){var i$=n$;break e}i$=r$&&r$.binding&&r$.binding("util");break e}catch{}i$=void 0}e$.exports=i$}),aq=Se&&Se.isTypedArray,bi=aq?zh(aq):oy,py=Object.prototype.hasOwnProperty,bq=function(e$,t$){var r$=Va(e$),n$=!r$&&rf(e$),i$=!r$&&!n$&&jf(e$),o$=!r$&&!n$&&!i$&&bi(e$);if(r$=r$||n$||i$||o$){n$=e$.length;for(var s$=String,a$=-1,c$=Array(n$);++a$<n$;)c$[a$]=s$(a$);n$=c$}else n$=[];for(var u$ in s$=n$.length,e$)!t$&&!py.call(e$,u$)||r$&&(u$=="length"||i$&&(u$=="offset"||u$=="parent")||o$&&(u$=="buffer"||u$=="byteLength"||u$=="byteOffset")||wk(u$,s$))||n$.push(u$);return n$},qy=Object.prototype,yk=function(e$){var t$=e$&&e$.constructor;return e$===(typeof t$=="function"&&t$.prototype||qy)},cq=function(e$,t$){return function(r$){return e$(t$(r$))}},ry=cq(Object.keys,Object),sy=Object.prototype.hasOwnProperty,Ed=function(e$){return e$!=null&&xk(e$.length)&&!qi(e$)},Ad=function(e$){if(Ed(e$))e$=bq(e$);else if(yk(e$)){var t$,r$=[];for(t$ in Object(e$))sy.call(e$,t$)&&t$!="constructor"&&r$.push(t$);e$=r$}else e$=ry(e$);return e$},Es=function(e$,t$){return e$&&re(t$,Ad(t$),e$)},ty=Object.prototype.hasOwnProperty,kf=function(e$){if(Ed(e$))e$=bq(e$,!0);else if(lb(e$)){var t$=yk(e$),r$=[];for(n$ in e$)(n$!="constructor"||!t$&&ty.call(e$,n$))&&r$.push(n$);e$=r$}else{var n$=[];if(e$!=null)for(t$ in Object(e$))n$.push(t$);e$=n$}return e$},Cs=function(e$,t$){return e$&&re(t$,kf(t$),e$)},Jl=$a(function(e$,t$){var r$=(t$=t$&&!t$.nodeType&&t$)&&e$&&!e$.nodeType&&e$,n$=(t$=r$&&r$.exports===t$?Cb.Buffer:void 0)?t$.allocUnsafe:void 0;e$.exports=function(i$,o$){return o$?i$.slice():(o$=i$.length,o$=n$?n$(o$):new i$.constructor(o$),i$.copy(o$),o$)}}),Xh=function(e$,t$){var r$=-1,n$=e$.length;for(t$||(t$=Array(n$));++r$<n$;)t$[r$]=e$[r$];return t$},uy=function(e$,t$){for(var r$=-1,n$=e$==null?0:e$.length,i$=0,o$=[];++r$<n$;){var s$=e$[r$];t$(s$,r$,e$)&&(o$[i$++]=s$)}return o$},dq=function(){return[]},vy=Object.prototype.propertyIsEnumerable,eq=Object.getOwnPropertySymbols,zk=eq?function(e$){return e$==null?[]:(e$=Object(e$),uy(eq(e$),function(t$){return vy.call(e$,t$)}))}:dq,Ds=function(e$,t$){return re(e$,zk(e$),t$)},ai=function(e$,t$){for(var r$=-1,n$=t$.length,i$=e$.length;++r$<n$;)e$[i$+r$]=t$[r$];return e$},Ak=cq(Object.getPrototypeOf,Object),fq=Object.getOwnPropertySymbols?function(e$){for(var t$=[];e$;)ai(t$,zk(e$)),e$=Ak(e$);return t$}:dq,Bs=function(e$,t$){return re(e$,fq(e$),t$)},gq=function(e$,t$,r$){return t$=t$(e$),Va(e$)?t$:ai(t$,r$(e$))},Yh=function(e$){return gq(e$,Ad,zk)},Ll=function(e$){return gq(e$,kf,fq)},Bk=Sd(Cb,"DataView"),Ck=Sd(Cb,"Promise"),Dk=Sd(Cb,"WeakMap"),wy=Rd(Bk),xy=Rd(ag),yy=Rd(Ck),zy=Rd(Re),Ay=Rd(Dk),Td=Qd;(Bk&&Td(new Bk(new ArrayBuffer(1)))!="[object DataView]"||ag&&Td(new ag)!="[object Map]"||Ck&&Td(Ck.resolve())!="[object Promise]"||Re&&Td(new Re)!="[object Set]"||Dk&&Td(new Dk)!="[object WeakMap]")&&(Td=function(e$){var t$=Qd(e$);if(e$=(e$=t$=="[object Object]"?e$.constructor:void 0)?Rd(e$):"")switch(e$){case wy:return"[object DataView]";case xy:return"[object Map]";case yy:return"[object Promise]";case zy:return"[object Set]";case Ay:return"[object WeakMap]"}return t$});var hf=Td,By=Object.prototype.hasOwnProperty,As=function(e$){var t$=e$.length,r$=new e$.constructor(t$);return t$&&typeof e$[0]=="string"&&By.call(e$,"index")&&(r$.index=e$.index,r$.input=e$.input),r$},Ah=Cb.Uint8Array,Ek=function(e$){var t$=new e$.constructor(e$.byteLength);return new Ah(t$).set(new Ah(e$)),t$},Cy=/\w*$/,hq=Pb?Pb.prototype:void 0,iq=hq?hq.valueOf:void 0,vm=function(e$,t$){return t$=t$?Ek(e$.buffer):e$.buffer,new e$.constructor(t$,e$.byteOffset,e$.length)},Fs=function(e$,t$,r$){var n$=e$.constructor;switch(t$){case"[object ArrayBuffer]":return Ek(e$);case"[object Boolean]":case"[object Date]":return new n$(+e$);case"[object DataView]":return t$=r$?Ek(e$.buffer):e$.buffer,new e$.constructor(t$,e$.byteOffset,e$.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return vm(e$,r$);case"[object Map]":return new n$;case"[object Number]":case"[object String]":return new n$(e$);case"[object RegExp]":return(t$=new e$.constructor(e$.source,Cy.exec(e$))).lastIndex=e$.lastIndex,t$;case"[object Set]":return new n$;case"[object Symbol]":return iq?Object(iq.call(e$)):{}}},jq=Object.create,Dy=function(){function e$(){}return function(t$){return lb(t$)?jq?jq(t$):(e$.prototype=t$,t$=new e$,e$.prototype=void 0,t$):{}}}(),Kl=function(e$){return typeof e$.constructor!="function"||yk(e$)?{}:Dy(Ak(e$))},Ey=function(e$){return gc(e$)&&hf(e$)=="[object Map]"},kq=Se&&Se.isMap,Hs=kq?zh(kq):Ey,Fy=function(e$){return gc(e$)&&hf(e$)=="[object Set]"},lq=Se&&Se.isSet,Gs=lq?zh(lq):Fy,wa={};wa["[object Arguments]"]=wa["[object Array]"]=wa["[object ArrayBuffer]"]=wa["[object DataView]"]=wa["[object Boolean]"]=wa["[object Date]"]=wa["[object Float32Array]"]=wa["[object Float64Array]"]=wa["[object Int8Array]"]=wa["[object Int16Array]"]=wa["[object Int32Array]"]=wa["[object Map]"]=wa["[object Number]"]=wa["[object Object]"]=wa["[object RegExp]"]=wa["[object Set]"]=wa["[object String]"]=wa["[object Symbol]"]=wa["[object Uint8Array]"]=wa["[object Uint8ClampedArray]"]=wa["[object Uint16Array]"]=wa["[object Uint32Array]"]=!0,wa["[object Error]"]=wa["[object Function]"]=wa["[object WeakMap]"]=!1;var ie=function(e$){return X(e$)=="symbol"||gc(e$)&&Qd(e$)=="[object Symbol]"},Gy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hy=/^\w*$/,Fk=function(e$,t$){if(Va(e$))return!1;var r$=X(e$);return!(r$!="number"&&r$!="symbol"&&r$!="boolean"&&e$!=null&&!ie(e$))||Hy.test(e$)||!Gy.test(e$)||t$!=null&&e$ in Object(t$)};Zh.Cache=qg;var Iy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jy=/\\(\\)?/g,Ky=function(e$){var t$=(e$=Zh(e$,function(r$){return t$.size===500&&t$.clear(),r$})).cache;return e$}(function(e$){var t$=[];return e$.charCodeAt(0)===46&&t$.push(""),e$.replace(Iy,function(r$,n$,i$,o$){t$.push(i$?o$.replace(Jy,"$1"):n$||r$)}),t$}),Js=1/0,mq=Pb?Pb.prototype:void 0,Ol=mq?mq.toString:void 0,Bh=function(e$,t$){return Va(e$)?e$:Fk(e$,t$)?[e$]:Ky(e$==null?"":Nl(e$))},Ly=1/0,cg=function(e$){if(typeof e$=="string"||ie(e$))return e$;var t$=e$+"";return t$=="0"&&1/e$==-Ly?"-0":t$},Ch=function(e$,t$){for(var r$=0,n$=(t$=Bh(t$,e$)).length;e$!=null&&r$<n$;)e$=e$[cg(t$[r$++])];return r$&&r$==n$?e$:void 0},My=function(e$,t$){if(!(2>(t$=Bh(t$,e$)).length)){var r$=t$,n$=0,i$=-1,o$=-1,s$=r$.length;for(0>n$&&(n$=-n$>s$?0:s$+n$),0>(i$=i$>s$?s$:i$)&&(i$+=s$),s$=n$>i$?0:i$-n$>>>0,n$>>>=0,i$=Array(s$);++o$<s$;)i$[o$]=r$[o$+n$];e$=Ch(e$,i$)}return(r$=e$==null)||(r$=t$==null?0:t$.length,r$=delete e$[cg(r$?t$[r$-1]:void 0)]),r$},nq=Function.prototype.toString,Ny=Object.prototype.hasOwnProperty,Oy=nq.call(Object),wm=function(e$){return!(!gc(e$)||Qd(e$)!="[object Object]")&&((e$=Ak(e$))===null||typeof(e$=Ny.call(e$,"constructor")&&e$.constructor)=="function"&&e$ instanceof e$&&nq.call(e$)==Oy)},Py=function(e$){return wm(e$)?void 0:e$},oq=Pb?Pb.isConcatSpreadable:void 0,Ks=function(e$){return Va(e$)||rf(e$)||!!(oq&&e$&&e$[oq])},Qy=function(e$){return e$!=null&&e$.length?$h(e$):[]},Ry=function(e$,t$,r$){switch(r$.length){case 0:return e$.call(t$);case 1:return e$.call(t$,r$[0]);case 2:return e$.call(t$,r$[0],r$[1]);case 3:return e$.call(t$,r$[0],r$[1],r$[2])}return e$.apply(t$,r$)},pq=Math.max,qq=function(e$,t$,r$){return t$=pq(t$===void 0?e$.length-1:t$,0),function(){for(var n$=arguments,i$=-1,o$=pq(n$.length-t$,0),s$=Array(o$);++i$<o$;)s$[i$]=n$[t$+i$];for(i$=-1,o$=Array(t$+1);++i$<t$;)o$[i$]=n$[i$];return o$[t$]=r$(s$),Ry(e$,this,o$)}},Sy=function(e$){return function(){return e$}},Dh=function(e$){return e$},Ty=Date.now,rq=function(e$){var t$=0,r$=0;return function(){var n$=Ty(),i$=16-(n$-r$);if(r$=n$,0<i$){if(800<=++t$)return arguments[0]}else t$=0;return e$.apply(void 0,arguments)}}(yh?function(e$,t$){return yh(e$,"toString",{configurable:!0,enumerable:!1,value:Sy(t$),writable:!0})}:Dh),Gk=function(e$){return rq(qq(e$,void 0,Qy),e$+"")}(function(e$,t$){var r$={};if(e$==null)return r$;var n$=!1;t$=he(t$,function(o$){return o$=Bh(o$,e$),n$||(n$=1<o$.length),o$}),re(e$,Ll(e$),r$),n$&&(r$=fe(r$,7,Py));for(var i$=t$.length;i$--;)My(r$,t$[i$]);return r$}),Uy=function(e$,t$,r$,n$){for(var i$=-1,o$=e$==null?0:e$.length;++i$<o$;){var s$=e$[i$];t$(n$,s$,r$(s$),e$)}return n$},um=function(e$,t$,r$){for(var n$=-1,i$=Object(e$),o$=(r$=r$(e$)).length;o$--;){var s$=r$[++n$];if(t$(i$[s$],s$,i$)===!1)break}return e$},sq=function(e$,t$){return e$&&um(e$,t$,Ad)},Hk=function(e$,t$){return function(r$,n$){if(r$==null)return r$;if(!Ed(r$))return e$(r$,n$);for(var i$=r$.length,o$=-1,s$=Object(r$);++o$<i$&&n$(s$[o$],o$,s$)!==!1;);return r$}}(sq),Vy=function(e$,t$,r$,n$){return Hk(e$,function(i$,o$,s$){t$(n$,i$,r$(i$),s$)}),n$},tq=function(e$,t$){for(var r$=-1,n$=e$==null?0:e$.length;++r$<n$;)if(t$(e$[r$],r$,e$))return!0;return!1},Pl=function(e$,t$,r$,n$,i$,o$){var s$=1&r$,a$=e$.length,c$=t$.length;if(a$!=c$&&!(s$&&c$>a$))return!1;c$=o$.get(e$);var u$=o$.get(t$);if(c$&&u$)return c$==t$&&u$==e$;c$=-1,u$=!0;var l$=2&r$?new gf:void 0;for(o$.set(e$,t$),o$.set(t$,e$);++c$<a$;){var d$=e$[c$],h$=t$[c$];if(n$)var p$=s$?n$(h$,d$,c$,t$,e$,o$):n$(d$,h$,c$,e$,t$,o$);if(p$!==void 0){if(p$)continue;u$=!1;break}if(l$){if(!tq(t$,function(_$,f$){if(!l$.has(f$)&&(d$===_$||i$(d$,_$,r$,n$,o$)))return l$.push(f$)})){u$=!1;break}}else if(d$!==h$&&!i$(d$,h$,r$,n$,o$)){u$=!1;break}}return o$.delete(e$),o$.delete(t$),u$},Wy=function(e$){var t$=-1,r$=Array(e$.size);return e$.forEach(function(n$,i$){r$[++t$]=[i$,n$]}),r$},uq=Pb?Pb.prototype:void 0,Ik=uq?uq.valueOf:void 0,Ls=function(e$,t$,r$,n$,i$,o$,s$){switch(r$){case"[object DataView]":if(e$.byteLength!=t$.byteLength||e$.byteOffset!=t$.byteOffset)break;e$=e$.buffer,t$=t$.buffer;case"[object ArrayBuffer]":if(e$.byteLength!=t$.byteLength||!o$(new Ah(e$),new Ah(t$)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return $f(+e$,+t$);case"[object Error]":return e$.name==t$.name&&e$.message==t$.message;case"[object RegExp]":case"[object String]":return e$==t$+"";case"[object Map]":var a$=Wy;case"[object Set]":if(a$||(a$=uk),e$.size!=t$.size&&!(1&n$))break;return(r$=s$.get(e$))?r$==t$:(n$|=2,s$.set(e$,t$),t$=Pl(a$(e$),a$(t$),n$,i$,o$,s$),s$.delete(e$),t$);case"[object Symbol]":if(Ik)return Ik.call(e$)==Ik.call(t$)}return!1},Ms=Object.prototype.hasOwnProperty,Ql=Object.prototype.hasOwnProperty,Xy=function(e$,t$,r$,n$){var i$=r$.length,o$=i$;if(e$==null)return!o$;for(e$=Object(e$);i$--;){var s$=r$[i$];if(s$[2]?s$[1]!==e$[s$[0]]:!(s$[0]in e$))return!1}for(;++i$<o$;){var a$=(s$=r$[i$])[0],c$=e$[a$],u$=s$[1];if(s$[2]){if(c$===void 0&&!(a$ in e$))return!1}else{var l$;if(s$=new ge,l$===void 0?!je(u$,c$,3,n$,s$):!l$)return!1}}return!0},Yy=function(e$){for(var t$=Ad(e$),r$=t$.length;r$--;){var n$=t$[r$],i$=e$[n$];t$[r$]=[n$,i$,i$==i$&&!lb(i$)]}return t$},vq=function(e$,t$){return function(r$){return r$!=null&&r$[e$]===t$&&(t$!==void 0||e$ in Object(r$))}},Zy=function(e$){var t$=Yy(e$);return t$.length==1&&t$[0][2]?vq(t$[0][0],t$[0][1]):function(r$){return r$===e$||Xy(r$,e$,t$)}},$y=function(e$,t$){return Fk(e$)&&t$==t$&&!lb(t$)?vq(cg(e$),t$):function(r$){var n$=r$==null?void 0:Ch(r$,e$);if((n$=n$===void 0?void 0:n$)===void 0&&n$===t$){if(n$=r$!=null){for(var i$=-1,o$=(n$=Bh(n$=e$,r$)).length,s$=!1;++i$<o$;){var a$=cg(n$[i$]);if(!(s$=r$!=null&&r$!=null&&a$ in Object(r$)))break;r$=r$[a$]}s$||++i$!=o$?n$=s$:n$=!!(o$=r$==null?0:r$.length)&&xk(o$)&&wk(a$,o$)&&(Va(r$)||rf(r$))}a$=n$}else a$=je(t$,n$,3);return a$}},az=function(e$){return function(t$){return t$==null?void 0:t$[e$]}},bz=function(e$){return function(t$){return Ch(t$,e$)}},Te=function(e$){return typeof e$=="function"?e$:e$==null?Dh:X(e$)=="object"?Va(e$)?$y(e$[0],e$[1]):Zy(e$):Fk(e$)?az(cg(e$)):bz(e$)},Jk=function(e$,t$){return function(r$,n$){var i$={};return(Va(r$)?Uy:Vy)(r$,e$,Te(n$),i$)}}(function(e$,t$,r$){bg(e$,r$,t$)}),uc=function(e$,t$){var r$={};return t$=Te(t$),sq(e$,function(n$,i$,o$){bg(r$,i$,t$(n$,i$,o$))}),r$};N({target:"String",proto:!0,forced:R(function(){var e$="".sub('"');return e$!==e$.toLowerCase()||3<e$.split('"').length})},{sub:function(){return"<sub>"+String(jb(this))+"</sub>"}});var U=xa,Qb=null;try{Qb=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e$){}xa.prototype.__isLong__,Object.defineProperty(xa.prototype,"__isLong__",{value:!0}),xa.isLong=mb;var Sl={},Rl={};xa.fromInt=Bd,xa.fromNumber=Gb,xa.fromBits=ya;var sg=Math.pow;xa.fromString=ci,xa.fromValue=Wb;var ke=4294967296,Tl=ke*ke,Vl=Tl/2,wq=Bd(16777216),Hb=Bd(0);xa.ZERO=Hb;var Cd=Bd(0,!0);xa.UZERO=Cd;var Ue=Bd(1);xa.ONE=Ue;var xq=Bd(1,!0);xa.UONE=xq;var Kk=Bd(-1);xa.NEG_ONE=Kk;var Wl=ya(-1,2147483647,!1);xa.MAX_VALUE=Wl;var Ul=ya(-1,-1,!0);xa.MAX_UNSIGNED_VALUE=Ul;var nb=ya(0,-2147483648,!1);xa.MIN_VALUE=nb;var D=xa.prototype;D.toInt=function(){return this.unsigned?this.low>>>0:this.low},D.toNumber=function(){return this.unsigned?(this.high>>>0)*ke+(this.low>>>0):this.high*ke+(this.low>>>0)},D.toString=function(e$){if(2>(e$=e$||10)||36<e$)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(nb)){var t$=Gb(e$),r$=this.div(t$);return t$=r$.mul(t$).sub(this),r$.toString(e$)+t$.toInt().toString(e$)}return"-"+this.neg().toString(e$)}r$=Gb(sg(e$,6),this.unsigned),t$=this;for(var n$="";;){var i$=t$.div(r$),o$=(t$.sub(i$.mul(r$)).toInt()>>>0).toString(e$);if((t$=i$).isZero())return o$+n$;for(;6>o$.length;)o$="0"+o$;n$=""+o$+n$}},D.getHighBits=function(){return this.high},D.getHighBitsUnsigned=function(){return this.high>>>0},D.getLowBits=function(){return this.low},D.getLowBitsUnsigned=function(){return this.low>>>0},D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(nb)?64:this.neg().getNumBitsAbs();for(var e$=this.high!=0?this.high:this.low,t$=31;0<t$&&!(e$&1<<t$);t$--);return this.high!=0?t$+33:t$+1},D.isZero=function(){return this.high===0&&this.low===0},D.eqz=D.isZero,D.isNegative=function(){return!this.unsigned&&0>this.high},D.isPositive=function(){return this.unsigned||0<=this.high},D.isOdd=function(){return(1&this.low)==1},D.isEven=function(){return(1&this.low)==0},D.equals=function(e$){return mb(e$)||(e$=Wb(e$)),(this.unsigned===e$.unsigned||this.high>>>31!=1||e$.high>>>31!=1)&&this.high===e$.high&&this.low===e$.low},D.eq=D.equals,D.notEquals=function(e$){return!this.eq(e$)},D.neq=D.notEquals,D.ne=D.notEquals,D.lessThan=function(e$){return 0>this.comp(e$)},D.lt=D.lessThan,D.lessThanOrEqual=function(e$){return 0>=this.comp(e$)},D.lte=D.lessThanOrEqual,D.le=D.lessThanOrEqual,D.greaterThan=function(e$){return 0<this.comp(e$)},D.gt=D.greaterThan,D.greaterThanOrEqual=function(e$){return 0<=this.comp(e$)},D.gte=D.greaterThanOrEqual,D.ge=D.greaterThanOrEqual,D.compare=function(e$){if(mb(e$)||(e$=Wb(e$)),this.eq(e$))return 0;var t$=this.isNegative(),r$=e$.isNegative();return t$&&!r$?-1:!t$&&r$?1:this.unsigned?e$.high>>>0>this.high>>>0||e$.high===this.high&&e$.low>>>0>this.low>>>0?-1:1:this.sub(e$).isNegative()?-1:1},D.comp=D.compare,D.negate=function(){return!this.unsigned&&this.eq(nb)?nb:this.not().add(Ue)},D.neg=D.negate,D.add=function(e$){mb(e$)||(e$=Wb(e$));var t$=this.high>>>16,r$=65535&this.high,n$=this.low>>>16,i$=e$.high>>>16,o$=65535&e$.high,s$=e$.low>>>16;return n$=(s$=((e$=(65535&this.low)+(65535&e$.low))>>>16)+(n$+s$))>>>16,ya((65535&s$)<<16|65535&e$,(t$=((n$+=r$+o$)>>>16)+(t$+i$)&65535)<<16|65535&n$,this.unsigned)},D.subtract=function(e$){return mb(e$)||(e$=Wb(e$)),this.add(e$.neg())},D.sub=D.subtract,D.multiply=function(e$){if(this.isZero())return Hb;if(mb(e$)||(e$=Wb(e$)),Qb){var t$=Qb.mul(this.low,this.high,e$.low,e$.high);return ya(t$,Qb.get_high(),this.unsigned)}if(e$.isZero())return Hb;if(this.eq(nb))return e$.isOdd()?nb:Hb;if(e$.eq(nb))return this.isOdd()?nb:Hb;if(this.isNegative())return e$.isNegative()?this.neg().mul(e$.neg()):this.neg().mul(e$).neg();if(e$.isNegative())return this.mul(e$.neg()).neg();if(this.lt(wq)&&e$.lt(wq))return Gb(this.toNumber()*e$.toNumber(),this.unsigned);t$=this.high>>>16;var r$=65535&this.high,n$=this.low>>>16,i$=65535&this.low,o$=e$.high>>>16,s$=65535&e$.high,a$=e$.low>>>16,c$=i$*(e$=65535&e$.low),u$=(c$>>>16)+n$*e$,l$=u$>>>16;l$+=(u$=(65535&u$)+i$*a$)>>>16;var d$=(l$+=r$*e$)>>>16;return ya((65535&u$)<<16|65535&c$,(d$=(d$+=(l$=(65535&l$)+n$*a$)>>>16)+((l$=(65535&l$)+i$*s$)>>>16)+(t$*e$+r$*a$+n$*s$+i$*o$)&65535)<<16|65535&l$,this.unsigned)},D.mul=D.multiply,D.divide=function(e$){if(mb(e$)||(e$=Wb(e$)),e$.isZero())throw Error("division by zero");if(Qb)return this.unsigned||this.high!==-2147483648||e$.low!==-1||e$.high!==-1?ya(e$=(this.unsigned?Qb.div_u:Qb.div_s)(this.low,this.high,e$.low,e$.high),Qb.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Cd:Hb;if(this.unsigned){if(e$.unsigned||(e$=e$.toUnsigned()),e$.gt(this))return Cd;if(e$.gt(this.shru(1)))return xq;var t$=Cd}else{if(this.eq(nb)){if(e$.eq(Ue)||e$.eq(Kk))return nb;if(e$.eq(nb))return Ue;var r$=this.shr(1).div(e$).shl(1);if(r$.eq(Hb))return e$.isNegative()?Ue:Kk;var n$=this.sub(e$.mul(r$));return r$.add(n$.div(e$))}if(e$.eq(nb))return this.unsigned?Cd:Hb;if(this.isNegative())return e$.isNegative()?this.neg().div(e$.neg()):this.neg().div(e$).neg();if(e$.isNegative())return this.div(e$.neg()).neg();t$=Hb}for(n$=this;n$.gte(e$);){r$=Math.max(1,Math.floor(n$.toNumber()/e$.toNumber()));var i$=Math.ceil(Math.log(r$)/Math.LN2);i$=48>=i$?1:sg(2,i$-48);for(var o$=Gb(r$),s$=o$.mul(e$);s$.isNegative()||s$.gt(n$);)s$=(o$=Gb(r$-=i$,this.unsigned)).mul(e$);o$.isZero()&&(o$=Ue),t$=t$.add(o$),n$=n$.sub(s$)}return t$},D.div=D.divide,D.modulo=function(e$){return mb(e$)||(e$=Wb(e$)),Qb?ya(e$=(this.unsigned?Qb.rem_u:Qb.rem_s)(this.low,this.high,e$.low,e$.high),Qb.get_high(),this.unsigned):this.sub(this.div(e$).mul(e$))},D.mod=D.modulo,D.rem=D.modulo,D.not=function(){return ya(~this.low,~this.high,this.unsigned)},D.and=function(e$){return mb(e$)||(e$=Wb(e$)),ya(this.low&e$.low,this.high&e$.high,this.unsigned)},D.or=function(e$){return mb(e$)||(e$=Wb(e$)),ya(this.low|e$.low,this.high|e$.high,this.unsigned)},D.xor=function(e$){return mb(e$)||(e$=Wb(e$)),ya(this.low^e$.low,this.high^e$.high,this.unsigned)},D.shiftLeft=function(e$){return mb(e$)&&(e$=e$.toInt()),(e$&=63)==0?this:32>e$?ya(this.low<<e$,this.high<<e$|this.low>>>32-e$,this.unsigned):ya(0,this.low<<e$-32,this.unsigned)},D.shl=D.shiftLeft,D.shiftRight=function(e$){return mb(e$)&&(e$=e$.toInt()),(e$&=63)==0?this:32>e$?ya(this.low>>>e$|this.high<<32-e$,this.high>>e$,this.unsigned):ya(this.high>>e$-32,0<=this.high?0:-1,this.unsigned)},D.shr=D.shiftRight,D.shiftRightUnsigned=function(e$){if(mb(e$)&&(e$=e$.toInt()),(e$&=63)===0)return this;var t$=this.high;return 32>e$?ya(this.low>>>e$|t$<<32-e$,t$>>>e$,this.unsigned):ya(e$===32?t$:t$>>>e$-32,0,this.unsigned)},D.shru=D.shiftRightUnsigned,D.shr_u=D.shiftRightUnsigned,D.toSigned=function(){return this.unsigned?ya(this.low,this.high,!1):this},D.toUnsigned=function(){return this.unsigned?this:ya(this.low,this.high,!0)},D.toBytes=function(e$){return e$?this.toBytesLE():this.toBytesBE()},D.toBytesLE=function(){var e$=this.high,t$=this.low;return[255&t$,t$>>>8&255,t$>>>16&255,t$>>>24,255&e$,e$>>>8&255,e$>>>16&255,e$>>>24]},D.toBytesBE=function(){var e$=this.high,t$=this.low;return[e$>>>24,e$>>>16&255,e$>>>8&255,255&e$,t$>>>24,t$>>>16&255,t$>>>8&255,255&t$]},xa.fromBytes=function(e$,t$,r$){return r$?xa.fromBytesLE(e$,t$):xa.fromBytesBE(e$,t$)},xa.fromBytesLE=function(e$,t$){return new xa(e$[0]|e$[1]<<8|e$[2]<<16|e$[3]<<24,e$[4]|e$[5]<<8|e$[6]<<16|e$[7]<<24,t$)},xa.fromBytesBE=function(e$,t$){return new xa(e$[4]<<24|e$[5]<<16|e$[6]<<8|e$[7],e$[0]<<24|e$[1]<<16|e$[2]<<8|e$[3],t$)};var di=function(e$,t$){return(di=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r$,n$){r$.__proto__=n$}||function(r$,n$){for(var i$ in n$)n$.hasOwnProperty(i$)&&(r$[i$]=n$[i$])})(e$,t$)},Lk=!1,Ib={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e$){e$?console.warn(`DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: 
`+Error().stack):Lk&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),Lk=e$},get useDeprecatedSynchronousErrorHandling(){return Lk}},Eh={closed:!0,next:function(e$){},error:function(e$){if(Ib.useDeprecatedSynchronousErrorHandling)throw e$;me(e$)},complete:function(){}},Jb=Array.isArray||function(e$){return e$&&typeof e$.length=="number"},lf=function(){function e$(t$){return Error.call(this),this.message=t$?t$.length+` errors occurred during unsubscription:
`+t$.map(function(r$,n$){return n$+1+") "+r$.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t$,this}return e$.prototype=Object.create(Error.prototype),e$}(),Oa=function(){function e$(t$){this.closed=!1,this._subscriptions=this._parentOrParents=null,t$&&(this._ctorUnsubscribe=!0,this._unsubscribe=t$)}return e$.prototype.unsubscribe=function(){if(!this.closed){var t$=this._parentOrParents,r$=this._ctorUnsubscribe,n$=this._unsubscribe,i$=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,t$ instanceof e$)t$.remove(this);else if(t$!==null)for(var o$=0;o$<t$.length;++o$)t$[o$].remove(this);if(le(n$)){r$&&(this._unsubscribe=void 0);try{n$.call(this)}catch(a$){var s$=a$ instanceof lf?Xl(a$.errors):[a$]}}if(Jb(i$)){for(o$=-1,t$=i$.length;++o$<t$;)if(ei(r$=i$[o$]))try{r$.unsubscribe()}catch(a$){s$=s$||[],a$ instanceof lf?s$=s$.concat(Xl(a$.errors)):s$.push(a$)}}if(s$)throw new lf(s$)}},e$.prototype.add=function(t$){var r$=t$;if(!t$)return e$.EMPTY;switch(X(t$)){case"function":r$=new e$(t$);case"object":if(r$===this||r$.closed||typeof r$.unsubscribe!="function")return r$;if(this.closed)return r$.unsubscribe(),r$;r$ instanceof e$||(t$=r$,(r$=new e$)._subscriptions=[t$]);break;default:throw Error("unrecognized teardown "+t$+" added to Subscription.")}if((t$=r$._parentOrParents)===null)r$._parentOrParents=this;else if(t$ instanceof e$){if(t$===this)return r$;r$._parentOrParents=[t$,this]}else{if(t$.indexOf(this)!==-1)return r$;t$.push(this)}return(t$=this._subscriptions)===null?this._subscriptions=[r$]:t$.push(r$),r$},e$.prototype.remove=function(t$){var r$=this._subscriptions;r$&&(t$=r$.indexOf(t$))!==-1&&r$.splice(t$,1)},e$.EMPTY=function(t$){return t$.closed=!0,t$}(new e$),e$}(),Fh=typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),ia=function(e$){function t$(r$,n$,i$){var o$=e$.call(this)||this;switch(o$.syncErrorValue=null,o$.syncErrorThrown=!1,o$.syncErrorThrowable=!1,o$.isStopped=!1,arguments.length){case 0:o$.destination=Eh;break;case 1:if(!r$){o$.destination=Eh;break}if(X(r$)==="object"){r$ instanceof t$?(o$.syncErrorThrowable=r$.syncErrorThrowable,o$.destination=r$,r$.add(o$)):(o$.syncErrorThrowable=!0,o$.destination=new yq(o$,r$));break}default:o$.syncErrorThrowable=!0,o$.destination=new yq(o$,r$,n$,i$)}return o$}return O(t$,e$),t$.prototype[Fh]=function(){return this},t$.create=function(r$,n$,i$){return(r$=new t$(r$,n$,i$)).syncErrorThrowable=!1,r$},t$.prototype.next=function(r$){this.isStopped||this._next(r$)},t$.prototype.error=function(r$){this.isStopped||(this.isStopped=!0,this._error(r$))},t$.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t$.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e$.prototype.unsubscribe.call(this))},t$.prototype._next=function(r$){this.destination.next(r$)},t$.prototype._error=function(r$){this.destination.error(r$),this.unsubscribe()},t$.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t$.prototype._unsubscribeAndRecycle=function(){var r$=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=r$,this},t$}(Oa),yq=function(e$){function t$(r$,n$,i$,o$){var s$=e$.call(this)||this;if(s$._parentSubscriber=r$,r$=s$,le(n$))var a$=n$;else n$&&(a$=n$.next,i$=n$.error,o$=n$.complete,n$!==Eh&&(le((r$=Object.create(n$)).unsubscribe)&&s$.add(r$.unsubscribe.bind(r$)),r$.unsubscribe=s$.unsubscribe.bind(s$)));return s$._context=r$,s$._next=a$,s$._error=i$,s$._complete=o$,s$}return O(t$,e$),t$.prototype.next=function(r$){if(!this.isStopped&&this._next){var n$=this._parentSubscriber;Ib.useDeprecatedSynchronousErrorHandling&&n$.syncErrorThrowable?this.__tryOrSetError(n$,this._next,r$)&&this.unsubscribe():this.__tryOrUnsub(this._next,r$)}},t$.prototype.error=function(r$){if(!this.isStopped){var n$=this._parentSubscriber,i$=Ib.useDeprecatedSynchronousErrorHandling;if(this._error)i$&&n$.syncErrorThrowable?this.__tryOrSetError(n$,this._error,r$):this.__tryOrUnsub(this._error,r$),this.unsubscribe();else if(n$.syncErrorThrowable)i$?(n$.syncErrorValue=r$,n$.syncErrorThrown=!0):me(r$),this.unsubscribe();else{if(this.unsubscribe(),i$)throw r$;me(r$)}}},t$.prototype.complete=function(){var r$=this;if(!this.isStopped){var n$=this._parentSubscriber;if(this._complete){var i$=function(){return r$._complete.call(r$._context)};Ib.useDeprecatedSynchronousErrorHandling&&n$.syncErrorThrowable?this.__tryOrSetError(n$,i$):this.__tryOrUnsub(i$)}this.unsubscribe()}},t$.prototype.__tryOrUnsub=function(r$,n$){try{r$.call(this._context,n$)}catch(i$){if(this.unsubscribe(),Ib.useDeprecatedSynchronousErrorHandling)throw i$;me(i$)}},t$.prototype.__tryOrSetError=function(r$,n$,i$){if(!Ib.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{n$.call(this._context,i$)}catch(o$){return Ib.useDeprecatedSynchronousErrorHandling?(r$.syncErrorValue=o$,r$.syncErrorThrown=!0):me(o$),!0}return!1},t$.prototype._unsubscribe=function(){var r$=this._parentSubscriber;this._parentSubscriber=this._context=null,r$.unsubscribe()},t$}(ia),ne=typeof Symbol=="function"&&Symbol.observable||"@@observable",Y=function(){function e$(t$){this._isScalar=!1,t$&&(this._subscribe=t$)}return e$.prototype.lift=function(t$){var r$=new e$;return r$.source=this,r$.operator=t$,r$},e$.prototype.subscribe=function(t$,r$,n$){var i$=this.operator;e:{if(t$){if(t$ instanceof ia)break e;if(t$[Fh]){t$=t$[Fh]();break e}}t$=t$||r$||n$?new ia(t$,r$,n$):new ia(Eh)}if(i$?t$.add(i$.call(t$,this.source)):t$.add(this.source||Ib.useDeprecatedSynchronousErrorHandling&&!t$.syncErrorThrowable?this._subscribe(t$):this._trySubscribe(t$)),Ib.useDeprecatedSynchronousErrorHandling&&t$.syncErrorThrowable&&(t$.syncErrorThrowable=!1,t$.syncErrorThrown))throw t$.syncErrorValue;return t$},e$.prototype._trySubscribe=function(t$){try{return this._subscribe(t$)}catch(r$){Ib.useDeprecatedSynchronousErrorHandling&&(t$.syncErrorThrown=!0,t$.syncErrorValue=r$),fi(t$)?t$.error(r$):console.warn(r$)}},e$.prototype.forEach=function(t$,r$){var n$=this;return new(r$=Zl(r$))(function(i$,o$){var s$=n$.subscribe(function(a$){try{t$(a$)}catch(c$){o$(c$),s$&&s$.unsubscribe()}},o$,i$)})},e$.prototype._subscribe=function(t$){var r$=this.source;return r$&&r$.subscribe(t$)},e$.prototype[ne]=function(){return this},e$.prototype.pipe=function(){for(var t$=[],r$=0;r$<arguments.length;r$++)t$[r$]=arguments[r$];return t$.length===0?this:Yl(t$)(this)},e$.prototype.toPromise=function(t$){var r$=this;return new(t$=Zl(t$))(function(n$,i$){var o$;r$.subscribe(function(s$){return o$=s$},function(s$){return i$(s$)},function(){return n$(o$)})})},e$.create=function(t$){return new e$(t$)},e$}(),qd=function(){function e$(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e$.prototype=Object.create(Error.prototype),e$}(),zq=function(e$){function t$(r$,n$){var i$=e$.call(this)||this;return i$.subject=r$,i$.subscriber=n$,i$.closed=!1,i$}return O(t$,e$),t$.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var r$=this.subject,n$=r$.observers;this.subject=null,!n$||n$.length===0||r$.isStopped||r$.closed||(r$=n$.indexOf(this.subscriber))!==-1&&n$.splice(r$,1)}},t$}(Oa),Aq=function(e$){function t$(r$){var n$=e$.call(this,r$)||this;return n$.destination=r$,n$}return O(t$,e$),t$}(ia),Pa=function(e$){function t$(){var r$=e$.call(this)||this;return r$.observers=[],r$.closed=!1,r$.isStopped=!1,r$.hasError=!1,r$.thrownError=null,r$}return O(t$,e$),t$.prototype[Fh]=function(){return new Aq(this)},t$.prototype.lift=function(r$){var n$=new Bq(this,this);return n$.operator=r$,n$},t$.prototype.next=function(r$){if(this.closed)throw new qd;if(!this.isStopped){var n$=this.observers,i$=n$.length;n$=n$.slice();for(var o$=0;o$<i$;o$++)n$[o$].next(r$)}},t$.prototype.error=function(r$){if(this.closed)throw new qd;this.hasError=!0,this.thrownError=r$,this.isStopped=!0;var n$=this.observers,i$=n$.length;n$=n$.slice();for(var o$=0;o$<i$;o$++)n$[o$].error(r$);this.observers.length=0},t$.prototype.complete=function(){if(this.closed)throw new qd;this.isStopped=!0;var r$=this.observers,n$=r$.length;r$=r$.slice();for(var i$=0;i$<n$;i$++)r$[i$].complete();this.observers.length=0},t$.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},t$.prototype._trySubscribe=function(r$){if(this.closed)throw new qd;return e$.prototype._trySubscribe.call(this,r$)},t$.prototype._subscribe=function(r$){if(this.closed)throw new qd;return this.hasError?(r$.error(this.thrownError),Oa.EMPTY):this.isStopped?(r$.complete(),Oa.EMPTY):(this.observers.push(r$),new zq(this,r$))},t$.prototype.asObservable=function(){var r$=new Y;return r$.source=this,r$},t$.create=function(r$,n$){return new Bq(r$,n$)},t$}(Y),Bq=function(e$){function t$(r$,n$){var i$=e$.call(this)||this;return i$.destination=r$,i$.source=n$,i$}return O(t$,e$),t$.prototype.next=function(r$){var n$=this.destination;n$&&n$.next&&n$.next(r$)},t$.prototype.error=function(r$){var n$=this.destination;n$&&n$.error&&this.destination.error(r$)},t$.prototype.complete=function(){var r$=this.destination;r$&&r$.complete&&this.destination.complete()},t$.prototype._subscribe=function(r$){return this.source?this.source.subscribe(r$):Oa.EMPTY},t$}(Pa),Ns=function(){function e$(t$){this.connectable=t$}return e$.prototype.call=function(t$,r$){var n$=this.connectable;return n$._refCount++,t$=new cz(t$,n$),r$=r$.subscribe(t$),t$.closed||(t$.connection=n$.connect()),r$},e$}(),cz=function(e$){function t$(r$,n$){return(r$=e$.call(this,r$)||this).connectable=n$,r$}return O(t$,e$),t$.prototype._unsubscribe=function(){var r$=this.connectable;if(r$){this.connectable=null;var n$=r$._refCount;0>=n$?this.connection=null:(r$._refCount=n$-1,1<n$?this.connection=null:(n$=this.connection,r$=r$._connection,this.connection=null,!r$||n$&&r$!==n$||r$.unsubscribe()))}else this.connection=null},t$}(ia),Cq=function(e$){function t$(r$,n$){var i$=e$.call(this)||this;return i$.source=r$,i$.subjectFactory=n$,i$._refCount=0,i$._isComplete=!1,i$}return O(t$,e$),t$.prototype._subscribe=function(r$){return this.getSubject().subscribe(r$)},t$.prototype.getSubject=function(){var r$=this._subject;return r$&&!r$.isStopped||(this._subject=this.subjectFactory()),this._subject},t$.prototype.connect=function(){var r$=this._connection;return r$||(this._isComplete=!1,(r$=this._connection=new Oa).add(this.source.subscribe(new dz(this.getSubject(),this))),r$.closed&&(this._connection=null,r$=Oa.EMPTY)),r$},t$.prototype.refCount=function(){return $l()(this)},t$}(Y),At=function(){var e$=Cq.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e$._subscribe},_isComplete:{value:e$._isComplete,writable:!0},getSubject:{value:e$.getSubject},connect:{value:e$.connect},refCount:{value:e$.refCount}}}(),dz=function(e$){function t$(r$,n$){return(r$=e$.call(this,r$)||this).connectable=n$,r$}return O(t$,e$),t$.prototype._error=function(r$){this._unsubscribe(),e$.prototype._error.call(this,r$)},t$.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e$.prototype._complete.call(this)},t$.prototype._unsubscribe=function(){var r$=this.connectable;if(r$){this.connectable=null;var n$=r$._connection;r$._refCount=0,r$._subject=null,r$._connection=null,n$&&n$.unsubscribe()}},t$}(Aq);(function(e$){function t$(r$,n$){return(r$=e$.call(this,r$)||this).connectable=n$,r$}O(t$,e$),t$.prototype._unsubscribe=function(){var r$=this.connectable;if(r$){this.connectable=null;var n$=r$._refCount;0>=n$?this.connection=null:(r$._refCount=n$-1,1<n$?this.connection=null:(n$=this.connection,r$=r$._connection,this.connection=null,!r$||n$&&r$!==n$||r$.unsubscribe()))}else this.connection=null}})(ia),function(e$){function t$(r$,n$,i$,o$,s$){return(r$=e$.call(this,r$)||this).keySelector=n$,r$.elementSelector=i$,r$.durationSelector=o$,r$.subjectSelector=s$,r$.groups=null,r$.attemptedToUnsubscribe=!1,r$.count=0,r$}O(t$,e$),t$.prototype._next=function(r$){try{var n$=this.keySelector(r$)}catch(i$){return void this.error(i$)}this._group(r$,n$)},t$.prototype._group=function(r$,n$){var i$=this.groups;i$||(i$=this.groups=new Map);var o$=i$.get(n$);if(this.elementSelector)try{var s$=this.elementSelector(r$)}catch(a$){this.error(a$)}else s$=r$;if(!o$&&(o$=this.subjectSelector?this.subjectSelector():new Pa,i$.set(n$,o$),r$=new Mk(n$,o$,this),this.destination.next(r$),this.durationSelector)){r$=void 0;try{r$=this.durationSelector(new Mk(n$,o$))}catch(a$){return void this.error(a$)}this.add(r$.subscribe(new ez(n$,o$,this)))}o$.closed||o$.next(s$)},t$.prototype._error=function(r$){var n$=this.groups;n$&&(n$.forEach(function(i$,o$){i$.error(r$)}),n$.clear()),this.destination.error(r$)},t$.prototype._complete=function(){var r$=this.groups;r$&&(r$.forEach(function(n$,i$){n$.complete()}),r$.clear()),this.destination.complete()},t$.prototype.removeGroup=function(r$){this.groups.delete(r$)},t$.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,this.count===0&&e$.prototype.unsubscribe.call(this))}}(ia);var ez=function(e$){function t$(r$,n$,i$){var o$=e$.call(this,n$)||this;return o$.key=r$,o$.group=n$,o$.parent=i$,o$}return O(t$,e$),t$.prototype._next=function(r$){this.complete()},t$.prototype._unsubscribe=function(){var r$=this.parent,n$=this.key;this.key=this.parent=null,r$&&r$.removeGroup(n$)},t$}(ia),Mk=function(e$){function t$(r$,n$,i$){var o$=e$.call(this)||this;return o$.key=r$,o$.groupSubject=n$,o$.refCountSubscription=i$,o$}return O(t$,e$),t$.prototype._subscribe=function(r$){var n$=new Oa,i$=this.refCountSubscription,o$=this.groupSubject;return i$&&!i$.closed&&n$.add(new fz(i$)),n$.add(o$.subscribe(r$)),n$},t$}(Y),fz=function(e$){function t$(r$){var n$=e$.call(this)||this;return n$.parent=r$,r$.count++,n$}return O(t$,e$),t$.prototype.unsubscribe=function(){var r$=this.parent;r$.closed||this.closed||(e$.prototype.unsubscribe.call(this),--r$.count,r$.count===0&&r$.attemptedToUnsubscribe&&r$.unsubscribe())},t$}(Oa),gz=function(e$){function t$(r$){var n$=e$.call(this)||this;return n$._value=r$,n$}return O(t$,e$),Object.defineProperty(t$.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t$.prototype._subscribe=function(r$){var n$=e$.prototype._subscribe.call(this,r$);return n$&&!n$.closed&&r$.next(this._value),n$},t$.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new qd;return this._value},t$.prototype.next=function(r$){e$.prototype.next.call(this,this._value=r$)},t$}(Pa),dg=function(e$){function t$(r$,n$){var i$=e$.call(this,r$,n$)||this;return i$.scheduler=r$,i$.work=n$,i$.pending=!1,i$}return O(t$,e$),t$.prototype.schedule=function(r$,n$){if(n$===void 0&&(n$=0),this.closed)return this;this.state=r$,r$=this.id;var i$=this.scheduler;return r$!=null&&(this.id=this.recycleAsyncId(i$,r$,n$)),this.pending=!0,this.delay=n$,this.id=this.id||this.requestAsyncId(i$,this.id,n$),this},t$.prototype.requestAsyncId=function(r$,n$,i$){return i$===void 0&&(i$=0),setInterval(r$.flush.bind(r$,this),i$)},t$.prototype.recycleAsyncId=function(r$,n$,i$){if(i$===void 0&&(i$=0),i$!==null&&this.delay===i$&&this.pending===!1)return n$;clearInterval(n$)},t$.prototype.execute=function(r$,n$){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(r$=this._execute(r$,n$))?r$:void(this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},t$.prototype._execute=function(r$,n$){n$=!1;var i$=void 0;try{this.work(r$)}catch(o$){n$=!0,i$=!!o$&&o$||Error(o$)}if(n$)return this.unsubscribe(),i$},t$.prototype._unsubscribe=function(){var r$=this.id,n$=this.scheduler,i$=n$.actions,o$=i$.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,o$!==-1&&i$.splice(o$,1),r$!=null&&(this.id=this.recycleAsyncId(n$,r$,null)),this.delay=null},t$}(function(e$){function t$(r$,n$){return e$.call(this)||this}return O(t$,e$),t$.prototype.schedule=function(r$,n$){return this},t$}(Oa)),hz=function(e$){function t$(r$,n$){var i$=e$.call(this,r$,n$)||this;return i$.scheduler=r$,i$.work=n$,i$}return O(t$,e$),t$.prototype.schedule=function(r$,n$){return n$===void 0&&(n$=0),0<n$?e$.prototype.schedule.call(this,r$,n$):(this.delay=n$,this.state=r$,this.scheduler.flush(this),this)},t$.prototype.execute=function(r$,n$){return 0<n$||this.closed?e$.prototype.execute.call(this,r$,n$):this._execute(r$,n$)},t$.prototype.requestAsyncId=function(r$,n$,i$){return i$===void 0&&(i$=0),i$!==null&&0<i$||i$===null&&0<this.delay?e$.prototype.requestAsyncId.call(this,r$,n$,i$):r$.flush(this)},t$}(dg),Nk=function(){function e$(t$,r$){r$===void 0&&(r$=e$.now),this.SchedulerAction=t$,this.now=r$}return e$.prototype.schedule=function(t$,r$,n$){return r$===void 0&&(r$=0),new this.SchedulerAction(this,t$).schedule(n$,r$)},e$.now=function(){return Date.now()},e$}(),eg=function(e$){function t$(r$,n$){n$===void 0&&(n$=Nk.now);var i$=e$.call(this,r$,function(){return t$.delegate&&t$.delegate!==i$?t$.delegate.now():n$()})||this;return i$.actions=[],i$.active=!1,i$.scheduled=void 0,i$}return O(t$,e$),t$.prototype.schedule=function(r$,n$,i$){return n$===void 0&&(n$=0),t$.delegate&&t$.delegate!==this?t$.delegate.schedule(r$,n$,i$):e$.prototype.schedule.call(this,r$,n$,i$)},t$.prototype.flush=function(r$){var n$=this.actions;if(this.active)n$.push(r$);else{var i$;this.active=!0;do if(i$=r$.execute(r$.state,r$.delay))break;while(r$=n$.shift());if(this.active=!1,i$){for(;r$=n$.shift();)r$.unsubscribe();throw i$}}},t$}(Nk),fg=new(function(e$){function t$(){return e$!==null&&e$.apply(this,arguments)||this}return O(t$,e$),t$}(eg))(hz),vb=new Y(function(e$){return e$.complete()}),am=function(e$){return function(t$){for(var r$=0,n$=e$.length;r$<n$&&!t$.closed;r$++)t$.next(e$[r$]);t$.complete()}},Ok;(function(e$){e$.NEXT="N",e$.ERROR="E",e$.COMPLETE="C"})(Ok||(Ok={}));var Ve=function(){function e$(t$,r$,n$){this.kind=t$,this.value=r$,this.error=n$,this.hasValue=t$==="N"}return e$.prototype.observe=function(t$){switch(this.kind){case"N":return t$.next&&t$.next(this.value);case"E":return t$.error&&t$.error(this.error);case"C":return t$.complete&&t$.complete()}},e$.prototype.do=function(t$,r$,n$){switch(this.kind){case"N":return t$&&t$(this.value);case"E":return r$&&r$(this.error);case"C":return n$&&n$()}},e$.prototype.accept=function(t$,r$,n$){return t$&&typeof t$.next=="function"?this.observe(t$):this.do(t$,r$,n$)},e$.prototype.toObservable=function(){switch(this.kind){case"N":return bb(this.value);case"E":return Z(this.error);case"C":return mf()}throw Error("unexpected notification kind value")},e$.createNext=function(t$){return t$!==void 0?new e$("N",t$):e$.undefinedValueNotification},e$.createError=function(t$){return new e$("E",void 0,t$)},e$.createComplete=function(){return e$.completeNotification},e$.completeNotification=new e$("C"),e$.undefinedValueNotification=new e$("N",void 0),e$}(),Rs=function(){function e$(t$,r$){r$===void 0&&(r$=0),this.scheduler=t$,this.delay=r$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Dq(t$,this.scheduler,this.delay))},e$}(),Dq=function(e$){function t$(r$,n$,i$){return i$===void 0&&(i$=0),(r$=e$.call(this,r$)||this).scheduler=n$,r$.delay=i$,r$}return O(t$,e$),t$.dispatch=function(r$){r$.notification.observe(r$.destination),this.unsubscribe()},t$.prototype.scheduleMessage=function(r$){this.destination.add(this.scheduler.schedule(t$.dispatch,this.delay,new iz(r$,this.destination)))},t$.prototype._next=function(r$){this.scheduleMessage(Ve.createNext(r$))},t$.prototype._error=function(r$){this.scheduleMessage(Ve.createError(r$)),this.unsubscribe()},t$.prototype._complete=function(){this.scheduleMessage(Ve.createComplete()),this.unsubscribe()},t$}(ia),iz=function(e$,t$){this.notification=e$,this.destination=t$},qe=function(e$){function t$(r$,n$,i$){r$===void 0&&(r$=Number.POSITIVE_INFINITY),n$===void 0&&(n$=Number.POSITIVE_INFINITY);var o$=e$.call(this)||this;return o$.scheduler=i$,o$._events=[],o$._infiniteTimeWindow=!1,o$._bufferSize=1>r$?1:r$,o$._windowTime=1>n$?1:n$,n$===Number.POSITIVE_INFINITY?(o$._infiniteTimeWindow=!0,o$.next=o$.nextInfiniteTimeWindow):o$.next=o$.nextTimeWindow,o$}return O(t$,e$),t$.prototype.nextInfiniteTimeWindow=function(r$){if(!this.isStopped){var n$=this._events;n$.push(r$),n$.length>this._bufferSize&&n$.shift()}e$.prototype.next.call(this,r$)},t$.prototype.nextTimeWindow=function(r$){this.isStopped||(this._events.push(new jz(this._getNow(),r$)),this._trimBufferThenGetEvents()),e$.prototype.next.call(this,r$)},t$.prototype._subscribe=function(r$){var n$=this._infiniteTimeWindow,i$=n$?this._events:this._trimBufferThenGetEvents(),o$=this.scheduler,s$=i$.length;if(this.closed)throw new qd;if(this.isStopped||this.hasError)var a$=Oa.EMPTY;else this.observers.push(r$),a$=new zq(this,r$);if(o$&&r$.add(r$=new Dq(r$,o$)),n$)for(n$=0;n$<s$&&!r$.closed;n$++)r$.next(i$[n$]);else for(n$=0;n$<s$&&!r$.closed;n$++)r$.next(i$[n$].value);return this.hasError?r$.error(this.thrownError):this.isStopped&&r$.complete(),a$},t$.prototype._getNow=function(){return(this.scheduler||fg).now()},t$.prototype._trimBufferThenGetEvents=function(){for(var r$=this._getNow(),n$=this._bufferSize,i$=this._windowTime,o$=this._events,s$=o$.length,a$=0;a$<s$&&!(r$-o$[a$].time<i$);)a$++;return s$>n$&&(a$=Math.max(a$,s$-n$)),0<a$&&o$.splice(0,a$),o$},t$}(Pa),jz=function(e$,t$){this.time=e$,this.value=t$},of=function(e$){function t$(){var r$=e$!==null&&e$.apply(this,arguments)||this;return r$.value=null,r$.hasNext=!1,r$.hasCompleted=!1,r$}return O(t$,e$),t$.prototype._subscribe=function(r$){return this.hasError?(r$.error(this.thrownError),Oa.EMPTY):this.hasCompleted&&this.hasNext?(r$.next(this.value),r$.complete(),Oa.EMPTY):e$.prototype._subscribe.call(this,r$)},t$.prototype.next=function(r$){this.hasCompleted||(this.value=r$,this.hasNext=!0)},t$.prototype.error=function(r$){this.hasCompleted||e$.prototype.error.call(this,r$)},t$.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e$.prototype.next.call(this,this.value),e$.prototype.complete.call(this)},t$}(Pa),kz=1,lz=Promise.resolve(),ii={},Eq={setImmediate:function(e$){var t$=kz++;return ii[t$]=!0,lz.then(function(){return bm(t$)&&e$()}),t$},clearImmediate:function(e$){bm(e$)}},mz=function(e$){function t$(r$,n$){var i$=e$.call(this,r$,n$)||this;return i$.scheduler=r$,i$.work=n$,i$}return O(t$,e$),t$.prototype.requestAsyncId=function(r$,n$,i$){return i$===void 0&&(i$=0),i$!==null&&0<i$?e$.prototype.requestAsyncId.call(this,r$,n$,i$):(r$.actions.push(this),r$.scheduled||(r$.scheduled=Eq.setImmediate(r$.flush.bind(r$,null))))},t$.prototype.recycleAsyncId=function(r$,n$,i$){if(i$===void 0&&(i$=0),i$!==null&&0<i$||i$===null&&0<this.delay)return e$.prototype.recycleAsyncId.call(this,r$,n$,i$);r$.actions.length===0&&(Eq.clearImmediate(n$),r$.scheduled=void 0)},t$}(dg),ri=new(function(e$){function t$(){return e$!==null&&e$.apply(this,arguments)||this}return O(t$,e$),t$.prototype.flush=function(r$){this.active=!0,this.scheduled=void 0;var n$,i$=this.actions,o$=-1,s$=i$.length;r$=r$||i$.shift();do if(n$=r$.execute(r$.state,r$.delay))break;while(++o$<s$&&(r$=i$.shift()));if(this.active=!1,n$){for(;++o$<s$&&(r$=i$.shift());)r$.unsubscribe();throw n$}},t$}(eg))(mz),nz=ri,Pk=new eg(dg),bd=Pk,oz=function(e$){function t$(r$,n$){var i$=e$.call(this,r$,n$)||this;return i$.scheduler=r$,i$.work=n$,i$}return O(t$,e$),t$.prototype.requestAsyncId=function(r$,n$,i$){return i$===void 0&&(i$=0),i$!==null&&0<i$?e$.prototype.requestAsyncId.call(this,r$,n$,i$):(r$.actions.push(this),r$.scheduled||(r$.scheduled=requestAnimationFrame(function(){return r$.flush(null)})))},t$.prototype.recycleAsyncId=function(r$,n$,i$){if(i$===void 0&&(i$=0),i$!==null&&0<i$||i$===null&&0<this.delay)return e$.prototype.recycleAsyncId.call(this,r$,n$,i$);r$.actions.length===0&&(cancelAnimationFrame(n$),r$.scheduled=void 0)},t$}(dg),Fq=new(function(e$){function t$(){return e$!==null&&e$.apply(this,arguments)||this}return O(t$,e$),t$.prototype.flush=function(r$){this.active=!0,this.scheduled=void 0;var n$,i$=this.actions,o$=-1,s$=i$.length;r$=r$||i$.shift();do if(n$=r$.execute(r$.state,r$.delay))break;while(++o$<s$&&(r$=i$.shift()));if(this.active=!1,n$){for(;++o$<s$&&(r$=i$.shift());)r$.unsubscribe();throw n$}},t$}(eg))(oz),pz=function(e$){function t$(r$,n$){r$===void 0&&(r$=Gq),n$===void 0&&(n$=Number.POSITIVE_INFINITY);var i$=e$.call(this,r$,function(){return i$.frame})||this;return i$.maxFrames=n$,i$.frame=0,i$.index=-1,i$}return O(t$,e$),t$.prototype.flush=function(){for(var r$,n$,i$=this.actions,o$=this.maxFrames;(n$=i$[0])&&n$.delay<=o$&&(i$.shift(),this.frame=n$.delay,!(r$=n$.execute(n$.state,n$.delay))););if(r$){for(;n$=i$.shift();)n$.unsubscribe();throw r$}},t$.frameTimeFactor=10,t$}(eg),Gq=function(e$){function t$(r$,n$,i$){i$===void 0&&(i$=r$.index+=1);var o$=e$.call(this,r$,n$)||this;return o$.scheduler=r$,o$.work=n$,o$.index=i$,o$.active=!0,o$.index=r$.index=i$,o$}return O(t$,e$),t$.prototype.schedule=function(r$,n$){if(n$===void 0&&(n$=0),!this.id)return e$.prototype.schedule.call(this,r$,n$);this.active=!1;var i$=new t$(this.scheduler,this.work);return this.add(i$),i$.schedule(r$,n$)},t$.prototype.requestAsyncId=function(r$,n$,i$){return i$===void 0&&(i$=0),this.delay=r$.frame+i$,(r$=r$.actions).push(this),r$.sort(t$.sortActions),!0},t$.prototype.recycleAsyncId=function(r$,n$,i$){},t$.prototype._execute=function(r$,n$){if(this.active===!0)return e$.prototype._execute.call(this,r$,n$)},t$.sortActions=function(r$,n$){return r$.delay===n$.delay?r$.index===n$.index?0:r$.index>n$.index?1:-1:r$.delay>n$.delay?1:-1},t$}(dg),Qk=function(){function e$(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e$.prototype=Object.create(Error.prototype),e$}(),vg=function(){function e$(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e$.prototype=Object.create(Error.prototype),e$}(),pb=function(){function e$(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e$.prototype=Object.create(Error.prototype),e$}(),Ss=function(){function e$(t$,r$){this.project=t$,this.thisArg=r$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new qz(t$,this.project,this.thisArg))},e$}(),qz=function(e$){function t$(r$,n$,i$){return(r$=e$.call(this,r$)||this).project=n$,r$.count=0,r$.thisArg=i$||r$,r$}return O(t$,e$),t$.prototype._next=function(r$){try{var n$=this.project.call(this.thisArg,r$,this.count++)}catch(i$){return void this.destination.error(i$)}this.destination.next(n$)},t$}(ia),Rk=function(e$){function t$(){return e$!==null&&e$.apply(this,arguments)||this}return O(t$,e$),t$.prototype.notifyNext=function(r$,n$,i$,o$,s$){this.destination.next(n$)},t$.prototype.notifyError=function(r$,n$){this.destination.error(r$)},t$.prototype.notifyComplete=function(r$){this.destination.complete()},t$}(ia),Xs=function(e$){function t$(r$,n$,i$){var o$=e$.call(this)||this;return o$.parent=r$,o$.outerValue=n$,o$.outerIndex=i$,o$.index=0,o$}return O(t$,e$),t$.prototype._next=function(r$){this.parent.notifyNext(this.outerValue,r$,this.outerIndex,this.index++,this)},t$.prototype._error=function(r$){this.parent.notifyError(r$,this),this.unsubscribe()},t$.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t$}(ia),rz=function(e$){return function(t$){return e$.then(function(r$){t$.closed||(t$.next(r$),t$.complete())},function(r$){return t$.error(r$)}).then(null,me),t$}},$c=typeof Symbol=="function"&&Symbol.iterator?Symbol.iterator:"@@iterator",sz=function(e$){return function(t$){for(var r$=e$[$c]();;){var n$=void 0;try{n$=r$.next()}catch(i$){return t$.error(i$),t$}if(n$.done){t$.complete();break}if(t$.next(n$.value),t$.closed)break}return typeof r$.return=="function"&&t$.add(function(){r$.return&&r$.return()}),t$}},tz=function(e$){return function(t$){var r$=e$[ne]();if(typeof r$.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return r$.subscribe(t$)}},hm=function(e$){return e$&&typeof e$.length=="number"&&typeof e$!="function"},pf=function(e$){if(e$&&typeof e$[ne]=="function")return tz(e$);if(hm(e$))return am(e$);if(fm(e$))return rz(e$);if(e$&&typeof e$[$c]=="function")return sz(e$);throw e$=ei(e$)?"an invalid object":"'"+e$+"'",new TypeError("You provided "+e$+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Hq={},vz=function(){function e$(t$){this.resultSelector=t$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new uz(t$,this.resultSelector))},e$}(),uz=function(e$){function t$(r$,n$){return(r$=e$.call(this,r$)||this).resultSelector=n$,r$.active=0,r$.values=[],r$.observables=[],r$}return O(t$,e$),t$.prototype._next=function(r$){this.values.push(Hq),this.observables.push(r$)},t$.prototype._complete=function(){var r$=this.observables,n$=r$.length;if(n$===0)this.destination.complete();else{this.toRespond=this.active=n$;for(var i$=0;i$<n$;i$++)this.add(ji(this,r$[i$],void 0,i$))}},t$.prototype.notifyComplete=function(r$){--this.active==0&&this.destination.complete()},t$.prototype.notifyNext=function(r$,n$,i$){var o$=(r$=this.values)[i$];o$=this.toRespond?o$===Hq?--this.toRespond:this.toRespond:0,r$[i$]=n$,o$===0&&(this.resultSelector?this._tryResultSelector(r$):this.destination.next(r$.slice()))},t$.prototype._tryResultSelector=function(r$){try{var n$=this.resultSelector.apply(this,r$)}catch(i$){return void this.destination.error(i$)}this.destination.next(n$)},t$}(Rk),vc=function(e$){function t$(r$){var n$=e$.call(this)||this;return n$.parent=r$,n$}return O(t$,e$),t$.prototype._next=function(r$){this.parent.notifyNext(r$)},t$.prototype._error=function(r$){this.parent.notifyError(r$),this.unsubscribe()},t$.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t$}(ia);(function(e$){function t$(r$,n$,i$){var o$=e$.call(this)||this;return o$.parent=r$,o$.outerValue=n$,o$.outerIndex=i$,o$}O(t$,e$),t$.prototype._next=function(r$){this.parent.notifyNext(this.outerValue,r$,this.outerIndex,this)},t$.prototype._error=function(r$){this.parent.notifyError(r$),this.unsubscribe()},t$.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}})(ia);var wc=function(e$){function t$(){return e$!==null&&e$.apply(this,arguments)||this}return O(t$,e$),t$.prototype.notifyNext=function(r$){this.destination.next(r$)},t$.prototype.notifyError=function(r$){this.destination.error(r$)},t$.prototype.notifyComplete=function(){this.destination.complete()},t$}(ia);(function(e$){function t$(){return e$!==null&&e$.apply(this,arguments)||this}O(t$,e$),t$.prototype.notifyNext=function(r$,n$,i$,o$){this.destination.next(n$)},t$.prototype.notifyError=function(r$){this.destination.error(r$)},t$.prototype.notifyComplete=function(r$){this.destination.complete()}})(ia);var at=function(){function e$(t$,r$){r$===void 0&&(r$=Number.POSITIVE_INFINITY),this.project=t$,this.concurrent=r$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new wz(t$,this.project,this.concurrent))},e$}(),wz=function(e$){function t$(r$,n$,i$){return i$===void 0&&(i$=Number.POSITIVE_INFINITY),(r$=e$.call(this,r$)||this).project=n$,r$.concurrent=i$,r$.hasCompleted=!1,r$.buffer=[],r$.active=0,r$.index=0,r$}return O(t$,e$),t$.prototype._next=function(r$){this.active<this.concurrent?this._tryNext(r$):this.buffer.push(r$)},t$.prototype._tryNext=function(r$){var n$=this.index++;try{var i$=this.project(r$,n$)}catch(o$){return void this.destination.error(o$)}this.active++,this._innerSub(i$)},t$.prototype._innerSub=function(r$){var n$=new vc(this),i$=this.destination;i$.add(n$),(r$=ic(r$,n$))!==n$&&i$.add(r$)},t$.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},t$.prototype.notifyNext=function(r$){this.destination.next(r$)},t$.prototype.notifyComplete=function(){var r$=this.buffer;this.active--,0<r$.length?this._next(r$.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},t$}(wc),Sk=y.parseFloat,Iq=1/Sk(`	
\v\f\r \u2028\u2029\uFEFF-0`)!=-1/0?function(e$){e$=ik(String(e$));var t$=Sk(e$);return t$===0&&e$.charAt(0)=="-"?-0:t$}:Sk;N({global:!0,forced:parseFloat!=Iq},{parseFloat:Iq});var Tk=new Y(hc),ft=function(){function e$(t$,r$){this.predicate=t$,this.thisArg=r$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new xz(t$,this.predicate,this.thisArg))},e$}(),xz=function(e$){function t$(r$,n$,i$){return(r$=e$.call(this,r$)||this).predicate=n$,r$.thisArg=i$,r$.count=0,r$}return O(t$,e$),t$.prototype._next=function(r$){try{var n$=this.predicate.call(this.thisArg,r$,this.count++)}catch(i$){return void this.destination.error(i$)}n$&&this.destination.next(r$)},t$}(ia),gt=function(){function e$(){}return e$.prototype.call=function(t$,r$){return r$.subscribe(new yz(t$))},e$}(),yz=function(e$){function t$(r$){return(r$=e$.call(this,r$)||this).hasFirst=!1,r$.observables=[],r$.subscriptions=[],r$}return O(t$,e$),t$.prototype._next=function(r$){this.observables.push(r$)},t$.prototype._complete=function(){var r$=this.observables,n$=r$.length;if(n$===0)this.destination.complete();else{for(var i$=0;i$<n$&&!this.hasFirst;i$++){var o$=ji(this,r$[i$],void 0,i$);this.subscriptions&&this.subscriptions.push(o$),this.add(o$)}this.observables=null}},t$.prototype.notifyNext=function(r$,n$,i$){if(!this.hasFirst){for(this.hasFirst=!0,r$=0;r$<this.subscriptions.length;r$++)if(r$!==i$){var o$=this.subscriptions[r$];o$.unsubscribe(),this.remove(o$)}this.subscriptions=null}this.destination.next(n$)},t$}(Rk),jt=function(){function e$(t$){this.resultSelector=t$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new zz(t$,this.resultSelector))},e$}(),zz=function(e$){function t$(r$,n$,i$){return(r$=e$.call(this,r$)||this).resultSelector=n$,r$.iterators=[],r$.active=0,r$.resultSelector=typeof n$=="function"?n$:void 0,r$}return O(t$,e$),t$.prototype._next=function(r$){var n$=this.iterators;Jb(r$)?n$.push(new Az(r$)):typeof r$[$c]=="function"?n$.push(new Bz(r$[$c]())):n$.push(new Cz(this.destination,this,r$))},t$.prototype._complete=function(){var r$=this.iterators,n$=r$.length;if(this.unsubscribe(),n$===0)this.destination.complete();else{this.active=n$;for(var i$=0;i$<n$;i$++){var o$=r$[i$];o$.stillUnsubscribed?this.destination.add(o$.subscribe()):this.active--}}},t$.prototype.notifyInactive=function(){this.active--,this.active===0&&this.destination.complete()},t$.prototype.checkIterators=function(){for(var r$=this.iterators,n$=r$.length,i$=this.destination,o$=0;o$<n$;o$++){var s$=r$[o$];if(typeof s$.hasValue=="function"&&!s$.hasValue())return}var a$=!1,c$=[];for(o$=0;o$<n$;o$++){var u$=(s$=r$[o$]).next();if(s$.hasCompleted()&&(a$=!0),u$.done)return void i$.complete();c$.push(u$.value)}this.resultSelector?this._tryresultSelector(c$):i$.next(c$),a$&&i$.complete()},t$.prototype._tryresultSelector=function(r$){try{var n$=this.resultSelector.apply(this,r$)}catch(i$){return void this.destination.error(i$)}this.destination.next(n$)},t$}(ia),Bz=function(){function e$(t$){this.iterator=t$,this.nextResult=t$.next()}return e$.prototype.hasValue=function(){return!0},e$.prototype.next=function(){var t$=this.nextResult;return this.nextResult=this.iterator.next(),t$},e$.prototype.hasCompleted=function(){var t$=this.nextResult;return!(!t$||!t$.done)},e$}(),Az=function(){function e$(t$){this.array=t$,this.length=this.index=0,this.length=t$.length}return e$.prototype[$c]=function(){return this},e$.prototype.next=function(t$){t$=this.index++;var r$=this.array;return t$<this.length?{value:r$[t$],done:!1}:{value:null,done:!0}},e$.prototype.hasValue=function(){return this.array.length>this.index},e$.prototype.hasCompleted=function(){return this.array.length===this.index},e$}(),Cz=function(e$){function t$(r$,n$,i$){return(r$=e$.call(this,r$)||this).parent=n$,r$.observable=i$,r$.stillUnsubscribed=!0,r$.buffer=[],r$.isComplete=!1,r$}return O(t$,e$),t$.prototype[$c]=function(){return this},t$.prototype.next=function(){var r$=this.buffer;return r$.length===0&&this.isComplete?{value:null,done:!0}:{value:r$.shift(),done:!1}},t$.prototype.hasValue=function(){return 0<this.buffer.length},t$.prototype.hasCompleted=function(){return this.buffer.length===0&&this.isComplete},t$.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t$.prototype.notifyNext=function(r$){this.buffer.push(r$),this.parent.checkIterators()},t$.prototype.subscribe=function(){return ic(this.observable,new vc(this))},t$}(wc),Dz=Object.freeze({__proto__:null,Observable:Y,ConnectableObservable:Cq,GroupedObservable:Mk,observable:ne,Subject:Pa,BehaviorSubject:gz,ReplaySubject:qe,AsyncSubject:of,asap:nz,asapScheduler:ri,async:bd,asyncScheduler:Pk,queue:fg,queueScheduler:fg,animationFrame:Fq,animationFrameScheduler:Fq,VirtualTimeScheduler:pz,VirtualAction:Gq,Scheduler:Nk,Subscription:Oa,Subscriber:ia,Notification:Ve,get NotificationKind(){return Ok},pipe:gi,noop:hc,identity:Yc,isObservable:function(e$){return!!e$&&(e$ instanceof Y||typeof e$.lift=="function"&&typeof e$.subscribe=="function")},ArgumentOutOfRangeError:Qk,EmptyError:vg,ObjectUnsubscribedError:qd,UnsubscriptionError:lf,TimeoutError:pb,bindCallback:cm,bindNodeCallback:dm,combineLatest:function(){for(var e$=[],t$=0;t$<arguments.length;t$++)e$[t$]=arguments[t$];var r$=t$=void 0;return Zc(e$[e$.length-1])&&(r$=e$.pop()),typeof e$[e$.length-1]=="function"&&(t$=e$.pop()),e$.length===1&&Jb(e$[0])&&(e$=e$[0]),nf(e$,r$).lift(new vz(t$))},concat:im,defer:ad,empty:mf,forkJoin:jm,from:Kb,fromEvent:gb,fromEventPattern:lm,generate:function(e$,t$,r$,n$,i$){if(arguments.length==1){var o$=e$.initialState;t$=e$.condition,r$=e$.iterate;var s$=e$.resultSelector||Yc;i$=e$.scheduler}else n$===void 0||Zc(n$)?(o$=e$,s$=Yc,i$=n$):(o$=e$,s$=n$);return new Y(function(a$){var c$=o$;if(i$)return i$.schedule(bt,0,{subscriber:a$,iterate:r$,condition:t$,resultSelector:s$,state:c$});for(;;){if(t$){var u$=void 0;try{u$=t$(c$)}catch(l$){a$.error(l$);break}if(!u$){a$.complete();break}}u$=void 0;try{u$=s$(c$)}catch(l$){a$.error(l$);break}if(a$.next(u$),a$.closed)break;try{c$=r$(c$)}catch(l$){a$.error(l$);break}}})},iif:function(e$,t$,r$){return t$===void 0&&(t$=vb),r$===void 0&&(r$=vb),ad(function(){return e$()?t$:r$})},interval:mm,merge:Xb,never:function(){return Tk},of:bb,onErrorResumeNext:li,pairs:function(e$,t$){return new Y(t$?function(r$){var n$=Object.keys(e$),i$=new Oa;return i$.add(t$.schedule(dt,0,{keys:n$,index:0,subscriber:r$,subscription:i$,obj:e$})),i$}:function(r$){for(var n$=Object.keys(e$),i$=0;i$<n$.length&&!r$.closed;i$++){var o$=n$[i$];e$.hasOwnProperty(o$)&&r$.next([o$,e$[o$]])}r$.complete()})},partition:function(e$,t$,r$){return[wb(t$,r$)(new Y(pf(e$))),wb(et(t$,r$))(new Y(pf(e$)))]},race:Ca,range:function(e$,t$,r$){return e$===void 0&&(e$=0),new Y(function(n$){t$===void 0&&(t$=e$,e$=0);var i$=0,o$=e$;if(r$)return r$.schedule(ht,0,{index:i$,count:t$,start:e$,subscriber:n$});for(;;){if(i$++>=t$){n$.complete();break}if(n$.next(o$++),n$.closed)break}})},throwError:Z,timer:Bc,using:function(e$,t$){return new Y(function(r$){try{var n$=e$()}catch(s$){return void r$.error(s$)}try{var i$=t$(n$)}catch(s$){return void r$.error(s$)}var o$=(i$?Kb(i$):vb).subscribe(r$);return function(){o$.unsubscribe(),n$&&n$.unsubscribe()}})},zip:mi,scheduled:gm,EMPTY:vb,NEVER:Tk,config:Ib}),kt=function(){function e$(t$){this.selector=t$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Ez(t$,this.selector,this.caught))},e$}(),Ez=function(e$){function t$(r$,n$,i$){return(r$=e$.call(this,r$)||this).selector=n$,r$.caught=i$,r$}return O(t$,e$),t$.prototype.error=function(r$){if(!this.isStopped){var n$=void 0;try{n$=this.selector(r$,this.caught)}catch(i$){return void e$.prototype.error.call(this,i$)}this._unsubscribeAndRecycle(),r$=new vc(this),this.add(r$),(n$=ic(n$,r$))!==r$&&this.add(n$)}},t$}(wc),lt=function(){function e$(t$){this.defaultValue=t$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Fz(t$,this.defaultValue))},e$}(),Fz=function(e$){function t$(r$,n$){return(r$=e$.call(this,r$)||this).defaultValue=n$,r$.isEmpty=!0,r$}return O(t$,e$),t$.prototype._next=function(r$){this.isEmpty=!1,this.destination.next(r$)},t$.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t$}(ia),mt=function(){function e$(t$,r$){this.delay=t$,this.scheduler=r$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Gz(t$,this.delay,this.scheduler))},e$}(),Gz=function(e$){function t$(r$,n$,i$){return(r$=e$.call(this,r$)||this).delay=n$,r$.scheduler=i$,r$.queue=[],r$.active=!1,r$.errored=!1,r$}return O(t$,e$),t$.dispatch=function(r$){for(var n$=r$.source,i$=n$.queue,o$=r$.scheduler,s$=r$.destination;0<i$.length&&0>=i$[0].time-o$.now();)i$.shift().notification.observe(s$);0<i$.length?(n$=Math.max(0,i$[0].time-o$.now()),this.schedule(r$,n$)):(this.unsubscribe(),n$.active=!1)},t$.prototype._schedule=function(r$){this.active=!0,this.destination.add(r$.schedule(t$.dispatch,this.delay,{source:this,destination:this.destination,scheduler:r$}))},t$.prototype.scheduleNotification=function(r$){if(this.errored!==!0){var n$=this.scheduler;r$=new Hz(n$.now()+this.delay,r$),this.queue.push(r$),this.active===!1&&this._schedule(n$)}},t$.prototype._next=function(r$){this.scheduleNotification(Ve.createNext(r$))},t$.prototype._error=function(r$){this.errored=!0,this.queue=[],this.destination.error(r$),this.unsubscribe()},t$.prototype._complete=function(){this.scheduleNotification(Ve.createComplete()),this.unsubscribe()},t$}(ia),Hz=function(e$,t$){this.time=e$,this.notification=t$},nt=function(){function e$(t$,r$){this.keySelector=t$,this.flushes=r$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Iz(t$,this.keySelector,this.flushes))},e$}(),Iz=function(e$){function t$(r$,n$,i$){return(r$=e$.call(this,r$)||this).keySelector=n$,r$.values=new Set,i$&&r$.add(ic(i$,new vc(r$))),r$}return O(t$,e$),t$.prototype.notifyNext=function(){this.values.clear()},t$.prototype.notifyError=function(r$){this._error(r$)},t$.prototype._next=function(r$){this.keySelector?this._useKeySelector(r$):this._finalizeNext(r$,r$)},t$.prototype._useKeySelector=function(r$){var n$=this.destination;try{var i$=this.keySelector(r$)}catch(o$){return void n$.error(o$)}this._finalizeNext(i$,r$)},t$.prototype._finalizeNext=function(r$,n$){var i$=this.values;i$.has(r$)||(i$.add(r$),this.destination.next(n$))},t$}(wc),pt=function(){function e$(t$){this.errorFactory=t$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Jz(t$,this.errorFactory))},e$}(),Jz=function(e$){function t$(r$,n$){return(r$=e$.call(this,r$)||this).errorFactory=n$,r$.hasValue=!1,r$}return O(t$,e$),t$.prototype._next=function(r$){this.hasValue=!0,this.destination.next(r$)},t$.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var r$=void 0;try{r$=this.errorFactory()}catch(n$){r$=n$}this.destination.error(r$)},t$}(ia),qt=function(){function e$(t$){if(this.total=t$,0>this.total)throw new Qk}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Kz(t$,this.total))},e$}(),Kz=function(e$){function t$(r$,n$){return(r$=e$.call(this,r$)||this).total=n$,r$.count=0,r$}return O(t$,e$),t$.prototype._next=function(r$){var n$=this.total,i$=++this.count;i$<=n$&&(this.destination.next(r$),i$===n$&&(this.destination.complete(),this.unsubscribe()))},t$}(ia),rt=function(){function e$(t$){this.project=t$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Lz(t$,this.project))},e$}(),Lz=function(e$){function t$(r$,n$){return(r$=e$.call(this,r$)||this).project=n$,r$.hasSubscription=!1,r$.hasCompleted=!1,r$.index=0,r$}return O(t$,e$),t$.prototype._next=function(r$){this.hasSubscription||this.tryNext(r$)},t$.prototype.tryNext=function(r$){var n$=this.index++;try{var i$=this.project(r$,n$)}catch(o$){return void this.destination.error(o$)}this.hasSubscription=!0,this._innerSub(i$)},t$.prototype._innerSub=function(r$){var n$=new vc(this),i$=this.destination;i$.add(n$),(r$=ic(r$,n$))!==n$&&i$.add(r$)},t$.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},t$.prototype.notifyNext=function(r$){this.destination.next(r$)},t$.prototype.notifyError=function(r$){this.destination.error(r$)},t$.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t$}(wc),st=function(){function e$(t$){this.callback=t$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Mz(t$,this.callback))},e$}(),Mz=function(e$){function t$(r$,n$){return(r$=e$.call(this,r$)||this).add(new Oa(n$)),r$}return O(t$,e$),t$}(ia),ut=function(){function e$(){}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Nz(t$))},e$}(),Nz=function(e$){function t$(){return e$!==null&&e$.apply(this,arguments)||this}return O(t$,e$),t$.prototype._next=function(r$){},t$}(ia),vt=function(){function e$(t$){if(this.total=t$,0>this.total)throw new Qk}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Oz(t$,this.total))},e$}(),Oz=function(e$){function t$(r$,n$){return(r$=e$.call(this,r$)||this).total=n$,r$.ring=[],r$.count=0,r$}return O(t$,e$),t$.prototype._next=function(r$){var n$=this.ring,i$=this.total,o$=this.count++;n$.length<i$?n$.push(r$):n$[o$%i$]=r$},t$.prototype._complete=function(){var r$=this.destination,n$=this.count;if(0<n$)for(var i$=this.count>=this.total?this.total:this.count,o$=this.ring,s$=0;s$<i$;s$++){var a$=n$++%i$;r$.next(o$[a$])}r$.complete()},t$}(ia),wt=function(){function e$(t$){this.value=t$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Pz(t$,this.value))},e$}(),Pz=function(e$){function t$(r$,n$){return(r$=e$.call(this,r$)||this).value=n$,r$}return O(t$,e$),t$.prototype._next=function(r$){this.destination.next(this.value)},t$}(ia),xt=function(){function e$(t$,r$,n$){n$===void 0&&(n$=!1),this.accumulator=t$,this.seed=r$,this.hasSeed=n$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Qz(t$,this.accumulator,this.seed,this.hasSeed))},e$}(),Qz=function(e$){function t$(r$,n$,i$,o$){return(r$=e$.call(this,r$)||this).accumulator=n$,r$._seed=i$,r$.hasSeed=o$,r$.index=0,r$}return O(t$,e$),Object.defineProperty(t$.prototype,"seed",{get:function(){return this._seed},set:function(r$){this.hasSeed=!0,this._seed=r$},enumerable:!0,configurable:!0}),t$.prototype._next=function(r$){if(this.hasSeed)return this._tryNext(r$);this.seed=r$,this.destination.next(r$)},t$.prototype._tryNext=function(r$){var n$=this.index++;try{var i$=this.accumulator(this.seed,r$,n$)}catch(o$){this.destination.error(o$)}this.seed=i$,this.destination.next(i$)},t$}(ia),Bt=function(){function e$(t$,r$){this.notifier=t$,this.source=r$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Rz(t$,this.notifier,this.source))},e$}(),Rz=function(e$){function t$(r$,n$,i$){return(r$=e$.call(this,r$)||this).notifier=n$,r$.source=i$,r$}return O(t$,e$),t$.prototype.error=function(r$){if(!this.isStopped){var n$=this.errors,i$=this.retries,o$=this.retriesSubscription;if(i$)this.retriesSubscription=this.errors=void 0;else{n$=new Pa;try{i$=(0,this.notifier)(n$)}catch(s$){return e$.prototype.error.call(this,s$)}o$=ic(i$,new vc(this))}this._unsubscribeAndRecycle(),this.errors=n$,this.retries=i$,this.retriesSubscription=o$,n$.next(r$)}},t$.prototype._unsubscribe=function(){var r$=this.errors,n$=this.retriesSubscription;r$&&(r$.unsubscribe(),this.errors=void 0),n$&&(n$.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t$.prototype.notifyNext=function(){var r$=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=r$,this.source.subscribe(this)},t$}(wc),Et=function(){function e$(t$){this.project=t$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Sz(t$,this.project))},e$}(),Sz=function(e$){function t$(r$,n$){return(r$=e$.call(this,r$)||this).project=n$,r$.index=0,r$}return O(t$,e$),t$.prototype._next=function(r$){var n$=this.index++;try{var i$=this.project(r$,n$)}catch(o$){return void this.destination.error(o$)}this._innerSub(i$)},t$.prototype._innerSub=function(r$){var n$=this.innerSubscription;n$&&n$.unsubscribe(),n$=new vc(this);var i$=this.destination;i$.add(n$),this.innerSubscription=ic(r$,n$),this.innerSubscription!==n$&&i$.add(this.innerSubscription)},t$.prototype._complete=function(){var r$=this.innerSubscription;r$&&!r$.closed||e$.prototype._complete.call(this),this.unsubscribe()},t$.prototype._unsubscribe=function(){this.innerSubscription=void 0},t$.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e$.prototype._complete.call(this)},t$.prototype.notifyNext=function(r$){this.destination.next(r$)},t$}(wc),Ft=function(){function e$(t$){this.notifier=t$}return e$.prototype.call=function(t$,r$){t$=new Tz(t$);var n$=ic(this.notifier,new vc(t$));return n$&&!t$.seenValue?(t$.add(n$),r$.subscribe(t$)):t$},e$}(),Tz=function(e$){function t$(r$){return(r$=e$.call(this,r$)||this).seenValue=!1,r$}return O(t$,e$),t$.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t$.prototype.notifyComplete=function(){},t$}(wc),Ht=function(){function e$(t$,r$){this.predicate=t$,this.inclusive=r$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Uz(t$,this.predicate,this.inclusive))},e$}(),Uz=function(e$){function t$(r$,n$,i$){return(r$=e$.call(this,r$)||this).predicate=n$,r$.inclusive=i$,r$.index=0,r$}return O(t$,e$),t$.prototype._next=function(r$){var n$=this.destination;try{var i$=this.predicate(r$,this.index++)}catch(o$){return void n$.error(o$)}this.nextOrComplete(r$,i$)},t$.prototype.nextOrComplete=function(r$,n$){var i$=this.destination;n$?i$.next(r$):(this.inclusive&&i$.next(r$),i$.complete())},t$}(ia),It=function(){function e$(t$,r$,n$){this.nextOrObserver=t$,this.error=r$,this.complete=n$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Vz(t$,this.nextOrObserver,this.error,this.complete))},e$}(),Vz=function(e$){function t$(r$,n$,i$,o$){return(r$=e$.call(this,r$)||this)._tapNext=hc,r$._tapError=hc,r$._tapComplete=hc,r$._tapError=i$||hc,r$._tapComplete=o$||hc,le(n$)?(r$._context=r$,r$._tapNext=n$):n$&&(r$._context=n$,r$._tapNext=n$.next||hc,r$._tapError=n$.error||hc,r$._tapComplete=n$.complete||hc),r$}return O(t$,e$),t$.prototype._next=function(r$){try{this._tapNext.call(this._context,r$)}catch(n$){return void this.destination.error(n$)}this.destination.next(r$)},t$.prototype._error=function(r$){try{this._tapError.call(this._context,r$)}catch(n$){return void this.destination.error(n$)}this.destination.error(r$)},t$.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(r$){return void this.destination.error(r$)}return this.destination.complete()},t$}(ia),Kt={leading:!0,trailing:!1};(function(e$){function t$(r$,n$,i$,o$){var s$=e$.call(this,r$)||this;return s$.destination=r$,s$.durationSelector=n$,s$._leading=i$,s$._trailing=o$,s$._hasValue=!1,s$}O(t$,e$),t$.prototype._next=function(r$){this._hasValue=!0,this._sendValue=r$,this._throttled||(this._leading?this.send():this.throttle(r$))},t$.prototype.send=function(){var r$=this._sendValue;this._hasValue&&(this.destination.next(r$),this.throttle(r$)),this._hasValue=!1,this._sendValue=void 0},t$.prototype.throttle=function(r$){(r$=this.tryDurationSelector(r$))&&this.add(this._throttled=ic(r$,new vc(this)))},t$.prototype.tryDurationSelector=function(r$){try{return this.durationSelector(r$)}catch(n$){return this.destination.error(n$),null}},t$.prototype.throttlingDone=function(){var r$=this._throttled,n$=this._trailing;r$&&r$.unsubscribe(),this._throttled=void 0,n$&&this.send()},t$.prototype.notifyNext=function(){this.throttlingDone()},t$.prototype.notifyComplete=function(){this.throttlingDone()}})(wc);for(var Lt=function(){function e$(t$,r$,n$,i$){this.duration=t$,this.scheduler=r$,this.leading=n$,this.trailing=i$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Wz(t$,this.duration,this.scheduler,this.leading,this.trailing))},e$}(),Wz=function(e$){function t$(r$,n$,i$,o$,s$){return(r$=e$.call(this,r$)||this).duration=n$,r$.scheduler=i$,r$.leading=o$,r$.trailing=s$,r$._hasTrailingValue=!1,r$._trailingValue=null,r$}return O(t$,e$),t$.prototype._next=function(r$){this.throttled?this.trailing&&(this._trailingValue=r$,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Mt,this.duration,{subscriber:this})),this.leading?this.destination.next(r$):this.trailing&&(this._trailingValue=r$,this._hasTrailingValue=!0))},t$.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},t$.prototype.clearThrottle=function(){var r$=this.throttled;r$&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),r$.unsubscribe(),this.remove(r$),this.throttled=null)},t$}(ia),Ot=function(){function e$(t$,r$,n$,i$){this.waitFor=t$,this.absoluteTimeout=r$,this.withObservable=n$,this.scheduler=i$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Xz(t$,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e$}(),Xz=function(e$){function t$(r$,n$,i$,o$,s$){return(r$=e$.call(this,r$)||this).absoluteTimeout=n$,r$.waitFor=i$,r$.withObservable=o$,r$.scheduler=s$,r$.scheduleTimeout(),r$}return O(t$,e$),t$.dispatchTimeout=function(r$){var n$=r$.withObservable;r$._unsubscribeAndRecycle(),r$.add(ic(n$,new vc(r$)))},t$.prototype.scheduleTimeout=function(){var r$=this.action;r$?this.action=r$.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t$.dispatchTimeout,this.waitFor,this))},t$.prototype._next=function(r$){this.absoluteTimeout||this.scheduleTimeout(),e$.prototype._next.call(this,r$)},t$.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},t$}(wc),Qt=function(){function e$(t$,r$){this.observables=t$,this.project=r$}return e$.prototype.call=function(t$,r$){return r$.subscribe(new Yz(t$,this.observables,this.project))},e$}(),Yz=function(e$){function t$(r$,n$,i$){(r$=e$.call(this,r$)||this).observables=n$,r$.project=i$,r$.toRespond=[],i$=n$.length,r$.values=Array(i$);for(var o$=0;o$<i$;o$++)r$.toRespond.push(o$);for(o$=0;o$<i$;o$++)r$.add(ji(r$,n$[o$],void 0,o$));return r$}return O(t$,e$),t$.prototype.notifyNext=function(r$,n$,i$){this.values[i$]=n$,0<(r$=this.toRespond).length&&(i$=r$.indexOf(i$))!==-1&&r$.splice(i$,1)},t$.prototype.notifyComplete=function(){},t$.prototype._next=function(r$){this.toRespond.length===0&&(r$=[r$].concat(this.values),this.project?this._tryProject(r$):this.destination.next(r$))},t$.prototype._tryProject=function(r$){try{var n$=this.project.apply(this,r$)}catch(i$){return void this.destination.error(i$)}this.destination.next(n$)},t$}(Rk),Jq=$a(function(e$){var t$=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(t$){var r$=new Uint8Array(16);e$.exports=function(){return t$(r$),r$}}else{var n$=Array(16);e$.exports=function(){for(var i$,o$=0;16>o$;o$++)!(3&o$)&&(i$=4294967296*Math.random()),n$[o$]=i$>>>((3&o$)<<3)&255;return n$}}}),ab=[],Gh=0;256>Gh;++Gh)ab[Gh]=(Gh+256).toString(16).substr(1);var Kq=function(e$,t$){return t$=t$||0,[ab[e$[t$++]],ab[e$[t$++]],ab[e$[t$++]],ab[e$[t$++]],"-",ab[e$[t$++]],ab[e$[t$++]],"-",ab[e$[t$++]],ab[e$[t$++]],"-",ab[e$[t$++]],ab[e$[t$++]],"-",ab[e$[t$++]],ab[e$[t$++]],ab[e$[t$++]],ab[e$[t$++]],ab[e$[t$++]],ab[e$[t$++]]].join("")},Ud=function(e$,t$,r$){if(r$=t$&&r$||0,typeof e$=="string"&&(t$=e$==="binary"?Array(16):null,e$=null),(e$=(e$=e$||{}).random||(e$.rng||Jq)())[6]=15&e$[6]|64,e$[8]=63&e$[8]|128,t$)for(var n$=0;16>n$;++n$)t$[r$+n$]=e$[n$];return t$||Kq(e$)},gg=Ud(),Uk=!1,Pc,rd,Vk,Wk,sd,Vd,ec,We,Rb,Xk,Qc,Wd,Rc,Sc,Tc,Xe,Uc,Vc;(function(e$){e$[e$.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",e$[e$.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",e$[e$.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",e$[e$.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",e$[e$.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",e$[e$.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",e$[e$.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"})(Pc||(Pc={})),function(e$){e$[e$.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",e$[e$.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",e$[e$.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",e$[e$.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",e$[e$.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",e$[e$.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(rd||(rd={})),function(e$){e$[e$.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(Vk||(Vk={})),function(e$){e$[e$.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Wk||(Wk={})),function(e$){e$[e$.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",e$[e$.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",e$[e$.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",e$[e$.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",e$[e$.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",e$[e$.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(sd||(sd={})),function(e$){e$[e$.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",e$[e$.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",e$[e$.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",e$[e$.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",e$[e$.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(Vd||(Vd={})),function(e$){e$[e$.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",e$[e$.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",e$[e$.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",e$[e$.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",e$[e$.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",e$[e$.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",e$[e$.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",e$[e$.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",e$[e$.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",e$[e$.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",e$[e$.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(ec||(ec={})),function(e$){e$[e$.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",e$[e$.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",e$[e$.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",e$[e$.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(We||(We={})),function(e$){e$[e$.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",e$[e$.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",e$[e$.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",e$[e$.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",e$[e$.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",e$[e$.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",e$[e$.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",e$[e$.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",e$[e$.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",e$[e$.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",e$[e$.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(Rb||(Rb={})),function(e$){e$[e$.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Xk||(Xk={})),function(e$){e$[e$.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",e$[e$.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",e$[e$.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",e$[e$.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",e$[e$.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",e$[e$.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",e$[e$.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Qc||(Qc={})),function(e$){e$[e$.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",e$[e$.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",e$[e$.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",e$[e$.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",e$[e$.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(Wd||(Wd={})),function(e$){e$[e$.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",e$[e$.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",e$[e$.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",e$[e$.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",e$[e$.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",e$[e$.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",e$[e$.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",e$[e$.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(Rc||(Rc={})),function(e$){e$[e$.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",e$[e$.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",e$[e$.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",e$[e$.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",e$[e$.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",e$[e$.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",e$[e$.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(Sc||(Sc={})),function(e$){e$[e$.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",e$[e$.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",e$[e$.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",e$[e$.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",e$[e$.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",e$[e$.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",e$[e$.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(Tc||(Tc={})),function(e$){e$[e$.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",e$[e$.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",e$[e$.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",e$[e$.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(Xe||(Xe={})),function(e$){e$[e$.UPLOAD_MEDIA_ERR_FAILURE=1]="UPLOAD_MEDIA_ERR_FAILURE",e$[e$.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="UPLOAD_MEDIA_ERR_INVALID_ARGUMENT",e$[e$.UPLOAD_MEDIA_ERR_TIMEOUT=3]="UPLOAD_MEDIA_ERR_TIMEOUT",e$[e$.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW=4]="UPLOAD_MEDIA_ERR_SIZE_OVERFLOW",e$[e$.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e$[e$.UPLOAD_MEDIA_ERR_INTERRUPTED=6]="UPLOAD_MEDIA_ERR_INTERRUPTED",e$[e$.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="UPLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Uc||(Uc={})),function(e$){e$[e$.DOWNLOAD_MEDIA_ERR_FAILURE=1]="DOWNLOAD_MEDIA_ERR_FAILURE",e$[e$.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT",e$[e$.DOWNLOAD_MEDIA_ERR_TIMEOUT=3]="DOWNLOAD_MEDIA_ERR_TIMEOUT",e$[e$.DOWNLOAD_MEDIA_ERR_NOT_EXIST=4]="DOWNLOAD_MEDIA_ERR_NOT_EXIST",e$[e$.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e$[e$.DOWNLOAD_MEDIA_ERR_INTERRUPTED=6]="DOWNLOAD_MEDIA_ERR_INTERRUPTED",e$[e$.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Vc||(Vc={}));var Sb=Pc.ATTRIBUTE_OPERATION_ERR_FAILURE,Ja=Pc.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,se=Pc.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;Pc.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var Lq=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,Tb=Pc.ATTRIBUTE_OPERATION_ERR_TIMEOUT,Ub=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,hg=rd.CHANNEL_MESSAGE_ERR_FAILURE,Yk=rd.CHANNEL_MESSAGE_ERR_TIMEOUT,Mq=rd.CHANNEL_MESSAGE_ERR_TOO_OFTEN,Hh=rd.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE;rd.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL;var ig=rd.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,Zz=Vk.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Nq=Wk.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var Oq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var Pq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,$z=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var aA=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,bA=sd.GET_MEMBERS_ERR_FAILURE,cA=sd.GET_MEMBERS_ERR_REJECTED;sd.GET_MEMBERS_ERR_TIMEOUT,sd.GET_MEMBERS_ERR_TOO_OFTEN;var dA=sd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,eA=sd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,xc=Vd.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,fA=Vd.INVITATION_API_CALL_ERR_NOT_STARTED,Ih=Vd.INVITATION_API_CALL_ERR_ALREADY_END,Qq=Vd.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,gA=Vd.INVITATION_API_CALL_ERR_ALREADY_SENT,Rq=ec.JOIN_CHANNEL_ERR_FAILURE;ec.JOIN_CHANNEL_ERR_REJECTED;var hA=ec.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Sq=ec.JOIN_CHANNEL_TIMEOUT,Tq=ec.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Uq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED;ec.JOIN_CHANNEL_ERR_TOO_OFTEN;var Vq=ec.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Wq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Xq=We.LEAVE_CHANNEL_ERR_FAILURE,Yq=We.LEAVE_CHANNEL_ERR_REJECTED,iA=We.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,jA=We.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,Zq=Rb.LOGIN_ERR_UNKNOWN,jg=Rb.LOGIN_ERR_REJECTED,Jh=Rb.LOGIN_ERR_INVALID_ARGUMENT,$q=Rb.LOGIN_ERR_INVALID_APP_ID,ar=Rb.LOGIN_ERR_INVALID_TOKEN,Kh=Rb.LOGIN_ERR_TOKEN_EXPIRED;Rb.LOGIN_ERR_NOT_AUTHORIZED;var kA=Rb.LOGIN_ERR_ALREADY_LOGIN,lA=Rb.LOGIN_ERR_TIMEOUT,mA=Rb.LOGIN_ERR_TOO_OFTEN,br=Xk.LOGOUT_ERR_USER_NOT_LOGGED_IN,cr=Qc.PEER_MESSAGE_ERR_FAILURE,Zk=Qc.PEER_MESSAGE_ERR_TIMEOUT,dr=Qc.PEER_MESSAGE_ERR_TOO_OFTEN,$k=Qc.PEER_MESSAGE_ERR_INVALID_USERID,ve=Qc.PEER_MESSAGE_ERR_INVALID_MESSAGE,al=Qc.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,nA=Qc.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE,er=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var oA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var pA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,qA=Rc.RENEW_TOKEN_ERR_FAILURE,rA=Rc.RENEW_TOKEN_ERR_INVALID_ARGUMENT;Rc.RENEW_TOKEN_ERR_REJECTED,Rc.RENEW_TOKEN_ERR_TOO_OFTEN;var sA=Rc.RENEW_TOKEN_ERR_TOKEN_EXPIRED,tA=Rc.RENEW_TOKEN_ERR_INVALID_TOKEN,uA=Rc.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,fr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,kg=Tc.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var vA=Tc.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var gr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,bl=Tc.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var lg=Uc.UPLOAD_MEDIA_ERR_FAILURE,wf=Uc.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT,Lh=Uc.UPLOAD_MEDIA_ERR_TIMEOUT,wA=Uc.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW,xA=Uc.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,hr=Uc.UPLOAD_MEDIA_ERR_INTERRUPTED,yA=Uc.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN,mg=Vc.DOWNLOAD_MEDIA_ERR_FAILURE,cl=Vc.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT,zA=Vc.DOWNLOAD_MEDIA_ERR_TIMEOUT,AA=Vc.DOWNLOAD_MEDIA_ERR_NOT_EXIST,BA=Vc.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,ir=Vc.DOWNLOAD_MEDIA_ERR_INTERRUPTED,CA=Vc.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN,DA=function(e$,t$){var r$;return Hk(e$,function(n$,i$,o$){return!(r$=t$(n$,i$,o$))}),!!r$},Mh=function(e$,t$,r$){if(!lb(r$))return!1;var n$=X(t$);return!!(n$=="number"?Ed(r$)&&wk(t$,r$.length):n$=="string"&&t$ in r$)&&$f(r$[t$],e$)},dl=function(e$,t$,r$){var n$=Va(e$)?tq:DA;return n$(e$,Te(t$))},EA=function(e$,t$){var r$=-1,n$=Ed(e$)?Array(e$.length):[];return Hk(e$,function(i$,o$,s$){n$[++r$]=t$(i$,o$,s$)}),n$},FA=function(e$,t$){var r$=e$.length;for(e$.sort(t$);r$--;)e$[r$]=e$[r$].value;return e$},GA=function(e$,t$,r$){t$=t$.length?he(t$,function(i$){return Va(i$)?function(o$){return Ch(o$,i$.length===1?i$[0]:i$)}:i$}):[Dh];var n$=-1;return t$=he(t$,zh(Te)),e$=EA(e$,function(i$,o$,s$){return{criteria:he(t$,function(a$){return a$(i$)}),index:++n$,value:i$}}),FA(e$,function(i$,o$){e:{for(var s$=-1,a$=i$.criteria,c$=o$.criteria,u$=a$.length,l$=r$.length;++s$<u$;){t:{var d$=a$[s$],h$=c$[s$];if(d$!==h$){var p$=d$!==void 0,_$=d$===null,f$=d$==d$,m$=ie(d$),g$=h$!==void 0,v$=h$===null,y$=h$==h$,S$=ie(h$);if(!v$&&!S$&&!m$&&d$>h$||m$&&g$&&y$&&!v$&&!S$||_$&&g$&&y$||!p$&&y$||!f$){d$=1;break t}if(!_$&&!m$&&!S$&&d$<h$||S$&&p$&&f$&&!_$&&!m$||v$&&p$&&f$||!g$&&f$||!y$){d$=-1;break t}}d$=0}if(d$){i$=s$>=l$?d$:d$*(r$[s$]=="desc"?-1:1);break e}}i$=i$.index-o$.index}return i$})},jr=function(e$,t$){return rq(qq(e$,t$,Dh),e$+"")},kr=jr(function(e$,t$){if(e$==null)return[];var r$=t$.length;return 1<r$&&Mh(e$,t$[0],t$[1])?t$=[]:2<r$&&Mh(t$[0],t$[1],t$[2])&&(t$=[t$[0]]),GA(e$,$h(t$),[])}),lr=function(e$){if(e$.__esModule)return e$;var t$=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e$).forEach(function(r$){var n$=Object.getOwnPropertyDescriptor(e$,r$);Object.defineProperty(t$,r$,n$.get?n$:{enumerable:!0,get:function(){return e$[r$]}})}),t$}(Dz),mr=$a(function(e$,t$){Object.defineProperty(t$,"__esModule",{value:!0});var r$=[],n$=function(i$,o$){return new WebSocket(i$,o$)};t$.normalClosureMessage="Normal closure",t$.default=function(i$,o$){var s$=(o$=o$===void 0?{protocols:r$,makeWebSocket:n$}:o$).protocols,a$=s$===void 0?r$:s$,c$=(o$=o$.makeWebSocket)===void 0?n$:o$;return new lr.Observable(function(u$){var l$,d$=new lr.Subject,h$=c$(i$,a$),p$=!1,_$=!1,f$=function(m$){if(l$)throw p$=!0,m$=Error("Web socket message factory function called more than once"),u$.error(m$),m$;return l$=m$.subscribe(function(g$){h$.send(g$)}),d$};return h$.onopen=function(){_$?(p$=!0,h$.close()):u$.next(f$)},h$.onmessage=function(m$){d$.next(m$.data)},h$.onerror=function(m$){p$=!0,u$.error(Error(m$.message))},h$.onclose=function(m$){p$||(p$=!0,_$?(u$.complete(),d$.complete()):u$.error(Error(m$.code===1e3?t$.normalClosureMessage:m$.reason)))},function(){_$=!0,l$&&l$.unsubscribe(),p$||(p$=!0,h$.close())}})}});(function(e$){e$&&e$.__esModule&&Object.prototype.hasOwnProperty.call(e$,"default")&&e$.default})(mr);var pi=function(e$,t$,r$){(r$===void 0||$f(e$[t$],r$))&&(r$!==void 0||t$ in e$)||bg(e$,t$,r$)},oi=function(e$,t$){if((t$!=="constructor"||typeof e$[t$]!="function")&&t$!="__proto__")return e$[t$]},HA=function(e$){return jr(function(t$,r$){var n$=-1,i$=r$.length,o$=1<i$?r$[i$-1]:void 0,s$=2<i$?r$[2]:void 0;for(o$=3<e$.length&&typeof o$=="function"?(i$--,o$):void 0,s$&&Mh(r$[0],r$[1],s$)&&(o$=3>i$?void 0:o$,i$=1),t$=Object(t$);++n$<i$;)(s$=r$[n$])&&e$(t$,s$,n$,o$);return t$})}(function(e$,t$,r$,n$){tm(e$,t$,r$,n$)}),IA=Math.floor,JA=Math.random,nr=function(e$,t$){return e$+IA(JA()*(t$-e$+1))},or=function(e$){var t$=e$.length;return t$?e$[nr(0,t$-1)]:void 0},KA=function(e$,t$){return he(t$,function(r$){return e$[r$]})},Ni=function(e$){return e$==null?[]:KA(e$,Ad(e$))},LA=function(e$){return or(Ni(e$))},bn=function(e$){return(Va(e$)?or:LA)(e$)},xm=[],ym=function(e$,t$){return new WebSocket(e$,t$)},MA=Math.floor;N({target:"Number",stat:!0},{isInteger:function(e$){return!ha(e$)&&isFinite(e$)&&MA(e$)===e$}}),Oo("from",Ej,Dj);var NA=function(e$,t$){for(var r$=Array(arguments.length-1),n$=0,i$=2,o$=!0;i$<arguments.length;)r$[n$++]=arguments[i$++];return new Promise(function(s$,a$){r$[n$]=function(c$){if(o$)if(o$=!1,c$)a$(c$);else{for(var u$=Array(arguments.length-1),l$=0;l$<u$.length;)u$[l$++]=arguments[l$];s$.apply(null,u$)}};try{e$.apply(t$||null,r$)}catch(c$){o$&&(o$=!1,a$(c$))}})},OA=$a(function(e$,t$){t$.length=function(i$){var o$=i$.length;if(!o$)return 0;for(var s$=0;1<--o$%4&&i$.charAt(o$)==="=";)++s$;return Math.ceil(3*i$.length)/4-s$};var r$=Array(64),n$=Array(123);for(e$=0;64>e$;)n$[r$[e$]=26>e$?e$+65:52>e$?e$+71:62>e$?e$-4:e$-59|43]=e$++;t$.encode=function(i$,o$,s$){for(var a$,c$=null,u$=[],l$=0,d$=0;o$<s$;){var h$=i$[o$++];switch(d$){case 0:u$[l$++]=r$[h$>>2],a$=(3&h$)<<4,d$=1;break;case 1:u$[l$++]=r$[a$|h$>>4],a$=(15&h$)<<2,d$=2;break;case 2:u$[l$++]=r$[a$|h$>>6],u$[l$++]=r$[63&h$],d$=0}8191<l$&&((c$||(c$=[])).push(String.fromCharCode.apply(String,u$)),l$=0)}return d$&&(u$[l$++]=r$[a$],u$[l$++]=61,d$===1&&(u$[l$++]=61)),c$?(l$&&c$.push(String.fromCharCode.apply(String,u$.slice(0,l$))),c$.join("")):String.fromCharCode.apply(String,u$.slice(0,l$))},t$.decode=function(i$,o$,s$){for(var a$,c$=s$,u$=0,l$=0;l$<i$.length;){var d$=i$.charCodeAt(l$++);if(d$===61&&1<u$)break;if((d$=n$[d$])===void 0)throw Error("invalid encoding");switch(u$){case 0:a$=d$,u$=1;break;case 1:o$[s$++]=a$<<2|(48&d$)>>4,a$=d$,u$=2;break;case 2:o$[s$++]=(15&a$)<<4|(60&d$)>>2,a$=d$,u$=3;break;case 3:o$[s$++]=(3&a$)<<6|d$,u$=0}}if(u$===1)throw Error("invalid encoding");return s$-c$},t$.test=function(i$){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(i$)}});yg.prototype.on=function(e$,t$,r$){return(this._listeners[e$]||(this._listeners[e$]=[])).push({fn:t$,ctx:r$||this}),this},yg.prototype.off=function(e$,t$){if(e$===void 0)this._listeners={};else if(t$===void 0)this._listeners[e$]=[];else{e$=this._listeners[e$];for(var r$=0;r$<e$.length;)e$[r$].fn===t$?e$.splice(r$,1):++r$}return this},yg.prototype.emit=function(e$){var t$=this._listeners[e$];if(t$){for(var r$=[],n$=1;n$<arguments.length;)r$.push(arguments[n$++]);for(n$=0;n$<t$.length;)t$[n$].fn.apply(t$[n$++].ctx,r$)}return this};var PA=zm(zm),QA=function(c){try{var a=eval("quire".replace(/^/,"re"))(c);if(a&&(a.length||Object.keys(a).length))return a}catch(e$){}return null},RA=$a(function(e$,t$){t$.length=function(r$){for(var n$,i$=0,o$=0;o$<r$.length;++o$)128>(n$=r$.charCodeAt(o$))?i$+=1:2048>n$?i$+=2:(64512&n$)==55296&&(64512&r$.charCodeAt(o$+1))==56320?(++o$,i$+=4):i$+=3;return i$},t$.read=function(r$,n$,i$){if(1>i$-n$)return"";for(var o$,s$=null,a$=[],c$=0;n$<i$;)128>(o$=r$[n$++])?a$[c$++]=o$:191<o$&&224>o$?a$[c$++]=(31&o$)<<6|63&r$[n$++]:239<o$&&365>o$?(o$=((7&o$)<<18|(63&r$[n$++])<<12|(63&r$[n$++])<<6|63&r$[n$++])-65536,a$[c$++]=55296+(o$>>10),a$[c$++]=56320+(1023&o$)):a$[c$++]=(15&o$)<<12|(63&r$[n$++])<<6|63&r$[n$++],8191<c$&&((s$||(s$=[])).push(String.fromCharCode.apply(String,a$)),c$=0);return s$?(c$&&s$.push(String.fromCharCode.apply(String,a$.slice(0,c$))),s$.join("")):String.fromCharCode.apply(String,a$.slice(0,c$))},t$.write=function(r$,n$,i$){for(var o$,s$,a$=i$,c$=0;c$<r$.length;++c$)128>(o$=r$.charCodeAt(c$))?n$[i$++]=o$:(2048>o$?n$[i$++]=o$>>6|192:((64512&o$)==55296&&(64512&(s$=r$.charCodeAt(c$+1)))==56320?(o$=65536+((1023&o$)<<10)+(1023&s$),++c$,n$[i$++]=o$>>18|240,n$[i$++]=o$>>12&63|128):n$[i$++]=o$>>12|224,n$[i$++]=o$>>6&63|128),n$[i$++]=63&o$|128);return i$-a$}}),SA=function(e$,t$,r$){var n$=r$||8192,i$=n$>>>1,o$=null,s$=n$;return function(a$){return 1>a$||a$>i$?e$(a$):(s$+a$>n$&&(o$=e$(n$),s$=0),a$=t$.call(o$,s$,s$+=a$),7&s$&&(s$=1+(7|s$)),a$)}},Xd=Wa.zero=new Wa(0,0);Xd.toNumber=function(){return 0},Xd.zzEncode=Xd.zzDecode=function(){return this},Xd.length=function(){return 1};var TA=Wa.zeroHash="\0\0\0\0\0\0\0\0";Wa.fromNumber=function(e$){if(e$===0)return Xd;var t$=0>e$;t$&&(e$=-e$);var r$=e$>>>0;return e$=(e$-r$)/4294967296>>>0,t$&&(e$=~e$>>>0,r$=~r$>>>0,4294967295<++r$&&(r$=0,4294967295<++e$&&(e$=0))),new Wa(r$,e$)},Wa.from=function(e$){if(typeof e$=="number")return Wa.fromNumber(e$);if(V.isString(e$)){if(!V.Long)return Wa.fromNumber(parseInt(e$,10));e$=V.Long.fromString(e$)}return e$.low||e$.high?new Wa(e$.low>>>0,e$.high>>>0):Xd},Wa.prototype.toNumber=function(e$){if(!e$&&this.hi>>>31){e$=1+~this.lo>>>0;var t$=~this.hi>>>0;return e$||(t$=t$+1>>>0),-(e$+4294967296*t$)}return this.lo+4294967296*this.hi},Wa.prototype.toLong=function(e$){return V.Long?new V.Long(0|this.lo,0|this.hi,!!e$):{low:0|this.lo,high:0|this.hi,unsigned:!!e$}};var td=String.prototype.charCodeAt;Wa.fromHash=function(e$){return e$===TA?Xd:new Wa((td.call(e$,0)|td.call(e$,1)<<8|td.call(e$,2)<<16|td.call(e$,3)<<24)>>>0,(td.call(e$,4)|td.call(e$,5)<<8|td.call(e$,6)<<16|td.call(e$,7)<<24)>>>0)},Wa.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Wa.prototype.zzEncode=function(){var e$=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e$)>>>0,this.lo=(this.lo<<1^e$)>>>0,this},Wa.prototype.zzDecode=function(){var e$=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e$)>>>0,this.hi=(this.hi>>>1^e$)>>>0,this},Wa.prototype.length=function(){var e$=this.lo,t$=(this.lo>>>28|this.hi<<4)>>>0,r$=this.hi>>>24;return r$===0?t$===0?16384>e$?128>e$?1:2:2097152>e$?3:4:16384>t$?128>t$?5:6:2097152>t$?7:8:128>r$?9:10};var V=$a(function(e$,t$){function r$(i$,o$,s$){for(var a$=Object.keys(o$),c$=0;c$<a$.length;++c$)i$[a$[c$]]!==void 0&&s$||(i$[a$[c$]]=o$[a$[c$]]);return i$}function n$(i$){function o$(s$,a$){if(!(this instanceof o$))return new o$(s$,a$);Object.defineProperty(this,"message",{get:function(){return s$}}),Error.captureStackTrace?Error.captureStackTrace(this,o$):Object.defineProperty(this,"stack",{value:Error().stack||""}),a$&&r$(this,a$)}return(o$.prototype=Object.create(Error.prototype)).constructor=o$,Object.defineProperty(o$.prototype,"name",{get:function(){return i$}}),o$.prototype.toString=function(){return this.name+": "+this.message},o$}t$.asPromise=NA,t$.base64=OA,t$.EventEmitter=yg,t$.float=PA,t$.inquire=QA,t$.utf8=RA,t$.pool=SA,t$.LongBits=Wa,t$.isNode=!!(Ya!==void 0&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),t$.global=t$.isNode&&Ya||typeof window<"u"&&window||typeof self<"u"&&self||Ya,t$.emptyArray=Object.freeze?Object.freeze([]):[],t$.emptyObject=Object.freeze?Object.freeze({}):{},t$.isInteger=Number.isInteger||function(i$){return typeof i$=="number"&&isFinite(i$)&&Math.floor(i$)===i$},t$.isString=function(i$){return typeof i$=="string"||i$ instanceof String},t$.isObject=function(i$){return i$&&X(i$)==="object"},t$.isset=t$.isSet=function(i$,o$){var s$=i$[o$];return!(s$==null||!i$.hasOwnProperty(o$))&&(X(s$)!=="object"||0<(Array.isArray(s$)?s$.length:Object.keys(s$).length))},t$.Buffer=function(){try{var i$=t$.inquire("buffer").Buffer;return i$.prototype.utf8Write?i$:null}catch{return null}}(),t$._Buffer_from=null,t$._Buffer_allocUnsafe=null,t$.newBuffer=function(i$){return typeof i$=="number"?t$.Buffer?t$._Buffer_allocUnsafe(i$):new t$.Array(i$):t$.Buffer?t$._Buffer_from(i$):typeof Uint8Array>"u"?i$:new Uint8Array(i$)},t$.Array=typeof Uint8Array<"u"?Uint8Array:Array,t$.Long=t$.global.dcodeIO&&t$.global.dcodeIO.Long||t$.global.Long||t$.inquire("long"),t$.key2Re=/^true|false|0|1$/,t$.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t$.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t$.longToHash=function(i$){return i$?t$.LongBits.from(i$).toHash():t$.LongBits.zeroHash},t$.longFromHash=function(i$,o$){return i$=t$.LongBits.fromHash(i$),t$.Long?t$.Long.fromBits(i$.lo,i$.hi,o$):i$.toNumber(!!o$)},t$.merge=r$,t$.lcFirst=function(i$){return i$.charAt(0).toLowerCase()+i$.substring(1)},t$.newError=n$,t$.ProtocolError=n$("ProtocolError"),t$.oneOfGetter=function(i$){for(var o$={},s$=0;s$<i$.length;++s$)o$[i$[s$]]=1;return function(){for(var a$=Object.keys(this),c$=a$.length-1;-1<c$;--c$)if(o$[a$[c$]]===1&&this[a$[c$]]!==void 0&&this[a$[c$]]!==null)return a$[c$]}},t$.oneOfSetter=function(i$){return function(o$){for(var s$=0;s$<i$.length;++s$)i$[s$]!==o$&&delete this[i$[s$]]}},t$.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t$._configure=function(){var i$=t$.Buffer;i$?(t$._Buffer_from=i$.from!==Uint8Array.from&&i$.from||function(o$,s$){return new i$(o$,s$)},t$._Buffer_allocUnsafe=i$.allocUnsafe||function(o$){return new i$(o$)}):t$._Buffer_from=t$._Buffer_allocUnsafe=null}}),xi=ja,el,Nh=V.LongBits,pr=V.base64,qr=V.utf8,rr=function(){return V.Buffer?function(){return(ja.create=function(){return new el})()}:function(){return new ja}};ja.create=rr(),ja.alloc=function(e$){return new V.Array(e$)},V.Array!==Array&&(ja.alloc=V.pool(ja.alloc,V.Array.prototype.subarray)),ja.prototype._push=function(e$,t$,r$){return this.tail=this.tail.next=new sf(e$,t$,r$),this.len+=t$,this},ui.prototype=Object.create(sf.prototype),ui.prototype.fn=function(e$,t$,r$){for(;127<e$;)t$[r$++]=127&e$|128,e$>>>=7;t$[r$]=e$},ja.prototype.uint32=function(e$){return this.len+=(this.tail=this.tail.next=new ui(128>(e$>>>=0)?1:16384>e$?2:2097152>e$?3:268435456>e$?4:5,e$)).len,this},ja.prototype.int32=function(e$){return 0>e$?this._push(vi,10,Nh.fromNumber(e$)):this.uint32(e$)},ja.prototype.sint32=function(e$){return this.uint32((e$<<1^e$>>31)>>>0)},ja.prototype.uint64=function(e$){return e$=Nh.from(e$),this._push(vi,e$.length(),e$)},ja.prototype.int64=ja.prototype.uint64,ja.prototype.sint64=function(e$){return e$=Nh.from(e$).zzEncode(),this._push(vi,e$.length(),e$)},ja.prototype.bool=function(e$){return this._push(ti,1,e$?1:0)},ja.prototype.fixed32=function(e$){return this._push(wi,4,e$>>>0)},ja.prototype.sfixed32=ja.prototype.fixed32,ja.prototype.fixed64=function(e$){return e$=Nh.from(e$),this._push(wi,4,e$.lo)._push(wi,4,e$.hi)},ja.prototype.sfixed64=ja.prototype.fixed64,ja.prototype.float=function(e$){return this._push(V.float.writeFloatLE,4,e$)},ja.prototype.double=function(e$){return this._push(V.float.writeDoubleLE,8,e$)};var UA=V.Array.prototype.set?function(e$,t$,r$){t$.set(e$,r$)}:function(e$,t$,r$){for(var n$=0;n$<e$.length;++n$)t$[r$+n$]=e$[n$]};ja.prototype.bytes=function(e$){var t$=e$.length>>>0;if(!t$)return this._push(ti,1,0);if(V.isString(e$)){var r$=ja.alloc(t$=pr.length(e$));pr.decode(e$,r$,0),e$=r$}return this.uint32(t$)._push(UA,t$,e$)},ja.prototype.string=function(e$){var t$=qr.length(e$);return t$?this.uint32(t$)._push(qr.write,t$,e$):this._push(ti,1,0)},ja.prototype.fork=function(){return this.states=new Tt(this),this.head=this.tail=new sf(si,0,0),this.len=0,this},ja.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new sf(si,0,0),this.len=0),this},ja.prototype.ldelim=function(){var e$=this.head,t$=this.tail,r$=this.len;return this.reset().uint32(r$),r$&&(this.tail.next=e$.next,this.tail=t$,this.len+=r$),this},ja.prototype.finish=function(){for(var e$=this.head.next,t$=this.constructor.alloc(this.len),r$=0;e$;)e$.fn(e$.val,t$,r$),r$+=e$.len,e$=e$.next;return t$},ja._configure=function(e$){el=e$,ja.create=rr(),el._configure()},(jc.prototype=Object.create(xi.prototype)).constructor=jc,jc._configure=function(){jc.alloc=V._Buffer_allocUnsafe,jc.writeBytesBuffer=V.Buffer&&V.Buffer.prototype instanceof Uint8Array&&V.Buffer.prototype.set.name==="set"?function(e$,t$,r$){t$.set(e$,r$)}:function(e$,t$,r$){if(e$.copy)e$.copy(t$,r$,0,e$.length);else for(var n$=0;n$<e$.length;)t$[r$++]=e$[n$++]}},jc.prototype.bytes=function(e$){V.isString(e$)&&(e$=V._Buffer_from(e$,"base64"));var t$=e$.length>>>0;return this.uint32(t$),t$&&this._push(jc.writeBytesBuffer,t$,e$),this},jc.prototype.string=function(e$){var t$=V.Buffer.byteLength(e$);return this.uint32(t$),t$&&this._push(Ut,t$,e$),this},jc._configure();var zi=La,fl,Em=V.LongBits,VA=V.utf8,sr=typeof Uint8Array<"u"?function(e$){if(e$ instanceof Uint8Array||Array.isArray(e$))return new La(e$);throw Error("illegal buffer")}:function(e$){if(Array.isArray(e$))return new La(e$);throw Error("illegal buffer")},tr=function(){return V.Buffer?function(e$){return(La.create=function(t$){return V.Buffer.isBuffer(t$)?new fl(t$):sr(t$)})(e$)}:sr};La.create=tr(),La.prototype._slice=V.Array.prototype.subarray||V.Array.prototype.slice,La.prototype.uint32=function(){var e$=4294967295;return function(){if(e$=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++]||(e$=(e$|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])||(e$=(e$|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])||(e$=(e$|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])||(e$=(e$|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++]))return e$;if((this.pos+=5)>this.len)throw this.pos=this.len,Yb(this,10);return e$}}(),La.prototype.int32=function(){return 0|this.uint32()},La.prototype.sint32=function(){var e$=this.uint32();return e$>>>1^-(1&e$)|0},La.prototype.bool=function(){return this.uint32()!==0},La.prototype.fixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return zg(this.buf,this.pos+=4)},La.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return 0|zg(this.buf,this.pos+=4)},La.prototype.float=function(){if(this.pos+4>this.len)throw Yb(this,4);var e$=V.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e$},La.prototype.double=function(){if(this.pos+8>this.len)throw Yb(this,4);var e$=V.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e$},La.prototype.bytes=function(){var e$=this.uint32(),t$=this.pos,r$=this.pos+e$;if(r$>this.len)throw Yb(this,e$);return this.pos+=e$,Array.isArray(this.buf)?this.buf.slice(t$,r$):t$===r$?new this.buf.constructor(0):this._slice.call(this.buf,t$,r$)},La.prototype.string=function(){var e$=this.bytes();return VA.read(e$,0,e$.length)},La.prototype.skip=function(e$){if(typeof e$=="number"){if(this.pos+e$>this.len)throw Yb(this,e$);this.pos+=e$}else do if(this.pos>=this.len)throw Yb(this);while(128&this.buf[this.pos++]);return this},La.prototype.skipType=function(e$){switch(e$){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e$=7&this.uint32())!=4;)this.skipType(e$);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e$+" at offset "+this.pos)}return this},La._configure=function(e$){fl=e$,La.create=tr(),fl._configure();var t$=V.Long?"toLong":"toNumber";V.merge(La.prototype,{int64:function(){return yi.call(this)[t$](!1)},uint64:function(){return yi.call(this)[t$](!0)},sint64:function(){return yi.call(this).zzDecode()[t$](!1)},fixed64:function(){return Fm.call(this)[t$](!0)},sfixed64:function(){return Fm.call(this)[t$](!1)}})},(Fd.prototype=Object.create(zi.prototype)).constructor=Fd,Fd._configure=function(){V.Buffer&&(Fd.prototype._slice=V.Buffer.prototype.slice)},Fd.prototype.string=function(){var e$=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e$,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e$,this.len))},Fd._configure(),(tf.prototype=Object.create(V.EventEmitter.prototype)).constructor=tf,tf.prototype.rpcCall=function e$(t$,r$,n$,i$,o$){if(!i$)throw TypeError("request must be specified");var s$=this;if(!o$)return V.asPromise(e$,s$,t$,r$,n$,i$);if(s$.rpcImpl)try{return s$.rpcImpl(t$,r$[s$.requestDelimited?"encodeDelimited":"encode"](i$).finish(),function(a$,c$){if(a$)return s$.emit("error",a$,t$),o$(a$);if(c$!==null){if(!(c$ instanceof n$))try{c$=n$[s$.responseDelimited?"decodeDelimited":"decode"](c$)}catch(u$){return s$.emit("error",u$,t$),o$(u$)}return s$.emit("data",c$,t$),o$(null,c$)}s$.end(!0)})}catch(a$){s$.emit("error",a$,t$),setTimeout(function(){o$(a$)},0)}else setTimeout(function(){o$(Error("already ended"))},0)},tf.prototype.end=function(e$){return this.rpcImpl&&(e$||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var WA=$a(function(e$,t$){t$.Service=tf}),XA={},fc=$a(function(e$,t$){function r$(){n$.util._configure(),n$.Writer._configure(n$.BufferWriter),n$.Reader._configure(n$.BufferReader)}var n$=t$;n$.build="minimal",n$.Writer=xi,n$.BufferWriter=jc,n$.Reader=zi,n$.BufferReader=Fd,n$.util=V,n$.rpc=WA,n$.roots=XA,n$.configure=r$,r$()});fc.util.Long=U,fc.configure();var u=fc.Reader,L=fc.Writer,q=fc.util,t=fc.roots.default||(fc.roots.default={}),YA=t.URI=function(){var e$={},t$=Object.create(e$);return t$[e$[0]="Unknown"]=0,t$[e$[1]="PingUri"]=1,t$[e$[2]="PongUri"]=2,t$[e$[11]="UserJoinUri"]=11,t$[e$[12]="UserRespUri"]=12,t$[e$[21]="UserQuitUri"]=21,t$[e$[22]="UserDropUri"]=22,t$[e$[31]="GroupEnterUri"]=31,t$[e$[32]="GroupLeaveUri"]=32,t$[e$[33]="GroupReplyUri"]=33,t$[e$[36]="GroupEnterNoticeUri"]=36,t$[e$[37]="GroupLeaveNoticeUri"]=37,t$[e$[38]="GroupEventNoticeUri"]=38,t$[e$[39]="GroupCountNoticeUri"]=39,t$[e$[41]="UserStatusListUri"]=41,t$[e$[42]="UserStatusResultUri"]=42,t$[e$[51]="GroupStatusListUri"]=51,t$[e$[52]="GroupStatusResultUri"]=52,t$[e$[55]="GroupAllUsersListUri"]=55,t$[e$[56]="GroupAllUsersResultUri"]=56,t$[e$[100]="MessageUri"]=100,t$[e$[101]="AckUri"]=101,t$[e$[115]="FileUploadIndexGetUri"]=115,t$[e$[116]="FileUploadIndexRetUri"]=116,t$[e$[117]="FileUploadIndexSetUri"]=117,t$[e$[118]="FileUploadIndexFinUri"]=118,t$[e$[119]="FileUploadIndexErrUri"]=119,t$[e$[125]="FileDownloadIndexGetUri"]=125,t$[e$[126]="FileDownloadIndexRetUri"]=126,t$[e$[127]="FileDownloadIndexErrUri"]=127,t$[e$[201]="UserJoinNoticeUri"]=201,t$[e$[202]="UserQuitNoticeUri"]=202,t$[e$[203]="UserWaitNoticeUri"]=203,t$[e$[301]="UserAttributeGetUri"]=301,t$[e$[302]="UserAttributeRetUri"]=302,t$[e$[303]="UserAttributeSetUri"]=303,t$[e$[304]="UserAttributeModUri"]=304,t$[e$[305]="UserAttributeDelUri"]=305,t$[e$[307]="UserAttributeRspUri"]=307,t$[e$[308]="UserAttributeErrUri"]=308,t$[e$[311]="UserAttributeKeysGetUri"]=311,t$[e$[312]="UserAttributeKeysRetUri"]=312,t$[e$[351]="GroupAttributeGetUri"]=351,t$[e$[352]="GroupAttributeRetUri"]=352,t$[e$[353]="GroupAttributeSetUri"]=353,t$[e$[354]="GroupAttributeModUri"]=354,t$[e$[355]="GroupAttributeDelUri"]=355,t$[e$[356]="GroupAttributeAltUri"]=356,t$[e$[357]="GroupAttributeRspUri"]=357,t$[e$[358]="GroupAttributeErrUri"]=358,t$[e$[361]="GroupAttributeKeysGetUri"]=361,t$[e$[362]="GroupAttributeKeysRetUri"]=362,t$[e$[401]="SubscribeUserStatusUri"]=401,t$[e$[402]="UnsubscribeUserStatusUri"]=402,t$[e$[499]="SubscribeResponseUri"]=499,t$}(),Oh=t.Wrapper=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.uri=0,e$.prototype.data=q.newBuffer([]),e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.uri!=null&&Object.hasOwnProperty.call(t$,"uri")&&r$.uint32(8).int32(t$.uri),t$.data!=null&&Object.hasOwnProperty.call(t$,"data")&&r$.uint32(18).bytes(t$.data),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.Wrapper;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.uri=t$.int32();break;case 2:n$.data=t$.bytes();break;default:t$.skipType(7&i$)}}return n$},e$}(),ZA=t.Ping=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.ms!=null&&Object.hasOwnProperty.call(t$,"ms")&&r$.uint32(16).uint64(t$.ms),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.Ping;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.ms=t$.uint64();break;default:t$.skipType(7&i$)}}return n$},e$}(),$A=t.Pong=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.ms!=null&&Object.hasOwnProperty.call(t$,"ms")&&r$.uint32(16).uint64(t$.ms),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.Pong;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.ms=t$.uint64();break;default:t$.skipType(7&i$)}}return n$},e$}(),aB=t.UserJoin=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.opt=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.account="",e$.prototype.ticket="",e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.opt!=null&&Object.hasOwnProperty.call(t$,"opt")&&r$.uint32(16).uint64(t$.opt),t$.instance!=null&&Object.hasOwnProperty.call(t$,"instance")&&r$.uint32(24).uint64(t$.instance),t$.account!=null&&Object.hasOwnProperty.call(t$,"account")&&r$.uint32(34).string(t$.account),t$.ticket!=null&&Object.hasOwnProperty.call(t$,"ticket")&&r$.uint32(42).string(t$.ticket),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserJoin;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.opt=t$.uint64();break;case 3:n$.instance=t$.uint64();break;case 4:n$.account=t$.string();break;case 5:n$.ticket=t$.string();break;default:t$.skipType(7&i$)}}return n$},e$}(),bB=t.UserResp=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.account="",e$.prototype.code=0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.account!=null&&Object.hasOwnProperty.call(t$,"account")&&r$.uint32(18).string(t$.account),t$.code!=null&&Object.hasOwnProperty.call(t$,"code")&&r$.uint32(24).uint32(t$.code),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserResp;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.account=t$.string();break;case 3:n$.code=t$.uint32();break;default:t$.skipType(7&i$)}}return n$},e$}(),cB=t.UserQuit=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.encode=function(t$,r$){return r$||(r$=L.create()),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserQuit;t$.pos<r$;){var i$=t$.uint32();t$.skipType(7&i$)}return n$},e$}(),dB=t.UserDrop=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.code=0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.code!=null&&Object.hasOwnProperty.call(t$,"code")&&r$.uint32(8).uint32(t$.code),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserDrop;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.code=t$.uint32();break;default:t$.skipType(7&i$)}}return n$},e$}(),eB=t.GroupEnter=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.account="",e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.account!=null&&Object.hasOwnProperty.call(t$,"account")&&r$.uint32(18).string(t$.account),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupEnter;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.account=t$.string();break;default:t$.skipType(7&i$)}}return n$},e$}(),fB=t.GroupLeave=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.account="",e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.account!=null&&Object.hasOwnProperty.call(t$,"account")&&r$.uint32(10).string(t$.account),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupLeave;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.account=t$.string();break;default:t$.skipType(7&i$)}}return n$},e$}(),gB=t.GroupReply=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.account="",e$.prototype.code=0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.account!=null&&Object.hasOwnProperty.call(t$,"account")&&r$.uint32(18).string(t$.account),t$.code!=null&&Object.hasOwnProperty.call(t$,"code")&&r$.uint32(24).uint32(t$.code),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupReply;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.account=t$.string();break;case 3:n$.code=t$.uint32();break;default:t$.skipType(7&i$)}}return n$},e$}(),ur=t.GroupLeaveNotice=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.user="",e$.prototype.group="",e$.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.size=0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.user!=null&&Object.hasOwnProperty.call(t$,"user")&&r$.uint32(18).string(t$.user),t$.group!=null&&Object.hasOwnProperty.call(t$,"group")&&r$.uint32(26).string(t$.group),t$.instance!=null&&Object.hasOwnProperty.call(t$,"instance")&&r$.uint32(32).uint64(t$.instance),t$.size!=null&&Object.hasOwnProperty.call(t$,"size")&&r$.uint32(40).uint32(t$.size),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupLeaveNotice;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.user=t$.string();break;case 3:n$.group=t$.string();break;case 4:n$.instance=t$.uint64();break;case 5:n$.size=t$.uint32();break;default:t$.skipType(7&i$)}}return n$},e$}(),vr=t.GroupEnterNotice=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.user="",e$.prototype.group="",e$.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.size=0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.user!=null&&Object.hasOwnProperty.call(t$,"user")&&r$.uint32(18).string(t$.user),t$.group!=null&&Object.hasOwnProperty.call(t$,"group")&&r$.uint32(26).string(t$.group),t$.instance!=null&&Object.hasOwnProperty.call(t$,"instance")&&r$.uint32(32).uint64(t$.instance),t$.size!=null&&Object.hasOwnProperty.call(t$,"size")&&r$.uint32(40).uint32(t$.size),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupEnterNotice;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.user=t$.string();break;case 3:n$.group=t$.string();break;case 4:n$.instance=t$.uint64();break;case 5:n$.size=t$.uint32();break;default:t$.skipType(7&i$)}}return n$},e$}(),wr=t.Message=function(){function e$(t$){if(this.MiscMap={},t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.options=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.src="",e$.prototype.dst="",e$.prototype.payload=q.newBuffer([]),e$.prototype.MiscMap=q.emptyObject,e$.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.instance!=null&&Object.hasOwnProperty.call(t$,"instance")&&r$.uint32(8).uint64(t$.instance),t$.dialogue!=null&&Object.hasOwnProperty.call(t$,"dialogue")&&r$.uint32(16).uint64(t$.dialogue),t$.sequence!=null&&Object.hasOwnProperty.call(t$,"sequence")&&r$.uint32(24).uint64(t$.sequence),t$.options!=null&&Object.hasOwnProperty.call(t$,"options")&&r$.uint32(32).uint64(t$.options),t$.src!=null&&Object.hasOwnProperty.call(t$,"src")&&r$.uint32(42).string(t$.src),t$.dst!=null&&Object.hasOwnProperty.call(t$,"dst")&&r$.uint32(50).string(t$.dst),t$.payload!=null&&Object.hasOwnProperty.call(t$,"payload")&&r$.uint32(58).bytes(t$.payload),t$.MiscMap!=null&&Object.hasOwnProperty.call(t$,"MiscMap"))for(var n$=Object.keys(t$.MiscMap),i$=0;i$<n$.length;++i$)r$.uint32(66).fork().uint32(10).string(n$[i$]).uint32(18).bytes(t$.MiscMap[n$[i$]]).ldelim();return t$.ms!=null&&Object.hasOwnProperty.call(t$,"ms")&&r$.uint32(72).uint64(t$.ms),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$,i$,o$=new t.Message;t$.pos<r$;)switch(n$=t$.uint32(),n$>>>3){case 1:o$.instance=t$.uint64();break;case 2:o$.dialogue=t$.uint64();break;case 3:o$.sequence=t$.uint64();break;case 4:o$.options=t$.uint64();break;case 5:o$.src=t$.string();break;case 6:o$.dst=t$.string();break;case 7:o$.payload=t$.bytes();break;case 8:o$.MiscMap===q.emptyObject&&(o$.MiscMap={});var s$=t$.uint32()+t$.pos;for(n$="",i$=[];t$.pos<s$;){var a$=t$.uint32();switch(a$>>>3){case 1:n$=t$.string();break;case 2:i$=t$.bytes();break;default:t$.skipType(7&a$)}}o$.MiscMap[n$]=i$;break;case 9:o$.ms=t$.uint64();break;default:t$.skipType(7&n$)}return o$},e$}(),xr=t.Ack=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.code=0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.instance!=null&&Object.hasOwnProperty.call(t$,"instance")&&r$.uint32(8).uint64(t$.instance),t$.dialogue!=null&&Object.hasOwnProperty.call(t$,"dialogue")&&r$.uint32(16).uint64(t$.dialogue),t$.sequence!=null&&Object.hasOwnProperty.call(t$,"sequence")&&r$.uint32(24).uint64(t$.sequence),t$.code!=null&&Object.hasOwnProperty.call(t$,"code")&&r$.uint32(32).uint32(t$.code),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.Ack;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.instance=t$.uint64();break;case 2:n$.dialogue=t$.uint64();break;case 3:n$.sequence=t$.uint64();break;case 4:n$.code=t$.uint32();break;default:t$.skipType(7&i$)}}return n$},e$}(),hB=t.FileUploadIndexGet=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.hash=q.newBuffer([]),e$.prototype.size=0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.hash!=null&&Object.hasOwnProperty.call(t$,"hash")&&r$.uint32(18).bytes(t$.hash),t$.size!=null&&Object.hasOwnProperty.call(t$,"size")&&r$.uint32(24).uint32(t$.size),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.FileUploadIndexGet;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.hash=t$.bytes();break;case 3:n$.size=t$.uint32();break;default:t$.skipType(7&i$)}}return n$},e$}(),iB=t.FileUploadIndexRet=function(){function e$(t$){if(this.servers=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.unit=0,e$.prototype.servers=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.unit!=null&&Object.hasOwnProperty.call(t$,"unit")&&r$.uint32(16).uint32(t$.unit),t$.servers!=null&&t$.servers.length){r$.uint32(26).fork();for(var n$=0;n$<t$.servers.length;++n$)r$.uint32(t$.servers[n$]);r$.ldelim()}return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.FileUploadIndexRet;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.unit=t$.uint32();break;case 3:if(n$.servers&&n$.servers.length||(n$.servers=[]),(7&i$)==2)for(i$=t$.uint32()+t$.pos;t$.pos<i$;)n$.servers.push(t$.uint32());else n$.servers.push(t$.uint32());break;default:t$.skipType(7&i$)}}return n$},e$}(),jB=t.FileUploadIndexSet=function(){function e$(t$){if(this.servers=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.hash=q.newBuffer([]),e$.prototype.unit=0,e$.prototype.servers=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.hash!=null&&Object.hasOwnProperty.call(t$,"hash")&&r$.uint32(18).bytes(t$.hash),t$.unit!=null&&Object.hasOwnProperty.call(t$,"unit")&&r$.uint32(24).uint32(t$.unit),t$.servers!=null&&t$.servers.length){r$.uint32(34).fork();for(var n$=0;n$<t$.servers.length;++n$)r$.uint32(t$.servers[n$]);r$.ldelim()}return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.FileUploadIndexSet;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.hash=t$.bytes();break;case 3:n$.unit=t$.uint32();break;case 4:if(n$.servers&&n$.servers.length||(n$.servers=[]),(7&i$)==2)for(i$=t$.uint32()+t$.pos;t$.pos<i$;)n$.servers.push(t$.uint32());else n$.servers.push(t$.uint32());break;default:t$.skipType(7&i$)}}return n$},e$}(),kB=t.FileUploadIndexFin=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.zone=0,e$.prototype.unit=0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.zone!=null&&Object.hasOwnProperty.call(t$,"zone")&&r$.uint32(16).uint32(t$.zone),t$.unit!=null&&Object.hasOwnProperty.call(t$,"unit")&&r$.uint32(24).uint32(t$.unit),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.FileUploadIndexFin;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.zone=t$.uint32();break;case 3:n$.unit=t$.uint32();break;default:t$.skipType(7&i$)}}return n$},e$}(),lB=t.FileUploadIndexErr=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.code=0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.code!=null&&Object.hasOwnProperty.call(t$,"code")&&r$.uint32(16).uint32(t$.code),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.FileUploadIndexErr;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.code=t$.uint32();break;default:t$.skipType(7&i$)}}return n$},e$}(),mB=t.FileDownloadIndexGet=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.zone=0,e$.prototype.hash=q.newBuffer([]),e$.prototype.size=0,e$.prototype.unit=0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.zone!=null&&Object.hasOwnProperty.call(t$,"zone")&&r$.uint32(16).uint32(t$.zone),t$.hash!=null&&Object.hasOwnProperty.call(t$,"hash")&&r$.uint32(26).bytes(t$.hash),t$.size!=null&&Object.hasOwnProperty.call(t$,"size")&&r$.uint32(32).uint32(t$.size),t$.unit!=null&&Object.hasOwnProperty.call(t$,"unit")&&r$.uint32(40).uint32(t$.unit),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.FileDownloadIndexGet;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.zone=t$.uint32();break;case 3:n$.hash=t$.bytes();break;case 4:n$.size=t$.uint32();break;case 5:n$.unit=t$.uint32();break;default:t$.skipType(7&i$)}}return n$},e$}(),nB=t.FileDownloadIndexRet=function(){function e$(t$){if(this.servers=[],this.backups=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.unit=0,e$.prototype.zone=0,e$.prototype.servers=q.emptyArray,e$.prototype.backups=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.unit!=null&&Object.hasOwnProperty.call(t$,"unit")&&r$.uint32(16).uint32(t$.unit),t$.zone!=null&&Object.hasOwnProperty.call(t$,"zone")&&r$.uint32(24).uint32(t$.zone),t$.servers!=null&&t$.servers.length){r$.uint32(34).fork();for(var n$=0;n$<t$.servers.length;++n$)r$.uint32(t$.servers[n$]);r$.ldelim()}if(t$.backups!=null&&t$.backups.length){for(r$.uint32(42).fork(),n$=0;n$<t$.backups.length;++n$)r$.uint32(t$.backups[n$]);r$.ldelim()}return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.FileDownloadIndexRet;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.unit=t$.uint32();break;case 3:n$.zone=t$.uint32();break;case 4:if(n$.servers&&n$.servers.length||(n$.servers=[]),(7&i$)==2)for(i$=t$.uint32()+t$.pos;t$.pos<i$;)n$.servers.push(t$.uint32());else n$.servers.push(t$.uint32());break;case 5:if(n$.backups&&n$.backups.length||(n$.backups=[]),(7&i$)==2)for(i$=t$.uint32()+t$.pos;t$.pos<i$;)n$.backups.push(t$.uint32());else n$.backups.push(t$.uint32());break;default:t$.skipType(7&i$)}}return n$},e$}(),oB=t.FileDownloadIndexErr=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.code=0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.code!=null&&Object.hasOwnProperty.call(t$,"code")&&r$.uint32(16).uint32(t$.code),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.FileDownloadIndexErr;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.code=t$.uint32();break;default:t$.skipType(7&i$)}}return n$},e$}(),pB=t.GroupAllUsersList=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.group="",e$.prototype.pageSize=0,e$.prototype.pageNumber=0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.group!=null&&Object.hasOwnProperty.call(t$,"group")&&r$.uint32(18).string(t$.group),t$.pageSize!=null&&Object.hasOwnProperty.call(t$,"pageSize")&&r$.uint32(24).uint32(t$.pageSize),t$.pageNumber!=null&&Object.hasOwnProperty.call(t$,"pageNumber")&&r$.uint32(32).uint32(t$.pageNumber),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupAllUsersList;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.group=t$.string();break;case 3:n$.pageSize=t$.uint32();break;case 4:n$.pageNumber=t$.uint32();break;default:t$.skipType(7&i$)}}return n$},e$}(),qB=t.GroupAllUsersResult=function(){function e$(t$){if(this.memberInfos=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.group="",e$.prototype.totalSize=0,e$.prototype.pageSize=0,e$.prototype.pageNumber=0,e$.prototype.memberInfos=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.group!=null&&Object.hasOwnProperty.call(t$,"group")&&r$.uint32(18).string(t$.group),t$.totalSize!=null&&Object.hasOwnProperty.call(t$,"totalSize")&&r$.uint32(24).uint32(t$.totalSize),t$.pageSize!=null&&Object.hasOwnProperty.call(t$,"pageSize")&&r$.uint32(32).uint32(t$.pageSize),t$.pageNumber!=null&&Object.hasOwnProperty.call(t$,"pageNumber")&&r$.uint32(40).uint32(t$.pageNumber),t$.memberInfos!=null&&t$.memberInfos.length)for(var n$=0;n$<t$.memberInfos.length;++n$)t.GroupAllUsersResult.MemberInfo.encode(t$.memberInfos[n$],r$.uint32(50).fork()).ldelim();return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupAllUsersResult;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.group=t$.string();break;case 3:n$.totalSize=t$.uint32();break;case 4:n$.pageSize=t$.uint32();break;case 5:n$.pageNumber=t$.uint32();break;case 6:n$.memberInfos&&n$.memberInfos.length||(n$.memberInfos=[]),n$.memberInfos.push(t.GroupAllUsersResult.MemberInfo.decode(t$,t$.uint32()));break;default:t$.skipType(7&i$)}}return n$},e$.MemberInfo=function(){function t$(r$){if(r$)for(var n$=Object.keys(r$),i$=0;i$<n$.length;++i$)r$[n$[i$]]!=null&&(this[n$[i$]]=r$[n$[i$]])}return t$.prototype.account="",t$.prototype.ts=0,t$.encode=function(r$,n$){return n$||(n$=L.create()),r$.account!=null&&Object.hasOwnProperty.call(r$,"account")&&n$.uint32(10).string(r$.account),r$.ts!=null&&Object.hasOwnProperty.call(r$,"ts")&&n$.uint32(16).uint32(r$.ts),n$},t$.decode=function(r$,n$){r$ instanceof u||(r$=u.create(r$)),n$=n$===void 0?r$.len:r$.pos+n$;for(var i$=new t.GroupAllUsersResult.MemberInfo;r$.pos<n$;){var o$=r$.uint32();switch(o$>>>3){case 1:i$.account=r$.string();break;case 2:i$.ts=r$.uint32();break;default:r$.skipType(7&o$)}}return i$},t$}(),e$}(),rB=t.UserStatusList=function(){function e$(t$){if(this.users=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.users=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.users!=null&&t$.users.length)for(var n$=0;n$<t$.users.length;++n$)r$.uint32(18).string(t$.users[n$]);return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserStatusList;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.users&&n$.users.length||(n$.users=[]),n$.users.push(t$.string());break;default:t$.skipType(7&i$)}}return n$},e$}(),sB=t.UserStatusResult=function(){function e$(t$){if(this.userInfos=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.userInfos=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.userInfos!=null&&t$.userInfos.length)for(var n$=0;n$<t$.userInfos.length;++n$)t.UserStatusResult.UserStatusInfo.encode(t$.userInfos[n$],r$.uint32(18).fork()).ldelim();return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserStatusResult;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.userInfos&&n$.userInfos.length||(n$.userInfos=[]),n$.userInfos.push(t.UserStatusResult.UserStatusInfo.decode(t$,t$.uint32()));break;default:t$.skipType(7&i$)}}return n$},e$.UserStatusInfo=function(){function t$(r$){if(r$)for(var n$=Object.keys(r$),i$=0;i$<n$.length;++i$)r$[n$[i$]]!=null&&(this[n$[i$]]=r$[n$[i$]])}return t$.prototype.account="",t$.prototype.ts=0,t$.encode=function(r$,n$){return n$||(n$=L.create()),r$.account!=null&&Object.hasOwnProperty.call(r$,"account")&&n$.uint32(10).string(r$.account),r$.ts!=null&&Object.hasOwnProperty.call(r$,"ts")&&n$.uint32(16).uint32(r$.ts),n$},t$.decode=function(r$,n$){r$ instanceof u||(r$=u.create(r$)),n$=n$===void 0?r$.len:r$.pos+n$;for(var i$=new t.UserStatusResult.UserStatusInfo;r$.pos<n$;){var o$=r$.uint32();switch(o$>>>3){case 1:i$.account=r$.string();break;case 2:i$.ts=r$.uint32();break;default:r$.skipType(7&o$)}}return i$},t$}(),e$}(),tB=t.UserAttributeGet=function(){function e$(t$){if(this.attributes=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.account="",e$.prototype.attributes=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.account!=null&&Object.hasOwnProperty.call(t$,"account")&&r$.uint32(18).string(t$.account),t$.attributes!=null&&t$.attributes.length)for(var n$=0;n$<t$.attributes.length;++n$)r$.uint32(26).string(t$.attributes[n$]);return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserAttributeGet;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.account=t$.string();break;case 3:n$.attributes&&n$.attributes.length||(n$.attributes=[]),n$.attributes.push(t$.string());break;default:t$.skipType(7&i$)}}return n$},e$}(),uB=t.UserAttributeRet=function(){function e$(t$){if(this.attributeInfos=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.attributeInfos=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.attributeInfos!=null&&t$.attributeInfos.length)for(var n$=0;n$<t$.attributeInfos.length;++n$)t.UserAttributeRet.AttributeInfo.encode(t$.attributeInfos[n$],r$.uint32(18).fork()).ldelim();return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserAttributeRet;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.attributeInfos&&n$.attributeInfos.length||(n$.attributeInfos=[]),n$.attributeInfos.push(t.UserAttributeRet.AttributeInfo.decode(t$,t$.uint32()));break;default:t$.skipType(7&i$)}}return n$},e$.AttributeInfo=function(){function t$(r$){if(r$)for(var n$=Object.keys(r$),i$=0;i$<n$.length;++i$)r$[n$[i$]]!=null&&(this[n$[i$]]=r$[n$[i$]])}return t$.prototype.key="",t$.prototype.value="",t$.encode=function(r$,n$){return n$||(n$=L.create()),r$.key!=null&&Object.hasOwnProperty.call(r$,"key")&&n$.uint32(10).string(r$.key),r$.value!=null&&Object.hasOwnProperty.call(r$,"value")&&n$.uint32(18).string(r$.value),n$},t$.decode=function(r$,n$){r$ instanceof u||(r$=u.create(r$)),n$=n$===void 0?r$.len:r$.pos+n$;for(var i$=new t.UserAttributeRet.AttributeInfo;r$.pos<n$;){var o$=r$.uint32();switch(o$>>>3){case 1:i$.key=r$.string();break;case 2:i$.value=r$.string();break;default:r$.skipType(7&o$)}}return i$},t$}(),e$}(),vB=t.UserAttributeSet=function(){function e$(t$){if(this.attributeInfos=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.account="",e$.prototype.attributeInfos=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.account!=null&&Object.hasOwnProperty.call(t$,"account")&&r$.uint32(18).string(t$.account),t$.attributeInfos!=null&&t$.attributeInfos.length)for(var n$=0;n$<t$.attributeInfos.length;++n$)t.UserAttributeSet.AttributeInfo.encode(t$.attributeInfos[n$],r$.uint32(26).fork()).ldelim();return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserAttributeSet;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.account=t$.string();break;case 3:n$.attributeInfos&&n$.attributeInfos.length||(n$.attributeInfos=[]),n$.attributeInfos.push(t.UserAttributeSet.AttributeInfo.decode(t$,t$.uint32()));break;default:t$.skipType(7&i$)}}return n$},e$.AttributeInfo=function(){function t$(r$){if(r$)for(var n$=Object.keys(r$),i$=0;i$<n$.length;++i$)r$[n$[i$]]!=null&&(this[n$[i$]]=r$[n$[i$]])}return t$.prototype.key="",t$.prototype.value="",t$.encode=function(r$,n$){return n$||(n$=L.create()),r$.key!=null&&Object.hasOwnProperty.call(r$,"key")&&n$.uint32(10).string(r$.key),r$.value!=null&&Object.hasOwnProperty.call(r$,"value")&&n$.uint32(18).string(r$.value),n$},t$.decode=function(r$,n$){r$ instanceof u||(r$=u.create(r$)),n$=n$===void 0?r$.len:r$.pos+n$;for(var i$=new t.UserAttributeSet.AttributeInfo;r$.pos<n$;){var o$=r$.uint32();switch(o$>>>3){case 1:i$.key=r$.string();break;case 2:i$.value=r$.string();break;default:r$.skipType(7&o$)}}return i$},t$}(),e$}(),wB=t.UserAttributeMod=function(){function e$(t$){if(this.attributeInfos=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.account="",e$.prototype.attributeInfos=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.account!=null&&Object.hasOwnProperty.call(t$,"account")&&r$.uint32(18).string(t$.account),t$.attributeInfos!=null&&t$.attributeInfos.length)for(var n$=0;n$<t$.attributeInfos.length;++n$)t.UserAttributeMod.AttributeInfo.encode(t$.attributeInfos[n$],r$.uint32(26).fork()).ldelim();return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserAttributeMod;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.account=t$.string();break;case 3:n$.attributeInfos&&n$.attributeInfos.length||(n$.attributeInfos=[]),n$.attributeInfos.push(t.UserAttributeMod.AttributeInfo.decode(t$,t$.uint32()));break;default:t$.skipType(7&i$)}}return n$},e$.AttributeInfo=function(){function t$(r$){if(r$)for(var n$=Object.keys(r$),i$=0;i$<n$.length;++i$)r$[n$[i$]]!=null&&(this[n$[i$]]=r$[n$[i$]])}return t$.prototype.key="",t$.prototype.value="",t$.encode=function(r$,n$){return n$||(n$=L.create()),r$.key!=null&&Object.hasOwnProperty.call(r$,"key")&&n$.uint32(10).string(r$.key),r$.value!=null&&Object.hasOwnProperty.call(r$,"value")&&n$.uint32(18).string(r$.value),n$},t$.decode=function(r$,n$){r$ instanceof u||(r$=u.create(r$)),n$=n$===void 0?r$.len:r$.pos+n$;for(var i$=new t.UserAttributeMod.AttributeInfo;r$.pos<n$;){var o$=r$.uint32();switch(o$>>>3){case 1:i$.key=r$.string();break;case 2:i$.value=r$.string();break;default:r$.skipType(7&o$)}}return i$},t$}(),e$}(),xB=t.UserAttributeDel=function(){function e$(t$){if(this.attributes=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.account="",e$.prototype.attributes=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.account!=null&&Object.hasOwnProperty.call(t$,"account")&&r$.uint32(18).string(t$.account),t$.attributes!=null&&t$.attributes.length)for(var n$=0;n$<t$.attributes.length;++n$)r$.uint32(26).string(t$.attributes[n$]);return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserAttributeDel;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.account=t$.string();break;case 3:n$.attributes&&n$.attributes.length||(n$.attributes=[]),n$.attributes.push(t$.string());break;default:t$.skipType(7&i$)}}return n$},e$}(),yB=t.UserAttributeErr=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.code=0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.code!=null&&Object.hasOwnProperty.call(t$,"code")&&r$.uint32(16).uint32(t$.code),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserAttributeErr;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.code=t$.uint32();break;default:t$.skipType(7&i$)}}return n$},e$}(),zB=t.UserAttributeKeysGet=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.account="",e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.account!=null&&Object.hasOwnProperty.call(t$,"account")&&r$.uint32(18).string(t$.account),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserAttributeKeysGet;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.account=t$.string();break;default:t$.skipType(7&i$)}}return n$},e$}(),AB=t.UserAttributeKeysRet=function(){function e$(t$){if(this.keys=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.keys=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.keys!=null&&t$.keys.length)for(var n$=0;n$<t$.keys.length;++n$)r$.uint32(18).string(t$.keys[n$]);return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserAttributeKeysRet;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.keys&&n$.keys.length||(n$.keys=[]),n$.keys.push(t$.string());break;default:t$.skipType(7&i$)}}return n$},e$}(),BB=t.UserAttributeRsp=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserAttributeRsp;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;default:t$.skipType(7&i$)}}return n$},e$}(),CB=t.GroupStatusList=function(){function e$(t$){if(this.groups=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.groups=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.groups!=null&&t$.groups.length)for(var n$=0;n$<t$.groups.length;++n$)r$.uint32(18).string(t$.groups[n$]);return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupStatusList;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.groups&&n$.groups.length||(n$.groups=[]),n$.groups.push(t$.string());break;default:t$.skipType(7&i$)}}return n$},e$}(),DB=t.GroupStatusResult=function(){function e$(t$){if(this.groupInfos=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.groupInfos=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.groupInfos!=null&&t$.groupInfos.length)for(var n$=0;n$<t$.groupInfos.length;++n$)t.GroupStatusResult.GroupInfo.encode(t$.groupInfos[n$],r$.uint32(18).fork()).ldelim();return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupStatusResult;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.groupInfos&&n$.groupInfos.length||(n$.groupInfos=[]),n$.groupInfos.push(t.GroupStatusResult.GroupInfo.decode(t$,t$.uint32()));break;default:t$.skipType(7&i$)}}return n$},e$.GroupInfo=function(){function t$(r$){if(r$)for(var n$=Object.keys(r$),i$=0;i$<n$.length;++i$)r$[n$[i$]]!=null&&(this[n$[i$]]=r$[n$[i$]])}return t$.prototype.group="",t$.prototype.memberCount=0,t$.encode=function(r$,n$){return n$||(n$=L.create()),r$.group!=null&&Object.hasOwnProperty.call(r$,"group")&&n$.uint32(10).string(r$.group),r$.memberCount!=null&&Object.hasOwnProperty.call(r$,"memberCount")&&n$.uint32(16).uint32(r$.memberCount),n$},t$.decode=function(r$,n$){r$ instanceof u||(r$=u.create(r$)),n$=n$===void 0?r$.len:r$.pos+n$;for(var i$=new t.GroupStatusResult.GroupInfo;r$.pos<n$;){var o$=r$.uint32();switch(o$>>>3){case 1:i$.group=r$.string();break;case 2:i$.memberCount=r$.uint32();break;default:r$.skipType(7&o$)}}return i$},t$}(),e$}(),EB=t.GroupCountNotice=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.group="",e$.prototype.size=0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.instance!=null&&Object.hasOwnProperty.call(t$,"instance")&&r$.uint32(8).uint64(t$.instance),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(16).uint64(t$.seq),t$.group!=null&&Object.hasOwnProperty.call(t$,"group")&&r$.uint32(26).string(t$.group),t$.size!=null&&Object.hasOwnProperty.call(t$,"size")&&r$.uint32(32).uint32(t$.size),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupCountNotice;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.instance=t$.uint64();break;case 2:n$.seq=t$.uint64();break;case 3:n$.group=t$.string();break;case 4:n$.size=t$.uint32();break;default:t$.skipType(7&i$)}}return n$},e$}(),FB=t.GroupAttributeGet=function(){function e$(t$){if(this.attributes=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.group="",e$.prototype.attributes=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.group!=null&&Object.hasOwnProperty.call(t$,"group")&&r$.uint32(18).string(t$.group),t$.attributes!=null&&t$.attributes.length)for(var n$=0;n$<t$.attributes.length;++n$)r$.uint32(26).string(t$.attributes[n$]);return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupAttributeGet;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.group=t$.string();break;case 3:n$.attributes&&n$.attributes.length||(n$.attributes=[]),n$.attributes.push(t$.string());break;default:t$.skipType(7&i$)}}return n$},e$}(),GB=t.GroupAttributeRet=function(){function e$(t$){if(this.attributeMaps=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.attributeMaps=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.attributeMaps!=null&&t$.attributeMaps.length)for(var n$=0;n$<t$.attributeMaps.length;++n$)t.GroupAttributeRet.AttributeMap.encode(t$.attributeMaps[n$],r$.uint32(18).fork()).ldelim();return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupAttributeRet;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.attributeMaps&&n$.attributeMaps.length||(n$.attributeMaps=[]),n$.attributeMaps.push(t.GroupAttributeRet.AttributeMap.decode(t$,t$.uint32()));break;default:t$.skipType(7&i$)}}return n$},e$.AttributeMap=function(){function t$(r$){if(r$)for(var n$=Object.keys(r$),i$=0;i$<n$.length;++i$)r$[n$[i$]]!=null&&(this[n$[i$]]=r$[n$[i$]])}return t$.prototype.key="",t$.prototype.value="",t$.prototype.origin="",t$.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,t$.encode=function(r$,n$){return n$||(n$=L.create()),r$.key!=null&&Object.hasOwnProperty.call(r$,"key")&&n$.uint32(10).string(r$.key),r$.value!=null&&Object.hasOwnProperty.call(r$,"value")&&n$.uint32(18).string(r$.value),r$.origin!=null&&Object.hasOwnProperty.call(r$,"origin")&&n$.uint32(26).string(r$.origin),r$.ms!=null&&Object.hasOwnProperty.call(r$,"ms")&&n$.uint32(32).uint64(r$.ms),n$},t$.decode=function(r$,n$){r$ instanceof u||(r$=u.create(r$)),n$=n$===void 0?r$.len:r$.pos+n$;for(var i$=new t.GroupAttributeRet.AttributeMap;r$.pos<n$;){var o$=r$.uint32();switch(o$>>>3){case 1:i$.key=r$.string();break;case 2:i$.value=r$.string();break;case 3:i$.origin=r$.string();break;case 4:i$.ms=r$.uint64();break;default:r$.skipType(7&o$)}}return i$},t$}(),e$}(),HB=t.GroupAttributeSet=function(){function e$(t$){if(this.attributeInfos=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.group="",e$.prototype.broadcast=!1,e$.prototype.attributeInfos=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.group!=null&&Object.hasOwnProperty.call(t$,"group")&&r$.uint32(18).string(t$.group),t$.broadcast!=null&&Object.hasOwnProperty.call(t$,"broadcast")&&r$.uint32(24).bool(t$.broadcast),t$.attributeInfos!=null&&t$.attributeInfos.length)for(var n$=0;n$<t$.attributeInfos.length;++n$)t.GroupAttributeSet.AttributeInfo.encode(t$.attributeInfos[n$],r$.uint32(34).fork()).ldelim();return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupAttributeSet;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.group=t$.string();break;case 3:n$.broadcast=t$.bool();break;case 4:n$.attributeInfos&&n$.attributeInfos.length||(n$.attributeInfos=[]),n$.attributeInfos.push(t.GroupAttributeSet.AttributeInfo.decode(t$,t$.uint32()));break;default:t$.skipType(7&i$)}}return n$},e$.AttributeInfo=function(){function t$(r$){if(r$)for(var n$=Object.keys(r$),i$=0;i$<n$.length;++i$)r$[n$[i$]]!=null&&(this[n$[i$]]=r$[n$[i$]])}return t$.prototype.key="",t$.prototype.value="",t$.encode=function(r$,n$){return n$||(n$=L.create()),r$.key!=null&&Object.hasOwnProperty.call(r$,"key")&&n$.uint32(10).string(r$.key),r$.value!=null&&Object.hasOwnProperty.call(r$,"value")&&n$.uint32(18).string(r$.value),n$},t$.decode=function(r$,n$){r$ instanceof u||(r$=u.create(r$)),n$=n$===void 0?r$.len:r$.pos+n$;for(var i$=new t.GroupAttributeSet.AttributeInfo;r$.pos<n$;){var o$=r$.uint32();switch(o$>>>3){case 1:i$.key=r$.string();break;case 2:i$.value=r$.string();break;default:r$.skipType(7&o$)}}return i$},t$}(),e$}(),IB=t.GroupAttributeMod=function(){function e$(t$){if(this.attributeInfos=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.group="",e$.prototype.broadcast=!1,e$.prototype.attributeInfos=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.group!=null&&Object.hasOwnProperty.call(t$,"group")&&r$.uint32(18).string(t$.group),t$.broadcast!=null&&Object.hasOwnProperty.call(t$,"broadcast")&&r$.uint32(24).bool(t$.broadcast),t$.attributeInfos!=null&&t$.attributeInfos.length)for(var n$=0;n$<t$.attributeInfos.length;++n$)t.GroupAttributeMod.AttributeInfo.encode(t$.attributeInfos[n$],r$.uint32(34).fork()).ldelim();return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupAttributeMod;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.group=t$.string();break;case 3:n$.broadcast=t$.bool();break;case 4:n$.attributeInfos&&n$.attributeInfos.length||(n$.attributeInfos=[]),n$.attributeInfos.push(t.GroupAttributeMod.AttributeInfo.decode(t$,t$.uint32()));break;default:t$.skipType(7&i$)}}return n$},e$.AttributeInfo=function(){function t$(r$){if(r$)for(var n$=Object.keys(r$),i$=0;i$<n$.length;++i$)r$[n$[i$]]!=null&&(this[n$[i$]]=r$[n$[i$]])}return t$.prototype.key="",t$.prototype.value="",t$.encode=function(r$,n$){return n$||(n$=L.create()),r$.key!=null&&Object.hasOwnProperty.call(r$,"key")&&n$.uint32(10).string(r$.key),r$.value!=null&&Object.hasOwnProperty.call(r$,"value")&&n$.uint32(18).string(r$.value),n$},t$.decode=function(r$,n$){r$ instanceof u||(r$=u.create(r$)),n$=n$===void 0?r$.len:r$.pos+n$;for(var i$=new t.GroupAttributeMod.AttributeInfo;r$.pos<n$;){var o$=r$.uint32();switch(o$>>>3){case 1:i$.key=r$.string();break;case 2:i$.value=r$.string();break;default:r$.skipType(7&o$)}}return i$},t$}(),e$}(),JB=t.GroupAttributeDel=function(){function e$(t$){if(this.attributes=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.group="",e$.prototype.broadcast=!1,e$.prototype.attributes=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.group!=null&&Object.hasOwnProperty.call(t$,"group")&&r$.uint32(18).string(t$.group),t$.broadcast!=null&&Object.hasOwnProperty.call(t$,"broadcast")&&r$.uint32(24).bool(t$.broadcast),t$.attributes!=null&&t$.attributes.length)for(var n$=0;n$<t$.attributes.length;++n$)r$.uint32(34).string(t$.attributes[n$]);return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupAttributeDel;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.group=t$.string();break;case 3:n$.broadcast=t$.bool();break;case 4:n$.attributes&&n$.attributes.length||(n$.attributes=[]),n$.attributes.push(t$.string());break;default:t$.skipType(7&i$)}}return n$},e$}(),KB=t.GroupAttributeAlt=function(){function e$(t$){if(this.attributeMaps=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.group="",e$.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.attributeMaps=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.group!=null&&Object.hasOwnProperty.call(t$,"group")&&r$.uint32(18).string(t$.group),t$.instance!=null&&Object.hasOwnProperty.call(t$,"instance")&&r$.uint32(24).uint64(t$.instance),t$.attributeMaps!=null&&t$.attributeMaps.length)for(var n$=0;n$<t$.attributeMaps.length;++n$)t.GroupAttributeAlt.AttributeMap.encode(t$.attributeMaps[n$],r$.uint32(34).fork()).ldelim();return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupAttributeAlt;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.group=t$.string();break;case 3:n$.instance=t$.uint64();break;case 4:n$.attributeMaps&&n$.attributeMaps.length||(n$.attributeMaps=[]),n$.attributeMaps.push(t.GroupAttributeAlt.AttributeMap.decode(t$,t$.uint32()));break;default:t$.skipType(7&i$)}}return n$},e$.AttributeMap=function(){function t$(r$){if(r$)for(var n$=Object.keys(r$),i$=0;i$<n$.length;++i$)r$[n$[i$]]!=null&&(this[n$[i$]]=r$[n$[i$]])}return t$.prototype.key="",t$.prototype.value="",t$.prototype.origin="",t$.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,t$.encode=function(r$,n$){return n$||(n$=L.create()),r$.key!=null&&Object.hasOwnProperty.call(r$,"key")&&n$.uint32(10).string(r$.key),r$.value!=null&&Object.hasOwnProperty.call(r$,"value")&&n$.uint32(18).string(r$.value),r$.origin!=null&&Object.hasOwnProperty.call(r$,"origin")&&n$.uint32(26).string(r$.origin),r$.ms!=null&&Object.hasOwnProperty.call(r$,"ms")&&n$.uint32(32).uint64(r$.ms),n$},t$.decode=function(r$,n$){r$ instanceof u||(r$=u.create(r$)),n$=n$===void 0?r$.len:r$.pos+n$;for(var i$=new t.GroupAttributeAlt.AttributeMap;r$.pos<n$;){var o$=r$.uint32();switch(o$>>>3){case 1:i$.key=r$.string();break;case 2:i$.value=r$.string();break;case 3:i$.origin=r$.string();break;case 4:i$.ms=r$.uint64();break;default:r$.skipType(7&o$)}}return i$},t$}(),e$}(),LB=t.GroupAttributeRsp=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupAttributeRsp;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;default:t$.skipType(7&i$)}}return n$},e$}(),MB=t.GroupAttributeErr=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.code=0,e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.code!=null&&Object.hasOwnProperty.call(t$,"code")&&r$.uint32(16).uint32(t$.code),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupAttributeErr;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.code=t$.uint32();break;default:t$.skipType(7&i$)}}return n$},e$}(),NB=t.GroupAttributeKeysGet=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.group="",e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.group!=null&&Object.hasOwnProperty.call(t$,"group")&&r$.uint32(18).string(t$.group),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupAttributeKeysGet;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.group=t$.string();break;default:t$.skipType(7&i$)}}return n$},e$}(),OB=t.GroupAttributeKeysRet=function(){function e$(t$){if(this.keys=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.keys=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.keys!=null&&t$.keys.length)for(var n$=0;n$<t$.keys.length;++n$)r$.uint32(18).string(t$.keys[n$]);return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.GroupAttributeKeysRet;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.keys&&n$.keys.length||(n$.keys=[]),n$.keys.push(t$.string());break;default:t$.skipType(7&i$)}}return n$},e$}(),PB=t.SubscribeUserStatus=function(){function e$(t$){if(this.users=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.users=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.users!=null&&t$.users.length)for(var n$=0;n$<t$.users.length;++n$)r$.uint32(18).string(t$.users[n$]);return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.SubscribeUserStatus;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.users&&n$.users.length||(n$.users=[]),n$.users.push(t$.string());break;default:t$.skipType(7&i$)}}return n$},e$}(),QB=t.UnsubscribeUserStatus=function(){function e$(t$){if(this.users=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.users=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.users!=null&&t$.users.length)for(var n$=0;n$<t$.users.length;++n$)r$.uint32(18).string(t$.users[n$]);return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UnsubscribeUserStatus;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.users&&n$.users.length||(n$.users=[]),n$.users.push(t$.string());break;default:t$.skipType(7&i$)}}return n$},e$}(),RB=t.UserJoinNotice=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.user="",e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.instance!=null&&Object.hasOwnProperty.call(t$,"instance")&&r$.uint32(8).uint64(t$.instance),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(16).uint64(t$.seq),t$.user!=null&&Object.hasOwnProperty.call(t$,"user")&&r$.uint32(26).string(t$.user),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserJoinNotice;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.instance=t$.uint64();break;case 2:n$.seq=t$.uint64();break;case 3:n$.user=t$.string();break;default:t$.skipType(7&i$)}}return n$},e$}(),SB=t.UserQuitNotice=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.user="",e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.instance!=null&&Object.hasOwnProperty.call(t$,"instance")&&r$.uint32(8).uint64(t$.instance),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(16).uint64(t$.seq),t$.user!=null&&Object.hasOwnProperty.call(t$,"user")&&r$.uint32(26).string(t$.user),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserQuitNotice;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.instance=t$.uint64();break;case 2:n$.seq=t$.uint64();break;case 3:n$.user=t$.string();break;default:t$.skipType(7&i$)}}return n$},e$}(),TB=t.UserWaitNotice=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.user="",e$.encode=function(t$,r$){return r$||(r$=L.create()),t$.instance!=null&&Object.hasOwnProperty.call(t$,"instance")&&r$.uint32(8).uint64(t$.instance),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(16).uint64(t$.seq),t$.user!=null&&Object.hasOwnProperty.call(t$,"user")&&r$.uint32(26).string(t$.user),r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.UserWaitNotice;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.instance=t$.uint64();break;case 2:n$.seq=t$.uint64();break;case 3:n$.user=t$.string();break;default:t$.skipType(7&i$)}}return n$},e$}(),UB=t.SubscribeResponse=function(){function e$(t$){if(this.errors=[],t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e$.prototype.errors=q.emptyArray,e$.encode=function(t$,r$){if(r$||(r$=L.create()),t$.seq!=null&&Object.hasOwnProperty.call(t$,"seq")&&r$.uint32(8).uint64(t$.seq),t$.errors!=null&&t$.errors.length)for(var n$=0;n$<t$.errors.length;++n$)t.SubscribeResponse.SubscribeErrorsType.encode(t$.errors[n$],r$.uint32(18).fork()).ldelim();return r$},e$.decode=function(t$,r$){t$ instanceof u||(t$=u.create(t$)),r$=r$===void 0?t$.len:t$.pos+r$;for(var n$=new t.SubscribeResponse;t$.pos<r$;){var i$=t$.uint32();switch(i$>>>3){case 1:n$.seq=t$.uint64();break;case 2:n$.errors&&n$.errors.length||(n$.errors=[]),n$.errors.push(t.SubscribeResponse.SubscribeErrorsType.decode(t$,t$.uint32()));break;default:t$.skipType(7&i$)}}return n$},e$.SubscribeErrorsType=function(){function t$(r$){if(r$)for(var n$=Object.keys(r$),i$=0;i$<n$.length;++i$)r$[n$[i$]]!=null&&(this[n$[i$]]=r$[n$[i$]])}return t$.prototype.account="",t$.prototype.code=0,t$.encode=function(r$,n$){return n$||(n$=L.create()),r$.account!=null&&Object.hasOwnProperty.call(r$,"account")&&n$.uint32(10).string(r$.account),r$.code!=null&&Object.hasOwnProperty.call(r$,"code")&&n$.uint32(16).uint32(r$.code),n$},t$.decode=function(r$,n$){r$ instanceof u||(r$=u.create(r$)),n$=n$===void 0?r$.len:r$.pos+n$;for(var i$=new t.SubscribeResponse.SubscribeErrorsType;r$.pos<n$;){var o$=r$.uint32();switch(o$>>>3){case 1:i$.account=r$.string();break;case 2:i$.code=r$.uint32();break;default:r$.skipType(7&o$)}}return i$},t$}(),e$}(),VB=Object.freeze({__proto__:null,URI:YA,Wrapper:Oh,Ping:ZA,Pong:$A,UserJoin:aB,UserResp:bB,UserQuit:cB,UserDrop:dB,GroupEnter:eB,GroupLeave:fB,GroupReply:gB,GroupLeaveNotice:ur,GroupEnterNotice:vr,Message:wr,Ack:xr,FileUploadIndexGet:hB,FileUploadIndexRet:iB,FileUploadIndexSet:jB,FileUploadIndexFin:kB,FileUploadIndexErr:lB,FileDownloadIndexGet:mB,FileDownloadIndexRet:nB,FileDownloadIndexErr:oB,GroupAllUsersList:pB,GroupAllUsersResult:qB,UserStatusList:rB,UserStatusResult:sB,UserAttributeGet:tB,UserAttributeRet:uB,UserAttributeSet:vB,UserAttributeMod:wB,UserAttributeDel:xB,UserAttributeErr:yB,UserAttributeKeysGet:zB,UserAttributeKeysRet:AB,UserAttributeRsp:BB,GroupStatusList:CB,GroupStatusResult:DB,GroupCountNotice:EB,GroupAttributeGet:FB,GroupAttributeRet:GB,GroupAttributeSet:HB,GroupAttributeMod:IB,GroupAttributeDel:JB,GroupAttributeAlt:KB,GroupAttributeRsp:LB,GroupAttributeErr:MB,GroupAttributeKeysGet:NB,GroupAttributeKeysRet:OB,SubscribeUserStatus:PB,UnsubscribeUserStatus:QB,UserJoinNotice:RB,UserQuitNotice:SB,UserWaitNotice:TB,SubscribeResponse:UB,default:t}),WB=Math.ceil,yr=function(e$){return function(t$,r$,n$){var i$=(t$=String(jb(t$))).length;return n$=n$===void 0?" ":String(n$),(r$=ta(r$))<=i$||n$==""?t$:(r$-=i$,(i$=Pn.call(n$,WB(r$/n$.length))).length>r$&&(i$=i$.slice(0,r$)),e$?t$+i$:i$+t$)}},XB=yr(!1),YB=yr(!0),zr=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(De);N({target:"String",proto:!0,forced:zr},{padEnd:function(e$){return YB(this,e$,1<arguments.length?arguments[1]:void 0)}});var ZB=zf,Ar=function(e$){return function(t$){t$=qb(t$);for(var r$,n$=Dc(t$),i$=n$.length,o$=0,s$=[];i$>o$;)r$=n$[o$++],ka&&!ZB.call(t$,r$)||s$.push(e$?[r$,t$[r$]]:t$[r$]);return s$}},$B=Ar(!0),aC=Ar(!1);N({target:"Object",stat:!0},{entries:function(e$){return $B(e$)}});var bC=Fb.f,Br="".endsWith,cC=Math.min,Cr=dk("endsWith"),dC=!Cr&&!!function(){var e$=bC(String.prototype,"endsWith");return e$&&!e$.writable}();N({target:"String",proto:!0,forced:!dC&&!Cr},{endsWith:function(e$){var t$=String(jb(this));ck(e$);var r$=1<arguments.length?arguments[1]:void 0,n$=ta(t$.length);return r$=r$===void 0?n$:cC(ta(r$),n$),n$=String(e$),Br?Br.call(t$,n$,r$):t$.slice(r$-n$.length,r$)===n$}}),dh("match",1,function(e$,t$,r$){return[function(n$){var i$=jb(this),o$=n$==null?void 0:n$[e$];return o$!==void 0?o$.call(n$,i$):new RegExp(n$)[e$](String(i$))},function(n$){var i$=r$(t$,n$,this);if(i$.done)return i$.value;if(n$=va(n$),i$=String(this),!n$.global)return Ke(n$,i$);var o$=n$.unicode;n$.lastIndex=0;for(var s$,a$=[],c$=0;(s$=Ke(n$,i$))!==null;)s$=String(s$[0]),a$[c$]=s$,s$===""&&(n$.lastIndex=xj(i$,ta(n$.lastIndex),o$)),c$++;return c$===0?null:a$}]});var eC=Fb.f,Dr="".startsWith,fC=Math.min,Er=dk("startsWith"),gC=!Er&&!!function(){var e$=eC(String.prototype,"startsWith");return e$&&!e$.writable}();N({target:"String",proto:!0,forced:!gC&&!Er},{startsWith:function(e$){var t$=String(jb(this));ck(e$);var r$=ta(fC(1<arguments.length?arguments[1]:void 0,t$.length)),n$=String(e$);return Dr?Dr.call(t$,n$,r$):t$.slice(r$,r$+n$.length)===n$}});var Nm=function(e$){var t$=/(%?)(%([jds]))/g,r$=Array.prototype.slice.call(arguments,1);return r$.length&&(e$=e$.replace(t$,function(n$,i$,o$,s$){switch(o$=r$.shift(),s$){case"s":o$=""+o$;break;case"d":o$=Number(o$);break;case"j":o$=JSON.stringify(o$)}return i$?(r$.unshift(o$),n$):o$})),r$.length&&(e$+=" "+r$.join(" ")),""+(e$=e$.replace(/%{2,2}/g,"%"))},hC=/\s/,iC=function(e$){for(var t$=e$.length;t$--&&hC.test(e$.charAt(t$)););return t$},jC=/^\s+/,Fr=NaN,kC=/^[-+]0x[0-9a-f]+$/i,lC=/^0b[01]+$/i,mC=/^0o[0-7]+$/i,nC=parseInt,gl=function(e$){if(typeof e$=="number")return e$;if(ie(e$))return Fr;if(lb(e$)&&(e$=typeof e$.valueOf=="function"?e$.valueOf():e$,e$=lb(e$)?e$+"":e$),typeof e$!="string")return e$===0?e$:+e$;e$=e$&&e$.slice(0,iC(e$)+1).replace(jC,"");var t$=lC.test(e$);return t$||mC.test(e$)?nC(e$.slice(2),t$?2:8):kC.test(e$)?Fr:+e$},oC=Math.max,pC=Math.min,qC=function(e$,t$,r$){function n$(v$){var y$=c$,S$=u$;return c$=u$=void 0,p$=v$,l$=e$.apply(S$,y$)}function i$(v$){var y$=v$-h$;return v$-=p$,h$===void 0||y$>=t$||0>y$||f$&&v$>=g$}function o$(){var v$=Cb.Date.now();if(i$(v$))return s$(v$);var y$=setTimeout,S$=v$-p$;v$=t$-(v$-h$),S$=f$?pC(v$,g$-S$):v$,d$=y$(o$,S$)}function s$(v$){return d$=void 0,m$&&c$?n$(v$):(c$=u$=void 0,l$)}function a$(){var v$=Cb.Date.now(),y$=i$(v$);if(c$=arguments,u$=this,h$=v$,y$){if(d$===void 0)return p$=v$=h$,d$=setTimeout(o$,t$),_$?n$(v$):l$;if(f$)return clearTimeout(d$),d$=setTimeout(o$,t$),n$(h$)}return d$===void 0&&(d$=setTimeout(o$,t$)),l$}var c$,u$,l$,d$,h$,p$=0,_$=!1,f$=!1,m$=!0;if(typeof e$!="function")throw new TypeError("Expected a function");if(t$=gl(t$)||0,lb(r$)){_$=!!r$.leading;var g$=(f$="maxWait"in r$)?oC(gl(r$.maxWait)||0,t$):g$;m$="trailing"in r$?!!r$.trailing:m$}return a$.cancel=function(){d$!==void 0&&clearTimeout(d$),p$=0,c$=h$=u$=d$=void 0},a$.flush=function(){return d$===void 0?l$:s$(Cb.Date.now())},a$},yc=function(e$){function t$(n$,i$){return W(this,t$),m(n(n$=r$.call(this,Mm(n$,i$))),"originalError",void 0),m(n(n$),"code",void 0),m(n(n$),"serverCode",void 0),typeof i$=="number"?n$.code=i$:typeof i$=="string"?n$.name=i$:i$!==void 0&&(i$.originalError&&(n$.originalError=i$.originalError),i$.code!==void 0&&(n$.code=i$.code),i$.serverCode!==void 0&&(n$.serverCode=i$.serverCode)),n$}la(t$,e$);var r$=ma(t$);return t$}(ef(Error)),Ia=function(e$){function t$(n$,i$){return W(this,t$),m(n(n$=r$.call(this,Mm(n$,i$))),"name","RtmInternalError"),m(n(n$),"code",void 0),n$.code=i$,n$}la(t$,e$);var r$=ma(t$);return t$}(ef(Error)),Ph=function(){return function(e$){function t$(n$){W(this,t$);var i$=Object.keys(n$);return r$.call(this,n$[i$[0]],i$[0])}la(t$,e$);var r$=ma(t$);return t$}(Ia)},Fa=Ph(),db=function(e$){function t$(){W(this,t$);for(var n$=arguments.length,i$=Array(n$),o$=0;o$<n$;o$++)i$[o$]=arguments[o$];return m(n(n$=r$.call.apply(r$,[this].concat(i$))),"name","RtmTimeoutError"),n$}la(t$,e$);var r$=ma(t$);return t$}(yc),I=function(e$){function t$(){W(this,t$);for(var n$=arguments.length,i$=Array(n$),o$=0;o$<n$;o$++)i$[o$]=arguments[o$];return m(n(n$=r$.call.apply(r$,[this].concat(i$))),"name","RtmInvalidArgumentError"),n$}la(t$,e$);var r$=ma(t$);return t$}(yc),K=function(e$){function t$(){W(this,t$);for(var n$=arguments.length,i$=Array(n$),o$=0;o$<n$;o$++)i$[o$]=arguments[o$];return m(n(n$=r$.call.apply(r$,[this].concat(i$))),"name","RtmInvalidStatusError"),n$}la(t$,e$);var r$=ma(t$);return t$}(yc),hl=function(e$){function t$(){W(this,t$);for(var n$=arguments.length,i$=Array(n$),o$=0;o$<n$;o$++)i$[o$]=arguments[o$];return m(n(n$=r$.call.apply(r$,[this].concat(i$))),"name","RtmInterruptedError"),n$}la(t$,e$);var r$=ma(t$);return t$}(yc),ib=function(e$){function t$(){W(this,t$);for(var n$=arguments.length,i$=Array(n$),o$=0;o$<n$;o$++)i$[o$]=arguments[o$];return m(n(n$=r$.call.apply(r$,[this].concat(i$))),"name","RtmLimitExceededError"),n$}la(t$,e$);var r$=ma(t$);return t$}(yc),rC=function(e$){function t$(){W(this,t$);for(var n$=arguments.length,i$=Array(n$),o$=0;o$<n$;o$++)i$[o$]=arguments[o$];return m(n(n$=r$.call.apply(r$,[this].concat(i$))),"name","RtmInvokeTooOftenError"),n$}la(t$,e$);var r$=ma(t$);return t$}(yc),da=function(e$){function t$(){W(this,t$);for(var n$=arguments.length,i$=Array(n$),o$=0;o$<n$;o$++)i$[o$]=arguments[o$];return m(n(n$=r$.call.apply(r$,[this].concat(i$))),"name","RtmUnavailableError"),m(n(n$),"serverCode",void 0),m(n(n$),"statusCode",void 0),n$}la(t$,e$);var r$=ma(t$);return t$}(yc),Ye=function(e$){function t$(){W(this,t$);for(var n$=arguments.length,i$=Array(n$),o$=0;o$<n$;o$++)i$[o$]=arguments[o$];return m(n(n$=r$.call.apply(r$,[this].concat(i$))),"name","RtmUnauthenticatedError"),m(n(n$),"serverCode",void 0),n$}la(t$,e$);var r$=ma(t$);return t$}(yc),Wc=function(e$){function t$(){W(this,t$);for(var n$=arguments.length,i$=Array(n$),o$=0;o$<n$;o$++)i$[o$]=arguments[o$];return m(n(n$=r$.call.apply(r$,[this].concat(i$))),"name","RtmUnknownError"),n$}la(t$,e$);var r$=ma(t$);return t$}(yc),Sa=function(e$){return e$ instanceof db||e$ instanceof pb},sa=function(e$){return e$ instanceof yc},Yd=function(e$,t$,r$){return['Executing "%s.%s" timed out after %ds',e$,t$,r$/1e3]},Lm=new Map,sC=function(){var e$=new Date;return"".concat(e$.toISOString().split("T")[1].replace(/\..+/,""),".").concat(e$.getMilliseconds())},xf=Object.keys,Hg=Object.entries.bind(Object),Cg=function(e$){return typeof e$=="string"?e$.endsWith(".")?e$:"".concat(e$,"."):e$},Sm=function(e$){for(var t$="",r$=(e$=new Uint8Array(e$)).byteLength,n$=-1;++n$<r$;)t$+=String.fromCharCode(e$[n$]);return t$=btoa(t$),"data:;base64,".concat(t$)},tC=R(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1});N({target:"Date",proto:!0,forced:tC},{toJSON:function(e$){e$=Qa(this);var t$=lc(e$);return typeof t$!="number"||isFinite(t$)?e$.toISOString():null}}),N({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var $t=Object.prototype.hasOwnProperty,Gr=function(e$,t$,r$){return JSON.stringify(Ym(e$),t$,r$)};Gr.ensureProperties=Ym;var uC=function(e$,t$){t$=t$||{};var r$=X(e$);if(r$==="string"&&0<e$.length)return au(e$);if(r$==="number"&&isFinite(e$))return t$.long?e$=864e5<=(t$=Math.abs(e$))?Jg(e$,t$,864e5,"day"):36e5<=t$?Jg(e$,t$,36e5,"hour"):6e4<=t$?Jg(e$,t$,6e4,"minute"):1e3<=t$?Jg(e$,t$,1e3,"second"):e$+" ms":e$=864e5<=(t$=Math.abs(e$))?Math.round(e$/864e5)+"d":36e5<=t$?Math.round(e$/36e5)+"h":6e4<=t$?Math.round(e$/6e4)+"m":1e3<=t$?Math.round(e$/1e3)+"s":e$+"ms",e$;throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e$))},vC=function(e$){function t$(i$){function o$(){for(var c$=arguments.length,u$=Array(c$),l$=0;l$<c$;l$++)u$[l$]=arguments[l$];if(o$.enabled){c$=Number(new Date),o$.diff=c$-(s$||c$),o$.prev=s$,s$=o$.curr=c$,u$[0]=t$.coerce(u$[0]),typeof u$[0]!="string"&&u$.unshift("%O");var d$=0;u$[0]=u$[0].replace(/%([a-zA-Z%])/g,function(h$,p$){return h$==="%%"?"%":(d$++,typeof(p$=t$.formatters[p$])=="function"&&(h$=p$.call(o$,u$[d$]),u$.splice(d$,1),d$--),h$)}),t$.formatArgs.call(o$,u$),(o$.log||t$.log).apply(o$,u$)}}var s$,a$=null;return o$.namespace=i$,o$.useColors=t$.useColors(),o$.color=t$.selectColor(i$),o$.extend=r$,o$.destroy=t$.destroy,Object.defineProperty(o$,"enabled",{enumerable:!0,configurable:!1,get:function(){return a$===null?t$.enabled(i$):a$},set:function(c$){a$=c$}}),typeof t$.init=="function"&&t$.init(o$),o$}function r$(i$,o$){return(i$=t$(this.namespace+(o$===void 0?":":o$)+i$)).log=this.log,i$}function n$(i$){return i$.toString().substring(2,i$.toString().length-2).replace(/\.\*\?$/,"*")}return t$.debug=t$,t$.default=t$,t$.coerce=function(i$){return i$ instanceof Error?i$.stack||i$.message:i$},t$.disable=function(){var i$=[].concat(G(t$.names.map(n$)),G(t$.skips.map(n$).map(function(o$){return"-"+o$}))).join(",");return t$.enable(""),i$},t$.enable=function(i$){t$.save(i$),t$.names=[],t$.skips=[];var o$,s$=(typeof i$=="string"?i$:"").split(/[\s,]+/),a$=s$.length;for(o$=0;o$<a$;o$++)s$[o$]&&((i$=s$[o$].replace(/\*/g,".*?"))[0]==="-"?t$.skips.push(new RegExp("^"+i$.substr(1)+"$")):t$.names.push(new RegExp("^"+i$+"$")))},t$.enabled=function(i$){if(i$[i$.length-1]==="*")return!0;var o$,s$=0;for(o$=t$.skips.length;s$<o$;s$++)if(t$.skips[s$].test(i$))return!1;for(s$=0,o$=t$.names.length;s$<o$;s$++)if(t$.names[s$].test(i$))return!0;return!1},t$.humanize=uC,t$.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e$).forEach(function(i$){t$[i$]=e$[i$]}),t$.names=[],t$.skips=[],t$.formatters={},t$.selectColor=function(i$){for(var o$=0,s$=0;s$<i$.length;s$++)o$=(o$<<5)-o$+i$.charCodeAt(s$),o$|=0;return t$.colors[Math.abs(o$)%t$.colors.length]},t$.enable(t$.load()),t$},Hr=$a(function(e$,t$){t$.formatArgs=function(n$){if(n$[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n$[0]+(this.useColors?"%c ":" ")+"+"+e$.exports.humanize(this.diff),this.useColors){var i$="color: "+this.color;n$.splice(1,0,i$,"color: inherit");var o$=0,s$=0;n$[0].replace(/%[a-zA-Z%]/g,function(a$){a$!=="%%"&&(o$++,a$==="%c"&&(s$=o$))}),n$.splice(s$,0,i$)}},t$.save=function(n$){try{n$?t$.storage.setItem("debug",n$):t$.storage.removeItem("debug")}catch{}},t$.load=function(){try{var n$=t$.storage.getItem("debug")}catch{}return!n$&&typeof process<"u"&&"env"in process&&(n$=define_process_env_default.DEBUG),n$},t$.useColors=function(){return!(typeof window>"u"||!window.process||window.process.type!=="renderer"&&!window.process.__nwjs)||(typeof navigator>"u"||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};e:{try{var r$=localStorage;break e}catch{}r$=void 0}t$.storage=r$,t$.destroy=function(){var n$=!1;return function(){n$||(n$=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),t$.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),t$.log=console.debug||console.log||function(){},e$.exports=vC(t$),e$.exports.formatters.j=function(n$){try{return JSON.stringify(n$)}catch(i$){return"[UnexpectedJSONParseError]: "+i$.message}}}),Ir=Hr("RTM:DEBUG"),Ze;Ir.enabled=!1,function(e$){e$[e$.Uploading=0]="Uploading",e$[e$.Free=1]="Free"}(Ze||(Ze={}));var wC=function(){function e$(t$){W(this,e$),m(this,"uploadRequest",void 0),m(this,"uploadState",void 0),m(this,"uploadResendCount",void 0),m(this,"LogCache",void 0),m(this,"LogsToPost",void 0),m(this,"processId",void 0),m(this,"sdkVersion",void 0),m(this,"logId",void 0),m(this,"rtmConfig",void 0),this.processId=t$.processId,this.sdkVersion=t$.sdkVersion,this.rtmConfig=t$.rtmConfig,this.uploadRequest=t$.uploadRequest,this.uploadState=Ze.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return Ha(e$,[{key:"upload",value:function(t$){this.LogCache.push(t$),this.uploadState===Ze.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(t$){var r$=this;this.uploadState=Ze.Uploading,setTimeout(J(w.mark(function n$(){var i$,o$,s$;return w.wrap(function(a$){for(;;)switch(a$.prev=a$.next){case 0:return i$={sdk_version:r$.sdkVersion,process_id:r$.processId,payload:JSON.stringify(t$)},a$.prev=1,a$.next=4,r$.uploadRequest(i$,(o$=r$.rtmConfig.enableCloudProxy)!==null&&o$!==void 0&&o$);case 4:if(!Uk){a$.next=6;break}throw Error("RTM is busy");case 6:a$.next=13;break;case 8:return a$.prev=8,a$.t0=a$.catch(1),s$=2>r$.uploadResendCount++?2e3:1e4,setTimeout(function(){return r$.postLog(r$.LogsToPost)},s$),a$.abrupt("return");case 13:if(Ir('The logs uploaded for "process-'.concat(gg,'"')),r$.LogCache.length!==0){a$.next=17;break}return r$.uploadState=Ze.Free,a$.abrupt("return");case 17:r$.uploadResendCount=0,r$.LogsToPost=40>r$.LogCache.length?r$.LogCache.splice(0,r$.LogCache.length):r$.LogCache.splice(0,40),r$.postLog(r$.LogsToPost);case 20:case"end":return a$.stop()}},n$,null,[[1,8]])})),Zd.getParameter("LOG_UPLOAD_INTERVAL"))}}]),e$}(),Jr=function(e$,t$,r$,n$,i$,o$,s$,a$){var c$=0;for(s$=!!s$&&Id(s$,a$,3);c$<n$;){if(c$ in r$){if(a$=s$?s$(r$[c$],c$,t$):r$[c$],0<o$&&gd(a$))i$=Jr(e$,t$,a$,ta(a$.length),i$,o$-1)-1;else{if(9007199254740991<=i$)throw TypeError("Exceed the acceptable array length");e$[i$]=a$}i$++}c$++}return i$},xC=Jr;N({target:"Array",proto:!0},{flat:function(){var e$=arguments.length?arguments[0]:void 0,t$=Qa(this),r$=ta(t$.length),n$=Sg(t$,0);return n$.length=xC(n$,t$,t$,r$,0,e$===void 0?1:$b(e$)),n$}}),N({target:"Object",stat:!0},{values:function(e$){return aC(e$)}});var yC=["CODE"],Db,ud,F;(function(e$){e$.CHINA="CN",e$.ASIA="AS",e$.NORTH_AMERICA="NA",e$.EUROPE="EU",e$.JAPAN="JP",e$.INDIA="IN",e$.OCEANIA="OC",e$.SOUTH_AMERICA="SA",e$.AFRICA="AF",e$.OVERSEA="OVERSEA",e$.GLOBAL="GLOBAL"})(F||(F={}));var zC={CN:F.CHINA,NA:F.NORTH_AMERICA,EU:F.EUROPE,AS:F.ASIA,JP:F.JAPAN,IN:F.INDIA,GLOB:F.GLOBAL,AF:F.AFRICA,OC:F.OVERSEA,OVS:F.OVERSEA,SA:F.SOUTH_AMERICA},Kg=Wm((Db={},m(Db,F.ASIA,{CODE:F.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.NORTH_AMERICA,{CODE:F.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.EUROPE,{CODE:F.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.JAPAN,{CODE:F.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.INDIA,{CODE:F.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OVERSEA,{CODE:F.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),m(Db,F.GLOBAL,{CODE:F.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OCEANIA,{CODE:F.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.SOUTH_AMERICA,{CODE:F.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.AFRICA,{CODE:F.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.CHINA,{CODE:F.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),Db)),yf=(ud={},m(ud,F.ASIA,[F.CHINA,F.JAPAN,F.INDIA]),m(ud,F.EUROPE,[]),m(ud,F.NORTH_AMERICA,[]),m(ud,F.SOUTH_AMERICA,[]),m(ud,F.OCEANIA,[]),m(ud,F.AFRICA,[]),ud),Kr=[F.OVERSEA,F.GLOBAL,F.CHINA,F.NORTH_AMERICA,F.EUROPE,F.ASIA,F.JAPAN,F.INDIA,F.OCEANIA,F.SOUTH_AMERICA,F.AFRICA],Zm=function(e$){return Object.values(yf).flat().includes(e$)},cu=function(e$){var t$;return(t$=Hg(yf).find(function(r$){return(r$=ra(r$,2))[0],r$[1].includes(e$)}))===null||t$===void 0?void 0:t$[0]},AC=function(e$){return e$.sort(function(t$,r$){return Kr.indexOf(t$)-Kr.indexOf(r$)})},xe=function(e$){var t$=new Set;if((e$=AC(e$).slice(0,3).map(function(r$){var n$=Kg[r$];if(n$===void 0)throw new Ia("invalid area key");return r$=n$.CODE,n$=ff(n$,yC),t$.add(r$),n$})).length===0)throw new Ia("areas cannot be empty");return ua({CODES:t$},e$.reduce(function(r$,n$){for(var i$=0,o$=Hg(r$);i$<o$.length;i$++){var s$=ra(o$[i$],2),a$=s$[0];s$=s$[1],r$[a$]=Array.from(new Set([].concat(G(n$[a$]),G(s$))))}return r$}))},M,Lr=function(){var e$=J(w.mark(function t$(r$,n$){var i$,o$,s$,a$,c$,u$=arguments;return w.wrap(function(l$){for(;;)switch(l$.prev=l$.next){case 0:if(!(2<(o$=2<u$.length&&u$[2]!==void 0?u$[2]:0))){l$.next=3;break}return l$.abrupt("return");case 3:return s$={withCredentials:!0,body:r$,timeout:2e4},a$=0<o$?(M==null?void 0:M.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(M==null?void 0:M.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",c$=n$?"https://".concat((i$=M==null?void 0:M.PROXY_NGINX[0])!==null&&i$!==void 0?i$:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(a$,"&p=443&d=upload/v1"):"https://".concat(a$,"/upload/v1"),l$.next=8,te(c$,s$).catch(function(d$){return Lr(r$,n$,o$+1)});case 8:case"end":return l$.stop()}},t$)}));return function(t$,r$){return e$.apply(this,arguments)}}(),Mr=new wC({processId:"process-".concat(gg),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.4.3-17-g1e27aa38"),uploadRequest:Lr,rtmConfig:{}}),il="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Nr="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Or="serverReceivedTs isOfflineMessage enableHistoricalMessaging enableOfflineMessaging hasPeerReceived messageType enableNotificationToChannelMembers lastUpdateTs".split(" "),BC="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),ye=function(e$){if(typeof e$=="string")return oa(e$);if(Array.isArray(e$)&&e$.every(function(o$){return typeof o$=="string"}))return e$.map(function(o$){return oa(o$)});if(!Il(e$)){for(var t$={},r$=0;r$<Or.length;r$++){var n$=Or[r$];n$ in e$&&(t$[n$]=e$[n$])}if(0<Object.keys(t$).length)return t$;if(5>Object.keys(e$).length){for(r$=0,e$=Object.entries(e$);r$<e$.length;r$++){var i$=ra(e$[r$],2);n$=i$[0],i$=i$[1],il.includes(n$)?t$[n$]="[Hidden Info]":t$[oa(n$)]=typeof i$=="string"?oa(i$):"[Sensitive Info]"}return t$}return"[Sensitive Info]"}return e$},Pr=function(e$){return X(e$)==="object"?yd(e$)?Vm(fe(e$,5),il,Nr):e$.constructor&&e$.constructor.name:e$},Qr=function(e$,t$){return e$ instanceof Error?e$.message:typeof e$!="string"?JSON.stringify(Vm(fe(e$,5),il,Nr)):(t$=t$.map(function(r$){return r$ instanceof Error?r$.message:X(r$)==="object"?Gr(Array.isArray(r$)?r$.map(Pr):Pr(r$)):r$}),Nm.apply(void 0,[e$.replace(/%[%Oo]/g,function(r$){return r$==="%%"?"%":r$==="%o"||r$==="%O"?"%s":r$})].concat(G(t$))))},CC=1,Rr=function(e$,t$,r$){var n$=Hr(e$);return n$.enabled=!0,n$.log=r$,n$.useColors=!1,function(i$){for(var o$=arguments.length,s$=Array(1<o$?o$-1:0),a$=1;a$<o$;a$++)s$[a$-1]=arguments[a$];if(t$.enableLogUpload){o$=Cg(i$);var c$=Qr(o$,s$);Mr.upload({log_item_id:"".concat(CC++),log_level:e$,payload_str:"[".concat(sC(),"] ").concat(e$," - ").concat(256<c$.length?c$.slice(0,256):c$)})}switch(o$=function(u$){var l$=c$||Qr(Cg(i$),s$),d$=Nc.LOG_HANDLER;typeof d$=="function"&&d$({level:u$,message:l$}),n$(l$)},e$){case"RTM:INFO":t$.logFilter.info&&o$("log");break;case"RTM:WARN":t$.logFilter.warn&&o$("warning");break;case"RTM:ERROR":t$.logFilter.error&&o$("error");break;case"RTM:TRACK":t$.logFilter.track&&o$("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":t$.logFilter.debug&&o$("debug");break;case"RTM:DEBUG":t$.logFilter.debug&&o$("debug")}}},jl,Sr=function(e$){return function(t$){var r$=jl===1||e$===void 0?"":"Ins#".concat(e$," ");return"".concat(r$).concat(t$)}},kl=function(e$,t$,r$){var n$=Sr(jl);return Rr("RTM:".concat(t$),r$,function(i$){return e$(n$(i$))})},tb=function(){return function(e$){function t$(n$,i$){var o$=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,t$);var s$=r$.call(this);if(m(n(s$),"logError",void 0),m(n(s$),"invokeTracker",void 0),m(n(s$),"resultTracker",void 0),m(n(s$),"errorTracker",void 0),m(n(s$),"eventTracker",void 0),m(n(s$),"info",void 0),m(n(s$),"warn",void 0),m(n(s$),"log",void 0),m(n(s$),"genLogger",void 0),m(n(s$),"loggerId",void 0),m(n(s$),"logger",void 0),m(n(s$),"name",void 0),s$.logger=n$,s$.name=i$,s$.loggerId=n$.loggerId,s$.info=n$.info,s$.warn=n$.warn,s$.logError=n$.logError,s$.genLogger=n$.genLogger,s$.log=n$.genLogger("RTM:DEBUG","<".concat(i$,"> ")),s$.invokeTracker=n$.genTracker("Invoke"),s$.eventTracker=n$.genTracker("Event"),s$.resultTracker=n$.genTracker("Result"),s$.errorTracker=n$.genTracker("Error"),o$){var a$=s$.emit.bind(n(s$));s$.emit=function(){for(var c$=arguments.length,u$=Array(c$),l$=0;l$<c$;l$++)u$[l$]=arguments[l$];c$=u$[0],l$=u$.slice(1);var d$=BC.includes(c$);s$.eventTracker.apply(s$,["%s: ".concat(0<l$.length?"%s emitted with args: ".concat(l$.map(function(){return"%o"})):"%s emitted"),i$,c$].concat(G(d$?l$.map(ye):l$)));try{a$.apply(void 0,u$)}catch(h$){s$.logError("Caught in the callback function of the event %s",c$,h$)}}}return s$}la(t$,e$);var r$=ma(t$);return t$}(ea)},DC=function(e$){return kl(console.log.bind(console),"INFO",e$)},EC=function(e$){return kl(console.warn.bind(console),"WARN",e$)},FC=function(e$){return kl(console.error.bind(console),"ERROR",e$)},Tr=function(e$,t$){return function(r$){var n$=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",i$=Sr(e$),o$=console.debug.bind(console),s$=Rr(r$,t$,function(a$){return o$(i$(a$))});return function(a$){for(var c$=arguments.length,u$=Array(1<c$?c$-1:0),l$=1;l$<c$;l$++)u$[l$-1]=arguments[l$];return s$.apply(void 0,[n$+a$].concat(u$))}}},GC=function(e$,t$){return function(r$){return Tr(e$,t$)("RTM:TRACK","[".concat(r$,"] "))}},Li=t.URI,eu=Oh,HC=ff(VB,["Wrapper"]),$m=Gk(HC,"URI"),Ur=function(e$,t$){var r$=-1,n$=e$.length,i$=n$-1;for(t$=t$===void 0?n$:t$;++r$<t$;){var o$=e$[n$=nr(r$,i$)];e$[n$]=e$[r$],e$[r$]=o$}return e$.length=t$,e$},IC=function(e$){return Ur(Xh(e$))},JC=function(e$){return Ur(Ni(e$))},$e=function(e$){return(Va(e$)?IC:JC)(e$)},af={0:9591,1:9593},$d=function(e$){return"https://".concat(e$,"/api/v1")},KC=bb.apply(void 0,G($e(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map($d)))),LC=bb.apply(void 0,G($e(["ap-web-1.agora.io","ap-web-2.agora.io"].map($d)))),MC=bb.apply(void 0,G($e(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map($d)))),NC=bb.apply(void 0,G($e(["ap-web-3.agora.io","ap-web-4.agora.io"].map($d)))),ll=Ph(),ml=function(e$){function t$(n$,i$,o$,s$,a$,c$){W(this,t$);var u$=r$.call(this,a$,Ai("Socket-",a$.loggerId));if(m(n(u$),"isActiveClose",!1),m(n(u$),"loggedIn",!1),m(n(u$),"useNewDomain",void 0),m(n(u$),"receivedPacket",new Pa),m(n(u$),"open$",void 0),m(n(u$),"input$",new Pa),m(n(u$),"userJoin$",new Pa),m(n(u$),"attemptsSinceLastError",0),m(n(u$),"message$",new Pa),m(n(u$),"socket$",void 0),m(n(u$),"toClose",new Pa),m(n(u$),"toReconnect",new Pa),m(n(u$),"sendLogger",void 0),m(n(u$),"receiveLogger",void 0),m(n(u$),"ip",void 0),m(n(u$),"env",void 0),m(n(u$),"ticket",void 0),m(n(u$),"context",void 0),m(n(u$),"getDomain",function(){return an(u$.ip,u$.useNewDomain)}),m(n(u$),"socketReconnector",function(h$){var p$=function(_$){return u$.attemptsSinceLastError+=1,u$.warn("The %s of Env %d reconnecting %s",u$.name,u$.env,_$.message),Bc(3e3)};return h$.pipe(Ga(function(_$){return u$.log("socket connection closed"),u$.loggedIn=!1,2<=u$.attemptsSinceLastError?(u$.warn("socket connection failure"),u$.emit("connectionFailure"),u$.close(),Z(_$)):u$.isActiveClose?vb:(u$.emit("reconnect"),u$.useNewDomain=!u$.useNewDomain,Z(_$))}),oe(function(_$){return _$.pipe(Cc(p$))}))}),u$.ip=n$,u$.env=i$,u$.ticket=o$,u$.context=s$,u$.useNewDomain=c$??.5<=Math.random(),u$.sendLogger=u$.genLogger("RTM:MSG:SEND"),u$.receiveLogger=u$.genLogger("RTM:MSG:RECV"),i$!==0&&i$!==1)throw new ll({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});if(!Gm(n$))throw new ll({IP_NOT_VALID:"The ip from ap is not valid"});var l$=af[i$];u$.log("Opening websocket address %s for the Env %d",u$.ip,u$.env);var d$=Xb(u$.input$,u$.userJoin$.pipe(Rt(2)),u$.message$).pipe(ba(function(h$){return Oh.encode(h$).finish()}));return n$=Xb(St("",{protocols:[],makeWebSocket:function(){if(u$.context.config.enableCloudProxy){if(u$.context.cloudProxyServers.length===0)throw u$.logError("No cloud proxy server to connect"),new da;var h$="wss://".concat(an(bn(u$.context.cloudProxyServers),!1),"/");h$=we(h$,"sid",u$.context.sid),h$=we(h$,"remote_port",l$.toString()),h$=we(h$,"remote_ip",u$.ip),h$=we(h$,"token",u$.context.key),h$=new WebSocket(h$)}else h$=new WebSocket("wss://".concat(u$.getDomain(),":").concat(l$));return h$.binaryType="arraybuffer",h$}}),u$.toReconnect),u$.socket$=Ca(n$,Tk.pipe(hb(15e3),Ga(function(h$){return Sa(h$)&&u$.warn("socket open timed out"),Z(h$)}))).pipe(ba(function(h$){if(h$ instanceof Error)throw u$.warn("Env_%d: Force reconnect the socket",u$.env),h$;return h$(d$).pipe(ba(function(p$){return Oh.decode(new Uint8Array(p$))}))}),u$.socketReconnector),u$.open$=u$.socket$.pipe(ca(function(h$){u$.log("Websocket opened",u$.name),h$.subscribe(function(p$){var _$=p$.data;p$=Li[p$.uri].slice(0,-3),_$=$m[p$].decode(_$);var f$=HA({},Gk(_$,"toJSON"),function(y$,S$){return S$ instanceof U?Km(S$):S$}),m$=!1;if((_$ instanceof vr||_$ instanceof ur)&&_$.instance.lessThanOrEqual(4294967295)&&(m$=!0),_$ instanceof wr||_$ instanceof xr){var g$=_$.instance,v$=_$.sequence;(_$.dialogue.lessThanOrEqual(4294967295)||g$.lessThanOrEqual(4294967295)||v$.lessThan(1))&&(m$=!0)}m$?u$.warn("Env_%d: Illegal %s, abandoned %o",u$.env,p$,f$):(p$!=="Pong"&&u$.receiveLogger("Env_%d: %s %o",u$.env,p$,f$),u$.receivedPacket.next([p$,_$]))},function(){})}),qf(void 0),ob(u$.toClose),pe()),u$}la(t$,e$);var r$=ma(t$);return Ha(t$,[{key:"address",get:function(){return"".concat(this.ip,":").concat(af[this.env])}},{key:"sendPacket",value:function(n$,i$){if(n$!=="Ping"){var o$=uc(i$,function(s$){return s$ instanceof U?Km(s$):s$});this.sendLogger("Env_%d: %s %o",this.env,n$,o$)}i$=du(n$,i$),n$==="UserJoin"?this.userJoin$.next(i$):n$==="Message"?this.message$.next(i$):this.input$.next(i$)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(n$){var i$=this;return this.receivedPacket.pipe(ca(function(o$){var s$=ra(o$,2);o$=s$[0],s$=s$[1],o$==="UserResp"&&(i$.attemptsSinceLastError=0,i$.loggedIn=!0),o$==="UserDrop"&&i$.emit("socketUserDrop",s$)}),wb(function(o$){return ra(o$,1)[0]===n$}),ba(function(o$){return ra(o$,2)[1]}))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new ll({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),t$}(tb());N({target:"String",proto:!0,forced:zr},{padStart:function(e$){return XB(this,e$,1<arguments.length?arguments[1]:void 0)}});var OC=function(e$){var t$=xf(Kg);e$=Yt(e$);for(var r$=0;r$<t$.length;r$++){var n$=Kg[t$[r$]];if(n$!=null&&n$.AP_DOMAINS.includes(e$)||n$!=null&&n$.AP_BACKUP_DOMAINS.includes(e$)||n$!=null&&n$.PROXY_AP.includes(e$))return[n$.CODE]}return[F.CHINA,F.GLOBAL]},PC={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},Vr={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},QC=[100,101,102],Qh=/web-(\d)/,Wr=function(e$){function t$(n$,i$){var o$=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,t$);var s$=r$.call(this,i$,"AccessPoint");return m(n(s$),"handleUniLbsError",function(a$,c$){var u$=a$;if(4<a$.toString().length){var l$=a$.toString().padStart(8,"0"),d$=parseInt(l$.slice(0,4),10);if(l$=parseInt(l$.slice(4,8),10),d$===201)u$=l$;else if(d$===101&&!QC.includes(l$))return Z(Error("service is currently unavailable"))}if(d$=u$.toString(),!Object.keys(Vr).includes(d$))return(a$=new da(["Login is rejected by the server. The response code is %d",a$],jg)).serverCode=u$,Z(a$);switch(d$=Vr[d$],u$=PC[d$],d$){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(c$=new Ye(u$,$q)).serverCode=a$,Z(c$);case"INVALID_USER_ID":return(c$=new Ye(u$,Jh)).serverCode=a$,Z(c$);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(c$=new Ye(u$,Kh)).serverCode=a$,Z(c$);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(c$=new Ye(u$,ar)).serverCode=a$,Z(c$);case"CANNOT_MEET_AREA_DEMAND":return(c$=OC(c$)).forEach(function(h$){return s$.failedAreas.add(h$)}),s$.failedAreas.size===(M===void 0?2:M.CODES.size)?((c$=new I(u$,jg)).serverCode=a$,Z(c$)):Z(Error("ap ".concat(c$.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(c$=new da(u$,jg)).serverCode=a$,Z(c$);default:return Z(Im("ApResErrType",d$))}}),m(n(s$),"getApEdgeInfo$",void 0),m(n(s$),"getApEdgeInfoEndFirst$",void 0),m(n(s$),"apFinish$",new Pa),m(n(s$),"retryCount",0),m(n(s$),"failedAreas",new Set),m(n(s$),"usedUrl",[]),m(n(s$),"newDomainUsed",!1),m(n(s$),"backupNewDomainUsed",!1),m(n(s$),"genUrl",function(){return M===void 0?mi.apply(void 0,G($e([KC,LC]))).pipe(ni(function(a$){return bb.apply(void 0,G(a$))})):bb.apply(void 0,G(M.AP_DOMAINS.slice(0,3).map($d)))}),m(n(s$),"genBackupUrl",function(){return M===void 0?mi.apply(void 0,G($e([MC,NC]))).pipe(ni(function(a$){return bb.apply(void 0,G(a$))})):bb.apply(void 0,G(M.AP_BACKUP_DOMAINS.slice(0,3).map($d)))}),m(n(s$),"getApUrl$",function(a$){var c$,u$;return s$.genUrl().pipe(wb(function(l$){return(!s$.newDomainUsed||!l$.includes("sd-rtn.com"))&&(l$.includes("sd-rtn.com")&&(s$.newDomainUsed=!0),!dl(s$.usedUrl,function(d$){var h$;return d$===((h$=l$.match(Qh))===null||h$===void 0?void 0:h$[1])}))}),ca(function(l$){var d$;M===void 0&&typeof(l$=(d$=l$.match(Qh))===null||d$===void 0?void 0:d$[1])=="string"&&s$.usedUrl.push(l$)}),Ka(a$?Math.max(Nc.RECONNECTING_AP_NUM,(c$=M==null?void 0:M.CODES.size)!==null&&c$!==void 0?c$:0):(u$=M==null?void 0:M.CODES.size)!==null&&u$!==void 0?u$:2),Dd(function(){return t$.runOutOfUrlSymbol}),Ga(function(l$,d$){return s$.newDomainUsed=!1,l$===t$.runOutOfUrlSymbol?(s$.usedUrl=[],d$):Z(l$)}))}),m(n(s$),"getBackupApUrl$",function(a$){var c$,u$;return s$.genBackupUrl().pipe(wb(function(l$){return(!s$.backupNewDomainUsed||!l$.includes("sd-rtn.com"))&&(l$.includes("sd-rtn.com")&&(s$.backupNewDomainUsed=!0),!dl(s$.usedUrl,function(d$){var h$;return d$===((h$=l$.match(Qh))===null||h$===void 0?void 0:h$[1])}))}),ca(function(l$){var d$;M===void 0&&typeof(l$=(d$=l$.match(Qh))===null||d$===void 0?void 0:d$[1])=="string"&&s$.usedUrl.push(l$)}),Ka(a$?Math.max(Nc.RECONNECTING_AP_NUM,(c$=M==null?void 0:M.CODES.size)!==null&&c$!==void 0?c$:0):(u$=M==null?void 0:M.CODES.size)!==null&&u$!==void 0?u$:2),Dd(function(){return t$.runOutOfUrlSymbol}),Ga(function(l$,d$){return s$.backupNewDomainUsed=!1,l$===t$.runOutOfUrlSymbol?(s$.usedUrl=[],d$):Z(l$)}))}),m(n(s$),"getProxyApUrl$",function(a$){var c$,u$;return bb.apply(void 0,G(((M==null?void 0:M.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map($d))).pipe(Ka(a$?Math.max(Nc.RECONNECTING_AP_NUM,(c$=M==null?void 0:M.CODES.size)!==null&&c$!==void 0?c$:0):(u$=M==null?void 0:M.CODES.size)!==null&&u$!==void 0?u$:2))}),m(n(s$),"context",void 0),m(n(s$),"fetchCloudProxy",function(a$,c$){var u$=Ai("AP-",s$.loggerId);s$.log("The AccessPoint requests %s(%s)",a$,u$);var l$=new AbortController;return s$.apFinish$.pipe(Ka(1)).subscribe(function(){return l$.abort()}),ad(J(w.mark(function d$(){var h$;return w.wrap(function(p$){for(;;)switch(p$.prev=p$.next){case 0:return h$=Ag(0,Number.MAX_SAFE_INTEGER),s$.log("%s request opid: %d",u$,h$),p$.abrupt("return",te(a$,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:s$.context.sid,opid:h$,appid:s$.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:c$??s$.context.key,cname:s$.context.uid,uid:0,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(_$){return _$===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):_$}).join(",")})}}]},signal:l$.signal}));case 3:case"end":return p$.stop()}},d$)}))).pipe(Ga(function(d$){return d$.name!=="AbortError"&&(s$.logError(d$),s$.warn("The AP server %s request failure",a$,d$)),vb}),cb(function(){var d$=J(w.mark(function h$(p$){var _$,f$,m$,g$,v$,y$,S$,b$,$$,C$,N$,k$,O$,U$,x$,F$,L$,M$,V$;return w.wrap(function(A$){for(;;)switch(A$.prev=A$.next){case 0:if(_$=p$.responseText,f$=JSON.parse(_$),s$.log("The %s response is %o",u$,f$),((m$=f$.response_body)===void 0||m$.length===0||m$.some(function(I$){var P$;return((P$=I$.buffer)===null||P$===void 0?void 0:P$.code)===void 0||I$.uri!==23}))&&Z(new da("cloud proxy response_body not valid",jg)),(g$=m$.filter(function(I$){return I$.buffer.code!==0})).length===0){A$.next=14;break}if((v$=g$.find(function(I$){return I$.buffer.flag===128}))===void 0){A$.next=12;break}return A$.abrupt("return",s$.handleUniLbsError(v$.buffer.code,a$));case 12:return s$.logError("cloud proxy error response"),A$.abrupt("return",s$.handleUniLbsError(g$[0].buffer.code,a$));case 14:for(y$=[],S$=0;S$<m$.length;S$++)if(((C$=m$[S$])==null||(b$=C$.buffer)===null||b$===void 0?void 0:b$.flag)===262144)(N$=C$.buffer)===null||N$===void 0||(k$=N$.edges_services)===null||k$===void 0||(O$=k$.forEach)===null||O$===void 0||O$.call(k$,function(I$){Gm(I$=I$.ip)&&s$.context.cloudProxyServers.indexOf(I$)===-1&&(s$.log("got cloud proxy server: %s",I$),s$.context.cloudProxyServers.push(I$))});else if((C$==null||($$=C$.buffer)===null||$$===void 0?void 0:$$.flag)===128){for(L$=function(I$,P$){var w$=P$[I$];y$.some(function(E$){return E$.ip===w$.ip})||y$.push({ip:w$.ip,ticket:C$.buffer.cert})},M$=0,V$=C$.buffer.edges_services;M$<V$.length;M$++)L$(M$,V$);s$.context.rtmArea=(U$=(x$=C$.buffer)===null||x$===void 0||(F$=x$.detail)===null||F$===void 0?void 0:F$[9])!==null&&U$!==void 0?U$:""}return A$.abrupt("return",bb.apply(void 0,G(y$).concat([fg])));case 19:case"end":return A$.stop()}},h$)}));return function(h$){return d$.apply(this,arguments)}}()),Ga(function(d$){return sa(d$)?Z(d$):vb}),tg(),wb(function(d$){return d$!==void 0&&typeof d$.ip=="string"&&typeof d$.ticket=="string"}))}),m(n(s$),"fetchAp",function(a$,c$){var u$=Ai("AP-",s$.loggerId);s$.log("The AccessPoint requests %s(%s)",a$,u$);var l$=new AbortController;return s$.apFinish$.pipe(Ka(1)).subscribe(function(){return l$.abort()}),ad(J(w.mark(function d$(){var h$;return w.wrap(function(p$){for(;;)switch(p$.prev=p$.next){case 0:return h$=Ag(0,Number.MAX_SAFE_INTEGER),s$.log("%s request opid: %d",u$,h$),p$.abrupt("return",te(a$,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:h$,key:c$||s$.context.key,cname:s$.context.uid,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(_$){return _$===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):_$}).join(",")}),uid:0,sid:s$.context.sid},signal:l$.signal}));case 3:case"end":return p$.stop()}},d$)}))).pipe(Ga(function(d$){return d$.name!=="AbortError"&&(s$.logError(d$),s$.warn("The AP server %s request failure",a$,d$)),vb}),cb(function(){var d$=J(w.mark(function h$(p$){var _$,f$,m$,g$,v$,y$,S$;return w.wrap(function(b$){for(;;)switch(b$.prev=b$.next){case 0:if(_$=p$.responseText,f$=JSON.parse(_$),s$.log("The %s response is %o",u$,f$),g$=(m$=f$).code,v$=m$.addresses,y$=m$.detail,g$===0){b$.next=6;break}return b$.abrupt("return",s$.handleUniLbsError(g$,a$));case 6:if((S$=v$).length!==0){b$.next=11;break}return b$.abrupt("return",Z(Error("No available edge address to connect")));case 11:return s$.context.rtmArea=y$==null?void 0:y$[9],b$.abrupt("return",bb.apply(void 0,G(S$).concat([fg])));case 13:case"end":return b$.stop()}},h$)}));return function(h$){return d$.apply(this,arguments)}}()),tg(),Ga(function(d$){return sa(d$)?Z(d$):vb}),wb(function(d$){return d$!==void 0&&typeof d$.ip=="string"&&typeof d$.ticket=="string"}))}),s$.context=n$,s$.getApEdgeInfoEndFirst$=function(){var a$=0<arguments.length&&arguments[0]!==void 0&&arguments[0];return Bc(0,a$||o$?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(1),ca(function(){s$.retryCount+=1}),cb(function(){return s$.context.config.enableCloudProxy?s$.getProxyApUrl$(a$||o$):(4<=s$.retryCount&&(s$.retryCount=0),3>=s$.retryCount?s$.getApUrl$(a$||o$):s$.getBackupApUrl$(a$||o$))}),cb(function(c$){return s$.context.config.enableCloudProxy?s$.fetchCloudProxy(c$):s$.fetchAp(c$)}),Ga(function(c$){return c$ instanceof pb&&s$.warn("AP request timeout"),Z(c$)}),om(function(c$){return c$.ip}),ob(s$.apFinish$))},s$.getApEdgeInfo$=function(a$){return Bc(0,a$||o$?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(8),ca(function(){s$.retryCount+=1}),cb(function(){return s$.context.config.enableCloudProxy?s$.getProxyApUrl$(a$||o$):3>=s$.retryCount?s$.getApUrl$(a$||o$):s$.getBackupApUrl$(a$||o$)}),cb(function(c$){return(s$.context.config.enableCloudProxy?s$.fetchCloudProxy(c$):s$.fetchAp(c$)).pipe()}),Ga(function(c$){return c$ instanceof pb&&s$.warn("AP request timeout"),Z(c$)}),om(function(c$){return c$.ip}),ob(s$.apFinish$))},s$}la(t$,e$);var r$=ma(t$);return Ha(t$,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),t$}(tb());m(Wr,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var Xr=Ph(),Yr=function(e$){function t$(n$,i$,o$){W(this,t$);var s$=r$.call(this,i$,"Connection");m(n(s$),"apClient",void 0),m(n(s$),"lastOpenSockets",[new qe(1),new qe(1)]),m(n(s$),"curOpenSockets",[void 0,void 0]),m(n(s$),"ipIterator",0),m(n(s$),"firstEnv",.5<=Math.random()?1:0),m(n(s$),"firstSocketOpener",void 0),m(n(s$),"secondSocketOpener",void 0),m(n(s$),"firstOpenKeeperSubject",new Pa),m(n(s$),"secondOpenKeeperSubject",new Pa),m(n(s$),"edgeInfoReplayed",void 0),m(n(s$),"firstEnvOpenSocket",void 0),m(n(s$),"firstOpenKeeperSub",void 0),m(n(s$),"secondOpenKeeperSub",void 0),m(n(s$),"context",void 0),m(n(s$),"logger",void 0),s$.context=n$,s$.logger=i$,s$.apClient=new Wr(s$.context,i$),s$.apClient.apFinish$.subscribe(function(){s$.log("Ap client fetch finished")});var a$,c$=[];return s$.edgeInfoReplayed=s$.apClient.getApEdgeInfo$(o$).pipe(oe(function(u$){return u$.pipe(ca(function(l$){if(sa(l$))throw l$}),cd(o$?Zd.getParameter("RECONNECTING_AP_INTERVAL"):900),ob(Bc(2e4)))}),wb(function(u$){return!dl(c$,u$)}),Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),ca(function(u$){c$.push(u$),s$.log("An edge info got %o",u$)}),ca({error:function(u$){s$.emit("connectionInitFailure",u$)}}),wg(function(){s$.apClient.clearUp()}),sm()),s$.firstEnvOpenSocket=s$.edgeInfoReplayed.pipe(cb(function(u$){if(u$===void 0)return Z(Error("Invalid edge info"));var l$=new ml(u$.ip,s$.firstEnv,u$.ticket,s$.context,i$,a$);return s$.firstEnv=s$.firstEnv===1?0:1,l$.on("connectionFailure",function(){return s$.onSocketConnectionFailure(l$)}),a$=!l$.useNewDomain,l$.open$.pipe(qf(l$))}),ca(function(u$){s$.log("The websocket of ENV_%d opened to %s:%d",u$.env,u$.ip,af[u$.env]),s$.curOpenSockets[u$.env]=u$,s$.lastOpenSockets[u$.env].next(u$),s$.firstEnv=u$.env,s$.openSecondSocket(u$.env,u$.ip,u$.useNewDomain)}),Ka(1),pe()),s$.firstSocketOpener=s$.firstEnvOpenSocket.pipe(cb(function(u$){return u$.open$.pipe(ca(function(){s$.log("The websocket of first ENV_%d re-opened to %s:%d",u$.env,u$.ip,af[u$.env]),s$.curOpenSockets[u$.env]=u$,s$.lastOpenSockets[u$.env].next(u$)}))})),n$=s$.firstOpenKeeperSubject.pipe(Cc(Yc)),s$.firstOpenKeeperSub=n$.subscribe({error:s$.logError}),s$}la(t$,e$);var r$=ma(t$);return Ha(t$,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(n$,i$){if(![0,1].includes(n$))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});var o$=n$===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var s$=this.curOpenSockets[n$];this.curOpenSockets[n$]=void 0,s$&&(s$.isActiveClose=!0,setTimeout(function(){s$.close()},i$)),o$!==void 0&&setTimeout(function(){o$==null||o$.unsubscribe()},i$)}},{key:"waitClosing",value:function(n$){var i$=this;return n$.isActiveClose=!0,n$.open$.pipe(tt(),Ga(function(o$){return o$.message===mr.normalClosureMessage?vb:Z(o$)}),hb(5e3),Ga(function(o$){return o$ instanceof pb?(i$.warn("Force closing the ENV_%d connection",n$.env),vb):Z(o$)}))}},{key:"onSocketConnectionFailure",value:function(n$){var i$=[0,1].filter(function(o$){return o$!==n$.env})[0];(i$=this.curOpenSockets[i$])&&i$.loggedIn?this.reopenSocketWithApRequest(n$.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(n$,i$,o$){var s$=this,a$=n$===1?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(rm(function(c$,u$){return[].concat(G(c$),[u$])},[]),ba(function(c$){return kr(c$,function(u$){return Jm(i$,u$.ip)}).slice(-1)[0]}),Ka(1),cb(function(c$){if(c$===void 0)return Z(Error("Invalid edge info"));var u$=new ml(c$.ip,a$,c$.ticket,s$.context,s$.logger,o$);return u$.on("connectionFailure",function(){return s$.onSocketConnectionFailure(u$)}),u$.open$.pipe(ca(function(){s$.lastOpenSockets[a$].next(u$),s$.curOpenSockets[a$]=u$}))}),pe()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Cc(Yc)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(n$){var i$=this,o$=[0,1].filter(function(c$){return c$!==n$})[0];if((o$=this.curOpenSockets[o$])!==void 0){var s$,a$=o$.ip;o$=this.apClient.getApEdgeInfoEndFirst$(!0).pipe(Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),oe(function(c$){return c$.pipe(ca(function(u$){if(u$.code===Kh)i$.emit("tokenExpired"),i$.apClient.apFinish$.next(void 0);else if(sa(u$))throw u$}),cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")),ob(Bc(15e3)))}),ca(function(c$){i$.log("An edge info got %o",c$)}),wg(function(){i$.apClient.clearUp()})).pipe(rm(function(c$,u$){return[].concat(G(c$),[u$])},[]),ba(function(c$){return(c$=kr(c$,function(u$){return Jm(a$,u$.ip)})).length-1>=i$.ipIterator?c$.slice(-i$.ipIterator++-1)[0]:(i$.ipIterator=0,c$.slice(-1)[0])}),Dd(),cb(function(c$){if(c$===void 0)return Z(Error("Invalid edge info"));var u$=new ml(c$.ip,n$,c$.ticket,i$.context,i$.logger,s$);return u$.on("connectionFailure",function(){return i$.onSocketConnectionFailure(u$)}),s$=!u$.useNewDomain,u$.open$.pipe(qf(u$))}),ca(function(c$){i$.log("The websocket of ENV_%d re-opened to %s:%d using ap",c$.env,c$.ip,af[c$.env]),i$.curOpenSockets[n$]=c$,i$.lastOpenSockets[n$].next(c$)}),cb(function(c$){return c$.open$.pipe(ca(function(){i$.log("The websocket of ENV_%d re-opened to %s:%d",c$.env,c$.ip,af[c$.env]),i$.curOpenSockets[n$]=c$,i$.lastOpenSockets[n$].next(c$)}))}),pe()),n$===this.firstEnv?this.firstOpenKeeperSubject.next(o$):this.secondOpenKeeperSubject.next(o$)}}}]),t$}(tb()),Xc=fc.Writer,na=fc.util,zc=fc.roots.default||(fc.roots.default={}),RC=zc.Session=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.sid="",e$.prototype.userId="",e$.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e$.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e$.prototype.appId="",e$.prototype.ver="",e$.prototype.buildno=0,e$.prototype.installId="",e$.prototype.os=0,e$.prototype.did="",e$.prototype.index=null,e$.prototype.token="",e$.prototype.version=0,e$.prototype.subVersion=0,e$.encode=function(t$,r$){return r$||(r$=Xc.create()),t$.sid!=null&&Object.hasOwnProperty.call(t$,"sid")&&r$.uint32(10).string(t$.sid),t$.userId!=null&&Object.hasOwnProperty.call(t$,"userId")&&r$.uint32(18).string(t$.userId),t$.lts!=null&&Object.hasOwnProperty.call(t$,"lts")&&r$.uint32(24).int64(t$.lts),t$.elapse!=null&&Object.hasOwnProperty.call(t$,"elapse")&&r$.uint32(32).int64(t$.elapse),t$.appId!=null&&Object.hasOwnProperty.call(t$,"appId")&&r$.uint32(42).string(t$.appId),t$.ver!=null&&Object.hasOwnProperty.call(t$,"ver")&&r$.uint32(50).string(t$.ver),t$.buildno!=null&&Object.hasOwnProperty.call(t$,"buildno")&&r$.uint32(56).int32(t$.buildno),t$.installId!=null&&Object.hasOwnProperty.call(t$,"installId")&&r$.uint32(66).string(t$.installId),t$.os!=null&&Object.hasOwnProperty.call(t$,"os")&&r$.uint32(128).int32(t$.os),t$.did!=null&&Object.hasOwnProperty.call(t$,"did")&&r$.uint32(138).string(t$.did),t$.index!=null&&Object.hasOwnProperty.call(t$,"index")&&zc.Session.CommonIndex.encode(t$.index,r$.uint32(162).fork()).ldelim(),t$.token!=null&&Object.hasOwnProperty.call(t$,"token")&&r$.uint32(170).string(t$.token),t$.version!=null&&Object.hasOwnProperty.call(t$,"version")&&r$.uint32(176).int32(t$.version),t$.subVersion!=null&&Object.hasOwnProperty.call(t$,"subVersion")&&r$.uint32(184).int32(t$.subVersion),r$},e$.CommonIndex=function(){function t$(r$){if(r$)for(var n$=Object.keys(r$),i$=0;i$<n$.length;++i$)r$[n$[i$]]!=null&&(this[n$[i$]]=r$[n$[i$]])}return t$.prototype.index1="",t$.prototype.index2="",t$.prototype.index3="",t$.encode=function(r$,n$){return n$||(n$=Xc.create()),r$.index1!=null&&Object.hasOwnProperty.call(r$,"index1")&&n$.uint32(10).string(r$.index1),r$.index2!=null&&Object.hasOwnProperty.call(r$,"index2")&&n$.uint32(18).string(r$.index2),r$.index3!=null&&Object.hasOwnProperty.call(r$,"index3")&&n$.uint32(26).string(r$.index3),n$},t$}(),e$}(),SC=zc.Link=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.sid="",e$.prototype.userId="",e$.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e$.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e$.prototype.ec=0,e$.prototype.sc=0,e$.prototype.destServerIp="",e$.prototype.ackedServerIp="",e$.prototype.responseTime=0,e$.encode=function(t$,r$){return r$||(r$=Xc.create()),t$.sid!=null&&Object.hasOwnProperty.call(t$,"sid")&&r$.uint32(10).string(t$.sid),t$.userId!=null&&Object.hasOwnProperty.call(t$,"userId")&&r$.uint32(18).string(t$.userId),t$.lts!=null&&Object.hasOwnProperty.call(t$,"lts")&&r$.uint32(24).int64(t$.lts),t$.elapse!=null&&Object.hasOwnProperty.call(t$,"elapse")&&r$.uint32(32).int64(t$.elapse),t$.ec!=null&&Object.hasOwnProperty.call(t$,"ec")&&r$.uint32(40).int32(t$.ec),t$.sc!=null&&Object.hasOwnProperty.call(t$,"sc")&&r$.uint32(48).int32(t$.sc),t$.destServerIp!=null&&Object.hasOwnProperty.call(t$,"destServerIp")&&r$.uint32(58).string(t$.destServerIp),t$.ackedServerIp!=null&&Object.hasOwnProperty.call(t$,"ackedServerIp")&&r$.uint32(66).string(t$.ackedServerIp),t$.responseTime!=null&&Object.hasOwnProperty.call(t$,"responseTime")&&r$.uint32(72).int32(t$.responseTime),r$},e$}(),TC=zc.Logout=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.sid="",e$.prototype.userId="",e$.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e$.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e$.encode=function(t$,r$){return r$||(r$=Xc.create()),t$.sid!=null&&Object.hasOwnProperty.call(t$,"sid")&&r$.uint32(10).string(t$.sid),t$.userId!=null&&Object.hasOwnProperty.call(t$,"userId")&&r$.uint32(18).string(t$.userId),t$.lts!=null&&Object.hasOwnProperty.call(t$,"lts")&&r$.uint32(24).int64(t$.lts),t$.elapse!=null&&Object.hasOwnProperty.call(t$,"elapse")&&r$.uint32(32).int64(t$.elapse),r$},e$}(),UC=zc.KickedOff=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.sid="",e$.prototype.userId="",e$.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e$.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e$.prototype.linkId=0,e$.prototype.code=0,e$.prototype.server="",e$.prototype.serverCode=0,e$.encode=function(t$,r$){return r$||(r$=Xc.create()),t$.sid!=null&&Object.hasOwnProperty.call(t$,"sid")&&r$.uint32(10).string(t$.sid),t$.userId!=null&&Object.hasOwnProperty.call(t$,"userId")&&r$.uint32(18).string(t$.userId),t$.lts!=null&&Object.hasOwnProperty.call(t$,"lts")&&r$.uint32(24).int64(t$.lts),t$.elapse!=null&&Object.hasOwnProperty.call(t$,"elapse")&&r$.uint32(32).int64(t$.elapse),t$.linkId!=null&&Object.hasOwnProperty.call(t$,"linkId")&&r$.uint32(48).int32(t$.linkId),t$.code!=null&&Object.hasOwnProperty.call(t$,"code")&&r$.uint32(56).int32(t$.code),t$.server!=null&&Object.hasOwnProperty.call(t$,"server")&&r$.uint32(66).string(t$.server),t$.serverCode!=null&&Object.hasOwnProperty.call(t$,"serverCode")&&r$.uint32(72).int32(t$.serverCode),r$},e$}(),VC=zc.ChnJoin=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.sid="",e$.prototype.userId="",e$.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e$.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e$.prototype.cname="",e$.prototype.errCode=0,e$.encode=function(t$,r$){return r$||(r$=Xc.create()),t$.sid!=null&&Object.hasOwnProperty.call(t$,"sid")&&r$.uint32(10).string(t$.sid),t$.userId!=null&&Object.hasOwnProperty.call(t$,"userId")&&r$.uint32(18).string(t$.userId),t$.lts!=null&&Object.hasOwnProperty.call(t$,"lts")&&r$.uint32(24).int64(t$.lts),t$.elapse!=null&&Object.hasOwnProperty.call(t$,"elapse")&&r$.uint32(32).int64(t$.elapse),t$.cname!=null&&Object.hasOwnProperty.call(t$,"cname")&&r$.uint32(50).string(t$.cname),t$.errCode!=null&&Object.hasOwnProperty.call(t$,"errCode")&&r$.uint32(56).int32(t$.errCode),r$},e$}(),WC=zc.ChnJoinRes=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.sid="",e$.prototype.userId="",e$.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e$.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e$.prototype.cname="",e$.prototype.errCode=0,e$.prototype.serverErrCode=0,e$.encode=function(t$,r$){return r$||(r$=Xc.create()),t$.sid!=null&&Object.hasOwnProperty.call(t$,"sid")&&r$.uint32(10).string(t$.sid),t$.userId!=null&&Object.hasOwnProperty.call(t$,"userId")&&r$.uint32(18).string(t$.userId),t$.lts!=null&&Object.hasOwnProperty.call(t$,"lts")&&r$.uint32(24).int64(t$.lts),t$.elapse!=null&&Object.hasOwnProperty.call(t$,"elapse")&&r$.uint32(32).int64(t$.elapse),t$.cname!=null&&Object.hasOwnProperty.call(t$,"cname")&&r$.uint32(50).string(t$.cname),t$.errCode!=null&&Object.hasOwnProperty.call(t$,"errCode")&&r$.uint32(56).int32(t$.errCode),t$.serverErrCode!=null&&Object.hasOwnProperty.call(t$,"serverErrCode")&&r$.uint32(64).int32(t$.serverErrCode),r$},e$}(),XC=zc.ChnLeave=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.sid="",e$.prototype.userId="",e$.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e$.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e$.prototype.cname="",e$.prototype.errCode=0,e$.encode=function(t$,r$){return r$||(r$=Xc.create()),t$.sid!=null&&Object.hasOwnProperty.call(t$,"sid")&&r$.uint32(10).string(t$.sid),t$.userId!=null&&Object.hasOwnProperty.call(t$,"userId")&&r$.uint32(18).string(t$.userId),t$.lts!=null&&Object.hasOwnProperty.call(t$,"lts")&&r$.uint32(24).int64(t$.lts),t$.elapse!=null&&Object.hasOwnProperty.call(t$,"elapse")&&r$.uint32(32).int64(t$.elapse),t$.cname!=null&&Object.hasOwnProperty.call(t$,"cname")&&r$.uint32(50).string(t$.cname),t$.errCode!=null&&Object.hasOwnProperty.call(t$,"errCode")&&r$.uint32(56).int32(t$.errCode),r$},e$}(),YC=zc.ConnectionStateChange=function(){function e$(t$){if(t$)for(var r$=Object.keys(t$),n$=0;n$<r$.length;++n$)t$[r$[n$]]!=null&&(this[r$[n$]]=t$[r$[n$]])}return e$.prototype.sid="",e$.prototype.userId="",e$.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e$.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e$.prototype.oldState=0,e$.prototype.newState=0,e$.prototype.reason=0,e$.prototype.reconnId=0,e$.encode=function(t$,r$){return r$||(r$=Xc.create()),t$.sid!=null&&Object.hasOwnProperty.call(t$,"sid")&&r$.uint32(10).string(t$.sid),t$.userId!=null&&Object.hasOwnProperty.call(t$,"userId")&&r$.uint32(18).string(t$.userId),t$.lts!=null&&Object.hasOwnProperty.call(t$,"lts")&&r$.uint32(24).int64(t$.lts),t$.elapse!=null&&Object.hasOwnProperty.call(t$,"elapse")&&r$.uint32(32).int64(t$.elapse),t$.oldState!=null&&Object.hasOwnProperty.call(t$,"oldState")&&r$.uint32(40).int32(t$.oldState),t$.newState!=null&&Object.hasOwnProperty.call(t$,"newState")&&r$.uint32(48).int32(t$.newState),t$.reason!=null&&Object.hasOwnProperty.call(t$,"reason")&&r$.uint32(56).int32(t$.reason),t$.reconnId!=null&&Object.hasOwnProperty.call(t$,"reconnId")&&r$.uint32(64).int32(t$.reconnId),r$},e$}(),fu=Object.freeze({__proto__:null,Session:RC,Link:SC,Logout:TC,KickedOff:UC,ChnJoin:VC,ChnJoinRes:WC,ChnLeave:XC,ConnectionStateChange:YC,default:zc}),gu=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191}}),ZC=function(e$){function t$(n$,i$,o$){return W(this,t$),m(n(o$=r$.call(this,o$,"Context")),"_token",void 0),m(n(o$),"config",void 0),m(n(o$),"_uid",void 0),m(n(o$),"_sid",void 0),m(n(o$),"_area","CN"),m(n(o$),"appId",void 0),m(n(o$),"enableCloudProxy",!1),m(n(o$),"cloudProxyServers",[]),o$.appId=n$,o$.config=i$,o$}la(t$,e$);var r$=ma(t$);return Ha(t$,[{key:"token",set:function(n$){this._token=typeof n$=="string"&&n$?n$:void 0}},{key:"uid",get:function(){if(typeof this._uid=="string"&&this._uid)return this._uid;throw new Ia("Cannot get illegal uid")},set:function(n$){if(this.log("The user ID is set to %s",oa(n$)),!za(n$))throw new Ia;this._uid=n$}},{key:"key",get:function(){if(typeof this._token=="string"&&this._token)return this._token;if(typeof this.appId=="string"&&this.appId)return this.appId;throw new Ia("Cannot get illegal key")}},{key:"sid",get:function(){if(typeof this._sid=="string"&&this._sid)return this._sid;throw new Ia("Cannot get illegal sid")},set:function(n$){if(this.log("sid is set to %s",n$),typeof n$!="string"||!n$)throw new Ia;this._sid=n$}},{key:"rtmArea",get:function(){if(typeof this._area=="string"&&this._area)return this._area;throw new Ia("Cannot get illegal area")},set:function(n$){this.log("area is set to %s",n$),typeof n$=="string"&&n$?this._area=n$:this.warn("set area failed")}}]),t$}(tb()),$C=!!Fc&&R(function(){Fc.prototype.finally.call({then:function(){}},function(){})});if(N({target:"Promise",proto:!0,real:!0,forced:$C},{finally:function(e$){var t$=kd(this,mc("Promise")),r$=typeof e$=="function";return this.then(r$?function(n$){return mj(t$,e$()).then(function(){return n$})}:e$,r$?function(n$){return mj(t$,e$()).then(function(){throw n$})}:e$)}}),typeof Fc=="function"){var Zr=mc("Promise").prototype.finally;Fc.prototype.finally!==Zr&&Ta(Fc.prototype,"finally",Zr,{unsafe:!0})}var aD=function(){var e$=J(w.mark(function t$(r$){return w.wrap(function(n$){for(;;)switch(n$.prev=n$.next){case 0:return n$.t0=Uint8Array,n$.next=3,crypto.subtle.digest("SHA-256",r$);case 3:return n$.t1=n$.sent,n$.abrupt("return",new n$.t0(n$.t1));case 5:case"end":return n$.stop()}},t$)}));return function(t$){return e$.apply(this,arguments)}}(),$r=function(e$){return Array.from(e$).map(function(t$){return t$.toString(16).padStart(2,"0")}).join("")},bD=function(e$){if(typeof e$!="string")throw new TypeError("Expected input to be a string");if(e$.length%2!=0)throw new RangeError("Expected string to be an even number of characters");for(var t$=new Uint8Array(e$.length/2),r$=0;r$<e$.length;r$+=2)t$[r$/2]=parseInt(e$.substring(r$,r$+2),16);return t$},as=function(e$){return btoa(String.fromCharCode.apply(String,G(e$))).replace(/={1,2}$/,"")},bs=function(){var e$=J(w.mark(function t$(r$){var n$;return w.wrap(function(i$){for(;;)switch(i$.prev=i$.next){case 0:return i$.prev=0,i$.next=3,crypto.subtle.digest("SHA-1",r$);case 3:n$=i$.sent,i$.next=9;break;case 6:i$.prev=6,i$.t0=i$.catch(0),n$=sha1.arrayBuffer(r$);case 9:return i$.abrupt("return",as(new Uint8Array(n$)));case 10:case"end":return i$.stop()}},t$,null,[[0,6]])}));return function(t$){return e$.apply(this,arguments)}}(),cs=function(e$,t$,r$,n$){n$[t$]=!0,r$.has(e$)?r$.get(e$).add(t$):r$.set(e$,new Set([t$]))},cD=function(e$){switch(e$){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:return"application/octet-stream"}},ds=function(e$){function t$(n$,i$,o$,s$){W(this,t$);var a$=r$.call(this,o$,"ChunkDownloadManager");if(m(n(a$),"abortController",new AbortController),m(n(a$),"downloadedSize",0),m(n(a$),"successCount",0),m(n(a$),"timer",void 0),m(n(a$),"chunks",[]),m(n(a$),"retUnit",void 0),m(n(a$),"singleThread",!1),m(n(a$),"initialized",!1),m(n(a$),"ee",void 0),m(n(a$),"chunkCount",void 0),m(n(a$),"aborted",!1),m(n(a$),"serverToIndices",new Map),m(n(a$),"backupToIndices",new Map),m(n(a$),"indexToBackupServers",[]),m(n(a$),"busyBackupServers",new Map),m(n(a$),"downloadingChunks",new Set),m(n(a$),"metaInfo",void 0),m(n(a$),"transHandler",void 0),a$.metaInfo=n$,a$.transHandler=i$,a$.ee=s$===void 0?new ea:s$,o$=n$.size,n$=n$.unit,o$===0)throw new Ia("size cannot be 0");return i$.cancelSignal!==void 0&&i$.cancelSignal.addEventListener("abort",function(){a$.abortController.abort()},{once:!0}),a$.abortController.signal.addEventListener("abort",function(){a$.aborted=!0},{once:!0}),a$.chunkCount=Math.ceil(o$/(32768*n$)),a$}la(t$,e$);var r$=ma(t$);return Ha(t$,[{key:"setInfoByResponse",value:function(n$){var i$=this,o$=n$.serverList,s$=n$.backupList;if(n$=n$.unit,o$.length<this.chunkCount&&s$.length<this.chunkCount)throw new Ia("servers is not enough");this.updateProgress(0),this.initialized=!0;var a$=Array(this.chunkCount).fill(!1);if(o$.forEach(function(c$,u$){return c$.forEach(function(l$){return cs(l$,u$,i$.serverToIndices,a$)})}),s$.forEach(function(c$,u$){return c$.forEach(function(l$){return cs(l$,u$,i$.backupToIndices,a$)})}),a$.some(function(){return!1}))throw new da("Not enough servers to download",mg);this.indexToBackupServers=s$.map(function(c$){return new Set(c$)}),this.retUnit=n$}},{key:"downloadChunks",value:function(){this.aborted?this.warn("downloadChunks after abort, ignored"):this.serverToIndices.size===1&&Array.from(this.serverToIndices.keys())[0]===0?this.serversDownload(this.backupToIndices):1<=this.serverToIndices.size?this.serversDownload(this.serverToIndices,!0):this.ee.emit("error",new da("not enough servers to download",mg))}},{key:"updateProgress",value:function(n$){var i$=this,o$=this.downloadedSize+n$;this.downloadedSize>this.metaInfo.size?(this.warn("Invalid download size, overflowed"),this.ee.emit("error",new Wc("Invalid download size",mg))):(this.downloadedSize=o$,this.timer!==void 0&&n$!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&this.successCount!==this.chunkCount&&(this.timer=setTimeout(function(){i$.ee.emit("timedOut"),i$.abortController.abort()},12e4)),this.initialized&&n$===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.size,currentSize:this.downloadedSize}))}},{key:"getPayload",value:function(){for(var n$=0,i$=0,o$=this.chunks;i$<o$.length;i$++)n$+=o$[i$].byteLength;if(n$!==this.metaInfo.size)throw new Ia("invalid chunks total size");n$=new Uint8Array(n$),o$=i$=0;for(var s$=this.chunks;o$<s$.length;o$++){var a$=s$[o$];n$.set(new Uint8Array(a$),i$),i$+=a$.byteLength}return i$=Array.from(n$.subarray(0,4)).map(function(c$){return c$.toString(16)}).join("").toUpperCase(),Zt(n$.buffer,cD(i$))}},{key:"getDownloadUrl",value:function(n$){var i$=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(n$).split(".").join("-"),".edge.").concat(i$,":9601/api/v1/chuck/download")}},{key:"serversDownload",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$=this,c$=arguments;return w.wrap(function(u$){for(;;)switch(u$.prev=u$.next){case 0:return s$=1<c$.length&&c$[1]!==void 0&&c$[1],u$.next=3,Promise.all(Array.from(o$.entries()).map(function(l$){return l$=ra(l$,2),a$.postDownloadRequest(l$[0],Array.from(l$[1]),s$).catch(function(d$){d$.statusCode===404?(a$.ee.emit("notExist"),a$.abortController.abort()):d$.name!=="AbortError"&&(Sa(d$)?a$.singleThread?(a$.abortController.abort(),a$.ee.emit("timedOut")):(a$.warn("%d download timed out after %d, retrying use single thread",d$.index,a$.singleThread?6e4:3e4),a$.abortController.abort(),a$.singleThread=!0,a$.ee.emit("multiTimeOut")):(a$.ee.emit("error",d$),a$.abortController.abort()))})}));case 3:case"end":return u$.stop()}},i$)}));return function(i$){return n$.apply(this,arguments)}}()},{key:"postDownloadRequest",value:function(){var n$=J(w.mark(function i$(o$,s$,a$){var c$,u$,l$,d$,h$,p$,_$,f$,m$,g$=this;return w.wrap(function(v$){for(;;)switch(v$.prev=v$.next){case 0:if(m$=function(){return(m$=J(w.mark(function y$(S$){var b$,$$,C$,N$,k$,O$,U$,x$,F$;return w.wrap(function(L$){for(;;)switch(L$.prev=L$.next){case 0:if(L$.prev=0,S$!==void 0||o$!==0){L$.next=5;break}throw new Ia("Invalid serverIp");case 5:b$=S$===void 0?_$.getDownloadUrl(o$):S$;case 6:return _$.downloadingChunks.add(c$),L$.next=9,p$(b$);case 9:return $$=L$.sent,C$=$$.responseData,_$.downloadingChunks.delete(c$),L$.abrupt("return",C$);case 15:if(L$.prev=15,L$.t0=L$.catch(0),_$.downloadingChunks.delete(c$),s$.unshift(c$),_$.metaInfo.useNewDomain=!1,L$.t0.name!=="AbortError"){L$.next=22;break}throw L$.t0;case 22:if(!Sa(L$.t0)){L$.next=25;break}throw L$.t0.index=c$,L$.t0;case 25:if(N$=d$,d$+=1,!(2>N$)){L$.next=30;break}return L$.t0 instanceof Ia||_$.warn("%o, %d download failed, retrying",L$.t0,c$),L$.abrupt("return",f$());case 30:if(L$.t0.statusCode!==504){L$.next=34;break}throw(k$=new db("download server timed out",{originalError:L$.t0,serverCode:504})).index=c$,k$;case 34:if(!a$||N$!==2||h$[0]===0){L$.next=45;break}return L$.t0 instanceof Ia||_$.warn("%d download failed, using backup: %d, %o",c$,h$[0],L$.t0),L$.next=38,_$.busyBackupServers.get(h$[0]);case 38:return O$=f$(_$.getDownloadUrl(h$[0])),_$.busyBackupServers.set(h$[0],O$),L$.next=42,O$;case 42:return U$=L$.sent,_$.busyBackupServers.delete(h$[0]),L$.abrupt("return",U$);case 45:if(!(a$&&2<N$&&h$[1]!==void 0&&h$[1]!==0)){L$.next=56;break}return _$.warn("%d download failed, using backup 1: %d",c$,h$[1]),L$.next=49,_$.busyBackupServers.get(h$[1]);case 49:return x$=f$(_$.getDownloadUrl(h$[1])),_$.busyBackupServers.set(h$[1],x$),L$.next=53,x$;case 53:return F$=L$.sent,_$.busyBackupServers.delete(h$[1]),L$.abrupt("return",F$);case 56:throw L$.t0.index=c$,L$.t0;case 58:case"end":return L$.stop()}},y$,null,[[0,15]])}))).apply(this,arguments)},f$=function(y$){return m$.apply(this,arguments)},!this.aborted){v$.next=4;break}throw new Ia("download already aborted");case 4:if((c$=s$.shift())!==void 0){v$.next=8;break}return this.log("%s download finished",o$),v$.abrupt("return");case 8:if(!(this.singleThread&&0<this.downloadingChunks.size)){v$.next=10;break}return v$.abrupt("return");case 10:if(!this.downloadingChunks.has(c$)){v$.next=13;break}return this.log("%s already downloading, return",c$),v$.abrupt("return");case 13:if(this.chunks[c$]===void 0){v$.next=19;break}return this.successCount===this.chunkCount&&(this.log("chunks all download"),this.ee.emit("finished")),this.log("%s already downloaded, do next",c$),v$.next=18,this.postDownloadRequest(o$,s$,a$);case 18:return v$.abrupt("return");case 19:return u$=new FormData,l$={hash:hu(this.metaInfo.hashHexStr),unit:this.retUnit===void 0?this.metaInfo.unit:this.retUnit,instance:this.metaInfo.instance,loginOpt:this.metaInfo.loginOpt,ticket:this.metaInfo.ticket,index:c$},u$.append("parameter",JSON.stringify(l$)),d$=0,h$=Array.from(this.indexToBackupServers[c$]),p$=function(y$){return te(y$,{body:u$,signal:g$.abortController.signal,timeout:g$.singleThread?12e4:3e4},{useBinaryResponse:!0})},_$=this,v$.next=28,f$().then(function(y$){return g$.chunks[c$]!==void 0?g$.log("chunk %d download duplicated",c$):(g$.chunks[c$]=y$,g$.log("chunk %d downloaded",c$),g$.successCount+=1,g$.updateProgress(g$.chunks[c$].byteLength)),g$.successCount===g$.chunkCount&&(g$.log("chunks all download"),g$.ee.emit("finished")),g$.singleThread?(g$.downloadChunks(),Promise.resolve()):g$.postDownloadRequest(o$,s$,a$)});case 28:case"end":return v$.stop()}},i$,this)}));return function(i$,o$,s$){return n$.apply(this,arguments)}}()}]),t$}(tb()),es=function(e$){function t$(n$,i$,o$,s$){W(this,t$);var a$=r$.call(this,o$,"ChunkUploadManager");if(m(n(a$),"chunkCount",0),m(n(a$),"chunks",[]),m(n(a$),"uploadedChunks",[]),m(n(a$),"totalFailures",0),m(n(a$),"timer",void 0),m(n(a$),"initState","uninitialized"),m(n(a$),"ee",void 0),m(n(a$),"unit",0),m(n(a$),"uploadedSize",0),m(n(a$),"singleThread",!1),m(n(a$),"abortController",new AbortController),m(n(a$),"servers",[]),m(n(a$),"aborted",!1),m(n(a$),"metaInfo",void 0),m(n(a$),"transHandler",void 0),a$.metaInfo=n$,a$.transHandler=i$,a$.ee=s$===void 0?new ea:s$,n$.file.length===0)throw new I("file not found or is empty",wf);return i$.cancelSignal!==void 0&&i$.cancelSignal.addEventListener("abort",function(){a$.abortController.abort()},{once:!0}),a$.abortController.signal.addEventListener("abort",function(){a$.aborted=!0},{once:!0}),a$}la(t$,e$);var r$=ma(t$);return Ha(t$,[{key:"initChunks",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$,c$,u$,l$,d$=this;return w.wrap(function(h$){for(;;)switch(h$.prev=h$.next){case 0:if(this.initState!=="initialized"&&this.initState!=="initializing"){h$.next=2;break}throw new Ia("cannot re-initialize");case 2:for(this.initState="initializing",this.unit=o$,s$=this.sliceFile(o$,this.metaInfo.file),this.chunkCount=s$.length,a$=[],c$=function(p$,_$){var f$=(p$=ra(_$[p$],2))[0],m$=p$[1];p$=bs(m$).then(function(g$){d$.chunks[f$]={payload:m$,sha1:g$,uploadedTo:void 0,index:f$,processed:!1}}),a$.push(p$)},u$=0,l$=Array.from(s$.entries());u$<l$.length;u$++)c$(u$,l$);return h$.next=11,Promise.all(a$);case 11:this.updateProgress(0),this.initState="initialized",this.log("upload chunks initialized");case 14:case"end":return h$.stop()}},i$,this)}));return function(i$){return n$.apply(this,arguments)}}()},{key:"uploadToServers",value:function(){var n$=this;if(!this.aborted){for(var i$=this.chunks.filter(function(a$){return!a$.processed}),o$=function(a$){var c$=i$[a$],u$=n$.servers.filter(function(d$){return!d$.isUploading}).sort(function(d$,h$){return d$.successCount-h$.successCount}).sort(function(d$,h$){return d$.failureCount-h$.failureCount})[0];if(u$===void 0||1<u$.failureCount)return n$.log("Upload server not available, waiting"),n$.ee.emit("serverUsedUp"),Om(1e3).then(function(){n$.totalFailures>2*n$.chunkCount&&n$.ee.emit("error"),n$.totalFailures+=1,u$!==void 0&&(u$.failureCount=0),n$.uploadToServers()}).catch(function(){}),"break";c$.processed=!0,u$.isUploading=!0,n$.log("uploading chunk %d to server %s",c$.index,Dg(u$.ip));var l$=n$.getUploadUrl(u$.ip);return J(w.mark(function d$(){var h$;return w.wrap(function(p$){for(;;)switch(p$.prev=p$.next){case 0:return p$.prev=0,p$.next=3,n$.postChunk(c$.payload,l$,c$.index);case 3:h$=n$.chunks.findIndex(function(_$){return _$===c$}),c$.uploadedTo=u$.ip,n$.chunks.splice(h$,1),n$.uploadedChunks.push(c$),u$.successCount+=1,u$.isUploading=!1,n$.updateProgress(c$.payload.byteLength),n$.log("upload chunk %d successfully",c$.index),p$.next=31;break;case 13:if(p$.prev=13,p$.t0=p$.catch(0),u$.isUploading=!1,c$.processed=!1,p$.t0.statusCode!==504&&!Sa(p$.t0)){p$.next=27;break}if(n$.singleThread){p$.next=24;break}return n$.warn("%d upload timed out after %d, retrying use single thread",c$.index,n$.singleThread?12e4:3e4),n$.abortController.abort(),n$.singleThread=!0,n$.ee.emit("multiTimeOut"),p$.abrupt("return");case 24:return n$.ee.emit("timedOut"),n$.abortController.abort(),p$.abrupt("return");case 27:return n$.metaInfo.useNewDomain=!1,u$.failureCount+=1,p$.next=31,Om(1e3);case 31:n$.uploadedChunks.length===n$.chunkCount?(n$.log("chunks uploaded"),n$.ee.emit("finished")):(n$.singleThread||n$.chunks.filter(function(_$){return!_$.processed}).length===1)&&n$.uploadToServers();case 32:case"end":return p$.stop()}},d$,null,[[0,13]])}))(),n$.singleThread?"break":void 0},s$=0;s$<i$.length&&o$(s$)!=="break";s$++);i$.length===0&&this.uploadedChunks.length!==this.chunkCount&&this.log("%d chunks left uploading",this.chunkCount-this.uploadedChunks.length)}}},{key:"getUploadServerIPs",value:function(){var n$=!0,i$=[],o$=G(this.uploadedChunks).sort(function(c$,u$){return c$.index-u$.index}),s$=0;for(o$=Array.from(o$.values());s$<o$.length;s$++){var a$=o$[s$].uploadedTo;if(a$===void 0){n$=!1;break}i$.push(a$)}if(!n$)throw new Ia("some chunks not uploaded, cannot get upload server ips");return i$}},{key:"addServers",value:function(n$){var i$=this;n$.forEach(function(o$){var s$=i$.servers.findIndex(function(a$){return a$.ip===o$});s$!==-1?i$.servers[s$].failureCount=0:(i$.log("server %s added",Dg(o$)),i$.servers.push({successCount:0,isUploading:!1,ip:o$,failureCount:0}))})}},{key:"updateProgress",value:function(n$){var i$=this,o$=n$!==void 0?this.uploadedSize+n$:this.metaInfo.file.length;o$>this.metaInfo.file.length?(this.warn("Invalid upload size, overflowed"),this.ee.emit("error",new Wc("Invalid upload size",lg))):(this.uploadedSize=o$,this.timer!==void 0&&n$!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&n$!==void 0&&this.uploadedChunks.length!==this.chunkCount&&(this.timer=setTimeout(function(){i$.ee.emit("timedOut"),i$.abortController.abort()},12e4)),this.initState==="initialized"&&n$===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.file.length,currentSize:this.uploadedSize}))}},{key:"sliceFile",value:function(n$,i$){var o$=0,s$=[],a$=i$.length;for(n$*=32768;o$<a$;)s$.push(i$.slice(o$,o$+n$)),o$+=n$;return this.log("chunks split into %d",s$.length),s$}},{key:"postChunk",value:function(){var n$=J(w.mark(function i$(o$,s$,a$){var c$,u$,l$,d$,h$,p$,_$,f$;return w.wrap(function(m$){for(;;)switch(m$.prev=m$.next){case 0:if(!this.aborted){m$.next=2;break}throw new Ia("upload already aborted");case 2:if(this.unit!==void 0){m$.next=4;break}throw new Ia("unit is undefined");case 4:return c$=this.metaInfo,u$=c$.ticket,l$=c$.instance,d$=c$.loginOpt,h$=c$.hashStr,m$.t0=a$,m$.t1=h$,m$.next=9,bs(o$);case 9:return m$.t2=m$.sent,m$.t3=this.unit,m$.t4=u$,m$.t5=l$,m$.t6=d$,p$={index:m$.t0,hash:m$.t1,sha1:m$.t2,unit:m$.t3,ticket:m$.t4,instance:m$.t5,loginOpt:m$.t6},(_$=new FormData).append("parameter",JSON.stringify(p$)),_$.append("payload",new Blob([o$])),m$.next=20,te(s$,{headers:{Accept:"application/json"},body:_$,timeout:this.singleThread?12e4:3e4,signal:this.abortController.signal});case 20:if(f$=m$.sent,f$.status===201){m$.next=24;break}throw new da("uploading chunk ".concat(a$," failed"));case 24:case"end":return m$.stop()}},i$,this)}));return function(i$,o$,s$){return n$.apply(this,arguments)}}()},{key:"getUploadUrl",value:function(n$){var i$=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(n$).split(".").join("-"),".edge.").concat(i$,":9601/api/v1/chuck/upload")}}]),t$}(tb()),fs=function(e$){function t$(n$){W(this,t$);var i$=r$.call(this,n$,"MediaTaskManager");return m(n(i$),"isProcessing",!1),m(n(i$),"authInfo",void 0),m(n(i$),"taskFinishers",{}),m(n(i$),"mediaTasks",new Map),m(n(i$),"ongoingTask",void 0),i$.on("connectionStateChanged",function(o$){if(o$===S.ConnectionState.ABORTED||o$===S.ConnectionState.DISCONNECTED){i$.ongoingTask!==void 0&&i$.cancelTask(i$.ongoingTask),o$=0;for(var s$=Array.from(i$.mediaTasks.entries());o$<s$.length;o$++){var a$=ra(s$[o$],2)[1];i$.cancelTask(a$)}i$.mediaTasks.clear(),i$.taskFinishers={}}else o$===S.ConnectionState.RECONNECTING?i$.ongoingTask!==void 0&&i$.ongoingTask.manager.abortController.abort():o$===S.ConnectionState.CONNECTED&&i$.ongoingTask!==void 0&&i$.ongoingTask.manager.ee.emit("reconnected")}),i$}la(t$,e$);var r$=ma(t$);return Ha(t$,[{key:"setAuthInfo",value:function(n$){this.authInfo=n$}},{key:"waitMediaTask",value:function(n$){var i$=this;return new Promise(function(o$,s$){i$.taskFinishers[n$]={resolve:o$,reject:s$},i$.isProcessing||i$.processMediaTask()}).finally(function(){i$.ongoingTask!==void 0&&i$.ongoingTask.manager.timer!==void 0&&clearTimeout(i$.ongoingTask.manager.timer),delete i$.taskFinishers[n$],i$.mediaTasks.size!==0?i$.processMediaTask():i$.isProcessing=!1})}},{key:"addUploadTask",value:function(n$,i$,o$,s$){var a$=n$.file;if(n$=n$.hash,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=t$.MAX_PENDING_TASK_COUNT-1)throw new ib("Upload media failed, exceed max pending jobs",xA);return s$=new es({hashStr:as(n$),file:a$,ticket:this.authInfo.ticket,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),useNewDomain:this.authInfo.useNewDomain},s$,this.logger),a$=Ud(),this.mediaTasks.set(a$,{type:"UPLOAD",manager:s$,hash:n$,setter:o$,fetcher:i$,taskId:a$}),a$}},{key:"addDownloadTask",value:function(n$,i$,o$){var s$=n$.hashHexStr,a$=n$.size,c$=n$.unit;if(n$=n$.zone,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=t$.MAX_PENDING_TASK_COUNT-1)throw new ib("Download media failed, exceed max pending jobs",BA);return o$=new ds({hashHexStr:s$,ticket:this.authInfo.ticket,useNewDomain:this.authInfo.useNewDomain,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),size:a$,zone:n$,unit:c$},o$,this.logger),s$=Ud(),this.mediaTasks.set(s$,{type:"DOWNLOAD",manager:o$,fetcher:i$,taskId:s$}),s$}},{key:"doDownloadTaskImpl",value:function(){var n$=J(w.mark(function i$(o$,s$){var a$,c$,u$,l$,d$,h$,p$,_$,f$=this,m$=arguments;return w.wrap(function(g$){for(;;)switch(g$.prev=g$.next){case 0:return a$=2<m$.length&&m$[2]!==void 0&&m$[2],u$=c$=o$.manager,a$&&(c$=new ds(u$.metaInfo,u$.transHandler,this.logger,u$.ee)),l$=o$.fetcher,g$.next=7,l$();case 7:if(d$=g$.sent,h$=d$.serverList,p$=d$.backupList,_$=d$.unit,!a$||_$===u$.retUnit){g$.next=13;break}throw new da("download unit is different, reject to continue",mg);case 13:a$&&(o$.manager=c$,c$.downloadedSize=u$.downloadedSize,c$.successCount=u$.successCount,c$.timer=u$.timer,c$.chunks=u$.chunks,c$.initialized=u$.initialized,c$.singleThread=u$.singleThread,c$.updateProgress(0)),c$.ee.once("reconnected",function(){c$.ee.removeAllListeners(),f$.doDownloadTaskImpl(o$,s$,!0).catch(function(v$){s$.reject(v$)})}),c$.ee.once("multiTimeOut",function(){c$.ee.removeAllListeners(),f$.doDownloadTaskImpl(o$,s$,!0).catch(function(v$){s$.reject(v$)})}),c$.ee.once("error",function(v$){c$.ee.removeAllListeners(),s$.reject(new da(["download file file, index %d",v$.index],{code:mg,originalError:v$}))}),c$.ee.once("notExist",function(){c$.abortController.abort(),c$.ee.removeAllListeners(),s$.reject(new da("download file not found",AA))}),c$.ee.once("timedOut",function(){c$.ee.removeAllListeners(),c$.abortController.abort(),s$.reject(new db("download timed out",zA))}),c$.transHandler.cancelSignal!==void 0&&c$.transHandler.cancelSignal.addEventListener("abort",function(){s$.reject(new hl("Downloading canceled",ir))},{once:!0}),c$.ee.once("finished",function(){s$.resolve({type:"DOWNLOAD",payload:c$.getPayload()})}),c$.setInfoByResponse({serverList:h$,backupList:p$,unit:_$}),c$.downloadChunks();case 23:case"end":return g$.stop()}},i$,this)}));return function(i$,o$){return n$.apply(this,arguments)}}()},{key:"doDownloadTask",value:function(n$,i$){var o$=this,s$=2<arguments.length&&arguments[2]!==void 0&&arguments[2],a$=n$.taskId;return s$||(this.mediaTasks.delete(a$),this.ongoingTask=n$),new Promise(function(c$,u$){o$.doDownloadTaskImpl(n$,i$,s$).then(c$).catch(u$)})}},{key:"doUploadTaskImpl",value:function(){var n$=J(w.mark(function i$(o$,s$){var a$,c$,u$,l$,d$,h$,p$,_$,f$,m$=this,g$=arguments;return w.wrap(function(v$){for(;;)switch(v$.prev=v$.next){case 0:return a$=2<g$.length&&g$[2]!==void 0&&g$[2],u$=c$=o$.manager,a$&&(c$=new es(u$.metaInfo,u$.transHandler,this.logger,u$.ee)),l$=o$.fetcher,d$=new Pa,p$=new Promise(function(y$,S$){var b$=l$(),$$=b$.ret,C$=b$.err,N$=b$.timeout;b$.fin.pipe(ob(d$)).subscribe({next:function(k$){s$.resolve({type:"UPLOAD",retUnit:k$.unit,zone:k$.zone})},complete:function(){y$({hasExist:!0}),d$.next(),d$.complete()}}),$$.pipe(ob(d$),cb(function(){var k$=J(w.mark(function O$(U$){var x$,F$;return w.wrap(function(L$){for(;;)switch(L$.prev=L$.next){case 0:if(x$=U$.servers,F$=U$.unit,a$&&u$.unit!==F$?s$.reject(new da("upload unit is different, reject to continue",lg)):a$&&(o$.manager=c$,c$.chunkCount=u$.chunkCount,c$.chunks=u$.chunks,c$.totalFailures=u$.totalFailures,c$.uploadedChunks=u$.uploadedChunks,c$.timer=u$.timer,c$.initState=u$.initState,c$.unit=u$.unit,c$.uploadedSize=u$.uploadedSize,c$.singleThread=u$.singleThread,c$.updateProgress(0)),c$.addServers(x$),c$.initState!=="uninitialized"){L$.next=7;break}return h$=c$.initChunks(F$),L$.next=7,h$;case 7:case"end":return L$.stop()}},O$)}));return function(O$){return k$.apply(this,arguments)}}())).subscribe({complete:function(){return y$({hasExist:!1})},error:S$}),b$=function(k$){c$.initState!=="uninitialized"&&h$?y$(h$.then(function(){return{hasExist:!1}})):S$(k$)},C$.pipe(ob(d$)).subscribe({error:b$}),N$.pipe(ob(d$)).subscribe({error:b$})}),v$.next=9,p$;case 9:if(_$=v$.sent,!_$.hasExist){v$.next=15;break}return c$.updateProgress(),this.log("file already exists, skipping upload"),v$.abrupt("return");case 15:d$.next(),d$.complete(),this.log("chunks initialization promise resolved"),f$=gb(c$.ee,"serverUsedUp").pipe(Gt(function(){return c$.chunkCount!==c$.uploadedChunks.length}),Jt(5e3,void 0,{leading:!1}),pm(function(){return l$().ret})).subscribe(function(y$){c$.addServers(y$.servers)}),c$.ee.once("reconnected",function(){c$.ee.removeAllListeners(),m$.doUploadTask(o$,s$,!0).catch(function(y$){s$.reject(y$)})}),c$.ee.once("multiTimeOut",function(){c$.ee.removeAllListeners(),m$.doUploadTask(o$,s$,!0).catch(function(y$){s$.reject(y$)})}),c$.ee.once("timedOut",function(){f$.unsubscribe(),c$.ee.removeAllListeners(),c$.abortController.abort(),s$.reject(new db("upload timed out",Lh))}),c$.ee.once("error",function(y$){f$.unsubscribe(),c$.ee.removeAllListeners(),c$.abortController.abort(),s$.reject(y$||new da("upload error",lg))}),c$.transHandler.cancelSignal!==void 0&&c$.transHandler.cancelSignal.addEventListener("abort",function(){s$.reject(new hl("Uploading canceled",hr))},{once:!0}),c$.ee.once("finished",J(w.mark(function y$(){var S$,b$,$$;return w.wrap(function(C$){for(;;)switch(C$.prev=C$.next){case 0:return f$.unsubscribe(),C$.next=3,o$.setter(c$.unit,c$.getUploadServerIPs());case 3:S$=C$.sent,b$=S$.zone,$$=S$.unit,c$.ee.removeAllListeners(),s$.resolve({type:"UPLOAD",retUnit:$$,zone:b$});case 8:case"end":return C$.stop()}},y$)}))),c$.uploadToServers();case 26:case"end":return v$.stop()}},i$,this)}));return function(i$,o$){return n$.apply(this,arguments)}}()},{key:"doUploadTask",value:function(n$,i$){var o$=this,s$=2<arguments.length&&arguments[2]!==void 0&&arguments[2],a$=n$.taskId;return s$||(this.mediaTasks.delete(a$),this.ongoingTask=n$),new Promise(function(c$,u$){o$.doUploadTaskImpl(n$,i$,s$).then(c$).catch(u$)})}},{key:"processMediaTask",value:function(){var n$=J(w.mark(function i$(){var o$,s$,a$;return w.wrap(function(c$){for(;;)switch(c$.prev=c$.next){case 0:if(this.mediaTasks.size!==0){c$.next=2;break}throw Error("no upload tasks");case 2:if(this.isProcessing=!0,o$=this.mediaTasks.keys().next().value,(s$=this.taskFinishers[o$])!==void 0){c$.next=7;break}throw Error("top task not found");case 7:if((a$=this.mediaTasks.get(o$))!==void 0){c$.next=10;break}throw new Ia("task invalid");case 10:if(a$.type!=="UPLOAD"){c$.next=15;break}return c$.next=13,this.doUploadTask(a$,s$).catch(function(u$){a$.manager.ee.removeAllListeners(),s$.reject(u$)});case 13:c$.next=18;break;case 15:if(a$.type!=="DOWNLOAD"){c$.next=18;break}return c$.next=18,this.doDownloadTask(a$,s$).catch(function(u$){a$.manager.ee.removeAllListeners(),s$.reject(u$)});case 18:case"end":return c$.stop()}},i$,this)}));return function(){return n$.apply(this,arguments)}}()},{key:"cancelTask",value:function(n$){var i$=n$.type==="DOWNLOAD"?ir:hr;n$.manager.ee.removeAllListeners(),n$.manager.abortController.abort(),this.taskFinishers[n$.taskId]!==void 0&&this.taskFinishers[n$.taskId].reject(new hl("User logged out or kicked off, media task canceled",i$))}}]),t$}(tb());m(fs,"MAX_PENDING_TASK_COUNT",9),Oo("of",function(){for(var e$=0,t$=arguments.length,r$=new(Ne(this))(t$);t$>e$;)r$[e$]=arguments[e$++];return r$},Dj);var gs=1/0,dD=Math.max,ju=function(e$,t$,r$){var n$=Object(e$);if(!Ed(e$)){var i$=Te(t$);e$=Ad(e$),t$=function(o$){return i$(n$[o$],o$,n$)}}return-1<(t$=function(o$,s$,a$){var c$=o$==null?0:o$.length;if(!c$)return-1;if(a$==null)a$=0;else{var u$=(a$=a$?(a$=gl(a$))===gs||a$===-gs?17976931348623157e292*(0>a$?-1:1):a$==a$?a$:0:a$===0?a$:0)%1;a$=a$==a$?u$?a$-u$:a$:0}return 0>a$&&(a$=dD(c$+a$,0)),Xp(o$,Te(s$),a$)}(e$,t$,r$))?n$[i$?e$[t$]:t$]:void 0},iu=function(e$,t$){return e$&&e$.length?vk(e$,void 0,typeof t$=="function"?t$:void 0):[]},hs=function(){function e$(){W(this,e$),m(this,"size",0),m(this,"fields",new Map)}return Ha(e$,[{key:"define",value:function(t$,r$,n$){if(this.size+=n$,64<this.size)throw new RangeError("the struct over 64 bits is not supported");Mg(r$={val:0,isNumber:r$==="number",isBoolean:r$==="boolean",oneof:r$==="number"||r$==="boolean"?void 0:r$,len:n$}),this.fields.set(t$,r$)}},{key:"set",value:function(t$,r$){if(!(t$=this.fields.get(t$)))throw Error("field not found");var n$=t$.oneof;if(!U.isLong(r$)&&typeof r$!="number")if(typeof r$=="boolean")r$=r$?1:0;else{if(n$===void 0)throw Error("invalid field type");if((r$=n$[r$])===void 0)throw Error("field type not found")}Mg(t$,r$),t$.val=r$}},{key:"toNumber",value:function(){for(var t$=0,r$=0,n$=0,i$=Array.from(this.fields);n$<i$.length;n$++){var o$=ra(i$[n$],2)[1],s$=o$.len;(o$=o$.val)!==void 0&&(t$+=U.fromValue(o$).shiftLeft(r$).toNumber(),r$+=s$)}return t$}},{key:"toLong",value:function(){for(var t$=U.fromNumber(0,!0),r$=0,n$=0,i$=Array.from(this.fields);n$<i$.length;n$++){var o$=ra(i$[n$],2)[1],s$=o$.len;(o$=o$.val)!==void 0&&(t$=U.fromValue(o$).shiftLeft(r$).add(t$),r$+=s$)}return t$}},{key:"assert",value:function(t$,r$){function n$(s$){if(!U.isLong(s$)&&typeof s$!="number")if(typeof s$=="boolean")s$=s$?1:0;else{if(o$===void 0)throw Error("invalid field type");if((s$=o$[s$])===void 0)throw Error("field type not found")}return Mg(i$,s$),Lg(s$,i$.val)}var i$=this.fields.get(t$);if(!i$)throw Error("field not found");var o$=i$.oneof;if(!Array.isArray(r$))return n$(r$);if(r$.length===1)return n$(r$[0]);if(r$.every(function(s$){return typeof s$=="string"})&&o$!==void 0)return r$.some(function(s$){return n$(s$)});throw Error("invalid valueTypes")}},{key:"from",value:function(t$){t$=U.fromValue(t$);for(var r$=0,n$=0,i$=Array.from(this.fields);n$<i$.length;n$++){var o$=ra(i$[n$],2)[1],s$=o$.len,a$=U.fromNumber(Math.pow(2,s$)-1,!0).shiftLeft(r$);Mg(o$,a$=t$.and(a$).shiftRightUnsigned(r$)),o$.val=a$,r$+=s$}}},{key:"typeOf",value:function(t$){if((t$=this.fields.get(t$))!==void 0){var r$=t$.oneof;if(t$=t$.val,r$!==void 0){var n$=0;for(r$=Object.entries(r$);n$<r$.length;n$++){var i$=ra(r$[n$],2),o$=i$[0];if(Lg(t$,i$[1]))return o$}}}throw new TypeError("can only get type of oneof type")}}]),e$}(),is=function(e$){function t$(n$){W(this,t$);var i$=r$.call(this);return i$.define("Rejoin","boolean",1),i$.define("Unused","number",31),i$.define("Platform","number",8),i$.define("Version","number",12),i$.define("Subversion","number",12),i$.set("Platform",7),i$.set("Version",4),i$.set("Subversion",203),i$.set("Rejoin",n$),i$}la(t$,e$);var r$=ma(t$);return t$}(hs),eD=ua(ua(ua(ua({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),{PeerImageMessage:6,ChannelImageMessage:7,VendorImageMessage:8}),{PeerFileMessage:15,ChannelFileMessage:16,VendorFileMessage:17}),js={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},fD=ua(ua({},eD),js),gD={Uncompressed:0,Zlib:1},ae=function(e$){function t$(n$){W(this,t$);var i$=r$.call(this);if(i$.define("MessageType",fD,8),i$.define("BroadcastJumps","number",2),i$.define("ToCache","boolean",1),i$.define("FromCache","boolean",1),i$.define("CompressionMethod",gD,2),i$.define("IterationNumber","number",4),i$.define("BufferedMessage","boolean",1),i$.define("ToArchive","boolean",1),i$.define("FromArchive","boolean",1),typeof n$=="number"||U.isLong(n$))i$.from(n$);else if(n$!==void 0){var o$=0;for(n$=Hg(n$);o$<n$.length;o$++){var s$=ra(n$[o$],2);i$.set(s$[0],s$[1])}}return i$}la(t$,e$);var r$=ma(t$);return Ha(t$,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(n$){var i$=this;return n$!==void 0?this.assert("MessageType",n$):xf(js).some(function(o$){return i$.assert("MessageType",o$)})}},{key:"isFileMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","ChannelFileMessage","VendorFileMessage"])}},{key:"isImageMessage",value:function(){return this.assert("MessageType",["PeerImageMessage","ChannelImageMessage","VendorImageMessage"])}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","PeerTextMessage","PeerImageMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),t$}(hs),hD=function(e$){function t$(n$){return W(this,t$),m(n(n$=r$.call(this,n$,"ChatManager")),"dialogueLru",new Sx(void 0,{maxlen:1e4,ttl:1e4})),n$}la(t$,e$);var r$=ma(t$);return Ha(t$,[{key:"getChatInfo",value:function(n$){var i$=this.dialogueLru.get(n$);if(this.dialogueLru.prune(),i$){var o$=i$.dialogue,s$={dialogue:o$,sequence:i$=i$.sequence.add(1)};return this.dialogueLru.set(n$,{dialogue:o$,sequence:i$}),s$}return o$={dialogue:Bg(),sequence:U.fromNumber(1,!0)},this.dialogueLru.set(n$,o$),o$}}]),t$}(tb()),v={};X(module)=="object"&&(module.exports=v),v.parse=function(e$,t$){var r$,n$=v.bin.readUshort,i$=v.bin.readUint,o$={};for(r$=(e$=new Uint8Array(e$)).length-4;i$(e$,r$)!=101010256;)r$--;var s$=n$(e$,r$=r$+4+4);n$(e$,r$+=2),i$(e$,r$+=2),r$=i$(e$,r$+=4);for(var a$=0;a$<s$;a$++){i$(e$,r$),r$+=4,r$+=4,r$+=4,i$(e$,r$+=4);var c$=i$(e$,r$+=4),u$=i$(e$,r$+=4),l$=n$(e$,r$+=4),d$=n$(e$,r$+2),h$=n$(e$,r$+4);r$+=6;var p$=i$(e$,r$+=8);r$+=4,r$+=l$+d$+h$,v._readLocal(e$,p$,o$,c$,u$,t$)}return o$},v._readLocal=function(e$,t$,r$,n$,i$,o$){var s$=v.bin.readUshort,a$=v.bin.readUint;a$(e$,t$),s$(e$,t$+=4),s$(e$,t$+=2);var c$=s$(e$,t$+=2);a$(e$,t$+=2),a$(e$,t$+=4),a$=s$(e$,t$=t$+4+8);var u$=s$(e$,t$+=2);if(t$+=2,s$=v.bin.readUTF8(e$,t$,a$),t$=t$+a$+u$,o$)r$[s$]={size:i$,csize:n$};else if(e$=new Uint8Array(e$.buffer,t$),c$==0)r$[s$]=new Uint8Array(e$.buffer.slice(t$,t$+n$));else{if(c$!=8)throw"unknown compression method: "+c$;t$=new Uint8Array(i$),v.inflateRaw(e$,t$),r$[s$]=t$}},v.inflateRaw=function(e$,t$){return v.F.inflate(e$,t$)},v.inflate=function(e$,t$){return e$[0],e$[1],v.inflateRaw(new Uint8Array(e$.buffer,e$.byteOffset+2,e$.length-2),t$)},v.deflate=function(e$,t$){t$==null&&(t$={level:6});var r$=0,n$=new Uint8Array(50+Math.floor(1.1*e$.length));return n$[r$]=120,n$[r$+1]=156,r$=v.F.deflateRaw(e$,n$,r$+2,t$.level),e$=v.adler(e$,0,e$.length),n$[r$+0]=e$>>>24&255,n$[r$+1]=e$>>>16&255,n$[r$+2]=e$>>>8&255,n$[r$+3]=e$>>>0&255,new Uint8Array(n$.buffer,0,r$+4)},v.deflateRaw=function(e$,t$){t$==null&&(t$={level:6});var r$=new Uint8Array(50+Math.floor(1.1*e$.length)),n$=v.F.deflateRaw(e$,r$,n$,t$.level);return new Uint8Array(r$.buffer,0,n$)},v.encode=function(e$,t$){t$==null&&(t$=!1);var r$,n$=0,i$=v.bin.writeUint,o$=v.bin.writeUshort,s$={};for(r$ in e$){var a$=!v._noNeed(r$)&&!t$,c$=e$[r$],u$=v.crc.crc(c$,0,c$.length);s$[r$]={cpr:a$,usize:c$.length,crc:u$,file:a$?v.deflateRaw(c$):c$}}for(r$ in s$)n$+=s$[r$].file.length+30+46+2*v.bin.sizeUTF8(r$);for(r$ in e$=new Uint8Array(n$+22),t$=0,c$=[],s$)u$=s$[r$],c$.push(t$),t$=v._writeHeader(e$,t$,r$,u$,0);for(r$ in n$=0,a$=t$,s$)u$=s$[r$],c$.push(t$),t$=v._writeHeader(e$,t$,r$,u$,1,c$[n$++]);return s$=t$-a$,i$(e$,t$,101010256),o$(e$,t$=t$+4+4,n$),o$(e$,t$+=2,n$),i$(e$,t$+=2,s$),i$(e$,t$+4,a$),e$.buffer},v._noNeed=function(e$){return e$=e$.split(".").pop().toLowerCase(),"png,jpg,jpeg,zip".indexOf(e$)!=-1},v._writeHeader=function(e$,t$,r$,n$,i$,o$){var s$=v.bin.writeUint,a$=v.bin.writeUshort,c$=n$.file;return s$(e$,t$,i$==0?67324752:33639248),t$+=4,i$==1&&(t$+=2),a$(e$,t$,20),a$(e$,t$+=2,0),a$(e$,t$+=2,n$.cpr?8:0),s$(e$,t$+=2,0),s$(e$,t$+=4,n$.crc),s$(e$,t$+=4,c$.length),s$(e$,t$+=4,n$.usize),a$(e$,t$+=4,v.bin.sizeUTF8(r$)),a$(e$,t$+=2,0),t$+=2,i$==1&&(s$(e$,t$=t$+2+2+6,o$),t$+=4),t$+=r$=v.bin.writeUTF8(e$,t$,r$),i$==0&&(e$.set(c$,t$),t$+=c$.length),t$},v.crc={table:function(){for(var e$=new Uint32Array(256),t$=0;256>t$;t$++){for(var r$=t$,n$=0;8>n$;n$++)r$=1&r$?3988292384^r$>>>1:r$>>>1;e$[t$]=r$}return e$}(),update:function(e$,t$,r$,n$){for(var i$=0;i$<n$;i$++)e$=v.crc.table[255&(e$^t$[r$+i$])]^e$>>>8;return e$},crc:function(e$,t$,r$){return 4294967295^v.crc.update(4294967295,e$,t$,r$)}},v.adler=function(e$,t$,r$){var n$=1,i$=0,o$=t$;for(t$+=r$;o$<t$;){for(r$=Math.min(o$+5552,t$);o$<r$;)i$+=n$+=e$[o$++];n$%=65521,i$%=65521}return i$<<16|n$},v.bin={readUshort:function(e$,t$){return e$[t$]|e$[t$+1]<<8},writeUshort:function(e$,t$,r$){e$[t$]=255&r$,e$[t$+1]=r$>>8&255},readUint:function(e$,t$){return 16777216*e$[t$+3]+(e$[t$+2]<<16|e$[t$+1]<<8|e$[t$])},writeUint:function(e$,t$,r$){e$[t$]=255&r$,e$[t$+1]=r$>>8&255,e$[t$+2]=r$>>16&255,e$[t$+3]=r$>>24&255},readASCII:function(e$,t$,r$){for(var n$="",i$=0;i$<r$;i$++)n$+=String.fromCharCode(e$[t$+i$]);return n$},writeASCII:function(e$,t$,r$){for(var n$=0;n$<r$.length;n$++)e$[t$+n$]=r$.charCodeAt(n$)},pad:function(e$){return 2>e$.length?"0"+e$:e$},readUTF8:function(e$,t$,r$){for(var n$,i$="",o$=0;o$<r$;o$++)i$+="%"+v.bin.pad(e$[t$+o$].toString(16));try{n$=decodeURIComponent(i$)}catch{return v.bin.readASCII(e$,t$,r$)}return n$},writeUTF8:function(e$,t$,r$){for(var n$=r$.length,i$=0,o$=0;o$<n$;o$++){var s$=r$.charCodeAt(o$);if(!(4294967168&s$))e$[t$+i$]=s$,i$++;else if(!(4294965248&s$))e$[t$+i$]=192|s$>>6,e$[t$+i$+1]=128|s$>>0&63,i$+=2;else if(!(4294901760&s$))e$[t$+i$]=224|s$>>12,e$[t$+i$+1]=128|s$>>6&63,e$[t$+i$+2]=128|s$>>0&63,i$+=3;else{if(4292870144&s$)throw"e";e$[t$+i$]=240|s$>>18,e$[t$+i$+1]=128|s$>>12&63,e$[t$+i$+2]=128|s$>>6&63,e$[t$+i$+3]=128|s$>>0&63,i$+=4}}return i$},sizeUTF8:function(e$){for(var t$=e$.length,r$=0,n$=0;n$<t$;n$++){var i$=e$.charCodeAt(n$);if(!(4294967168&i$))r$++;else if(!(4294965248&i$))r$+=2;else if(!(4294901760&i$))r$+=3;else{if(4292870144&i$)throw"e";r$+=4}}return r$}},v.F={},v.F.deflateRaw=function(e$,t$,r$,n$){var i$=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][n$],o$=v.F.U,s$=v.F._goodIndex;v.F._hash;var a$=v.F._putsE,c$=0;r$<<=3;var u$=0,l$=e$.length;if(n$==0){for(;c$<l$;){var d$=Math.min(65535,l$-c$);a$(t$,r$,c$+d$==l$?1:0),r$=v.F._copyExact(e$,c$,d$,t$,r$+8),c$+=d$}return r$>>>3}a$=o$.lits,n$=o$.strt;var h$=o$.prev,p$=0,_$=0,f$=0,m$=0,g$=0;for(2<l$&&(n$[g$=v.F._hash(e$,0)]=0),c$=0;c$<l$;c$++){if(d$=g$,c$+1<l$-2){g$=v.F._hash(e$,c$+1);var v$=c$+1&32767;h$[v$]=n$[g$],n$[g$]=v$}if(u$<=c$){if((14e3<p$||26697<_$)&&100<l$-c$&&(u$<c$&&(a$[p$]=c$-u$,p$+=2,u$=c$),r$=v.F._writeBlock(c$==l$-1||u$==l$?1:0,a$,p$,m$,e$,f$,c$-f$,t$,r$),p$=_$=m$=0,f$=c$),v$=0,c$<l$-2&&(v$=v.F._bestMatch(e$,c$,h$,d$,Math.min(i$[2],l$-c$),i$[3])),v$!=0){d$=v$>>>16,v$&=65535;var y$=s$(d$,o$.of0);o$.lhst[257+y$]++;var S$=s$(v$,o$.df0);o$.dhst[S$]++,m$+=o$.exb[y$]+o$.dxb[S$],a$[p$]=d$<<23|c$-u$,a$[p$+1]=v$<<16|y$<<8|S$,p$+=2,u$=c$+d$}else o$.lhst[e$[c$]]++;_$++}}for(f$==c$&&e$.length!=0||(u$<c$&&(a$[p$]=c$-u$,p$+=2),r$=v.F._writeBlock(1,a$,p$,m$,e$,f$,c$-f$,t$,r$));7&r$;)r$++;return r$>>>3},v.F._bestMatch=function(e$,t$,r$,n$,i$,o$){var s$=32767&t$,a$=r$[s$],c$=s$-a$+32768&32767;if(a$==s$||n$!=v.F._hash(e$,t$-c$))return 0;for(var u$=n$=0,l$=Math.min(32767,t$);c$<=l$&&--o$!=0&&a$!=s$;){if((n$==0||e$[t$+n$]==e$[t$+n$-c$])&&(s$=v.F._howLong(e$,t$,c$))>n$){if(u$=c$,(n$=s$)>=i$)break;c$+2<s$&&(s$=c$+2);for(var d$=0,h$=0;h$<s$-2;h$++){var p$=t$-c$+h$+32768&32767,_$=p$-r$[p$]+32768&32767;_$>d$&&(d$=_$,a$=p$)}}c$+=(s$=a$)-(a$=r$[s$])+32768&32767}return n$<<16|u$},v.F._howLong=function(e$,t$,r$){if(e$[t$]!=e$[t$-r$]||e$[t$+1]!=e$[t$+1-r$]||e$[t$+2]!=e$[t$+2-r$])return 0;var n$=t$,i$=Math.min(e$.length,t$+258);for(t$+=3;t$<i$&&e$[t$]==e$[t$-r$];)t$++;return t$-n$},v.F._hash=function(e$,t$){return(e$[t$]<<8|e$[t$+1])+(e$[t$+2]<<4)&65535},v.saved=0,v.F._writeBlock=function(e$,t$,r$,n$,i$,o$,s$,a$,c$){var u$=v.F.U,l$=v.F._putsF,d$=v.F._putsE;u$.lhst[256]++;var h$=v.F.getTrees(),p$=h$[0],_$=h$[1],f$=h$[2],m$=h$[3],g$=h$[4],v$=h$[5],y$=h$[6];h$=h$[7];var S$=32+(c$+3&7?8-(c$+3&7):0)+(s$<<3),b$=n$+v.F.contSize(u$.fltree,u$.lhst)+v.F.contSize(u$.fdtree,u$.dhst);n$=n$+v.F.contSize(u$.ltree,u$.lhst)+v.F.contSize(u$.dtree,u$.dhst),n$+=14+3*v$+v.F.contSize(u$.itree,u$.ihst)+(2*u$.ihst[16]+3*u$.ihst[17]+7*u$.ihst[18]);for(var $$=0;286>$$;$$++)u$.lhst[$$]=0;for($$=0;30>$$;$$++)u$.dhst[$$]=0;for($$=0;19>$$;$$++)u$.ihst[$$]=0;if(S$=S$<b$&&S$<n$?0:b$<n$?1:2,l$(a$,c$,e$),l$(a$,c$+1,S$),c$+=3,S$==0){for(;7&c$;)c$++;c$=v.F._copyExact(i$,o$,s$,a$,c$)}else{if(S$==1)var C$=u$.fltree,N$=u$.fdtree;if(S$==2){for(v.F.makeCodes(u$.ltree,p$),v.F.revCodes(u$.ltree,p$),v.F.makeCodes(u$.dtree,_$),v.F.revCodes(u$.dtree,_$),v.F.makeCodes(u$.itree,f$),v.F.revCodes(u$.itree,f$),C$=u$.ltree,N$=u$.dtree,d$(a$,c$,m$-257),d$(a$,c$+=5,g$-1),d$(a$,c$+=5,v$-4),c$+=4,e$=0;e$<v$;e$++)d$(a$,c$+3*e$,u$.itree[1+(u$.ordr[e$]<<1)]);c$=v.F._codeTiny(y$,u$.itree,a$,c$+3*v$),c$=v.F._codeTiny(h$,u$.itree,a$,c$)}for(v$=0;v$<r$;v$+=2){for(y$=(e$=t$[v$])>>>23,e$=o$+(8388607&e$);o$<e$;)c$=v.F._writeLit(i$[o$++],C$,a$,c$);y$!=0&&(e$=(p$=t$[v$+1])>>16,s$=p$>>8&255,p$&=255,d$(a$,c$=v.F._writeLit(257+s$,C$,a$,c$),y$-u$.of0[s$]),c$+=u$.exb[s$],l$(a$,c$=v.F._writeLit(p$,N$,a$,c$),e$-u$.df0[p$]),c$+=u$.dxb[p$],o$+=y$)}c$=v.F._writeLit(256,C$,a$,c$)}return c$},v.F._copyExact=function(e$,t$,r$,n$,i$){var o$=i$>>>3;return n$[o$]=r$,n$[o$+1]=r$>>>8,n$[o$+2]=255-n$[o$],n$[o$+3]=255-n$[o$+1],o$+=4,n$.set(new Uint8Array(e$.buffer,t$,r$),o$),i$+(r$+4<<3)},v.F.getTrees=function(){for(var e$=v.F.U,t$=v.F._hufTree(e$.lhst,e$.ltree,15),r$=v.F._hufTree(e$.dhst,e$.dtree,15),n$=[],i$=v.F._lenCodes(e$.ltree,n$),o$=[],s$=v.F._lenCodes(e$.dtree,o$),a$=0;a$<n$.length;a$+=2)e$.ihst[n$[a$]]++;for(a$=0;a$<o$.length;a$+=2)e$.ihst[o$[a$]]++;a$=v.F._hufTree(e$.ihst,e$.itree,7);for(var c$=19;4<c$&&e$.itree[1+(e$.ordr[c$-1]<<1)]==0;)c$--;return[t$,r$,a$,i$,s$,c$,n$,o$]},v.F.getSecond=function(e$){for(var t$=[],r$=0;r$<e$.length;r$+=2)t$.push(e$[r$+1]);return t$},v.F.nonZero=function(e$){for(var t$="",r$=0;r$<e$.length;r$+=2)e$[r$+1]!=0&&(t$+=(r$>>1)+",");return t$},v.F.contSize=function(e$,t$){for(var r$=0,n$=0;n$<t$.length;n$++)r$+=t$[n$]*e$[1+(n$<<1)];return r$},v.F._codeTiny=function(e$,t$,r$,n$){for(var i$=0;i$<e$.length;i$+=2){var o$=e$[i$],s$=e$[i$+1];n$=v.F._writeLit(o$,t$,r$,n$);var a$=o$==16?2:o$==17?3:7;15<o$&&(v.F._putsE(r$,n$,s$,a$),n$+=a$)}return n$},v.F._lenCodes=function(e$,t$){for(var r$=e$.length;r$!=2&&e$[r$-1]==0;)r$-=2;for(var n$=0;n$<r$;n$+=2){var i$=e$[n$+1],o$=n$+3<r$?e$[n$+3]:-1,s$=n$+5<r$?e$[n$+5]:-1,a$=n$==0?-1:e$[n$-1];if(i$==0&&o$==i$&&s$==i$){for(o$=n$+5;o$+2<r$&&e$[o$+2]==i$;)o$+=2;11>(i$=Math.min(o$+1-n$>>>1,138))?t$.push(17,i$-3):t$.push(18,i$-11),n$+=2*i$-2}else if(i$==a$&&o$==i$&&s$==i$){for(o$=n$+5;o$+2<r$&&e$[o$+2]==i$;)o$+=2;i$=Math.min(o$+1-n$>>>1,6),t$.push(16,i$-3),n$+=2*i$-2}else t$.push(i$,0)}return r$>>>1},v.F._hufTree=function(e$,t$,r$){var n$=[],i$=e$.length,o$=t$.length,s$=0;for(s$=0;s$<o$;s$+=2)t$[s$]=0,t$[s$+1]=0;for(s$=0;s$<i$;s$++)e$[s$]!=0&&n$.push({lit:s$,f:e$[s$]});if(e$=n$.length,i$=n$.slice(0),e$==0)return 0;if(e$==1)return t$[1+((r$=n$[0].lit)<<1)]=1,t$[1+((r$==0?1:0)<<1)]=1;n$.sort(function(l$,d$){return l$.f-d$.f}),s$=n$[0],o$=n$[1];var a$=0,c$=1,u$=2;for(n$[0]={lit:-1,f:s$.f+o$.f,l:s$,r:o$,d:0};c$!=e$-1;)s$=a$!=c$&&(u$==e$||n$[a$].f<n$[u$].f)?n$[a$++]:n$[u$++],o$=a$!=c$&&(u$==e$||n$[a$].f<n$[u$].f)?n$[a$++]:n$[u$++],n$[c$++]={lit:-1,f:s$.f+o$.f,l:s$,r:o$};for((n$=v.F.setDepth(n$[c$-1],0))>r$&&(v.F.restrictDepth(i$,r$,n$),n$=r$),s$=0;s$<e$;s$++)t$[1+(i$[s$].lit<<1)]=i$[s$].d;return n$},v.F.setDepth=function(e$,t$){return e$.lit!=-1?e$.d=t$:Math.max(v.F.setDepth(e$.l,t$+1),v.F.setDepth(e$.r,t$+1))},v.F.restrictDepth=function(e$,t$,r$){var n$=0,i$=1<<r$-t$,o$=0;for(e$.sort(function(a$,c$){return c$.d==a$.d?a$.f-c$.f:c$.d-a$.d}),n$=0;n$<e$.length&&e$[n$].d>t$;n$++){var s$=e$[n$].d;e$[n$].d=t$,o$+=i$-(1<<r$-s$)}for(o$>>>=r$-t$;0<o$;)(s$=e$[n$].d)<t$?(e$[n$].d++,o$-=1<<t$-s$-1):n$++;for(;0<=n$;n$--)e$[n$].d==t$&&0>o$&&(e$[n$].d--,o$++);o$!=0&&console.log("debt left")},v.F._goodIndex=function(e$,t$){var r$=0;return t$[16|r$]<=e$&&(r$|=16),t$[8|r$]<=e$&&(r$|=8),t$[4|r$]<=e$&&(r$|=4),t$[2|r$]<=e$&&(r$|=2),t$[1|r$]<=e$&&(r$|=1),r$},v.F._writeLit=function(e$,t$,r$,n$){return v.F._putsF(r$,n$,t$[e$<<1]),n$+t$[1+(e$<<1)]},v.F.inflate=function(e$,t$){var r$=Uint8Array;if(e$[0]==3&&e$[1]==0)return t$||new r$(0);var n$=v.F,i$=n$._bitsF,o$=n$._bitsE,s$=n$._decodeTiny,a$=n$.makeCodes,c$=n$.codes2map,u$=n$._get17,l$=n$.U,d$=t$==null;d$&&(t$=new r$(e$.length>>>2<<3));for(var h$,p$,_$,f$,m$=0,g$=0,v$=p$=0,y$=0;m$==0;)if(m$=i$(e$,y$,1),h$=i$(e$,y$+1,2),y$+=3,h$==0)7&y$&&(y$+=8-(7&y$)),h$=e$[(y$=4+(y$>>>3))-4]|e$[y$-3]<<8,d$&&(t$=v.F._check(t$,v$+h$)),t$.set(new r$(e$.buffer,e$.byteOffset+y$,h$),v$),y$=y$+h$<<3,v$+=h$;else{if(d$&&(t$=v.F._check(t$,v$+131072)),h$==1&&(_$=l$.flmap,f$=l$.fdmap,g$=511,p$=31),h$==2){for(p$=o$(e$,y$,5)+257,h$=o$(e$,y$+5,5)+1,_$=o$(e$,y$+10,4)+4,y$+=14,f$=0;38>f$;f$+=2)l$.itree[f$]=0,l$.itree[f$+1]=0;for(g$=1,f$=0;f$<_$;f$++){var S$=o$(e$,y$+3*f$,3);l$.itree[1+(l$.ordr[f$]<<1)]=S$,S$>g$&&(g$=S$)}y$+=3*_$,a$(l$.itree,g$),c$(l$.itree,g$,l$.imap),_$=l$.lmap,f$=l$.dmap,y$=s$(l$.imap,(1<<g$)-1,p$+h$,e$,y$,l$.ttree),g$=(1<<(S$=n$._copyOut(l$.ttree,0,p$,l$.ltree)))-1,p$=(1<<(h$=n$._copyOut(l$.ttree,p$,h$,l$.dtree)))-1,a$(l$.ltree,S$),c$(l$.ltree,S$,_$),a$(l$.dtree,h$),c$(l$.dtree,h$,f$)}for(;;)if(y$+=15&(h$=_$[u$(e$,y$)&g$]),(S$=h$>>>4)>>>8==0)t$[v$++]=S$;else{if(S$==256)break;h$=v$+S$-254,264<S$&&(h$=v$+((S$=l$.ldef[S$-257])>>>3)+o$(e$,y$,7&S$),y$+=7&S$),y$+=15&(S$=f$[u$(e$,y$)&p$]);var b$=((S$=l$.ddef[S$>>>4])>>>4)+i$(e$,y$,15&S$);for(y$+=15&S$,d$&&(t$=v.F._check(t$,v$+131072));v$<h$;)t$[v$]=t$[v$++-b$],t$[v$]=t$[v$++-b$],t$[v$]=t$[v$++-b$],t$[v$]=t$[v$++-b$];v$=h$}}return t$.length==v$?t$:t$.slice(0,v$)},v.F._check=function(e$,t$){var r$=e$.length;return t$<=r$?e$:((t$=new Uint8Array(Math.max(r$<<1,t$))).set(e$,0),t$)},v.F._decodeTiny=function(e$,t$,r$,n$,i$,o$){for(var s$=v.F._bitsE,a$=v.F._get17,c$=0;c$<r$;){var u$=e$[a$(n$,i$)&t$];i$+=15&u$;var l$=u$>>>4;if(15>=l$)o$[c$]=l$,c$++;else{var d$=u$=0;for(l$==16?(d$=3+s$(n$,i$,2),i$+=2,u$=o$[c$-1]):l$==17?(d$=3+s$(n$,i$,3),i$+=3):l$==18&&(d$=11+s$(n$,i$,7),i$+=7),l$=c$+d$;c$<l$;)o$[c$]=u$,c$++}}return i$},v.F._copyOut=function(e$,t$,r$,n$){for(var i$=0,o$=0,s$=n$.length>>>1;o$<r$;){var a$=e$[o$+t$];n$[o$<<1]=0,n$[1+(o$<<1)]=a$,a$>i$&&(i$=a$),o$++}for(;o$<s$;)n$[o$<<1]=0,n$[1+(o$<<1)]=0,o$++;return i$},v.F.makeCodes=function(e$,t$){var r$,n$,i$=v.F.U,o$=e$.length,s$=i$.bl_count;for(r$=0;r$<=t$;r$++)s$[r$]=0;for(r$=1;r$<o$;r$+=2)s$[e$[r$]]++;for(i$=i$.next_code,r$=0,s$[0]=0,n$=1;n$<=t$;n$++)r$=r$+s$[n$-1]<<1,i$[n$]=r$;for(t$=0;t$<o$;t$+=2)(s$=e$[t$+1])!=0&&(e$[t$]=i$[s$],i$[s$]++)},v.F.codes2map=function(e$,t$,r$){for(var n$=e$.length,i$=v.F.U.rev15,o$=0;o$<n$;o$+=2)if(e$[o$+1]!=0){var s$=e$[o$+1],a$=o$>>1<<4|s$,c$=t$-s$;for(c$=(s$=e$[o$]<<c$)+(1<<c$);s$!=c$;)r$[i$[s$]>>>15-t$]=a$,s$++}},v.F.revCodes=function(e$,t$){for(var r$=v.F.U.rev15,n$=15-t$,i$=0;i$<e$.length;i$+=2)e$[i$]=r$[e$[i$]<<t$-e$[i$+1]]>>>n$},v.F._putsE=function(e$,t$,r$){r$<<=7&t$,e$[t$>>>=3]|=r$,e$[t$+1]|=r$>>>8},v.F._putsF=function(e$,t$,r$){r$<<=7&t$,e$[t$>>>=3]|=r$,e$[t$+1]|=r$>>>8,e$[t$+2]|=r$>>>16},v.F._bitsE=function(e$,t$,r$){return(e$[t$>>>3]|e$[1+(t$>>>3)]<<8)>>>(7&t$)&(1<<r$)-1},v.F._bitsF=function(e$,t$,r$){return(e$[t$>>>3]|e$[1+(t$>>>3)]<<8|e$[2+(t$>>>3)]<<16)>>>(7&t$)&(1<<r$)-1},v.F._get17=function(e$,t$){return(e$[t$>>>3]|e$[1+(t$>>>3)]<<8|e$[2+(t$>>>3)]<<16)>>>(7&t$)},v.F._get25=function(e$,t$){return(e$[t$>>>3]|e$[1+(t$>>>3)]<<8|e$[2+(t$>>>3)]<<16|e$[3+(t$>>>3)]<<24)>>>(7&t$)},v.F.U=function(){var e$=Uint16Array,t$=Uint32Array;return{next_code:new e$(16),bl_count:new e$(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e$(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t$(32),flmap:new e$(512),fltree:[],fdmap:new e$(32),fdtree:[],lmap:new e$(32768),ltree:[],ttree:[],dmap:new e$(32768),dtree:[],imap:new e$(512),itree:[],rev15:new e$(32768),lhst:new t$(286),dhst:new t$(30),ihst:new t$(19),lits:new t$(15e3),strt:new e$(65536),prev:new e$(32768)}}(),function(){function e$(i$,o$,s$){for(;o$--!=0;)i$.push(0,s$)}for(var t$=v.F.U,r$=0;32768>r$;r$++){var n$=r$;n$=(4278255360&(n$=(4042322160&(n$=(3435973836&(n$=(2863311530&n$)>>>1|(1431655765&n$)<<1))>>>2|(858993459&n$)<<2))>>>4|(252645135&n$)<<4))>>>8|(16711935&n$)<<8,t$.rev15[r$]=(n$>>>16|n$<<16)>>>17}for(r$=0;32>r$;r$++)t$.ldef[r$]=t$.of0[r$]<<3|t$.exb[r$],t$.ddef[r$]=t$.df0[r$]<<4|t$.dxb[r$];e$(t$.fltree,144,8),e$(t$.fltree,112,9),e$(t$.fltree,24,7),e$(t$.fltree,8,8),v.F.makeCodes(t$.fltree,9),v.F.codes2map(t$.fltree,9,t$.flmap),v.F.revCodes(t$.fltree,9),e$(t$.fdtree,32,5),v.F.makeCodes(t$.fdtree,5),v.F.codes2map(t$.fdtree,5,t$.fdmap),v.F.revCodes(t$.fdtree,5),e$(t$.itree,19,0),e$(t$.ltree,286,0),e$(t$.dtree,30,0),e$(t$.ttree,320,0)}();var iD=["backups","servers"],jD=["backups","servers"],kD=["group"],nl=v.inflate,ks=v.deflate,ls=function(e$){function t$(n$,i$,o$,s$){W(this,t$);var a$=r$.call(this,s$,"Session");return m(n(a$),"chatManager",void 0),m(n(a$),"joinedChannels",new Set),m(n(a$),"msgDedupLru",new tc(void 0,{maxlen:200})),m(n(a$),"startTime",Date.now()),m(n(a$),"seq",U.fromNumber(1,!0)),m(n(a$),"userJoinOptions",new is(!1)),m(n(a$),"seqSentStatuses",[!1,!1]),m(n(a$),"dialogueSequenceLru",new tc(void 0,{maxlen:1e4})),m(n(a$),"loggedOut",!1),m(n(a$),"messageSentTimes",[]),m(n(a$),"curLoginSockets",[void 0,void 0]),m(n(a$),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),m(n(a$),"lastLoginSockets",[new qe(1),new qe(1)]),m(n(a$),"dialPendingMsgSubjectMap",new Map),m(n(a$),"context",void 0),m(n(a$),"connection",void 0),m(n(a$),"instanceId",void 0),m(n(a$),"registerSocketsFailureListener",function(){a$.connection.once("socketsFailure",function(){a$.log("socketsFailure, creating a new connection"),ad(function(){return a$.connection.removeAllListeners(),a$.connection=new Yr(a$.context,a$.logger,!0),a$.loginHandler(15e3,!0)}).pipe(oe(function(c$){return c$.pipe(cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")))}),ob(a$.connection.apClient.apFinish$)).subscribe(function(){a$.log("new connection connected")})}),a$.connection.listenerCount("tokenExpired")===0&&a$.connection.on("tokenExpired",function(){a$.emit("tokenExpired")})}),a$.context=n$,a$.connection=i$,a$.instanceId=o$,a$.chatManager=new hD(s$),a$.log("The instanceId is %s",a$.instanceId.toString()),a$}la(t$,e$);var r$=ma(t$);return Ha(t$,[{key:"fetchFileUploadIndexGet",value:function(n$){var i$=n$.hash,o$=n$.size;if((n$=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var s$=this.incGetSeq();return n$.forEach(function(a$){a$.sendPacket("FileUploadIndexGet",{seq:s$,hash:i$,size:o$})}),{ret:Ca.apply(void 0,G(n$.map(function(a$){return a$.fromReceived("FileUploadIndexRet").pipe(aa(function(c$){return s$.eq(c$.seq)}))}))),fin:Ca.apply(void 0,G(n$.map(function(a$){return a$.fromReceived("FileUploadIndexFin").pipe(aa(function(c$){return s$.eq(c$.seq)}))}))),err:Xb.apply(void 0,G(n$.map(function(a$){return a$.fromReceived("FileUploadIndexErr").pipe(aa(function(c$){return s$.eq(c$.seq)}),ba(function(c$){throw new da(["The media message upload failure, code %d",c$.code],lg)}))}))),timeout:t$.genTimeoutError(Lh)}}},{key:"requestFileUploadIndexSet",value:function(n$){var i$=n$.hash,o$=n$.unit,s$=n$.servers;if((n$=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var a$=this.incGetSeq();return n$.forEach(function(c$){c$.sendPacket("FileUploadIndexSet",{seq:a$,servers:s$,hash:i$,unit:o$})}),Ca.apply(void 0,[t$.genTimeoutError(Lh)].concat(G(n$.map(function(c$){return c$.fromReceived("FileUploadIndexErr").pipe(aa(function(u$){return a$.eq(u$.seq)}),ba(function(u$){throw new da(["FileUploadIndexSet failure, code %d",u$.code],lg)}))})),G(n$.map(function(c$){return c$.fromReceived("FileUploadIndexFin").pipe(aa(function(u$){return a$.eq(u$.seq)}))}))))}},{key:"requestFileDownloadIndexGet",value:function(n$){var i$=n$.size,o$=n$.zone,s$=n$.unit,a$=n$.hash,c$=this.getLoginSockets();if(c$.length===0)throw new K("Client is not logged in");var u$=this.incGetSeq();return c$.forEach(function(l$){l$.sendPacket("FileDownloadIndexGet",{seq:u$,size:i$,zone:o$,unit:s$,hash:a$})}),n$=Ca.apply(void 0,G(c$.map(function(l$){return l$.fromReceived("FileDownloadIndexRet").pipe(aa(function(d$){return u$.eq(d$.seq)}))}))).pipe(ba(function(l$){var d$=l$.backups,h$=l$.servers;return l$=ff(l$,iD),ua({backupList:d$.map(function(p$){return[p$]}),serverList:h$.map(function(p$){return[p$]})},l$)}),cd(500)),c$=jm(c$.map(function(l$){return l$.fromReceived("FileDownloadIndexRet").pipe(aa(function(d$){return u$.eq(d$.seq)}))})),Ca(n$,c$.pipe(ba(function(l$){return l$.reduce(function(d$,h$){var p$=d$.backupList,_$=d$.serverList;d$=h$.backups;var f$=h$.servers;return h$=ff(h$,jD),ua({backupList:d$.map(function(m$,g$){return[m$].concat(G(p$!==void 0&&Array.isArray(p$[g$])?p$[g$]:[]))}),serverList:f$.map(function(m$,g$){return[m$].concat(G(p$!==void 0&&Array.isArray(_$[g$])?_$[g$]:[]))})},h$)},{})})),t$.genTimeoutError(Lh))}},{key:"loginHandler",value:function(){var n$=this,i$=0<arguments.length&&arguments[0]!==void 0?arguments[0]:2e4,o$=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(this.loggedOut&&o$)throw new K("Already logged out, request ignored");o$&&this.registerSocketsFailureListener(),this.connection.initConnection();var s$=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),a$=Date.now();return s$.forEach(function(c$,u$){var l$=n$.loginSocketSubs[u$].login;l$!==void 0&&l$.unsubscribe(),n$.loginSocketSubs[u$].login=c$.pipe(ca(function(d$){var h$;n$.curLoginSockets[u$]=d$;var p$=Date.now();eb("Link",{ackedServerIp:d$.address,destServerIp:d$.ip,ec:0,sc:0,elapse:fb(n$.startTime),lts:U.fromNumber(p$),responseTime:a$-p$,sid:Xa(n$.instanceId),userId:n$.context.uid},(h$=n$.context.config.enableCloudProxy)!==null&&h$!==void 0&&h$),n$.emit("userJoined",d$.env),o$&&n$.connection.apClient.apFinish$.next(void 0)})).subscribe(n$.lastLoginSockets[u$])}),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Xb.apply(void 0,G(s$).concat([gb(this.connection,"connectionInitFailure").pipe(ca(function(c$){throw sa(c$)||Sa(c$)?c$:new da("Login failure",{code:Zq,originalError:c$})}))])).pipe(Ka(1),hb(i$),Ga(function(c$){return c$ instanceof pb&&n$.warn("Client login timeout"),c$&&c$.code===Kh&&(n$.connection.emit("tokenExpired"),n$.connection.apClient.apFinish$.next(void 0)),n$.clearSockets(0,o$),Z(c$)}),ca(function(){o$||n$.registerSocketsFailureListener()}),wg(function(){o$||n$.connection.apClient.apFinish$.next(void 0)}))}},{key:"logoutHandler",value:function(){var n$=J(w.mark(function i$(){var o$,s$,a$,c$=this;return w.wrap(function(u$){for(;;)switch(u$.prev=u$.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),o$=this.getLoginSockets(),s$=o$.map(function(l$){return l$.sendPacket("UserQuit",{}),c$.connection.waitClosing(l$)}),this.clearSockets(5e3),a$=o$.map(function(l$){return l$.env}),[0,1].filter(function(l$){return!a$.includes(l$)}).forEach(function(l$){c$.connection.closeSocket(l$,0)}),u$.abrupt("return",Xb.apply(void 0,G(s$)).toPromise());case 9:case"end":return u$.stop()}},i$,this)}));return function(){return n$.apply(this,arguments)}}()},{key:"requestChannelJoin",value:function(){var n$=J(w.mark(function i$(o$,s$){var a$,c$,u$,l$=this;return w.wrap(function(d$){for(;;)switch(d$.prev=d$.next){case 0:if(this.getLoginSockets().length!==0){d$.next=2;break}throw new K("Client is not logged in. Cannot join the channel",Vq);case 2:return a$=gb(this,"channelLeft").pipe(wb(function(h$){return h$===o$}),Ka(1)),c$=this.incGetSeq(),(u$=this.lastLoginSockets.map(function(h$){return h$.pipe(Cc(function(p$,_$){_$!==0&&l$.incSeqIfNeeded(p$.env);var f$=_$===0?c$:l$.seq;return p$.sendPacket("GroupEnter",{account:s$,seq:f$}),p$.fromReceived("GroupReply").pipe(aa(function(m$){return f$.eq(m$.seq)}),ca(function(m$){if((m$=m$.code)!==0)throw new da(["Channel join failure. The response code is %d",m$],Rq)}))}),ob(a$),pe())})).forEach(function(h$,p$){var _$=function(){return l$.loginSocketSubs[p$].channels.delete(o$.channelId)};l$.loginSocketSubs[p$].channels.set(o$.channelId,h$.subscribe({error:_$,complete:_$}))}),d$.next=8,Xb.apply(void 0,G(u$)).pipe(Ka(1),hb(1e4),Ga(function(h$){return h$ instanceof pb&&l$.warn("Channel join timeout"),Z(h$)})).toPromise();case 8:this.joinedChannels.add(o$);case 9:case"end":return d$.stop()}},i$,this)}));return function(i$,o$){return n$.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(n$,i$){this.emit("channelLeft",n$),this.joinedChannels.delete(n$),this.getLoginSockets().forEach(function(o$){o$.sendPacket("GroupLeave",{account:i$})})}},{key:"requestChannelMemberList",value:function(n$){var i$=this.getLoginSockets();if(i$.length===0)throw new K("Client is not logged in. Cannot get the channel members",cA);var o$=this.incGetSeq();return i$.forEach(function(s$){s$.sendPacket("GroupAllUsersList",{group:n$,pageNumber:0,pageSize:200,seq:o$})}),Ca.apply(void 0,[t$.genTimeoutError(Pq)].concat(G(i$.map(function(s$){return s$.fromReceived("GroupAllUsersResult").pipe(aa(function(a$){var c$=a$.seq;return a$.group===n$&&o$.eq(c$)}))}))))}},{key:"requestPeersOnlineStatus",value:function(n$){var i$=this.getLoginSockets();if(i$.length===0)throw new K("Client is not logged in");var o$=this.incGetSeq();return i$.forEach(function(s$){s$.sendPacket("UserStatusList",{users:n$,seq:o$})}),Ca.apply(void 0,[t$.genTimeoutError(oA)].concat(G(i$.map(function(s$){return s$.fromReceived("UserStatusResult").pipe(aa(function(a$){return o$.eq(a$.seq)}))}))))}},{key:"requestSetLocalUserAttributes",value:function(n$,i$){var o$=this,s$=this.getLoginSockets();if(s$.length===0)throw new K("Client is not logged in");var a$=this.incGetSeq();return s$.forEach(function(c$,u$){i$!==void 0&&u$!==i$||c$.sendPacket("UserAttributeSet",{account:o$.context.uid,attributeInfos:Object.entries(n$).map(function(l$){return{key:(l$=ra(l$,2))[0],value:l$[1]}}),seq:a$})}),Ca.apply(void 0,G(s$.map(function(c$){return c$.fromReceived("UserAttributeErr").pipe(aa(function(u$){return a$.eq(u$.seq)}),ba(function(u$){throw new da(["The user attributes set failure, code %d",u$.code],Sb)}))})).concat([t$.genTimeoutError(Tb)],G(s$.map(function(c$){return c$.fromReceived("UserAttributeRsp").pipe(aa(function(u$){return a$.eq(u$.seq)}))}))))}},{key:"requestSetChannelAttributes",value:function(n$,i$,o$){var s$=this.getLoginSockets();if(s$.length===0)throw new K("Client is not logged in");var a$=this.incGetSeq();return s$.forEach(function(c$){c$.sendPacket("GroupAttributeSet",{broadcast:o$,group:n$,attributeInfos:Object.entries(i$).map(function(u$){return{key:(u$=ra(u$,2))[0],value:u$[1]}}),seq:a$})}),Ca.apply(void 0,G(s$.map(function(c$){return c$.fromReceived("GroupAttributeErr").pipe(aa(function(u$){return a$.eq(u$.seq)}),ba(function(u$){throw new da(["The group attributes set failure, code %d",u$.code],Sb)}))})).concat([t$.genTimeoutError(Tb)],G(s$.map(function(c$){return c$.fromReceived("GroupAttributeRsp").pipe(aa(function(u$){return a$.eq(u$.seq)}))}))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(n$){var i$=this,o$=this.getLoginSockets();if(o$.length===0)throw new K("Client is not logged in");var s$=this.incGetSeq();return o$.forEach(function(a$){a$.sendPacket("UserAttributeMod",{account:i$.context.uid,attributeInfos:Object.entries(n$).map(function(c$){return{key:(c$=ra(c$,2))[0],value:c$[1]}}),seq:s$})}),Ca.apply(void 0,G(o$.map(function(a$){return a$.fromReceived("UserAttributeErr").pipe(aa(function(c$){return s$.eq(c$.seq)}),ba(function(c$){throw new da(["The user attributes add or update failure, code %d",c$.code],Sb)}))})).concat([t$.genTimeoutError(Tb)],G(o$.map(function(a$){return a$.fromReceived("UserAttributeRsp").pipe(aa(function(c$){return s$.eq(c$.seq)}))}))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(n$,i$,o$){var s$=this.getLoginSockets();if(s$.length===0)throw new K("Client is not logged in");var a$=this.incGetSeq();return s$.forEach(function(c$){c$.sendPacket("GroupAttributeMod",{broadcast:o$,group:n$,attributeInfos:Object.entries(i$).map(function(u$){return{key:(u$=ra(u$,2))[0],value:u$[1]}}),seq:a$})}),Ca.apply(void 0,G(s$.map(function(c$){return c$.fromReceived("GroupAttributeErr").pipe(aa(function(u$){return a$.eq(u$.seq)}),ba(function(u$){throw new da(["The group attributes add or update failure, code %d",u$.code],Sb)}))})).concat([t$.genTimeoutError(Tb)],G(s$.map(function(c$){return c$.fromReceived("GroupAttributeRsp").pipe(aa(function(u$){return a$.eq(u$.seq)}))}))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(n$){var i$=this,o$=this.getLoginSockets();if(o$.length===0)throw new K("Client is not logged in");var s$=this.incGetSeq();return o$.forEach(function(a$){a$.sendPacket("UserAttributeDel",{account:i$.context.uid,attributes:n$,seq:s$})}),Ca.apply(void 0,G(o$.map(function(a$){return a$.fromReceived("UserAttributeErr").pipe(aa(function(c$){return s$.eq(c$.seq)}),ba(function(c$){throw new da(["The user attributes delete failure, code %d",c$.code],Sb)}))})).concat([t$.genTimeoutError(Tb)],G(o$.map(function(a$){return a$.fromReceived("UserAttributeRsp").pipe(aa(function(c$){return s$.eq(c$.seq)}))}))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(n$,i$,o$){var s$=this.getLoginSockets();if(s$.length===0)throw new K("Client is not logged in");var a$=this.incGetSeq();return s$.forEach(function(c$){c$.sendPacket("GroupAttributeDel",{group:n$,broadcast:o$,attributes:i$,seq:a$})}),Ca.apply(void 0,G(s$.map(function(c$){return c$.fromReceived("GroupAttributeErr").pipe(aa(function(u$){return a$.eq(u$.seq)}),ba(function(u$){throw new da(["The channel attributes delete failure, code %d",u$.code],Sb)}))})).concat([t$.genTimeoutError(Tb)],G(s$.map(function(c$){return c$.fromReceived("GroupAttributeRsp").pipe(aa(function(u$){return a$.eq(u$.seq)}))}))))}},{key:"requestClearLocalUserAttributes",value:function(){var n$=this,i$=this.getLoginSockets();if(i$.length===0)throw new K("Client is not logged in");var o$=this.incGetSeq();return i$.forEach(function(s$){s$.sendPacket("UserAttributeSet",{account:n$.context.uid,seq:o$,attributeInfos:[]})}),Ca.apply(void 0,G(i$.map(function(s$){return s$.fromReceived("UserAttributeErr").pipe(aa(function(a$){return o$.eq(a$.seq)}),ba(function(a$){throw new da(["The user attributes clear failure, code %d",a$.code],Sb)}))})).concat([t$.genTimeoutError(Tb)],G(i$.map(function(s$){return s$.fromReceived("UserAttributeRsp").pipe(aa(function(a$){return o$.eq(a$.seq)}))}))))}},{key:"requestClearChannelAttributes",value:function(n$,i$){var o$=this.getLoginSockets();if(o$.length===0)throw new K("Client is not logged in");var s$=this.incGetSeq();return o$.forEach(function(a$){a$.sendPacket("GroupAttributeSet",{group:n$,seq:s$,attributeInfos:[],broadcast:i$})}),Ca.apply(void 0,G(o$.map(function(a$){return a$.fromReceived("GroupAttributeErr").pipe(aa(function(c$){return s$.eq(c$.seq)}),ba(function(c$){throw new da(["The channel attributes clear failure, code %d",c$.code],Sb)}))})).concat([t$.genTimeoutError(Tb)],G(o$.map(function(a$){return a$.fromReceived("GroupAttributeRsp").pipe(aa(function(c$){return s$.eq(c$.seq)}))}))))}},{key:"requestGetUserAttributesByKeys",value:function(n$,i$){var o$=this.getLoginSockets();if(o$.length===0)throw new K("Client is not logged in");var s$=this.incGetSeq();return o$.forEach(function(a$){a$.sendPacket("UserAttributeGet",{account:n$,seq:s$,attributes:i$})}),Ca.apply(void 0,[t$.genTimeoutError(Tb)].concat(G(o$.map(function(a$){return a$.fromReceived("UserAttributeErr").pipe(aa(function(c$){return s$.eq(c$.seq)}),ba(function(c$){throw(c$=c$.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",c$],Sb)}))})),G(o$.map(function(a$){return a$.fromReceived("UserAttributeRet").pipe(aa(function(c$){return s$.eq(c$.seq)}))}))))}},{key:"requestGetChannelAttributesByKeys",value:function(n$,i$){var o$=this.getLoginSockets();if(o$.length===0)throw new K("Client is not logged in");var s$=this.incGetSeq();return o$.forEach(function(a$){a$.sendPacket("GroupAttributeGet",{group:n$,seq:s$,attributes:i$})}),Ca.apply(void 0,[t$.genTimeoutError(Tb)].concat(G(o$.map(function(a$){return a$.fromReceived("GroupAttributeErr").pipe(aa(function(c$){return s$.eq(c$.seq)}),ba(function(c$){throw new da(["The channel attributes get failure, code %d",c$.code],Sb)}))})),G(o$.map(function(a$){return a$.fromReceived("GroupAttributeRet").pipe(aa(function(c$){return s$.eq(c$.seq)}))}))))}},{key:"requestGetUserAttributeKeys",value:function(n$){var i$=this.getLoginSockets();if(i$.length===0)throw new K("Client is not logged in");var o$=this.incGetSeq();return i$.forEach(function(s$){s$.sendPacket("UserAttributeKeysGet",{account:n$,seq:o$})}),Ca.apply(void 0,[t$.genTimeoutError(Tb)].concat(G(i$.map(function(s$){return s$.fromReceived("UserAttributeErr").pipe(aa(function(a$){return o$.eq(a$.seq)}),ba(function(a$){throw(a$=a$.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",a$],Sb)}))})),G(i$.map(function(s$){return s$.fromReceived("UserAttributeKeysRet").pipe(aa(function(a$){return o$.eq(a$.seq)}))}))))}},{key:"requestGetChannelAttributesKeys",value:function(n$){var i$=this.getLoginSockets();if(i$.length===0)throw new K("Client is not logged in");var o$=this.incGetSeq();return i$.forEach(function(s$){s$.sendPacket("GroupAttributeKeysGet",{group:n$,seq:o$})}),Ca.apply(void 0,[t$.genTimeoutError(Tb)].concat(G(i$.map(function(s$){return s$.fromReceived("GroupAttributeErr").pipe(aa(function(a$){return o$.eq(a$.seq)}),ba(function(a$){throw new Wc(["Channel attribute operation unknown error code: %d",a$.code],Sb)}))})),G(i$.map(function(s$){return s$.fromReceived("GroupAttributeKeysRet").pipe(aa(function(a$){return o$.eq(a$.seq)}))}))))}},{key:"requestGetChannelMemberCount",value:function(n$){var i$=this.getLoginSockets();if(i$.length===0)throw new K("Client is not logged in");var o$=this.incGetSeq();return i$.forEach(function(s$){s$.sendPacket("GroupStatusList",{groups:n$,seq:o$})}),Ca.apply(void 0,[t$.genTimeoutError(Pq)].concat(G(i$.map(function(s$){return s$.fromReceived("GroupStatusResult").pipe(aa(function(a$){return o$.eq(a$.seq)}))}))))}},{key:"requestSubscribePeersOnlineStatus",value:function(n$){var i$=this.getLoginSockets();if(i$.length===0)throw new K("Client is not logged in");var o$=this.incGetSeq();return i$.forEach(function(s$){s$.sendPacket("SubscribeUserStatus",{seq:o$,users:n$})}),Ca.apply(void 0,[t$.genTimeoutError(vA)].concat(G(i$.map(function(s$){return s$.fromReceived("SubscribeResponse").pipe(aa(function(a$){return o$.eq(a$.seq)}))}))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(n$){var i$=this.getLoginSockets();if(i$.length===0)throw new K("Client is not logged in");var o$=this.incGetSeq();i$.forEach(function(s$){s$.sendPacket("UnsubscribeUserStatus",{seq:o$,users:n$})})}},{key:"sendInvitationMessage",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$,c$,u$,l$,d$,h$,p$,_$,f$,m$,g$,v$=this;return w.wrap(function(y$){for(;;)switch(y$.prev=y$.next){case 0:if(s$=o$.peerId,a$=o$.callId,c$=o$.extra,u$=o$.isAcceptAck,l$=o$.channelId,d$=o$.type,h$={callId:a$},u$===void 0){y$.next=6;break}if(d$==="CallAccept"){y$.next=5;break}throw Error("invalid invitation type");case 5:h$.type=u$?"ack":"request";case 6:return h$.channel=l$,(d$==="CallInvite"||d$==="CallCancel"||d$==="CallReject"||d$==="CallAccept"&&u$===!1)&&c$!==void 0&&(h$.extra=c$),p$=Bg(),this.log("The sent invitation body is %o",h$),_$=function(S$){return{MiscMap:{},sequence:U.fromNumber(1),dialogue:p$,instance:v$.instanceId,dst:s$,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:S$,MessageType:d$}).toLong(),payload:new TextEncoder().encode(JSON.stringify(h$)),src:v$.context.uid}},y$.next=14,Kb(this.sendMessageToRetry(_$,!0)).pipe(hb(1e4),Ga(function(S$){return S$ instanceof pb&&v$.warn("Send invitation timeout"),Z(S$)})).toPromise();case 14:return f$=y$.sent,m$=f$.code,g$=f$.retryTimes,y$.abrupt("return",{hasPeerReceived:m$===0,hasReSent:g$!==0});case 18:case"end":return y$.stop()}},i$,this)}));return function(i$){return n$.apply(this,arguments)}}()},{key:"sendMediaMessage",value:function(){var n$=J(w.mark(function i$(o$,s$,a$,c$,u$,l$){var d$,h$,p$,_$,f$,m$,g$,v$,y$,S$,b$,$$,C$,N$,k$,O$,U$,x$,F$,L$,M$,V$,A$,I$,P$,w$,E$,T$,R$,D$=this;return w.wrap(function(j$){for(;;)switch(j$.prev=j$.next){case 0:if(h$=s$.width,p$=h$===void 0?0:h$,_$=s$.height,f$=_$===void 0?0:_$,m$=s$.fileName,g$=m$===void 0?"":m$,v$=s$.description,y$=v$===void 0?"":v$,S$=s$.thumbnail,b$=S$===void 0?new Blob:S$,$$=s$.thumbnailHeight,C$=$$===void 0?0:$$,N$=s$.thumbnailWidth,k$=N$===void 0?0:N$,O$=s$.size,U$=O$===void 0?0:O$,x$=s$.mediaId,F$=u$.enableOfflineMessaging,L$=u$.enableHistoricalMessaging,za(a$)){j$.next=4;break}throw new I("The send message arguments are not valid",c$?$k:hg);case 4:if(!(32768<new Blob([g$,b$,y$]).size)){j$.next=6;break}throw new I("The size of message overflowed ",c$?ve:Hh);case 6:return M$=this.chatManager.getChatInfo(a$),V$=M$.dialogue,A$=M$.sequence,I$=this.instanceId,this.log('A%s media message is sending to %s: "'.concat(I$,"-").concat(V$,"#").concat(A$,'"'),c$?" peer":" channel",oa(a$)),m(d$={},"media_description",y$),m(d$,"media_width",p$),m(d$,"media_height",f$),m(d$,"media_thumbnailwidth",k$),m(d$,"media_thumbnailheight",C$),m(d$,"media_size",U$),m(d$,"media_id",x$),m(d$,"media_filename",g$),P$=uc(d$,function(G$){return new TextEncoder().encode(G$.toString())}),j$.t0=Uint8Array,j$.next=14,Ji(b$);case 14:return j$.t1=j$.sent,P$.media_thumbnail=new j$.t0(j$.t1),w$=c$&&o$==="IMAGE"?"PeerImageMessage":c$&&o$==="FILE"?"PeerFileMessage":c$||o$!=="IMAGE"?"ChannelFileMessage":"ChannelImageMessage",E$=function(G$){return{MiscMap:P$,sequence:A$,dialogue:V$,instance:I$,dst:a$,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:G$,CompressionMethod:"Uncompressed",MessageType:w$,ToCache:F$,ToArchive:L$}).toLong(),payload:new Uint8Array,src:D$.context.uid}},j$.next=20,Kb(this.sendMessageToRetry(E$,!0)).pipe(hb(l$===void 0?1e4:l$),Ga(function(G$){return G$ instanceof pb&&D$.warn("Send message timeout"),Z(G$)})).toPromise();case 20:if(T$=j$.sent,(R$=T$.code)!==2){j$.next=24;break}throw new da("The peer does not support this type of message",nA);case 24:return j$.abrupt("return",{hasPeerReceived:R$===0});case 25:case"end":return j$.stop()}},i$,this)}));return function(i$,o$,s$,a$,c$,u$){return n$.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var n$=J(w.mark(function i$(o$,s$,a$,c$,u$,l$){var d$,h$,p$,_$,f$,m$,g$,v$,y$,S$,b$=this;return w.wrap(function($$){for(;;)switch($$.prev=$$.next){case 0:if(d$=u$.enableOfflineMessaging,h$=u$.enableHistoricalMessaging,za(a$)&&o$ instanceof Uint8Array&&typeof s$=="string"){$$.next=3;break}throw new I("The send message arguments are not valid",c$?$k:hg);case 3:if(!(32768<o$.byteLength+new Blob([s$]).size)){$$.next=5;break}throw new ib("The message size is over the 32KB limit",c$?ve:Hh);case 5:return p$=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=o$.byteLength,_$=this.chatManager.getChatInfo(a$),f$=_$.dialogue,m$=_$.sequence,g$=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(g$,"-").concat(f$,"#").concat(m$,'"'),p$?" compressed":"",c$?"peer":"channel",oa(a$)),v$=function(C$){return{MiscMap:{description:new TextEncoder().encode(s$)},sequence:m$,dialogue:f$,instance:g$,dst:a$,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:C$,CompressionMethod:p$?"Zlib":"Uncompressed",MessageType:c$?"PeerRawMessage":"ChannelRawMessage",ToCache:d$,ToArchive:h$}).toLong(),payload:p$?ks(o$):o$,src:b$.context.uid}},$$.next=12,Kb(this.sendMessageToRetry(v$,!0)).pipe(hb(l$===void 0?1e4:l$),Ga(function(C$){return C$ instanceof pb&&b$.warn("Send message timeout"),Z(C$)})).toPromise();case 12:return y$=$$.sent,S$=y$.code,$$.abrupt("return",{hasPeerReceived:S$===0});case 15:case"end":return $$.stop()}},i$,this)}));return function(i$,o$,s$,a$,c$,u$){return n$.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var n$=J(w.mark(function i$(o$,s$,a$,c$,u$){var l$,d$,h$,p$,_$,f$,m$,g$,v$,y$,S$,b$=this;return w.wrap(function($$){for(;;)switch($$.prev=$$.next){case 0:if(l$=c$.enableOfflineMessaging,d$=c$.enableHistoricalMessaging,za(s$)){$$.next=3;break}throw new I("The send message arguments are not valid",a$?$k:hg);case 3:if(!(32768<new Blob([o$]).size)){$$.next=5;break}throw new ib("The message size is over the 32KB limit",a$?ve:Hh);case 5:return h$=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([o$]).size,p$=this.chatManager.getChatInfo(s$),_$=p$.dialogue,f$=p$.sequence,m$=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(m$,"-").concat(_$,"#").concat(f$,'"'),h$?" compressed":"",a$?"peer":"channel",oa(s$)),g$=new TextEncoder().encode(o$),v$=function(C$){return{MiscMap:{},sequence:f$,dialogue:_$,instance:m$,dst:s$,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:C$,CompressionMethod:h$?"Zlib":"Uncompressed",MessageType:a$?"PeerTextMessage":"ChannelTextMessage",ToCache:l$,ToArchive:d$}).toLong(),payload:h$?ks(g$):g$,src:b$.context.uid}},$$.next=13,Kb(this.sendMessageToRetry(v$,!0)).pipe(hb(u$===void 0?1e4:u$),Ga(function(C$){return C$ instanceof pb&&b$.warn("Send message timeout"),Z(C$)})).toPromise();case 13:return y$=$$.sent,S$=y$.code,$$.abrupt("return",{hasPeerReceived:S$===0});case 16:case"end":return $$.stop()}},i$,this)}));return function(i$,o$,s$,a$,c$){return n$.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(n$,i$){Object.entries(this.loginSocketSubs[n$]).forEach(function(o$){var s$=(o$=ra(o$,2))[1];o$[0]==="channels"&&i$||(Array.isArray(s$)||s$ instanceof Map?s$.forEach(function(a$){return a$.unsubscribe()}):s$&&s$.unsubscribe())}),this.loginSocketSubs[n$]={channels:i$?this.loginSocketSubs[n$].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var n$=J(w.mark(function i$(o$,s$){var a$,c$,u$,l$,d$,h$,p$,_$,f$,m$=this,g$=arguments;return w.wrap(function(v$){for(;;)switch(v$.prev=v$.next){case 0:if(a$=2<g$.length&&g$[2]!==void 0?g$[2]:0,this.log("Attempt to send the message ".concat(s$?" with retrying, %o":"without retrying"),{retryTimes:a$}),(c$=this.getLoginSockets()).length!==0){v$.next=5;break}throw Error("no logged-in sockets");case 5:return u$=o$(a$),c$.forEach(function(y$){y$.sendPacket("Message",u$)}),l$=u$.dialogue,d$=u$.sequence,h$=u$.instance,p$=c$.map(function(y$){return y$.fromReceived("Ack").pipe(wb(function(S$){return l$.eq(S$.dialogue)&&d$.eq(S$.sequence)&&h$.eq(S$.instance)}))}),v$.prev=9,v$.next=12,Xb.apply(void 0,G(p$)).pipe(hb(6e3),Ga(function(y$){return Sa(y$)&&m$.warn("Message send timeout, retry times %d",a$),Z(y$)}),Ka(1)).toPromise();case 12:return _$=v$.sent,f$=_$.code,this.log("The message has been acked, %o",{code:f$}),v$.abrupt("return",{code:f$,retryTimes:a$});case 18:if(v$.prev=18,v$.t0=v$.catch(9),!(v$.t0 instanceof pb&&s$)){v$.next=22;break}return v$.abrupt("return",this.sendMessageToRetry(o$,!1,a$+1));case 22:throw v$.t0;case 23:case"end":return v$.stop()}},i$,this,[[9,18]])}));return function(i$,o$){return n$.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var n$=this;this.lastLoginSockets.map(function(i$){return i$.pipe(Cc(function(o$){return Bc(0,2750).pipe(ca(function(){n$.incSeqIfNeeded(o$.env),o$.sendPacket("Ping",{ms:U.fromNumber(Date.now(),!0),seq:n$.seq})}))}))}).forEach(function(i$,o$){var s$=n$.loginSocketSubs[o$].keepAlive;s$!==void 0&&s$.unsubscribe(),n$.loginSocketSubs[o$].keepAlive=i$.subscribe({error:function(){}})})}},{key:"initKeepAliveReconnector",value:function(){var n$=this;this.lastLoginSockets.map(function(i$){return i$.pipe(Cc(function(o$){var s$,a$=!1,c$=o$.userJoin$.pipe(ca(function(){a$=!0})),u$=o$.input$.pipe(ca(function(l$){Li[l$.uri].slice(0,-3)!=="Ping"&&(a$=!1)}));return Xb(Bc(15e3,1e4).pipe(Pt(o$.receivedPacket),ca(function(l$){l$=ra(l$,2),l$=ra(l$[1],2)[1],s$!==l$||a$||o$.forceReconnect(),s$=l$})),c$,u$)}))}).forEach(function(i$,o$){var s$=n$.loginSocketSubs[o$].keepAliveReconnector;s$!==void 0&&s$.unsubscribe(),n$.loginSocketSubs[o$].keepAliveReconnector=i$.subscribe({error:function(){}})})}},{key:"initLoginReceiver",value:function(){var n$=this;this.lastLoginSockets.map(function(i$){return i$.pipe(Cc(function(o$){return Xb(gb(o$,"reconnect").pipe(ca(n$.onSocketReconnect(o$))),o$.fromReceived("Message").pipe(ca(n$.onMessage(o$))),o$.fromReceived("GroupEnterNotice").pipe(ca(n$.onGroupEnterNotice())),o$.fromReceived("GroupLeaveNotice").pipe(ca(n$.onGroupLeaveNotice())),o$.fromReceived("GroupCountNotice").pipe(ca(n$.onGroupCountNotice())),o$.fromReceived("GroupAttributeAlt").pipe(ca(n$.onGroupAttributeAlt())),o$.fromReceived("UserJoinNotice").pipe(ca(n$.onUserNotice(S.PeerOnlineState.ONLINE))),o$.fromReceived("UserQuitNotice").pipe(ca(n$.onUserNotice(S.PeerOnlineState.OFFLINE))),o$.fromReceived("UserWaitNotice").pipe(ca(n$.onUserNotice(S.PeerOnlineState.UNREACHABLE)))).pipe(qf(void 0))}))}).forEach(function(i$,o$){n$.loginSocketSubs[o$].receivers.push(i$.subscribe({error:function(){}}))})}},{key:"requestSocketLogin",value:function(n$,i$,o$){var s$=this;return im(ad(function(){s$.userJoinOptions=new is(i$),n$.sendPacket("UserJoin",{account:s$.context.uid,instance:s$.instanceId,opt:s$.userJoinOptions.toLong(),seq:o$,ticket:n$.ticket})}),n$.fromReceived("UserResp").pipe(aa(function(a$){return o$.eq(a$.seq)}),ca(function(a$){if((a$=a$.code)!==0)throw s$.clearSockets(),s$.logError("Connected to gateway success but the Rtm server rejected login"),new da(["Login failure. The response code from the RTM service is %d",a$],jg);s$.log("ENV_%d logged in",n$.env)}),qf(n$),hb(15e3))).pipe(wb(function(a$){return a$!==void 0}),Ga(function(a$){return a$ instanceof pb&&s$.warn("Login response timeout, rejoin: %s",i$),Z(a$)}))}},{key:"getSocketLoginObservables",value:function(n$,i$){var o$=this;return n$.map(function(s$){return s$.pipe(ca(function(a$){a$.listenerCount("socketUserDrop")===0&&a$.on("socketUserDrop",function(c$){return o$.onUserDrop(c$,a$)})}),Cc(function(a$,c$){return o$.incSeqIfNeeded(a$.env),o$.requestSocketLogin(a$,c$!==0,c$===0?i$:o$.seq)}),pe())})}},{key:"incSeqIfNeeded",value:function(n$){if(![0,1].includes(n$))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[n$]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[n$]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var n$=this.curLoginSockets,i$=-1,o$=n$==null?0:n$.length,s$=0,a$=[];++i$<o$;){var c$=n$[i$];c$&&(a$[s$++]=c$)}return a$}},{key:"emitMessage",value:function(n$,i$){var o$=n$.options,s$=n$.payload,a$=n$.src,c$=n$.dst,u$=n$.instance,l$=n$.dialogue,d$=n$.sequence,h$=n$.ms,p$=n$.MiscMap;this.dialogueSequenceLru.set(l$.toString(),d$),u$="".concat(u$,"-").concat(l$,"#").concat(d$),this.msgDedupLru.has(u$)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",i$,u$):(this.msgDedupLru.set(u$,void 0),i$=new ae(o$),this.lastLoginSockets.forEach(function(){var _$=J(w.mark(function f$(m$){var g$;return w.wrap(function(v$){for(;;)switch(v$.prev=v$.next){case 0:return v$.next=2,m$.pipe(Ka(1)).toPromise();case 2:g$=v$.sent,t$.sendMessageAck(n$,g$);case 4:case"end":return v$.stop()}},f$)}));return function(f$){return _$.apply(this,arguments)}}()),o$=i$.isZlibCompressed(),i$.isInvitation()?(c$=pa(o$?nl(Xm(s$,Uint8Array.of(0,0,0,0))):s$),c$=JSON.parse(c$),this.log("The received invitation body is %o",c$),this.emit("invitationMessage",{body:c$,type:i$.getInvitationType(),peerId:a$,serverReceivedTs:h$.toNumber()})):i$.isTextMessage()?(p$=i$.isPeerTextMessage(),s$=pa(o$?nl(Xm(s$,Uint8Array.of(0,0,0,0))):s$),this.info("Received a %s %s text message from %s to %s, %s",o$?" compressed":"",p$?"peer":"channel",oa(a$),oa(c$),u$),p$?(a$={text:s$,peerId:a$,properties:{serverReceivedTs:h$.toNumber(),isOfflineMessage:i$.isFromCache()}},this.emit("peerTextMessage",a$)):this.emit("channelTextMessage",{channelId:c$,memberId:a$,text:s$,properties:{serverReceivedTs:h$.toNumber(),isOfflineMessage:!1}})):i$.isRawMessage()?(l$=i$.isRawPeerMessage(),p$=(p$=p$.description)===void 0?"":pa(p$),s$=o$?nl(s$):s$,this.info("Received a %s %s raw message from %s to %s, %s",o$?" compressed":"",l$?"peer":"channel",oa(a$),oa(c$),u$),l$?(a$={desc:p$,raw:s$,peerId:a$,properties:{serverReceivedTs:h$.toNumber(),isOfflineMessage:i$.isFromCache()}},this.emit("peerRawMessage",a$)):this.emit("channelRawMessage",{desc:p$,raw:s$,channelId:c$,memberId:a$,properties:{serverReceivedTs:h$.toNumber(),isOfflineMessage:!1}})):(i$.isImageMessage()||i$.isFileMessage())&&(s$=i$.isPeerMessage(),this.info("Received a %s media message from %s to %s, %s",s$?"peer":"channel",oa(a$),oa(c$),u$),s$?this.emit("peerMediaMessage",{messageType:i$.isImageMessage()?"IMAGE":"FILE",details:p$,peerId:a$,properties:{serverReceivedTs:h$.toNumber(),isOfflineMessage:i$.isFromCache()}}):this.emit("channelMediaMessage",{messageType:i$.isImageMessage()?"IMAGE":"FILE",details:p$,memberId:a$,channelId:c$,properties:{serverReceivedTs:h$.toNumber(),isOfflineMessage:i$.isFromCache()}})))}},{key:"onSocketReconnect",value:function(n$){var i$=this;return function(){var o$=[0,1].filter(function(s$){return s$!==n$.env})[0];(o$=i$.connection.curOpenSockets[o$])&&!o$.loggedIn&&i$.emit("connectionLost")}}},{key:"onUserDrop",value:function(n$,i$){var o$;n$=n$.code,eb("KickedOff",{code:0,elapse:fb(this.startTime),linkId:parseInt(i$.name.split("-")[1],10),lts:U.fromNumber(Date.now()),server:i$.address,serverCode:n$,sid:Xa(this.instanceId),userId:this.context.uid},(o$=this.context.config.enableCloudProxy)!==null&&o$!==void 0&&o$),n$===10006||n$===10001?this.warn("Login too often and kicked off, reconnect and login"):n$===10009?(this.warn("The instance ID conflicts, reconnecting"),this.instanceId=Bg(),this.context.sid=Xa(this.instanceId),this.emit("instanceChanged",this.instanceId)):[11,14,15,16].includes(n$)&&(this.emit("userDrop",n$),this.clearSockets())}},{key:"clearSockets",value:function(){var n$=this,i$=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,o$=1<arguments.length&&arguments[1]!==void 0&&arguments[1];[0,1].forEach(function(s$){n$.cleanLoginSubs(s$,o$),n$.connection.closeSocket(s$,i$)})}},{key:"onMessage",value:function(n$){var i$=this;return function(o$){var s$=o$.dialogue,a$=o$.instance,c$=o$.sequence,u$=o$.options;if(o$.src===i$.context.uid)i$.log("The message is from the local account, ignored");else{var l$=s$.toString(),d$=i$.dialPendingMsgSubjectMap.get(l$);if(s$="".concat(a$,"-").concat(s$,"#").concat(c$),d$)d$.next(o$),i$.log("Env_%d: The dialogue has pending messages, next: %s",n$.env,s$);else{var h$=i$.dialogueSequenceLru.get(l$);if(d$=!h$&&c$.eq(1),a$=h$!==void 0&&c$.sub(h$).eq(1),d$||a$)i$.emitMessage(o$,n$.env);else{if(h$){if(c$.lte(h$))return;i$.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",n$.env,s$)}else i$.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",n$.env,s$);c$=new Pa,i$.dialPendingMsgSubjectMap.set(l$,c$);var p$=c$.pipe(Qs(Pk),xg(function(_$,f$){return[].concat(G(_$),[f$])},[]),ba(function(_$){return G(_$).sort(function(f$,m$){return f$=f$.sequence,m$=m$.sequence,f$.eq(m$)?0:f$.gt(m$)?1:-1})}),sm(1));u$=!(u$=new ae(u$)).isFromCache()&&!u$.isBufferedMessage(),p$.pipe(ob(Bc(u$?750:1500)),aa(function(_$){if(2>_$.length)return!1;for(var f$=h$===void 0?U.fromNumber(1,!0):h$.add(1),m$=0;m$<_$.length;f$=f$.add(1),m$++)if(!_$[m$].sequence.eq(f$))return!1;return!0}),wg(function(){i$.dialPendingMsgSubjectMap.delete(l$)})).subscribe(function(_$){_$.forEach(function(f$){i$.emitMessage(f$,n$.env),i$.log("Env_%d: The message queue has fully ordered, emitting: %s",n$.env,"".concat(f$.instance,"-").concat(f$.dialogue,"#").concat(f$.sequence))})},function(_$){_$ instanceof vg&&p$.pipe(Ka(1)).subscribe(function(f$){return f$.forEach(function(m$){i$.log("Env_%d: The message pending queue expired, emitting: %s",n$.env,"".concat(m$.instance,"-").concat(m$.dialogue,"#").concat(m$.sequence)),i$.emitMessage(m$,n$.env)})})}),c$.next(o$)}}}}}},{key:"onGroupEnterNotice",value:function(){var n$=this;return function(i$){n$.emit("memberNotice",{channelId:i$.group,seq:i$.seq,instance:i$.instance,memberId:i$.user,type:"MemberJoined",size:i$.size})}}},{key:"onGroupLeaveNotice",value:function(){var n$=this;return function(i$){n$.emit("memberNotice",{channelId:i$.group,seq:i$.seq,instance:i$.instance,memberId:i$.user,type:"MemberLeft",size:i$.size})}}},{key:"onGroupCountNotice",value:function(){var n$=this;return function(i$){n$.emit("memberNotice",{channelId:i$.group,seq:i$.seq,instance:i$.instance,type:"MemberCountUpdated",size:i$.size})}}},{key:"onGroupAttributeAlt",value:function(){var n$=this;return function(i$){var o$=i$.group;i$=ff(i$,kD),n$.emit("channelAttributesUpdated",ua({channelId:o$},i$))}}},{key:"onUserNotice",value:function(n$){var i$=this;return function(o$){i$.emit("peerOnlineStatusChanged",{peerId:o$.user,instance:o$.instance,seq:o$.seq,state:n$})}}}],[{key:"sendMessageAck",value:function(n$,i$){var o$=new ae(n$.options);(o$.isInvitation()||o$.isPeerMessage())&&i$.sendPacket("Ack",{code:0,dialogue:n$.dialogue,instance:n$.instance,sequence:n$.sequence})}}]),t$}(tb());m(ls,"genTimeoutError",function(e$,t$){return bb(void 0).pipe(cd(t$===void 0?1e4:t$),ba(function(){throw new db(["Request timed out after %ds",t$===void 0?1e4:t$],e$)}))});var ms,ol,pl=0,ql=0;Ud.v1=function(e$,t$,r$){r$=t$&&r$||0;var n$=t$||[],i$=(e$=e$||{}).node||ms,o$=e$.clockseq!==void 0?e$.clockseq:ol;if(i$==null||o$==null){var s$=Jq();i$==null&&(i$=ms=[1|s$[0],s$[1],s$[2],s$[3],s$[4],s$[5]]),o$==null&&(o$=ol=16383&(s$[6]<<8|s$[7]))}s$=e$.msecs!==void 0?e$.msecs:new Date().getTime();var a$=e$.nsecs!==void 0?e$.nsecs:ql+1,c$=s$-pl+(a$-ql)/1e4;if(0>c$&&e$.clockseq===void 0&&(o$=o$+1&16383),(0>c$||s$>pl)&&e$.nsecs===void 0&&(a$=0),1e4<=a$)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(pl=s$,ql=a$,ol=o$,e$=(1e4*(268435455&(s$+=122192928e5))+a$)%4294967296,n$[r$++]=e$>>>24&255,n$[r$++]=e$>>>16&255,n$[r$++]=e$>>>8&255,n$[r$++]=255&e$,e$=s$/4294967296*1e4&268435455,n$[r$++]=e$>>>8&255,n$[r$++]=255&e$,n$[r$++]=e$>>>24&15|16,n$[r$++]=e$>>>16&255,n$[r$++]=o$>>>8|128,n$[r$++]=255&o$,o$=0;6>o$;++o$)n$[r$+o$]=i$[o$];return t$||Kq(n$)},Ud.v4=Ud;var rl=Ph(),vd,bf=S.LocalInvitationFailureReason,Ba=S.LocalInvitationState,lD=(vd=function(e$){function t$(n$,i$,o$){W(this,t$);var s$=r$.call(this,o$,"RtmLocalInvitation",!0);return m(n(s$),"state",Ba.IDLE),m(n(s$),"localInvitationEnd$",Ca(gb(n(s$),"LocalInvitationAccepted"),gb(n(s$),"LocalInvitationRefused"),gb(n(s$),"LocalInvitationFailure"),gb(n(s$),"LocalInvitationCanceled")).pipe(Ka(1))),m(n(s$),"callId",Ud.v4()),m(n(s$),"_content",""),m(n(s$),"_channelId",""),m(n(s$),"_response",""),m(n(s$),"calleeId",void 0),m(n(s$),"logger",void 0),m(n(s$),"getSession",void 0),s$.calleeId=n$,s$.getSession=i$,s$.logger=o$,s$}la(t$,e$);var r$=ma(t$);return Ha(t$,[{key:"channelId",get:function(){return this._channelId},set:function(n$){this.state!==Ba.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=n$)}},{key:"content",get:function(){return this._content},set:function(n$){this.log("set content for %s",this.callId),this._content=n$}},{key:"response",get:function(){return this._response},set:function(n$){throw new I('Cannot set the "response" of the LocalInvitation instance.',xc)}},{key:"send",value:function(){var n$,i$=this;if(this.state===Ba.SENT_TO_REMOTE||this.state===Ba.RECEIVED_BY_REMOTE)throw new K("The local invitation send failure. The call invitation has already been sent.",gA);if(this.isLocalInvitationEnd())throw new K("The local invitation send failure. The call invitation has ended.",Ih);if(0<this._channelId.length&&!za(this._channelId))throw new I("Illegal invitation channel ID",xc);if(!za(this.calleeId))throw new I("Illegal invitation callee user ID",xc);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',xc);this.state=Ba.SENT_TO_REMOTE,ad(J(w.mark(function o$(){var s$,a$,c$;return w.wrap(function(u$){for(;;)switch(u$.prev=u$.next){case 0:return u$.next=2,i$.getSession().sendInvitationMessage({peerId:i$.calleeId,callId:i$.callId,extra:i$._content,type:"CallInvite",channelId:i$._channelId});case 2:if(s$=u$.sent,a$=s$.hasPeerReceived,c$=s$.hasReSent,!i$.isLocalInvitationEnd()){u$.next=7;break}throw new db("send invitation timeout");case 7:if(i$.log("The local invitation has sent to the callee"),a$||c$){u$.next=11;break}throw n$=new rl({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(a$){u$.next=14;break}throw n$=new rl({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return u$.stop()}},o$)}))).pipe(oe(function(o$){return o$.pipe(ca(function(s$){if(!(s$ instanceof rl))throw s$}),cd(2e3))}),hb(3e4),Ga(function(o$){return Sa(o$)&&i$.warn("local invitation ack timed out"),Z(o$)}),ob(this.localInvitationEnd$)).subscribe({next:function(){i$.state===Ba.RECEIVED_BY_REMOTE?i$.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):i$.state!==Ba.SENT_TO_REMOTE?i$.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(i$.info("The peer received the local invitation %s.",i$.callId),i$.state=Ba.RECEIVED_BY_REMOTE,i$.emit("LocalInvitationReceivedByPeer"),i$.localInvitationEnd$.pipe(hb(6e4),Ga(function(o$){return Sa(o$)&&i$.warn("local invitation expired"),Z(o$)})).subscribe({error:function(){i$.state=Ba.FAILURE,i$.emit("LocalInvitationFailure",bf.INVITATION_EXPIRE)}}))},error:function(o$){i$.isLocalInvitationEnd()?i$.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(i$.state=Ba.FAILURE,Sa(o$)&&n$?n$.code==="PEER_NOT_ONLINE"?i$.emit("LocalInvitationFailure",bf.PEER_OFFLINE):n$.code==="RESENT_AND_OFFLINE"&&i$.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):Sa(o$)?i$.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):o$.name==="RtmInvalidStatusError"?i$.emit("LocalInvitationFailure",bf.NOT_LOGGEDIN):i$.emit("LocalInvitationFailure",bf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new K("The local invitation cancel failure",Ih);if(this.state===Ba.IDLE)throw new K("The local invitation has not been sent",fA);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',xc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Ba.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(n$){if(this.isLocalInvitationEnd()&&this.state!==Ba.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Ba.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Ba.ACCEPTED_BY_REMOTE,this._response=n$,this.emit("LocalInvitationAccepted",n$))}}},{key:"onRefuseReceived",value:function(n$){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote refuse it?");this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=n$,this.state=Ba.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",n$)}}},{key:"isLocalInvitationEnd",value:function(){return[Ba.CANCELED,Ba.FAILURE,Ba.ACCEPTED_BY_REMOTE,Ba.REFUSED_BY_REMOTE].includes(this.state)}}]),t$}(tb()),fa(vd.prototype,"send",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"send"),vd.prototype),fa(vd.prototype,"cancel",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"cancel"),vd.prototype),vd),Rh=S.RemoteInvitationFailureReason,kb=S.RemoteInvitationState,mD=function(e$){function t$(n$){var i$=n$.invitationChannel,o$=n$.extraContent,s$=n$.callId,a$=n$.callerId,c$=n$.logger;n$=n$.getSession,W(this,t$);var u$=r$.call(this,c$,"RtmRemoteInvitation",!0);return m(n(u$),"state",kb.INVITATION_RECEIVED),m(n(u$),"remoteInvitationEnd$",Ca(gb(n(u$),"RemoteInvitationCanceled"),gb(n(u$),"RemoteInvitationRefused"),gb(n(u$),"RemoteInvitationAccepted"),gb(n(u$),"RemoteInvitationFailure")).pipe(Ka(1))),m(n(u$),"callerId",void 0),m(n(u$),"callId",void 0),m(n(u$),"_getSession",void 0),m(n(u$),"logger",void 0),m(n(u$),"_content",void 0),m(n(u$),"_channelId",void 0),m(n(u$),"_response",""),u$._channelId=i$,u$._content=o$,u$.callId=s$,u$.callerId=a$,u$._getSession=n$,u$.logger=c$,u$.remoteInvitationEnd$.pipe(hb(6e4),Ga(function(l$){return Sa(l$)&&u$.warn("Remote invitation expired"),Z(l$)})).subscribe({error:function(){u$.state=kb.FAILURE,u$.emit("RemoteInvitationFailure",Rh.INVITATION_EXPIRE)}}),u$}la(t$,e$);var r$=ma(t$);return Ha(t$,[{key:"channelId",get:function(){return this._channelId},set:function(n$){throw new I('Cannot set the "response" of the RemoteInvitation instance.',xc)}},{key:"content",get:function(){return this._content},set:function(n$){throw new I('Cannot set the "content" of the RemoteInvitation instance.',xc)}},{key:"response",get:function(){return this._response},set:function(n$){this._response=n$}},{key:"accept",value:function(){var n$,i$=this;if(this.isRemoteInvitationEnd())throw new K("The local invitation has ended. Cannot accept.",Ih);if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',xc);this.state=kb.ACCEPT_SENT_TO_LOCAL,Xb(mm(1e3).pipe(cb(function(){return ad(J(w.mark(function o$(){return w.wrap(function(s$){for(;;)switch(s$.prev=s$.next){case 0:return s$.abrupt("return",i$._getSession().sendInvitationMessage({peerId:i$.callerId,callId:i$.callId,extra:i$.response,type:"CallAccept",isAcceptAck:!1,channelId:i$.channelId}));case 1:case"end":return s$.stop()}},o$)})))}),wb(function(o$){return n$=o$.hasPeerReceived}),Ka(1)),gb(this,"RemoteInvitationAccepted")).pipe(hb(5e3),ob(this.remoteInvitationEnd$)).subscribe({error:function(o$){if(i$.logError(o$),i$.state=kb.FAILURE,Sa(o$))switch(n$){case void 0:case!0:return void i$.emit("RemoteInvitationFailure",Rh.ACCEPT_FAILURE);case!1:return void i$.emit("RemoteInvitationFailure",Rh.PEER_OFFLINE)}i$.emit("RemoteInvitationFailure",Rh.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(this.isRemoteInvitationEnd())throw new K("The invitation is end. Cannot refuse",Ih);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',xc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=kb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(n$){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===kb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=n$,this.state=kb.CANCELED,this.emit("RemoteInvitationCanceled",n$))}},{key:"onAcceptAckReceived",value:function(){this.state!==kb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=kb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[kb.ACCEPTED,kb.REFUSED,kb.CANCELED,kb.FAILURE].includes(this.state)}}]),t$}(tb()),nD=function(e$){function t$(n$,i$){W(this,t$);var o$=r$.call(this,i$,"InvitationManager");return m(n(o$),"getSession",void 0),m(n(o$),"invitationDispatcher",new ea.EventEmitter),m(n(o$),"outgoingLocalInvitations",new Map),m(n(o$),"receivedRemoteInvitations",new tc(void 0,{maxlen:1e4})),m(n(o$),"logger",void 0),o$.getSession=cn(n$),o$.logger=i$,o$.invitationDispatcher.on("remoteInvitationToManager",function(s$){var a$=s$.callId,c$=s$.extra,u$=s$.callerId;s$=s$.channelId,o$.receivedRemoteInvitations.has(a$)||((c$=new mD({callerId:u$,callId:a$,getSession:o$.getSession,logger:i$,extraContent:c$,invitationChannel:s$})).remoteInvitationEnd$.subscribe(function(){o$.receivedRemoteInvitations.delete(a$)}),o$.receivedRemoteInvitations.set(a$,c$),o$.emit("remoteInvitationInstance",c$))}),o$.invitationDispatcher.on("acceptAckToRemoteInvitation",function(s$){(s$=o$.receivedRemoteInvitations.get(s$.callId))&&s$.onAcceptAckReceived()}),o$.invitationDispatcher.on("cancelToRemoteInvitation",function(s$){var a$=s$.extra;(s$=o$.receivedRemoteInvitations.get(s$.callId))&&s$.onCancelReceived(a$)}),o$.invitationDispatcher.on("acceptToLocalInvitation",function(s$){var a$=s$.extra;(s$=o$.outgoingLocalInvitations.get(s$.callId))&&s$.onAcceptReceived(a$)}),o$.invitationDispatcher.on("refuseToLocalInvitation",function(s$){var a$=s$.extra;(s$=o$.outgoingLocalInvitations.get(s$.callId))&&s$.onRefuseReceived(a$)}),o$}la(t$,e$);var r$=ma(t$);return Ha(t$,[{key:"invitationMessageHandler",value:function(n$){var i$=n$.body,o$=i$.callId,s$=i$.extra;s$=s$===void 0?"":s$;var a$=i$.type,c$=(i$=i$.channel)===void 0?"":i$,u$=n$.type;switch(i$=n$.peerId,n$=n$.serverReceivedTs,u$){case"CallAccept":a$==="ack"?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:o$}):a$==="request"&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:o$,extra:s$});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:o$,callerId:i$,extra:s$,channelId:c$});break;case"CallCancel":if(o$==="0"){o$="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(c$,"_").concat(s$),this.getSession().emit("peerTextMessage",{peerId:i$,properties:{serverReceivedTs:n$,isOfflineMessage:!1},text:o$});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:o$,extra:s$});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:o$,extra:s$});break;default:throw Im("invitationType",u$)}}},{key:"genLocalInvitation",value:function(n$){var i$=this,o$=new lD(n$,this.getSession,this.logger);return o$.localInvitationEnd$.subscribe(function(){i$.outgoingLocalInvitations.delete(o$.callId)}),this.outgoingLocalInvitations.set(o$.callId,o$),o$}}]),t$}(tb()),oD=function(e$,t$,r$){var n$=!0,i$=!0;if(typeof e$!="function")throw new TypeError("Expected a function");return lb(r$)&&(n$="leading"in r$?!!r$.leading:n$,i$="trailing"in r$?!!r$.trailing:i$),qC(e$,t$,{leading:n$,maxWait:t$,trailing:i$})},ub,cf;(function(e$){e$[e$.JOINED=0]="JOINED",e$[e$.LEFT=1]="LEFT"})(cf||(cf={}));var ns=S.ConnectionState,pD=(ub=function(e$){function t$(n$,i$,o$,s$){W(this,t$);var a$=r$.call(this,s$,"RtmChannel",!0);return m(n(a$),"onMemberCountUpdated",oD(function(c$){c$!==a$.memberCount&&(a$.memberCount=c$,a$.emit("MemberCountUpdated",c$))},1e3)),m(n(a$),"getSession",void 0),m(n(a$),"memberCount",0),m(n(a$),"memberJoinedLru",new tc(void 0,{maxlen:1e4})),m(n(a$),"memberLeftLru",new tc(void 0,{maxlen:1e4})),m(n(a$),"memberJoinStateLru",new tc(void 0,{maxlen:1e4})),m(n(a$),"attributesSeqLru",new tc(void 0,{maxlen:1e4})),m(n(a$),"channelId",void 0),m(n(a$),"client",void 0),m(n(a$),"onAttributesUpdated",function(c$){var u$=c$.channelId,l$=c$.attributeMaps,d$=c$.seq;c$=c$.instance.toString();var h$=a$.attributesSeqLru.get(c$);if((!h$||d$.greaterThan(h$))&&(a$.attributesSeqLru.set(c$,d$),u$===a$.channelId)){for(u$={},d$=0;d$<l$.length;d$++){var p$=l$[d$];c$=p$.key,h$=p$.ms;var _$=p$.value;if(p$=p$.origin,typeof c$!="string"||!U.isLong(h$)||typeof _$!="string"||!za(p$))break;u$[c$]={value:_$,lastUpdateUserId:p$,lastUpdateTs:h$.toNumber()}}a$.emit("AttributesUpdated",u$)}}),m(n(a$),"onChannelTextMessage",function(c$){var u$=c$.memberId,l$=c$.text,d$=c$.properties;c$.channelId===a$.channelId&&a$.emit("ChannelMessage",{text:l$,messageType:S.MessageType.TEXT},u$,d$)}),m(n(a$),"onChannelMediaMessage",function(c$){var u$=c$.memberId,l$=c$.properties,d$=c$.details,h$=c$.messageType;c$.channelId===a$.channelId&&(h$==="FILE"?a$.emit("ChannelMessage",{messageType:S.MessageType.FILE,size:parseInt(pa(d$.media_size),10),description:pa(d$.media_description),fileName:pa(d$.media_filename),mediaId:pa(d$.media_id),thumbnail:new Blob([d$.media_thumbnail])},u$,l$):h$==="IMAGE"&&a$.emit("ChannelMessage",{messageType:S.MessageType.IMAGE,size:parseInt(pa(d$.media_size),10),description:pa(d$.media_description),fileName:pa(d$.media_filename),mediaId:pa(d$.media_id),thumbnail:new Blob([d$.media_thumbnail]),height:parseInt(pa(d$.media_height),10),width:parseInt(pa(d$.media_width),10),thumbnailHeight:parseInt(pa(d$.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(d$.media_thumbnailwidth),10)},u$,l$))}),m(n(a$),"onChannelRawMessage",function(c$){var u$=c$.desc,l$=c$.raw,d$=c$.memberId,h$=c$.properties;c$.channelId===a$.channelId&&a$.emit("ChannelMessage",{messageType:S.MessageType.RAW,rawMessage:l$,description:u$},d$,h$)}),m(n(a$),"onMemberNotice",function(c$){var u$=c$.memberId,l$=c$.type,d$=c$.size;if(c$.channelId===a$.channelId){var h$=c$.instance.toString();c$=c$.seq.toString();var p$={MemberLeft:a$.memberLeftLru,MemberJoined:a$.memberJoinedLru,MemberCountUpdated:void 0}[l$];if(p$){if(p$.has(h$+c$))return void a$.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",l$,c$,oa(a$.channelId),oa(u$||""));if(p$.set(h$+c$,void 0),typeof u$!="string")return;if(u$!==a$.getSession().context.uid&&((h$=a$.memberJoinStateLru.get(u$))===cf.JOINED&&l$==="MemberJoined"||h$===cf.LEFT&&l$==="MemberLeft"))return void a$.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",l$,c$,oa(a$.channelId),oa(u$||""));a$.memberJoinStateLru.set(u$,l$==="MemberJoined"?cf.JOINED:cf.LEFT)}a$.info("Channel %s - %s, memberId: %s",l$,oa(a$.channelId),l$==="MemberCountUpdated"?"[unknown]":oa(u$||"")),h$=u$===a$.getSession().context.uid,l$==="MemberLeft"&&za(u$)||l$==="MemberJoined"&&za(u$)?(h$||a$.emit(l$,u$),a$.onMemberCountUpdated(d$)):l$==="MemberCountUpdated"&&typeof d$=="number"&&a$.onMemberCountUpdated(d$)}}),a$.getSession=cn(i$),a$.channelId=n$,a$.client=o$,a$.info("A channel created, id %s",oa(n$)),a$}la(t$,e$);var r$=ma(t$);return Ha(t$,[{key:"join",value:function(){var n$=J(w.mark(function i$(){var o$,s$,a$,c$,u$,l$,d$;return w.wrap(function(h$){for(;;)switch(h$.prev=h$.next){case 0:if(za(this.channelId)){h$.next=2;break}throw new I(["The %s in the arguments is invalid","channelId"],hA);case 2:h$.prev=2,o$=this.getSession(),h$.next=9;break;case 6:throw h$.prev=6,h$.t0=h$.catch(2),new K("The client is not logged in. Cannot do the operation",Vq);case 9:if(!o$.joinedChannels.has(this)){h$.next=12;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:o$.context.uid,elapse:fb(o$.startTime),errCode:Uq,sid:Xa(o$.instanceId)},(s$=this.client.context.config.enableCloudProxy)!==null&&s$!==void 0&&s$),new K("The channel has joined. Cannot rejoin",Uq);case 12:if(h$.prev=12,this.log("Joining the channel %s",oa(this.channelId)),!this.hasOtherChannelJoined()){h$.next=17;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:o$.context.uid,elapse:fb(o$.startTime),errCode:Wq,sid:Xa(o$.instanceId)},(u$=this.client.context.config.enableCloudProxy)!==null&&u$!==void 0&&u$),new K("A channel of the same channel ID has already joined. Cannot rejoin",Wq);case 17:if(o$.joinedChannels.size!==20){h$.next=20;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:o$.context.uid,elapse:fb(o$.startTime),errCode:Tq,sid:Xa(o$.instanceId)},(l$=this.client.context.config.enableCloudProxy)!==null&&l$!==void 0&&l$),new ib("The joined channels has exceeded the limit of 20",Tq);case 20:return eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:o$.context.uid,elapse:fb(o$.startTime),errCode:0,sid:Xa(o$.instanceId)},(a$=this.client.context.config.enableCloudProxy)!==null&&a$!==void 0&&a$),h$.next=23,o$.requestChannelJoin(this,this.channelId);case 23:eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(o$.startTime),errCode:0,sid:Xa(o$.instanceId),serverErrCode:0,userId:o$.context.uid},(c$=this.client.context.config.enableCloudProxy)!==null&&c$!==void 0&&c$),this.info("The channel %s joined successfully",oa(this.channelId)),o$.on("channelTextMessage",this.onChannelTextMessage),o$.on("channelRawMessage",this.onChannelRawMessage),o$.on("channelMediaMessage",this.onChannelMediaMessage),o$.on("memberNotice",this.onMemberNotice),o$.on("channelAttributesUpdated",this.onAttributesUpdated),h$.next=41;break;case 32:if(h$.prev=32,h$.t1=h$.catch(12),this.logError(h$.t1),!sa(h$.t1)){h$.next=37;break}throw h$.t1;case 37:if(!Sa(h$.t1)){h$.next=40;break}throw eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(o$.startTime),errCode:Sq,sid:Xa(o$.instanceId),serverErrCode:0,userId:o$.context.uid},(d$=this.client.context.config.enableCloudProxy)!==null&&d$!==void 0&&d$),new db(["Join channel %s timed out",oa(this.channelId)],Sq);case 40:throw new Wc(["The channel %s join failure",oa(this.channelId)],{code:Rq,originalError:h$.t1});case 41:case"end":return h$.stop()}},i$,this,[[2,6],[12,32]])}));return function(){return n$.apply(this,arguments)}}()},{key:"leave",value:function(){var n$=J(w.mark(function i$(){var o$,s$,a$,c$;return w.wrap(function(u$){for(;;)switch(u$.prev=u$.next){case 0:u$.prev=0,s$=this.getSession(),u$.next=7;break;case 4:throw u$.prev=4,u$.t0=u$.catch(0),new K("The client is not logged in. Cannot do the operation",jA);case 7:if(s$.joinedChannels.has(this)){u$.next=9;break}throw new K("The channel does not join. Cannot do the operation",iA);case 9:u$.prev=9,s$.requestChannelLeave(this,this.channelId),this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,s$.removeListener("channelTextMessage",this.onChannelTextMessage),s$.removeListener("channelRawMessage",this.onChannelRawMessage),s$.removeListener("channelMediaMessage",this.onChannelMediaMessage),s$.removeListener("memberNotice",this.onMemberNotice),s$.removeListener("channelAttributesUpdated",this.onAttributesUpdated),u$.next=32;break;case 23:if(u$.prev=23,u$.t1=u$.catch(9),this.logError(u$.t1),!sa(u$.t1)){u$.next=30;break}throw u$.t1.code===void 0&&(u$.t1.code=Yq),eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(s$.startTime),errCode:Yq,sid:Xa(s$.instanceId),userId:s$.context.uid},(c$=this.client.context.config.enableCloudProxy)!==null&&c$!==void 0&&c$),u$.t1;case 30:throw eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(s$.startTime),errCode:Xq,sid:Xa(s$.instanceId),userId:s$.context.uid},(a$=this.client.context.config.enableCloudProxy)!==null&&a$!==void 0&&a$),new Wc("The channel leave failure",{code:Xq,originalError:u$.t1});case 32:eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(s$.startTime),errCode:0,sid:Xa(s$.instanceId),userId:s$.context.uid},(o$=this.client.context.config.enableCloudProxy)!==null&&o$!==void 0&&o$);case 33:case"end":return u$.stop()}},i$,this,[[0,4],[9,23]])}));return function(){return n$.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$,c$,u$,l$,d$=this,h$=arguments;return w.wrap(function(p$){for(;;)switch(p$.prev=p$.next){case 0:s$=1<h$.length&&h$[1]!==void 0?h$[1]:{},a$=s$.enableHistoricalMessaging,c$=a$!==void 0&&a$,Tm(o$,Hh),p$.prev=2,u$=this.getSession(),p$.next=9;break;case 6:throw p$.prev=6,p$.t0=p$.catch(2),new K("The client is not logged in. Cannot do the operation",ig);case 9:if(u$.joinedChannels.has(this)){p$.next=11;break}throw new K("The channel does not join. Cannot do the operation",ig);case 11:if(this.client.connectionState!==ns.RECONNECTING){p$.next=16;break}return l$=Date.now(),p$.next=15,new Promise(function(_$,f$){var m$=function(){var v$=J(w.mark(function y$(){var S$;return w.wrap(function(b$){for(;;)switch(b$.prev=b$.next){case 0:return S$=Date.now()-l$,b$.prev=1,b$.next=4,Gg({message:o$,peerId:d$.channelId,toPeer:!1,session:d$.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:S$,logger:d$.logger,options:{enableHistoricalMessaging:c$,enableOfflineMessaging:!1}});case 4:_$(),b$.next=12;break;case 7:b$.prev=7,b$.t0=b$.catch(1),Sa(b$.t0)&&f$(new db(Yd(d$.name,"sendMessageToPeer",1e4),Yk)),sa(b$.t0)&&f$(b$.t0),f$(new da("Channel message send failure",{code:hg,originalError:b$.t0}));case 12:return b$.prev=12,clearTimeout(g$),b$.finish(12);case 15:case"end":return b$.stop()}},y$,null,[[1,7,12,15]])}));return function(){return v$.apply(this,arguments)}}();d$.client.internalEmitter.once("RECONNECTED",m$);var g$=setTimeout(function(){d$.client.internalEmitter.off("RECONNECTED",m$),f$(new db(Yd(d$.name,"sendMessageToPeer",1e4),Yk))},9e3)});case 15:return p$.abrupt("return");case 16:if(this.client.connectionState===ns.CONNECTED){p$.next=18;break}throw new K("The client is not logged in. Cannot do the operation",ig);case 18:return p$.prev=18,p$.next=21,Gg({message:o$,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:0,logger:this.logger,options:{enableHistoricalMessaging:c$,enableOfflineMessaging:!1}});case 21:p$.next=31;break;case 23:if(p$.prev=23,p$.t1=p$.catch(18),!Sa(p$.t1)){p$.next=27;break}throw new db(Yd(this.name,"sendMessage",1e4),Yk);case 27:if(!sa(p$.t1)){p$.next=30;break}throw this.logError(p$.t1),p$.t1;case 30:throw new Wc("The channel message send failure",hg);case 31:case"end":return p$.stop()}},i$,this,[[2,6],[18,23]])}));return function(i$){return n$.apply(this,arguments)}}()},{key:"getMembers",value:function(){var n$=J(w.mark(function i$(){var o$,s$,a$;return w.wrap(function(c$){for(;;)switch(c$.prev=c$.next){case 0:c$.prev=0,c$.prev=1,o$=this.getSession(),c$.next=8;break;case 5:throw c$.prev=5,c$.t0=c$.catch(1),new K("The client is not logged in. Cannot do the operation",eA);case 8:if(o$.joinedChannels.has(this)){c$.next=10;break}throw new K("The channel does not join. Cannot do the operation",dA);case 10:return s$=this.getSession().requestChannelMemberList(this.channelId),c$.next=13,s$.pipe(ba(function(u$){return u$.memberInfos.map(function(l$){return l$.account})})).toPromise();case 13:return a$=c$.sent,this.info("Channel %s - get members success, %o",oa(this.channelId),a$.map(oa)),c$.abrupt("return",a$);case 18:if(c$.prev=18,c$.t1=c$.catch(0),!sa(c$.t1)){c$.next=23;break}throw this.logError(c$.t1),c$.t1;case 23:throw new Wc("The channel members get failure",bA);case 24:case"end":return c$.stop()}},i$,this,[[0,18],[1,5]])}));return function(){return n$.apply(this,arguments)}}()},{key:"hasOtherChannelJoined",value:function(){var n$=this;return!this.getSession().joinedChannels.has(this)&&Array.from(this.getSession().joinedChannels).some(function(i$){return i$.channelId===n$.channelId})}}]),t$}(tb()),fa(ub.prototype,"join",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"join"),ub.prototype),fa(ub.prototype,"leave",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"leave"),ub.prototype),fa(ub.prototype,"sendMessage",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"sendMessage"),ub.prototype),fa(ub.prototype,"getMembers",[Ma],Object.getOwnPropertyDescriptor(ub.prototype,"getMembers"),ub.prototype),ub),E,Eb=S.ConnectionChangeReason,T=S.ConnectionState,os={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},qD={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8},rD=(E=function(e$){function t$(n$,i$,o$,s$){W(this,t$);var a$=r$.call(this,i$,"RtmClient",!0);return m(n(a$),"connectionState",T.DISCONNECTED),m(n(a$),"internalEmitter",new ea),m(n(a$),"context",void 0),m(n(a$),"attributes",{}),m(n(a$),"loginPromise",void 0),m(n(a$),"attributeDrafts",new Set),m(n(a$),"session",void 0),m(n(a$),"lastLoginTime",void 0),m(n(a$),"reconnId",0),m(n(a$),"channelAttributesCacheLru",new tc(void 0,{maxlen:1e4})),m(n(a$),"invitationManager",void 0),m(n(a$),"subscribedPeerStatusCache",{}),m(n(a$),"peerStatusSeqLru",new tc(void 0,{maxlen:1e4})),m(n(a$),"peerUnreachableTimers",{}),m(n(a$),"mediaTaskManager",void 0),m(n(a$),"setParameters",void 0),m(n(a$),"updateConfig",void 0),m(n(a$),"userDropHandler",function(c$){if(a$.connectionState!==T.ABORTED)switch(c$){case 11:a$.logError("Kicked off by remote session"),a$.onConnectionStateChanged(T.ABORTED,Eb.REMOTE_LOGIN);break;case 14:case 15:case 16:a$.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[c$])),a$.onConnectionStateChanged(T.ABORTED,Eb.BANNED_BY_SERVER);break;default:a$.logError("User kicked off for unknown code: ".concat(c$)),a$.onConnectionStateChanged(T.ABORTED,Eb.INTERRUPTED)}}),a$.context=new ZC(n$,o$,i$),a$.mediaTaskManager=new fs(i$),a$.context.config=o$,a$.internalEmitter.setMaxListeners(512),a$.setParameters=s$.bind(n(a$)),a$.updateConfig=s$.bind(n(a$)),a$.invitationManager=new nD(function(){return a$.session},i$),a$.invitationManager.on("remoteInvitationInstance",function(c$){a$.emit("RemoteInvitationReceived",c$)}),a$}la(t$,e$);var r$=ma(t$);return Ha(t$,[{key:"renewToken",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$,c$,u$=this;return w.wrap(function(l$){for(;;)switch(l$.prev=l$.next){case 0:if(typeof o$=="string"&&o$.length!==0){l$.next=2;break}throw new I("Invalid argument",rA);case 2:if(this.connectionState!==T.ABORTED){l$.next=5;break}return l$.next=5,new Promise(function(){});case 5:if(this.connectionState===T.CONNECTED||this.connectionState===T.RECONNECTING){l$.next=7;break}throw new K("The client is not logged in",uA);case 7:if(this.session!==void 0){l$.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return l$.prev=9,s$=this.context.token,this.context.token=o$,l$.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe(Dd(function(){return Error("No available edge address to connect")}),oe(function(d$){return d$.pipe(ca(function(h$){if(sa(h$))throw h$}),cd(2500),Ka(4))}),Ka(1),hb(2e4),Ga(function(d$){return Sa(d$)&&u$.warn("renewToken timed out"),Z(d$)})).toPromise();case 14:a$=l$.sent,c$=a$.ticket,l$.next=27;break;case 18:if(l$.prev=18,l$.t0=l$.catch(9),this.context.token=s$,l$.t0.code!==$q&&l$.t0.code!==ar){l$.next=23;break}throw new Ye("Invalid token",tA);case 23:if(l$.t0.code!==Kh){l$.next=25;break}throw new Ye("The token expired",sA);case 25:if(!Sa(l$.t0)){l$.next=27;break}throw new db("Renew token timed out",qA);case 27:this.session.curLoginSockets.filter(function(d$){return d$!==void 0}).forEach(function(d$){return d$.ticket=c$});case 28:case"end":return l$.stop()}},i$,this,[[9,18]])}));return function(i$){return n$.apply(this,arguments)}}()},{key:"queryPeersOnlineStatus",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$,c$=this;return w.wrap(function(u$){for(;;)switch(u$.prev=u$.next){case 0:if(this.connectionState===T.CONNECTED){u$.next=2;break}throw new K("The client is not logged in",pA);case 2:if(this.session!==void 0){u$.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(o$)||o$.length===0||o$.some(function(l$){return!za(l$)})||256<o$.length)){u$.next=6;break}throw new I("invalid arguments",er);case 6:return u$.next=8,this.session.requestPeersOnlineStatus(o$).toPromise();case 8:return s$=u$.sent,a$=uc(Jk(s$.userInfos,"account"),function(l$){return!!l$.ts}),Object.keys(a$).forEach(function(l$){if(l$ in c$.subscribedPeerStatusCache&&c$.subscribedPeerStatusCache[l$]!==S.PeerOnlineState.UNREACHABLE){var d$=a$[l$]?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE;c$.emit("PeersOnlineStatusChanged",m({},l$,d$)),c$.subscribedPeerStatusCache[l$]=d$}}),u$.abrupt("return",a$);case 12:case"end":return u$.stop()}},i$,this)}));return function(i$){return n$.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$,c$,u$,l$,d$,h$,p$=this;return w.wrap(function(_$){for(;;)switch(_$.prev=_$.next){case 0:if(this.connectionState===T.CONNECTED){_$.next=2;break}throw new K("The client is not logged in",aA);case 2:if(this.session!==void 0){_$.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(o$)&&o$.every(function(f$){return typeof f$=="string"})&&o$.length!==0){_$.next=6;break}throw new I("Invalid arguments: channelIds",Oq);case 6:if(!(32<o$.length)){_$.next=8;break}throw new I("getChannelMemberCount exceed limit of 32 channelIds",$z);case 8:s$=0;case 9:if(!(s$<o$.length)){_$.next=16;break}if(za(a$=o$[s$])){_$.next=13;break}throw new I(["getChannelMemberCount channel id %s is invalid",a$],Oq);case 13:s$++,_$.next=9;break;case 16:return _$.next=18,this.session.requestGetChannelMemberCount(o$).toPromise();case 18:for(c$=_$.sent,u$=c$.groupInfos,l$={},d$=function(f$){var m$=(f$=u$[f$]).group,g$=f$.memberCount;za(m$)&&typeof g$=="number"&&(p$.session.joinedChannels.forEach(function(v$){v$.channelId===m$&&v$.onMemberCountUpdated(g$)}),l$[m$]=g$)},h$=0;h$<u$.length;h$++)d$(h$);return _$.abrupt("return",l$);case 24:case"end":return _$.stop()}},i$,this)}));return function(i$){return n$.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$;return w.wrap(function(c$){for(;;)switch(c$.prev=c$.next){case 0:if(uf({attributes:o$,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){c$.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){c$.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return s$=this.session.requestSetLocalUserAttributes(o$).toPromise(),a$={attribute:o$,promise:s$},this.attributeDrafts.add(a$),c$.prev=8,c$.next=11,s$;case 11:this.attributes=o$,c$.next=19;break;case 14:if(c$.prev=14,c$.t0=c$.catch(8),!sa(c$.t0)){c$.next=18;break}throw c$.t0;case 18:throw new I("arguments is not valid",Ja);case 19:return c$.prev=19,this.attributeDrafts.delete(a$),c$.finish(19);case 22:case"end":return c$.stop()}},i$,this,[[8,14,19,22]])}));return function(i$){return n$.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var n$=J(w.mark(function i$(o$,s$){var a$,c$,u$,l$,d$,h$=arguments;return w.wrap(function(p$){for(;;)switch(p$.prev=p$.next){case 0:if(a$=2<h$.length&&h$[2]!==void 0?h$[2]:{},c$=a$.enableNotificationToChannelMembers,u$=c$!==void 0&&c$,uf({attributes:s$,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){p$.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){p$.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return l$=this.session.requestSetChannelAttributes(o$,s$,u$).toPromise(),p$.prev=7,p$.next=10,l$;case 10:d$=uc(s$,function(_$){return new Blob([_$]).size}),this.channelAttributesCacheLru.set(o$,d$),p$.next=19;break;case 14:if(p$.prev=14,p$.t0=p$.catch(7),!sa(p$.t0)){p$.next=18;break}throw p$.t0;case 18:throw new I("arguments is not valid",Ja);case 19:case"end":return p$.stop()}},i$,this,[[7,14]])}));return function(i$,o$){return n$.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$,c$;return w.wrap(function(u$){for(;;)switch(u$.prev=u$.next){case 0:if(s$=ua(ua({},this.attributes),o$),uf({attributes:o$,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),uf({attributes:s$,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){u$.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){u$.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return a$=this.session.requestAddOrUpdateLocalUserAttributes(o$).toPromise(),c$={attribute:s$,promise:a$},this.attributeDrafts.add(c$),u$.prev=10,u$.next=13,a$;case 13:this.attributes=s$,u$.next=21;break;case 16:if(u$.prev=16,u$.t0=u$.catch(10),!sa(u$.t0)){u$.next=20;break}throw u$.t0;case 20:throw new I("arguments is not valid",er);case 21:return u$.prev=21,this.attributeDrafts.delete(c$),u$.finish(21);case 24:case"end":return u$.stop()}},i$,this,[[10,16,21,24]])}));return function(i$){return n$.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var n$=J(w.mark(function i$(o$,s$){var a$,c$,u$,l$,d$,h$,p$,_$=arguments;return w.wrap(function(f$){for(;;)switch(f$.prev=f$.next){case 0:if(a$=2<_$.length&&_$[2]!==void 0?_$[2]:{},c$=a$.enableNotificationToChannelMembers,u$=c$!==void 0&&c$,l$=this.channelAttributesCacheLru.get(o$,{}),d$=uc(s$,function(m$){return new Blob([m$]).size}),h$=ua(ua({},l$),d$),uf({attributes:s$,attrSizeMap:h$,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){f$.next=7;break}throw new K("The client is not logged in",Ub);case 7:if(this.session!==void 0){f$.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return p$=this.session.requestAddOrUpdateChannelAttributes(o$,s$,u$).toPromise(),f$.prev=10,f$.next=13,p$;case 13:this.channelAttributesCacheLru.set(o$,h$),f$.next=21;break;case 16:if(f$.prev=16,f$.t0=f$.catch(10),!sa(f$.t0)){f$.next=20;break}throw f$.t0;case 20:throw new I("arguments is not valid",Ja);case 21:case"end":return f$.stop()}},i$,this,[[10,16]])}));return function(i$,o$){return n$.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$,c$,u$;return w.wrap(function(l$){for(;;)switch(l$.prev=l$.next){case 0:if(Array.isArray(o$)&&o$.length!==0&&!o$.some(function(d$){return d$.length===0})){l$.next=2;break}throw new K("arguments is not valid",Ja);case 2:if(this.connectionState===T.CONNECTED){l$.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){l$.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return s$=this.session.requestDeleteLocalUserAttributesByKeys(o$).toPromise(),a$={attribute:Gk(this.attributes,o$),promise:s$},this.attributeDrafts.add(a$),l$.prev=9,l$.next=12,s$;case 12:for(c$=0;c$<o$.length;c$++)u$=o$[c$],delete this.attributes[u$];l$.next=20;break;case 15:if(l$.prev=15,l$.t0=l$.catch(9),!sa(l$.t0)){l$.next=19;break}throw l$.t0;case 19:throw new I("arguments is not valid",Ja);case 20:return l$.prev=20,this.attributeDrafts.delete(a$),l$.finish(20);case 23:case"end":return l$.stop()}},i$,this,[[9,15,20,23]])}));return function(i$){return n$.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var n$=J(w.mark(function i$(o$,s$){var a$,c$,u$,l$,d$,h$,p$,_$=arguments;return w.wrap(function(f$){for(;;)switch(f$.prev=f$.next){case 0:if(a$=2<_$.length&&_$[2]!==void 0?_$[2]:{},c$=a$.enableNotificationToChannelMembers,u$=c$!==void 0&&c$,Array.isArray(s$)&&s$.length!==0&&za(o$)&&!s$.some(function(m$){return m$.length===0||512<m$.length})){f$.next=3;break}throw new K("arguments is not valid",Ja);case 3:if(this.connectionState===T.CONNECTED){f$.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){f$.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return l$=this.session.requestDeleteChannelAttributesByKeys(o$,s$,u$).toPromise(),f$.prev=8,f$.next=11,l$;case 11:if(d$=this.channelAttributesCacheLru.get(o$))for(h$=0;h$<s$.length;h$++)p$=s$[h$],delete d$[p$];f$.next=20;break;case 15:if(f$.prev=15,f$.t0=f$.catch(8),!sa(f$.t0)){f$.next=19;break}throw f$.t0;case 19:throw new I("arguments is not valid",Ja);case 20:case"end":return f$.stop()}},i$,this,[[8,15]])}));return function(i$,o$){return n$.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var n$=J(w.mark(function i$(){var o$,s$;return w.wrap(function(a$){for(;;)switch(a$.prev=a$.next){case 0:if(this.connectionState===T.CONNECTED){a$.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){a$.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return o$=this.session.requestClearLocalUserAttributes().toPromise(),s$={attribute:{},promise:o$},this.attributeDrafts.add(s$),a$.prev=7,a$.next=10,o$;case 10:this.attributes={},a$.next=18;break;case 13:if(a$.prev=13,a$.t0=a$.catch(7),!sa(a$.t0)){a$.next=17;break}throw a$.t0;case 17:throw new I("arguments is not valid",Ja);case 18:return a$.prev=18,this.attributeDrafts.delete(s$),a$.finish(18);case 21:case"end":return a$.stop()}},i$,this,[[7,13,18,21]])}));return function(){return n$.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$,c$,u$,l$=arguments;return w.wrap(function(d$){for(;;)switch(d$.prev=d$.next){case 0:if(s$=1<l$.length&&l$[1]!==void 0?l$[1]:{},a$=s$.enableNotificationToChannelMembers,c$=a$!==void 0&&a$,this.connectionState===T.CONNECTED){d$.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){d$.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return u$=this.session.requestClearChannelAttributes(o$,c$).toPromise(),d$.prev=6,d$.next=9,u$;case 9:this.channelAttributesCacheLru.delete(o$),d$.next=17;break;case 12:if(d$.prev=12,d$.t0=d$.catch(6),!sa(d$.t0)){d$.next=16;break}throw d$.t0;case 16:throw new I("arguments is not valid",Ja);case 17:case"end":return d$.stop()}},i$,this,[[6,12]])}));return function(i$){return n$.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$,c$;return w.wrap(function(u$){for(;;)switch(u$.prev=u$.next){case 0:if(za(o$)){u$.next=2;break}throw new I("Not a valid user ID",Ja);case 2:if(this.connectionState===T.CONNECTED){u$.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){u$.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return u$.prev=6,u$.next=9,this.session.requestGetUserAttributeKeys(o$).toPromise();case 9:return s$=u$.sent,a$=s$.keys,u$.next=13,this.session.requestGetUserAttributesByKeys(o$,a$.slice(0,512)).toPromise();case 13:c$=u$.sent,u$.next=21;break;case 16:if(u$.prev=16,u$.t0=u$.catch(6),!sa(u$.t0)){u$.next=20;break}throw u$.t0;case 20:throw new I("arguments is not valid",Ja);case 21:return u$.abrupt("return",Yp(c$.attributeInfos.map(function(l$){return[l$.key,l$.value]})));case 22:case"end":return u$.stop()}},i$,this,[[6,16]])}));return function(i$){return n$.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$,c$,u$,l$,d$,h$,p$,_$,f$,m$;return w.wrap(function(g$){for(;;)switch(g$.prev=g$.next){case 0:if(za(o$)){g$.next=2;break}throw new I("Not a valid channel ID",Ja);case 2:if(this.connectionState===T.CONNECTED){g$.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){g$.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return g$.prev=6,g$.next=9,this.session.requestGetChannelAttributesKeys(o$).toPromise();case 9:return s$=g$.sent,a$=s$.keys,g$.next=13,this.session.requestGetChannelAttributesByKeys(o$,a$).toPromise();case 13:c$=g$.sent,u$=c$.attributeMaps,g$.next=22;break;case 17:if(g$.prev=17,g$.t0=g$.catch(6),!sa(g$.t0)){g$.next=21;break}throw g$.t0;case 21:throw new I("arguments is not valid",Ja);case 22:l$={},d$=0;case 24:if(!(d$<u$.length)){g$.next=32;break}if(h$=u$[d$],p$=h$.key,_$=h$.ms,f$=h$.value,m$=h$.origin,typeof p$=="string"&&U.isLong(_$)&&typeof f$=="string"&&za(m$)){g$.next=28;break}return g$.abrupt("break",32);case 28:l$[p$]={value:f$,lastUpdateUserId:m$,lastUpdateTs:_$.toNumber()};case 29:d$++,g$.next=24;break;case 32:return this.channelAttributesCacheLru.set(o$,uc(l$,function(v$){return new Blob([v$.value]).size})),g$.abrupt("return",l$);case 34:case"end":return g$.stop()}},i$,this,[[6,17]])}));return function(i$){return n$.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var n$=J(w.mark(function i$(o$,s$){var a$,c$,u$,l$,d$,h$,p$,_$,f$,m$;return w.wrap(function(g$){for(;;)switch(g$.prev=g$.next){case 0:if(this.connectionState===T.CONNECTED){g$.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){g$.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(o$,s$),g$.prev=5,g$.next=8,this.session.requestGetChannelAttributesByKeys(o$,s$).toPromise();case 8:a$=g$.sent,c$=a$.attributeMaps,g$.next=17;break;case 12:if(g$.prev=12,g$.t0=g$.catch(5),!sa(g$.t0)){g$.next=16;break}throw g$.t0;case 16:throw new I("arguments is not valid",Ja);case 17:u$={},l$=this.channelAttributesCacheLru.get(o$,{}),d$=0;case 20:if(!(d$<c$.length)){g$.next=29;break}if(h$=c$[d$],p$=h$.key,_$=h$.ms,f$=h$.value,m$=h$.origin,typeof p$=="string"&&U.isLong(_$)&&typeof f$=="string"&&za(m$)){g$.next=24;break}return g$.abrupt("break",29);case 24:l$[p$]=new Blob([f$]).size,u$[p$]={value:f$,lastUpdateUserId:m$,lastUpdateTs:_$.toNumber()};case 26:d$++,g$.next=20;break;case 29:return this.channelAttributesCacheLru.set(o$,l$),g$.abrupt("return",u$);case 31:case"end":return g$.stop()}},i$,this,[[5,12]])}));return function(i$,o$){return n$.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var n$=J(w.mark(function i$(o$,s$){var a$;return w.wrap(function(c$){for(;;)switch(c$.prev=c$.next){case 0:if(this.connectionState===T.CONNECTED){c$.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){c$.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(o$,s$),c$.prev=5,c$.next=8,this.session.requestGetUserAttributesByKeys(o$,s$).toPromise();case 8:a$=c$.sent,c$.next=16;break;case 11:if(c$.prev=11,c$.t0=c$.catch(5),!sa(c$.t0)){c$.next=15;break}throw c$.t0;case 15:throw new I("arguments is not valid",Ja);case 16:return c$.abrupt("return",Yp(a$.attributeInfos.map(function(u$){return[u$.key,u$.value]})));case 17:case"end":return c$.stop()}},i$,this,[[5,11]])}));return function(i$,o$){return n$.apply(this,arguments)}}()},{key:"login",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$,c$,u$,l$=this;return w.wrap(function(d$){for(;;)switch(d$.prev=d$.next){case 0:if(Uk=!0,s$=Bg(),a$=o$.token,o$.token===this.context.appId&&(a$=void 0),setTimeout(function(){var h$;eb("Session",{appId:l$.context.appId,did:navigator.userAgent,elapse:fb(l$.session&&l$.session.startTime),index:{index1:o$.uid,index2:l$.context.appId,index3:"enableLogUpload=".concat(l$.context.config.enableLogUpload)},installId:gg,lts:U.fromNumber(Date.now()),os:7,sid:Xa(s$),token:a$||"",userId:o$.uid,ver:"1.4.3-203",buildno:603,subVersion:203,version:4},(h$=l$.context.config.enableCloudProxy)!==null&&h$!==void 0&&h$)},1e4),yd(o$)&&za(o$.uid)){d$.next=7;break}throw new I("not a valid user id",Jh);case 7:if(typeof a$!="string"||!a$){d$.next=11;break}this.context.token=a$,d$.next=13;break;case 11:if(typeof a$=="string"||a$==null){d$.next=13;break}throw new I('The "token" is not a valid string.',Jh);case 13:return c$=Date.now(),this.context.sid=Xa(s$),this.loginPromise=this.loginImpl({uid:o$.uid,instanceId:s$}),this.info("RTM Client logging in as ".concat(oa(o$.uid))),d$.prev=17,d$.next=20,this.loginPromise;case 20:d$.next=27;break;case 22:throw d$.prev=22,d$.t0=d$.catch(17),sa(d$.t0)&&eb("Link",{ackedServerIp:"",destServerIp:"",ec:d$.t0.code||1,sc:d$.t0.serverCode,elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),responseTime:Date.now()-c$,sid:Xa(s$),userId:o$.uid},(u$=this.context.config.enableCloudProxy)!==null&&u$!==void 0&&u$),this.context.token=void 0,d$.t0;case 27:return d$.prev=27,this.loginPromise=void 0,d$.finish(27);case 30:Uk=!1;case 31:case"end":return d$.stop()}},i$,this,[[17,22,27,30]])}));return function(i$){return n$.apply(this,arguments)}}()},{key:"logout",value:function(){var n$=J(w.mark(function i$(){var o$;return w.wrap(function(s$){for(;;)switch(s$.prev=s$.next){case 0:if(!this.loginPromise){s$.next=3;break}return s$.next=3,this.loginPromise;case 3:if(this.connectionState!==T.DISCONNECTED){s$.next=6;break}throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);case 6:if(this.connectionState!==T.ABORTED){s$.next=10;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),s$.abrupt("return");case 10:if(this.session!==void 0){s$.next=13;break}return this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),s$.abrupt("return");case 13:return eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(o$=this.context.config.enableCloudProxy)!==null&&o$!==void 0&&o$),s$.next=16,this.session.logoutHandler();case 16:this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),this.log("Log out success");case 18:case"end":return s$.stop()}},i$,this)}));return function(){return n$.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var n$,i$=this;if(this.connectionState===T.DISCONNECTED)throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);this.connectionState===T.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):this.session!==void 0&&(eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(n$=this.context.config.enableCloudProxy)!==null&&n$!==void 0&&n$),this.session.logoutHandler().then(function(){i$.log("Log out success")})),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var n$=J(w.mark(function i$(o$,s$){var a$,c$,u$,l$,d$,h$,p$=this,_$=arguments;return w.wrap(function(f$){for(;;)switch(f$.prev=f$.next){case 0:if(a$=2<_$.length&&_$[2]!==void 0?_$[2]:{},c$=a$.enableOfflineMessaging,u$=c$!==void 0&&c$,l$=a$.enableHistoricalMessaging,d$=l$!==void 0&&l$,Tm(o$,ve),this.connectionState!==T.RECONNECTING){f$.next=5;break}return h$=Date.now(),f$.abrupt("return",new Promise(function(m$,g$){var v$=function(){var S$=J(w.mark(function b$(){var $$;return w.wrap(function(C$){for(;;)switch(C$.prev=C$.next){case 0:if(p$.session!==void 0){C$.next=2;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return $$=Date.now()-h$,C$.prev=3,C$.t0=m$,C$.next=7,Gg({message:o$,peerId:s$,toPeer:!0,session:p$.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:$$,logger:p$.logger,options:{enableHistoricalMessaging:d$,enableOfflineMessaging:u$}});case 7:C$.t1=C$.sent,(0,C$.t0)(C$.t1),C$.next=16;break;case 11:C$.prev=11,C$.t2=C$.catch(3),Sa(C$.t2)&&g$(new db(Yd(p$.name,"sendMessageToPeer",1e4),Zk)),sa(C$.t2)&&g$(C$.t2),g$(new da("Peer-to-peer message send failure",{code:cr,originalError:C$.t2}));case 16:return C$.prev=16,clearTimeout(y$),C$.finish(16);case 19:case"end":return C$.stop()}},b$,null,[[3,11,16,19]])}));return function(){return S$.apply(this,arguments)}}();p$.internalEmitter.once("RECONNECTED",v$);var y$=setTimeout(function(){p$.internalEmitter.off("RECONNECTED",v$),g$(new db(Yd(p$.name,"sendMessageToPeer",1e4),Zk))},9e3)}));case 5:if(this.connectionState===T.CONNECTED){f$.next=7;break}throw new K("Failed to send the peer-to-peer message. The client is not logged in",al);case 7:if(this.session!==void 0){f$.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return f$.prev=9,f$.next=12,Gg({message:o$,peerId:s$,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:0,logger:this.logger,options:{enableHistoricalMessaging:d$,enableOfflineMessaging:u$}});case 12:return f$.abrupt("return",f$.sent);case 15:if(f$.prev=15,f$.t0=f$.catch(9),!Sa(f$.t0)){f$.next=19;break}throw new db(Yd(this.name,"sendMessageToPeer",1e4),Zk);case 19:if(!sa(f$.t0)){f$.next=21;break}throw f$.t0;case 21:throw new da("Peer-to-peer message send failure",{code:cr,originalError:f$.t0});case 22:case"end":return f$.stop()}},i$,this,[[9,15]])}));return function(i$,o$){return n$.apply(this,arguments)}}()},{key:"createChannel",value:function(n$){var i$=this;if(!za(n$))throw new I(["The %s in the arguments is invalid",Object.keys({channelId:n$})[0]],Zz);return new pD(n$,function(){return i$.session},this,this.logger)}},{key:"createLocalInvitation",value:function(n$){if(!za(n$))throw new I(["The %s in the arguments is invalid",Object.keys({calleeId:n$})[0]],xc);return this.invitationManager.genLocalInvitation(n$)}},{key:"subscribePeersOnlineStatus",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$,c$,u$,l$,d$,h$,p$,_$,f$,m$,g$,v$,y$=this;return w.wrap(function(S$){for(;;)switch(S$.prev=S$.next){case 0:if(this.connectionState===T.CONNECTED){S$.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){S$.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(o$)&&o$.length!==0){S$.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:s$=0;case 7:if(!(s$<o$.length)){S$.next=14;break}if(za(a$=o$[s$])){S$.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",a$],kg);case 11:s$++,S$.next=7;break;case 14:if(!(512<(c$=o$&&o$.length?vk(o$):[]).length+Object.keys(this.subscribedPeerStatusCache).length)){S$.next=17;break}throw new ib("Subscribed peers overflows",gr);case 17:return S$.next=19,this.session.requestSubscribePeersOnlineStatus(c$).toPromise();case 19:u$=S$.sent,l$=u$.errors,d$=[],h$=[],p$=0;case 24:if(!(p$<l$.length)){S$.next=32;break}if(_$=l$[p$],f$=_$.code,typeof(m$=_$.account)=="string"){S$.next=28;break}throw new da("Returned account is invalid",fr);case 28:f$!==0&&d$.push(m$);case 29:p$++,S$.next=24;break;case 32:for(g$=0;g$<c$.length;g$++)v$=c$[g$],d$.includes(v$)||(h$.push(v$),this.subscribedPeerStatusCache[v$]=void 0);if(this.session.requestPeersOnlineStatus(h$).pipe(ba(function(b$){return uc(Jk(b$.userInfos,"account"),function($$){return!!$$.ts})})).subscribe(function(b$){b$=uc(b$,function($$,C$){return $$=$$?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,y$.subscribedPeerStatusCache[C$]=$$}),y$.emit("PeersOnlineStatusChanged",b$)}),d$.length===0){S$.next=36;break}throw new da("Subscription failed",fr);case 36:case"end":return S$.stop()}},i$,this)}));return function(i$){return n$.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$,c$,u$,l$;return w.wrap(function(d$){for(;;)switch(d$.prev=d$.next){case 0:if(this.connectionState===T.CONNECTED){d$.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){d$.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(o$)&&o$.length!==0){d$.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:s$=0;case 7:if(!(s$<o$.length)){d$.next=14;break}if(za(a$=o$[s$])){d$.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",a$],kg);case 11:s$++,d$.next=7;break;case 14:if(!(512<o$.length)){d$.next=16;break}throw new ib("Unsubscribed peers overflows",gr);case 16:for(c$=o$&&o$.length?vk(o$):[],this.session.requestUnsubscribePeersOnlineStatus(c$),u$=0;u$<c$.length;u$++)l$=c$[u$],delete this.subscribedPeerStatusCache[l$];case 19:case"end":return d$.stop()}},i$,this)}));return function(i$){return n$.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var n$=J(w.mark(function i$(o$){return w.wrap(function(s$){for(;;)switch(s$.prev=s$.next){case 0:if(this.connectionState===T.CONNECTED){s$.next=2;break}throw new K("The client is not logged in",bl);case 2:if(o$!==S.PeerSubscriptionOption.ONLINE_STATUS){s$.next=4;break}return s$.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new I("Subscription option not supported",kg);case 5:case"end":return s$.stop()}},i$,this)}));return function(i$){return n$.apply(this,arguments)}}()},{key:"createMessage",value:function(n$){return n$.messageType==="IMAGE"?ua({width:0,height:0,fileName:"",description:"",thumbnail:new Blob,thumbnailWidth:0,thumbnailHeight:0,size:0},n$):n$.messageType==="FILE"?ua({fileName:"",description:"",thumbnail:new Blob,size:0},n$):n$}},{key:"downloadMedia",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$,c$,u$,l$,d$,h$,p$,_$,f$,m$,g$,v$,y$,S$=this,b$=arguments;return w.wrap(function($$){for(;;)switch($$.prev=$$.next){case 0:if(s$=1<b$.length&&b$[1]!==void 0?b$[1]:{},typeof o$=="string"){$$.next=3;break}throw new I("invalid mediaId format",cl);case 3:if($$.prev=3,a$=o$.split("z"),c$=ra(a$,3),u$=c$[0],l$=c$[1],d$=c$[2],h$=u$.slice(1,65),p$=bD(h$),_$=parseInt(u$.slice(65),10),f$=parseInt(l$,10),m$=parseInt(d$,10),!(Number.isNaN(_$)||Number.isNaN(f$)||Number.isNaN(m$))){$$.next=12;break}throw new I("Invalid mediaId content",cl);case 12:$$.next=19;break;case 14:if($$.prev=14,$$.t0=$$.catch(3),!sa($$.t0)){$$.next=18;break}throw $$.t0;case 18:throw new I("parse mediaId failure",{code:cl,originalError:$$.t0});case 19:if(this.connectionState===T.CONNECTED){$$.next=21;break}throw new K("The client is not logged in, cannot download",CA);case 21:if(this.session!==void 0){$$.next=23;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 23:return g$=this.mediaTaskManager.addDownloadTask({unit:f$,zone:_$,hashHexStr:h$,size:m$},function(){if(S$.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return S$.session.requestFileDownloadIndexGet({hash:p$,zone:_$,unit:f$,size:m$}).toPromise()},s$),$$.next=26,this.mediaTaskManager.waitMediaTask(g$);case 26:return v$=$$.sent,y$=v$.payload,$$.abrupt("return",y$);case 29:case"end":return $$.stop()}},i$,this,[[3,14]])}));return function(i$){return n$.apply(this,arguments)}}()},{key:"createMediaMessageByUploading",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$,c$,u$,l$,d$,h$,p$,_$,f$,m$,g$,v$,y$,S$,b$,$$,C$,N$,k$,O$,U$,x$,F$,L$=this,M$=arguments;return w.wrap(function(V$){for(;;)switch(V$.prev=V$.next){case 0:if(s$=1<M$.length&&M$[1]!==void 0?M$[1]:{},a$=2<M$.length&&M$[2]!==void 0?M$[2]:{},yd(s$)){V$.next=4;break}throw new I("Invalid params",wf);case 4:if(c$="thumbnailWidth"in s$||"thumbnailHeight"in s$||"width"in s$||"height"in s$,u$=s$.messageType,l$=u$===void 0?c$?"IMAGE":"FILE":u$,d$=s$.description,h$=d$===void 0?"":d$,p$=s$.fileName,_$=p$===void 0?"":p$,f$=s$.thumbnail,typeof s$.messageType=="string"&&typeof h$=="string"&&typeof _$=="string"&&(Pm(f$)||f$===void 0)&&Pm(o$)){V$.next=8;break}throw new I("Invalid message params type",wf);case 8:if(!c$||l$!=="FILE"){V$.next=10;break}throw new I("Invalid message params, unexpected field in RtmFileMessage",wf);case 10:if(!(33554432<(m$=o$.size))){V$.next=13;break}throw new ib("The payload size overflow 32 MB",wA);case 13:return V$.next=15,Ji(o$);case 15:return g$=V$.sent,V$.next=18,aD(g$);case 18:if(v$=V$.sent,this.connectionState===T.CONNECTED){V$.next=21;break}throw new K("The client is not logged in",yA);case 21:if(l$!=="IMAGE"){V$.next=29;break}return V$.next=24,Xt(s$,g$);case 24:y$=V$.sent,S$=y$.height,b$=y$.width,$$=y$.thumbnailWidth,C$=y$.thumbnailHeight;case 29:return N$=this.mediaTaskManager.addUploadTask({file:new Uint8Array(g$),hash:v$},function(){if(L$.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return L$.session.fetchFileUploadIndexGet({hash:v$,size:m$})},function(A$,I$){if(L$.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return L$.session.requestFileUploadIndexSet({hash:v$,unit:A$,servers:I$}).toPromise()},a$),V$.next=32,this.mediaTaskManager.waitMediaTask(N$);case 32:if(k$=V$.sent,O$=k$.zone,U$=k$.retUnit,l$!=="IMAGE"){V$.next=38;break}return x$={height:S$,width:b$,fileName:_$,size:m$,description:h$,thumbnail:f$,messageType:l$,thumbnailWidth:$$,thumbnailHeight:C$,mediaId:"0".concat($r(v$)).concat(O$,"z").concat(U$,"z").concat(m$,"z").concat(S$,"z").concat(b$)},V$.abrupt("return",x$);case 38:return F$={fileName:_$,size:m$,description:h$,mediaId:"0".concat($r(v$)).concat(O$,"z").concat(U$,"z").concat(m$),thumbnail:f$,messageType:l$},V$.abrupt("return",F$);case 40:case"end":return V$.stop()}},i$,this)}));return function(i$){return n$.apply(this,arguments)}}()},{key:"loginImpl",value:function(){var n$=J(w.mark(function i$(o$){var s$,a$,c$,u$,l$=this;return w.wrap(function(d$){for(;;)switch(d$.prev=d$.next){case 0:if(s$=o$.uid,a$=o$.instanceId,!(this.lastLoginTime!==void 0&&500>Date.now()-this.lastLoginTime)){d$.next=4;break}throw new rC(["The frequency of login exceeded the limit of %d queries per second",2],mA);case 4:if(this.connectionState===T.DISCONNECTED){d$.next=6;break}throw new K("The SDK is either logging in or has logged in the Agora RTM system",kA);case 6:d$.prev=6,this.context.uid=s$,d$.next=13;break;case 10:throw d$.prev=10,d$.t0=d$.catch(6),new I(["The %s in the arguments is invalid",Object.keys({uid:s$})[0]],Jh);case 13:return this.onConnectionStateChanged(T.CONNECTING,Eb.LOGIN),this.session=c$=new ls(this.context,new Yr(this.context,this.logger,!1),a$,this.logger),u$=function(){l$.connectionState===T.CONNECTED&&(l$.onConnectionStateChanged(T.RECONNECTING,Eb.INTERRUPTED),l$.session)&&l$.session.once("userJoined",function(){l$.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS)})},c$.on("connectionLost",u$),c$.on("tokenExpired",function(){l$.emit("TokenExpired")}),c$.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",function(h$){l$.emit("MessageFromPeer",{text:h$.text,messageType:S.MessageType.TEXT},h$.peerId,h$.properties)}),this.session.on("peerMediaMessage",function(h$){var p$=h$.peerId,_$=h$.properties,f$=h$.messageType;h$=h$.details,f$==="FILE"?l$.emit("MessageFromPeer",{messageType:S.MessageType.FILE,size:parseInt(pa(h$.media_size),10),description:pa(h$.media_description),fileName:pa(h$.media_filename),mediaId:pa(h$.media_id),thumbnail:new Blob([h$.media_thumbnail])},p$,_$):f$==="IMAGE"&&l$.emit("MessageFromPeer",{messageType:S.MessageType.IMAGE,size:parseInt(pa(h$.media_size),10),description:pa(h$.media_description),fileName:pa(h$.media_filename),mediaId:pa(h$.media_id),thumbnail:new Blob([h$.media_thumbnail]),height:parseInt(pa(h$.media_height),10),width:parseInt(pa(h$.media_width),10),thumbnailHeight:parseInt(pa(h$.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(h$.media_thumbnailwidth),10)},p$,_$)}),this.session.on("peerRawMessage",function(h$){l$.emit("MessageFromPeer",{rawMessage:h$.raw,description:h$.desc,messageType:S.MessageType.RAW},h$.peerId,h$.properties)}),c$.on("instanceChanged",function(h$){return a$=h$}),c$.on("peerOnlineStatusChanged",function(h$){var p$=h$.instance.toString()+h$.state,_$=l$.peerStatusSeqLru.get(p$);!_$||h$.seq.greaterThan(_$)?(l$.peerStatusSeqLru.set(p$,h$.seq),h$.state!==l$.subscribedPeerStatusCache[h$.peerId]&&l$.emit("PeersOnlineStatusChanged",m({},h$.peerId,h$.state)),l$.subscribedPeerStatusCache[h$.peerId]=h$.state,clearTimeout(l$.peerUnreachableTimers[p$]),h$.state===S.PeerOnlineState.UNREACHABLE&&(l$.peerUnreachableTimers[p$]=setTimeout(function(){l$.subscribedPeerStatusCache[h$.peerId]===S.PeerOnlineState.UNREACHABLE&&(l$.subscribedPeerStatusCache[h$.peerId]=S.PeerOnlineState.ONLINE,l$.emit("PeersOnlineStatusChanged",m({},h$.peerId,S.PeerOnlineState.ONLINE)))},3e4))):l$.log("peerOnlineStatusChanged dedup for %s, %d",p$,h$.seq.toNumber())}),c$.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),c$.on("channelAttributesUpdated",function(h$){var p$=h$.channelId;h$=h$.attributeMaps;for(var _$={},f$=0;f$<h$.length;f$++){var m$=h$[f$],g$=m$.key,v$=m$.ms,y$=m$.value;if(m$=m$.origin,typeof g$!="string"||!U.isLong(v$)||typeof y$!="string"||!za(m$))break;_$[g$]=new Blob([y$]).size}l$.channelAttributesCacheLru.set(p$,_$)}),c$.on("userJoined",function(h$){if(Object.keys(l$.attributes).length!==0){if(l$.session===void 0)return;l$.session.requestSetLocalUserAttributes(l$.attributes,h$).toPromise()}if(l$.attributeDrafts.size!==0)for(var p$=function(m$,g$){var v$=(m$=g$[m$]).attribute;m$.promise.then(function(){l$.session!==void 0&&l$.session.requestSetLocalUserAttributes(v$,h$).toPromise()})},_$=0,f$=Array.from(l$.attributeDrafts);_$<f$.length;_$++)p$(_$,f$);Object.keys(l$.subscribedPeerStatusCache).length!==0&&c$.requestSubscribePeersOnlineStatus(Object.keys(l$.subscribedPeerStatusCache))}),this.lastLoginTime=Date.now(),d$.prev=29,d$.next=32,c$.loginHandler().toPromise();case 32:this.mediaTaskManager.setAuthInfo({ticket:c$.connection.curOpenSockets.filter(function(h$){return h$!==void 0})[0].ticket,instance:c$.instanceId,useNewDomain:.5<=Math.random(),loginOpt:c$.userJoinOptions.toLong()}),d$.next=44;break;case 35:if(d$.prev=35,d$.t1=d$.catch(29),!Sa(d$.t1)){d$.next=40;break}throw this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_TIMEOUT),new db(Yd(this.name,"login",2e4),lA);case 40:if(this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_FAILURE),!sa(d$.t1)){d$.next=43;break}throw d$.t1;case 43:throw new da("Login failure",{code:Zq,originalError:d$.t1});case 44:this.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS);case 45:case"end":return d$.stop()}},i$,this,[[6,10],[29,35]])}));return function(i$){return n$.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(n$,i$){var o$,s$=this;n$===T.RECONNECTING&&(this.reconnId+=1),eb("ConnectionStateChange",{elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),newState:os[n$],oldState:os[this.connectionState],reason:qD[i$],sid:Xa(this.session&&this.session.instanceId||U.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},(o$=this.context.config.enableCloudProxy)!==null&&o$!==void 0&&o$),this.connectionState===T.RECONNECTING&&n$===T.CONNECTED&&(Object.keys(this.subscribedPeerStatusCache).length!==0&&this.session!==void 0&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(ba(function(a$){return uc(Jk(a$.userInfos,"account"),function(c$){return!!c$.ts})})).subscribe(function(a$){a$=uc(a$,function(c$,u$){return c$=c$?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,s$.subscribedPeerStatusCache[u$]=c$}),s$.emit("PeersOnlineStatusChanged",a$)}),this.internalEmitter.emit("RECONNECTED")),this.connectionState=n$,n$!==T.ABORTED&&n$!==T.DISCONNECTED||(this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.joinedChannels.clear(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.session=void 0,this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.mediaTaskManager.emit("connectionStateChanged",n$),this.emit("ConnectionStateChanged",n$,i$)}}]),t$}(tb()),fa(E.prototype,"renewToken",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"renewToken"),E.prototype),fa(E.prototype,"queryPeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersOnlineStatus"),E.prototype),fa(E.prototype,"getChannelMemberCount",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelMemberCount"),E.prototype),fa(E.prototype,"setLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setLocalUserAttributes"),E.prototype),fa(E.prototype,"setChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setChannelAttributes"),E.prototype),fa(E.prototype,"addOrUpdateLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateLocalUserAttributes"),E.prototype),fa(E.prototype,"addOrUpdateChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateChannelAttributes"),E.prototype),fa(E.prototype,"deleteLocalUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteLocalUserAttributesByKeys"),E.prototype),fa(E.prototype,"deleteChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteChannelAttributesByKeys"),E.prototype),fa(E.prototype,"clearLocalUserAttributes",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"clearLocalUserAttributes"),E.prototype),fa(E.prototype,"clearChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"clearChannelAttributes"),E.prototype),fa(E.prototype,"getUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributes"),E.prototype),fa(E.prototype,"getChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributes"),E.prototype),fa(E.prototype,"getChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributesByKeys"),E.prototype),fa(E.prototype,"getUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributesByKeys"),E.prototype),fa(E.prototype,"login",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"login"),E.prototype),fa(E.prototype,"logout",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logout"),E.prototype),fa(E.prototype,"logoutSync",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logoutSync"),E.prototype),fa(E.prototype,"sendMessageToPeer",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"sendMessageToPeer"),E.prototype),fa(E.prototype,"createChannel",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createChannel"),E.prototype),fa(E.prototype,"createLocalInvitation",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createLocalInvitation"),E.prototype),fa(E.prototype,"subscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"subscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"unsubscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"unsubscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"queryPeersBySubscriptionOption",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersBySubscriptionOption"),E.prototype),fa(E.prototype,"createMessage",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMessage"),E.prototype),fa(E.prototype,"downloadMedia",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"downloadMedia"),E.prototype),fa(E.prototype,"createMediaMessageByUploading",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMediaMessageByUploading"),E.prototype),E),ps={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},qs={enableLogUpload:!1,logFilter:ps.LOG_FILTER_INFO,enableCloudProxy:!1},Zd=ua(ua({createInstance:function(e$){var t$=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},r$=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(e$))throw new I(["The %s in the arguments is invalid",Object.keys({appId:e$})[0]],Nq);var n$=Object.keys(t$).filter(function(l$){return!(l$ in qs)});if(n$.length!==0)throw new I("Invalid RTM config: ".concat(n$.join(", ")),Nq);var i$=ua(ua({},qs),t$);if(r$!==void 0&&(!Array.isArray(r$)||r$.length===0))throw new I("Invalid area config");if(r$!=null){if(!r$.every(function(l$){return l$ in S.LegacyAreaCode}))throw new I("Invalid area codes: ".concat(r$.filter(function(l$){return!(l$ in S)}).join(", ")));M=xe(r$.map(function(l$){return zC[l$]}))}r$=jl=Ya.__global_unique_id__=(Ya.__global_unique_id__||0)+1;var o$=DC(i$);n$=EC(i$);var s$=FC(i$),a$=GC(r$,i$),c$=Tr(r$,i$),u$=c$("RTM:DEBUG","<Entry> ");return Mr.rtmConfig=i$,o$("The Agora RTM Web SDK version is %s","1.4.3-203"),t$.enableCloudProxy&&o$("RTM cloud proxy enabled"),t$.enableLogUpload&&o$("Log upload enabled"),M&&u$("Area is set to %s",Array.from(M.CODES).map(function(l$){return xf(F).find(function(d$){return F[d$]===l$})}).join(", ")),u$("Creating an RtmClient instance"),u$('The Git commit ID is "'.concat("v1.4.3-17-g1e27aa38",'"')),u$("The App ID is %s",Um(e$,4,10,"*".repeat(6))),o$("The process ID is %s",gg),u$("The build is %s","v1.4.3-17-g1e27aa38"),u$("NODE_ENV is %s","production"),new rD(e$,{genLogger:c$,genTracker:a$,info:o$,warn:n$,logError:s$,loggerId:r$},i$,function(l$){for(var d$=0,h$=xf(l$);d$<h$.length;d$++){var p$=h$[d$];try{var _$=l$[p$];_$!=null&&(l$.enableCloudProxy&&o$("RTM cloud proxy enabled"),l$.enableLogUpload&&o$("Log upload enabled"),i$[p$]=_$)}catch{throw new I(["The %s in the arguments is invalid",p$],void 0)}}})},BUILD:"v1.4.3-17-g1e27aa38",VERSION:"1.4.3-203",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:gg,ConnectionChangeReason:S.ConnectionChangeReason,ConnectionState:S.ConnectionState,LocalInvitationFailureReason:S.LocalInvitationFailureReason,LocalInvitationState:S.LocalInvitationState,RemoteInvitationFailureReason:S.RemoteInvitationFailureReason,RemoteInvitationState:S.RemoteInvitationState,MessageType:S.MessageType,PeerOnlineState:S.PeerOnlineState,PeerSubscriptionOption:S.PeerSubscriptionOption},ps),{},{setParameter:function(e$,t$){Object.keys(Nc).includes(e$)&&(Nc[e$]=t$)},getParameter:function(e$){return Nc[e$]},setArea:function(e$){var t$=e$.areaCodes;if(e$=e$.excludedArea,!Array.isArray(t$)||t$.length===0||!t$.every(function(r$){return r$ in S.AreaCode}))throw new I("Invalid area config");if(e$!==void 0&&e$===S.AreaCode.GLOBAL)throw new I("Excluded area cannot be global");if(e$===void 0)M=xe(t$.map(function(r$){return F[r$]}));else{if(t$.includes(e$))throw new I("Excluded area cannot be in areaCodes");if(!(e$ in F))throw new I("Invalid excludedArea:",e$);M=bu({areas:t$.map(function(r$){return F[r$]}),excludedArea:F[e$]})}}});return Zd})})(agoraRtmSdk,agoraRtmSdk.exports);var agoraRtmSdkExports=agoraRtmSdk.exports;const AgoraRTM__default=getDefaultExportFromCjs(agoraRtmSdkExports);var createLazyClient=function e$(){var t$;function r$(n$,i$,o$){return t$||(t$=AgoraRTM__default.createInstance(n$,i$,o$)),t$}return function(n$,i$,o$){return r$(n$,i$,o$)}},createLazyChannel=function e$(){var t$;function r$(n$,i$){return t$||(t$=n$.createChannel(i$)),t$}return function(n$,i$){return r$(n$,i$)}},AreaCode;(function(e$){e$.GLOBAL="GLOBAL",e$.INDIA="INDIA",e$.JAPAN="JAPAN",e$.ASIA="ASIA",e$.EUROPE="EUROPE",e$.CHINA="CHINA",e$.NORTH_AMERICA="NORTH_AMERICA"})(AreaCode||(AreaCode={}));function _extends(){return _extends=Object.assign||function(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$];for(var n$ in r$)Object.prototype.hasOwnProperty.call(r$,n$)&&(e$[n$]=r$[n$])}return e$},_extends.apply(this,arguments)}typeof Symbol<"u"&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")));typeof Symbol<"u"&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));function _catch(e$,t$){try{var r$=e$()}catch(n$){return t$(n$)}return r$&&r$.then?r$.then(void 0,t$):r$}var RtcContext=React.createContext({}),RtcProvider=RtcContext.Provider;RtcContext.Consumer;var remoteTrackState;(function(e$){e$[e$.yes=0]="yes",e$[e$.subbed=1]="subbed",e$[e$.no=2]="no"})(remoteTrackState||(remoteTrackState={}));var layout;(function(e$){e$[e$.grid=0]="grid",e$[e$.pin=1]="pin"})(layout||(layout={}));var ToggleState;(function(e$){e$[e$.disabled=0]="disabled",e$[e$.enabled=1]="enabled",e$[e$.disabling=2]="disabling",e$[e$.enabling=3]="enabling"})(ToggleState||(ToggleState={}));var initialValue={rtcProps:{appId:"",channel:"",role:"host"},rtmProps:{}},PropsContext=React.createContext(initialValue),PropsProvider=PropsContext.Provider,MaxUidContext=React.createContext([]),MaxUidProvider=MaxUidContext.Provider,MaxUidConsumer=MaxUidContext.Consumer,MinUidContext=React.createContext([]),MinUidProvider=MinUidContext.Provider,MinUidConsumer=MinUidContext.Consumer,TracksContext=React.createContext({}),TracksProvider=TracksContext.Provider,initState={max:[{uid:0,hasAudio:remoteTrackState.no,hasVideo:remoteTrackState.no}],min:[],isScreensharing:!1},reducer=function e$(t$,r$){var n$=initState,i$=[].concat(t$.max,t$.min).map(function(u$){return u$.uid});switch(r$.type){case"Screensharing":n$=_extends({},t$,{isScreensharing:r$.value[0]}),console.log("!Screensharingstate",t$,n$);break;case"update-user-video":n$={min:t$.min.map(function(u$){return u$.uid===0?{uid:0,hasAudio:remoteTrackState.subbed,hasVideo:remoteTrackState.subbed}:u$}),max:t$.max.map(function(u$){return u$.uid===0?{uid:0,hasAudio:remoteTrackState.subbed,hasVideo:remoteTrackState.subbed}:u$}),isScreensharing:t$.isScreensharing};break;case"user-joined":if(i$.indexOf(r$.value[0].uid)===-1){var o$=[].concat(t$.min,[{uid:r$.value[0].uid,hasAudio:remoteTrackState.no,hasVideo:remoteTrackState.no}]);o$.length===1&&t$.max[0].uid===0?n$={max:o$,min:t$.max,isScreensharing:t$.isScreensharing}:n$={min:o$,max:t$.max,isScreensharing:t$.isScreensharing}}break;case"user-unpublished":if(t$.max[0].uid===r$.value[0].uid)n$={max:[{uid:r$.value[0].uid,hasAudio:r$.value[1]==="audio"?remoteTrackState.no:t$.max[0].hasAudio,hasVideo:r$.value[1]==="video"?remoteTrackState.no:t$.max[0].hasVideo}],min:t$.min,isScreensharing:t$.isScreensharing};else{var s$=t$.min.find(function(u$){return u$.uid===r$.value[0].uid});if(s$){var a$=[].concat(t$.min.filter(function(u$){return u$.uid!==r$.value[0].uid}),[{uid:r$.value[0].uid,hasAudio:r$.value[1]==="audio"?remoteTrackState.no:s$.hasAudio,hasVideo:r$.value[1]==="video"?remoteTrackState.no:s$.hasVideo}]);n$={min:a$,max:t$.max,isScreensharing:t$.isScreensharing}}}break;case"user-published":t$.max[0].uid===r$.value[0].uid?n$={max:[{uid:r$.value[0].uid,hasAudio:r$.value[1]==="audio"?remoteTrackState.subbed:t$.max[0].hasAudio,hasVideo:r$.value[1]==="video"?remoteTrackState.subbed:t$.max[0].hasVideo}],min:t$.min,isScreensharing:t$.isScreensharing}:n$={min:t$.min.map(function(u$){return u$.uid!==r$.value[0].uid?u$:{uid:u$.uid,hasAudio:r$.value[1]==="audio"?remoteTrackState.subbed:u$.hasAudio,hasVideo:r$.value[1]==="video"?remoteTrackState.subbed:u$.hasVideo}}),max:t$.max,isScreensharing:t$.isScreensharing};break;case"user-left":if(t$.max[0].uid===r$.value[0].uid){var c$=[].concat(t$.min);n$={max:[c$.pop()],min:c$,isScreensharing:t$.isScreensharing}}else n$={min:t$.min.filter(function(u$){return u$.uid!==r$.value[0].uid}),max:t$.max,isScreensharing:t$.isScreensharing};break;case"user-swap":t$.max[0].uid===r$.value[0].uid||(n$={max:[r$.value[0]],min:[].concat(t$.min.filter(function(u$){return u$.uid!==r$.value[0].uid}),[t$.max[0]]),isScreensharing:t$.isScreensharing});break;case"local-user-mute-video":n$={min:t$.min.map(function(u$){return u$.uid===0?{uid:0,hasAudio:u$.hasAudio,hasVideo:r$.value[0]}:u$}),max:t$.max.map(function(u$){return u$.uid===0?{uid:0,hasAudio:u$.hasAudio,hasVideo:r$.value[0]}:u$}),isScreensharing:t$.isScreensharing};break;case"local-user-mute-audio":n$={min:t$.min.map(function(u$){return u$.uid===0?{uid:0,hasAudio:r$.value[0],hasVideo:u$.hasVideo}:u$}),max:t$.max.map(function(u$){return u$.uid===0?{uid:0,hasAudio:r$.value[0],hasVideo:u$.hasVideo}:u$}),isScreensharing:t$.isScreensharing};break;case"remote-user-mute-video":n$={min:t$.min.map(function(u$){return u$.uid===r$.value[0].uid?{uid:u$.uid,hasVideo:r$.value[1],hasAudio:u$.hasAudio}:u$}),max:t$.max.map(function(u$){return u$.uid===r$.value[0].uid?{uid:u$.uid,hasVideo:r$.value[1],hasAudio:u$.hasAudio}:u$}),isScreensharing:t$.isScreensharing};break;case"remote-user-mute-audio":n$={min:t$.min.map(function(u$){return u$.uid===r$.value[0].uid?{uid:u$.uid,hasAudio:r$.value[1],hasVideo:u$.hasVideo}:u$}),max:t$.max.map(function(u$){return u$.uid===r$.value[0].uid?{uid:u$.uid,hasAudio:r$.value[1],hasVideo:u$.hasVideo}:u$}),isScreensharing:t$.isScreensharing};break;case"leave-channel":n$=initState;break;case"ActiveSpeaker":t$.max[0].uid===r$.value[0]?n$=_extends({},t$):n$={max:[t$.min.find(function(u$){return u$.uid===r$.value[0]})],min:[].concat(t$.min.filter(function(u$){return u$.uid!==r$.value[0]}),[t$.max[0]]),isScreensharing:t$.isScreensharing};break}return console.log("!state-update",_extends({},t$,n$),n$),_extends({},t$,n$)},startScreenshare=function e$(t$,r$,n$,i$,o$,s$,a$){try{var c$=function(){try{try{console.log(d$),s$&&(d$.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(s$+"/rtc/"+r$+"/publisher/uid/"+p$+"/")).then(function(g$){return Promise.resolve(g$.json()).then(function(v$){var y$=v$.rtcToken;d$.renewToken(y$)})})}catch(g$){return Promise.reject(g$)}}),d$.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(s$+"/rtc/"+r$+"/publisher/uid/"+p$+"/")).then(function(g$){return Promise.resolve(g$.json()).then(function(v$){var y$=v$.rtcToken;d$.renewToken(y$)})})}catch(g$){return Promise.reject(g$)}})),n$.on("track-ended",function(){d$.leave(),d$.removeAllListeners()})}catch(g$){console.log(g$)}return Promise.resolve()}catch(g$){return Promise.reject(g$)}},u$=function(){try{d$.setClientRole("host");var g$=function(){if(s$){var v$=_catch(function(){return Promise.resolve(fetch(s$+"/rtc/"+r$+"/publisher/uid/"+p$+"/")).then(function(y$){return Promise.resolve(y$.json()).then(function(S$){var b$=S$.rtcToken;return Promise.resolve(d$.join(t$,r$,b$,p$)).then(function($$){h$=$$})})})},function(y$){console.log(y$)});if(v$&&v$.then)return v$.then(function(){})}else return Promise.resolve(d$.join(t$,r$,i$||null,p$||0)).then(function(y$){h$=y$})}();return Promise.resolve(g$&&g$.then?g$.then(function(){}):void 0)}catch(v$){return Promise.reject(v$)}},l$=function(){try{var g$=function(){var S$=function(){if(n$.enabled){var b$=function(){if(!_$)return Promise.resolve(d$.publish([n$]).then(function(){_$=!0})).then(function(){})}();if(b$&&b$.then)return b$.then(function(){})}}();if(S$&&S$.then)return S$.then(function(){})},v$=function(){if(a$)return Promise.resolve(d$.enableDualStream()).then(function(){})}();return Promise.resolve(v$&&v$.then?v$.then(g$):g$(v$))}catch(y$){return Promise.reject(y$)}},d$=nq.createClient({mode:"live",role:"host",codec:"vp8"}),h$=0,p$=o$||1,_$=!1,f$=function(){try{var g$=_catch(function(){return n$.close(),Promise.resolve(d$.leave()).then(function(){d$.removeAllListeners()})},function(v$){console.log(v$)});return Promise.resolve(g$&&g$.then?g$.then(function(){}):void 0)}catch(v$){return Promise.reject(v$)}};return stopScreenshare=f$,Promise.resolve(c$()).then(function(){return Promise.resolve(u$()).then(function(){return Promise.resolve(l$()).then(function(){h$&&console.log(h$)})})})}catch(m$){return Promise.reject(m$)}},stopScreenshare=function e$(){},useClient=createClient({codec:"vp8",mode:"live"}),RtcConfigure=function e$(t$){var r$=reactExports.useRef(),n$=reactExports.useRef(),i$=reactExports.useRef(!1),o$=reactExports.useContext(TracksContext),s$=o$.localVideoTrack,a$=o$.localAudioTrack,c$=reactExports.useContext(PropsContext),u$=c$.callbacks,l$=c$.rtcProps,d$=reactExports.useState(!1),h$=d$[0],p$=d$[1],_$=reactExports.useState(!1),f$=_$[0],m$=_$[1],g$=null,v$=reactExports.useRef(new Promise(function(x$,F$){g$=x$,console.log(F$)})),y$=useClient();l$.customRtcClient&&(y$.removeAllListeners(),y$=l$.customRtcClient);var S$=!1,b$=!1,$$=reactExports.useRef({}),C$=t$.callActive;C$===void 0&&(C$=!0);var N$=reactExports.useReducer(reducer,initState),k$=N$[0],O$=N$[1];reactExports.useEffect(function(){var x$=function(){try{try{if(console.log(y$),y$.on("user-joined",function(){try{for(var I$=arguments.length,P$=new Array(I$),w$=0;w$<I$;w$++)P$[w$]=arguments[w$];var E$=P$[0];return E$.uid===t$.screenshareUid&&i$.current||E$.uid===1&&i$.current||($$.current[E$.uid]={}),O$({type:"user-joined",value:P$}),Promise.resolve()}catch(T$){return Promise.reject(T$)}}),y$.on("user-published",function(){for(var I$=arguments.length,P$=new Array(I$),w$=0;w$<I$;w$++)P$[w$]=arguments[w$];try{var E$=P$[0],T$=P$[1];return console.log("user-published",E$.uid),E$.uid===t$.screenshareUid&&i$.current||E$.uid===1&&i$.current?O$({type:"user-published",value:P$}):y$.subscribe(E$,T$).then(function(R$){if($$.current[E$.uid][T$+"Track"]=E$[T$+"Track"],T$==="audio"){var D$;(D$=E$.audioTrack)===null||D$===void 0||D$.play()}else l$.enableDualStream&&l$.dualStreamMode&&y$.setStreamFallbackOption(E$.uid,l$.dualStreamMode);O$({type:"user-published",value:P$})}).catch(function(R$){return console.log(R$)}),Promise.resolve()}catch(R$){return Promise.reject(R$)}}),y$.on("user-unpublished",function(){try{for(var I$=arguments.length,P$=new Array(I$),w$=0;w$<I$;w$++)P$[w$]=arguments[w$];var E$=P$[0],T$=P$[1];if(console.log("user-unpublished",E$.uid),T$==="audio"){var R$;(R$=E$.audioTrack)===null||R$===void 0||R$.stop()}return O$({type:"user-unpublished",value:P$}),Promise.resolve()}catch(D$){return Promise.reject(D$)}}),y$.on("connection-state-change",function(){try{for(var I$=arguments.length,P$=new Array(I$),w$=0;w$<I$;w$++)P$[w$]=arguments[w$];var E$=P$[0],T$=P$[1],R$=P$[2];if(console.log("connection",T$,E$,R$),E$==="CONNECTED")m$(!0);else if(E$==="DISCONNECTED"){try{stopScreenshare(),i$.current=!1}catch(D$){console.log("stopscreenshare",D$)}O$({type:"leave-channel",value:null})}else m$(!1);return Promise.resolve()}catch(D$){return Promise.reject(D$)}}),y$.on("user-left",function(){for(var I$=arguments.length,P$=new Array(I$),w$=0;w$<I$;w$++)P$[w$]=arguments[w$];O$({type:"user-left",value:P$})}),l$.tokenUrl){var L$=l$.tokenUrl,M$=l$.channel,V$=l$.uid;y$.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(L$+"/rtc/"+M$+"/publisher/uid/"+(V$||0)+"/")).then(function(I$){return Promise.resolve(I$.json()).then(function(P$){var w$=P$.rtcToken;y$.renewToken(w$)})})}catch(I$){return Promise.reject(I$)}}),y$.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(L$+"/rtc/"+M$+"/publisher/uid/"+(V$||0)+"/")).then(function(I$){return Promise.resolve(I$.json()).then(function(P$){var w$=P$.rtcToken;y$.renewToken(w$)})})}catch(I$){return Promise.reject(I$)}})}if(u$){var A$=Object.keys(u$);A$.map(function(I$){try{y$.on(I$,function(){for(var P$=arguments.length,w$=new Array(P$),E$=0;E$<P$;E$++)w$[E$]=arguments[E$];u$[I$].apply(null,w$)})}catch(P$){console.log(P$)}})}g$(!0),p$(!0)}catch(I$){console.log("!!!",I$)}return Promise.resolve()}catch(I$){return Promise.reject(I$)}};return g$?(x$(),function(){try{y$.removeAllListeners()}catch(F$){console.log(F$)}}):function(){}},[l$.appId]),reactExports.useEffect(function(){var x$=function(){try{return Promise.resolve(v$.current).then(function(){var M$=l$.tokenUrl,V$=l$.channel,A$=l$.uid,I$=l$.appId,P$=l$.token,w$=function(){if(y$&&!F$){l$.role==="audience"?y$.setClientRole(l$.role):y$.setClientRole("host");var E$=function(){if(M$){var T$=_catch(function(){return Promise.resolve(fetch(M$+"/rtc/"+V$+"/publisher/uid/"+(A$||0)+"/")).then(function(R$){return Promise.resolve(R$.json()).then(function(D$){var j$=D$.rtcToken;return Promise.resolve(y$.join(I$,V$,j$,A$||0)).then(function(G$){r$.current=G$})})})},function(R$){console.log(R$)});if(T$&&T$.then)return T$.then(function(){})}else return Promise.resolve(y$.join(I$,V$,P$||null,A$||0)).then(function(R$){r$.current=R$})}();if(E$&&E$.then)return E$.then(function(){})}else console.error("trying to join before RTC Engine was initialized")}();if(w$&&w$.then)return w$.then(function(){})})}catch(M$){return Promise.reject(M$)}},F$=!1;return C$?(x$(),console.log("Attempted join: ",l$.channel)):console.log("In precall - waiting to join"),function(){if(F$=!0,C$){console.log("Leaving channel");try{stopScreenshare(),i$.current=!1}catch(L$){console.log(L$)}v$.current=y$.leave().catch(function(L$){return console.log(L$)})}}},[l$.channel,l$.uid,C$,l$.tokenUrl]),reactExports.useEffect(function(){var x$=function(){try{var L$=function(){function A$(){var P$=function(){if(s$!=null&&s$.enabled&&f$){var w$=function(){if(!S$)return Promise.resolve(y$.publish([s$]).then(function(){S$=!0})).then(function(){})}();if(w$&&w$.then)return w$.then(function(){})}}();if(P$&&P$.then)return P$.then(function(){})}var I$=function(){if(a$!=null&&a$.enabled&&f$){var P$=function(){if(!b$)return Promise.resolve(y$.publish([a$]).then(function(){b$=!0})).then(function(){})}();if(P$&&P$.then)return P$.then(function(){})}}();return I$&&I$.then?I$.then(A$):A$(I$)},M$=function(){if(l$.enableDualStream)return Promise.resolve(y$.enableDualStream()).then(function(){})}();return Promise.resolve(M$&&M$.then?M$.then(L$):L$(M$))}catch(V$){return Promise.reject(V$)}};console.log("Publish",s$,a$,C$),C$&&x$()},[C$,s$==null?void 0:s$.enabled,a$==null?void 0:a$.enabled,f$]),reactExports.useEffect(function(){s$&&a$!==null&&($$.current[0]={audioTrack:a$,videoTrack:s$},O$({type:"update-user-video",value:[a$,s$]}))},[l$.channel,f$]),reactExports.useEffect(function(){f$&&l$.token&&y$.renewToken(l$.token).then(function(x$){return console.log("renewed token",x$)})},[l$.token,f$]),reactExports.useEffect(function(){l$.role&&y$.setClientRole(l$.role).then(function(x$){return console.log("changed role",x$)})},[l$.role,f$]),reactExports.useEffect(function(){var x$=function(){try{var L$=function(){if(l$.activeSpeaker&&l$.layout!==layout.grid)return y$.on("volume-indicator",function(M$){var V$=M$.reduce(function(P$,w$){return P$===null||w$.level>P$.level?w$:P$},null),A$=V$?V$.uid:void 0,I$=A$===r$.current?0:A$;A$!==void 0&&O$({type:"ActiveSpeaker",value:[I$]})}),Promise.resolve(y$.enableAudioVolumeIndicator()).then(function(){})}();return Promise.resolve(L$&&L$.then?L$.then(function(){}):void 0)}catch(M$){return Promise.reject(M$)}};return C$&&x$(),function(){y$.removeAllListeners("volume-indicator")}},[l$.activeSpeaker,l$.layout]);var U$=function(){try{var F$=function(){try{return O$({type:"Screensharing",value:[!0]}),Promise.resolve(nq.createScreenVideoTrack({},"disable")).then(function(V$){n$.current=V$;var A$=l$.screenshareUid||1;return $$.current[A$]={videoTrack:n$.current},n$.current.on("track-ended",function(){i$.current=!1,O$({type:"Screensharing",value:[!1]})}),i$.current=!0,Promise.resolve(startScreenshare(l$.appId,l$.channel,n$.current,l$.screenshareToken,l$.screenshareUid,l$.tokenUrl,l$.enableDualStream)).then(function(){})})}catch(V$){return Promise.reject(V$)}},L$=function(){stopScreenshare(),i$.current=!1};return i$.current?L$():F$(),Promise.resolve()}catch(M$){return Promise.reject(M$)}};return React.createElement(RtcProvider,{value:{client:y$,mediaStore:$$.current,localVideoTrack:s$,localAudioTrack:a$,dispatch:O$,localUid:r$,channelJoined:f$,toggleScreensharing:U$,isScreensharing:i$.current}},React.createElement(MaxUidProvider,{value:k$.max},React.createElement(MinUidProvider,{value:k$.min},h$?t$.children:null)))},icons={videocam:React.createElement(React.Fragment,null,React.createElement("polygon",{points:"23 7 16 12 23 17 23 7"}),React.createElement("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})),videocamOff:React.createElement(React.Fragment,null,React.createElement("path",{d:"M16 16v1a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2m5.66 0H14a2 2 0 0 1 2 2v3.34l1 1L23 7v10"}),React.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"})),remoteSwap:React.createElement(React.Fragment,null,React.createElement("polyline",{points:"15 3 21 3 21 9"}),React.createElement("polyline",{points:"9 21 3 21 3 15"}),React.createElement("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),React.createElement("line",{x1:"3",y1:"21",x2:"10",y2:"14"})),callEnd:React.createElement(React.Fragment,null,React.createElement("path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"}),React.createElement("line",{x1:"23",y1:"1",x2:"1",y2:"23"})),mic:React.createElement(React.Fragment,null,React.createElement("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),React.createElement("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),React.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),React.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),micOff:React.createElement(React.Fragment,null,React.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),React.createElement("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"}),React.createElement("path",{d:"M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"}),React.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),React.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),screen:React.createElement(React.Fragment,null,React.createElement("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),React.createElement("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),React.createElement("line",{x1:"12",y1:"17",x2:"12",y2:"21"})),stop:React.createElement(React.Fragment,null,React.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},BtnTemplate=function e$(t$){var r$=t$.onClick,n$=t$.name,i$=t$.disabled,o$=t$.style,s$=reactExports.useContext(PropsContext),a$=s$.styleProps,c$=a$||{},u$=c$.theme,l$=c$.BtnTemplateStyles,d$=c$.iconSize,h$=c$.customIcon;return React.createElement("div",{style:_extends({},{width:35,height:35,borderRadius:"100%",borderWidth:2,borderStyle:"solid",borderColor:"#fff",backgroundColor:"rgba(0,80,180,0.2)",alignItems:"center",justifyContent:"center",display:"flex",cursor:i$?"auto":"pointer",margin:4},l$,o$),onClick:r$},h$?React.createElement("img",{src:h$[n$],alt:n$}):React.createElement("svg",{style:{width:d$||24,height:d$||24},xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",opacity:i$?"0.5":"1",stroke:u$||"#fff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},icons[n$]))};function EndCall(){var e$=reactExports.useContext(PropsContext),t$=e$.styleProps,r$=e$.callbacks,n$=t$||{},i$=n$.localBtnStyles,o$=i$||{},s$=o$.endCall;return React.createElement(BtnTemplate,{style:s$||{backgroundColor:"#ef5588",borderColor:"#f00"},name:"callEnd",onClick:function(){return(r$==null?void 0:r$.EndCall)&&r$.EndCall()}})}var LocalContext=reactExports.createContext({}),LocalUserContext=function e$(t$){var r$=reactExports.useContext(MaxUidContext),n$=reactExports.useContext(MinUidContext),i$;return r$[0].uid===0?i$=r$[0]:i$=n$.find(function(o$){return o$.uid===0}),React.createElement(LocalContext.Provider,{value:i$},t$.children)},muteAudio=function(e$,t$,r$,n$){try{var i$=function(){if(e$.uid===0){var o$=e$.hasAudio,s$=function(){if(o$===ToggleState.enabled||o$===ToggleState.disabled){var a$=o$===ToggleState.enabled?ToggleState.disabling:ToggleState.enabling;t$({type:"local-user-mute-audio",value:[a$]}),n$&&n$["local-user-mute-audio"]&&n$["local-user-mute-audio"](a$);var c$=_catch(function(){return Promise.resolve(r$==null?void 0:r$.setEnabled(o$!==ToggleState.enabled)).then(function(){a$=o$===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled,n$&&n$["local-user-mute-audio"]&&n$["local-user-mute-audio"](a$),t$({type:"local-user-mute-audio",value:[o$===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled]})})},function(){t$({type:"local-user-mute-audio",value:[o$]})});if(c$&&c$.then)return c$.then(function(){})}}();if(s$&&s$.then)return s$.then(function(){})}}();return Promise.resolve(i$&&i$.then?i$.then(function(){}):void 0)}catch(o$){return Promise.reject(o$)}};function LocalAudioMute(){var e$=reactExports.useContext(PropsContext),t$=e$.styleProps,r$=e$.callbacks,n$=t$||{},i$=n$.localBtnStyles,o$=i$||{},s$=o$.muteLocalAudio,a$=reactExports.useContext(RtcContext),c$=a$.dispatch,u$=a$.localAudioTrack,l$=reactExports.useContext(LocalContext);return React.createElement("div",null,React.createElement(BtnTemplate,{style:s$,name:l$.hasAudio===ToggleState.enabled?"mic":"micOff",onClick:function(){return u$&&muteAudio(l$,c$,u$,r$)}}))}function Screenshare(){var e$=reactExports.useContext(PropsContext),t$=e$.styleProps,r$=t$||{},n$=r$.localBtnStyles,i$=n$||{},o$=i$.screenshare,s$=reactExports.useContext(RtcContext),a$=s$.toggleScreensharing,c$=s$.isScreensharing;return React.createElement("div",null,React.createElement(BtnTemplate,{style:o$,name:c$?"stop":"screen",onClick:function(){return a$()}}))}var muteVideo=function(e$,t$,r$,n$){try{var i$=function(){if(e$.uid===0){var o$=e$.hasVideo,s$=function(){if(o$===ToggleState.enabled||o$===ToggleState.disabled){var a$=o$===ToggleState.enabled?ToggleState.disabling:ToggleState.enabling;t$({type:"local-user-mute-video",value:[a$]}),n$&&n$["local-user-mute-video"]&&n$["local-user-mute-video"](a$);var c$=_catch(function(){return Promise.resolve(r$==null?void 0:r$.setEnabled(o$!==ToggleState.enabled)).then(function(){a$=o$===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled,n$&&n$["local-user-mute-video"]&&n$["local-user-mute-video"](a$),t$({type:"local-user-mute-video",value:[a$]})})},function(){t$({type:"local-user-mute-video",value:[o$]})});if(c$&&c$.then)return c$.then(function(){})}}();if(s$&&s$.then)return s$.then(function(){})}}();return Promise.resolve(i$&&i$.then?i$.then(function(){}):void 0)}catch(o$){return Promise.reject(o$)}};function LocalVideoMute(){var e$=reactExports.useContext(PropsContext),t$=e$.styleProps,r$=e$.callbacks,n$=t$||{},i$=n$.localBtnStyles,o$=i$||{},s$=o$.muteLocalVideo,a$=reactExports.useContext(RtcContext),c$=a$.dispatch,u$=a$.localVideoTrack,l$=reactExports.useContext(LocalContext);return React.createElement("div",null,React.createElement(BtnTemplate,{style:s$,name:l$.hasVideo===ToggleState.enabled?"videocam":"videocamOff",onClick:function(){return u$&&muteVideo(l$,c$,u$,r$)}}))}function LocalControls(){var e$=reactExports.useContext(PropsContext),t$=e$.styleProps,r$=e$.rtcProps,n$=t$||{},i$=n$.localBtnContainer;return React.createElement("div",{style:_extends({},{backgroundColor:"#007bff",width:"100%",height:70,zIndex:10,display:"flex",flexDirection:"row",justifyContent:"space-evenly",alignItems:"center"},i$)},r$.role!=="audience"&&React.createElement(LocalVideoMute,null),r$.role!=="audience"&&React.createElement(LocalAudioMute,null),r$.role!=="audience"&&r$.enableScreensharing&&React.createElement(Screenshare,null),React.createElement(EndCall,null))}var rtmStatusEnum;(function(e$){e$[e$.initFailed=0]="initFailed",e$[e$.offline=1]="offline",e$[e$.initialising=2]="initialising",e$[e$.loggingIn=3]="loggingIn",e$[e$.loggedIn=4]="loggedIn",e$[e$.connected=5]="connected",e$[e$.loginFailed=6]="loginFailed"})(rtmStatusEnum||(rtmStatusEnum={}));var clientRoleRaw;(function(e$){e$[e$.broadcaster=0]="broadcaster",e$[e$.audience=1]="audience"})(clientRoleRaw||(clientRoleRaw={}));var mutingDevice;(function(e$){e$[e$.camera=0]="camera",e$[e$.microphone=1]="microphone"})(mutingDevice||(mutingDevice={}));var popUpStateEnum;(function(e$){e$[e$.closed=0]="closed",e$[e$.muteMic=1]="muteMic",e$[e$.muteCamera=2]="muteCamera",e$[e$.unmuteMic=3]="unmuteMic",e$[e$.unmuteCamera=4]="unmuteCamera"})(popUpStateEnum||(popUpStateEnum={}));var RtmContext=reactExports.createContext(null),RtmProvider=RtmContext.Provider;RtmContext.Consumer;function RemoteVideoMute(e$){var t$=reactExports.useContext(PropsContext),r$=t$.styleProps,n$=reactExports.useContext(RtmContext),i$=n$.sendMuteRequest,o$=n$.uidMap,s$=r$||{},a$=s$.remoteBtnStyles,c$=a$||{},u$=c$.muteRemoteVideo,l$=e$.UIKitUser,d$=l$.hasVideo===remoteTrackState.no;return l$.uid!==0&&o$[l$.uid]?React.createElement("div",null,React.createElement(BtnTemplate,{name:l$.hasVideo===remoteTrackState.subbed?"videocam":"videocamOff",style:u$,onClick:function(){return i$(mutingDevice.camera,l$.uid,!d$)}})):null}function RemoteAudioMute(e$){var t$=reactExports.useContext(PropsContext),r$=t$.styleProps,n$=r$||{},i$=n$.remoteBtnStyles,o$=reactExports.useContext(RtmContext),s$=o$.sendMuteRequest,a$=o$.uidMap,c$=i$||{},u$=c$.muteRemoteAudio,l$=e$.UIKitUser,d$=l$.hasAudio===remoteTrackState.no;return l$.uid!==0&&a$[l$.uid]?React.createElement("div",null,React.createElement(BtnTemplate,{style:u$,name:l$.hasAudio===remoteTrackState.subbed?"mic":"micOff",onClick:function(){return s$(mutingDevice.microphone,l$.uid,!d$)}})):null}function SwapUser(e$){var t$=reactExports.useContext(RtcContext),r$=t$.dispatch,n$=e$.UIKitUser;return React.createElement("div",null,React.createElement(BtnTemplate,{name:"remoteSwap",onClick:function(){return r$({type:"user-swap",value:[n$]})}}))}var VideoPlaceholder=function e$(t$){var r$=reactExports.useContext(PropsContext),n$=r$.styleProps,i$=r$.rtcProps,o$=n$||{},s$=o$.maxViewStyles,a$=o$.maxViewOverlayContainer,c$=t$.user,u$=i$.CustomVideoPlaceholder;return u$?u$&&u$(_extends({},t$),null):React.createElement("div",{key:c$.uid,style:_extends({},style.max,s$)},React.createElement("div",{style:style.imgContainer},React.createElement("img",{style:style.img,src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItdXNlciI+PHBhdGggZD0iTTIwIDIxdi0yYTQgNCAwIDAgMC00LTRIOGE0IDQgMCAwIDAtNCA0djIiPjwvcGF0aD48Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiPjwvY2lyY2xlPjwvc3ZnPg=="})),t$.isShown&&React.createElement("div",{style:_extends({},style.btnContainer,a$)},t$.showButtons&&React.createElement(React.Fragment,null,!i$.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:c$}),!i$.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:c$}),t$.showSwap&&React.createElement(SwapUser,{UIKitUser:c$}))))},style={max:{flex:1,display:"flex",backgroundColor:"#007bff33",flexDirection:"row",position:"relative"},imgContainer:{flex:10,display:"flex",justifyContent:"center"},img:{width:100,height:100,position:"absolute",alignSelf:"center",justifySelf:"center",margin:"auto",display:"flex"},btnContainer:{position:"absolute",margin:5,flexDirection:"column",display:"flex"}},Username=function e$(t$){var r$=reactExports.useContext(RtmContext),n$=r$.usernames,i$=reactExports.useContext(PropsContext),o$=i$.rtmProps,s$=i$.styleProps,a$=t$.user;return o$!=null&&o$.displayUsername?React.createElement("p",{style:_extends({},styles.username,s$==null?void 0:s$.usernameText)},a$.uid===1?"Screenshare":n$[a$.uid]):React.createElement(React.Fragment,null)},styles={username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},MaxVideoView=function e$(t$){var r$=reactExports.useContext(RtcContext),n$=r$.mediaStore,i$=reactExports.useContext(PropsContext),o$=i$.styleProps,s$=i$.rtcProps,a$=o$||{},c$=a$.maxViewStyles,u$=a$.videoMode,l$=a$.maxViewOverlayContainer,d$=u$==null?void 0:u$.max,h$=reactExports.useState(!1),p$=h$[0],_$=h$[1],f$=t$.user;return React.createElement("div",{style:_extends({},styles$1.container,t$.style,c$),onMouseEnter:function(){return _$(!0)},onMouseLeave:function(){return _$(!1)}},f$.hasVideo===1?React.createElement("div",{style:styles$1.videoContainer},!s$.disableRtm&&React.createElement(Username,{user:f$}),React.createElement(AgoraVideoPlayer,{style:styles$1.videoplayer,config:{fit:d$||"cover"},videoTrack:n$[f$.uid].videoTrack}),p$&&React.createElement("div",{style:_extends({},styles$1.overlay,l$)},!s$.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:f$}),!s$.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:f$}))):React.createElement("div",{style:styles$1.videoContainer},!s$.disableRtm&&React.createElement(Username,{user:f$}),React.createElement(VideoPlaceholder,{user:f$,isShown:p$,showButtons:!0})))},styles$1={container:{display:"flex",flex:1},videoContainer:{display:"flex",flex:1,position:"relative"},videoplayer:{width:"100%",display:"flex",flex:1},overlay:{position:"absolute",margin:5,flexDirection:"column",display:"flex"},username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},MinVideoView=function e$(t$){var r$=reactExports.useContext(RtcContext),n$=r$.mediaStore,i$=reactExports.useContext(PropsContext),o$=i$.styleProps,s$=i$.rtcProps,a$=o$||{},c$=a$.minViewStyles,u$=a$.videoMode,l$=a$.minViewOverlayContainer,d$=u$==null?void 0:u$.min,h$=reactExports.useState(!1),p$=h$[0],_$=h$[1],f$=t$.user;return React.createElement("div",{style:_extends({},{display:"flex",flex:1},c$),onMouseEnter:function(){return _$(!0)},onMouseLeave:function(){return _$(!1)}},f$.hasVideo===1?React.createElement("div",{style:_extends({},{display:"flex",flex:1,position:"relative"})},React.createElement(AgoraVideoPlayer,{style:{flex:10,display:"flex"},config:{fit:d$!==void 0?d$:"cover"},videoTrack:n$[f$.uid].videoTrack}),p$&&React.createElement("div",{style:_extends({},{margin:4,position:"absolute",flex:1,display:"flex",flexDirection:"column"},l$)},!s$.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:f$}),!s$.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:f$}),React.createElement(SwapUser,{UIKitUser:f$}))):React.createElement(VideoPlaceholder,{user:f$,isShown:p$,showButtons:!0,showSwap:!0}))},styles$2={test:"_3ybTi",scrollbar:"_3Sxu7"},PinnedVideo=function e$(){var t$=reactExports.useContext(PropsContext),r$=t$.styleProps,n$=t$.rtcProps,i$=r$||{},o$=i$.minViewContainer,s$=i$.pinnedVideoContainer,a$=i$.maxViewContainer,c$=i$.scrollViewContainer,u$=reactExports.useRef(null),l$=reactExports.useState(0),d$=l$[0],h$=l$[1],p$=reactExports.useState(0),_$=p$[0],f$=p$[1],m$=d$>_$;return reactExports.useEffect(function(){var g$=function(){u$.current&&(h$(u$.current.offsetWidth),f$(u$.current.offsetHeight))};return window.addEventListener("resize",g$),u$.current&&(h$(u$.current.offsetWidth),f$(u$.current.offsetHeight)),function(){window.removeEventListener("resize",g$)}},[]),React.createElement("div",{ref:u$,style:_extends({},{display:"flex",flex:1,flexDirection:m$?"row":"column-reverse",overflow:"hidden"},s$)},React.createElement("div",{style:_extends({},{display:"flex",flex:m$?5:4},a$)},React.createElement(MaxUidConsumer,null,function(g$){return n$.role==="audience"&&g$[0].uid===0?null:React.createElement(MaxVideoView,{user:g$[0]})})),React.createElement("div",{className:styles$2.scrollbar,style:_extends({},{overflowY:m$?"scroll":"hidden",overflowX:m$?"hidden":"scroll",display:"flex",flex:1,flexDirection:m$?"column":"row"},c$)},React.createElement(MinUidConsumer,null,function(g$){return g$.map(function(v$){return n$.role==="audience"&&v$.uid===0?null:React.createElement("div",{style:_extends({},{minHeight:m$?"35vh":"99%",minWidth:m$?"99%":"40vw",margin:2,display:"flex"},o$),key:v$.uid},React.createElement(MinVideoView,{user:v$}))})})))},GridVideo=function e$(){var t$=reactExports.useContext(PropsContext),r$=t$.styleProps,n$=t$.rtcProps,i$=r$||{},o$=i$.gridVideoCells,s$=i$.gridVideoContainer,a$=reactExports.useContext(MaxUidContext),c$=reactExports.useContext(MinUidContext),u$=n$.role==="audience"?[].concat(a$,c$).filter(function(y$){return y$.uid!==0}):[].concat(a$,c$),l$=reactExports.useRef(null),d$=reactExports.useState(window.innerWidth),h$=d$[0],p$=d$[1],_$=reactExports.useState(window.innerHeight),f$=_$[0],m$=_$[1],g$=h$>f$,v$="minmax(0, 1fr) ";return reactExports.useEffect(function(){var y$=function(){l$.current&&(p$(l$.current.offsetWidth),m$(l$.current.offsetHeight))};return window.addEventListener("resize",y$),l$.current&&(p$(l$.current.offsetWidth),m$(l$.current.offsetHeight)),function(){window.removeEventListener("resize",y$)}},[]),React.createElement("div",{ref:l$,style:_extends({},{width:"100%",height:"100%",display:"grid",gridTemplateColumns:g$?u$.length>9?v$.repeat(4):u$.length>4?v$.repeat(3):u$.length>1?v$.repeat(2):v$:u$.length>8?v$.repeat(3):u$.length>2?v$.repeat(2):v$},s$)},u$.map(function(y$){return React.createElement(MaxVideoView,{user:y$,style:_extends({},{height:"100%",width:"100%"},o$),key:y$.uid})}))},useTracks=createMicrophoneAndCameraTracks({encoderConfig:{}},{encoderConfig:{}}),TracksConfigure=function e$(t$){var r$=reactExports.useState(!1),n$=r$[0],i$=r$[1],o$=reactExports.useState(null),s$=o$[0],a$=o$[1],c$=reactExports.useState(null),u$=c$[0],l$=c$[1],d$=useTracks(),h$=d$.ready,p$=d$.tracks,_$=d$.error,f$=reactExports.useRef({});return reactExports.useEffect(function(){return p$!==null?(l$(p$[0]),a$(p$[1]),f$.current[0]={audioTrack:p$[0],videoTrack:p$[1]},i$(!0)):_$&&(console.error(_$),i$(!1)),function(){if(p$){var m$,g$;(m$=p$[0])===null||m$===void 0||m$.close(),(g$=p$[1])===null||g$===void 0||g$.close()}}},[h$,_$]),React.createElement(TracksProvider,{value:{localVideoTrack:s$,localAudioTrack:u$}},n$?t$.children:null)},timeNow=function e$(){return new Date().getTime()},useChannel=createLazyChannel(),useClient$1=createLazyClient(),RtmConfigure=function e$(t$){var r$=reactExports.useContext(PropsContext),n$=r$.rtcProps,i$=r$.rtmProps,o$=reactExports.useState(!1),s$=o$[0],a$=o$[1],c$=useClient$1(n$.appId),u$=useChannel(c$,n$.channel),l$=reactExports.useRef(""),d$=reactExports.useRef(5),h$=reactExports.useContext(LocalContext),p$=reactExports.useContext(PropsContext),_$=p$.rtmCallbacks,f$=reactExports.useState({}),m$=f$[0],g$=f$[1],v$=reactExports.useState({}),y$=v$[0],S$=v$[1],b$=reactExports.useState({}),$$=b$[0],C$=b$[1],N$=reactExports.useState(popUpStateEnum.closed),k$=N$[0],O$=N$[1],U$=reactExports.useState(rtmStatusEnum.offline),x$=U$[0],F$=U$[1],L$=reactExports.useContext(RtcContext),M$=L$.localUid,V$=L$.localAudioTrack,A$=L$.localVideoTrack,I$=L$.dispatch,P$=L$.channelJoined,w$=function Q$(){try{var Y$=n$.tokenUrl,K$=function(){if(Y$){var B$=_catch(function(){return Promise.resolve(fetch(Y$+"/rtm/"+((i$==null?void 0:i$.uid)||l$.current))).then(function(X$){return Promise.resolve(X$.json()).then(function(t0){var q$=t0.rtmToken;return Promise.resolve(c$.login({uid:(i$==null?void 0:i$.uid)||l$.current,token:q$})).then(function(){d$.current=5})})})},function(){setTimeout(function(){try{return d$.current=d$.current+d$.current,Q$(),Promise.resolve()}catch(X$){return Promise.reject(X$)}},d$.current*1e3)});if(B$&&B$.then)return B$.then(function(){})}else{var H$=_catch(function(){return Promise.resolve(c$.login({uid:(i$==null?void 0:i$.uid)||l$.current,token:(i$==null?void 0:i$.token)||void 0})).then(function(){d$.current=5})},function(){setTimeout(function(){try{return d$.current=d$.current+d$.current,Q$(),Promise.resolve()}catch(X$){return Promise.reject(X$)}},d$.current*1e3)});if(H$&&H$.then)return H$.then(function(){})}}();return Promise.resolve(K$&&K$.then?K$.then(function(){}):void 0)}catch(B$){return Promise.reject(B$)}},E$=function Q$(){try{var Y$=_catch(function(){return Promise.resolve(u$.join()).then(function(){d$.current=5})},function(){setTimeout(function(){try{return d$.current=d$.current+d$.current,Q$(),Promise.resolve()}catch(K$){return Promise.reject(K$)}},d$.current*1e3)});return Promise.resolve(Y$&&Y$.then?Y$.then(function(){}):void 0)}catch(K$){return Promise.reject(K$)}},T$=function(){try{if(F$(rtmStatusEnum.initialising),n$.uid?l$.current=String(n$.uid):l$.current=String(timeNow()),c$.on("ConnectionStateChanged",function(B$,H$){console.log(B$,H$)}),c$.on("TokenExpired",function(){try{var B$=n$.tokenUrl;console.log("token expired - renewing");var H$=function(){if(B$){var X$=_catch(function(){return Promise.resolve(fetch(B$+"/rtm/"+((i$==null?void 0:i$.uid)||l$.current))).then(function(t0){return Promise.resolve(t0.json()).then(function(q$){var W$=q$.rtmToken;return Promise.resolve(c$.renewToken(W$)).then(function(){d$.current=5})})})},function(t0){console.error("TokenExpiredError",t0)});if(X$&&X$.then)return X$.then(function(){})}}();return Promise.resolve(H$&&H$.then?H$.then(function(){}):void 0)}catch(X$){return Promise.reject(X$)}}),c$.on("MessageFromPeer",function(B$,H$){j$(B$,H$)}),u$.on("ChannelMessage",function(B$,H$){j$(B$,H$)}),u$.on("MemberJoined",function(B$){try{return Promise.resolve(s5(R$(),B$)).then(function(){})}catch(H$){return Promise.reject(H$)}}),u$.on("MemberCountUpdated",function(B$){try{return console.log("RTM-MemberCountUpdated: ",B$),Promise.resolve()}catch(H$){return Promise.reject(H$)}}),_$!=null&&_$.channel?Object.keys(_$.channel).map(function(B$){_$.channel&&u$.on(B$,_$.channel[B$])}):_$!=null&&_$.client&&Object.keys(_$.client).map(function(B$){_$.client&&c$.on(B$,_$.client[B$])}),n$.tokenUrl){var Y$=n$.tokenUrl,K$=n$.uid;c$.on("TokenExpired",function(){try{return console.log("token expired"),Promise.resolve(fetch(Y$+"/rtm/"+(K$||0)+"/")).then(function(B$){return Promise.resolve(B$.json()).then(function(H$){var X$=H$.rtmToken;c$.renewToken(X$)})})}catch(B$){return Promise.reject(B$)}})}return F$(rtmStatusEnum.loggingIn),Promise.resolve(w$()).then(function(){return F$(rtmStatusEnum.loggedIn),Promise.resolve(E$()).then(function(){F$(rtmStatusEnum.connected),S$(function(B$){return _extends({},B$,{0:i$==null?void 0:i$.username})}),a5(R$())})})}catch(B$){return Promise.reject(B$)}},R$=function(){return{messageType:"UserData",rtmId:(i$==null?void 0:i$.uid)||l$.current,rtcId:M$.current,username:i$==null?void 0:i$.username,role:n$.role==="audience"?1:0,uikit:{platform:"web",framework:"react",version:"1.2.0"},agora:{rtm:AgoraRTM__default.VERSION,rtc:nq.VERSION}}},D$=function(Y$,K$,B$){var H$=(i$==null?void 0:i$.showPopUpBeforeRemoteMute)===!1,X$={messageType:"MuteRequest",device:Y$,rtcId:K$,mute:B$,isForceful:H$},t0=m$[K$];H$&&!B$?console.log("cannot send force unmute request"):t0?s5(X$,t0):console.log("peer not found")},j$=function(Y$,K$){var B$;if(Y$.messageType==="RAW"?B$=parsePayload(Y$.rawMessage):Y$.messageType==="TEXT"&&(B$=JSON.parse(Y$.text)),console.log(B$,K$),B$)switch(B$.messageType){case"UserData":G$(B$);break;case"MuteRequest":z$(B$);break;case"RtmDataRequest":switch(B$.type){case"ping":J$(K$);break;case"userData":t5(K$);break;default:console.log(K$)}break;default:console.log("unknown message content")}else console.log("unknown rtm message type")},G$=function(Y$){g$(function(K$){var B$;return _extends({},K$,(B$={},B$[Y$.rtcId]=Y$.rtmId,B$))}),S$(function(K$){var B$;return _extends({},K$,(B$={},B$[Y$.rtcId]=Y$.username,B$))}),C$(function(K$){var B$;return _extends({},K$,(B$={},B$[Y$.rtmId]=Y$,B$))})},z$=function(Y$){M$.current===Y$.rtcId&&(Y$.isForceful?Y$.mute?Y$.device===mutingDevice.microphone?V$&&muteAudio(h$,I$,V$):Y$.device===mutingDevice.camera&&A$&&muteVideo(h$,I$,A$):console.error("cannot force unmute"):Y$.device===mutingDevice.microphone?Y$.mute?O$(popUpStateEnum.muteMic):O$(popUpStateEnum.unmuteMic):Y$.device===mutingDevice.camera&&(Y$.mute?O$(popUpStateEnum.muteCamera):O$(popUpStateEnum.unmuteCamera)))},J$=function(Y$){s5({messageType:"RtmDataRequest",type:"pong"},Y$)},t5=function(Y$){s5(R$(),Y$)},a5=function(Y$){try{var K$=c$.createMessage({text:JSON.stringify(Y$),messageType:AgoraRTM__default.MessageType.TEXT}),B$=_catch(function(){return Promise.resolve(u$.sendMessage(K$)).then(function(){})},function(H$){console.error(H$)});return Promise.resolve(B$&&B$.then?B$.then(function(){}):void 0)}catch(H$){return Promise.reject(H$)}},s5=function(Y$,K$){try{var B$=c$.createMessage({text:JSON.stringify(Y$),messageType:AgoraRTM__default.MessageType.TEXT}),H$=_catch(function(){return Promise.resolve(c$.sendMessageToPeer(B$,String(K$))).then(function(){})},function(X$){console.error(X$)});return Promise.resolve(H$&&H$.then?H$.then(function(){}):void 0)}catch(X$){return Promise.reject(X$)}},t3=function(){try{return Promise.resolve(c$.logout()).then(function(){return Promise.resolve(c$.removeAllListeners()).then(function(){})})}catch(Y$){return Promise.reject(Y$)}};return reactExports.useEffect(function(){return P$&&(T$(),a$(!0)),function(){P$&&t3()}},[n$.channel,n$.appId,P$]),React.createElement(RtmProvider,{value:{rtmStatus:x$,sendPeerMessage:s5,sendChannelMessage:a5,sendMuteRequest:D$,rtmClient:c$,uidMap:m$,usernames:y$,userDataMap:$$,popUpState:k$,setPopUpState:O$}},s$?t$.children:React.createElement(React.Fragment,null))};new TextEncoder;var dec=new TextDecoder,parsePayload=function e$(t$){return JSON.parse(dec.decode(t$))};function PopUp(){var e$=reactExports.useContext(PropsContext),t$=e$.styleProps,r$=reactExports.useContext(RtmContext),n$=r$.popUpState,i$=r$.setPopUpState,o$=t$||{},s$=o$.popUpContainer,a$=reactExports.useContext(RtcContext),c$=a$.dispatch,u$=a$.localVideoTrack,l$=a$.localAudioTrack,d$=reactExports.useContext(LocalContext);return n$!==popUpStateEnum.closed?React.createElement("div",{style:_extends({},styles$3.container,s$)},React.createElement("div",{style:{color:"#fff",fontSize:18,fontWeight:700}},n$===popUpStateEnum.muteCamera||n$===popUpStateEnum.muteMic?"Mute ":"Unmute ",n$===popUpStateEnum.muteCamera||n$===popUpStateEnum.unmuteCamera?"Camera":"Mic","?"),React.createElement("div",{style:{flexDirection:"row",display:"flex",width:"100%",justifyContent:"space-around"}},React.createElement("div",{onClick:function(){switch(n$){case popUpStateEnum.muteCamera:d$.hasVideo&&u$&&muteVideo(d$,c$,u$);break;case popUpStateEnum.muteMic:d$.hasAudio&&l$&&muteAudio(d$,c$,l$);break;case popUpStateEnum.unmuteCamera:!d$.hasVideo&&u$&&muteVideo(d$,c$,u$);break;case popUpStateEnum.unmuteMic:!d$.hasAudio&&l$&&muteAudio(d$,c$,l$);break}i$(popUpStateEnum.closed)},style:styles$3.button},"Confirm"),React.createElement("div",{style:styles$3.buttonClose,onClick:function(){return i$(popUpStateEnum.closed)}},"Close"))):null}var styles$3={button:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},buttonClose:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},container:{backgroundColor:"#007bffaa",position:"absolute",width:240,height:80,top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center"}},AgoraUIKit=function e$(t$){var r$=t$.styleProps,n$=t$.rtcProps,i$=r$||{},o$=i$.UIKitContainer;return React.createElement(PropsProvider,{value:t$},React.createElement("div",{style:_extends({},style$1,o$)},n$.role==="audience"?React.createElement(VideocallUI,null):React.createElement(TracksConfigure,null,React.createElement(VideocallUI,null))))},VideocallUI=function e$(){var t$=reactExports.useContext(PropsContext),r$=t$.rtcProps;return React.createElement(RtcConfigure,{callActive:r$.callActive},React.createElement(LocalUserContext,null,r$.disableRtm?React.createElement(React.Fragment,null,(r$==null?void 0:r$.layout)===layout.grid?React.createElement(GridVideo,null):React.createElement(PinnedVideo,null),React.createElement(LocalControls,null)):React.createElement(RtmConfigure,null,React.createElement(PopUp,null),(r$==null?void 0:r$.layout)===layout.grid?React.createElement(GridVideo,null):React.createElement(PinnedVideo,null),React.createElement(LocalControls,null))))},style$1={display:"flex",flex:1,minHeight:0,flexDirection:"column"};function bind(e$,t$){return function(){return e$.apply(t$,arguments)}}const{toString}=Object.prototype,{getPrototypeOf}=Object,kindOf=(e$=>t$=>{const r$=toString.call(t$);return e$[r$]||(e$[r$]=r$.slice(8,-1).toLowerCase())})(Object.create(null)),kindOfTest=e$=>(e$=e$.toLowerCase(),t$=>kindOf(t$)===e$),typeOfTest=e$=>t$=>typeof t$===e$,{isArray}=Array,isUndefined=typeOfTest("undefined");function isBuffer(e$){return e$!==null&&!isUndefined(e$)&&e$.constructor!==null&&!isUndefined(e$.constructor)&&isFunction(e$.constructor.isBuffer)&&e$.constructor.isBuffer(e$)}const isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(e$){let t$;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t$=ArrayBuffer.isView(e$):t$=e$&&e$.buffer&&isArrayBuffer(e$.buffer),t$}const isString=typeOfTest("string"),isFunction=typeOfTest("function"),isNumber=typeOfTest("number"),isObject=e$=>e$!==null&&typeof e$=="object",isBoolean=e$=>e$===!0||e$===!1,isPlainObject=e$=>{if(kindOf(e$)!=="object")return!1;const t$=getPrototypeOf(e$);return(t$===null||t$===Object.prototype||Object.getPrototypeOf(t$)===null)&&!(Symbol.toStringTag in e$)&&!(Symbol.iterator in e$)},isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isStream=e$=>isObject(e$)&&isFunction(e$.pipe),isFormData=e$=>{let t$;return e$&&(typeof FormData=="function"&&e$ instanceof FormData||isFunction(e$.append)&&((t$=kindOf(e$))==="formdata"||t$==="object"&&isFunction(e$.toString)&&e$.toString()==="[object FormData]"))},isURLSearchParams=kindOfTest("URLSearchParams"),[isReadableStream,isRequest,isResponse,isHeaders]=["ReadableStream","Request","Response","Headers"].map(kindOfTest),trim=e$=>e$.trim?e$.trim():e$.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function forEach(e$,t$,{allOwnKeys:r$=!1}={}){if(e$===null||typeof e$>"u")return;let n$,i$;if(typeof e$!="object"&&(e$=[e$]),isArray(e$))for(n$=0,i$=e$.length;n$<i$;n$++)t$.call(null,e$[n$],n$,e$);else{const o$=r$?Object.getOwnPropertyNames(e$):Object.keys(e$),s$=o$.length;let a$;for(n$=0;n$<s$;n$++)a$=o$[n$],t$.call(null,e$[a$],a$,e$)}}function findKey(e$,t$){t$=t$.toLowerCase();const r$=Object.keys(e$);let n$=r$.length,i$;for(;n$-- >0;)if(i$=r$[n$],t$===i$.toLowerCase())return i$;return null}const _global=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,isContextDefined=e$=>!isUndefined(e$)&&e$!==_global;function merge(){const{caseless:e$}=isContextDefined(this)&&this||{},t$={},r$=(n$,i$)=>{const o$=e$&&findKey(t$,i$)||i$;isPlainObject(t$[o$])&&isPlainObject(n$)?t$[o$]=merge(t$[o$],n$):isPlainObject(n$)?t$[o$]=merge({},n$):isArray(n$)?t$[o$]=n$.slice():t$[o$]=n$};for(let n$=0,i$=arguments.length;n$<i$;n$++)arguments[n$]&&forEach(arguments[n$],r$);return t$}const extend=(e$,t$,r$,{allOwnKeys:n$}={})=>(forEach(t$,(i$,o$)=>{r$&&isFunction(i$)?e$[o$]=bind(i$,r$):e$[o$]=i$},{allOwnKeys:n$}),e$),stripBOM=e$=>(e$.charCodeAt(0)===65279&&(e$=e$.slice(1)),e$),inherits=(e$,t$,r$,n$)=>{e$.prototype=Object.create(t$.prototype,n$),e$.prototype.constructor=e$,Object.defineProperty(e$,"super",{value:t$.prototype}),r$&&Object.assign(e$.prototype,r$)},toFlatObject=(e$,t$,r$,n$)=>{let i$,o$,s$;const a$={};if(t$=t$||{},e$==null)return t$;do{for(i$=Object.getOwnPropertyNames(e$),o$=i$.length;o$-- >0;)s$=i$[o$],(!n$||n$(s$,e$,t$))&&!a$[s$]&&(t$[s$]=e$[s$],a$[s$]=!0);e$=r$!==!1&&getPrototypeOf(e$)}while(e$&&(!r$||r$(e$,t$))&&e$!==Object.prototype);return t$},endsWith=(e$,t$,r$)=>{e$=String(e$),(r$===void 0||r$>e$.length)&&(r$=e$.length),r$-=t$.length;const n$=e$.indexOf(t$,r$);return n$!==-1&&n$===r$},toArray=e$=>{if(!e$)return null;if(isArray(e$))return e$;let t$=e$.length;if(!isNumber(t$))return null;const r$=new Array(t$);for(;t$-- >0;)r$[t$]=e$[t$];return r$},isTypedArray=(e$=>t$=>e$&&t$ instanceof e$)(typeof Uint8Array<"u"&&getPrototypeOf(Uint8Array)),forEachEntry=(e$,t$)=>{const n$=(e$&&e$[Symbol.iterator]).call(e$);let i$;for(;(i$=n$.next())&&!i$.done;){const o$=i$.value;t$.call(e$,o$[0],o$[1])}},matchAll=(e$,t$)=>{let r$;const n$=[];for(;(r$=e$.exec(t$))!==null;)n$.push(r$);return n$},isHTMLForm=kindOfTest("HTMLFormElement"),toCamelCase=e$=>e$.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r$,n$,i$){return n$.toUpperCase()+i$}),hasOwnProperty=(({hasOwnProperty:e$})=>(t$,r$)=>e$.call(t$,r$))(Object.prototype),isRegExp=kindOfTest("RegExp"),reduceDescriptors=(e$,t$)=>{const r$=Object.getOwnPropertyDescriptors(e$),n$={};forEach(r$,(i$,o$)=>{let s$;(s$=t$(i$,o$,e$))!==!1&&(n$[o$]=s$||i$)}),Object.defineProperties(e$,n$)},freezeMethods=e$=>{reduceDescriptors(e$,(t$,r$)=>{if(isFunction(e$)&&["arguments","caller","callee"].indexOf(r$)!==-1)return!1;const n$=e$[r$];if(isFunction(n$)){if(t$.enumerable=!1,"writable"in t$){t$.writable=!1;return}t$.set||(t$.set=()=>{throw Error("Can not rewrite read-only method '"+r$+"'")})}})},toObjectSet=(e$,t$)=>{const r$={},n$=i$=>{i$.forEach(o$=>{r$[o$]=!0})};return isArray(e$)?n$(e$):n$(String(e$).split(t$)),r$},noop=()=>{},toFiniteNumber=(e$,t$)=>e$!=null&&Number.isFinite(e$=+e$)?e$:t$,ALPHA="abcdefghijklmnopqrstuvwxyz",DIGIT="0123456789",ALPHABET={DIGIT,ALPHA,ALPHA_DIGIT:ALPHA+ALPHA.toUpperCase()+DIGIT},generateString=(e$=16,t$=ALPHABET.ALPHA_DIGIT)=>{let r$="";const{length:n$}=t$;for(;e$--;)r$+=t$[Math.random()*n$|0];return r$};function isSpecCompliantForm(e$){return!!(e$&&isFunction(e$.append)&&e$[Symbol.toStringTag]==="FormData"&&e$[Symbol.iterator])}const toJSONObject=e$=>{const t$=new Array(10),r$=(n$,i$)=>{if(isObject(n$)){if(t$.indexOf(n$)>=0)return;if(!("toJSON"in n$)){t$[i$]=n$;const o$=isArray(n$)?[]:{};return forEach(n$,(s$,a$)=>{const c$=r$(s$,i$+1);!isUndefined(c$)&&(o$[a$]=c$)}),t$[i$]=void 0,o$}}return n$};return r$(e$,0)},isAsyncFn=kindOfTest("AsyncFunction"),isThenable=e$=>e$&&(isObject(e$)||isFunction(e$))&&isFunction(e$.then)&&isFunction(e$.catch),_setImmediate=((e$,t$)=>e$?setImmediate:t$?((r$,n$)=>(_global.addEventListener("message",({source:i$,data:o$})=>{i$===_global&&o$===r$&&n$.length&&n$.shift()()},!1),i$=>{n$.push(i$),_global.postMessage(r$,"*")}))(`axios@${Math.random()}`,[]):r$=>setTimeout(r$))(typeof setImmediate=="function",isFunction(_global.postMessage)),asap=typeof queueMicrotask<"u"?queueMicrotask.bind(_global):typeof process<"u"&&process.nextTick||_setImmediate,utils$1={isArray,isArrayBuffer,isBuffer,isFormData,isArrayBufferView,isString,isNumber,isBoolean,isObject,isPlainObject,isReadableStream,isRequest,isResponse,isHeaders,isUndefined,isDate,isFile,isBlob,isRegExp,isFunction,isStream,isURLSearchParams,isTypedArray,isFileList,forEach,merge,extend,trim,stripBOM,inherits,toFlatObject,kindOf,kindOfTest,endsWith,toArray,forEachEntry,matchAll,isHTMLForm,hasOwnProperty,hasOwnProp:hasOwnProperty,reduceDescriptors,freezeMethods,toObjectSet,toCamelCase,noop,toFiniteNumber,findKey,global:_global,isContextDefined,ALPHABET,generateString,isSpecCompliantForm,toJSONObject,isAsyncFn,isThenable,setImmediate:_setImmediate,asap};function AxiosError(e$,t$,r$,n$,i$){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e$,this.name="AxiosError",t$&&(this.code=t$),r$&&(this.config=r$),n$&&(this.request=n$),i$&&(this.response=i$,this.status=i$.status?i$.status:null)}utils$1.inherits(AxiosError,Error,{toJSON:function e$(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils$1.toJSONObject(this.config),code:this.code,status:this.status}}});const prototype$1=AxiosError.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e$=>{descriptors[e$]={value:e$}});Object.defineProperties(AxiosError,descriptors);Object.defineProperty(prototype$1,"isAxiosError",{value:!0});AxiosError.from=(e$,t$,r$,n$,i$,o$)=>{const s$=Object.create(prototype$1);return utils$1.toFlatObject(e$,s$,function(c$){return c$!==Error.prototype},a$=>a$!=="isAxiosError"),AxiosError.call(s$,e$.message,t$,r$,n$,i$),s$.cause=e$,s$.name=e$.name,o$&&Object.assign(s$,o$),s$};const httpAdapter=null;function isVisitable(e$){return utils$1.isPlainObject(e$)||utils$1.isArray(e$)}function removeBrackets(e$){return utils$1.endsWith(e$,"[]")?e$.slice(0,-2):e$}function renderKey(e$,t$,r$){return e$?e$.concat(t$).map(function(i$,o$){return i$=removeBrackets(i$),!r$&&o$?"["+i$+"]":i$}).join(r$?".":""):t$}function isFlatArray(e$){return utils$1.isArray(e$)&&!e$.some(isVisitable)}const predicates=utils$1.toFlatObject(utils$1,{},null,function e$(t$){return/^is[A-Z]/.test(t$)});function toFormData(e$,t$,r$){if(!utils$1.isObject(e$))throw new TypeError("target must be an object");t$=t$||new FormData,r$=utils$1.toFlatObject(r$,{metaTokens:!0,dots:!1,indexes:!1},!1,function(f$,m$){return!utils$1.isUndefined(m$[f$])});const n$=r$.metaTokens,i$=r$.visitor||l$,o$=r$.dots,s$=r$.indexes,c$=(r$.Blob||typeof Blob<"u"&&Blob)&&utils$1.isSpecCompliantForm(t$);if(!utils$1.isFunction(i$))throw new TypeError("visitor must be a function");function u$(_$){if(_$===null)return"";if(utils$1.isDate(_$))return _$.toISOString();if(!c$&&utils$1.isBlob(_$))throw new AxiosError("Blob is not supported. Use a Buffer instead.");return utils$1.isArrayBuffer(_$)||utils$1.isTypedArray(_$)?c$&&typeof Blob=="function"?new Blob([_$]):Buffer.from(_$):_$}function l$(_$,f$,m$){let g$=_$;if(_$&&!m$&&typeof _$=="object"){if(utils$1.endsWith(f$,"{}"))f$=n$?f$:f$.slice(0,-2),_$=JSON.stringify(_$);else if(utils$1.isArray(_$)&&isFlatArray(_$)||(utils$1.isFileList(_$)||utils$1.endsWith(f$,"[]"))&&(g$=utils$1.toArray(_$)))return f$=removeBrackets(f$),g$.forEach(function(y$,S$){!(utils$1.isUndefined(y$)||y$===null)&&t$.append(s$===!0?renderKey([f$],S$,o$):s$===null?f$:f$+"[]",u$(y$))}),!1}return isVisitable(_$)?!0:(t$.append(renderKey(m$,f$,o$),u$(_$)),!1)}const d$=[],h$=Object.assign(predicates,{defaultVisitor:l$,convertValue:u$,isVisitable});function p$(_$,f$){if(!utils$1.isUndefined(_$)){if(d$.indexOf(_$)!==-1)throw Error("Circular reference detected in "+f$.join("."));d$.push(_$),utils$1.forEach(_$,function(g$,v$){(!(utils$1.isUndefined(g$)||g$===null)&&i$.call(t$,g$,utils$1.isString(v$)?v$.trim():v$,f$,h$))===!0&&p$(g$,f$?f$.concat(v$):[v$])}),d$.pop()}}if(!utils$1.isObject(e$))throw new TypeError("data must be an object");return p$(e$),t$}function encode$1(e$){const t$={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e$).replace(/[!'()~]|%20|%00/g,function(n$){return t$[n$]})}function AxiosURLSearchParams(e$,t$){this._pairs=[],e$&&toFormData(e$,this,t$)}const prototype=AxiosURLSearchParams.prototype;prototype.append=function e$(t$,r$){this._pairs.push([t$,r$])};prototype.toString=function e$(t$){const r$=t$?function(n$){return t$.call(this,n$,encode$1)}:encode$1;return this._pairs.map(function(i$){return r$(i$[0])+"="+r$(i$[1])},"").join("&")};function encode(e$){return encodeURIComponent(e$).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function buildURL(e$,t$,r$){if(!t$)return e$;const n$=r$&&r$.encode||encode,i$=r$&&r$.serialize;let o$;if(i$?o$=i$(t$,r$):o$=utils$1.isURLSearchParams(t$)?t$.toString():new AxiosURLSearchParams(t$,r$).toString(n$),o$){const s$=e$.indexOf("#");s$!==-1&&(e$=e$.slice(0,s$)),e$+=(e$.indexOf("?")===-1?"?":"&")+o$}return e$}class InterceptorManager{constructor(){this.handlers=[]}use(t$,r$,n$){return this.handlers.push({fulfilled:t$,rejected:r$,synchronous:n$?n$.synchronous:!1,runWhen:n$?n$.runWhen:null}),this.handlers.length-1}eject(t$){this.handlers[t$]&&(this.handlers[t$]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t$){utils$1.forEach(this.handlers,function(n$){n$!==null&&t$(n$)})}}const transitionalDefaults={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},URLSearchParams$1=typeof URLSearchParams<"u"?URLSearchParams:AxiosURLSearchParams,FormData$1=typeof FormData<"u"?FormData:null,Blob$1=typeof Blob<"u"?Blob:null,platform$1={isBrowser:!0,classes:{URLSearchParams:URLSearchParams$1,FormData:FormData$1,Blob:Blob$1},protocols:["http","https","file","blob","url","data"]},hasBrowserEnv=typeof window<"u"&&typeof document<"u",_navigator=typeof navigator=="object"&&navigator||void 0,hasStandardBrowserEnv=hasBrowserEnv&&(!_navigator||["ReactNative","NativeScript","NS"].indexOf(_navigator.product)<0),hasStandardBrowserWebWorkerEnv=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",origin=hasBrowserEnv&&window.location.href||"http://localhost",utils=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv,hasStandardBrowserEnv,hasStandardBrowserWebWorkerEnv,navigator:_navigator,origin},Symbol.toStringTag,{value:"Module"})),platform={...utils,...platform$1};function toURLEncodedForm(e$,t$){return toFormData(e$,new platform.classes.URLSearchParams,Object.assign({visitor:function(r$,n$,i$,o$){return platform.isNode&&utils$1.isBuffer(r$)?(this.append(n$,r$.toString("base64")),!1):o$.defaultVisitor.apply(this,arguments)}},t$))}function parsePropPath(e$){return utils$1.matchAll(/\w+|\[(\w*)]/g,e$).map(t$=>t$[0]==="[]"?"":t$[1]||t$[0])}function arrayToObject(e$){const t$={},r$=Object.keys(e$);let n$;const i$=r$.length;let o$;for(n$=0;n$<i$;n$++)o$=r$[n$],t$[o$]=e$[o$];return t$}function formDataToJSON(e$){function t$(r$,n$,i$,o$){let s$=r$[o$++];if(s$==="__proto__")return!0;const a$=Number.isFinite(+s$),c$=o$>=r$.length;return s$=!s$&&utils$1.isArray(i$)?i$.length:s$,c$?(utils$1.hasOwnProp(i$,s$)?i$[s$]=[i$[s$],n$]:i$[s$]=n$,!a$):((!i$[s$]||!utils$1.isObject(i$[s$]))&&(i$[s$]=[]),t$(r$,n$,i$[s$],o$)&&utils$1.isArray(i$[s$])&&(i$[s$]=arrayToObject(i$[s$])),!a$)}if(utils$1.isFormData(e$)&&utils$1.isFunction(e$.entries)){const r$={};return utils$1.forEachEntry(e$,(n$,i$)=>{t$(parsePropPath(n$),i$,r$,0)}),r$}return null}function stringifySafely(e$,t$,r$){if(utils$1.isString(e$))try{return(t$||JSON.parse)(e$),utils$1.trim(e$)}catch(n$){if(n$.name!=="SyntaxError")throw n$}return(r$||JSON.stringify)(e$)}const defaults={transitional:transitionalDefaults,adapter:["xhr","http","fetch"],transformRequest:[function e$(t$,r$){const n$=r$.getContentType()||"",i$=n$.indexOf("application/json")>-1,o$=utils$1.isObject(t$);if(o$&&utils$1.isHTMLForm(t$)&&(t$=new FormData(t$)),utils$1.isFormData(t$))return i$?JSON.stringify(formDataToJSON(t$)):t$;if(utils$1.isArrayBuffer(t$)||utils$1.isBuffer(t$)||utils$1.isStream(t$)||utils$1.isFile(t$)||utils$1.isBlob(t$)||utils$1.isReadableStream(t$))return t$;if(utils$1.isArrayBufferView(t$))return t$.buffer;if(utils$1.isURLSearchParams(t$))return r$.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t$.toString();let a$;if(o$){if(n$.indexOf("application/x-www-form-urlencoded")>-1)return toURLEncodedForm(t$,this.formSerializer).toString();if((a$=utils$1.isFileList(t$))||n$.indexOf("multipart/form-data")>-1){const c$=this.env&&this.env.FormData;return toFormData(a$?{"files[]":t$}:t$,c$&&new c$,this.formSerializer)}}return o$||i$?(r$.setContentType("application/json",!1),stringifySafely(t$)):t$}],transformResponse:[function e$(t$){const r$=this.transitional||defaults.transitional,n$=r$&&r$.forcedJSONParsing,i$=this.responseType==="json";if(utils$1.isResponse(t$)||utils$1.isReadableStream(t$))return t$;if(t$&&utils$1.isString(t$)&&(n$&&!this.responseType||i$)){const s$=!(r$&&r$.silentJSONParsing)&&i$;try{return JSON.parse(t$)}catch(a$){if(s$)throw a$.name==="SyntaxError"?AxiosError.from(a$,AxiosError.ERR_BAD_RESPONSE,this,null,this.response):a$}}return t$}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function e$(t$){return t$>=200&&t$<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};utils$1.forEach(["delete","get","head","post","put","patch"],e$=>{defaults.headers[e$]={}});const ignoreDuplicateOf=utils$1.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),parseHeaders=e$=>{const t$={};let r$,n$,i$;return e$&&e$.split(`
`).forEach(function(s$){i$=s$.indexOf(":"),r$=s$.substring(0,i$).trim().toLowerCase(),n$=s$.substring(i$+1).trim(),!(!r$||t$[r$]&&ignoreDuplicateOf[r$])&&(r$==="set-cookie"?t$[r$]?t$[r$].push(n$):t$[r$]=[n$]:t$[r$]=t$[r$]?t$[r$]+", "+n$:n$)}),t$},$internals=Symbol("internals");function normalizeHeader(e$){return e$&&String(e$).trim().toLowerCase()}function normalizeValue(e$){return e$===!1||e$==null?e$:utils$1.isArray(e$)?e$.map(normalizeValue):String(e$)}function parseTokens(e$){const t$=Object.create(null),r$=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n$;for(;n$=r$.exec(e$);)t$[n$[1]]=n$[2];return t$}const isValidHeaderName=e$=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e$.trim());function matchHeaderValue(e$,t$,r$,n$,i$){if(utils$1.isFunction(n$))return n$.call(this,t$,r$);if(i$&&(t$=r$),!!utils$1.isString(t$)){if(utils$1.isString(n$))return t$.indexOf(n$)!==-1;if(utils$1.isRegExp(n$))return n$.test(t$)}}function formatHeader(e$){return e$.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t$,r$,n$)=>r$.toUpperCase()+n$)}function buildAccessors(e$,t$){const r$=utils$1.toCamelCase(" "+t$);["get","set","has"].forEach(n$=>{Object.defineProperty(e$,n$+r$,{value:function(i$,o$,s$){return this[n$].call(this,t$,i$,o$,s$)},configurable:!0})})}class AxiosHeaders{constructor(t$){t$&&this.set(t$)}set(t$,r$,n$){const i$=this;function o$(a$,c$,u$){const l$=normalizeHeader(c$);if(!l$)throw new Error("header name must be a non-empty string");const d$=utils$1.findKey(i$,l$);(!d$||i$[d$]===void 0||u$===!0||u$===void 0&&i$[d$]!==!1)&&(i$[d$||c$]=normalizeValue(a$))}const s$=(a$,c$)=>utils$1.forEach(a$,(u$,l$)=>o$(u$,l$,c$));if(utils$1.isPlainObject(t$)||t$ instanceof this.constructor)s$(t$,r$);else if(utils$1.isString(t$)&&(t$=t$.trim())&&!isValidHeaderName(t$))s$(parseHeaders(t$),r$);else if(utils$1.isHeaders(t$))for(const[a$,c$]of t$.entries())o$(c$,a$,n$);else t$!=null&&o$(r$,t$,n$);return this}get(t$,r$){if(t$=normalizeHeader(t$),t$){const n$=utils$1.findKey(this,t$);if(n$){const i$=this[n$];if(!r$)return i$;if(r$===!0)return parseTokens(i$);if(utils$1.isFunction(r$))return r$.call(this,i$,n$);if(utils$1.isRegExp(r$))return r$.exec(i$);throw new TypeError("parser must be boolean|regexp|function")}}}has(t$,r$){if(t$=normalizeHeader(t$),t$){const n$=utils$1.findKey(this,t$);return!!(n$&&this[n$]!==void 0&&(!r$||matchHeaderValue(this,this[n$],n$,r$)))}return!1}delete(t$,r$){const n$=this;let i$=!1;function o$(s$){if(s$=normalizeHeader(s$),s$){const a$=utils$1.findKey(n$,s$);a$&&(!r$||matchHeaderValue(n$,n$[a$],a$,r$))&&(delete n$[a$],i$=!0)}}return utils$1.isArray(t$)?t$.forEach(o$):o$(t$),i$}clear(t$){const r$=Object.keys(this);let n$=r$.length,i$=!1;for(;n$--;){const o$=r$[n$];(!t$||matchHeaderValue(this,this[o$],o$,t$,!0))&&(delete this[o$],i$=!0)}return i$}normalize(t$){const r$=this,n$={};return utils$1.forEach(this,(i$,o$)=>{const s$=utils$1.findKey(n$,o$);if(s$){r$[s$]=normalizeValue(i$),delete r$[o$];return}const a$=t$?formatHeader(o$):String(o$).trim();a$!==o$&&delete r$[o$],r$[a$]=normalizeValue(i$),n$[a$]=!0}),this}concat(...t$){return this.constructor.concat(this,...t$)}toJSON(t$){const r$=Object.create(null);return utils$1.forEach(this,(n$,i$)=>{n$!=null&&n$!==!1&&(r$[i$]=t$&&utils$1.isArray(n$)?n$.join(", "):n$)}),r$}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t$,r$])=>t$+": "+r$).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t$){return t$ instanceof this?t$:new this(t$)}static concat(t$,...r$){const n$=new this(t$);return r$.forEach(i$=>n$.set(i$)),n$}static accessor(t$){const n$=(this[$internals]=this[$internals]={accessors:{}}).accessors,i$=this.prototype;function o$(s$){const a$=normalizeHeader(s$);n$[a$]||(buildAccessors(i$,s$),n$[a$]=!0)}return utils$1.isArray(t$)?t$.forEach(o$):o$(t$),this}}AxiosHeaders.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);utils$1.reduceDescriptors(AxiosHeaders.prototype,({value:e$},t$)=>{let r$=t$[0].toUpperCase()+t$.slice(1);return{get:()=>e$,set(n$){this[r$]=n$}}});utils$1.freezeMethods(AxiosHeaders);function transformData(e$,t$){const r$=this||defaults,n$=t$||r$,i$=AxiosHeaders.from(n$.headers);let o$=n$.data;return utils$1.forEach(e$,function(a$){o$=a$.call(r$,o$,i$.normalize(),t$?t$.status:void 0)}),i$.normalize(),o$}function isCancel(e$){return!!(e$&&e$.__CANCEL__)}function CanceledError(e$,t$,r$){AxiosError.call(this,e$??"canceled",AxiosError.ERR_CANCELED,t$,r$),this.name="CanceledError"}utils$1.inherits(CanceledError,AxiosError,{__CANCEL__:!0});function settle(e$,t$,r$){const n$=r$.config.validateStatus;!r$.status||!n$||n$(r$.status)?e$(r$):t$(new AxiosError("Request failed with status code "+r$.status,[AxiosError.ERR_BAD_REQUEST,AxiosError.ERR_BAD_RESPONSE][Math.floor(r$.status/100)-4],r$.config,r$.request,r$))}function parseProtocol(e$){const t$=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e$);return t$&&t$[1]||""}function speedometer(e$,t$){e$=e$||10;const r$=new Array(e$),n$=new Array(e$);let i$=0,o$=0,s$;return t$=t$!==void 0?t$:1e3,function(c$){const u$=Date.now(),l$=n$[o$];s$||(s$=u$),r$[i$]=c$,n$[i$]=u$;let d$=o$,h$=0;for(;d$!==i$;)h$+=r$[d$++],d$=d$%e$;if(i$=(i$+1)%e$,i$===o$&&(o$=(o$+1)%e$),u$-s$<t$)return;const p$=l$&&u$-l$;return p$?Math.round(h$*1e3/p$):void 0}}function throttle(e$,t$){let r$=0,n$=1e3/t$,i$,o$;const s$=(u$,l$=Date.now())=>{r$=l$,i$=null,o$&&(clearTimeout(o$),o$=null),e$.apply(null,u$)};return[(...u$)=>{const l$=Date.now(),d$=l$-r$;d$>=n$?s$(u$,l$):(i$=u$,o$||(o$=setTimeout(()=>{o$=null,s$(i$)},n$-d$)))},()=>i$&&s$(i$)]}const progressEventReducer=(e$,t$,r$=3)=>{let n$=0;const i$=speedometer(50,250);return throttle(o$=>{const s$=o$.loaded,a$=o$.lengthComputable?o$.total:void 0,c$=s$-n$,u$=i$(c$),l$=s$<=a$;n$=s$;const d$={loaded:s$,total:a$,progress:a$?s$/a$:void 0,bytes:c$,rate:u$||void 0,estimated:u$&&a$&&l$?(a$-s$)/u$:void 0,event:o$,lengthComputable:a$!=null,[t$?"download":"upload"]:!0};e$(d$)},r$)},progressEventDecorator=(e$,t$)=>{const r$=e$!=null;return[n$=>t$[0]({lengthComputable:r$,total:e$,loaded:n$}),t$[1]]},asyncDecorator=e$=>(...t$)=>utils$1.asap(()=>e$(...t$)),isURLSameOrigin=platform.hasStandardBrowserEnv?function e$(){const t$=platform.navigator&&/(msie|trident)/i.test(platform.navigator.userAgent),r$=document.createElement("a");let n$;function i$(o$){let s$=o$;return t$&&(r$.setAttribute("href",s$),s$=r$.href),r$.setAttribute("href",s$),{href:r$.href,protocol:r$.protocol?r$.protocol.replace(/:$/,""):"",host:r$.host,search:r$.search?r$.search.replace(/^\?/,""):"",hash:r$.hash?r$.hash.replace(/^#/,""):"",hostname:r$.hostname,port:r$.port,pathname:r$.pathname.charAt(0)==="/"?r$.pathname:"/"+r$.pathname}}return n$=i$(window.location.href),function(s$){const a$=utils$1.isString(s$)?i$(s$):s$;return a$.protocol===n$.protocol&&a$.host===n$.host}}():function e$(){return function(){return!0}}(),cookies=platform.hasStandardBrowserEnv?{write(e$,t$,r$,n$,i$,o$){const s$=[e$+"="+encodeURIComponent(t$)];utils$1.isNumber(r$)&&s$.push("expires="+new Date(r$).toGMTString()),utils$1.isString(n$)&&s$.push("path="+n$),utils$1.isString(i$)&&s$.push("domain="+i$),o$===!0&&s$.push("secure"),document.cookie=s$.join("; ")},read(e$){const t$=document.cookie.match(new RegExp("(^|;\\s*)("+e$+")=([^;]*)"));return t$?decodeURIComponent(t$[3]):null},remove(e$){this.write(e$,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function isAbsoluteURL(e$){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e$)}function combineURLs(e$,t$){return t$?e$.replace(/\/?\/$/,"")+"/"+t$.replace(/^\/+/,""):e$}function buildFullPath(e$,t$){return e$&&!isAbsoluteURL(t$)?combineURLs(e$,t$):t$}const headersToObject=e$=>e$ instanceof AxiosHeaders?{...e$}:e$;function mergeConfig(e$,t$){t$=t$||{};const r$={};function n$(u$,l$,d$){return utils$1.isPlainObject(u$)&&utils$1.isPlainObject(l$)?utils$1.merge.call({caseless:d$},u$,l$):utils$1.isPlainObject(l$)?utils$1.merge({},l$):utils$1.isArray(l$)?l$.slice():l$}function i$(u$,l$,d$){if(utils$1.isUndefined(l$)){if(!utils$1.isUndefined(u$))return n$(void 0,u$,d$)}else return n$(u$,l$,d$)}function o$(u$,l$){if(!utils$1.isUndefined(l$))return n$(void 0,l$)}function s$(u$,l$){if(utils$1.isUndefined(l$)){if(!utils$1.isUndefined(u$))return n$(void 0,u$)}else return n$(void 0,l$)}function a$(u$,l$,d$){if(d$ in t$)return n$(u$,l$);if(d$ in e$)return n$(void 0,u$)}const c$={url:o$,method:o$,data:o$,baseURL:s$,transformRequest:s$,transformResponse:s$,paramsSerializer:s$,timeout:s$,timeoutMessage:s$,withCredentials:s$,withXSRFToken:s$,adapter:s$,responseType:s$,xsrfCookieName:s$,xsrfHeaderName:s$,onUploadProgress:s$,onDownloadProgress:s$,decompress:s$,maxContentLength:s$,maxBodyLength:s$,beforeRedirect:s$,transport:s$,httpAgent:s$,httpsAgent:s$,cancelToken:s$,socketPath:s$,responseEncoding:s$,validateStatus:a$,headers:(u$,l$)=>i$(headersToObject(u$),headersToObject(l$),!0)};return utils$1.forEach(Object.keys(Object.assign({},e$,t$)),function(l$){const d$=c$[l$]||i$,h$=d$(e$[l$],t$[l$],l$);utils$1.isUndefined(h$)&&d$!==a$||(r$[l$]=h$)}),r$}const resolveConfig=e$=>{const t$=mergeConfig({},e$);let{data:r$,withXSRFToken:n$,xsrfHeaderName:i$,xsrfCookieName:o$,headers:s$,auth:a$}=t$;t$.headers=s$=AxiosHeaders.from(s$),t$.url=buildURL(buildFullPath(t$.baseURL,t$.url),e$.params,e$.paramsSerializer),a$&&s$.set("Authorization","Basic "+btoa((a$.username||"")+":"+(a$.password?unescape(encodeURIComponent(a$.password)):"")));let c$;if(utils$1.isFormData(r$)){if(platform.hasStandardBrowserEnv||platform.hasStandardBrowserWebWorkerEnv)s$.setContentType(void 0);else if((c$=s$.getContentType())!==!1){const[u$,...l$]=c$?c$.split(";").map(d$=>d$.trim()).filter(Boolean):[];s$.setContentType([u$||"multipart/form-data",...l$].join("; "))}}if(platform.hasStandardBrowserEnv&&(n$&&utils$1.isFunction(n$)&&(n$=n$(t$)),n$||n$!==!1&&isURLSameOrigin(t$.url))){const u$=i$&&o$&&cookies.read(o$);u$&&s$.set(i$,u$)}return t$},isXHRAdapterSupported=typeof XMLHttpRequest<"u",xhrAdapter=isXHRAdapterSupported&&function(e$){return new Promise(function(r$,n$){const i$=resolveConfig(e$);let o$=i$.data;const s$=AxiosHeaders.from(i$.headers).normalize();let{responseType:a$,onUploadProgress:c$,onDownloadProgress:u$}=i$,l$,d$,h$,p$,_$;function f$(){p$&&p$(),_$&&_$(),i$.cancelToken&&i$.cancelToken.unsubscribe(l$),i$.signal&&i$.signal.removeEventListener("abort",l$)}let m$=new XMLHttpRequest;m$.open(i$.method.toUpperCase(),i$.url,!0),m$.timeout=i$.timeout;function g$(){if(!m$)return;const y$=AxiosHeaders.from("getAllResponseHeaders"in m$&&m$.getAllResponseHeaders()),b$={data:!a$||a$==="text"||a$==="json"?m$.responseText:m$.response,status:m$.status,statusText:m$.statusText,headers:y$,config:e$,request:m$};settle(function(C$){r$(C$),f$()},function(C$){n$(C$),f$()},b$),m$=null}"onloadend"in m$?m$.onloadend=g$:m$.onreadystatechange=function(){!m$||m$.readyState!==4||m$.status===0&&!(m$.responseURL&&m$.responseURL.indexOf("file:")===0)||setTimeout(g$)},m$.onabort=function(){m$&&(n$(new AxiosError("Request aborted",AxiosError.ECONNABORTED,e$,m$)),m$=null)},m$.onerror=function(){n$(new AxiosError("Network Error",AxiosError.ERR_NETWORK,e$,m$)),m$=null},m$.ontimeout=function(){let S$=i$.timeout?"timeout of "+i$.timeout+"ms exceeded":"timeout exceeded";const b$=i$.transitional||transitionalDefaults;i$.timeoutErrorMessage&&(S$=i$.timeoutErrorMessage),n$(new AxiosError(S$,b$.clarifyTimeoutError?AxiosError.ETIMEDOUT:AxiosError.ECONNABORTED,e$,m$)),m$=null},o$===void 0&&s$.setContentType(null),"setRequestHeader"in m$&&utils$1.forEach(s$.toJSON(),function(S$,b$){m$.setRequestHeader(b$,S$)}),utils$1.isUndefined(i$.withCredentials)||(m$.withCredentials=!!i$.withCredentials),a$&&a$!=="json"&&(m$.responseType=i$.responseType),u$&&([h$,_$]=progressEventReducer(u$,!0),m$.addEventListener("progress",h$)),c$&&m$.upload&&([d$,p$]=progressEventReducer(c$),m$.upload.addEventListener("progress",d$),m$.upload.addEventListener("loadend",p$)),(i$.cancelToken||i$.signal)&&(l$=y$=>{m$&&(n$(!y$||y$.type?new CanceledError(null,e$,m$):y$),m$.abort(),m$=null)},i$.cancelToken&&i$.cancelToken.subscribe(l$),i$.signal&&(i$.signal.aborted?l$():i$.signal.addEventListener("abort",l$)));const v$=parseProtocol(i$.url);if(v$&&platform.protocols.indexOf(v$)===-1){n$(new AxiosError("Unsupported protocol "+v$+":",AxiosError.ERR_BAD_REQUEST,e$));return}m$.send(o$||null)})},composeSignals=(e$,t$)=>{const{length:r$}=e$=e$?e$.filter(Boolean):[];if(t$||r$){let n$=new AbortController,i$;const o$=function(u$){if(!i$){i$=!0,a$();const l$=u$ instanceof Error?u$:this.reason;n$.abort(l$ instanceof AxiosError?l$:new CanceledError(l$ instanceof Error?l$.message:l$))}};let s$=t$&&setTimeout(()=>{s$=null,o$(new AxiosError(`timeout ${t$} of ms exceeded`,AxiosError.ETIMEDOUT))},t$);const a$=()=>{e$&&(s$&&clearTimeout(s$),s$=null,e$.forEach(u$=>{u$.unsubscribe?u$.unsubscribe(o$):u$.removeEventListener("abort",o$)}),e$=null)};e$.forEach(u$=>u$.addEventListener("abort",o$));const{signal:c$}=n$;return c$.unsubscribe=()=>utils$1.asap(a$),c$}},streamChunk=function*(e$,t$){let r$=e$.byteLength;if(!t$||r$<t$){yield e$;return}let n$=0,i$;for(;n$<r$;)i$=n$+t$,yield e$.slice(n$,i$),n$=i$},readBytes=async function*(e$,t$){for await(const r$ of readStream(e$))yield*streamChunk(r$,t$)},readStream=async function*(e$){if(e$[Symbol.asyncIterator]){yield*e$;return}const t$=e$.getReader();try{for(;;){const{done:r$,value:n$}=await t$.read();if(r$)break;yield n$}}finally{await t$.cancel()}},trackStream=(e$,t$,r$,n$)=>{const i$=readBytes(e$,t$);let o$=0,s$,a$=c$=>{s$||(s$=!0,n$&&n$(c$))};return new ReadableStream({async pull(c$){try{const{done:u$,value:l$}=await i$.next();if(u$){a$(),c$.close();return}let d$=l$.byteLength;if(r$){let h$=o$+=d$;r$(h$)}c$.enqueue(new Uint8Array(l$))}catch(u$){throw a$(u$),u$}},cancel(c$){return a$(c$),i$.return()}},{highWaterMark:2})},isFetchSupported=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",isReadableStreamSupported=isFetchSupported&&typeof ReadableStream=="function",encodeText=isFetchSupported&&(typeof TextEncoder=="function"?(e$=>t$=>e$.encode(t$))(new TextEncoder):async e$=>new Uint8Array(await new Response(e$).arrayBuffer())),test=(e$,...t$)=>{try{return!!e$(...t$)}catch{return!1}},supportsRequestStream=isReadableStreamSupported&&test(()=>{let e$=!1;const t$=new Request(platform.origin,{body:new ReadableStream,method:"POST",get duplex(){return e$=!0,"half"}}).headers.has("Content-Type");return e$&&!t$}),DEFAULT_CHUNK_SIZE=64*1024,supportsResponseStream=isReadableStreamSupported&&test(()=>utils$1.isReadableStream(new Response("").body)),resolvers={stream:supportsResponseStream&&(e$=>e$.body)};isFetchSupported&&(e$=>{["text","arrayBuffer","blob","formData","stream"].forEach(t$=>{!resolvers[t$]&&(resolvers[t$]=utils$1.isFunction(e$[t$])?r$=>r$[t$]():(r$,n$)=>{throw new AxiosError(`Response type '${t$}' is not supported`,AxiosError.ERR_NOT_SUPPORT,n$)})})})(new Response);const getBodyLength=async e$=>{if(e$==null)return 0;if(utils$1.isBlob(e$))return e$.size;if(utils$1.isSpecCompliantForm(e$))return(await new Request(platform.origin,{method:"POST",body:e$}).arrayBuffer()).byteLength;if(utils$1.isArrayBufferView(e$)||utils$1.isArrayBuffer(e$))return e$.byteLength;if(utils$1.isURLSearchParams(e$)&&(e$=e$+""),utils$1.isString(e$))return(await encodeText(e$)).byteLength},resolveBodyLength=async(e$,t$)=>{const r$=utils$1.toFiniteNumber(e$.getContentLength());return r$??getBodyLength(t$)},fetchAdapter=isFetchSupported&&(async e$=>{let{url:t$,method:r$,data:n$,signal:i$,cancelToken:o$,timeout:s$,onDownloadProgress:a$,onUploadProgress:c$,responseType:u$,headers:l$,withCredentials:d$="same-origin",fetchOptions:h$}=resolveConfig(e$);u$=u$?(u$+"").toLowerCase():"text";let p$=composeSignals([i$,o$&&o$.toAbortSignal()],s$),_$;const f$=p$&&p$.unsubscribe&&(()=>{p$.unsubscribe()});let m$;try{if(c$&&supportsRequestStream&&r$!=="get"&&r$!=="head"&&(m$=await resolveBodyLength(l$,n$))!==0){let b$=new Request(t$,{method:"POST",body:n$,duplex:"half"}),$$;if(utils$1.isFormData(n$)&&($$=b$.headers.get("content-type"))&&l$.setContentType($$),b$.body){const[C$,N$]=progressEventDecorator(m$,progressEventReducer(asyncDecorator(c$)));n$=trackStream(b$.body,DEFAULT_CHUNK_SIZE,C$,N$)}}utils$1.isString(d$)||(d$=d$?"include":"omit");const g$="credentials"in Request.prototype;_$=new Request(t$,{...h$,signal:p$,method:r$.toUpperCase(),headers:l$.normalize().toJSON(),body:n$,duplex:"half",credentials:g$?d$:void 0});let v$=await fetch(_$);const y$=supportsResponseStream&&(u$==="stream"||u$==="response");if(supportsResponseStream&&(a$||y$&&f$)){const b$={};["status","statusText","headers"].forEach(k$=>{b$[k$]=v$[k$]});const $$=utils$1.toFiniteNumber(v$.headers.get("content-length")),[C$,N$]=a$&&progressEventDecorator($$,progressEventReducer(asyncDecorator(a$),!0))||[];v$=new Response(trackStream(v$.body,DEFAULT_CHUNK_SIZE,C$,()=>{N$&&N$(),f$&&f$()}),b$)}u$=u$||"text";let S$=await resolvers[utils$1.findKey(resolvers,u$)||"text"](v$,e$);return!y$&&f$&&f$(),await new Promise((b$,$$)=>{settle(b$,$$,{data:S$,headers:AxiosHeaders.from(v$.headers),status:v$.status,statusText:v$.statusText,config:e$,request:_$})})}catch(g$){throw f$&&f$(),g$&&g$.name==="TypeError"&&/fetch/i.test(g$.message)?Object.assign(new AxiosError("Network Error",AxiosError.ERR_NETWORK,e$,_$),{cause:g$.cause||g$}):AxiosError.from(g$,g$&&g$.code,e$,_$)}}),knownAdapters={http:httpAdapter,xhr:xhrAdapter,fetch:fetchAdapter};utils$1.forEach(knownAdapters,(e$,t$)=>{if(e$){try{Object.defineProperty(e$,"name",{value:t$})}catch{}Object.defineProperty(e$,"adapterName",{value:t$})}});const renderReason=e$=>`- ${e$}`,isResolvedHandle=e$=>utils$1.isFunction(e$)||e$===null||e$===!1,adapters={getAdapter:e$=>{e$=utils$1.isArray(e$)?e$:[e$];const{length:t$}=e$;let r$,n$;const i$={};for(let o$=0;o$<t$;o$++){r$=e$[o$];let s$;if(n$=r$,!isResolvedHandle(r$)&&(n$=knownAdapters[(s$=String(r$)).toLowerCase()],n$===void 0))throw new AxiosError(`Unknown adapter '${s$}'`);if(n$)break;i$[s$||"#"+o$]=n$}if(!n$){const o$=Object.entries(i$).map(([a$,c$])=>`adapter ${a$} `+(c$===!1?"is not supported by the environment":"is not available in the build"));let s$=t$?o$.length>1?`since :
`+o$.map(renderReason).join(`
`):" "+renderReason(o$[0]):"as no adapter specified";throw new AxiosError("There is no suitable adapter to dispatch the request "+s$,"ERR_NOT_SUPPORT")}return n$},adapters:knownAdapters};function throwIfCancellationRequested(e$){if(e$.cancelToken&&e$.cancelToken.throwIfRequested(),e$.signal&&e$.signal.aborted)throw new CanceledError(null,e$)}function dispatchRequest(e$){return throwIfCancellationRequested(e$),e$.headers=AxiosHeaders.from(e$.headers),e$.data=transformData.call(e$,e$.transformRequest),["post","put","patch"].indexOf(e$.method)!==-1&&e$.headers.setContentType("application/x-www-form-urlencoded",!1),adapters.getAdapter(e$.adapter||defaults.adapter)(e$).then(function(n$){return throwIfCancellationRequested(e$),n$.data=transformData.call(e$,e$.transformResponse,n$),n$.headers=AxiosHeaders.from(n$.headers),n$},function(n$){return isCancel(n$)||(throwIfCancellationRequested(e$),n$&&n$.response&&(n$.response.data=transformData.call(e$,e$.transformResponse,n$.response),n$.response.headers=AxiosHeaders.from(n$.response.headers))),Promise.reject(n$)})}const VERSION="1.7.7",validators$1={};["object","boolean","number","function","string","symbol"].forEach((e$,t$)=>{validators$1[e$]=function(n$){return typeof n$===e$||"a"+(t$<1?"n ":" ")+e$}});const deprecatedWarnings={};validators$1.transitional=function e$(t$,r$,n$){function i$(o$,s$){return"[Axios v"+VERSION+"] Transitional option '"+o$+"'"+s$+(n$?". "+n$:"")}return(o$,s$,a$)=>{if(t$===!1)throw new AxiosError(i$(s$," has been removed"+(r$?" in "+r$:"")),AxiosError.ERR_DEPRECATED);return r$&&!deprecatedWarnings[s$]&&(deprecatedWarnings[s$]=!0,console.warn(i$(s$," has been deprecated since v"+r$+" and will be removed in the near future"))),t$?t$(o$,s$,a$):!0}};function assertOptions(e$,t$,r$){if(typeof e$!="object")throw new AxiosError("options must be an object",AxiosError.ERR_BAD_OPTION_VALUE);const n$=Object.keys(e$);let i$=n$.length;for(;i$-- >0;){const o$=n$[i$],s$=t$[o$];if(s$){const a$=e$[o$],c$=a$===void 0||s$(a$,o$,e$);if(c$!==!0)throw new AxiosError("option "+o$+" must be "+c$,AxiosError.ERR_BAD_OPTION_VALUE);continue}if(r$!==!0)throw new AxiosError("Unknown option "+o$,AxiosError.ERR_BAD_OPTION)}}const validator={assertOptions,validators:validators$1},validators=validator.validators;class Axios{constructor(t$){this.defaults=t$,this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}async request(t$,r$){try{return await this._request(t$,r$)}catch(n$){if(n$ instanceof Error){let i$;Error.captureStackTrace?Error.captureStackTrace(i$={}):i$=new Error;const o$=i$.stack?i$.stack.replace(/^.+\n/,""):"";try{n$.stack?o$&&!String(n$.stack).endsWith(o$.replace(/^.+\n.+\n/,""))&&(n$.stack+=`
`+o$):n$.stack=o$}catch{}}throw n$}}_request(t$,r$){typeof t$=="string"?(r$=r$||{},r$.url=t$):r$=t$||{},r$=mergeConfig(this.defaults,r$);const{transitional:n$,paramsSerializer:i$,headers:o$}=r$;n$!==void 0&&validator.assertOptions(n$,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1),i$!=null&&(utils$1.isFunction(i$)?r$.paramsSerializer={serialize:i$}:validator.assertOptions(i$,{encode:validators.function,serialize:validators.function},!0)),r$.method=(r$.method||this.defaults.method||"get").toLowerCase();let s$=o$&&utils$1.merge(o$.common,o$[r$.method]);o$&&utils$1.forEach(["delete","get","head","post","put","patch","common"],_$=>{delete o$[_$]}),r$.headers=AxiosHeaders.concat(s$,o$);const a$=[];let c$=!0;this.interceptors.request.forEach(function(f$){typeof f$.runWhen=="function"&&f$.runWhen(r$)===!1||(c$=c$&&f$.synchronous,a$.unshift(f$.fulfilled,f$.rejected))});const u$=[];this.interceptors.response.forEach(function(f$){u$.push(f$.fulfilled,f$.rejected)});let l$,d$=0,h$;if(!c$){const _$=[dispatchRequest.bind(this),void 0];for(_$.unshift.apply(_$,a$),_$.push.apply(_$,u$),h$=_$.length,l$=Promise.resolve(r$);d$<h$;)l$=l$.then(_$[d$++],_$[d$++]);return l$}h$=a$.length;let p$=r$;for(d$=0;d$<h$;){const _$=a$[d$++],f$=a$[d$++];try{p$=_$(p$)}catch(m$){f$.call(this,m$);break}}try{l$=dispatchRequest.call(this,p$)}catch(_$){return Promise.reject(_$)}for(d$=0,h$=u$.length;d$<h$;)l$=l$.then(u$[d$++],u$[d$++]);return l$}getUri(t$){t$=mergeConfig(this.defaults,t$);const r$=buildFullPath(t$.baseURL,t$.url);return buildURL(r$,t$.params,t$.paramsSerializer)}}utils$1.forEach(["delete","get","head","options"],function e$(t$){Axios.prototype[t$]=function(r$,n$){return this.request(mergeConfig(n$||{},{method:t$,url:r$,data:(n$||{}).data}))}});utils$1.forEach(["post","put","patch"],function e$(t$){function r$(n$){return function(o$,s$,a$){return this.request(mergeConfig(a$||{},{method:t$,headers:n$?{"Content-Type":"multipart/form-data"}:{},url:o$,data:s$}))}}Axios.prototype[t$]=r$(),Axios.prototype[t$+"Form"]=r$(!0)});class CancelToken{constructor(t$){if(typeof t$!="function")throw new TypeError("executor must be a function.");let r$;this.promise=new Promise(function(o$){r$=o$});const n$=this;this.promise.then(i$=>{if(!n$._listeners)return;let o$=n$._listeners.length;for(;o$-- >0;)n$._listeners[o$](i$);n$._listeners=null}),this.promise.then=i$=>{let o$;const s$=new Promise(a$=>{n$.subscribe(a$),o$=a$}).then(i$);return s$.cancel=function(){n$.unsubscribe(o$)},s$},t$(function(o$,s$,a$){n$.reason||(n$.reason=new CanceledError(o$,s$,a$),r$(n$.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t$){if(this.reason){t$(this.reason);return}this._listeners?this._listeners.push(t$):this._listeners=[t$]}unsubscribe(t$){if(!this._listeners)return;const r$=this._listeners.indexOf(t$);r$!==-1&&this._listeners.splice(r$,1)}toAbortSignal(){const t$=new AbortController,r$=n$=>{t$.abort(n$)};return this.subscribe(r$),t$.signal.unsubscribe=()=>this.unsubscribe(r$),t$.signal}static source(){let t$;return{token:new CancelToken(function(i$){t$=i$}),cancel:t$}}}function spread(e$){return function(r$){return e$.apply(null,r$)}}function isAxiosError(e$){return utils$1.isObject(e$)&&e$.isAxiosError===!0}const HttpStatusCode={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(HttpStatusCode).forEach(([e$,t$])=>{HttpStatusCode[t$]=e$});function createInstance(e$){const t$=new Axios(e$),r$=bind(Axios.prototype.request,t$);return utils$1.extend(r$,Axios.prototype,t$,{allOwnKeys:!0}),utils$1.extend(r$,t$,null,{allOwnKeys:!0}),r$.create=function(i$){return createInstance(mergeConfig(e$,i$))},r$}const axios=createInstance(defaults);axios.Axios=Axios;axios.CanceledError=CanceledError;axios.CancelToken=CancelToken;axios.isCancel=isCancel;axios.VERSION=VERSION;axios.toFormData=toFormData;axios.AxiosError=AxiosError;axios.Cancel=axios.CanceledError;axios.all=function e$(t$){return Promise.all(t$)};axios.spread=spread;axios.isAxiosError=isAxiosError;axios.mergeConfig=mergeConfig;axios.AxiosHeaders=AxiosHeaders;axios.formToJSON=e$=>formDataToJSON(utils$1.isHTMLForm(e$)?new FormData(e$):e$);axios.getAdapter=adapters.getAdapter;axios.HttpStatusCode=HttpStatusCode;axios.default=axios;const fetchTokenChannel=async({role:e$,channel:t$})=>{var i$,o$;let r$,n$;try{const{data:s$}=await axios({method:"get",url:`http://adm.udc.br:9090/rtc/${t$}/${e$}/uid/0`});r$=s$}catch(s$){console.error(s$),axios.isAxiosError(s$)&&s$.response&&(n$=(o$=(i$=s$.response)==null?void 0:i$.data)==null?void 0:o$.error)}return{data:r$,error:n$}};function App(){const e$={display:"flex",width:"100vw",height:"100vh"},[t$,r$]=reactExports.useState(!0),n$=new URLSearchParams(window.location.search),i$=n$.get("channel"),o$=n$.get("role"),[s$,a$]=reactExports.useState({appId:"28719c35108a43ffaf5bd4ea3d363e30",channel:i$}),c$={EndCall:()=>r$(!1)};return reactExports.useEffect(()=>{!i$||!o$||(async()=>{const{data:u$,error:l$}=await fetchTokenChannel({role:o$,channel:i$});if(l$){console.error(l$);return}a$(d$=>({...d$,token:u$==null?void 0:u$.rtcToken}))})()},[i$,o$]),t$?jsxRuntimeExports.jsx("div",{style:e$,children:jsxRuntimeExports.jsx(AgoraUIKit,{rtcProps:s$,callbacks:c$})}):jsxRuntimeExports.jsx("h3",{onClick:()=>r$(!0),children:"Join"})}/**
 * @license agora-rtc-react
 * @version 2.3.0
 *
 * Copyright (c) Agora, Inc.
 *
 * This source code is licensed under the MIT license.
 */function yN(e$,t$){return t$.forEach(function(r$){r$&&typeof r$!="string"&&!Array.isArray(r$)&&Object.keys(r$).forEach(function(n$){if(n$!=="default"&&!(n$ in e$)){var i$=Object.getOwnPropertyDescriptor(r$,n$);Object.defineProperty(e$,n$,i$.get?i$:{enumerable:!0,get:function(){return r$[n$]}})}})}),Object.freeze(e$)}var Vs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ae(e$){return e$&&e$.__esModule&&Object.prototype.hasOwnProperty.call(e$,"default")?e$.default:e$}var Se=function(e$){try{return!!e$()}catch{return!0}},vu=!Se(function(){var e$=(function(){}).bind();return typeof e$!="function"||e$.hasOwnProperty("prototype")}),IA=vu,vA=Function.prototype,G_=vA.call,AN=IA&&vA.bind.bind(G_,G_),me=IA?AN:function(e$){return function(){return G_.apply(e$,arguments)}},hn=me({}.isPrototypeOf),cd=function(e$){return e$&&e$.Math==Math&&e$},We=cd(typeof globalThis=="object"&&globalThis)||cd(typeof window=="object"&&window)||cd(typeof self=="object"&&self)||cd(typeof Vs=="object"&&Vs)||function(){return this}()||Vs||Function("return this")(),bN=vu,yA=Function.prototype,Xf=yA.apply,Qf=yA.call,vm=typeof Reflect=="object"&&Reflect.apply||(bN?Qf.bind(Xf):function(){return Qf.apply(Xf,arguments)}),AA=me,wN=AA({}.toString),ON=AA("".slice),pr=function(e$){return ON(wN(e$),8,-1)},NN=pr,DN=me,gc=function(e$){if(NN(e$)==="Function")return DN(e$)},uh=typeof document=="object"&&document.all,yu={all:uh,IS_HTMLDDA:uh===void 0&&uh!==void 0},PN=yu.all,He=yu.IS_HTMLDDA?function(e$){return typeof e$=="function"||e$===PN}:function(e$){return typeof e$=="function"},Yc={},ri=!Se(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),kN=vu,dd=Function.prototype.call,Ke=kN?dd.bind(dd):function(){return dd.apply(dd,arguments)},Au={},bA={}.propertyIsEnumerable,wA=Object.getOwnPropertyDescriptor,LN=wA&&!bA.call({1:2},1);Au.f=LN?function(e$){var t$=wA(this,e$);return!!t$&&t$.enumerable}:bA;var xr,rl,_o=function(e$,t$){return{enumerable:!(1&e$),configurable:!(2&e$),writable:!(4&e$),value:t$}},MN=Se,UN=pr,hh=Object,xN=me("".split),bu=MN(function(){return!hh("z").propertyIsEnumerable(0)})?function(e$){return UN(e$)=="String"?xN(e$,""):hh(e$)}:hh,da=function(e$){return e$==null},VN=da,FN=TypeError,la=function(e$){if(VN(e$))throw FN("Can't call method on "+e$);return e$},BN=bu,jN=la,Eo=function(e$){return BN(jN(e$))},Zf=He,GN=yu.all,Hn=yu.IS_HTMLDDA?function(e$){return typeof e$=="object"?e$!==null:Zf(e$)||e$===GN}:function(e$){return typeof e$=="object"?e$!==null:Zf(e$)},Gi={},ph=Gi,_h=We,WN=He,$f=function(e$){return WN(e$)?e$:void 0},Dn=function(e$,t$){return arguments.length<2?$f(ph[e$])||$f(_h[e$]):ph[e$]&&ph[e$][t$]||_h[e$]&&_h[e$][t$]},$o=typeof navigator<"u"&&String(navigator.userAgent)||"",OA=We,Eh=$o,tg=OA.process,eg=OA.Deno,ng=tg&&tg.versions||eg&&eg.version,ig=ng&&ng.v8;ig&&(rl=(xr=ig.split("."))[0]>0&&xr[0]<4?1:+(xr[0]+xr[1])),!rl&&Eh&&(!(xr=Eh.match(/Edge\/(\d+)/))||xr[1]>=74)&&(xr=Eh.match(/Chrome\/(\d+)/))&&(rl=+xr[1]);var zo=rl,rg=zo,HN=Se,KN=We.String,ua=!!Object.getOwnPropertySymbols&&!HN(function(){var e$=Symbol();return!KN(e$)||!(Object(e$)instanceof Symbol)||!Symbol.sham&&rg&&rg<41}),NA=ua&&!Symbol.sham&&typeof Symbol.iterator=="symbol",YN=Dn,qN=He,zN=hn,JN=Object,qc=NA?function(e$){return typeof e$=="symbol"}:function(e$){var t$=YN("Symbol");return qN(t$)&&zN(t$.prototype,JN(e$))},XN=String,ha=function(e$){try{return XN(e$)}catch{return"Object"}},QN=He,ZN=ha,$N=TypeError,yi=function(e$){if(QN(e$))return e$;throw $N(ZN(e$)+" is not a function")},tD=yi,eD=da,wu=function(e$,t$){var r$=e$[t$];return eD(r$)?void 0:tD(r$)},mh=Ke,fh=He,gh=Hn,nD=TypeError,DA={exports:{}},og=We,iD=Object.defineProperty,rD=function(e$,t$){try{iD(og,e$,{value:t$,configurable:!0,writable:!0})}catch{og[e$]=t$}return t$},sg="__core-js_shared__",ym=We[sg]||rD(sg,{}),ag=ym;(DA.exports=function(e$,t$){return ag[e$]||(ag[e$]=t$!==void 0?t$:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var pa=DA.exports,oD=la,sD=Object,_r=function(e$){return sD(oD(e$))},aD=_r,cD=me({}.hasOwnProperty),Je=Object.hasOwn||function(e$,t$){return cD(aD(e$),t$)},dD=me,lD=0,uD=Math.random(),hD=dD(1 .toString),Am=function(e$){return"Symbol("+(e$===void 0?"":e$)+")_"+hD(++lD+uD,36)},pD=pa,cg=Je,_D=Am,ED=ua,mD=NA,ws=We.Symbol,Th=pD("wks"),fD=mD?ws.for||ws:ws&&ws.withoutSetter||_D,pe=function(e$){return cg(Th,e$)||(Th[e$]=ED&&cg(ws,e$)?ws[e$]:fD("Symbol."+e$)),Th[e$]},gD=Ke,dg=Hn,lg=qc,TD=wu,SD=function(e$,t$){var r$,n$;if(fh(r$=e$.toString)&&!gh(n$=mh(r$,e$))||fh(r$=e$.valueOf)&&!gh(n$=mh(r$,e$))||t$!=="string")return n$;throw nD("Can't convert object to primitive value")},RD=TypeError,CD=pe("toPrimitive"),ID=function(e$,t$){if(!dg(e$)||lg(e$))return e$;var r$,n$=TD(e$,CD);if(n$){if(r$=gD(n$,e$,t$),!dg(r$)||lg(r$))return r$;throw RD("Can't convert object to primitive value")}return SD(e$,t$)},vD=qc,Ou=function(e$){var t$=ID(e$,"string");return vD(t$)?t$:t$+""},ug=Hn,W_=We.document,yD=ug(W_)&&ug(W_.createElement),bm=function(e$){return yD?W_.createElement(e$):{}},AD=bm,PA=!ri&&!Se(function(){return Object.defineProperty(AD("div"),"a",{get:function(){return 7}}).a!=7}),bD=ri,wD=Ke,OD=Au,ND=_o,DD=Eo,PD=Ou,kD=Je,LD=PA,hg=Object.getOwnPropertyDescriptor;Yc.f=bD?hg:function(e$,t$){if(e$=DD(e$),t$=PD(t$),LD)try{return hg(e$,t$)}catch{}if(kD(e$,t$))return ND(!wD(OD.f,e$,t$),e$[t$])};var MD=Se,UD=He,xD=/#|\.prototype\./,zc=function(e$,t$){var r$=FD[VD(e$)];return r$==jD||r$!=BD&&(UD(t$)?MD(t$):!!t$)},VD=zc.normalize=function(e$){return String(e$).replace(xD,".").toLowerCase()},FD=zc.data={},BD=zc.NATIVE="N",jD=zc.POLYFILL="P",kA=zc,GD=yi,WD=vu,HD=gc(gc.bind),mo=function(e$,t$){return GD(e$),t$===void 0?e$:WD?HD(e$,t$):function(){return e$.apply(t$,arguments)}},Ai={},LA=ri&&Se(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),KD=Hn,YD=String,qD=TypeError,Cn=function(e$){if(KD(e$))return e$;throw qD(YD(e$)+" is not an object")},zD=ri,JD=PA,XD=LA,ld=Cn,pg=Ou,QD=TypeError,Sh=Object.defineProperty,ZD=Object.getOwnPropertyDescriptor,Rh="enumerable",Ch="configurable",Ih="writable";Ai.f=zD?XD?function(e$,t$,r$){if(ld(e$),t$=pg(t$),ld(r$),typeof e$=="function"&&t$==="prototype"&&"value"in r$&&Ih in r$&&!r$[Ih]){var n$=ZD(e$,t$);n$&&n$[Ih]&&(e$[t$]=r$.value,r$={configurable:Ch in r$?r$[Ch]:n$[Ch],enumerable:Rh in r$?r$[Rh]:n$[Rh],writable:!1})}return Sh(e$,t$,r$)}:Sh:function(e$,t$,r$){if(ld(e$),t$=pg(t$),ld(r$),JD)try{return Sh(e$,t$,r$)}catch{}if("get"in r$||"set"in r$)throw QD("Accessors not supported");return"value"in r$&&(e$[t$]=r$.value),e$};var $D=Ai,tP=_o,fo=ri?function(e$,t$,r$){return $D.f(e$,t$,tP(1,r$))}:function(e$,t$,r$){return e$[t$]=r$,e$},ud=We,eP=vm,nP=gc,iP=He,rP=Yc.f,oP=kA,os=Gi,sP=mo,ss=fo,_g=Je,aP=function(e$){var t$=function(r$,n$,i$){if(this instanceof t$){switch(arguments.length){case 0:return new e$;case 1:return new e$(r$);case 2:return new e$(r$,n$)}return new e$(r$,n$,i$)}return eP(e$,this,arguments)};return t$.prototype=e$.prototype,t$},xt=function(e$,t$){var r$,n$,i$,o$,s$,a$,c$,u$,l$,d$=e$.target,h$=e$.global,p$=e$.stat,_$=e$.proto,f$=h$?ud:p$?ud[d$]:(ud[d$]||{}).prototype,m$=h$?os:os[d$]||ss(os,d$,{})[d$],g$=m$.prototype;for(o$ in t$)n$=!(r$=oP(h$?o$:d$+(p$?".":"#")+o$,e$.forced))&&f$&&_g(f$,o$),a$=m$[o$],n$&&(c$=e$.dontCallGetSet?(l$=rP(f$,o$))&&l$.value:f$[o$]),s$=n$&&c$?c$:t$[o$],n$&&typeof a$==typeof s$||(u$=e$.bind&&n$?sP(s$,ud):e$.wrap&&n$?aP(s$):_$&&iP(s$)?nP(s$):s$,(e$.sham||s$&&s$.sham||a$&&a$.sham)&&ss(u$,"sham",!0),ss(m$,o$,u$),_$&&(_g(os,i$=d$+"Prototype")||ss(os,i$,{}),ss(os[i$],o$,s$),e$.real&&g$&&(r$||!g$[o$])&&ss(g$,o$,s$)))},cP=Math.ceil,dP=Math.floor,lP=Math.trunc||function(e$){var t$=+e$;return(t$>0?dP:cP)(t$)},uP=lP,wm=function(e$){var t$=+e$;return t$!=t$||t$===0?0:uP(t$)},hP=wm,pP=Math.max,_P=Math.min,Om=function(e$,t$){var r$=hP(e$);return r$<0?pP(r$+t$,0):_P(r$,t$)},EP=wm,mP=Math.min,MA=function(e$){return e$>0?mP(EP(e$),9007199254740991):0},fP=MA,Lr=function(e$){return fP(e$.length)},gP=Eo,TP=Om,SP=Lr,Eg=function(e$){return function(t$,r$,n$){var i$,o$=gP(t$),s$=SP(o$),a$=TP(n$,s$);if(e$&&r$!=r$){for(;s$>a$;)if((i$=o$[a$++])!=i$)return!0}else for(;s$>a$;a$++)if((e$||a$ in o$)&&o$[a$]===r$)return e$||a$||0;return!e$&&-1}},Nm={includes:Eg(!0),indexOf:Eg(!1)},RP=Nm.includes;xt({target:"Array",proto:!0,forced:Se(function(){return!Array(1).includes()})},{includes:function(e$){return RP(this,e$,arguments.length>1?arguments[1]:void 0)}});var CP=Gi,bi=function(e$){return CP[e$+"Prototype"]},IP=bi("Array").includes,vP=Hn,yP=pr,AP=pe("match"),UA=function(e$){var t$;return vP(e$)&&((t$=e$[AP])!==void 0?!!t$:yP(e$)=="RegExp")},bP=UA,wP=TypeError,xA={};xA[pe("toStringTag")]="z";var Dm=String(xA)==="[object z]",OP=Dm,NP=He,ol=pr,DP=pe("toStringTag"),PP=Object,kP=ol(function(){return arguments}())=="Arguments",Er=OP?ol:function(e$){var t$,r$,n$;return e$===void 0?"Undefined":e$===null?"Null":typeof(r$=function(i$,o$){try{return i$[o$]}catch{}}(t$=PP(e$),DP))=="string"?r$:kP?ol(t$):(n$=ol(t$))=="Object"&&NP(t$.callee)?"Arguments":n$},LP=Er,MP=String,oi=function(e$){if(LP(e$)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return MP(e$)},UP=pe("match"),xP=xt,VP=function(e$){if(bP(e$))throw wP("The method doesn't accept regular expressions");return e$},FP=la,mg=oi,BP=function(e$){var t$=/./;try{"/./"[e$](t$)}catch{try{return t$[UP]=!1,"/./"[e$](t$)}catch{}}return!1},jP=me("".indexOf);xP({target:"String",proto:!0,forced:!BP("includes")},{includes:function(e$){return!!~jP(mg(FP(this)),mg(VP(e$)),arguments.length>1?arguments[1]:void 0)}});var GP=bi("String").includes,fg=hn,WP=IP,HP=GP,vh=Array.prototype,yh=String.prototype,KP=function(e$){var t$=e$.includes;return e$===vh||fg(vh,e$)&&t$===vh.includes?WP:typeof e$=="string"||e$===yh||fg(yh,e$)&&t$===yh.includes?HP:t$},W=ae(KP),YP=yi,qP=_r,zP=bu,JP=Lr,XP=TypeError,gg=function(e$){return function(t$,r$,n$,i$){YP(r$);var o$=qP(t$),s$=zP(o$),a$=JP(o$),c$=e$?a$-1:0,u$=e$?-1:1;if(n$<2)for(;;){if(c$ in s$){i$=s$[c$],c$+=u$;break}if(c$+=u$,e$?c$<0:a$<=c$)throw XP("Reduce of empty array with no initial value")}for(;e$?c$>=0:a$>c$;c$+=u$)c$ in s$&&(i$=r$(i$,s$[c$],c$,o$));return i$}},QP={left:gg(!1),right:gg(!0)},ZP=Se,Nu=function(e$,t$){var r$=[][e$];return!!r$&&ZP(function(){r$.call(null,t$||function(){return 1},1)})},Jc=typeof process<"u"&&pr(process)=="process",$P=QP.left;xt({target:"Array",proto:!0,forced:!Jc&&zo>79&&zo<83||!Nu("reduce")},{reduce:function(e$){var t$=arguments.length;return $P(this,e$,t$,t$>1?arguments[1]:void 0)}});var tk=bi("Array").reduce,ek=hn,nk=tk,Ah=Array.prototype,ik=function(e$){var t$=e$.reduce;return e$===Ah||ek(Ah,e$)&&t$===Ah.reduce?nk:t$},VA=ik,ji=ae(VA),FA=!0,BA=!0;function hd(e$,t$,r$){let n$=e$.match(t$);return n$&&n$.length>=r$&&parseInt(n$[r$],10)}function ts(e$,t$,r$){if(!e$.RTCPeerConnection)return;let n$=e$.RTCPeerConnection.prototype,i$=n$.addEventListener;n$.addEventListener=function(s$,a$){if(s$!==t$)return i$.apply(this,arguments);let c$=u$=>{let l$=r$(u$);l$&&(a$.handleEvent?a$.handleEvent(l$):a$(l$))};return this._eventMap=this._eventMap||{},this._eventMap[t$]||(this._eventMap[t$]=new Map),this._eventMap[t$].set(a$,c$),i$.apply(this,[s$,c$])};let o$=n$.removeEventListener;n$.removeEventListener=function(s$,a$){if(s$!==t$||!this._eventMap||!this._eventMap[t$])return o$.apply(this,arguments);if(!this._eventMap[t$].has(a$))return o$.apply(this,arguments);let c$=this._eventMap[t$].get(a$);return this._eventMap[t$].delete(a$),this._eventMap[t$].size===0&&delete this._eventMap[t$],Object.keys(this._eventMap).length===0&&delete this._eventMap,o$.apply(this,[s$,c$])},Object.defineProperty(n$,"on"+t$,{get(){return this["_on"+t$]},set(s$){this["_on"+t$]&&(this.removeEventListener(t$,this["_on"+t$]),delete this["_on"+t$]),s$&&this.addEventListener(t$,this["_on"+t$]=s$)},enumerable:!0,configurable:!0})}function rk(e$){return typeof e$!="boolean"?new Error("Argument type: "+typeof e$+". Please use a boolean."):(FA=e$,e$?"adapter.js logging disabled":"adapter.js logging enabled")}function ok(e$){return typeof e$!="boolean"?new Error("Argument type: "+typeof e$+". Please use a boolean."):(BA=!e$,"adapter.js deprecation warnings "+(e$?"disabled":"enabled"))}function jA(){if(typeof window=="object"){if(FA)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Pm(e$,t$){BA&&console.warn(e$+" is deprecated, please use "+t$+" instead.")}function Tg(e$){return Object.prototype.toString.call(e$)==="[object Object]"}function GA(e$){var t$;return Tg(e$)?ji(t$=Object.keys(e$)).call(t$,function(r$,n$){let i$=Tg(e$[n$]),o$=i$?GA(e$[n$]):e$[n$],s$=i$&&!Object.keys(o$).length;return o$===void 0||s$?r$:Object.assign(r$,{[n$]:o$})},{}):e$}function H_(e$,t$,r$){t$&&!r$.has(t$.id)&&(r$.set(t$.id,t$),Object.keys(t$).forEach(n$=>{n$.endsWith("Id")?H_(e$,e$.get(t$[n$]),r$):n$.endsWith("Ids")&&t$[n$].forEach(i$=>{H_(e$,e$.get(i$),r$)})}))}function Sg(e$,t$,r$){let n$=r$?"outbound-rtp":"inbound-rtp",i$=new Map;if(t$===null)return i$;let o$=[];return e$.forEach(s$=>{s$.type==="track"&&s$.trackIdentifier===t$.id&&o$.push(s$)}),o$.forEach(s$=>{e$.forEach(a$=>{a$.type===n$&&a$.trackId===s$.id&&H_(e$,a$,i$)})}),i$}var sk=Am,Rg=pa("keys"),Du=function(e$){return Rg[e$]||(Rg[e$]=sk(e$))},ak=!Se(function(){function e$(){}return e$.prototype.constructor=null,Object.getPrototypeOf(new e$)!==e$.prototype}),ck=Je,dk=He,lk=_r,uk=ak,Cg=Du("IE_PROTO"),K_=Object,hk=K_.prototype,km=uk?K_.getPrototypeOf:function(e$){var t$=lk(e$);if(ck(t$,Cg))return t$[Cg];var r$=t$.constructor;return dk(r$)&&t$ instanceof r$?r$.prototype:t$ instanceof K_?hk:null},pk=me,_k=yi,Ek=He,mk=String,fk=TypeError,gk=function(e$,t$,r$){try{return pk(_k(Object.getOwnPropertyDescriptor(e$,t$)[r$]))}catch{}},Tk=Cn,Sk=function(e$){if(typeof e$=="object"||Ek(e$))return e$;throw fk("Can't set "+mk(e$)+" as a prototype")},Rk=Object.setPrototypeOf||("__proto__"in{}?function(){var e$,t$=!1,r$={};try{(e$=gk(Object.prototype,"__proto__","set"))(r$,[]),t$=r$ instanceof Array}catch{}return function(n$,i$){return Tk(n$),Sk(i$),t$?e$(n$,i$):n$.__proto__=i$,n$}}():void 0),Pu={},ku={},bh=Je,Ck=Eo,Ik=Nm.indexOf,vk=ku,Ig=me([].push),WA=function(e$,t$){var r$,n$=Ck(e$),i$=0,o$=[];for(r$ in n$)!bh(vk,r$)&&bh(n$,r$)&&Ig(o$,r$);for(;t$.length>i$;)bh(n$,r$=t$[i$++])&&(~Ik(o$,r$)||Ig(o$,r$));return o$},Lm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],yk=WA,Ak=Lm.concat("length","prototype");Pu.f=Object.getOwnPropertyNames||function(e$){return yk(e$,Ak)};var Xc={};Xc.f=Object.getOwnPropertySymbols;var bk=Dn,wk=Pu,Ok=Xc,Nk=Cn,Dk=me([].concat),Pk=bk("Reflect","ownKeys")||function(e$){var t$=wk.f(Nk(e$)),r$=Ok.f;return r$?Dk(t$,r$(e$)):t$},vg=Je,kk=Pk,Lk=Yc,Mk=Ai,Mm={},Uk=WA,xk=Lm,Lu=Object.keys||function(e$){return Uk(e$,xk)},Vk=ri,Fk=LA,Bk=Ai,jk=Cn,Gk=Eo,Wk=Lu;Mm.f=Vk&&!Fk?Object.defineProperties:function(e$,t$){jk(e$);for(var r$,n$=Gk(t$),i$=Wk(t$),o$=i$.length,s$=0;o$>s$;)Bk.f(e$,r$=i$[s$++],n$[r$]);return e$};var pd,HA=Dn("document","documentElement"),Hk=Cn,Kk=Mm,yg=Lm,Yk=ku,qk=HA,zk=bm,Y_="prototype",q_="script",KA=Du("IE_PROTO"),wh=function(){},YA=function(e$){return"<"+q_+">"+e$+"</"+q_+">"},Ag=function(e$){e$.write(YA("")),e$.close();var t$=e$.parentWindow.Object;return e$=null,t$},sl=function(){try{pd=new ActiveXObject("htmlfile")}catch{}var e$,t$,r$;sl=typeof document<"u"?document.domain&&pd?Ag(pd):(t$=zk("iframe"),r$="java"+q_+":",t$.style.display="none",qk.appendChild(t$),t$.src=String(r$),(e$=t$.contentWindow.document).open(),e$.write(YA("document.F=Object")),e$.close(),e$.F):Ag(pd);for(var n$=yg.length;n$--;)delete sl[Y_][yg[n$]];return sl()};Yk[KA]=!0;var Qc=Object.create||function(e$,t$){var r$;return e$!==null?(wh[Y_]=Hk(e$),r$=new wh,wh[Y_]=null,r$[KA]=e$):r$=sl(),t$===void 0?r$:Kk.f(r$,t$)},Jk=Hn,Xk=fo,qA=Error,Qk=me("".replace),Zk=String(qA("zxcasd").stack),zA=/\n\s*at [^:]*:[^\n]*/,$k=zA.test(Zk),tL=_o,eL=!Se(function(){var e$=Error("a");return!("stack"in e$)||(Object.defineProperty(e$,"stack",tL(1,7)),e$.stack!==7)}),nL=fo,iL=function(e$,t$){if($k&&typeof e$=="string"&&!qA.prepareStackTrace)for(;t$--;)e$=Qk(e$,zA,"");return e$},rL=eL,bg=Error.captureStackTrace,es={},oL=es,sL=pe("iterator"),aL=Array.prototype,JA=function(e$){return e$!==void 0&&(oL.Array===e$||aL[sL]===e$)},cL=Er,wg=wu,dL=da,lL=es,uL=pe("iterator"),Mu=function(e$){if(!dL(e$))return wg(e$,uL)||wg(e$,"@@iterator")||lL[cL(e$)]},hL=Ke,pL=yi,_L=Cn,EL=ha,mL=Mu,fL=TypeError,Um=function(e$,t$){var r$=arguments.length<2?mL(e$):t$;if(pL(r$))return _L(hL(r$,e$));throw fL(EL(e$)+" is not iterable")},gL=Ke,Og=Cn,TL=wu,XA=function(e$,t$,r$){var n$,i$;Og(e$);try{if(!(n$=TL(e$,"return"))){if(t$==="throw")throw r$;return r$}n$=gL(n$,e$)}catch(o$){i$=!0,n$=o$}if(t$==="throw")throw r$;if(i$)throw n$;return Og(n$),r$},SL=mo,RL=Ke,CL=Cn,IL=ha,vL=JA,yL=Lr,Ng=hn,AL=Um,bL=Mu,Dg=XA,wL=TypeError,al=function(e$,t$){this.stopped=e$,this.result=t$},Pg=al.prototype,Zc=function(e$,t$,r$){var n$,i$,o$,s$,a$,c$,u$,l$=r$&&r$.that,d$=!(!r$||!r$.AS_ENTRIES),h$=!(!r$||!r$.IS_RECORD),p$=!(!r$||!r$.IS_ITERATOR),_$=!(!r$||!r$.INTERRUPTED),f$=SL(t$,l$),m$=function(v$){return n$&&Dg(n$,"normal",v$),new al(!0,v$)},g$=function(v$){return d$?(CL(v$),_$?f$(v$[0],v$[1],m$):f$(v$[0],v$[1])):_$?f$(v$,m$):f$(v$)};if(h$)n$=e$.iterator;else if(p$)n$=e$;else{if(!(i$=bL(e$)))throw wL(IL(e$)+" is not iterable");if(vL(i$)){for(o$=0,s$=yL(e$);s$>o$;o$++)if((a$=g$(e$[o$]))&&Ng(Pg,a$))return a$;return new al(!1)}n$=AL(e$,i$)}for(c$=h$?e$.next:n$.next;!(u$=RL(c$,n$)).done;){try{a$=g$(u$.value)}catch(v$){Dg(n$,"throw",v$)}if(typeof a$=="object"&&a$&&Ng(Pg,a$))return a$}return new al(!1)},OL=oi,NL=xt,DL=hn,PL=km,Nl=Rk,kL=function(e$,t$,r$){for(var n$=kk(t$),i$=Mk.f,o$=Lk.f,s$=0;s$<n$.length;s$++){var a$=n$[s$];vg(e$,a$)||r$&&vg(r$,a$)||i$(e$,a$,o$(t$,a$))}},QA=Qc,Oh=fo,Nh=_o,LL=function(e$,t$){Jk(t$)&&"cause"in t$&&Xk(e$,"cause",t$.cause)},ML=function(e$,t$,r$,n$){rL&&(bg?bg(e$,t$):nL(e$,"stack",iL(r$,n$)))},UL=Zc,xL=function(e$,t$){return e$===void 0?arguments.length<2?"":t$:OL(e$)},VL=pe("toStringTag"),Dl=Error,FL=[].push,Js=function(e$,t$){var r$,n$=DL(Dh,this);Nl?r$=Nl(Dl(),n$?PL(this):Dh):(r$=n$?this:QA(Dh),Oh(r$,VL,"Error")),t$!==void 0&&Oh(r$,"message",xL(t$)),ML(r$,Js,r$.stack,1),arguments.length>2&&LL(r$,arguments[2]);var i$=[];return UL(e$,FL,{that:i$}),Oh(r$,"errors",i$),r$};Nl?Nl(Js,Dl):kL(Js,Dl,{name:!0});var Dh=Js.prototype=QA(Dl.prototype,{constructor:Nh(1,Js),message:Nh(1,""),name:Nh(1,"AggregateError")});NL({global:!0,constructor:!0,arity:2},{AggregateError:Js});var Pl,nc,kl,BL=He,kg=We.WeakMap,jL=BL(kg)&&/native code/.test(String(kg)),ZA=We,GL=Hn,WL=fo,Ph=Je,kh=ym,HL=Du,KL=ku,Lg="Object already initialized",z_=ZA.TypeError,YL=ZA.WeakMap;jL||kh.state?(Ni=kh.state||(kh.state=new YL),Ni.get=Ni.get,Ni.has=Ni.has,Ni.set=Ni.set,Pl=function(e$,t$){if(Ni.has(e$))throw z_(Lg);return t$.facade=e$,Ni.set(e$,t$),t$},nc=function(e$){return Ni.get(e$)||{}},kl=function(e$){return Ni.has(e$)}):(Co=HL("state"),KL[Co]=!0,Pl=function(e$,t$){if(Ph(e$,Co))throw z_(Lg);return t$.facade=e$,WL(e$,Co,t$),t$},nc=function(e$){return Ph(e$,Co)?e$[Co]:{}},kl=function(e$){return Ph(e$,Co)});var Ni,Co,Ho,Mg,Ug,ns={set:Pl,get:nc,has:kl,enforce:function(e$){return kl(e$)?nc(e$):Pl(e$,{})},getterFor:function(e$){return function(t$){var r$;if(!GL(t$)||(r$=nc(t$)).type!==e$)throw z_("Incompatible receiver, "+e$+" required");return r$}}},J_=ri,qL=Je,$A=Function.prototype,zL=J_&&Object.getOwnPropertyDescriptor,Lh=qL($A,"name"),tb={EXISTS:Lh,PROPER:Lh&&(function(){}).name==="something",CONFIGURABLE:Lh&&(!J_||J_&&zL($A,"name").configurable)},JL=fo,go=function(e$,t$,r$,n$){return n$&&n$.enumerable?e$[t$]=r$:JL(e$,t$,r$),e$},XL=Se,QL=He,ZL=Hn,$L=Qc,xg=km,t1=go,X_=pe("iterator"),eb=!1;[].keys&&("next"in(Ug=[].keys())?(Mg=xg(xg(Ug)))!==Object.prototype&&(Ho=Mg):eb=!0);var e1=!ZL(Ho)||XL(function(){var e$={};return Ho[X_].call(e$)!==e$});QL((Ho=e1?{}:$L(Ho))[X_])||t1(Ho,X_,function(){return this});var nb={IteratorPrototype:Ho,BUGGY_SAFARI_ITERATORS:eb},n1=Er,i1=Dm?{}.toString:function(){return"[object "+n1(this)+"]"},r1=Dm,o1=Ai.f,s1=fo,a1=Je,c1=i1,Vg=pe("toStringTag"),To=function(e$,t$,r$,n$){if(e$){var i$=r$?e$:e$.prototype;a1(i$,Vg)||o1(i$,Vg,{configurable:!0,value:t$}),n$&&!r1&&s1(i$,"toString",c1)}},d1=nb.IteratorPrototype,l1=Qc,u1=_o,h1=To,p1=es,_1=function(){return this},xm=function(e$,t$,r$,n$){var i$=t$+" Iterator";return e$.prototype=l1(d1,{next:u1(+!n$,r$)}),h1(e$,i$,!1,!0),p1[i$]=_1,e$},E1=xt,m1=Ke,f1=tb,g1=xm,T1=km,S1=To,Fg=go,Bg=es,R1=nb,C1=f1.PROPER,_d=R1.BUGGY_SAFARI_ITERATORS,Mh=pe("iterator"),jg="keys",Ed="values",Gg="entries",I1=function(){return this},ib=function(e$,t$,r$,n$,i$,o$,s$){g1(r$,t$,n$);var a$,c$,u$,l$=function(g$){if(g$===i$&&f$)return f$;if(!_d&&g$ in p$)return p$[g$];switch(g$){case jg:case Ed:case Gg:return function(){return new r$(this,g$)}}return function(){return new r$(this)}},d$=t$+" Iterator",h$=!1,p$=e$.prototype,_$=p$[Mh]||p$["@@iterator"]||i$&&p$[i$],f$=!_d&&_$||l$(i$),m$=t$=="Array"&&p$.entries||_$;if(m$&&(a$=T1(m$.call(new e$)))!==Object.prototype&&a$.next&&(S1(a$,d$,!0,!0),Bg[d$]=I1),C1&&i$==Ed&&_$&&_$.name!==Ed&&(h$=!0,f$=function(){return m1(_$,this)}),i$)if(c$={values:l$(Ed),keys:o$?f$:l$(jg),entries:l$(Gg)},s$)for(u$ in c$)(_d||h$||!(u$ in p$))&&Fg(p$,u$,c$[u$]);else E1({target:t$,proto:!0,forced:_d||h$},c$);return s$&&p$[Mh]!==f$&&Fg(p$,Mh,f$,{name:i$}),Bg[t$]=f$,c$},Vm=function(e$,t$){return{value:e$,done:t$}},v1=Eo,Wg=es,rb=ns;Ai.f;var y1=ib,Hg=Vm,ob="Array Iterator",A1=rb.set,b1=rb.getterFor(ob);y1(Array,"Array",function(e$,t$){A1(this,{type:ob,target:v1(e$),index:0,kind:t$})},function(){var e$=b1(this),t$=e$.target,r$=e$.kind,n$=e$.index++;return!t$||n$>=t$.length?(e$.target=void 0,Hg(void 0,!0)):Hg(r$=="keys"?n$:r$=="values"?t$[n$]:[n$,t$[n$]],!1)},"values"),Wg.Arguments=Wg.Array;var w1=Ai,Uu=function(e$,t$,r$){return w1.f(e$,t$,r$)},O1=Dn,N1=Uu,D1=ri,Kg=pe("species"),P1=hn,k1=TypeError,Fm=function(e$,t$){if(P1(t$,e$))return e$;throw k1("Incorrect invocation")},L1=He,Q_=ym,M1=me(Function.toString);L1(Q_.inspectSource)||(Q_.inspectSource=function(e$){return M1(e$)});var sb=Q_.inspectSource,U1=me,x1=Se,ab=He,V1=Er,F1=sb,cb=function(){},B1=[],db=Dn("Reflect","construct"),Bm=/^\s*(?:class|function)\b/,j1=U1(Bm.exec),G1=!Bm.exec(cb),Aa=function(e$){if(!ab(e$))return!1;try{return db(cb,B1,e$),!0}catch{return!1}},lb=function(e$){if(!ab(e$))return!1;switch(V1(e$)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return G1||!!j1(Bm,F1(e$))}catch{return!0}};lb.sham=!0;var Tc,as,Yg,Uh,xu=!db||x1(function(){var e$;return Aa(Aa.call)||!Aa(Object)||!Aa(function(){e$=!0})||e$})?lb:Aa,W1=xu,H1=ha,K1=TypeError,qg=Cn,Y1=function(e$){if(W1(e$))return e$;throw K1(H1(e$)+" is not a constructor")},q1=da,z1=pe("species"),jm=function(e$,t$){var r$,n$=qg(e$).constructor;return n$===void 0||q1(r$=qg(n$)[z1])?t$:Y1(r$)},Gm=me([].slice),J1=TypeError,Vu=function(e$,t$){if(e$<t$)throw J1("Not enough arguments");return e$},ub=/(?:ipad|iphone|ipod).*applewebkit/i.test($o),ei=We,X1=vm,Q1=mo,zg=He,Z1=Je,hb=Se,Jg=HA,$1=Gm,Xg=bm,tM=Vu,eM=ub,nM=Jc,Z_=ei.setImmediate,$_=ei.clearImmediate,iM=ei.process,xh=ei.Dispatch,rM=ei.Function,Qg=ei.MessageChannel,oM=ei.String,Vh=0,ic={},Zg="onreadystatechange";hb(function(){Tc=ei.location});var Wm=function(e$){if(Z1(ic,e$)){var t$=ic[e$];delete ic[e$],t$()}},Fh=function(e$){return function(){Wm(e$)}},$g=function(e$){Wm(e$.data)},tT=function(e$){ei.postMessage(oM(e$),Tc.protocol+"//"+Tc.host)};Z_&&$_||(Z_=function(e$){tM(arguments.length,1);var t$=zg(e$)?e$:rM(e$),r$=$1(arguments,1);return ic[++Vh]=function(){X1(t$,void 0,r$)},as(Vh),Vh},$_=function(e$){delete ic[e$]},nM?as=function(e$){iM.nextTick(Fh(e$))}:xh&&xh.now?as=function(e$){xh.now(Fh(e$))}:Qg&&!eM?(Uh=(Yg=new Qg).port2,Yg.port1.onmessage=$g,as=Q1(Uh.postMessage,Uh)):ei.addEventListener&&zg(ei.postMessage)&&!ei.importScripts&&Tc&&Tc.protocol!=="file:"&&!hb(tT)?(as=tT,ei.addEventListener("message",$g,!1)):as=Zg in Xg("script")?function(e$){Jg.appendChild(Xg("script"))[Zg]=function(){Jg.removeChild(this),Wm(e$)}}:function(e$){setTimeout(Fh(e$),0)});var pb={set:Z_,clear:$_},_b=function(){this.head=null,this.tail=null};_b.prototype={add:function(e$){var t$={item:e$,next:null},r$=this.tail;r$?r$.next=t$:this.head=t$,this.tail=t$},get:function(){var e$=this.head;if(e$)return(this.head=e$.next)===null&&(this.tail=null),e$.item}};var cs,Bh,jh,Gh,eT,Eb=_b,sM=/ipad|iphone|ipod/i.test($o)&&typeof Pebble<"u",aM=/web0s(?!.*chrome)/i.test($o),Jo=We,nT=mo,cM=Yc.f,Wh=pb.set,dM=Eb,lM=ub,uM=sM,hM=aM,Hh=Jc,iT=Jo.MutationObserver||Jo.WebKitMutationObserver,rT=Jo.document,oT=Jo.process,md=Jo.Promise,sT=cM(Jo,"queueMicrotask"),tE=sT&&sT.value;tE||(ba=new dM,wa=function(){var e$,t$;for(Hh&&(e$=oT.domain)&&e$.exit();t$=ba.get();)try{t$()}catch(r$){throw ba.head&&cs(),r$}e$&&e$.enter()},lM||Hh||hM||!iT||!rT?!uM&&md&&md.resolve?((Gh=md.resolve(void 0)).constructor=md,eT=nT(Gh.then,Gh),cs=function(){eT(wa)}):Hh?cs=function(){oT.nextTick(wa)}:(Wh=nT(Wh,Jo),cs=function(){Wh(wa)}):(Bh=!0,jh=rT.createTextNode(""),new iT(wa).observe(jh,{characterData:!0}),cs=function(){jh.data=Bh=!Bh}),tE=function(e$){ba.head||cs(),ba.add(e$)});var ba,wa,pM=tE,_a=function(e$){try{return{error:!1,value:e$()}}catch(t$){return{error:!0,value:t$}}},Xo=We.Promise,mb=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",_M=!mb&&!Jc&&typeof window=="object"&&typeof document=="object",EM=We,rc=Xo,mM=He,fM=kA,gM=sb,TM=pe,SM=_M,RM=mb,Kh=zo,aT=rc&&rc.prototype,CM=TM("species"),fb=!1,gb=mM(EM.PromiseRejectionEvent),IM=fM("Promise",function(){var e$=gM(rc),t$=e$!==String(rc);if(!t$&&Kh===66||!aT.catch||!aT.finally)return!0;if(!Kh||Kh<51||!/native code/.test(e$)){var r$=new rc(function(i$){i$(1)}),n$=function(i$){i$(function(){},function(){})};if((r$.constructor={})[CM]=n$,!(fb=r$.then(function(){})instanceof n$))return!0}return!t$&&(SM||RM)&&!gb}),$c={CONSTRUCTOR:IM,REJECTION_EVENT:gb,SUBCLASSING:fb},mr={},cT=yi,vM=TypeError,yM=function(e$){var t$,r$;this.promise=new e$(function(n$,i$){if(t$!==void 0||r$!==void 0)throw vM("Bad Promise constructor");t$=n$,r$=i$}),this.resolve=cT(t$),this.reject=cT(r$)};mr.f=function(e$){return new yM(e$)};var Yh,dT,AM=xt,Ll=Jc,uo=We,td=Ke,bM=go,wM=To,OM=function(e$){var t$=O1(e$);D1&&t$&&!t$[Kg]&&N1(t$,Kg,{configurable:!0,get:function(){return this}})},NM=yi,eE=He,DM=Hn,PM=Fm,kM=jm,Tb=pb.set,Hm=pM,LM=function(e$,t$){try{arguments.length==1?console.error(e$):console.error(e$,t$)}catch{}},MM=_a,UM=Eb,Sb=ns,nE=Xo,Rb=$c,Cb=mr,cl="Promise",lT=Rb.CONSTRUCTOR,xM=Rb.REJECTION_EVENT,qh=Sb.getterFor(cl),VM=Sb.set,FM=nE&&nE.prototype,Oa=nE,zh=FM,Ib=uo.TypeError,iE=uo.document,Km=uo.process,rE=Cb.f,BM=rE,jM=!!(iE&&iE.createEvent&&uo.dispatchEvent),vb="unhandledrejection",yb=function(e$){var t$;return!(!DM(e$)||!eE(t$=e$.then))&&t$},Ab=function(e$,t$){var r$,n$,i$,o$=t$.value,s$=t$.state==1,a$=s$?e$.ok:e$.fail,c$=e$.resolve,u$=e$.reject,l$=e$.domain;try{a$?(s$||(t$.rejection===2&&WM(t$),t$.rejection=1),a$===!0?r$=o$:(l$&&l$.enter(),r$=a$(o$),l$&&(l$.exit(),i$=!0)),r$===e$.promise?u$(Ib("Promise-chain cycle")):(n$=yb(r$))?td(n$,r$,c$,u$):c$(r$)):u$(o$)}catch(d$){l$&&!i$&&l$.exit(),u$(d$)}},bb=function(e$,t$){e$.notified||(e$.notified=!0,Hm(function(){for(var r$,n$=e$.reactions;r$=n$.get();)Ab(r$,e$);e$.notified=!1,t$&&!e$.rejection&&GM(e$)}))},wb=function(e$,t$,r$){var n$,i$;jM?((n$=iE.createEvent("Event")).promise=t$,n$.reason=r$,n$.initEvent(e$,!1,!0),uo.dispatchEvent(n$)):n$={promise:t$,reason:r$},!xM&&(i$=uo["on"+e$])?i$(n$):e$===vb&&LM("Unhandled promise rejection",r$)},GM=function(e$){td(Tb,uo,function(){var t$,r$=e$.facade,n$=e$.value;if(uT(e$)&&(t$=MM(function(){Ll?Km.emit("unhandledRejection",n$,r$):wb(vb,r$,n$)}),e$.rejection=Ll||uT(e$)?2:1,t$.error))throw t$.value})},uT=function(e$){return e$.rejection!==1&&!e$.parent},WM=function(e$){td(Tb,uo,function(){var t$=e$.facade;Ll?Km.emit("rejectionHandled",t$):wb("rejectionhandled",t$,e$.value)})},Os=function(e$,t$,r$){return function(n$){e$(t$,n$,r$)}},Fs=function(e$,t$,r$){e$.done||(e$.done=!0,r$&&(e$=r$),e$.value=t$,e$.state=2,bb(e$,!0))},oE=function(e$,t$,r$){if(!e$.done){e$.done=!0,r$&&(e$=r$);try{if(e$.facade===t$)throw Ib("Promise can't be resolved itself");var n$=yb(t$);n$?Hm(function(){var i$={done:!1};try{td(n$,t$,Os(oE,i$,e$),Os(Fs,i$,e$))}catch(o$){Fs(i$,o$,e$)}}):(e$.value=t$,e$.state=1,bb(e$,!1))}catch(i$){Fs({done:!1},i$,e$)}}};lT&&(zh=(Oa=function(e$){PM(this,zh),NM(e$),td(Yh,this);var t$=qh(this);try{e$(Os(oE,t$),Os(Fs,t$))}catch(r$){Fs(t$,r$)}}).prototype,(Yh=function(e$){VM(this,{type:cl,done:!1,notified:!1,parent:!1,reactions:new UM,rejection:!1,state:0,value:void 0})}).prototype=bM(zh,"then",function(e$,t$){var r$=qh(this),n$=rE(kM(this,Oa));return r$.parent=!0,n$.ok=!eE(e$)||e$,n$.fail=eE(t$)&&t$,n$.domain=Ll?Km.domain:void 0,r$.state==0?r$.reactions.add(n$):Hm(function(){Ab(n$,r$)}),n$.promise}),dT=function(){var e$=new Yh,t$=qh(e$);this.promise=e$,this.resolve=Os(oE,t$),this.reject=Os(Fs,t$)},Cb.f=rE=function(e$){return e$===Oa||e$===void 0?new dT(e$):BM(e$)}),AM({global:!0,constructor:!0,wrap:!0,forced:lT},{Promise:Oa}),wM(Oa,cl,!1,!0),OM(cl);var Ob=pe("iterator"),Nb=!1;try{hT=0,Jh={next:function(){return{done:!!hT++}},return:function(){Nb=!0}},Jh[Ob]=function(){return this},Array.from(Jh,function(){throw 2})}catch{}var hT,Jh,HM=Xo,KM=function(e$,t$){if(!Nb)return!1;var r$=!1;try{var n$={};n$[Ob]=function(){return{next:function(){return{done:r$=!0}}}},e$(n$)}catch{}return r$},Fu=$c.CONSTRUCTOR||!KM(function(e$){HM.all(e$).then(void 0,function(){})}),YM=Ke,qM=yi,zM=mr,JM=_a,XM=Zc;xt({target:"Promise",stat:!0,forced:Fu},{all:function(e$){var t$=this,r$=zM.f(t$),n$=r$.resolve,i$=r$.reject,o$=JM(function(){var s$=qM(t$.resolve),a$=[],c$=0,u$=1;XM(e$,function(l$){var d$=c$++,h$=!1;u$++,YM(s$,t$,l$).then(function(p$){h$||(h$=!0,a$[d$]=p$,--u$||n$(a$))},i$)}),--u$||n$(a$)});return o$.error&&i$(o$.value),r$.promise}});var QM=xt,ZM=$c.CONSTRUCTOR;Xo&&Xo.prototype,QM({target:"Promise",proto:!0,forced:ZM,real:!0},{catch:function(e$){return this.then(void 0,e$)}});var $M=Ke,tU=yi,eU=mr,nU=_a,iU=Zc;xt({target:"Promise",stat:!0,forced:Fu},{race:function(e$){var t$=this,r$=eU.f(t$),n$=r$.reject,i$=nU(function(){var o$=tU(t$.resolve);iU(e$,function(s$){$M(o$,t$,s$).then(r$.resolve,n$)})});return i$.error&&n$(i$.value),r$.promise}});var rU=Ke,oU=mr;xt({target:"Promise",stat:!0,forced:$c.CONSTRUCTOR},{reject:function(e$){var t$=oU.f(this);return rU(t$.reject,void 0,e$),t$.promise}});var sU=Cn,aU=Hn,cU=mr,Db=function(e$,t$){if(sU(e$),aU(t$)&&t$.constructor===e$)return t$;var r$=cU.f(e$);return(0,r$.resolve)(t$),r$.promise},dU=xt,lU=Xo,uU=$c.CONSTRUCTOR,hU=Db,pU=Dn("Promise"),_U=!uU;dU({target:"Promise",stat:!0,forced:!0},{resolve:function(e$){return hU(_U&&this===pU?lU:this,e$)}});var EU=Ke,mU=yi,fU=mr,gU=_a,TU=Zc;xt({target:"Promise",stat:!0,forced:Fu},{allSettled:function(e$){var t$=this,r$=fU.f(t$),n$=r$.resolve,i$=r$.reject,o$=gU(function(){var s$=mU(t$.resolve),a$=[],c$=0,u$=1;TU(e$,function(l$){var d$=c$++,h$=!1;u$++,EU(s$,t$,l$).then(function(p$){h$||(h$=!0,a$[d$]={status:"fulfilled",value:p$},--u$||n$(a$))},function(p$){h$||(h$=!0,a$[d$]={status:"rejected",reason:p$},--u$||n$(a$))})}),--u$||n$(a$)});return o$.error&&i$(o$.value),r$.promise}});var SU=Ke,RU=yi,CU=Dn,IU=mr,vU=_a,yU=Zc,pT="No one promise resolved";xt({target:"Promise",stat:!0,forced:Fu},{any:function(e$){var t$=this,r$=CU("AggregateError"),n$=IU.f(t$),i$=n$.resolve,o$=n$.reject,s$=vU(function(){var a$=RU(t$.resolve),c$=[],u$=0,l$=1,d$=!1;yU(e$,function(h$){var p$=u$++,_$=!1;l$++,SU(a$,t$,h$).then(function(f$){_$||d$||(d$=!0,i$(f$))},function(f$){_$||d$||(_$=!0,c$[p$]=f$,--l$||o$(new r$(c$,pT)))})}),--l$||o$(new r$(c$,pT))});return s$.error&&o$(s$.value),n$.promise}});var AU=xt,sE=Xo,bU=Se,wU=Dn,OU=He,NU=jm,_T=Db,DU=sE&&sE.prototype;AU({target:"Promise",proto:!0,real:!0,forced:!!sE&&bU(function(){DU.finally.call({then:function(){}},function(){})})},{finally:function(e$){var t$=NU(this,wU("Promise")),r$=OU(e$);return this.then(r$?function(n$){return _T(t$,e$()).then(function(){return n$})}:e$,r$?function(n$){return _T(t$,e$()).then(function(){throw n$})}:e$)}});var Ym=me,PU=wm,kU=oi,LU=la,MU=Ym("".charAt),ET=Ym("".charCodeAt),UU=Ym("".slice),mT=function(e$){return function(t$,r$){var n$,i$,o$=kU(LU(t$)),s$=PU(r$),a$=o$.length;return s$<0||s$>=a$?e$?"":void 0:(n$=ET(o$,s$))<55296||n$>56319||s$+1===a$||(i$=ET(o$,s$+1))<56320||i$>57343?e$?MU(o$,s$):n$:e$?UU(o$,s$,s$+2):i$-56320+(n$-55296<<10)+65536}},qm={codeAt:mT(!1),charAt:mT(!0)},xU=qm.charAt,VU=oi,Pb=ns,FU=ib,fT=Vm,kb="String Iterator",BU=Pb.set,jU=Pb.getterFor(kb);FU(String,"String",function(e$){BU(this,{type:kb,string:VU(e$),index:0})},function(){var e$,t$=jU(this),r$=t$.string,n$=t$.index;return n$>=r$.length?fT(void 0,!0):(e$=xU(r$,n$),t$.index+=e$.length,fT(e$,!1))});var GU=Gi.Promise,WU={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},HU=We,KU=Er,YU=fo,gT=es,TT=pe("toStringTag");for(fd in WU)Xh=HU[fd],gd=Xh&&Xh.prototype,gd&&KU(gd)!==TT&&YU(gd,TT,fd),gT[fd]=gT.Array;var Xh,gd,fd,Lb=GU,j=ae(Lb),ST=jA;function Mb(e$,t$){let r$=e$&&e$.navigator;if(!r$.mediaDevices)return;let n$=function(s$){if(typeof s$!="object"||s$.mandatory||s$.optional)return s$;let a$={};return Object.keys(s$).forEach(c$=>{if(c$==="require"||c$==="advanced"||c$==="mediaSource")return;let u$=typeof s$[c$]=="object"?s$[c$]:{ideal:s$[c$]};u$.exact!==void 0&&typeof u$.exact=="number"&&(u$.min=u$.max=u$.exact);let l$=function(d$,h$){return d$?d$+h$.charAt(0).toUpperCase()+h$.slice(1):h$==="deviceId"?"sourceId":h$};if(u$.ideal!==void 0){a$.optional=a$.optional||[];let d$={};typeof u$.ideal=="number"?(d$[l$("min",c$)]=u$.ideal,a$.optional.push(d$),d$={},d$[l$("max",c$)]=u$.ideal,a$.optional.push(d$)):(d$[l$("",c$)]=u$.ideal,a$.optional.push(d$))}u$.exact!==void 0&&typeof u$.exact!="number"?(a$.mandatory=a$.mandatory||{},a$.mandatory[l$("",c$)]=u$.exact):["min","max"].forEach(d$=>{u$[d$]!==void 0&&(a$.mandatory=a$.mandatory||{},a$.mandatory[l$(d$,c$)]=u$[d$])})}),s$.advanced&&(a$.optional=(a$.optional||[]).concat(s$.advanced)),a$},i$=function(s$,a$){if(t$.version>=61)return a$(s$);if((s$=JSON.parse(JSON.stringify(s$)))&&typeof s$.audio=="object"){let c$=function(u$,l$,d$){l$ in u$&&!(d$ in u$)&&(u$[d$]=u$[l$],delete u$[l$])};c$((s$=JSON.parse(JSON.stringify(s$))).audio,"autoGainControl","googAutoGainControl"),c$(s$.audio,"noiseSuppression","googNoiseSuppression"),s$.audio=n$(s$.audio)}if(s$&&typeof s$.video=="object"){let c$=s$.video.facingMode;c$=c$&&(typeof c$=="object"?c$:{ideal:c$});let u$=t$.version<66;if(c$&&(c$.exact==="user"||c$.exact==="environment"||c$.ideal==="user"||c$.ideal==="environment")&&(!r$.mediaDevices.getSupportedConstraints||!r$.mediaDevices.getSupportedConstraints().facingMode||u$)){let l$;if(delete s$.video.facingMode,c$.exact==="environment"||c$.ideal==="environment"?l$=["back","rear"]:c$.exact!=="user"&&c$.ideal!=="user"||(l$=["front"]),l$)return r$.mediaDevices.enumerateDevices().then(d$=>{let h$=(d$=d$.filter(p$=>p$.kind==="videoinput")).find(p$=>l$.some(_$=>{var f$;return W(f$=p$.label.toLowerCase()).call(f$,_$)}));return!h$&&d$.length&&W(l$).call(l$,"back")&&(h$=d$[d$.length-1]),h$&&(s$.video.deviceId=c$.exact?{exact:h$.deviceId}:{ideal:h$.deviceId}),s$.video=n$(s$.video),ST("chrome: "+JSON.stringify(s$)),a$(s$)})}s$.video=n$(s$.video)}return ST("chrome: "+JSON.stringify(s$)),a$(s$)},o$=function(s$){return t$.version>=64?s$:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[s$.name]||s$.name,message:s$.message,constraint:s$.constraint||s$.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r$.getUserMedia=(function(s$,a$,c$){i$(s$,u$=>{r$.webkitGetUserMedia(u$,a$,l$=>{c$&&c$(o$(l$))})})}).bind(r$),r$.mediaDevices.getUserMedia){let s$=r$.mediaDevices.getUserMedia.bind(r$.mediaDevices);r$.mediaDevices.getUserMedia=function(a$){return i$(a$,c$=>s$(c$).then(u$=>{if(c$.audio&&!u$.getAudioTracks().length||c$.video&&!u$.getVideoTracks().length)throw u$.getTracks().forEach(l$=>{l$.stop()}),new DOMException("","NotFoundError");return u$},u$=>j.reject(o$(u$))))}}}function Ub(e$){e$.MediaStream=e$.MediaStream||e$.webkitMediaStream}function xb(e$){if(typeof e$=="object"&&e$.RTCPeerConnection&&!("ontrack"in e$.RTCPeerConnection.prototype)){Object.defineProperty(e$.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r$){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r$)},enumerable:!0,configurable:!0});let t$=e$.RTCPeerConnection.prototype.setRemoteDescription;e$.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r$=>{r$.stream.addEventListener("addtrack",n$=>{let i$;i$=e$.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(s$=>s$.track&&s$.track.id===n$.track.id):{track:n$.track};let o$=new Event("track");o$.track=n$.track,o$.receiver=i$,o$.transceiver={receiver:i$},o$.streams=[r$.stream],this.dispatchEvent(o$)}),r$.stream.getTracks().forEach(n$=>{let i$;i$=e$.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(s$=>s$.track&&s$.track.id===n$.id):{track:n$};let o$=new Event("track");o$.track=n$,o$.receiver=i$,o$.transceiver={receiver:i$},o$.streams=[r$.stream],this.dispatchEvent(o$)})},this.addEventListener("addstream",this._ontrackpoly)),t$.apply(this,arguments)}}else ts(e$,"track",t$=>(t$.transceiver||Object.defineProperty(t$,"transceiver",{value:{receiver:t$.receiver}}),t$))}function Vb(e$){if(typeof e$=="object"&&e$.RTCPeerConnection&&!("getSenders"in e$.RTCPeerConnection.prototype)&&"createDTMFSender"in e$.RTCPeerConnection.prototype){let t$=function(i$,o$){return{track:o$,get dtmf(){return this._dtmf===void 0&&(o$.kind==="audio"?this._dtmf=i$.createDTMFSender(o$):this._dtmf=null),this._dtmf},_pc:i$}};if(!e$.RTCPeerConnection.prototype.getSenders){e$.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let i$=e$.RTCPeerConnection.prototype.addTrack;e$.RTCPeerConnection.prototype.addTrack=function(s$,a$){let c$=i$.apply(this,arguments);return c$||(c$=t$(this,s$),this._senders.push(c$)),c$};let o$=e$.RTCPeerConnection.prototype.removeTrack;e$.RTCPeerConnection.prototype.removeTrack=function(s$){o$.apply(this,arguments);let a$=this._senders.indexOf(s$);a$!==-1&&this._senders.splice(a$,1)}}let r$=e$.RTCPeerConnection.prototype.addStream;e$.RTCPeerConnection.prototype.addStream=function(i$){this._senders=this._senders||[],r$.apply(this,[i$]),i$.getTracks().forEach(o$=>{this._senders.push(t$(this,o$))})};let n$=e$.RTCPeerConnection.prototype.removeStream;e$.RTCPeerConnection.prototype.removeStream=function(i$){this._senders=this._senders||[],n$.apply(this,[i$]),i$.getTracks().forEach(o$=>{let s$=this._senders.find(a$=>a$.track===o$);s$&&this._senders.splice(this._senders.indexOf(s$),1)})}}else if(typeof e$=="object"&&e$.RTCPeerConnection&&"getSenders"in e$.RTCPeerConnection.prototype&&"createDTMFSender"in e$.RTCPeerConnection.prototype&&e$.RTCRtpSender&&!("dtmf"in e$.RTCRtpSender.prototype)){let t$=e$.RTCPeerConnection.prototype.getSenders;e$.RTCPeerConnection.prototype.getSenders=function(){let r$=t$.apply(this,[]);return r$.forEach(n$=>n$._pc=this),r$},Object.defineProperty(e$.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Fb(e$){if(!e$.RTCPeerConnection)return;let t$=e$.RTCPeerConnection.prototype.getStats;e$.RTCPeerConnection.prototype.getStats=function(){let[r$,n$,i$]=arguments;if(arguments.length>0&&typeof r$=="function")return t$.apply(this,arguments);if(t$.length===0&&(arguments.length===0||typeof r$!="function"))return t$.apply(this,[]);let o$=function(a$){let c$={};return a$.result().forEach(u$=>{let l$={id:u$.id,timestamp:u$.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[u$.type]||u$.type};u$.names().forEach(d$=>{l$[d$]=u$.stat(d$)}),c$[l$.id]=l$}),c$},s$=function(a$){return new Map(Object.keys(a$).map(c$=>[c$,a$[c$]]))};if(arguments.length>=2){let a$=function(c$){n$(s$(o$(c$)))};return t$.apply(this,[a$,r$])}return new j((a$,c$)=>{t$.apply(this,[function(u$){a$(s$(o$(u$)))},c$])}).then(n$,i$)}}function Bb(e$){if(!(typeof e$=="object"&&e$.RTCPeerConnection&&e$.RTCRtpSender&&e$.RTCRtpReceiver))return;if(!("getStats"in e$.RTCRtpSender.prototype)){let r$=e$.RTCPeerConnection.prototype.getSenders;r$&&(e$.RTCPeerConnection.prototype.getSenders=function(){let i$=r$.apply(this,[]);return i$.forEach(o$=>o$._pc=this),i$});let n$=e$.RTCPeerConnection.prototype.addTrack;n$&&(e$.RTCPeerConnection.prototype.addTrack=function(){let i$=n$.apply(this,arguments);return i$._pc=this,i$}),e$.RTCRtpSender.prototype.getStats=function(){let i$=this;return this._pc.getStats().then(o$=>Sg(o$,i$.track,!0))}}if(!("getStats"in e$.RTCRtpReceiver.prototype)){let r$=e$.RTCPeerConnection.prototype.getReceivers;r$&&(e$.RTCPeerConnection.prototype.getReceivers=function(){let n$=r$.apply(this,[]);return n$.forEach(i$=>i$._pc=this),n$}),ts(e$,"track",n$=>(n$.receiver._pc=n$.srcElement,n$)),e$.RTCRtpReceiver.prototype.getStats=function(){let n$=this;return this._pc.getStats().then(i$=>Sg(i$,n$.track,!1))}}if(!("getStats"in e$.RTCRtpSender.prototype)||!("getStats"in e$.RTCRtpReceiver.prototype))return;let t$=e$.RTCPeerConnection.prototype.getStats;e$.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e$.MediaStreamTrack){let r$=arguments[0],n$,i$,o$;return this.getSenders().forEach(s$=>{s$.track===r$&&(n$?o$=!0:n$=s$)}),this.getReceivers().forEach(s$=>(s$.track===r$&&(i$?o$=!0:i$=s$),s$.track===r$)),o$||n$&&i$?j.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n$?n$.getStats():i$?i$.getStats():j.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t$.apply(this,arguments)}}function jb(e$){e$.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o$=>this._shimmedLocalStreams[o$][0])};let t$=e$.RTCPeerConnection.prototype.addTrack;e$.RTCPeerConnection.prototype.addTrack=function(o$,s$){if(!s$)return t$.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let a$=t$.apply(this,arguments);return this._shimmedLocalStreams[s$.id]?this._shimmedLocalStreams[s$.id].indexOf(a$)===-1&&this._shimmedLocalStreams[s$.id].push(a$):this._shimmedLocalStreams[s$.id]=[s$,a$],a$};let r$=e$.RTCPeerConnection.prototype.addStream;e$.RTCPeerConnection.prototype.addStream=function(o$){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o$.getTracks().forEach(c$=>{if(this.getSenders().find(u$=>u$.track===c$))throw new DOMException("Track already exists.","InvalidAccessError")});let s$=this.getSenders();r$.apply(this,arguments);let a$=this.getSenders().filter(c$=>s$.indexOf(c$)===-1);this._shimmedLocalStreams[o$.id]=[o$].concat(a$)};let n$=e$.RTCPeerConnection.prototype.removeStream;e$.RTCPeerConnection.prototype.removeStream=function(o$){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o$.id],n$.apply(this,arguments)};let i$=e$.RTCPeerConnection.prototype.removeTrack;e$.RTCPeerConnection.prototype.removeTrack=function(o$){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o$&&Object.keys(this._shimmedLocalStreams).forEach(s$=>{let a$=this._shimmedLocalStreams[s$].indexOf(o$);a$!==-1&&this._shimmedLocalStreams[s$].splice(a$,1),this._shimmedLocalStreams[s$].length===1&&delete this._shimmedLocalStreams[s$]}),i$.apply(this,arguments)}}function Gb(e$,t$){if(!e$.RTCPeerConnection)return;if(e$.RTCPeerConnection.prototype.addTrack&&t$.version>=65)return jb(e$);let r$=e$.RTCPeerConnection.prototype.getLocalStreams;e$.RTCPeerConnection.prototype.getLocalStreams=function(){let c$=r$.apply(this);return this._reverseStreams=this._reverseStreams||{},c$.map(u$=>this._reverseStreams[u$.id])};let n$=e$.RTCPeerConnection.prototype.addStream;e$.RTCPeerConnection.prototype.addStream=function(c$){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c$.getTracks().forEach(u$=>{if(this.getSenders().find(l$=>l$.track===u$))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c$.id]){let u$=new e$.MediaStream(c$.getTracks());this._streams[c$.id]=u$,this._reverseStreams[u$.id]=c$,c$=u$}n$.apply(this,[c$])};let i$=e$.RTCPeerConnection.prototype.removeStream;function o$(c$,u$){let l$=u$.sdp;return Object.keys(c$._reverseStreams||[]).forEach(d$=>{let h$=c$._reverseStreams[d$],p$=c$._streams[h$.id];l$=l$.replace(new RegExp(p$.id,"g"),h$.id)}),new RTCSessionDescription({type:u$.type,sdp:l$})}e$.RTCPeerConnection.prototype.removeStream=function(c$){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i$.apply(this,[this._streams[c$.id]||c$]),delete this._reverseStreams[this._streams[c$.id]?this._streams[c$.id].id:c$.id],delete this._streams[c$.id]},e$.RTCPeerConnection.prototype.addTrack=function(c$,u$){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let l$=[].slice.call(arguments,1);if(l$.length!==1||!l$[0].getTracks().find(h$=>h$===c$))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(h$=>h$.track===c$))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let d$=this._streams[u$.id];if(d$)d$.addTrack(c$),j.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let h$=new e$.MediaStream([c$]);this._streams[u$.id]=h$,this._reverseStreams[h$.id]=u$,this.addStream(h$)}return this.getSenders().find(h$=>h$.track===c$)},["createOffer","createAnswer"].forEach(function(c$){let u$=e$.RTCPeerConnection.prototype[c$],l$={[c$](){let d$=arguments;return arguments.length&&typeof arguments[0]=="function"?u$.apply(this,[h$=>{let p$=o$(this,h$);d$[0].apply(null,[p$])},h$=>{d$[1]&&d$[1].apply(null,h$)},arguments[2]]):u$.apply(this,arguments).then(h$=>o$(this,h$))}};e$.RTCPeerConnection.prototype[c$]=l$[c$]});let s$=e$.RTCPeerConnection.prototype.setLocalDescription;e$.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(c$,u$){let l$=u$.sdp;return Object.keys(c$._reverseStreams||[]).forEach(d$=>{let h$=c$._reverseStreams[d$],p$=c$._streams[h$.id];l$=l$.replace(new RegExp(h$.id,"g"),p$.id)}),new RTCSessionDescription({type:u$.type,sdp:l$})}(this,arguments[0]),s$.apply(this,arguments)):s$.apply(this,arguments)};let a$=Object.getOwnPropertyDescriptor(e$.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e$.RTCPeerConnection.prototype,"localDescription",{get(){let c$=a$.get.apply(this);return c$.type===""?c$:o$(this,c$)}}),e$.RTCPeerConnection.prototype.removeTrack=function(c$){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c$._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(c$._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let u$;this._streams=this._streams||{},Object.keys(this._streams).forEach(l$=>{this._streams[l$].getTracks().find(d$=>c$.track===d$)&&(u$=this._streams[l$])}),u$&&(u$.getTracks().length===1?this.removeStream(this._reverseStreams[u$.id]):u$.removeTrack(c$.track),this.dispatchEvent(new Event("negotiationneeded")))}}function aE(e$,t$){!e$.RTCPeerConnection&&e$.webkitRTCPeerConnection&&(e$.RTCPeerConnection=e$.webkitRTCPeerConnection),e$.RTCPeerConnection&&t$.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r$){let n$=e$.RTCPeerConnection.prototype[r$],i$={[r$](){return arguments[0]=new(r$==="addIceCandidate"?e$.RTCIceCandidate:e$.RTCSessionDescription)(arguments[0]),n$.apply(this,arguments)}};e$.RTCPeerConnection.prototype[r$]=i$[r$]})}function Wb(e$,t$){ts(e$,"negotiationneeded",r$=>{let n$=r$.target;if(!(t$.version<72||n$.getConfiguration&&n$.getConfiguration().sdpSemantics==="plan-b")||n$.signalingState==="stable")return r$})}var RT=Object.freeze({__proto__:null,fixNegotiationNeeded:Wb,shimAddTrackRemoveTrack:Gb,shimAddTrackRemoveTrackWithNative:jb,shimGetDisplayMedia:function(e$,t$){e$.navigator.mediaDevices&&"getDisplayMedia"in e$.navigator.mediaDevices||e$.navigator.mediaDevices&&(typeof t$=="function"?e$.navigator.mediaDevices.getDisplayMedia=function(r$){return t$(r$).then(n$=>{let i$=r$.video&&r$.video.width,o$=r$.video&&r$.video.height,s$=r$.video&&r$.video.frameRate;return r$.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n$,maxFrameRate:s$||3}},i$&&(r$.video.mandatory.maxWidth=i$),o$&&(r$.video.mandatory.maxHeight=o$),e$.navigator.mediaDevices.getUserMedia(r$)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Vb,shimGetStats:Fb,shimGetUserMedia:Mb,shimMediaStream:Ub,shimOnTrack:xb,shimPeerConnection:aE,shimSenderReceiverGetStats:Bb});function Hb(e$,t$){let r$=e$&&e$.navigator,n$=e$&&e$.MediaStreamTrack;if(r$.getUserMedia=function(i$,o$,s$){Pm("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r$.mediaDevices.getUserMedia(i$).then(o$,s$)},!(t$.version>55&&"autoGainControl"in r$.mediaDevices.getSupportedConstraints())){let i$=function(s$,a$,c$){a$ in s$&&!(c$ in s$)&&(s$[c$]=s$[a$],delete s$[a$])},o$=r$.mediaDevices.getUserMedia.bind(r$.mediaDevices);if(r$.mediaDevices.getUserMedia=function(s$){return typeof s$=="object"&&typeof s$.audio=="object"&&(s$=JSON.parse(JSON.stringify(s$)),i$(s$.audio,"autoGainControl","mozAutoGainControl"),i$(s$.audio,"noiseSuppression","mozNoiseSuppression")),o$(s$)},n$&&n$.prototype.getSettings){let s$=n$.prototype.getSettings;n$.prototype.getSettings=function(){let a$=s$.apply(this,arguments);return i$(a$,"mozAutoGainControl","autoGainControl"),i$(a$,"mozNoiseSuppression","noiseSuppression"),a$}}if(n$&&n$.prototype.applyConstraints){let s$=n$.prototype.applyConstraints;n$.prototype.applyConstraints=function(a$){return this.kind==="audio"&&typeof a$=="object"&&(a$=JSON.parse(JSON.stringify(a$)),i$(a$,"autoGainControl","mozAutoGainControl"),i$(a$,"noiseSuppression","mozNoiseSuppression")),s$.apply(this,[a$])}}}}function Kb(e$){typeof e$=="object"&&e$.RTCTrackEvent&&"receiver"in e$.RTCTrackEvent.prototype&&!("transceiver"in e$.RTCTrackEvent.prototype)&&Object.defineProperty(e$.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function cE(e$,t$){if(typeof e$!="object"||!e$.RTCPeerConnection&&!e$.mozRTCPeerConnection)return;!e$.RTCPeerConnection&&e$.mozRTCPeerConnection&&(e$.RTCPeerConnection=e$.mozRTCPeerConnection),t$.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i$){let o$=e$.RTCPeerConnection.prototype[i$],s$={[i$](){return arguments[0]=new(i$==="addIceCandidate"?e$.RTCIceCandidate:e$.RTCSessionDescription)(arguments[0]),o$.apply(this,arguments)}};e$.RTCPeerConnection.prototype[i$]=s$[i$]});let r$={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n$=e$.RTCPeerConnection.prototype.getStats;e$.RTCPeerConnection.prototype.getStats=function(){let[i$,o$,s$]=arguments;return n$.apply(this,[i$||null]).then(a$=>{if(t$.version<53&&!o$)try{a$.forEach(c$=>{c$.type=r$[c$.type]||c$.type})}catch(c$){if(c$.name!=="TypeError")throw c$;a$.forEach((u$,l$)=>{a$.set(l$,Object.assign({},u$,{type:r$[u$.type]||u$.type}))})}return a$}).then(o$,s$)}}function Yb(e$){if(typeof e$!="object"||!e$.RTCPeerConnection||!e$.RTCRtpSender||e$.RTCRtpSender&&"getStats"in e$.RTCRtpSender.prototype)return;let t$=e$.RTCPeerConnection.prototype.getSenders;t$&&(e$.RTCPeerConnection.prototype.getSenders=function(){let n$=t$.apply(this,[]);return n$.forEach(i$=>i$._pc=this),n$});let r$=e$.RTCPeerConnection.prototype.addTrack;r$&&(e$.RTCPeerConnection.prototype.addTrack=function(){let n$=r$.apply(this,arguments);return n$._pc=this,n$}),e$.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):j.resolve(new Map)}}function qb(e$){if(typeof e$!="object"||!e$.RTCPeerConnection||!e$.RTCRtpSender||e$.RTCRtpSender&&"getStats"in e$.RTCRtpReceiver.prototype)return;let t$=e$.RTCPeerConnection.prototype.getReceivers;t$&&(e$.RTCPeerConnection.prototype.getReceivers=function(){let r$=t$.apply(this,[]);return r$.forEach(n$=>n$._pc=this),r$}),ts(e$,"track",r$=>(r$.receiver._pc=r$.srcElement,r$)),e$.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function zb(e$){e$.RTCPeerConnection&&!("removeStream"in e$.RTCPeerConnection.prototype)&&(e$.RTCPeerConnection.prototype.removeStream=function(t$){Pm("removeStream","removeTrack"),this.getSenders().forEach(r$=>{var n$;r$.track&&W(n$=t$.getTracks()).call(n$,r$.track)&&this.removeTrack(r$)})})}function Jb(e$){e$.DataChannel&&!e$.RTCDataChannel&&(e$.RTCDataChannel=e$.DataChannel)}function Xb(e$){if(typeof e$!="object"||!e$.RTCPeerConnection)return;let t$=e$.RTCPeerConnection.prototype.addTransceiver;t$&&(e$.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r$=arguments[1]&&arguments[1].sendEncodings;r$===void 0&&(r$=[]),r$=[...r$];let n$=r$.length>0;n$&&r$.forEach(o$=>{if("rid"in o$&&!/^[a-z0-9]{0,16}$/i.test(o$.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o$&&!(parseFloat(o$.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o$&&!(parseFloat(o$.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let i$=t$.apply(this,arguments);if(n$){let{sender:o$}=i$,s$=o$.getParameters();(!("encodings"in s$)||s$.encodings.length===1&&Object.keys(s$.encodings[0]).length===0)&&(s$.encodings=r$,o$.sendEncodings=r$,this.setParametersPromises.push(o$.setParameters(s$).then(()=>{delete o$.sendEncodings}).catch(()=>{delete o$.sendEncodings})))}return i$})}function Qb(e$){if(typeof e$!="object"||!e$.RTCRtpSender)return;let t$=e$.RTCRtpSender.prototype.getParameters;t$&&(e$.RTCRtpSender.prototype.getParameters=function(){let r$=t$.apply(this,arguments);return"encodings"in r$||(r$.encodings=[].concat(this.sendEncodings||[{}])),r$})}function Zb(e$){if(typeof e$!="object"||!e$.RTCPeerConnection)return;let t$=e$.RTCPeerConnection.prototype.createOffer;e$.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?j.all(this.setParametersPromises).then(()=>t$.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t$.apply(this,arguments)}}function $b(e$){if(typeof e$!="object"||!e$.RTCPeerConnection)return;let t$=e$.RTCPeerConnection.prototype.createAnswer;e$.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?j.all(this.setParametersPromises).then(()=>t$.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t$.apply(this,arguments)}}var CT=Object.freeze({__proto__:null,shimAddTransceiver:Xb,shimCreateAnswer:$b,shimCreateOffer:Zb,shimGetDisplayMedia:function(e$,t$){e$.navigator.mediaDevices&&"getDisplayMedia"in e$.navigator.mediaDevices||e$.navigator.mediaDevices&&(e$.navigator.mediaDevices.getDisplayMedia=function(r$){if(!r$||!r$.video){let n$=new DOMException("getDisplayMedia without video constraints is undefined");return n$.name="NotFoundError",n$.code=8,j.reject(n$)}return r$.video===!0?r$.video={mediaSource:t$}:r$.video.mediaSource=t$,e$.navigator.mediaDevices.getUserMedia(r$)})},shimGetParameters:Qb,shimGetUserMedia:Hb,shimOnTrack:Kb,shimPeerConnection:cE,shimRTCDataChannel:Jb,shimReceiverGetStats:qb,shimRemoveStream:zb,shimSenderGetStats:Yb});function tw(e$){if(typeof e$=="object"&&e$.RTCPeerConnection){if("getLocalStreams"in e$.RTCPeerConnection.prototype||(e$.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e$.RTCPeerConnection.prototype)){let t$=e$.RTCPeerConnection.prototype.addTrack;e$.RTCPeerConnection.prototype.addStream=function(r$){var n$;this._localStreams||(this._localStreams=[]),W(n$=this._localStreams).call(n$,r$)||this._localStreams.push(r$),r$.getAudioTracks().forEach(i$=>t$.call(this,i$,r$)),r$.getVideoTracks().forEach(i$=>t$.call(this,i$,r$))},e$.RTCPeerConnection.prototype.addTrack=function(r$){for(var n$=arguments.length,i$=new Array(n$>1?n$-1:0),o$=1;o$<n$;o$++)i$[o$-1]=arguments[o$];return i$&&i$.forEach(s$=>{var a$;this._localStreams?W(a$=this._localStreams).call(a$,s$)||this._localStreams.push(s$):this._localStreams=[s$]}),t$.apply(this,arguments)}}"removeStream"in e$.RTCPeerConnection.prototype||(e$.RTCPeerConnection.prototype.removeStream=function(t$){this._localStreams||(this._localStreams=[]);let r$=this._localStreams.indexOf(t$);if(r$===-1)return;this._localStreams.splice(r$,1);let n$=t$.getTracks();this.getSenders().forEach(i$=>{W(n$).call(n$,i$.track)&&this.removeTrack(i$)})})}}function ew(e$){if(typeof e$=="object"&&e$.RTCPeerConnection&&("getRemoteStreams"in e$.RTCPeerConnection.prototype||(e$.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e$.RTCPeerConnection.prototype))){Object.defineProperty(e$.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r$){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r$),this.addEventListener("track",this._onaddstreampoly=n$=>{n$.streams.forEach(i$=>{var o$;if(this._remoteStreams||(this._remoteStreams=[]),W(o$=this._remoteStreams).call(o$,i$))return;this._remoteStreams.push(i$);let s$=new Event("addstream");s$.stream=i$,this.dispatchEvent(s$)})})}});let t$=e$.RTCPeerConnection.prototype.setRemoteDescription;e$.RTCPeerConnection.prototype.setRemoteDescription=function(){let r$=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n$){n$.streams.forEach(i$=>{if(r$._remoteStreams||(r$._remoteStreams=[]),r$._remoteStreams.indexOf(i$)>=0)return;r$._remoteStreams.push(i$);let o$=new Event("addstream");o$.stream=i$,r$.dispatchEvent(o$)})}),t$.apply(r$,arguments)}}}function nw(e$){if(typeof e$!="object"||!e$.RTCPeerConnection)return;let t$=e$.RTCPeerConnection.prototype,r$=t$.createOffer,n$=t$.createAnswer,i$=t$.setLocalDescription,o$=t$.setRemoteDescription,s$=t$.addIceCandidate;t$.createOffer=function(c$,u$){let l$=arguments.length>=2?arguments[2]:arguments[0],d$=r$.apply(this,[l$]);return u$?(d$.then(c$,u$),j.resolve()):d$},t$.createAnswer=function(c$,u$){let l$=arguments.length>=2?arguments[2]:arguments[0],d$=n$.apply(this,[l$]);return u$?(d$.then(c$,u$),j.resolve()):d$};let a$=function(c$,u$,l$){let d$=i$.apply(this,[c$]);return l$?(d$.then(u$,l$),j.resolve()):d$};t$.setLocalDescription=a$,a$=function(c$,u$,l$){let d$=o$.apply(this,[c$]);return l$?(d$.then(u$,l$),j.resolve()):d$},t$.setRemoteDescription=a$,a$=function(c$,u$,l$){let d$=s$.apply(this,[c$]);return l$?(d$.then(u$,l$),j.resolve()):d$},t$.addIceCandidate=a$}function iw(e$){let t$=e$&&e$.navigator;if(t$.mediaDevices&&t$.mediaDevices.getUserMedia){let r$=t$.mediaDevices,n$=r$.getUserMedia.bind(r$);t$.mediaDevices.getUserMedia=i$=>n$(rw(i$))}!t$.getUserMedia&&t$.mediaDevices&&t$.mediaDevices.getUserMedia&&(t$.getUserMedia=(function(r$,n$,i$){t$.mediaDevices.getUserMedia(r$).then(n$,i$)}).bind(t$))}function rw(e$){return e$&&e$.video!==void 0?Object.assign({},e$,{video:GA(e$.video)}):e$}function ow(e$){if(!e$.RTCPeerConnection)return;let t$=e$.RTCPeerConnection;e$.RTCPeerConnection=function(r$,n$){if(r$&&r$.iceServers){let i$=[];for(let o$=0;o$<r$.iceServers.length;o$++){let s$=r$.iceServers[o$];!s$.hasOwnProperty("urls")&&s$.hasOwnProperty("url")?(Pm("RTCIceServer.url","RTCIceServer.urls"),s$=JSON.parse(JSON.stringify(s$)),s$.urls=s$.url,delete s$.url,i$.push(s$)):i$.push(r$.iceServers[o$])}r$.iceServers=i$}return new t$(r$,n$)},e$.RTCPeerConnection.prototype=t$.prototype,"generateCertificate"in t$&&Object.defineProperty(e$.RTCPeerConnection,"generateCertificate",{get:()=>t$.generateCertificate})}function sw(e$){typeof e$=="object"&&e$.RTCTrackEvent&&"receiver"in e$.RTCTrackEvent.prototype&&!("transceiver"in e$.RTCTrackEvent.prototype)&&Object.defineProperty(e$.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function aw(e$){let t$=e$.RTCPeerConnection.prototype.createOffer;e$.RTCPeerConnection.prototype.createOffer=function(r$){if(r$){r$.offerToReceiveAudio!==void 0&&(r$.offerToReceiveAudio=!!r$.offerToReceiveAudio);let n$=this.getTransceivers().find(o$=>o$.receiver.track.kind==="audio");r$.offerToReceiveAudio===!1&&n$?n$.direction==="sendrecv"?n$.setDirection?n$.setDirection("sendonly"):n$.direction="sendonly":n$.direction==="recvonly"&&(n$.setDirection?n$.setDirection("inactive"):n$.direction="inactive"):r$.offerToReceiveAudio!==!0||n$||this.addTransceiver("audio",{direction:"recvonly"}),r$.offerToReceiveVideo!==void 0&&(r$.offerToReceiveVideo=!!r$.offerToReceiveVideo);let i$=this.getTransceivers().find(o$=>o$.receiver.track.kind==="video");r$.offerToReceiveVideo===!1&&i$?i$.direction==="sendrecv"?i$.setDirection?i$.setDirection("sendonly"):i$.direction="sendonly":i$.direction==="recvonly"&&(i$.setDirection?i$.setDirection("inactive"):i$.direction="inactive"):r$.offerToReceiveVideo!==!0||i$||this.addTransceiver("video",{direction:"recvonly"})}return t$.apply(this,arguments)}}function cw(e$){typeof e$!="object"||e$.AudioContext||(e$.AudioContext=e$.webkitAudioContext)}var IT=Object.freeze({__proto__:null,shimAudioContext:cw,shimCallbacksAPI:nw,shimConstraints:rw,shimCreateOfferLegacy:aw,shimGetUserMedia:iw,shimLocalStreamsAPI:tw,shimRTCIceServerUrls:ow,shimRemoteStreamsAPI:ew,shimTrackEventTransceiver:sw}),dw=`	
\v\f\r \u2028\u2029\uFEFF`,qU=la,zU=oi,dE=dw,vT=me("".replace),JU=RegExp("^["+dE+"]+"),XU=RegExp("(^|[^"+dE+"])["+dE+"]+$"),Qh=function(e$){return function(t$){var r$=zU(qU(t$));return 1&e$&&(r$=vT(r$,JU,"")),2&e$&&(r$=vT(r$,XU,"$1")),r$}},QU={start:Qh(1),end:Qh(2),trim:Qh(3)},ZU=tb.PROPER,$U=Se,yT=dw,t2=QU.trim;xt({target:"String",proto:!0,forced:function(e$){return $U(function(){return!!yT[e$]()||""[e$]()!==""||ZU&&yT[e$].name!==e$})}("trim")},{trim:function(){return t2(this)}});var e2=bi("String").trim,n2=hn,i2=e2,Zh=String.prototype,r2=function(e$){var t$=e$.trim;return typeof e$=="string"||e$===Zh||n2(Zh,e$)&&t$===Zh.trim?i2:t$},rn=ae(r2),lw={exports:{}};(function(e$){let t$={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t$.localCName=t$.generateIdentifier(),t$.splitLines=function(r$){return r$.trim().split(`
`).map(n$=>n$.trim())},t$.splitSections=function(r$){return r$.split(`
m=`).map((n$,i$)=>(i$>0?"m="+n$:n$).trim()+`\r
`)},t$.getDescription=function(r$){let n$=t$.splitSections(r$);return n$&&n$[0]},t$.getMediaSections=function(r$){let n$=t$.splitSections(r$);return n$.shift(),n$},t$.matchPrefix=function(r$,n$){return t$.splitLines(r$).filter(i$=>i$.indexOf(n$)===0)},t$.parseCandidate=function(r$){let n$;n$=r$.indexOf("a=candidate:")===0?r$.substring(12).split(" "):r$.substring(10).split(" ");let i$={foundation:n$[0],component:{1:"rtp",2:"rtcp"}[n$[1]]||n$[1],protocol:n$[2].toLowerCase(),priority:parseInt(n$[3],10),ip:n$[4],address:n$[4],port:parseInt(n$[5],10),type:n$[7]};for(let o$=8;o$<n$.length;o$+=2)switch(n$[o$]){case"raddr":i$.relatedAddress=n$[o$+1];break;case"rport":i$.relatedPort=parseInt(n$[o$+1],10);break;case"tcptype":i$.tcpType=n$[o$+1];break;case"ufrag":i$.ufrag=n$[o$+1],i$.usernameFragment=n$[o$+1];break;default:i$[n$[o$]]===void 0&&(i$[n$[o$]]=n$[o$+1])}return i$},t$.writeCandidate=function(r$){let n$=[];n$.push(r$.foundation);let i$=r$.component;i$==="rtp"?n$.push(1):i$==="rtcp"?n$.push(2):n$.push(i$),n$.push(r$.protocol.toUpperCase()),n$.push(r$.priority),n$.push(r$.address||r$.ip),n$.push(r$.port);let o$=r$.type;return n$.push("typ"),n$.push(o$),o$!=="host"&&r$.relatedAddress&&r$.relatedPort&&(n$.push("raddr"),n$.push(r$.relatedAddress),n$.push("rport"),n$.push(r$.relatedPort)),r$.tcpType&&r$.protocol.toLowerCase()==="tcp"&&(n$.push("tcptype"),n$.push(r$.tcpType)),(r$.usernameFragment||r$.ufrag)&&(n$.push("ufrag"),n$.push(r$.usernameFragment||r$.ufrag)),"candidate:"+n$.join(" ")},t$.parseIceOptions=function(r$){return r$.substring(14).split(" ")},t$.parseRtpMap=function(r$){let n$=r$.substring(9).split(" "),i$={payloadType:parseInt(n$.shift(),10)};return n$=n$[0].split("/"),i$.name=n$[0],i$.clockRate=parseInt(n$[1],10),i$.channels=n$.length===3?parseInt(n$[2],10):1,i$.numChannels=i$.channels,i$},t$.writeRtpMap=function(r$){let n$=r$.payloadType;r$.preferredPayloadType!==void 0&&(n$=r$.preferredPayloadType);let i$=r$.channels||r$.numChannels||1;return"a=rtpmap:"+n$+" "+r$.name+"/"+r$.clockRate+(i$!==1?"/"+i$:"")+`\r
`},t$.parseExtmap=function(r$){let n$=r$.substring(9).split(" ");return{id:parseInt(n$[0],10),direction:n$[0].indexOf("/")>0?n$[0].split("/")[1]:"sendrecv",uri:n$[1],attributes:n$.slice(2).join(" ")}},t$.writeExtmap=function(r$){return"a=extmap:"+(r$.id||r$.preferredId)+(r$.direction&&r$.direction!=="sendrecv"?"/"+r$.direction:"")+" "+r$.uri+(r$.attributes?" "+r$.attributes:"")+`\r
`},t$.parseFmtp=function(r$){let n$={},i$,o$=r$.substring(r$.indexOf(" ")+1).split(";");for(let s$=0;s$<o$.length;s$++)i$=o$[s$].trim().split("="),n$[i$[0].trim()]=i$[1];return n$},t$.writeFmtp=function(r$){let n$="",i$=r$.payloadType;if(r$.preferredPayloadType!==void 0&&(i$=r$.preferredPayloadType),r$.parameters&&Object.keys(r$.parameters).length){let o$=[];Object.keys(r$.parameters).forEach(s$=>{r$.parameters[s$]!==void 0?o$.push(s$+"="+r$.parameters[s$]):o$.push(s$)}),n$+="a=fmtp:"+i$+" "+o$.join(";")+`\r
`}return n$},t$.parseRtcpFb=function(r$){let n$=r$.substring(r$.indexOf(" ")+1).split(" ");return{type:n$.shift(),parameter:n$.join(" ")}},t$.writeRtcpFb=function(r$){let n$="",i$=r$.payloadType;return r$.preferredPayloadType!==void 0&&(i$=r$.preferredPayloadType),r$.rtcpFeedback&&r$.rtcpFeedback.length&&r$.rtcpFeedback.forEach(o$=>{n$+="a=rtcp-fb:"+i$+" "+o$.type+(o$.parameter&&o$.parameter.length?" "+o$.parameter:"")+`\r
`}),n$},t$.parseSsrcMedia=function(r$){let n$=r$.indexOf(" "),i$={ssrc:parseInt(r$.substring(7,n$),10)},o$=r$.indexOf(":",n$);return o$>-1?(i$.attribute=r$.substring(n$+1,o$),i$.value=r$.substring(o$+1)):i$.attribute=r$.substring(n$+1),i$},t$.parseSsrcGroup=function(r$){let n$=r$.substring(13).split(" ");return{semantics:n$.shift(),ssrcs:n$.map(i$=>parseInt(i$,10))}},t$.getMid=function(r$){let n$=t$.matchPrefix(r$,"a=mid:")[0];if(n$)return n$.substring(6)},t$.parseFingerprint=function(r$){let n$=r$.substring(14).split(" ");return{algorithm:n$[0].toLowerCase(),value:n$[1].toUpperCase()}},t$.getDtlsParameters=function(r$,n$){return{role:"auto",fingerprints:t$.matchPrefix(r$+n$,"a=fingerprint:").map(t$.parseFingerprint)}},t$.writeDtlsParameters=function(r$,n$){let i$="a=setup:"+n$+`\r
`;return r$.fingerprints.forEach(o$=>{i$+="a=fingerprint:"+o$.algorithm+" "+o$.value+`\r
`}),i$},t$.parseCryptoLine=function(r$){let n$=r$.substring(9).split(" ");return{tag:parseInt(n$[0],10),cryptoSuite:n$[1],keyParams:n$[2],sessionParams:n$.slice(3)}},t$.writeCryptoLine=function(r$){return"a=crypto:"+r$.tag+" "+r$.cryptoSuite+" "+(typeof r$.keyParams=="object"?t$.writeCryptoKeyParams(r$.keyParams):r$.keyParams)+(r$.sessionParams?" "+r$.sessionParams.join(" "):"")+`\r
`},t$.parseCryptoKeyParams=function(r$){if(r$.indexOf("inline:")!==0)return null;let n$=r$.substring(7).split("|");return{keyMethod:"inline",keySalt:n$[0],lifeTime:n$[1],mkiValue:n$[2]?n$[2].split(":")[0]:void 0,mkiLength:n$[2]?n$[2].split(":")[1]:void 0}},t$.writeCryptoKeyParams=function(r$){return r$.keyMethod+":"+r$.keySalt+(r$.lifeTime?"|"+r$.lifeTime:"")+(r$.mkiValue&&r$.mkiLength?"|"+r$.mkiValue+":"+r$.mkiLength:"")},t$.getCryptoParameters=function(r$,n$){return t$.matchPrefix(r$+n$,"a=crypto:").map(t$.parseCryptoLine)},t$.getIceParameters=function(r$,n$){let i$=t$.matchPrefix(r$+n$,"a=ice-ufrag:")[0],o$=t$.matchPrefix(r$+n$,"a=ice-pwd:")[0];return i$&&o$?{usernameFragment:i$.substring(12),password:o$.substring(10)}:null},t$.writeIceParameters=function(r$){let n$="a=ice-ufrag:"+r$.usernameFragment+`\r
a=ice-pwd:`+r$.password+`\r
`;return r$.iceLite&&(n$+=`a=ice-lite\r
`),n$},t$.parseRtpParameters=function(r$){let n$={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i$=t$.splitLines(r$)[0].split(" ");n$.profile=i$[2];for(let s$=3;s$<i$.length;s$++){let a$=i$[s$],c$=t$.matchPrefix(r$,"a=rtpmap:"+a$+" ")[0];if(c$){let u$=t$.parseRtpMap(c$),l$=t$.matchPrefix(r$,"a=fmtp:"+a$+" ");switch(u$.parameters=l$.length?t$.parseFmtp(l$[0]):{},u$.rtcpFeedback=t$.matchPrefix(r$,"a=rtcp-fb:"+a$+" ").map(t$.parseRtcpFb),n$.codecs.push(u$),u$.name.toUpperCase()){case"RED":case"ULPFEC":n$.fecMechanisms.push(u$.name.toUpperCase())}}}t$.matchPrefix(r$,"a=extmap:").forEach(s$=>{n$.headerExtensions.push(t$.parseExtmap(s$))});let o$=t$.matchPrefix(r$,"a=rtcp-fb:* ").map(t$.parseRtcpFb);return n$.codecs.forEach(s$=>{o$.forEach(a$=>{s$.rtcpFeedback.find(c$=>c$.type===a$.type&&c$.parameter===a$.parameter)||s$.rtcpFeedback.push(a$)})}),n$},t$.writeRtpDescription=function(r$,n$){let i$="";i$+="m="+r$+" ",i$+=n$.codecs.length>0?"9":"0",i$+=" "+(n$.profile||"UDP/TLS/RTP/SAVPF")+" ",i$+=n$.codecs.map(s$=>s$.preferredPayloadType!==void 0?s$.preferredPayloadType:s$.payloadType).join(" ")+`\r
`,i$+=`c=IN IP4 0.0.0.0\r
`,i$+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n$.codecs.forEach(s$=>{i$+=t$.writeRtpMap(s$),i$+=t$.writeFmtp(s$),i$+=t$.writeRtcpFb(s$)});let o$=0;return n$.codecs.forEach(s$=>{s$.maxptime>o$&&(o$=s$.maxptime)}),o$>0&&(i$+="a=maxptime:"+o$+`\r
`),n$.headerExtensions&&n$.headerExtensions.forEach(s$=>{i$+=t$.writeExtmap(s$)}),i$},t$.parseRtpEncodingParameters=function(r$){let n$=[],i$=t$.parseRtpParameters(r$),o$=i$.fecMechanisms.indexOf("RED")!==-1,s$=i$.fecMechanisms.indexOf("ULPFEC")!==-1,a$=t$.matchPrefix(r$,"a=ssrc:").map(h$=>t$.parseSsrcMedia(h$)).filter(h$=>h$.attribute==="cname"),c$=a$.length>0&&a$[0].ssrc,u$,l$=t$.matchPrefix(r$,"a=ssrc-group:FID").map(h$=>h$.substring(17).split(" ").map(p$=>parseInt(p$,10)));l$.length>0&&l$[0].length>1&&l$[0][0]===c$&&(u$=l$[0][1]),i$.codecs.forEach(h$=>{if(h$.name.toUpperCase()==="RTX"&&h$.parameters.apt){let p$={ssrc:c$,codecPayloadType:parseInt(h$.parameters.apt,10)};c$&&u$&&(p$.rtx={ssrc:u$}),n$.push(p$),o$&&(p$=JSON.parse(JSON.stringify(p$)),p$.fec={ssrc:c$,mechanism:s$?"red+ulpfec":"red"},n$.push(p$))}}),n$.length===0&&c$&&n$.push({ssrc:c$});let d$=t$.matchPrefix(r$,"b=");return d$.length&&(d$=d$[0].indexOf("b=TIAS:")===0?parseInt(d$[0].substring(7),10):d$[0].indexOf("b=AS:")===0?1e3*parseInt(d$[0].substring(5),10)*.95-16e3:void 0,n$.forEach(h$=>{h$.maxBitrate=d$})),n$},t$.parseRtcpParameters=function(r$){let n$={},i$=t$.matchPrefix(r$,"a=ssrc:").map(a$=>t$.parseSsrcMedia(a$)).filter(a$=>a$.attribute==="cname")[0];i$&&(n$.cname=i$.value,n$.ssrc=i$.ssrc);let o$=t$.matchPrefix(r$,"a=rtcp-rsize");n$.reducedSize=o$.length>0,n$.compound=o$.length===0;let s$=t$.matchPrefix(r$,"a=rtcp-mux");return n$.mux=s$.length>0,n$},t$.writeRtcpParameters=function(r$){let n$="";return r$.reducedSize&&(n$+=`a=rtcp-rsize\r
`),r$.mux&&(n$+=`a=rtcp-mux\r
`),r$.ssrc!==void 0&&r$.cname&&(n$+="a=ssrc:"+r$.ssrc+" cname:"+r$.cname+`\r
`),n$},t$.parseMsid=function(r$){let n$,i$=t$.matchPrefix(r$,"a=msid:");if(i$.length===1)return n$=i$[0].substring(7).split(" "),{stream:n$[0],track:n$[1]};let o$=t$.matchPrefix(r$,"a=ssrc:").map(s$=>t$.parseSsrcMedia(s$)).filter(s$=>s$.attribute==="msid");return o$.length>0?(n$=o$[0].value.split(" "),{stream:n$[0],track:n$[1]}):void 0},t$.parseSctpDescription=function(r$){let n$=t$.parseMLine(r$),i$=t$.matchPrefix(r$,"a=max-message-size:"),o$;i$.length>0&&(o$=parseInt(i$[0].substring(19),10)),isNaN(o$)&&(o$=65536);let s$=t$.matchPrefix(r$,"a=sctp-port:");if(s$.length>0)return{port:parseInt(s$[0].substring(12),10),protocol:n$.fmt,maxMessageSize:o$};let a$=t$.matchPrefix(r$,"a=sctpmap:");if(a$.length>0){let c$=a$[0].substring(10).split(" ");return{port:parseInt(c$[0],10),protocol:c$[1],maxMessageSize:o$}}},t$.writeSctpDescription=function(r$,n$){let i$=[];return i$=r$.protocol!=="DTLS/SCTP"?["m="+r$.kind+" 9 "+r$.protocol+" "+n$.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n$.port+`\r
`]:["m="+r$.kind+" 9 "+r$.protocol+" "+n$.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n$.port+" "+n$.protocol+` 65535\r
`],n$.maxMessageSize!==void 0&&i$.push("a=max-message-size:"+n$.maxMessageSize+`\r
`),i$.join("")},t$.generateSessionId=function(){return Math.random().toString().substr(2,22)},t$.writeSessionBoilerplate=function(r$,n$,i$){let o$,s$=n$!==void 0?n$:2;return o$=r$||t$.generateSessionId(),`v=0\r
o=`+(i$||"thisisadapterortc")+" "+o$+" "+s$+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t$.getDirection=function(r$,n$){let i$=t$.splitLines(r$);for(let o$=0;o$<i$.length;o$++)switch(i$[o$]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i$[o$].substring(2)}return n$?t$.getDirection(n$):"sendrecv"},t$.getKind=function(r$){return t$.splitLines(r$)[0].split(" ")[0].substring(2)},t$.isRejected=function(r$){return r$.split(" ",2)[1]==="0"},t$.parseMLine=function(r$){let n$=t$.splitLines(r$)[0].substring(2).split(" ");return{kind:n$[0],port:parseInt(n$[1],10),protocol:n$[2],fmt:n$.slice(3).join(" ")}},t$.parseOLine=function(r$){let n$=t$.matchPrefix(r$,"o=")[0].substring(2).split(" ");return{username:n$[0],sessionId:n$[1],sessionVersion:parseInt(n$[2],10),netType:n$[3],addressType:n$[4],address:n$[5]}},t$.isValidSDP=function(r$){if(typeof r$!="string"||r$.length===0)return!1;let n$=t$.splitLines(r$);for(let i$=0;i$<n$.length;i$++)if(n$[i$].length<2||n$[i$].charAt(1)!=="=")return!1;return!0},e$.exports=t$})(lw);var uw=lw.exports,Bs=ae(uw),o2=yN({__proto__:null,default:Bs},[uw]);function dl(e$){if(!e$.RTCIceCandidate||e$.RTCIceCandidate&&"foundation"in e$.RTCIceCandidate.prototype)return;let t$=e$.RTCIceCandidate;e$.RTCIceCandidate=function(r$){if(typeof r$=="object"&&r$.candidate&&r$.candidate.indexOf("a=")===0&&((r$=JSON.parse(JSON.stringify(r$))).candidate=r$.candidate.substr(2)),r$.candidate&&r$.candidate.length){let n$=new t$(r$),i$=Bs.parseCandidate(r$.candidate),o$=Object.assign(n$,i$);return o$.toJSON=function(){return{candidate:o$.candidate,sdpMid:o$.sdpMid,sdpMLineIndex:o$.sdpMLineIndex,usernameFragment:o$.usernameFragment}},o$}return new t$(r$)},e$.RTCIceCandidate.prototype=t$.prototype,ts(e$,"icecandidate",r$=>(r$.candidate&&Object.defineProperty(r$,"candidate",{value:new e$.RTCIceCandidate(r$.candidate),writable:"false"}),r$))}function lE(e$){!e$.RTCIceCandidate||e$.RTCIceCandidate&&"relayProtocol"in e$.RTCIceCandidate.prototype||ts(e$,"icecandidate",t$=>{if(t$.candidate){let r$=Bs.parseCandidate(t$.candidate.candidate);r$.type==="relay"&&(t$.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r$.priority>>24])}return t$})}function ll(e$,t$){if(!e$.RTCPeerConnection)return;"sctp"in e$.RTCPeerConnection.prototype||Object.defineProperty(e$.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let r$=function(a$){if(!a$||!a$.sdp)return!1;let c$=Bs.splitSections(a$.sdp);return c$.shift(),c$.some(u$=>{let l$=Bs.parseMLine(u$);return l$&&l$.kind==="application"&&l$.protocol.indexOf("SCTP")!==-1})},n$=function(a$){let c$=a$.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c$===null||c$.length<2)return-1;let u$=parseInt(c$[1],10);return u$!=u$?-1:u$},i$=function(a$){let c$=65536;return t$.browser==="firefox"&&(c$=t$.version<57?a$===-1?16384:2147483637:t$.version<60?t$.version===57?65535:65536:2147483637),c$},o$=function(a$,c$){let u$=65536;t$.browser==="firefox"&&t$.version===57&&(u$=65535);let l$=Bs.matchPrefix(a$.sdp,"a=max-message-size:");return l$.length>0?u$=parseInt(l$[0].substr(19),10):t$.browser==="firefox"&&c$!==-1&&(u$=2147483637),u$},s$=e$.RTCPeerConnection.prototype.setRemoteDescription;e$.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t$.browser==="chrome"&&t$.version>=76){let{sdpSemantics:a$}=this.getConfiguration();a$==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(r$(arguments[0])){let a$=n$(arguments[0]),c$=i$(a$),u$=o$(arguments[0],a$),l$;l$=c$===0&&u$===0?Number.POSITIVE_INFINITY:c$===0||u$===0?Math.max(c$,u$):Math.min(c$,u$);let d$={};Object.defineProperty(d$,"maxMessageSize",{get:()=>l$}),this._sctp=d$}return s$.apply(this,arguments)}}function ul(e$){if(!e$.RTCPeerConnection||!("createDataChannel"in e$.RTCPeerConnection.prototype))return;function t$(n$,i$){let o$=n$.send;n$.send=function(){let s$=arguments[0],a$=s$.length||s$.size||s$.byteLength;if(n$.readyState==="open"&&i$.sctp&&a$>i$.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i$.sctp.maxMessageSize+" bytes)");return o$.apply(n$,arguments)}}let r$=e$.RTCPeerConnection.prototype.createDataChannel;e$.RTCPeerConnection.prototype.createDataChannel=function(){let n$=r$.apply(this,arguments);return t$(n$,this),n$},ts(e$,"datachannel",n$=>(t$(n$.channel,n$.target),n$))}function uE(e$){if(!e$.RTCPeerConnection||"connectionState"in e$.RTCPeerConnection.prototype)return;let t$=e$.RTCPeerConnection.prototype;Object.defineProperty(t$,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t$,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r$){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r$&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r$)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r$=>{let n$=t$[r$];t$[r$]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i$=>{let o$=i$.target;if(o$._lastConnectionState!==o$.connectionState){o$._lastConnectionState=o$.connectionState;let s$=new Event("connectionstatechange",i$);o$.dispatchEvent(s$)}return i$},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n$.apply(this,arguments)}})}function hE(e$,t$){if(!e$.RTCPeerConnection||t$.browser==="chrome"&&t$.version>=71||t$.browser==="safari"&&t$.version>=605)return;let r$=e$.RTCPeerConnection.prototype.setRemoteDescription;e$.RTCPeerConnection.prototype.setRemoteDescription=function(n$){if(n$&&n$.sdp&&n$.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let i$=n$.sdp.split(`
`).filter(o$=>rn(o$).call(o$)!=="a=extmap-allow-mixed").join(`
`);e$.RTCSessionDescription&&n$ instanceof e$.RTCSessionDescription?arguments[0]=new e$.RTCSessionDescription({type:n$.type,sdp:i$}):n$.sdp=i$}return r$.apply(this,arguments)}}function hl(e$,t$){if(!e$.RTCPeerConnection||!e$.RTCPeerConnection.prototype)return;let r$=e$.RTCPeerConnection.prototype.addIceCandidate;r$&&r$.length!==0&&(e$.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t$.browser==="chrome"&&t$.version<78||t$.browser==="firefox"&&t$.version<68||t$.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?j.resolve():r$.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),j.resolve())})}function pl(e$,t$){if(!e$.RTCPeerConnection||!e$.RTCPeerConnection.prototype)return;let r$=e$.RTCPeerConnection.prototype.setLocalDescription;r$&&r$.length!==0&&(e$.RTCPeerConnection.prototype.setLocalDescription=function(){let n$=arguments[0]||{};if(typeof n$!="object"||n$.type&&n$.sdp)return r$.apply(this,arguments);if(n$={type:n$.type,sdp:n$.sdp},!n$.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n$.type="offer";break;default:n$.type="answer"}return n$.sdp||n$.type!=="offer"&&n$.type!=="answer"?r$.apply(this,[n$]):(n$.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i$=>r$.apply(this,[i$]))})}var s2=Object.freeze({__proto__:null,removeExtmapAllowMixed:hE,shimAddIceCandidateNullOrEmpty:hl,shimConnectionState:uE,shimMaxMessageSize:ll,shimParameterlessSetLocalDescription:pl,shimRTCIceCandidate:dl,shimRTCIceCandidateRelayProtocol:lE,shimSendThrowTypeError:ul});(function(){let{window:e$}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},r$=jA,n$=function(o$){let s$={browser:null,version:null};if(o$===void 0||!o$.navigator)return s$.browser="Not a browser.",s$;let{navigator:a$}=o$;if(a$.mozGetUserMedia)s$.browser="firefox",s$.version=hd(a$.userAgent,/Firefox\/(\d+)\./,1);else if(a$.webkitGetUserMedia||o$.isSecureContext===!1&&o$.webkitRTCPeerConnection)s$.browser="chrome",s$.version=hd(a$.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!o$.RTCPeerConnection||!a$.userAgent.match(/AppleWebKit\/(\d+)\./))return s$.browser="Not a supported browser.",s$;s$.browser="safari",s$.version=hd(a$.userAgent,/AppleWebKit\/(\d+)\./,1),s$.supportsUnifiedPlan=o$.RTCRtpTransceiver&&"currentDirection"in o$.RTCRtpTransceiver.prototype}return s$}(e$),i$={browserDetails:n$,commonShim:s2,extractVersion:hd,disableLog:rk,disableWarnings:ok,sdp:o2};switch(n$.browser){case"chrome":if(!RT||!aE||!t$.shimChrome)return r$("Chrome shim is not included in this adapter release."),i$;if(n$.version===null)return r$("Chrome shim can not determine version, not shimming."),i$;r$("adapter.js shimming chrome."),i$.browserShim=RT,hl(e$,n$),pl(e$),Mb(e$,n$),Ub(e$),aE(e$,n$),xb(e$),Gb(e$,n$),Vb(e$),Fb(e$),Bb(e$),Wb(e$,n$),dl(e$),lE(e$),uE(e$),ll(e$,n$),ul(e$),hE(e$,n$);break;case"firefox":if(!CT||!cE||!t$.shimFirefox)return r$("Firefox shim is not included in this adapter release."),i$;r$("adapter.js shimming firefox."),i$.browserShim=CT,hl(e$,n$),pl(e$),Hb(e$,n$),cE(e$,n$),Kb(e$),zb(e$),Yb(e$),qb(e$),Jb(e$),Xb(e$),Qb(e$),Zb(e$),$b(e$),dl(e$),uE(e$),ll(e$,n$),ul(e$);break;case"safari":if(!IT||!t$.shimSafari)return r$("Safari shim is not included in this adapter release."),i$;r$("adapter.js shimming safari."),i$.browserShim=IT,hl(e$,n$),pl(e$),ow(e$),aw(e$),nw(e$),tw(e$),ew(e$),sw(e$),iw(e$),cw(e$),dl(e$),lE(e$),ll(e$,n$),ul(e$),hE(e$,n$);break;default:r$("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var a2=bi("Array").keys,c2=Er,d2=Je,l2=hn,u2=a2,$h=Array.prototype,h2={DOMTokenList:!0,NodeList:!0},p2=function(e$){var t$=e$.keys;return e$===$h||l2($h,e$)&&t$===$h.keys||d2(h2,c2(e$))?u2:t$},xn=ae(p2),AT=ha,_2=TypeError,E2=Ou,m2=Ai,f2=_o,Bu=function(e$,t$,r$){var n$=E2(t$);n$ in e$?m2.f(e$,n$,f2(0,r$)):e$[n$]=r$},bT=Om,g2=Lr,T2=Bu,S2=Array,R2=Math.max,zm=function(e$,t$,r$){for(var n$=g2(e$),i$=bT(t$,n$),o$=bT(r$===void 0?n$:r$,n$),s$=S2(R2(o$-i$,0)),a$=0;i$<o$;i$++,a$++)T2(s$,a$,e$[i$]);return s$.length=a$,s$},wT=zm,C2=Math.floor,pE=function(e$,t$){var r$=e$.length,n$=C2(r$/2);return r$<8?I2(e$,t$):v2(e$,pE(wT(e$,0,n$),t$),pE(wT(e$,n$),t$),t$)},I2=function(e$,t$){for(var r$,n$,i$=e$.length,o$=1;o$<i$;){for(n$=o$,r$=e$[o$];n$&&t$(e$[n$-1],r$)>0;)e$[n$]=e$[--n$];n$!==o$++&&(e$[n$]=r$)}return e$},v2=function(e$,t$,r$,n$){for(var i$=t$.length,o$=r$.length,s$=0,a$=0;s$<i$||a$<o$;)e$[s$+a$]=s$<i$&&a$<o$?n$(t$[s$],r$[a$])<=0?t$[s$++]:r$[a$++]:s$<i$?t$[s$++]:r$[a$++];return e$},hw=pE,OT=$o.match(/firefox\/(\d+)/i),y2=!!OT&&+OT[1],A2=/MSIE|Trident/.test($o),NT=$o.match(/AppleWebKit\/(\d+)\./),b2=!!NT&&+NT[1],w2=xt,pw=me,O2=yi,N2=_r,DT=Lr,D2=function(e$,t$){if(!delete e$[t$])throw _2("Cannot delete property "+AT(t$)+" of "+AT(e$))},PT=oi,Jm=Se,P2=hw,k2=Nu,kT=y2,L2=A2,LT=zo,MT=b2,Zr=[],UT=pw(Zr.sort),M2=pw(Zr.push),U2=Jm(function(){Zr.sort(void 0)}),x2=Jm(function(){Zr.sort(null)}),V2=k2("sort"),xT=!Jm(function(){if(LT)return LT<70;if(!(kT&&kT>3)){if(L2)return!0;if(MT)return MT<603;var e$,t$,r$,n$,i$="";for(e$=65;e$<76;e$++){switch(t$=String.fromCharCode(e$),e$){case 66:case 69:case 70:case 72:r$=3;break;case 68:case 71:r$=4;break;default:r$=2}for(n$=0;n$<47;n$++)Zr.push({k:t$+n$,v:r$})}for(Zr.sort(function(o$,s$){return s$.v-o$.v}),n$=0;n$<Zr.length;n$++)t$=Zr[n$].k.charAt(0),i$.charAt(i$.length-1)!==t$&&(i$+=t$);return i$!=="DGBEFHACIJK"}});w2({target:"Array",proto:!0,forced:U2||!x2||!V2||!xT},{sort:function(e$){e$!==void 0&&O2(e$);var t$=N2(this);if(xT)return e$===void 0?UT(t$):UT(t$,e$);var r$,n$,i$=[],o$=DT(t$);for(n$=0;n$<o$;n$++)n$ in t$&&M2(i$,t$[n$]);for(P2(i$,function(s$){return function(a$,c$){return c$===void 0?-1:a$===void 0?1:s$!==void 0?+s$(a$,c$)||0:PT(a$)>PT(c$)?1:-1}}(e$)),r$=DT(i$),n$=0;n$<r$;)t$[n$]=i$[n$++];for(;n$<o$;)D2(t$,n$++);return t$}});var tp,ep,F2=bi("Array").sort,B2=hn,j2=F2,np=Array.prototype,G2=function(e$){var t$=e$.sort;return e$===np||B2(np,e$)&&t$===np.sort?j2:t$},ed=ae(G2),_E={exports:{}};tp=_E,ep=_E.exports,function(e$,t$){var r$="function",n$="undefined",i$="object",o$="string",s$="major",a$="model",c$="name",u$="type",l$="vendor",d$="version",h$="architecture",p$="console",_$="mobile",f$="tablet",m$="smarttv",g$="wearable",v$="embedded",y$="Amazon",S$="Apple",b$="ASUS",$$="BlackBerry",C$="Browser",N$="Chrome",k$="Firefox",O$="Google",U$="Huawei",x$="LG",F$="Microsoft",L$="Motorola",M$="Opera",V$="Samsung",A$="Sharp",I$="Sony",P$="Xiaomi",w$="Zebra",E$="Facebook",T$="Chromium OS",R$="Mac OS",D$=function(K$){for(var B$={},H$=0;H$<K$.length;H$++)B$[K$[H$].toUpperCase()]=K$[H$];return B$},j$=function(K$,B$){return typeof K$===o$&&G$(B$).indexOf(G$(K$))!==-1},G$=function(K$){return K$.toLowerCase()},z$=function(K$,B$){if(typeof K$===o$)return K$=K$.replace(/^\s\s*/,""),typeof B$===n$?K$:K$.substring(0,350)},J$=function(K$,B$){for(var H$,X$,t0,q$,W$,Z$,o5=0;o5<B$.length&&!W$;){var _q=B$[o5],l5=B$[o5+1];for(H$=X$=0;H$<_q.length&&!W$&&_q[H$];)if(W$=_q[H$++].exec(K$))for(t0=0;t0<l5.length;t0++)Z$=W$[++X$],typeof(q$=l5[t0])===i$&&q$.length>0?q$.length===2?typeof q$[1]==r$?this[q$[0]]=q$[1].call(this,Z$):this[q$[0]]=q$[1]:q$.length===3?typeof q$[1]!==r$||q$[1].exec&&q$[1].test?this[q$[0]]=Z$?Z$.replace(q$[1],q$[2]):t$:this[q$[0]]=Z$?q$[1].call(this,Z$,q$[2]):t$:q$.length===4&&(this[q$[0]]=Z$?q$[3].call(this,Z$.replace(q$[1],q$[2])):t$):this[q$]=Z$||t$;o5+=2}},t5=function(K$,B$){for(var H$ in B$)if(typeof B$[H$]===i$&&B$[H$].length>0){for(var X$=0;X$<B$[H$].length;X$++)if(j$(B$[H$][X$],K$))return H$==="?"?t$:H$}else if(j$(B$[H$],K$))return H$==="?"?t$:H$;return K$},a5={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},s5={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[d$,[c$,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[d$,[c$,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[c$,d$],[/opios[\/ ]+([\w\.]+)/i],[d$,[c$,M$+" Mini"]],[/\bopr\/([\w\.]+)/i],[d$,[c$,M$]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[c$,d$],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[d$,[c$,"UC"+C$]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[d$,[c$,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[d$,[c$,"WeChat"]],[/konqueror\/([\w\.]+)/i],[d$,[c$,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[d$,[c$,"IE"]],[/yabrowser\/([\w\.]+)/i],[d$,[c$,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[c$,/(.+)/,"$1 Secure "+C$],d$],[/\bfocus\/([\w\.]+)/i],[d$,[c$,k$+" Focus"]],[/\bopt\/([\w\.]+)/i],[d$,[c$,M$+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[d$,[c$,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[d$,[c$,"Dolphin"]],[/coast\/([\w\.]+)/i],[d$,[c$,M$+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[d$,[c$,"MIUI "+C$]],[/fxios\/([-\w\.]+)/i],[d$,[c$,k$]],[/\bqihu|(qi?ho?o?|360)browser/i],[[c$,"360 "+C$]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[c$,/(.+)/,"$1 "+C$],d$],[/(comodo_dragon)\/([\w\.]+)/i],[[c$,/_/g," "],d$],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[c$,d$],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[c$],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[c$,E$],d$],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[c$,d$],[/\bgsa\/([\w\.]+) .*safari\//i],[d$,[c$,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[d$,[c$,N$+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[c$,N$+" WebView"],d$],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[d$,[c$,"Android "+C$]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[c$,d$],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[d$,[c$,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[d$,c$],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[c$,[d$,t5,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[c$,d$],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[c$,"Netscape"],d$],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[d$,[c$,k$+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[c$,d$],[/(cobalt)\/([\w\.]+)/i],[c$,[d$,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[h$,"amd64"]],[/(ia32(?=;))/i],[[h$,G$]],[/((?:i[346]|x)86)[;\)]/i],[[h$,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[h$,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[h$,"armhf"]],[/windows (ce|mobile); ppc;/i],[[h$,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[h$,/ower/,"",G$]],[/(sun4\w)[;\)]/i],[[h$,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[h$,G$]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[a$,[l$,V$],[u$,f$]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[a$,[l$,V$],[u$,_$]],[/\((ip(?:hone|od)[\w ]*);/i],[a$,[l$,S$],[u$,_$]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[a$,[l$,S$],[u$,f$]],[/(macintosh);/i],[a$,[l$,S$]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[a$,[l$,A$],[u$,_$]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[a$,[l$,U$],[u$,f$]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[a$,[l$,U$],[u$,_$]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[a$,/_/g," "],[l$,P$],[u$,_$]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[a$,/_/g," "],[l$,P$],[u$,f$]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[a$,[l$,"OPPO"],[u$,_$]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[a$,[l$,"Vivo"],[u$,_$]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[a$,[l$,"Realme"],[u$,_$]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[a$,[l$,L$],[u$,_$]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[a$,[l$,L$],[u$,f$]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[a$,[l$,x$],[u$,f$]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[a$,[l$,x$],[u$,_$]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[a$,[l$,"Lenovo"],[u$,f$]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[a$,/_/g," "],[l$,"Nokia"],[u$,_$]],[/(pixel c)\b/i],[a$,[l$,O$],[u$,f$]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[a$,[l$,O$],[u$,_$]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[a$,[l$,I$],[u$,_$]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[a$,"Xperia Tablet"],[l$,I$],[u$,f$]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[a$,[l$,"OnePlus"],[u$,_$]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[a$,[l$,y$],[u$,f$]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[a$,/(.+)/g,"Fire Phone $1"],[l$,y$],[u$,_$]],[/(playbook);[-\w\),; ]+(rim)/i],[a$,l$,[u$,f$]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[a$,[l$,$$],[u$,_$]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[a$,[l$,b$],[u$,f$]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[a$,[l$,b$],[u$,_$]],[/(nexus 9)/i],[a$,[l$,"HTC"],[u$,f$]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[l$,[a$,/_/g," "],[u$,_$]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[a$,[l$,"Acer"],[u$,f$]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[a$,[l$,"Meizu"],[u$,_$]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[l$,a$,[u$,_$]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[l$,a$,[u$,f$]],[/(surface duo)/i],[a$,[l$,F$],[u$,f$]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[a$,[l$,"Fairphone"],[u$,_$]],[/(u304aa)/i],[a$,[l$,"AT&T"],[u$,_$]],[/\bsie-(\w*)/i],[a$,[l$,"Siemens"],[u$,_$]],[/\b(rct\w+) b/i],[a$,[l$,"RCA"],[u$,f$]],[/\b(venue[\d ]{2,7}) b/i],[a$,[l$,"Dell"],[u$,f$]],[/\b(q(?:mv|ta)\w+) b/i],[a$,[l$,"Verizon"],[u$,f$]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[a$,[l$,"Barnes & Noble"],[u$,f$]],[/\b(tm\d{3}\w+) b/i],[a$,[l$,"NuVision"],[u$,f$]],[/\b(k88) b/i],[a$,[l$,"ZTE"],[u$,f$]],[/\b(nx\d{3}j) b/i],[a$,[l$,"ZTE"],[u$,_$]],[/\b(gen\d{3}) b.+49h/i],[a$,[l$,"Swiss"],[u$,_$]],[/\b(zur\d{3}) b/i],[a$,[l$,"Swiss"],[u$,f$]],[/\b((zeki)?tb.*\b) b/i],[a$,[l$,"Zeki"],[u$,f$]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[l$,"Dragon Touch"],a$,[u$,f$]],[/\b(ns-?\w{0,9}) b/i],[a$,[l$,"Insignia"],[u$,f$]],[/\b((nxa|next)-?\w{0,9}) b/i],[a$,[l$,"NextBook"],[u$,f$]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[l$,"Voice"],a$,[u$,_$]],[/\b(lvtel\-)?(v1[12]) b/i],[[l$,"LvTel"],a$,[u$,_$]],[/\b(ph-1) /i],[a$,[l$,"Essential"],[u$,_$]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[a$,[l$,"Envizen"],[u$,f$]],[/\b(trio[-\w\. ]+) b/i],[a$,[l$,"MachSpeed"],[u$,f$]],[/\btu_(1491) b/i],[a$,[l$,"Rotor"],[u$,f$]],[/(shield[\w ]+) b/i],[a$,[l$,"Nvidia"],[u$,f$]],[/(sprint) (\w+)/i],[l$,a$,[u$,_$]],[/(kin\.[onetw]{3})/i],[[a$,/\./g," "],[l$,F$],[u$,_$]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[a$,[l$,w$],[u$,f$]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[a$,[l$,w$],[u$,_$]],[/smart-tv.+(samsung)/i],[l$,[u$,m$]],[/hbbtv.+maple;(\d+)/i],[[a$,/^/,"SmartTV"],[l$,V$],[u$,m$]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[l$,x$],[u$,m$]],[/(apple) ?tv/i],[l$,[a$,S$+" TV"],[u$,m$]],[/crkey/i],[[a$,N$+"cast"],[l$,O$],[u$,m$]],[/droid.+aft(\w)( bui|\))/i],[a$,[l$,y$],[u$,m$]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[a$,[l$,A$],[u$,m$]],[/(bravia[\w ]+)( bui|\))/i],[a$,[l$,I$],[u$,m$]],[/(mitv-\w{5}) bui/i],[a$,[l$,P$],[u$,m$]],[/Hbbtv.*(technisat) (.*);/i],[l$,a$,[u$,m$]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[l$,z$],[a$,z$],[u$,m$]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[u$,m$]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[l$,a$,[u$,p$]],[/droid.+; (shield) bui/i],[a$,[l$,"Nvidia"],[u$,p$]],[/(playstation [345portablevi]+)/i],[a$,[l$,I$],[u$,p$]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[a$,[l$,F$],[u$,p$]],[/((pebble))app/i],[l$,a$,[u$,g$]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[a$,[l$,S$],[u$,g$]],[/droid.+; (glass) \d/i],[a$,[l$,O$],[u$,g$]],[/droid.+; (wt63?0{2,3})\)/i],[a$,[l$,w$],[u$,g$]],[/(quest( 2| pro)?)/i],[a$,[l$,E$],[u$,g$]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[l$,[u$,v$]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[a$,[u$,_$]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[a$,[u$,f$]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[u$,f$]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[u$,_$]],[/(android[-\w\. ]{0,9});.+buil/i],[a$,[l$,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[d$,[c$,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[d$,[c$,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[c$,d$],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[d$,c$]],os:[[/microsoft (windows) (vista|xp)/i],[c$,d$],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[c$,[d$,t5,a5]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[c$,"Windows"],[d$,t5,a5]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[d$,/_/g,"."],[c$,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[c$,R$],[d$,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[d$,c$],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[c$,d$],[/\(bb(10);/i],[d$,[c$,$$]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[d$,[c$,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[d$,[c$,k$+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[d$,[c$,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[d$,[c$,"watchOS"]],[/crkey\/([\d\.]+)/i],[d$,[c$,N$+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[c$,T$],d$],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[c$,d$],[/(sunos) ?([\w\.\d]*)/i],[[c$,"Solaris"],d$],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[c$,d$]]},t3=function(K$,B$){if(typeof K$===i$&&(B$=K$,K$=t$),!(this instanceof t3))return new t3(K$,B$).getResult();var H$=typeof e$!==n$&&e$.navigator?e$.navigator:t$,X$=K$||(H$&&H$.userAgent?H$.userAgent:""),t0=H$&&H$.userAgentData?H$.userAgentData:t$,q$=B$?function(W$,Z$){var o5={};for(var _q in W$)Z$[_q]&&Z$[_q].length%2==0?o5[_q]=Z$[_q].concat(W$[_q]):o5[_q]=W$[_q];return o5}(s5,B$):s5;return this.getBrowser=function(){var W$={};return W$[c$]=t$,W$[d$]=t$,J$.call(W$,X$,q$.browser),W$[s$]=function(Z$){return typeof Z$===o$?Z$.replace(/[^\d\.]/g,"").split(".")[0]:t$}(W$[d$]),H$&&H$.brave&&typeof H$.brave.isBrave==r$&&(W$[c$]="Brave"),W$},this.getCPU=function(){var W$={};return W$[h$]=t$,J$.call(W$,X$,q$.cpu),W$},this.getDevice=function(){var W$={};return W$[l$]=t$,W$[a$]=t$,W$[u$]=t$,J$.call(W$,X$,q$.device),!W$[u$]&&t0&&t0.mobile&&(W$[u$]=_$),W$[a$]=="Macintosh"&&H$&&typeof H$.standalone!==n$&&H$.maxTouchPoints&&H$.maxTouchPoints>2&&(W$[a$]="iPad",W$[u$]=f$),W$},this.getEngine=function(){var W$={};return W$[c$]=t$,W$[d$]=t$,J$.call(W$,X$,q$.engine),W$},this.getOS=function(){var W$={};return W$[c$]=t$,W$[d$]=t$,J$.call(W$,X$,q$.os),!W$[c$]&&t0&&t0.platform!="Unknown"&&(W$[c$]=t0.platform.replace(/chrome os/i,T$).replace(/macos/i,R$)),W$},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return X$},this.setUA=function(W$){return X$=typeof W$===o$&&W$.length>350?z$(W$,350):W$,this},this.setUA(X$),this};t3.VERSION="0.7.34",t3.BROWSER=D$([c$,d$,s$]),t3.CPU=D$([h$]),t3.DEVICE=D$([a$,l$,u$,p$,_$,m$,f$,g$,v$]),t3.ENGINE=t3.OS=D$([c$,d$]),tp.exports&&(ep=tp.exports=t3),ep.UAParser=t3;var Q$=typeof e$!==n$&&(e$.jQuery||e$.Zepto);if(Q$&&!Q$.ua){var Y$=new t3;Q$.ua=Y$.getResult(),Q$.ua.get=function(){return Y$.getUA()},Q$.ua.set=function(K$){Y$.setUA(K$);var B$=Y$.getResult();for(var H$ in B$)Q$.ua[H$]=B$[H$]}}}(typeof window=="object"?window:Vs);var W2=ae(_E.exports),H2=Er,K2=Je,Y2=da,q2=es,z2=pe("iterator"),J2=Object,X2=function(e$){if(Y2(e$))return!1;var t$=J2(e$);return t$[z2]!==void 0||"@@iterator"in t$||K2(q2,H2(t$))},Q2=ae(X2),ip=We;xt({global:!0,forced:ip.globalThis!==ip},{globalThis:ip});var VT=ae(We);function _w(e$,t$){return function(){return e$.apply(t$,arguments)}}var{toString:Z2}=Object.prototype,{getPrototypeOf:Xm}=Object,Ml=(rp=Object.create(null),e$=>{let t$=Z2.call(e$);return rp[t$]||(rp[t$]=t$.slice(8,-1).toLowerCase())}),rp,fr=e$=>(e$=e$.toLowerCase(),t$=>Ml(t$)===e$),ju=e$=>t$=>typeof t$===e$,{isArray:Is}=Array,Wa=ju("undefined"),FT=fr("ArrayBuffer"),$2=ju("string"),ai=ju("function"),BT=ju("number"),Td=e$=>e$!==null&&typeof e$=="object",Sd=e$=>{if(Ml(e$)!=="object")return!1;let t$=Xm(e$);return!(t$!==null&&t$!==Object.prototype&&Object.getPrototypeOf(t$)!==null||Symbol.toStringTag in e$||Q2(e$))},tx=fr("Date"),ex=fr("File"),nx=fr("Blob"),ix=fr("FileList"),rx=fr("URLSearchParams");function Ha(e$,t$){let r$,n$,{allOwnKeys:i$=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e$!=null)if(typeof e$!="object"&&(e$=[e$]),Is(e$))for(r$=0,n$=e$.length;r$<n$;r$++)t$.call(null,e$[r$],r$,e$);else{let o$=i$?Object.getOwnPropertyNames(e$):Object.keys(e$),s$=o$.length,a$;for(r$=0;r$<s$;r$++)a$=o$[r$],t$.call(null,e$[a$],a$,e$)}}function jT(e$,t$){t$=t$.toLowerCase();let r$=Object.keys(e$),n$,i$=r$.length;for(;i$-- >0;)if(n$=r$[i$],t$===n$.toLowerCase())return n$;return null}var Ew=VT!==void 0?VT:typeof self<"u"?self:typeof window<"u"?window:global,GT=e$=>!Wa(e$)&&e$!==Ew,ox=(op=typeof Uint8Array<"u"&&Xm(Uint8Array),e$=>op&&e$ instanceof op),op,sx=fr("HTMLFormElement"),WT=(e$=>{let{hasOwnProperty:t$}=e$;return(r$,n$)=>t$.call(r$,n$)})(Object.prototype),ax=fr("RegExp"),HT=(e$,t$)=>{let r$=Object.getOwnPropertyDescriptors(e$),n$={};Ha(r$,(i$,o$)=>{let s$;(s$=t$(i$,o$,e$))!==!1&&(n$[o$]=s$||i$)}),Object.defineProperties(e$,n$)},sp="abcdefghijklmnopqrstuvwxyz",KT="0123456789",YT={DIGIT:KT,ALPHA:sp,ALPHA_DIGIT:sp+sp.toUpperCase()+KT},cx=fr("AsyncFunction"),K={isArray:Is,isArrayBuffer:FT,isBuffer:function(e$){return e$!==null&&!Wa(e$)&&e$.constructor!==null&&!Wa(e$.constructor)&&ai(e$.constructor.isBuffer)&&e$.constructor.isBuffer(e$)},isFormData:e$=>{let t$;return e$&&(typeof FormData=="function"&&e$ instanceof FormData||ai(e$.append)&&((t$=Ml(e$))==="formdata"||t$==="object"&&ai(e$.toString)&&e$.toString()==="[object FormData]"))},isArrayBufferView:function(e$){let t$;return t$=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e$):e$&&e$.buffer&&FT(e$.buffer),t$},isString:$2,isNumber:BT,isBoolean:e$=>e$===!0||e$===!1,isObject:Td,isPlainObject:Sd,isUndefined:Wa,isDate:tx,isFile:ex,isBlob:nx,isRegExp:ax,isFunction:ai,isStream:e$=>Td(e$)&&ai(e$.pipe),isURLSearchParams:rx,isTypedArray:ox,isFileList:ix,forEach:Ha,merge:function e$(){let{caseless:t$}=GT(this)&&this||{},r$={},n$=(i$,o$)=>{let s$=t$&&jT(r$,o$)||o$;Sd(r$[s$])&&Sd(i$)?r$[s$]=e$(r$[s$],i$):Sd(i$)?r$[s$]=e$({},i$):Is(i$)?r$[s$]=i$.slice():r$[s$]=i$};for(let i$=0,o$=arguments.length;i$<o$;i$++)arguments[i$]&&Ha(arguments[i$],n$);return r$},extend:function(e$,t$,r$){let{allOwnKeys:n$}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Ha(t$,(i$,o$)=>{r$&&ai(i$)?e$[o$]=_w(i$,r$):e$[o$]=i$},{allOwnKeys:n$}),e$},trim:e$=>rn(e$)?rn(e$).call(e$):e$.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e$=>(e$.charCodeAt(0)===65279&&(e$=e$.slice(1)),e$),inherits:(e$,t$,r$,n$)=>{e$.prototype=Object.create(t$.prototype,n$),e$.prototype.constructor=e$,Object.defineProperty(e$,"super",{value:t$.prototype}),r$&&Object.assign(e$.prototype,r$)},toFlatObject:(e$,t$,r$,n$)=>{let i$,o$,s$,a$={};if(t$=t$||{},e$==null)return t$;do{for(i$=Object.getOwnPropertyNames(e$),o$=i$.length;o$-- >0;)s$=i$[o$],n$&&!n$(s$,e$,t$)||a$[s$]||(t$[s$]=e$[s$],a$[s$]=!0);e$=r$!==!1&&Xm(e$)}while(e$&&(!r$||r$(e$,t$))&&e$!==Object.prototype);return t$},kindOf:Ml,kindOfTest:fr,endsWith:(e$,t$,r$)=>{e$=String(e$),(r$===void 0||r$>e$.length)&&(r$=e$.length),r$-=t$.length;let n$=e$.indexOf(t$,r$);return n$!==-1&&n$===r$},toArray:e$=>{if(!e$)return null;if(Is(e$))return e$;let t$=e$.length;if(!BT(t$))return null;let r$=new Array(t$);for(;t$-- >0;)r$[t$]=e$[t$];return r$},forEachEntry:(e$,t$)=>{let r$=(e$&&e$[Symbol.iterator]).call(e$),n$;for(;(n$=r$.next())&&!n$.done;){let i$=n$.value;t$.call(e$,i$[0],i$[1])}},matchAll:(e$,t$)=>{let r$,n$=[];for(;(r$=e$.exec(t$))!==null;)n$.push(r$);return n$},isHTMLForm:sx,hasOwnProperty:WT,hasOwnProp:WT,reduceDescriptors:HT,freezeMethods:e$=>{HT(e$,(t$,r$)=>{if(ai(e$)&&["arguments","caller","callee"].indexOf(r$)!==-1)return!1;let n$=e$[r$];ai(n$)&&(t$.enumerable=!1,"writable"in t$?t$.writable=!1:t$.set||(t$.set=()=>{throw Error("Can not rewrite read-only method '"+r$+"'")}))})},toObjectSet:(e$,t$)=>{let r$={},n$=i$=>{i$.forEach(o$=>{r$[o$]=!0})};return Is(e$)?n$(e$):n$(String(e$).split(t$)),r$},toCamelCase:e$=>e$.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t$,r$,n$){return r$.toUpperCase()+n$}),noop:()=>{},toFiniteNumber:(e$,t$)=>(e$=+e$,Number.isFinite(e$)?e$:t$),findKey:jT,global:Ew,isContextDefined:GT,ALPHABET:YT,generateString:function(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:YT.ALPHA_DIGIT,r$="",{length:n$}=t$;for(;e$--;)r$+=t$[Math.random()*n$|0];return r$},isSpecCompliantForm:function(e$){return!!(e$&&ai(e$.append)&&e$[Symbol.toStringTag]==="FormData"&&e$[Symbol.iterator])},toJSONObject:e$=>{let t$=new Array(10),r$=(n$,i$)=>{if(Td(n$)){if(t$.indexOf(n$)>=0)return;if(!("toJSON"in n$)){t$[i$]=n$;let o$=Is(n$)?[]:{};return Ha(n$,(s$,a$)=>{let c$=r$(s$,i$+1);!Wa(c$)&&(o$[a$]=c$)}),t$[i$]=void 0,o$}}return n$};return r$(e$,0)},isAsyncFn:cx,isThenable:e$=>e$&&(Td(e$)||ai(e$))&&ai(e$.then)&&ai(e$.catch)};function qt(e$,t$,r$,n$,i$){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e$,this.name="AxiosError",t$&&(this.code=t$),r$&&(this.config=r$),n$&&(this.request=n$),i$&&(this.response=i$)}K.inherits(qt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:K.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var qT=qt.prototype,zT={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e$=>{zT[e$]={value:e$}}),Object.defineProperties(qt,zT),Object.defineProperty(qT,"isAxiosError",{value:!0}),qt.from=(e$,t$,r$,n$,i$,o$)=>{let s$=Object.create(qT);return K.toFlatObject(e$,s$,function(a$){return a$!==Error.prototype},a$=>a$!=="isAxiosError"),qt.call(s$,e$.message,t$,r$,n$,i$),s$.cause=e$,s$.name=e$.name,o$&&Object.assign(s$,o$),s$};function ap(e$){return K.isPlainObject(e$)||K.isArray(e$)}function mw(e$){return K.endsWith(e$,"[]")?e$.slice(0,-2):e$}function JT(e$,t$,r$){return e$?e$.concat(t$).map(function(n$,i$){return n$=mw(n$),!r$&&i$?"["+n$+"]":n$}).join(r$?".":""):t$}var dx=K.toFlatObject(K,{},null,function(e$){return/^is[A-Z]/.test(e$)});function Ul(e$,t$,r$){if(!K.isObject(e$))throw new TypeError("target must be an object");t$=t$||new FormData;let n$=(r$=K.toFlatObject(r$,{metaTokens:!0,dots:!1,indexes:!1},!1,function(h$,p$){return!K.isUndefined(p$[h$])})).metaTokens,i$=r$.visitor||u$,o$=r$.dots,s$=r$.indexes,a$=(r$.Blob||typeof Blob<"u"&&Blob)&&K.isSpecCompliantForm(t$);if(!K.isFunction(i$))throw new TypeError("visitor must be a function");function c$(h$){if(h$===null)return"";if(K.isDate(h$))return h$.toISOString();if(!a$&&K.isBlob(h$))throw new qt("Blob is not supported. Use a Buffer instead.");return K.isArrayBuffer(h$)||K.isTypedArray(h$)?a$&&typeof Blob=="function"?new Blob([h$]):Buffer.from(h$):h$}function u$(h$,p$,_$){let f$=h$;if(h$&&!_$&&typeof h$=="object"){if(K.endsWith(p$,"{}"))p$=n$?p$:p$.slice(0,-2),h$=JSON.stringify(h$);else if(K.isArray(h$)&&function(m$){return K.isArray(m$)&&!m$.some(ap)}(h$)||(K.isFileList(h$)||K.endsWith(p$,"[]"))&&(f$=K.toArray(h$)))return p$=mw(p$),f$.forEach(function(m$,g$){!K.isUndefined(m$)&&m$!==null&&t$.append(s$===!0?JT([p$],g$,o$):s$===null?p$:p$+"[]",c$(m$))}),!1}return!!ap(h$)||(t$.append(JT(_$,p$,o$),c$(h$)),!1)}let l$=[],d$=Object.assign(dx,{defaultVisitor:u$,convertValue:c$,isVisitable:ap});if(!K.isObject(e$))throw new TypeError("data must be an object");return function h$(p$,_$){if(!K.isUndefined(p$)){if(l$.indexOf(p$)!==-1)throw Error("Circular reference detected in "+_$.join("."));l$.push(p$),K.forEach(p$,function(f$,m$){(!(K.isUndefined(f$)||f$===null)&&i$.call(t$,f$,K.isString(m$)?rn(m$).call(m$):m$,_$,d$))===!0&&h$(f$,_$?_$.concat(m$):[m$])}),l$.pop()}}(e$),t$}function XT(e$){let t$={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e$).replace(/[!'()~]|%20|%00/g,function(r$){return t$[r$]})}function Qm(e$,t$){this._pairs=[],e$&&Ul(e$,this,t$)}var QT=Qm.prototype;function lx(e$){return encodeURIComponent(e$).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function fw(e$,t$,r$){if(!t$)return e$;let n$=r$&&r$.encode||lx,i$=r$&&r$.serialize,o$;if(o$=i$?i$(t$,r$):K.isURLSearchParams(t$)?t$.toString():new Qm(t$,r$).toString(n$),o$){let s$=e$.indexOf("#");s$!==-1&&(e$=e$.slice(0,s$)),e$+=(e$.indexOf("?")===-1?"?":"&")+o$}return e$}QT.append=function(e$,t$){this._pairs.push([e$,t$])},QT.toString=function(e$){let t$=e$?function(r$){return e$.call(this,r$,XT)}:XT;return this._pairs.map(function(r$){return t$(r$[0])+"="+t$(r$[1])},"").join("&")};var ZT=class{constructor(){this.handlers=[]}use(e$,t$,r$){return this.handlers.push({fulfilled:e$,rejected:t$,synchronous:!!r$&&r$.synchronous,runWhen:r$?r$.runWhen:null}),this.handlers.length-1}eject(e$){this.handlers[e$]&&(this.handlers[e$]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e$){K.forEach(this.handlers,function(t$){t$!==null&&e$(t$)})}},gw={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Tw={exports:{}},ux=xt,hx=ri,$T=Ai.f;ux({target:"Object",stat:!0,forced:Object.defineProperty!==$T,sham:!hx},{defineProperty:$T});var Sw=Gi.Object,px=Tw.exports=function(e$,t$,r$){return Sw.defineProperty(e$,t$,r$)};Sw.defineProperty.sham&&(px.sham=!0);var Rw=ae(Tw.exports),_x=pr,nd=Array.isArray||function(e$){return _x(e$)=="Array"},Ex=TypeError,tS=nd,mx=xu,fx=Hn,gx=pe("species"),eS=Array,Tx=function(e$){var t$;return tS(e$)&&(t$=e$.constructor,(mx(t$)&&(t$===eS||tS(t$.prototype))||fx(t$)&&(t$=t$[gx])===null)&&(t$=void 0)),t$===void 0?eS:t$},Cw=function(e$,t$){return new(Tx(e$))(t$===0?0:t$)},Sx=Se,Rx=zo,Cx=pe("species"),Iw=function(e$){return Rx>=51||!Sx(function(){var t$=[];return(t$.constructor={})[Cx]=function(){return{foo:1}},t$[e$](Boolean).foo!==1})},Ix=xt,vx=Se,yx=nd,Ax=Hn,bx=_r,wx=Lr,nS=function(e$){if(e$>9007199254740991)throw Ex("Maximum allowed index exceeded");return e$},iS=Bu,Ox=Cw,Nx=Iw,Dx=zo,vw=pe("isConcatSpreadable"),Px=Dx>=51||!vx(function(){var e$=[];return e$[vw]=!1,e$.concat()[0]!==e$}),kx=function(e$){if(!Ax(e$))return!1;var t$=e$[vw];return t$!==void 0?!!t$:yx(e$)};Ix({target:"Array",proto:!0,arity:1,forced:!Px||!Nx("concat")},{concat:function(e$){var t$,r$,n$,i$,o$,s$=bx(this),a$=Ox(s$,0),c$=0;for(t$=-1,n$=arguments.length;t$<n$;t$++)if(kx(o$=t$===-1?s$:arguments[t$]))for(i$=wx(o$),nS(c$+i$),r$=0;r$<i$;r$++,c$++)r$ in o$&&iS(a$,c$,o$[r$]);else nS(c$+1),iS(a$,c$++,o$);return a$.length=c$,a$}});var yw={},Lx=pr,Mx=Eo,rS=Pu.f,Ux=zm,oS=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];yw.f=function(e$){return oS&&Lx(e$)=="Window"?function(t$){try{return rS(t$)}catch{return Ux(oS)}}(e$):rS(Mx(e$))};var Ea={},xx=pe;Ea.f=xx;var sS=Gi,Vx=Je,Fx=Ea,Bx=Ai.f,Fe=function(e$){var t$=sS.Symbol||(sS.Symbol={});Vx(t$,e$)||Bx(t$,e$,{value:Fx.f(e$)})},jx=Ke,Gx=Dn,Wx=pe,Hx=go,Aw=function(){var e$=Gx("Symbol"),t$=e$&&e$.prototype,r$=t$&&t$.valueOf,n$=Wx("toPrimitive");t$&&!t$[n$]&&Hx(t$,n$,function(i$){return jx(r$,this)},{arity:1})},Kx=mo,Yx=bu,qx=_r,zx=Lr,Jx=Cw,aS=me([].push),Vr=function(e$){var t$=e$==1,r$=e$==2,n$=e$==3,i$=e$==4,o$=e$==6,s$=e$==7,a$=e$==5||o$;return function(c$,u$,l$,d$){for(var h$,p$,_$=qx(c$),f$=Yx(_$),m$=Kx(u$,l$),g$=zx(f$),v$=0,y$=d$||Jx,S$=t$?y$(c$,g$):r$||s$?y$(c$,0):void 0;g$>v$;v$++)if((a$||v$ in f$)&&(p$=m$(h$=f$[v$],v$,_$),e$))if(t$)S$[v$]=p$;else if(p$)switch(e$){case 3:return!0;case 5:return h$;case 6:return v$;case 2:aS(S$,h$)}else switch(e$){case 4:return!1;case 7:aS(S$,h$)}return o$?-1:n$||i$?i$:S$}},bw={forEach:Vr(0),map:Vr(1),filter:Vr(2),some:Vr(3),every:Vr(4),find:Vr(5),findIndex:Vr(6),filterReject:Vr(7)},Rd=xt,Zm=We,$m=Ke,Xx=me,js=ri,ds=ua,Qx=Se,dn=Je,Zx=hn,EE=Cn,Gu=Eo,tf=Ou,$x=oi,mE=_o,Sc=Qc,ww=Lu,tV=Pu,Ow=yw,eV=Xc,Nw=Yc,Dw=Ai,nV=Mm,Pw=Au,cS=go,iV=Uu,ef=pa,kw=ku,dS=Am,rV=pe,oV=Ea,sV=Fe,aV=Aw,cV=To,Lw=ns,Wu=bw.forEach,Vn=Du("hidden"),xl="Symbol",Rc="prototype",dV=Lw.set,lS=Lw.getterFor(xl),Fi=Object[Rc],Ns=Zm.Symbol,_l=Ns&&Ns[Rc],lV=Zm.TypeError,cp=Zm.QObject,Mw=Nw.f,ko=Dw.f,Uw=Ow.f,uV=Pw.f,xw=Xx([].push),kr=ef("symbols"),id=ef("op-symbols"),hV=ef("wks"),dp=!cp||!cp[Rc]||!cp[Rc].findChild,fE=js&&Qx(function(){return Sc(ko({},"a",{get:function(){return ko(this,"a",{value:7}).a}})).a!=7})?function(e$,t$,r$){var n$=Mw(Fi,t$);n$&&delete Fi[t$],ko(e$,t$,r$),n$&&e$!==Fi&&ko(Fi,t$,n$)}:ko,lp=function(e$,t$){var r$=kr[e$]=Sc(_l);return dV(r$,{type:xl,tag:e$,description:t$}),js||(r$.description=t$),r$},Vl=function(e$,t$,r$){e$===Fi&&Vl(id,t$,r$),EE(e$);var n$=tf(t$);return EE(r$),dn(kr,n$)?(r$.enumerable?(dn(e$,Vn)&&e$[Vn][n$]&&(e$[Vn][n$]=!1),r$=Sc(r$,{enumerable:mE(0,!1)})):(dn(e$,Vn)||ko(e$,Vn,mE(1,{})),e$[Vn][n$]=!0),fE(e$,n$,r$)):ko(e$,n$,r$)},up=function(e$,t$){EE(e$);var r$=Gu(t$),n$=ww(r$).concat(Fw(r$));return Wu(n$,function(i$){js&&!$m(Vw,r$,i$)||Vl(e$,i$,r$[i$])}),e$},Vw=function(e$){var t$=tf(e$),r$=$m(uV,this,t$);return!(this===Fi&&dn(kr,t$)&&!dn(id,t$))&&(!(r$||!dn(this,t$)||!dn(kr,t$)||dn(this,Vn)&&this[Vn][t$])||r$)},uS=function(e$,t$){var r$=Gu(e$),n$=tf(t$);if(r$!==Fi||!dn(kr,n$)||dn(id,n$)){var i$=Mw(r$,n$);return!i$||!dn(kr,n$)||dn(r$,Vn)&&r$[Vn][n$]||(i$.enumerable=!0),i$}},hS=function(e$){var t$=Uw(Gu(e$)),r$=[];return Wu(t$,function(n$){dn(kr,n$)||dn(kw,n$)||xw(r$,n$)}),r$},Fw=function(e$){var t$=e$===Fi,r$=Uw(t$?id:Gu(e$)),n$=[];return Wu(r$,function(i$){!dn(kr,i$)||t$&&!dn(Fi,i$)||xw(n$,kr[i$])}),n$};ds||(cS(_l=(Ns=function(){if(Zx(_l,this))throw lV("Symbol is not a constructor");var e$=arguments.length&&arguments[0]!==void 0?$x(arguments[0]):void 0,t$=dS(e$),r$=function(n$){this===Fi&&$m(r$,id,n$),dn(this,Vn)&&dn(this[Vn],t$)&&(this[Vn][t$]=!1),fE(this,t$,mE(1,n$))};return js&&dp&&fE(Fi,t$,{configurable:!0,set:r$}),lp(t$,e$)})[Rc],"toString",function(){return lS(this).tag}),cS(Ns,"withoutSetter",function(e$){return lp(dS(e$),e$)}),Pw.f=Vw,Dw.f=Vl,nV.f=up,Nw.f=uS,tV.f=Ow.f=hS,eV.f=Fw,oV.f=function(e$){return lp(rV(e$),e$)},js&&iV(_l,"description",{configurable:!0,get:function(){return lS(this).description}})),Rd({global:!0,constructor:!0,wrap:!0,forced:!ds,sham:!ds},{Symbol:Ns}),Wu(ww(hV),function(e$){sV(e$)}),Rd({target:xl,stat:!0,forced:!ds},{useSetter:function(){dp=!0},useSimple:function(){dp=!1}}),Rd({target:"Object",stat:!0,forced:!ds,sham:!js},{create:function(e$,t$){return t$===void 0?Sc(e$):up(Sc(e$),t$)},defineProperty:Vl,defineProperties:up,getOwnPropertyDescriptor:uS}),Rd({target:"Object",stat:!0,forced:!ds},{getOwnPropertyNames:hS}),aV(),cV(Ns,xl),kw[Vn]=!0;var Bw=ua&&!!Symbol.for&&!!Symbol.keyFor,pV=xt,_V=Dn,EV=Je,mV=oi,jw=pa,fV=Bw,hp=jw("string-to-symbol-registry"),gV=jw("symbol-to-string-registry");pV({target:"Symbol",stat:!0,forced:!fV},{for:function(e$){var t$=mV(e$);if(EV(hp,t$))return hp[t$];var r$=_V("Symbol")(t$);return hp[t$]=r$,gV[r$]=t$,r$}});var TV=xt,SV=Je,RV=qc,CV=ha,IV=Bw,pS=pa("symbol-to-string-registry");TV({target:"Symbol",stat:!0,forced:!IV},{keyFor:function(e$){if(!RV(e$))throw TypeError(CV(e$)+" is not a symbol");if(SV(pS,e$))return pS[e$]}});var _S=nd,vV=He,ES=pr,yV=oi,mS=me([].push),AV=xt,Gw=Dn,Ww=vm,bV=Ke,rd=me,Hw=Se,fS=He,gS=qc,Kw=Gm,wV=function(e$){if(vV(e$))return e$;if(_S(e$)){for(var t$=e$.length,r$=[],n$=0;n$<t$;n$++){var i$=e$[n$];typeof i$=="string"?mS(r$,i$):typeof i$!="number"&&ES(i$)!="Number"&&ES(i$)!="String"||mS(r$,yV(i$))}var o$=r$.length,s$=!0;return function(a$,c$){if(s$)return s$=!1,c$;if(_S(this))return c$;for(var u$=0;u$<o$;u$++)if(r$[u$]===a$)return c$}}},OV=ua,NV=String,ro=Gw("JSON","stringify"),Cd=rd(/./.exec),TS=rd("".charAt),DV=rd("".charCodeAt),PV=rd("".replace),kV=rd(1 .toString),LV=/[\uD800-\uDFFF]/g,SS=/^[\uD800-\uDBFF]$/,RS=/^[\uDC00-\uDFFF]$/,CS=!OV||Hw(function(){var e$=Gw("Symbol")();return ro([e$])!="[null]"||ro({a:e$})!="{}"||ro(Object(e$))!="{}"}),IS=Hw(function(){return ro("\uDF06\uD834")!=='"\\udf06\\ud834"'||ro("\uDEAD")!=='"\\udead"'}),MV=function(e$,t$){var r$=Kw(arguments),n$=wV(t$);if(fS(n$)||e$!==void 0&&!gS(e$))return r$[1]=function(i$,o$){if(fS(n$)&&(o$=bV(n$,this,NV(i$),o$)),!gS(o$))return o$},Ww(ro,null,r$)},UV=function(e$,t$,r$){var n$=TS(r$,t$-1),i$=TS(r$,t$+1);return Cd(SS,e$)&&!Cd(RS,i$)||Cd(RS,e$)&&!Cd(SS,n$)?"\\u"+kV(DV(e$,0),16):e$};ro&&AV({target:"JSON",stat:!0,arity:3,forced:CS||IS},{stringify:function(e$,t$,r$){var n$=Kw(arguments),i$=Ww(CS?MV:ro,null,n$);return IS&&typeof i$=="string"?PV(i$,LV,UV):i$}});var vS=Xc,xV=_r;xt({target:"Object",stat:!0,forced:!ua||Se(function(){vS.f(1)})},{getOwnPropertySymbols:function(e$){var t$=vS.f;return t$?t$(xV(e$)):[]}}),Fe("asyncIterator"),Fe("hasInstance"),Fe("isConcatSpreadable"),Fe("iterator"),Fe("match"),Fe("matchAll"),Fe("replace"),Fe("search"),Fe("species"),Fe("split");var VV=Aw;Fe("toPrimitive"),VV();var FV=Dn,BV=To;Fe("toStringTag"),BV(FV("Symbol"),"Symbol"),Fe("unscopables"),To(We.JSON,"JSON",!0);var jV=Gi.Symbol,GV=pe,WV=Ai.f,yS=GV("metadata"),AS=Function.prototype;AS[yS]===void 0&&WV(AS,yS,{value:null}),Fe("dispose"),Fe("metadata");var HV=jV;Fe("asyncDispose");var KV=me,nf=Dn("Symbol"),YV=nf.keyFor,qV=KV(nf.prototype.valueOf),Yw=nf.isRegisteredSymbol||function(e$){try{return YV(qV(e$))!==void 0}catch{return!1}};xt({target:"Symbol",stat:!0},{isRegisteredSymbol:Yw});for(bS=pa,pp=Dn,wS=me,OS=qc,NS=pe,Na=pp("Symbol"),gE=Na.isWellKnownSymbol,TE=pp("Object","getOwnPropertyNames"),qw=wS(Na.prototype.valueOf),SE=bS("wks"),Id=0,_p=TE(Na),DS=_p.length;Id<DS;Id++)try{Ep=_p[Id],OS(Na[Ep])&&NS(Ep)}catch{}var Ep,bS,pp,wS,OS,NS,Na,gE,TE,qw,SE,Id,_p,DS,PS=function(e$){if(gE&&gE(e$))return!0;try{for(var t$=qw(e$),r$=0,n$=TE(SE),i$=n$.length;r$<i$;r$++)if(SE[n$[r$]]==t$)return!0}catch{}return!1};xt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:PS}),Fe("matcher"),Fe("observable"),xt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:Yw}),xt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:PS}),Fe("metadataKey"),Fe("patternMatch"),Fe("replaceAll");var Ds=ae(HV),zw=ae(Ea.f("iterator"));function oc(e$){return oc=typeof Ds=="function"&&typeof zw=="symbol"?function(t$){return typeof t$}:function(t$){return t$&&typeof Ds=="function"&&t$.constructor===Ds&&t$!==Ds.prototype?"symbol":typeof t$},oc(e$)}var zV=ae(Ea.f("toPrimitive"));function JV(e$){var t$=function(r$,n$){if(oc(r$)!=="object"||r$===null)return r$;var i$=r$[zV];if(i$!==void 0){var o$=i$.call(r$,n$||"default");if(oc(o$)!=="object")return o$;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n$==="string"?String:Number)(r$)}(e$,"string");return oc(t$)==="symbol"?t$:String(t$)}function T(e$,t$,r$){return(t$=JV(t$))in e$?Rw(e$,t$,{value:r$,enumerable:!0,configurable:!0,writable:!0}):e$[t$]=r$,e$}var XV=Se,QV=pe("iterator"),rf=!XV(function(){var e$=new URL("b?a=1&b=2&c=3","http://a"),t$=e$.searchParams,r$=new URLSearchParams("a=1&a=2"),n$="";return e$.pathname="c%20d",t$.forEach(function(i$,o$){t$.delete("b"),n$+=o$+i$}),r$.delete("a",2),!e$.toJSON||!r$.has("a",1)||r$.has("a",2)||!t$.size&&!0||!t$.sort||e$.href!=="http://a/c%20d?a=1&c=3"||t$.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t$[QV]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||n$!=="a1c3"||new URL("http://x",void 0).host!=="x"}),ZV=go,mp=xt,Xs=We,vd=Ke,ur=me,Ps=ri,kS=rf,LS=go,$V=Uu,tF=function(e$,t$,r$){for(var n$ in t$)r$&&r$.unsafe&&e$[n$]?e$[n$]=t$[n$]:ZV(e$,n$,t$[n$],r$);return e$},eF=To,nF=xm,of=ns,Jw=Fm,fp=He,iF=Je,rF=mo,oF=Er,sF=Cn,Xw=Hn,bn=oi,aF=Qc,MS=_o,RE=Um,cF=Mu,ls=Vu,dF=hw,lF=pe("iterator"),Cc="URLSearchParams",Qw=Cc+"Iterator",Zw=of.set,fi=of.getterFor(Cc),uF=of.getterFor(Qw),hF=Object.getOwnPropertyDescriptor,sf=function(e$){if(!Ps)return Xs[e$];var t$=hF(Xs,e$);return t$&&t$.value},US=sf("fetch"),Fl=sf("Request"),sc=sf("Headers"),gp=Fl&&Fl.prototype,xS=sc&&sc.prototype,pF=Xs.RegExp,_F=Xs.TypeError,$w=Xs.decodeURIComponent,EF=Xs.encodeURIComponent,mF=ur("".charAt),VS=ur([].join),xo=ur([].push),CE=ur("".replace),fF=ur([].shift),FS=ur([].splice),BS=ur("".split),gF=ur("".slice),TF=/\+/g,jS=Array(4),SF=function(e$){return jS[e$-1]||(jS[e$-1]=pF("((?:%[\\da-f]{2}){"+e$+"})","gi"))},RF=function(e$){try{return $w(e$)}catch{return e$}},GS=function(e$){var t$=CE(e$,TF," "),r$=4;try{return $w(t$)}catch{for(;r$;)t$=CE(t$,SF(r$--),RF);return t$}},CF=/[!'()~]|%20/g,IF={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},vF=function(e$){return IF[e$]},WS=function(e$){return CE(EF(e$),CF,vF)},Tp=nF(function(e$,t$){Zw(this,{type:Qw,iterator:RE(fi(e$).entries),kind:t$})},"Iterator",function(){var e$=uF(this),t$=e$.kind,r$=e$.iterator.next(),n$=r$.value;return r$.done||(r$.value=t$==="keys"?n$.key:t$==="values"?n$.value:[n$.key,n$.value]),r$},!0),tO=function(e$){this.entries=[],this.url=null,e$!==void 0&&(Xw(e$)?this.parseObject(e$):this.parseQuery(typeof e$=="string"?mF(e$,0)==="?"?gF(e$,1):e$:bn(e$)))};tO.prototype={type:Cc,bindURL:function(e$){this.url=e$,this.update()},parseObject:function(e$){var t$,r$,n$,i$,o$,s$,a$,c$=cF(e$);if(c$)for(r$=(t$=RE(e$,c$)).next;!(n$=vd(r$,t$)).done;){if(o$=(i$=RE(sF(n$.value))).next,(s$=vd(o$,i$)).done||(a$=vd(o$,i$)).done||!vd(o$,i$).done)throw _F("Expected sequence with length 2");xo(this.entries,{key:bn(s$.value),value:bn(a$.value)})}else for(var u$ in e$)iF(e$,u$)&&xo(this.entries,{key:u$,value:bn(e$[u$])})},parseQuery:function(e$){if(e$)for(var t$,r$,n$=BS(e$,"&"),i$=0;i$<n$.length;)(t$=n$[i$++]).length&&(r$=BS(t$,"="),xo(this.entries,{key:GS(fF(r$)),value:GS(VS(r$,"="))}))},serialize:function(){for(var e$,t$=this.entries,r$=[],n$=0;n$<t$.length;)e$=t$[n$++],xo(r$,WS(e$.key)+"="+WS(e$.value));return VS(r$,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Bl=function(){Jw(this,vs);var e$=Zw(this,new tO(arguments.length>0?arguments[0]:void 0));Ps||(this.size=e$.entries.length)},vs=Bl.prototype;tF(vs,{append:function(e$,t$){var r$=fi(this);ls(arguments.length,2),xo(r$.entries,{key:bn(e$),value:bn(t$)}),Ps||this.length++,r$.updateURL()},delete:function(e$){for(var t$=fi(this),r$=ls(arguments.length,1),n$=t$.entries,i$=bn(e$),o$=r$<2?void 0:arguments[1],s$=o$===void 0?o$:bn(o$),a$=0;a$<n$.length;){var c$=n$[a$];if(c$.key!==i$||s$!==void 0&&c$.value!==s$)a$++;else if(FS(n$,a$,1),s$!==void 0)break}Ps||(this.size=n$.length),t$.updateURL()},get:function(e$){var t$=fi(this).entries;ls(arguments.length,1);for(var r$=bn(e$),n$=0;n$<t$.length;n$++)if(t$[n$].key===r$)return t$[n$].value;return null},getAll:function(e$){var t$=fi(this).entries;ls(arguments.length,1);for(var r$=bn(e$),n$=[],i$=0;i$<t$.length;i$++)t$[i$].key===r$&&xo(n$,t$[i$].value);return n$},has:function(e$){for(var t$=fi(this).entries,r$=ls(arguments.length,1),n$=bn(e$),i$=r$<2?void 0:arguments[1],o$=i$===void 0?i$:bn(i$),s$=0;s$<t$.length;){var a$=t$[s$++];if(a$.key===n$&&(o$===void 0||a$.value===o$))return!0}return!1},set:function(e$,t$){var r$=fi(this);ls(arguments.length,1);for(var n$,i$=r$.entries,o$=!1,s$=bn(e$),a$=bn(t$),c$=0;c$<i$.length;c$++)(n$=i$[c$]).key===s$&&(o$?FS(i$,c$--,1):(o$=!0,n$.value=a$));o$||xo(i$,{key:s$,value:a$}),Ps||(this.size=i$.length),r$.updateURL()},sort:function(){var e$=fi(this);dF(e$.entries,function(t$,r$){return t$.key>r$.key?1:-1}),e$.updateURL()},forEach:function(e$){for(var t$,r$=fi(this).entries,n$=rF(e$,arguments.length>1?arguments[1]:void 0),i$=0;i$<r$.length;)n$((t$=r$[i$++]).value,t$.key,this)},keys:function(){return new Tp(this,"keys")},values:function(){return new Tp(this,"values")},entries:function(){return new Tp(this,"entries")}},{enumerable:!0}),LS(vs,lF,vs.entries,{name:"entries"}),LS(vs,"toString",function(){return fi(this).serialize()},{enumerable:!0}),Ps&&$V(vs,"size",{get:function(){return fi(this).entries.length},configurable:!0,enumerable:!0}),eF(Bl,Cc),mp({global:!0,constructor:!0,forced:!kS},{URLSearchParams:Bl}),!kS&&fp(sc)&&(HS=ur(xS.has),KS=ur(xS.set),Sp=function(e$){if(Xw(e$)){var t$,r$=e$.body;if(oF(r$)===Cc)return t$=e$.headers?new sc(e$.headers):new sc,HS(t$,"content-type")||KS(t$,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),aF(e$,{body:MS(0,bn(r$)),headers:MS(0,t$)})}return e$},fp(US)&&mp({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e$){return US(e$,arguments.length>1?Sp(arguments[1]):{})}}),fp(Fl)&&(yd=function(e$){return Jw(this,gp),new Fl(e$,arguments.length>1?Sp(arguments[1]):{})},gp.constructor=yd,yd.prototype=gp,mp({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:yd})));var HS,KS,Sp,yd,yF={URLSearchParams:Bl,getState:fi},YS=ae(Gi.URLSearchParams),AF={isBrowser:!0,classes:{URLSearchParams:YS!==void 0?YS:Qm,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},eO=typeof window<"u"&&typeof document<"u",bF=(qS=typeof navigator<"u"&&navigator.product,eO&&["ReactNative","NativeScript","NS"].indexOf(qS)<0),qS,wF=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";function zS(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function JS(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?zS(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):zS(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var sr=JS(JS({},Object.freeze({__proto__:null,hasBrowserEnv:eO,hasStandardBrowserEnv:bF,hasStandardBrowserWebWorkerEnv:wF})),AF),OF=Cn,NF=Ke,DF=Je,PF=hn,kF=function(){var e$=OF(this),t$="";return e$.hasIndices&&(t$+="d"),e$.global&&(t$+="g"),e$.ignoreCase&&(t$+="i"),e$.multiline&&(t$+="m"),e$.dotAll&&(t$+="s"),e$.unicode&&(t$+="u"),e$.unicodeSets&&(t$+="v"),e$.sticky&&(t$+="y"),t$},XS=RegExp.prototype,nO=function(e$){var t$=e$.flags;return t$!==void 0||"flags"in XS||DF(e$,"flags")||!PF(XS,e$)?t$:NF(kF,e$)},LF=qm.charAt,QS=Ke,MF=Cn,UF=He,xF=pr,VF=/./.exec,FF=TypeError,BF=xt,ZS=Ke,iO=gc,jF=xm,Ad=Vm,$S=la,rO=MA,Ic=oi,GF=Cn,WF=da,HF=pr,KF=UA,oO=nO,YF=wu,qF=Se,zF=jm,JF=function(e$,t$,r$){return t$+(r$?LF(e$,t$).length:1)},XF=function(e$,t$){var r$=e$.exec;if(UF(r$)){var n$=QS(r$,e$,t$);return n$!==null&&MF(n$),n$}if(xF(e$)==="RegExp")return QS(VF,e$,t$);throw FF("RegExp#exec called on incompatible receiver")},sO=ns,QF=pe("matchAll"),aO="RegExp String",cO=aO+" Iterator",ZF=sO.set,$F=sO.getterFor(cO),tB=TypeError,IE=iO("".indexOf),jl=iO("".matchAll),Rp=!!jl&&!qF(function(){jl("a",/./)}),eB=jF(function(e$,t$,r$,n$){ZF(this,{type:cO,regexp:e$,string:t$,global:r$,unicode:n$,done:!1})},aO,function(){var e$=$F(this);if(e$.done)return Ad(void 0,!0);var t$=e$.regexp,r$=e$.string,n$=XF(t$,r$);return n$===null?(e$.done=!0,Ad(void 0,!0)):e$.global?(Ic(n$[0])===""&&(t$.lastIndex=JF(r$,rO(t$.lastIndex),e$.unicode)),Ad(n$,!1)):(e$.done=!0,Ad(n$,!1))}),tR=function(e$){var t$,r$,n$,i$=GF(this),o$=Ic(e$),s$=zF(i$,RegExp),a$=Ic(oO(i$));return t$=new s$(s$===RegExp?i$.source:i$,a$),r$=!!~IE(a$,"g"),n$=!!~IE(a$,"u"),t$.lastIndex=rO(i$.lastIndex),new eB(t$,o$,r$,n$)};BF({target:"String",proto:!0,forced:Rp},{matchAll:function(e$){var t$,r$,n$,i$,o$=$S(this);if(WF(e$)){if(Rp)return jl(o$,e$)}else{if(KF(e$)&&(t$=Ic($S(oO(e$))),!~IE(t$,"g")))throw tB("`.matchAll` does not allow non-global regexes");if(Rp)return jl(o$,e$);if((n$=YF(e$,QF))===void 0&&HF(e$)=="RegExp"&&(n$=tR),n$)return ZS(n$,e$,o$)}return r$=Ic(o$),i$=new RegExp(e$,"g"),ZS(tR,i$,r$)}});var nB=bi("String").matchAll,iB=hn,rB=nB,Cp=String.prototype,oB=function(e$){var t$=e$.matchAll;return typeof e$=="string"||e$===Cp||iB(Cp,e$)&&t$===Cp.matchAll?rB:t$},sB=ae(oB);function dO(e$){function t$(r$,n$,i$,o$){let s$=r$[o$++];if(s$==="__proto__")return!0;let a$=Number.isFinite(+s$),c$=o$>=r$.length;return s$=!s$&&K.isArray(i$)?i$.length:s$,c$?(K.hasOwnProp(i$,s$)?i$[s$]=[i$[s$],n$]:i$[s$]=n$,!a$):(i$[s$]&&K.isObject(i$[s$])||(i$[s$]=[]),t$(r$,n$,i$[s$],o$)&&K.isArray(i$[s$])&&(i$[s$]=function(u$){let l$={},d$=Object.keys(u$),h$,p$=d$.length,_$;for(h$=0;h$<p$;h$++)_$=d$[h$],l$[_$]=u$[_$];return l$}(i$[s$])),!a$)}if(K.isFormData(e$)&&K.isFunction(e$.entries)){let r$={};return K.forEachEntry(e$,(n$,i$)=>{t$(function(o$){return sB(K).call(K,/\w+|\[(\w*)]/g,o$).map(s$=>s$[0]==="[]"?"":s$[1]||s$[0])}(n$),i$,r$,0)}),r$}return null}var af={transitional:gw,adapter:["xhr","http"],transformRequest:[function(e$,t$){let r$=t$.getContentType()||"",n$=r$.indexOf("application/json")>-1,i$=K.isObject(e$);if(i$&&K.isHTMLForm(e$)&&(e$=new FormData(e$)),K.isFormData(e$))return n$?JSON.stringify(dO(e$)):e$;if(K.isArrayBuffer(e$)||K.isBuffer(e$)||K.isStream(e$)||K.isFile(e$)||K.isBlob(e$))return e$;if(K.isArrayBufferView(e$))return e$.buffer;if(K.isURLSearchParams(e$))return t$.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e$.toString();let o$;if(i$){if(r$.indexOf("application/x-www-form-urlencoded")>-1)return function(s$,a$){return Ul(s$,new sr.classes.URLSearchParams,Object.assign({visitor:function(c$,u$,l$,d$){return sr.isNode&&K.isBuffer(c$)?(this.append(u$,c$.toString("base64")),!1):d$.defaultVisitor.apply(this,arguments)}},a$))}(e$,this.formSerializer).toString();if((o$=K.isFileList(e$))||r$.indexOf("multipart/form-data")>-1){let s$=this.env&&this.env.FormData;return Ul(o$?{"files[]":e$}:e$,s$&&new s$,this.formSerializer)}}return i$||n$?(t$.setContentType("application/json",!1),function(s$,a$,c$){if(K.isString(s$))try{return(a$||JSON.parse)(s$),rn(K).call(K,s$)}catch(u$){if(u$.name!=="SyntaxError")throw u$}return(0,JSON.stringify)(s$)}(e$)):e$}],transformResponse:[function(e$){let t$=this.transitional||af.transitional,r$=t$&&t$.forcedJSONParsing,n$=this.responseType==="json";if(e$&&K.isString(e$)&&(r$&&!this.responseType||n$)){let i$=!(t$&&t$.silentJSONParsing)&&n$;try{return JSON.parse(e$)}catch(o$){if(i$)throw o$.name==="SyntaxError"?qt.from(o$,qt.ERR_BAD_RESPONSE,this,null,this.response):o$}}return e$}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:sr.classes.FormData,Blob:sr.classes.Blob},validateStatus:function(e$){return e$>=200&&e$<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};K.forEach(["delete","get","head","post","put","patch"],e$=>{af.headers[e$]={}});var cf=af,aB=K.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),eR=Symbol("internals");function Da(e$){var t$;return e$&&rn(t$=String(e$)).call(t$).toLowerCase()}function El(e$){return e$===!1||e$==null?e$:K.isArray(e$)?e$.map(El):String(e$)}function Ip(e$,t$,r$,n$,i$){return K.isFunction(n$)?n$.call(this,t$,r$):(i$&&(t$=r$),K.isString(t$)?K.isString(n$)?t$.indexOf(n$)!==-1:K.isRegExp(n$)?n$.test(t$):void 0:void 0)}var Gs=class{constructor(e$){e$&&this.set(e$)}set(e$,t$,r$){let n$=this;function i$(a$,c$,u$){let l$=Da(c$);if(!l$)throw new Error("header name must be a non-empty string");let d$=K.findKey(n$,l$);(!d$||n$[d$]===void 0||u$===!0||u$===void 0&&n$[d$]!==!1)&&(n$[d$||c$]=El(a$))}let o$=(a$,c$)=>K.forEach(a$,(u$,l$)=>i$(u$,l$,c$));var s$;return K.isPlainObject(e$)||e$ instanceof this.constructor?o$(e$,t$):K.isString(e$)&&(e$=rn(e$).call(e$))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(rn(s$=e$).call(s$))?o$((a$=>{let c$={},u$,l$,d$;return a$&&a$.split(`
`).forEach(function(h$){var p$,_$;d$=h$.indexOf(":"),u$=rn(p$=h$.substring(0,d$)).call(p$).toLowerCase(),l$=rn(_$=h$.substring(d$+1)).call(_$),!u$||c$[u$]&&aB[u$]||(u$==="set-cookie"?c$[u$]?c$[u$].push(l$):c$[u$]=[l$]:c$[u$]=c$[u$]?c$[u$]+", "+l$:l$)}),c$})(e$),t$):e$!=null&&i$(t$,e$,r$),this}get(e$,t$){if(e$=Da(e$)){let r$=K.findKey(this,e$);if(r$){let n$=this[r$];if(!t$)return n$;if(t$===!0)return function(i$){let o$=Object.create(null),s$=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,a$;for(;a$=s$.exec(i$);)o$[a$[1]]=a$[2];return o$}(n$);if(K.isFunction(t$))return t$.call(this,n$,r$);if(K.isRegExp(t$))return t$.exec(n$);throw new TypeError("parser must be boolean|regexp|function")}}}has(e$,t$){if(e$=Da(e$)){let r$=K.findKey(this,e$);return!(!r$||this[r$]===void 0||t$&&!Ip(0,this[r$],r$,t$))}return!1}delete(e$,t$){let r$=this,n$=!1;function i$(o$){if(o$=Da(o$)){let s$=K.findKey(r$,o$);!s$||t$&&!Ip(0,r$[s$],s$,t$)||(delete r$[s$],n$=!0)}}return K.isArray(e$)?e$.forEach(i$):i$(e$),n$}clear(e$){let t$=Object.keys(this),r$=t$.length,n$=!1;for(;r$--;){let i$=t$[r$];e$&&!Ip(0,this[i$],i$,e$,!0)||(delete this[i$],n$=!0)}return n$}normalize(e$){let t$=this,r$={};return K.forEach(this,(n$,i$)=>{var o$;let s$=K.findKey(r$,i$);if(s$)return t$[s$]=El(n$),void delete t$[i$];let a$=e$?function(c$){return rn(c$).call(c$).toLowerCase().replace(/([a-z\d])(\w*)/g,(u$,l$,d$)=>l$.toUpperCase()+d$)}(i$):rn(o$=String(i$)).call(o$);a$!==i$&&delete t$[i$],t$[a$]=El(n$),r$[a$]=!0}),this}concat(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];return this.constructor.concat(this,...t$)}toJSON(e$){let t$=Object.create(null);return K.forEach(this,(r$,n$)=>{r$!=null&&r$!==!1&&(t$[n$]=e$&&K.isArray(r$)?r$.join(", "):r$)}),t$}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e$=>{let[t$,r$]=e$;return t$+": "+r$}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e$){return e$ instanceof this?e$:new this(e$)}static concat(e$){let t$=new this(e$);for(var r$=arguments.length,n$=new Array(r$>1?r$-1:0),i$=1;i$<r$;i$++)n$[i$-1]=arguments[i$];return n$.forEach(o$=>t$.set(o$)),t$}static accessor(e$){let t$=(this[eR]=this[eR]={accessors:{}}).accessors,r$=this.prototype;function n$(i$){let o$=Da(i$);t$[o$]||(function(s$,a$){let c$=K.toCamelCase(" "+a$);["get","set","has"].forEach(u$=>{Object.defineProperty(s$,u$+c$,{value:function(l$,d$,h$){return this[u$].call(this,a$,l$,d$,h$)},configurable:!0})})}(r$,i$),t$[o$]=!0)}return K.isArray(e$)?e$.forEach(n$):n$(e$),this}};Gs.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),K.reduceDescriptors(Gs.prototype,(e$,t$)=>{let{value:r$}=e$,n$=t$[0].toUpperCase()+t$.slice(1);return{get:()=>r$,set(i$){this[n$]=i$}}}),K.freezeMethods(Gs);var Dr=Gs;function vp(e$,t$){let r$=this||cf,n$=t$||r$,i$=Dr.from(n$.headers),o$=n$.data;return K.forEach(e$,function(s$){o$=s$.call(r$,o$,i$.normalize(),t$?t$.status:void 0)}),i$.normalize(),o$}function lO(e$){return!(!e$||!e$.__CANCEL__)}function od(e$,t$,r$){qt.call(this,e$??"canceled",qt.ERR_CANCELED,t$,r$),this.name="CanceledError"}K.inherits(od,qt,{__CANCEL__:!0});var cB=sr.hasStandardBrowserEnv?{write(e$,t$,r$,n$,i$,o$){let s$=[e$+"="+encodeURIComponent(t$)];K.isNumber(r$)&&s$.push("expires="+new Date(r$).toGMTString()),K.isString(n$)&&s$.push("path="+n$),K.isString(i$)&&s$.push("domain="+i$),o$===!0&&s$.push("secure"),document.cookie=s$.join("; ")},read(e$){let t$=document.cookie.match(new RegExp("(^|;\\s*)("+e$+")=([^;]*)"));return t$?decodeURIComponent(t$[3]):null},remove(e$){this.write(e$,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function uO(e$,t$){return e$&&!function(r$){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r$)}(t$)?function(r$,n$){return n$?r$.replace(/\/?\/$/,"")+"/"+n$.replace(/^\/+/,""):r$}(e$,t$):t$}var dB=sr.hasStandardBrowserEnv?function(){let e$=/(msie|trident)/i.test(navigator.userAgent),t$=document.createElement("a"),r$;function n$(i$){let o$=i$;return e$&&(t$.setAttribute("href",o$),o$=t$.href),t$.setAttribute("href",o$),{href:t$.href,protocol:t$.protocol?t$.protocol.replace(/:$/,""):"",host:t$.host,search:t$.search?t$.search.replace(/^\?/,""):"",hash:t$.hash?t$.hash.replace(/^#/,""):"",hostname:t$.hostname,port:t$.port,pathname:t$.pathname.charAt(0)==="/"?t$.pathname:"/"+t$.pathname}}return r$=n$(window.location.href),function(i$){let o$=K.isString(i$)?n$(i$):i$;return o$.protocol===r$.protocol&&o$.host===r$.host}}():function(){return!0};function nR(e$,t$){let r$=0,n$=function(i$,o$){i$=i$||10;let s$=new Array(i$),a$=new Array(i$),c$,u$=0,l$=0;return o$=o$!==void 0?o$:1e3,function(d$){let h$=Date.now(),p$=a$[l$];c$||(c$=h$),s$[u$]=d$,a$[u$]=h$;let _$=l$,f$=0;for(;_$!==u$;)f$+=s$[_$++],_$%=i$;if(u$=(u$+1)%i$,u$===l$&&(l$=(l$+1)%i$),h$-c$<o$)return;let m$=p$&&h$-p$;return m$?Math.round(1e3*f$/m$):void 0}}(50,250);return i$=>{let o$=i$.loaded,s$=i$.lengthComputable?i$.total:void 0,a$=o$-r$,c$=n$(a$);r$=o$;let u$={loaded:o$,total:s$,progress:s$?o$/s$:void 0,bytes:a$,rate:c$||void 0,estimated:c$&&s$&&o$<=s$?(s$-o$)/c$:void 0,event:i$};u$[t$?"download":"upload"]=!0,e$(u$)}}var lB=typeof XMLHttpRequest<"u"&&function(e$){return new j(function(t$,r$){let n$=e$.data,i$=Dr.from(e$.headers).normalize(),o$,s$,{responseType:a$,withXSRFToken:c$}=e$;function u$(){e$.cancelToken&&e$.cancelToken.unsubscribe(o$),e$.signal&&e$.signal.removeEventListener("abort",o$)}if(K.isFormData(n$)){if(sr.hasStandardBrowserEnv||sr.hasStandardBrowserWebWorkerEnv)i$.setContentType(!1);else if((s$=i$.getContentType())!==!1){let[_$,...f$]=s$?s$.split(";").map(m$=>rn(m$).call(m$)).filter(Boolean):[];i$.setContentType([_$||"multipart/form-data",...f$].join("; "))}}let l$=new XMLHttpRequest;if(e$.auth){let _$=e$.auth.username||"",f$=e$.auth.password?unescape(encodeURIComponent(e$.auth.password)):"";i$.set("Authorization","Basic "+btoa(_$+":"+f$))}let d$=uO(e$.baseURL,e$.url);function h$(){if(!l$)return;let _$=Dr.from("getAllResponseHeaders"in l$&&l$.getAllResponseHeaders());(function(f$,m$,g$){let v$=g$.config.validateStatus;g$.status&&v$&&!v$(g$.status)?m$(new qt("Request failed with status code "+g$.status,[qt.ERR_BAD_REQUEST,qt.ERR_BAD_RESPONSE][Math.floor(g$.status/100)-4],g$.config,g$.request,g$)):f$(g$)})(function(f$){t$(f$),u$()},function(f$){r$(f$),u$()},{data:a$&&a$!=="text"&&a$!=="json"?l$.response:l$.responseText,status:l$.status,statusText:l$.statusText,headers:_$,config:e$,request:l$}),l$=null}if(l$.open(e$.method.toUpperCase(),fw(d$,e$.params,e$.paramsSerializer),!0),l$.timeout=e$.timeout,"onloadend"in l$?l$.onloadend=h$:l$.onreadystatechange=function(){l$&&l$.readyState===4&&(l$.status!==0||l$.responseURL&&l$.responseURL.indexOf("file:")===0)&&setTimeout(h$)},l$.onabort=function(){l$&&(r$(new qt("Request aborted",qt.ECONNABORTED,e$,l$)),l$=null)},l$.onerror=function(){r$(new qt("Network Error",qt.ERR_NETWORK,e$,l$)),l$=null},l$.ontimeout=function(){let _$=e$.timeout?"timeout of "+e$.timeout+"ms exceeded":"timeout exceeded",f$=e$.transitional||gw;e$.timeoutErrorMessage&&(_$=e$.timeoutErrorMessage),r$(new qt(_$,f$.clarifyTimeoutError?qt.ETIMEDOUT:qt.ECONNABORTED,e$,l$)),l$=null},sr.hasStandardBrowserEnv&&(c$&&K.isFunction(c$)&&(c$=c$(e$)),c$||c$!==!1&&dB(d$))){let _$=e$.xsrfHeaderName&&e$.xsrfCookieName&&cB.read(e$.xsrfCookieName);_$&&i$.set(e$.xsrfHeaderName,_$)}n$===void 0&&i$.setContentType(null),"setRequestHeader"in l$&&K.forEach(i$.toJSON(),function(_$,f$){l$.setRequestHeader(f$,_$)}),K.isUndefined(e$.withCredentials)||(l$.withCredentials=!!e$.withCredentials),a$&&a$!=="json"&&(l$.responseType=e$.responseType),typeof e$.onDownloadProgress=="function"&&l$.addEventListener("progress",nR(e$.onDownloadProgress,!0)),typeof e$.onUploadProgress=="function"&&l$.upload&&l$.upload.addEventListener("progress",nR(e$.onUploadProgress)),(e$.cancelToken||e$.signal)&&(o$=_$=>{l$&&(r$(!_$||_$.type?new od(null,e$,l$):_$),l$.abort(),l$=null)},e$.cancelToken&&e$.cancelToken.subscribe(o$),e$.signal&&(e$.signal.aborted?o$():e$.signal.addEventListener("abort",o$)));let p$=function(_$){let f$=/^([-+\w]{1,25})(:?\/\/|:)/.exec(_$);return f$&&f$[1]||""}(d$);p$&&sr.protocols.indexOf(p$)===-1?r$(new qt("Unsupported protocol "+p$+":",qt.ERR_BAD_REQUEST,e$)):l$.send(n$||null)})},vE={http:null,xhr:lB};K.forEach(vE,(e$,t$)=>{if(e$){try{Object.defineProperty(e$,"name",{value:t$})}catch{}Object.defineProperty(e$,"adapterName",{value:t$})}});var iR=e$=>"- ".concat(e$),uB=e$=>K.isFunction(e$)||e$===null||e$===!1,hO={getAdapter:e$=>{e$=K.isArray(e$)?e$:[e$];let{length:t$}=e$,r$,n$,i$={};for(let o$=0;o$<t$;o$++){let s$;if(r$=e$[o$],n$=r$,!uB(r$)&&(n$=vE[(s$=String(r$)).toLowerCase()],n$===void 0))throw new qt("Unknown adapter '".concat(s$,"'"));if(n$)break;i$[s$||"#"+o$]=n$}if(!n$){let o$=Object.entries(i$).map(s$=>{let[a$,c$]=s$;return"adapter ".concat(a$," ")+(c$===!1?"is not supported by the environment":"is not available in the build")});throw new qt("There is no suitable adapter to dispatch the request "+(t$?o$.length>1?`since :
`+o$.map(iR).join(`
`):" "+iR(o$[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n$},adapters:vE};function yp(e$){if(e$.cancelToken&&e$.cancelToken.throwIfRequested(),e$.signal&&e$.signal.aborted)throw new od(null,e$)}function rR(e$){return yp(e$),e$.headers=Dr.from(e$.headers),e$.data=vp.call(e$,e$.transformRequest),["post","put","patch"].indexOf(e$.method)!==-1&&e$.headers.setContentType("application/x-www-form-urlencoded",!1),hO.getAdapter(e$.adapter||cf.adapter)(e$).then(function(t$){return yp(e$),t$.data=vp.call(e$,e$.transformResponse,t$),t$.headers=Dr.from(t$.headers),t$},function(t$){return lO(t$)||(yp(e$),t$&&t$.response&&(t$.response.data=vp.call(e$,e$.transformResponse,t$.response),t$.response.headers=Dr.from(t$.response.headers))),j.reject(t$)})}function oR(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}var sR=e$=>e$ instanceof Dr?function(t$){for(var r$=1;r$<arguments.length;r$++){var n$=arguments[r$]!=null?arguments[r$]:{};r$%2?oR(Object(n$),!0).forEach(function(i$){T(t$,i$,n$[i$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t$,Object.getOwnPropertyDescriptors(n$)):oR(Object(n$)).forEach(function(i$){Object.defineProperty(t$,i$,Object.getOwnPropertyDescriptor(n$,i$))})}return t$}({},e$):e$;function Qs(e$,t$){t$=t$||{};let r$={};function n$(u$,l$,d$){return K.isPlainObject(u$)&&K.isPlainObject(l$)?K.merge.call({caseless:d$},u$,l$):K.isPlainObject(l$)?K.merge({},l$):K.isArray(l$)?l$.slice():l$}function i$(u$,l$,d$){return K.isUndefined(l$)?K.isUndefined(u$)?void 0:n$(void 0,u$,d$):n$(u$,l$,d$)}function o$(u$,l$){if(!K.isUndefined(l$))return n$(void 0,l$)}function s$(u$,l$){return K.isUndefined(l$)?K.isUndefined(u$)?void 0:n$(void 0,u$):n$(void 0,l$)}function a$(u$,l$,d$){return d$ in t$?n$(u$,l$):d$ in e$?n$(void 0,u$):void 0}let c$={url:o$,method:o$,data:o$,baseURL:s$,transformRequest:s$,transformResponse:s$,paramsSerializer:s$,timeout:s$,timeoutMessage:s$,withCredentials:s$,withXSRFToken:s$,adapter:s$,responseType:s$,xsrfCookieName:s$,xsrfHeaderName:s$,onUploadProgress:s$,onDownloadProgress:s$,decompress:s$,maxContentLength:s$,maxBodyLength:s$,beforeRedirect:s$,transport:s$,httpAgent:s$,httpsAgent:s$,cancelToken:s$,socketPath:s$,responseEncoding:s$,validateStatus:a$,headers:(u$,l$)=>i$(sR(u$),sR(l$),!0)};return K.forEach(Object.keys(Object.assign({},e$,t$)),function(u$){let l$=c$[u$]||i$,d$=l$(e$[u$],t$[u$],u$);K.isUndefined(d$)&&l$!==a$||(r$[u$]=d$)}),r$}var pO="1.6.8",df={};["object","boolean","number","function","string","symbol"].forEach((e$,t$)=>{df[e$]=function(r$){return typeof r$===e$||"a"+(t$<1?"n ":" ")+e$}});var aR={};df.transitional=function(e$,t$,r$){function n$(i$,o$){return"[Axios v"+pO+"] Transitional option '"+i$+"'"+o$+(r$?". "+r$:"")}return(i$,o$,s$)=>{if(e$===!1)throw new qt(n$(o$," has been removed"+(t$?" in "+t$:"")),qt.ERR_DEPRECATED);return t$&&!aR[o$]&&(aR[o$]=!0,console.warn(n$(o$," has been deprecated since v"+t$+" and will be removed in the near future"))),!e$||e$(i$,o$,s$)}};var yE={assertOptions:function(e$,t$,r$){if(typeof e$!="object")throw new qt("options must be an object",qt.ERR_BAD_OPTION_VALUE);let n$=Object.keys(e$),i$=n$.length;for(;i$-- >0;){let o$=n$[i$],s$=t$[o$];if(s$){let a$=e$[o$],c$=a$===void 0||s$(a$,o$,e$);if(c$!==!0)throw new qt("option "+o$+" must be "+c$,qt.ERR_BAD_OPTION_VALUE)}else if(r$!==!0)throw new qt("Unknown option "+o$,qt.ERR_BAD_OPTION)}},validators:df},Fr=yE.validators,ml=class{constructor(e$){this.defaults=e$,this.interceptors={request:new ZT,response:new ZT}}async request(e$,t$){try{return await this._request(e$,t$)}catch(r$){if(r$ instanceof Error){let n$;Error.captureStackTrace?Error.captureStackTrace(n$={}):n$=new Error;let i$=n$.stack?n$.stack.replace(/^.+\n/,""):"";r$.stack?i$&&!String(r$.stack).endsWith(i$.replace(/^.+\n.+\n/,""))&&(r$.stack+=`
`+i$):r$.stack=i$}throw r$}}_request(e$,t$){typeof e$=="string"?(t$=t$||{}).url=e$:t$=e$||{},t$=Qs(this.defaults,t$);let{transitional:r$,paramsSerializer:n$,headers:i$}=t$;r$!==void 0&&yE.assertOptions(r$,{silentJSONParsing:Fr.transitional(Fr.boolean),forcedJSONParsing:Fr.transitional(Fr.boolean),clarifyTimeoutError:Fr.transitional(Fr.boolean)},!1),n$!=null&&(K.isFunction(n$)?t$.paramsSerializer={serialize:n$}:yE.assertOptions(n$,{encode:Fr.function,serialize:Fr.function},!0)),t$.method=(t$.method||this.defaults.method||"get").toLowerCase();let o$=i$&&K.merge(i$.common,i$[t$.method]);i$&&K.forEach(["delete","get","head","post","put","patch","common"],p$=>{delete i$[p$]}),t$.headers=Dr.concat(o$,i$);let s$=[],a$=!0;this.interceptors.request.forEach(function(p$){typeof p$.runWhen=="function"&&p$.runWhen(t$)===!1||(a$=a$&&p$.synchronous,s$.unshift(p$.fulfilled,p$.rejected))});let c$=[],u$;this.interceptors.response.forEach(function(p$){c$.push(p$.fulfilled,p$.rejected)});let l$,d$=0;if(!a$){let p$=[rR.bind(this),void 0];for(p$.unshift.apply(p$,s$),p$.push.apply(p$,c$),l$=p$.length,u$=j.resolve(t$);d$<l$;)u$=u$.then(p$[d$++],p$[d$++]);return u$}l$=s$.length;let h$=t$;for(d$=0;d$<l$;){let p$=s$[d$++],_$=s$[d$++];try{h$=p$(h$)}catch(f$){_$.call(this,f$);break}}try{u$=rR.call(this,h$)}catch(p$){return j.reject(p$)}for(d$=0,l$=c$.length;d$<l$;)u$=u$.then(c$[d$++],c$[d$++]);return u$}getUri(e$){return fw(uO((e$=Qs(this.defaults,e$)).baseURL,e$.url),e$.params,e$.paramsSerializer)}};K.forEach(["delete","get","head","options"],function(e$){ml.prototype[e$]=function(t$,r$){return this.request(Qs(r$||{},{method:e$,url:t$,data:(r$||{}).data}))}}),K.forEach(["post","put","patch"],function(e$){function t$(r$){return function(n$,i$,o$){return this.request(Qs(o$||{},{method:e$,headers:r$?{"Content-Type":"multipart/form-data"}:{},url:n$,data:i$}))}}ml.prototype[e$]=t$(),ml.prototype[e$+"Form"]=t$(!0)});var fl=ml,AE=class w5{constructor(t$){if(typeof t$!="function")throw new TypeError("executor must be a function.");let r$;this.promise=new j(function(i$){r$=i$});let n$=this;this.promise.then(i$=>{if(!n$._listeners)return;let o$=n$._listeners.length;for(;o$-- >0;)n$._listeners[o$](i$);n$._listeners=null}),this.promise.then=i$=>{let o$,s$=new j(a$=>{n$.subscribe(a$),o$=a$}).then(i$);return s$.cancel=function(){n$.unsubscribe(o$)},s$},t$(function(i$,o$,s$){n$.reason||(n$.reason=new od(i$,o$,s$),r$(n$.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t$){this.reason?t$(this.reason):this._listeners?this._listeners.push(t$):this._listeners=[t$]}unsubscribe(t$){if(!this._listeners)return;let r$=this._listeners.indexOf(t$);r$!==-1&&this._listeners.splice(r$,1)}static source(){let t$;return{token:new w5(function(r$){t$=r$}),cancel:t$}}},hB=AE,bE={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(bE).forEach(e$=>{let[t$,r$]=e$;bE[r$]=t$});var pB=bE,Xe=function e$(t$){let r$=new fl(t$),n$=_w(fl.prototype.request,r$);return K.extend(n$,fl.prototype,r$,{allOwnKeys:!0}),K.extend(n$,r$,null,{allOwnKeys:!0}),n$.create=function(i$){return e$(Qs(t$,i$))},n$}(cf);Xe.Axios=fl,Xe.CanceledError=od,Xe.CancelToken=hB,Xe.isCancel=lO,Xe.VERSION=pO,Xe.toFormData=Ul,Xe.AxiosError=qt,Xe.Cancel=Xe.CanceledError,Xe.all=function(e$){return j.all(e$)},Xe.spread=function(e$){return function(t$){return e$.apply(null,t$)}},Xe.isAxiosError=function(e$){return K.isObject(e$)&&e$.isAxiosError===!0},Xe.mergeConfig=Qs,Xe.AxiosHeaders=Dr,Xe.formToJSON=e$=>dO(K.isHTMLForm(e$)?new FormData(e$):e$),Xe.getAdapter=hO.getAdapter,Xe.HttpStatusCode=pB,Xe.default=Xe;var mn=Xe,_B=()=>{};function vc(){let e$={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:_B};return e$.promise=new j((t$,r$)=>{e$.resolve=n$=>{e$.isFinished||(e$.isResolved=!0,e$.isFinished=!0,t$(n$),e$.value=n$)},e$.reject=n$=>{e$.isFinished||(e$.isRejected=!0,e$.isFinished=!0,r$(n$))}}),e$}var bd=new Map,wd=new Map,Yi=new Map,ye=function(e$){return e$.WIN_10="Windows 10",e$.WIN_81="Windows 8.1",e$.WIN_8="Windows 8",e$.WIN_7="Windows 7",e$.WIN_VISTA="Windows Vista",e$.WIN_SERVER_2003="Windows Server 2003",e$.WIN_XP="Windows XP",e$.WIN_2000="Windows 2000",e$.ANDROID="Android",e$.HARMONY_OS="HarmonyOS",e$.OPEN_BSD="Open BSD",e$.SUN_OS="Sun OS",e$.LINUX="Linux",e$.IOS="iOS",e$.MAC_OS="Mac OS",e$.CHROMIUM_OS="Chromium OS",e$.QNX="QNX",e$.UNIX="UNIX",e$.BEOS="BeOS",e$.OS_2="OS/2",e$.SEARCH_BOT="Search Bot",e$}({}),It=function(e$){return e$.CHROME="Chrome",e$.SAFARI="Safari",e$.EDGE="Edge",e$.FIREFOX="Firefox",e$.OPERA="OPR",e$.QQ="QQBrowser",e$.WECHAT="MicroMessenger",e$}({}),wE=new W2,Vi=wE.getResult(),Ap=null;function mt(e$){if(!Ap){Vi=wE.getResult();let t$=function(a$){if(a$.engine.name==="Blink"&&a$.browser.name!=="WeChat")return It.CHROME;switch(a$.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return It.CHROME;case"Safari":case"Mobile Safari":return It.SAFARI;case"Edge":return It.EDGE;case"Firefox":return It.FIREFOX;case"QQ":case"QQBrowser":return It.QQ;case"Opera":return It.OPERA;case"WeChat":return It.WECHAT;default:return a$.browser.name||""}}(Vi),r$=cR(Vi),n$=function(a$){return a$.os.name==="Windows"?a$.os.version?a$.os.name+" "+a$.os.version:a$.os.name:a$.os.name||""}(Vi),i$=Vi.os.version,o$=cR(Vi,!1),s$=Vi.device.type;if(!(t$&&r$&&n$&&i$))return{name:t$,version:r$,os:n$,osVersion:i$,browserVersion:o$,deviceType:s$};Ap={name:t$,version:r$,os:n$,osVersion:i$,browserVersion:o$,deviceType:s$}}return Ap}function cR(e$){let t$,r$=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t$=e$.engine.name==="Blink"?e$.engine.version||"":e$.browser.version||"",r$?t$.split(".")[0]:t$}function Hu(){return mt().os}function dR(){let e$=mt();return"".concat(e$.os," ").concat(e$.osVersion)}function Gl(){let e$=mt();return!!(Vi.engine.name==="WebKit"&&e$.os===ye.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e$.name!==It.SAFARI||ln()&&e$.name!==It.SAFARI)}function oo(){return mt().name===It.CHROME}function je(){return mt().name===It.SAFARI}function _O(){return mt().name===It.EDGE}function $t(){return mt().name===It.FIREFOX}function ln(){return mt().os===ye.IOS}function OE(e$){let t$=mt();return!(t$.name!==It.CHROME||!t$.osVersion)&&Number(t$.version)>=e$}function EO(e$){let t$=mt();return!(t$.name!==It.CHROME||!t$.osVersion)&&Number(t$.version)<e$}function lR(e$){let t$=mt();return!(t$.name!==It.EDGE||!t$.osVersion)&&Number(t$.version)>=e$}function mO(e$){let t$=mt();return!(t$.name!==It.SAFARI||!t$.osVersion)&&Number(t$.version)>=e$}function fO(e$,t$,r$){let n$=mt();if(n$.os!==ye.IOS||!n$.osVersion)return!1;let i$=n$.osVersion.split(".");return t$&&Number(i$[0])===e$&&Number(i$[1])<t$||Number(i$[0])<e$}function gO(e$,t$,r$){let n$=mt();if(n$.name!==It.SAFARI||!n$.osVersion||!n$.browserVersion)return!1;let i$=n$.browserVersion.split(".");return t$&&Number(i$[0])===e$&&Number(i$[1])<t$||Number(i$[0])<e$}function uR(e$){let t$=mt();return!(t$.name!==It.OPERA||!t$.osVersion)&&Number(t$.version)>=e$}function hR(){let e$=mt();if(e$.os!==ye.IOS||!e$.osVersion)return!1;let t$=e$.osVersion.split(".");return Number(t$[0])<14||Number(t$[0])===14&&Number(t$[1])<=6}function Zs(){let e$=mt();if(e$.os!==ye.IOS||!e$.osVersion)return!1;let t$=e$.osVersion.split(".");return Number(t$[0])===15}function NE(){let e$=mt();if(e$.os!==ye.IOS||!e$.osVersion)return!1;let t$=e$.osVersion.split(".");return Number(t$[0])===16}function pR(){let e$=mt();if(e$.os!==ye.IOS||!e$.osVersion)return!1;let t$=e$.osVersion.split(".");return Number(t$[0])===15&&Number(t$[1])>=1}function vi(){return je()&&navigator.maxTouchPoints>0}function TO(){return mt().name===It.WECHAT}function SO(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function lf(){let e$=Hu();return function(){let{deviceType:t$}=mt();return t$==="mobile"||t$==="tablet"}()||e$===ye.ANDROID||e$===ye.IOS||e$===ye.HARMONY_OS}function ho(){let e$=mt();return e$.name!==It.EDGE&&e$.name!==It.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Ku(){return Hu()===ye.ANDROID}function yc(){let e$=mt();return Ku()&&(e$.name===It.CHROME||e$.name===It.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function jt(e$,t$,r$){return(t$=function(n$){var i$=function(o$,s$){if(typeof o$!="object"||!o$)return o$;var a$=o$[Symbol.toPrimitive];if(a$!==void 0){var c$=a$.call(o$,"string");if(typeof c$!="object")return c$;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o$)}(n$);return typeof i$=="symbol"?i$:i$+""}(t$))in e$?Object.defineProperty(e$,t$,{value:r$,enumerable:!0,configurable:!0,writable:!0}):e$[t$]=r$,e$}function _R(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function J(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?_R(Object(r$),!0).forEach(function(n$){jt(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):_R(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var R=function(e$){return e$.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e$.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e$.TIMEOUT="TIMEOUT",e$.INVALID_PARAMS="INVALID_PARAMS",e$.NOT_READABLE="NOT_READABLE",e$.NOT_SUPPORTED="NOT_SUPPORTED",e$.INVALID_OPERATION="INVALID_OPERATION",e$.OPERATION_ABORTED="OPERATION_ABORTED",e$.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e$.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e$.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e$.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e$.NETWORK_ERROR="NETWORK_ERROR",e$.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e$.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e$.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e$.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e$.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e$.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e$.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e$.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e$.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e$.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e$.PERMISSION_DENIED="PERMISSION_DENIED",e$.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e$.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e$.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e$.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e$.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e$.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e$.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e$.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e$.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e$.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e$.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e$.UID_CONFLICT="UID_CONFLICT",e$.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e$.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e$.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e$.INVALID_TRACK="INVALID_TRACK",e$.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e$.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e$.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e$.ICE_FAILED="ICE_FAILED",e$.PC_CLOSED="PC_CLOSED",e$.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e$.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e$.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e$.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e$.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e$.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e$.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e$.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e$.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e$.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e$.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e$.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e$.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e$.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e$.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e$.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e$.WS_ABORT="WS_ABORT",e$.WS_DISCONNECT="WS_DISCONNECT",e$.WS_ERR="WS_ERR",e$.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e$.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e$.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e$.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e$.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e$.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e$.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e$.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e$.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e$.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e$.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e$.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e$.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e$.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e$.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e$.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e$.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e$.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e$.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e$.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e$.INVALID_PLUGIN="INVALID_PLUGIN",e$.DISCONNECT_P2P="DISCONNECT_P2P",e$.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e$.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e$.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e$.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e$.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e$.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e$.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e$.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e$}({}),N=class extends Error{constructor(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r$=arguments.length>2?arguments[2]:void 0;super(t$),jt(this,"code",void 0),jt(this,"message",void 0),jt(this,"data",void 0),jt(this,"name","AgoraRTCException"),this.code=e$,this.message="AgoraRTCError ".concat(this.code,": ").concat(t$),this.data=r$}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t$=arguments.length>1?arguments[1]:void 0;return e$==="error"&&(t$||console).error(this.toString()),e$==="warning"&&(t$||console).warn(this.toString()),this}throw(e$){throw this.print("error",e$),this}};function Nr(e$,t$){if(typeof e$!="boolean")throw new N(R.INVALID_PARAMS,"Invalid ".concat(t$,": The value is of the boolean type."))}function Ce(e$,t$,r$){if(!W(r$).call(r$,e$))throw new N(R.INVALID_PARAMS,"".concat(t$," can only be set as ").concat(JSON.stringify(r$)))}function Nt(e$,t$){let r$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n$=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e$<r$||e$>n$||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i$){return typeof i$=="number"&&i$%1==0}(e$))throw new N(R.INVALID_PARAMS,"invalid ".concat(t$,": the value range is [").concat(r$,", ").concat(n$,"]. integer only"))}function bp(e$,t$){if(typeof e$!="number"){if(!(e$.min||e$.max||e$.ideal||e$.exact))throw new N(R.INVALID_PARAMS,"".concat(t$," is not a valid ConstrainLong"));e$.min!==void 0&&Nt(e$.min,"".concat(t$,".min"),0,1/0),e$.max!==void 0&&Nt(e$.max,"".concat(t$,".max"),1,1/0),e$.exact!==void 0&&Nt(e$.exact,"".concat(t$,".exact"),1,1/0),e$.ideal!==void 0&&Nt(e$.ideal,"".concat(t$,".ideal"),1,1/0)}else Nt(e$,t$,1,1/0)}function Pe(e$,t$){let r$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n$=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i$=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e$==null)throw new N(R.INVALID_PARAMS,"".concat(t$||"param"," cannot be empty"));if(!RO(e$,r$,n$,i$))throw new N(R.INVALID_PARAMS,"Invalid ".concat(t$||"string param",": Length of the string: [").concat(r$,",").concat(n$,"].").concat(i$?" ASCII characters only.":""))}function br(e$,t$){if(!Array.isArray(e$))throw new N(R.INVALID_PARAMS,"".concat(t$," should be an array"))}function zt(e$){return e$==null}function RO(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,n$=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e$=="string"&&e$.length<=r$&&e$.length>=t$&&(!n$||function(i$){if(typeof i$!="string")return!1;for(let o$=0;o$<i$.length;o$+=1){let s$=i$.charCodeAt(o$);if(s$<0||s$>255)return!1}return!0}(e$))}var Ka=function(e$){return e$.COVERED="COVERED",e$.POSITION="POSITION",e$.SIZE="SIZE",e$.STYLE="STYLE",e$}(Ka||{}),DE=function(e$){return e$.UNMOUNTED="UNMOUNTED",e$.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e$}(DE||{}),CO=new class{constructor(){jt(this,"_clientSize",null),jt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),jt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),jt(this,"getStyle",e$=>window.getComputedStyle(e$,null)),jt(this,"checkCssVisibleProperty",e$=>{var t$;let r$=!0,n$=this.getStyle(e$),{display:i$,visibility:o$,opacity:s$,filter:a$}=n$;return(i$==="none"||W(t$=["hidden","collapse"]).call(t$,o$)||Number(s$)<.1)&&(r$=!1),!!r$&&(a$&&a$.split(" ").filter(c$=>{var u$;let l$=c$.split("(")[0];return W(u$=["brightness","blur","opacity"]).call(u$,l$)}).map(c$=>{let[u$,l$]=c$.split(/\(|\)/);return[u$,Number(l$.match(/^[0-9\.]+/))]}).forEach(c$=>{let[u$,l$]=c$;switch(u$){case"brightness":(l$<.1||l$>3)&&(r$=!1);break;case"blur":l$>3&&(r$=!1);break;case"opacity":l$<.1&&(r$=!1)}}),r$)}),jt(this,"checkPropertyUpToAllParentNodes",(e$,t$)=>{let r$=!0,n$=!0,i$=s$=>t$(s$),o$=e$;for(;o$&&n$;)i$(o$)||(r$=!1,n$=!1),o$=o$.parentElement,o$||(n$=!1);return r$}),jt(this,"checkActualCssVisibleIncludeInherit",e$=>this.checkPropertyUpToAllParentNodes(e$,this.checkCssVisibleProperty)),jt(this,"getSizeAboutClient",e$=>{let{width:t$,height:r$,left:n$,right:i$,top:o$,bottom:s$}=e$.getBoundingClientRect(),a$=this.getClientWidth(),c$=this.getClientHeight();return{width:t$,height:r$,left:n$,right:i$,top:o$,bottom:s$,clientWidth:a$,clientHeight:c$,clientMin:Math.min(a$,c$)}}),jt(this,"checkActualSize",()=>{let{width:e$,height:t$,clientMin:r$}=this._clientSize;return this.checkSizeIsVisible(e$,t$,r$)}),jt(this,"elementFromPoint",(e$,t$)=>document.elementFromPoint?document.elementFromPoint(e$,t$):null),jt(this,"checkCoverForAPoint",(e$,t$,r$)=>{let n$=this.elementFromPoint(e$,t$);return n$!==null&&n$!==r$}),jt(this,"getPointPositionList",()=>{let{width:e$,height:t$,left:r$,top:n$}=this._clientSize,i$=e$/6,o$=t$/6,s$=[],a$=10**6;for(let c$=0;c$<5;c$++)for(let u$=0;u$<5;u$++){let l$=(r$*a$+(c$===0?.1:c$===4?(i$*c$*a$-1e5)/a$:i$*c$)*a$)/a$,d$=(n$*a$+(u$===0?.1:u$===4?(o$*u$*a$-1e5)/a$:o$*u$)*a$)/a$;s$.push({x:l$,y:d$})}return[...s$]}),jt(this,"checkElementCover",e$=>this.getPointPositionList().map(t$=>this.checkCoverForAPoint(t$.x,t$.y,e$)).filter(t$=>!!t$).length>6),jt(this,"checkSizeIsVisible",(e$,t$,r$)=>(e$>50||r$/e$<=10)&&(t$>50||r$/t$<=10)),jt(this,"checkSizeOfPartInClient",()=>{let{left:e$,right:t$,top:r$,bottom:n$,clientHeight:i$,clientWidth:o$,clientMin:s$}=this._clientSize,a$,c$,u$,l$;if(e$<0)a$=0;else{if(!(e$<o$))return!1;a$=e$}if(t$<0)return!1;if(c$=t$<o$?t$:o$,r$<0)u$=0;else{if(!(r$<i$))return!1;u$=r$}if(n$<0)return!1;l$=n$<i$?n$:i$;let d$=c$-a$,h$=l$-u$;return this.checkSizeIsVisible(d$,h$,s$)}),jt(this,"returnHiddenResult",e$=>(this._clientSize=null,{visible:!1,reason:e$})),jt(this,"checkOneElementVisible",e$=>{if(e$ instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e$)){if(this.checkActualCssVisibleIncludeInherit(e$)){if(this._clientSize=this.getSizeAboutClient(e$),this.checkElementCover(e$))return this.returnHiddenResult(Ka.COVERED);{let t$=this.checkActualSize(),r$=this.checkSizeOfPartInClient();return t$&&!r$?this.returnHiddenResult(Ka.POSITION):t$?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Ka.SIZE)}}return this.returnHiddenResult(Ka.STYLE)}return this.returnHiddenResult(DE.UNMOUNTED)}return this.returnHiddenResult(DE.INVALID_HTML_ELEMENT)}),jt(this,"checkElementIsMountedOnDom",e$=>this.checkPropertyUpToAllParentNodes(e$,t$=>t$.nodeName.toUpperCase()!=="HTML"?t$.parentElement!==null:!!document.documentElement))}};function uf(e$){return new TextEncoder().encode(e$)}var ER=function(e$,t$){let r$=new Uint8Array(e$.byteLength+t$.byteLength);return r$.set(new Uint8Array(e$),0),r$.set(new Uint8Array(t$),e$.byteLength),r$},PE=async e$=>function(t$,r$){let n$="";return new Uint8Array(t$).forEach(i$=>{n$+=i$.toString(r$).padStart(2,"0")}),n$}(await crypto.subtle.digest("SHA-256",uf(e$)),16),Xt=class{constructor(){jt(this,"_events",{}),jt(this,"addListener",this.on)}getListeners(e$){return this._events[e$]?this._events[e$].map(t$=>t$.listener):[]}on(e$,t$){this._events[e$]||(this._events[e$]=[]);let r$=this._events[e$];this._indexOfListener(r$,t$)===-1&&r$.push({listener:t$,once:!1})}once(e$,t$){this._events[e$]||(this._events[e$]=[]);let r$=this._events[e$];this._indexOfListener(r$,t$)===-1&&r$.push({listener:t$,once:!0})}off(e$,t$){if(!this._events[e$])return;let r$=this._events[e$],n$=this._indexOfListener(r$,t$);n$!==-1&&r$.splice(n$,1),this._events[e$].length===0&&delete this._events[e$]}removeAllListeners(e$){e$?delete this._events[e$]:this._events={}}emit(e$){this._events[e$]||(this._events[e$]=[]);let t$=this._events[e$].map(o$=>o$);for(var r$=arguments.length,n$=new Array(r$>1?r$-1:0),i$=1;i$<r$;i$++)n$[i$-1]=arguments[i$];for(let o$=0;o$<t$.length;o$+=1){let s$=t$[o$];s$.once&&this.off(e$,s$.listener),s$.listener.apply(this,n$||[])}}safeEmit(e$){for(var t$=arguments.length,r$=new Array(t$>1?t$-1:0),n$=1;n$<t$;n$++)r$[n$-1]=arguments[n$];[...this._events[e$]||[]].forEach(i$=>{i$.once&&this.off(e$,i$.listener);try{i$.listener.apply(this,r$)}catch(o$){console.error("safeEmit event:".concat(e$," error ").concat(o$==null?void 0:o$.toString()))}})}_indexOfListener(e$,t$){let r$=e$.length;for(;r$--;)if(e$[r$].listener===t$)return r$;return-1}},Pa=null;function IO(){if(Pa)return Pa;if(window.electron)return Pa=window.electron;if(!window.require)return null;try{return Pa=window.require("electron"),Pa}catch{return null}}var Te=function(e$){return e$.CREATE_CLIENT="createClient",e$.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e$.SET_AREA="setArea",e$.PRELOAD="PRELOAD",e$.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e$.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e$.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e$.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e$.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e$.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e$.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e$.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e$.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e$.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e$.START_PROXY_SERVER="Client.startProxyServer",e$.STOP_PROXY_SERVER="Client.stopProxyServer",e$.SET_PROXY_SERVER="Client.setProxyServer",e$.SET_TURN_SERVER="Client.setTurnServer",e$.SET_CLIENT_ROLE="Client.setClientRole",e$.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e$.ENABLE_DUAL_STREAM="Client.enableDualStream",e$.DISABLE_DUAL_STREAM="Client.disableDualStream",e$.JOIN="Client.join",e$.LEAVE="Client.leave",e$.PUBLISH="Client.publish",e$.UNPUBLISH="Client.unpublish",e$.SUBSCRIBE="Client.subscribe",e$.MASS_SUBSCRIBE="Client.massSubscribe",e$.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e$.UNSUBSCRIBE="Client.unsubscribe",e$.RENEW_TOKEN="Client.renewToken",e$.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e$.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e$.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e$.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e$.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e$.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e$.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e$.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e$.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e$.START_LIVE_STREAMING="Client.startLiveStreaming",e$.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e$.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e$.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e$.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e$.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e$.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e$.SET_CONFIG_DISTRIBUTE="_configDistribute",e$.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e$.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e$.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e$.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e$.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e$.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e$.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e$.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e$.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e$.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e$.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e$.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e$.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e$.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e$.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e$.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e$.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e$.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e$.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e$.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e$.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e$.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e$.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e$.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e$.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e$.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e$.STREAM_TYPE_CHANGE="streamTypeChange",e$.CONNECTION_STATE_CHANGE="connectionStateChange",e$.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e$.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e$}({}),Zt=function(e$){return e$.TRACER="tracer",e$}({});function mR(e$){return Nt(e$.timeout,"config.timeout",0,1e5),Nt(e$.timeoutFactor,"config.timeoutFactor",0,100,!1),Nt(e$.maxRetryCount,"config.maxRetryConfig",0,1/0),Nt(e$.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}var EB=function(e$){return e$[e$.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e$[e$.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e$[e$.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e$}({}),At=function(e$){return e$.LEAVE="LEAVE",e$.NETWORK_ERROR="NETWORK_ERROR",e$.SERVER_ERROR="SERVER_ERROR",e$.UID_BANNED="UID_BANNED",e$.FALLBACK="FALLBACK",e$.IP_BANNED="IP_BANNED",e$.CHANNEL_BANNED="CHANNEL_BANNED",e$.LICENSE_MISSING="LICENSE_MISSING",e$.LICENSE_EXPIRED="LICENSE_EXPIRED",e$.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e$.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e$.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e$.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e$.TOKEN_EXPIRE="TOKEN_EXPIRE",e$}({});function Yu(e$){if(!Array.isArray(e$)||e$.length<1)return!1;try{e$.forEach(t$=>{if(!t$.urls)throw Error()})}catch{return!1}return!0}function vO(e$){return Pe(e$.turnServerURL,"turnServerURL"),Pe(e$.username,"username"),Pe(e$.password,"password"),e$.udpport&&Nt(e$.udpport,"udpport",1,99999,!0),e$.forceturn&&Nr(e$.forceturn,"forceturn"),e$.security&&Nr(e$.security,"security"),e$.tcpport&&Nt(e$.tcpport,"tcpport",1,99999,!0),!0}function fR(e$){return e$.level!==void 0&&Ce(e$.level,"level",[1,2,3]),e$.delay!==void 0&&Nt(e$.delay,"delay",0,3e3,!0),!0}var ut=function(e$){return e$.CONNECTION_STATE_CHANGE="connection-state-change",e$.MEDIA_RECONNECT_START="media-reconnect-start",e$.MEDIA_RECONNECT_END="media-reconnect-end",e$.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e$.USER_JOINED="user-joined",e$.USER_LEAVED="user-left",e$.USER_PUBLISHED="user-published",e$.USER_UNPUBLISHED="user-unpublished",e$.USER_INFO_UPDATED="user-info-updated",e$.CLIENT_BANNED="client-banned",e$.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e$.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e$.VOLUME_INDICATOR="volume-indicator",e$.CRYPT_ERROR="crypt-error",e$.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e$.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e$.NETWORK_QUALITY="network-quality",e$.STREAM_TYPE_CHANGED="stream-type-changed",e$.STREAM_FALLBACK="stream-fallback",e$.RECEIVE_METADATA="receive-metadata",e$.STREAM_MESSAGE="stream-message",e$.LIVE_STREAMING_ERROR="live-streaming-error",e$.LIVE_STREAMING_WARNING="live-streaming-warning",e$.EXCEPTION="exception",e$.ERROR="error",e$.P2P_LOST="p2p_lost",e$.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e$.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e$.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e$.PUBLISHED_USER_LIST="published-user-list",e$.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e$.CONTENT_INSPECT_ERROR="content-inspect-error",e$.CONTENT_INSPECT_RESULT="content-inspect-result",e$.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e$}({}),Be=function(e$){return e$.NETWORK_ERROR="NETWORK_ERROR",e$.SERVER_ERROR="SERVER_ERROR",e$.MULTI_IP="MULTI_IP",e$.TIMEOUT="TIMEOUT",e$.OFFLINE="OFFLINE",e$.LEAVE="LEAVE",e$.P2P_FAILED="P2P_FAILED",e$.FALLBACK="FALLBACK",e$}({}),wn=function(e$){return e$.ONLINE="ONLINE",e$.OFFLINE="OFFLINE",e$}({}),ks=function(e$){return e$.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e$.ONLINE="ONLINE",e$.OFFLINE="OFFLINE",e$}({});function Ge(e$,t$){for(var r$=arguments.length,n$=new Array(r$>2?r$-2:0),i$=2;i$<r$;i$++)n$[i$-2]=arguments[i$];return e$.getListeners(t$).length===0?j.reject(new N(R.UNEXPECTED_ERROR,"can not emit promise")):new j((o$,s$)=>{e$.emit(t$,...n$,o$,s$)})}function kt(e$,t$){if(e$.getListeners(t$).length===0)return j.resolve();for(var r$=arguments.length,n$=new Array(r$>2?r$-2:0),i$=2;i$<r$;i$++)n$[i$-2]=arguments[i$];return Ge(e$,t$,...n$)}function ni(e$,t$){if(e$.getListeners(t$).length===0)return null;for(var r$=arguments.length,n$=new Array(r$>2?r$-2:0),i$=2;i$<r$;i$++)n$[i$-2]=arguments[i$];return Ac(e$,t$,...n$)}function Ac(e$,t$){let r$=null,n$=null;for(var i$=arguments.length,o$=new Array(i$>2?i$-2:0),s$=2;s$<i$;s$++)o$[s$-2]=arguments[s$];if(e$.emit(t$,...o$,a$=>{r$=a$},a$=>{n$=a$}),n$!==null)throw n$;if(r$===null)throw new N(R.UNEXPECTED_ERROR,"handler is not sync");return r$}var he=new class extends Xt{set networkState(e$){this.emit(ks.NETWORK_STATE_CHANGE,e$,this._networkState),e$===wn.ONLINE?this.emit(ks.ONLINE):e$===wn.OFFLINE&&(this.onlineWaiter=new j(t$=>{this.once(ks.ONLINE,()=>{this.onlineWaiter=void 0,t$(wn.ONLINE)})}),this.emit(ks.OFFLINE)),this._networkState=e$}get networkState(){return this._networkState}get isOnline(){return this._networkState===wn.ONLINE}constructor(){super(),jt(this,"_moduleName","network-indicator"),jt(this,"_networkState",wn.ONLINE),jt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=wn.ONLINE}),window.addEventListener("offline",()=>{this.networkState=wn.OFFLINE})}};function Wl(e$,t$){let r$=e$.indexOf(t$);r$!==-1&&e$.splice(r$,1)}function Ls(e$){let t$=[];return e$.forEach(r$=>{t$.indexOf(r$)===-1&&t$.push(r$)}),t$}function qu(e$){j!==void 0?j.resolve().then(e$):setTimeout(e$,0)}function le(e$){return JSON.parse(JSON.stringify(e$))}function Vo(e$){try{return le(e$)}catch{return e$}}var gR={};function po(e$,t$){gR[t$]||(gR[t$]=!0,e$())}function Fo(e$){let t$=window.atob(e$),r$=new Uint8Array(new ArrayBuffer(t$.length));for(let n$=0;n$<t$.length;n$+=1)r$[n$]=t$.charCodeAt(n$);return r$}function so(e$){let t$="";for(let r$=0;r$<e$.length;r$+=1)t$+=String.fromCharCode(e$[r$]);return window.btoa(t$)}function yO(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,r$=new TextEncoder().encode(e$);if(r$.length>t$)r$=r$.slice(0,t$);else if(r$.length<t$){let n$=new Uint8Array(t$);n$.set(r$),r$=n$}return r$}function TR(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];let n$=ji(t$).call(t$,(s$,a$)=>s$+a$.length,0),i$=new Uint8Array(new ArrayBuffer(n$)),o$=0;return t$.forEach(s$=>{i$.set(s$,o$),o$+=s$.length}),i$}function ar(e$){return window.TextEncoder?new TextEncoder().encode(e$).length:e$.length}function AO(e$){let t$=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e$.realFormData&&(e$=e$.realFormData),e$.forEach(r$=>{t$+=typeof r$=="string"?ar(r$):r$.size}),t$+138}function mB(e$){let t$=new N(R.TIMEOUT,"timeout");return new j((r$,n$)=>{window.setTimeout(()=>n$(t$),e$)})}function Me(e$){return new j(t$=>{window.setTimeout(t$,e$)})}function Ut(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t$=arguments.length>1?arguments[1]:void 0,r$=Math.random().toString(16).substr(2,e$).toLowerCase();return r$.length===e$?"".concat(t$).concat(r$):"".concat(t$).concat(r$)+Ut(e$-r$.length,"")}function Ms(){return Ut(32,"").toUpperCase()}var zu=()=>{},SR=new class{constructor(){jt(this,"fnMap",new Map)}throttleByKey(e$,t$,r$,n$){for(var i$=arguments.length,o$=new Array(i$>4?i$-4:0),s$=4;s$<i$;s$++)o$[s$-4]=arguments[s$];if(this.fnMap.has(t$)){let a$=this.fnMap.get(t$);if(a$.threshold!==r$){a$.fn(...a$.args),clearTimeout(a$.timer);let c$=window.setTimeout(()=>{let u$=this.fnMap.get(t$);u$&&u$.fn(...u$.args),this.fnMap.delete(t$)},r$);this.fnMap.set(t$,{fn:e$,threshold:r$,timer:c$,args:o$,skipFn:n$})}else a$.skipFn&&a$.skipFn(...a$.args),this.fnMap.set(t$,J(J({},a$),{},{fn:e$,args:o$,skipFn:n$}))}else{let a$=window.setTimeout(()=>{let c$=this.fnMap.get(t$);c$&&c$.fn(...c$.args),this.fnMap.delete(t$)},r$);this.fnMap.set(t$,{fn:e$,threshold:r$,timer:a$,args:o$,skipFn:n$})}}},RR=SR.throttleByKey.bind(SR);function CR(e$){return typeof e$=="object"&&e$!==null&&!(e$ instanceof RegExp)}function kE(e$,t$){if(!CR(e$)||!CR(t$)||Array.isArray(e$)&&!Array.isArray(t$)||!Array.isArray(e$)&&Array.isArray(t$))return t$;if(Array.isArray(t$)&&Array.isArray(e$)){let r$=[...e$];for(let n$=0;n$<t$.length;n$++)r$[n$]=kE(e$[n$],t$[n$]);return r$}{let r$=J({},e$);for(let n$ in t$)Object.prototype.hasOwnProperty.call(t$,n$)&&(Object.prototype.hasOwnProperty.call(e$,n$)?r$[n$]=kE(e$[n$],t$[n$]):r$[n$]=t$[n$]);return r$}}function IR(e$,t$){let r$=[0];if(r$=new Array(t$).fill(0),e$===0)return r$;let n$=0;for(;e$>0&&(r$[n$]=255&e$,e$>>=8,n$++,n$!==t$););return r$}function wp(e$){return typeof e$=="number"?e$:e$.exact||e$.ideal||e$.max||e$.min||0}function bO(e$){let t$="0123456789abcdef";function r$(y$){let S$,b$="";for(S$=0;S$<=3;S$++)b$+=t$.charAt(y$>>8*S$+4&15)+t$.charAt(y$>>8*S$&15);return b$}function n$(y$,S$){let b$=(65535&y$)+(65535&S$);return(y$>>16)+(S$>>16)+(b$>>16)<<16|65535&b$}function i$(y$,S$,b$,$$,C$,N$){return n$(function(k$,O$){return k$<<O$|k$>>>32-O$}(n$(n$(S$,y$),n$($$,N$)),C$),b$)}function o$(y$,S$,b$,$$,C$,N$,k$){return i$(S$&b$|~S$&$$,y$,S$,C$,N$,k$)}function s$(y$,S$,b$,$$,C$,N$,k$){return i$(S$&$$|b$&~$$,y$,S$,C$,N$,k$)}function a$(y$,S$,b$,$$,C$,N$,k$){return i$(S$^b$^$$,y$,S$,C$,N$,k$)}function c$(y$,S$,b$,$$,C$,N$,k$){return i$(b$^(S$|~$$),y$,S$,C$,N$,k$)}let u$=function(y$){let S$,b$=1+(y$.length+8>>6),$$=new Array(16*b$);for(S$=0;S$<16*b$;S$++)$$[S$]=0;for(S$=0;S$<y$.length;S$++)$$[S$>>2]|=y$.charCodeAt(S$)<<S$%4*8;return $$[S$>>2]|=128<<S$%4*8,$$[16*b$-2]=8*y$.length,$$}(e$),l$,d$,h$,p$,_$,f$=1732584193,m$=-271733879,g$=-1732584194,v$=271733878;for(l$=0;l$<u$.length;l$+=16)d$=f$,h$=m$,p$=g$,_$=v$,f$=o$(f$,m$,g$,v$,u$[l$+0],7,-680876936),v$=o$(v$,f$,m$,g$,u$[l$+1],12,-389564586),g$=o$(g$,v$,f$,m$,u$[l$+2],17,606105819),m$=o$(m$,g$,v$,f$,u$[l$+3],22,-1044525330),f$=o$(f$,m$,g$,v$,u$[l$+4],7,-176418897),v$=o$(v$,f$,m$,g$,u$[l$+5],12,1200080426),g$=o$(g$,v$,f$,m$,u$[l$+6],17,-1473231341),m$=o$(m$,g$,v$,f$,u$[l$+7],22,-45705983),f$=o$(f$,m$,g$,v$,u$[l$+8],7,1770035416),v$=o$(v$,f$,m$,g$,u$[l$+9],12,-1958414417),g$=o$(g$,v$,f$,m$,u$[l$+10],17,-42063),m$=o$(m$,g$,v$,f$,u$[l$+11],22,-1990404162),f$=o$(f$,m$,g$,v$,u$[l$+12],7,1804603682),v$=o$(v$,f$,m$,g$,u$[l$+13],12,-40341101),g$=o$(g$,v$,f$,m$,u$[l$+14],17,-1502002290),m$=o$(m$,g$,v$,f$,u$[l$+15],22,1236535329),f$=s$(f$,m$,g$,v$,u$[l$+1],5,-165796510),v$=s$(v$,f$,m$,g$,u$[l$+6],9,-1069501632),g$=s$(g$,v$,f$,m$,u$[l$+11],14,643717713),m$=s$(m$,g$,v$,f$,u$[l$+0],20,-373897302),f$=s$(f$,m$,g$,v$,u$[l$+5],5,-701558691),v$=s$(v$,f$,m$,g$,u$[l$+10],9,38016083),g$=s$(g$,v$,f$,m$,u$[l$+15],14,-660478335),m$=s$(m$,g$,v$,f$,u$[l$+4],20,-405537848),f$=s$(f$,m$,g$,v$,u$[l$+9],5,568446438),v$=s$(v$,f$,m$,g$,u$[l$+14],9,-1019803690),g$=s$(g$,v$,f$,m$,u$[l$+3],14,-187363961),m$=s$(m$,g$,v$,f$,u$[l$+8],20,1163531501),f$=s$(f$,m$,g$,v$,u$[l$+13],5,-1444681467),v$=s$(v$,f$,m$,g$,u$[l$+2],9,-51403784),g$=s$(g$,v$,f$,m$,u$[l$+7],14,1735328473),m$=s$(m$,g$,v$,f$,u$[l$+12],20,-1926607734),f$=a$(f$,m$,g$,v$,u$[l$+5],4,-378558),v$=a$(v$,f$,m$,g$,u$[l$+8],11,-2022574463),g$=a$(g$,v$,f$,m$,u$[l$+11],16,1839030562),m$=a$(m$,g$,v$,f$,u$[l$+14],23,-35309556),f$=a$(f$,m$,g$,v$,u$[l$+1],4,-1530992060),v$=a$(v$,f$,m$,g$,u$[l$+4],11,1272893353),g$=a$(g$,v$,f$,m$,u$[l$+7],16,-155497632),m$=a$(m$,g$,v$,f$,u$[l$+10],23,-1094730640),f$=a$(f$,m$,g$,v$,u$[l$+13],4,681279174),v$=a$(v$,f$,m$,g$,u$[l$+0],11,-358537222),g$=a$(g$,v$,f$,m$,u$[l$+3],16,-722521979),m$=a$(m$,g$,v$,f$,u$[l$+6],23,76029189),f$=a$(f$,m$,g$,v$,u$[l$+9],4,-640364487),v$=a$(v$,f$,m$,g$,u$[l$+12],11,-421815835),g$=a$(g$,v$,f$,m$,u$[l$+15],16,530742520),m$=a$(m$,g$,v$,f$,u$[l$+2],23,-995338651),f$=c$(f$,m$,g$,v$,u$[l$+0],6,-198630844),v$=c$(v$,f$,m$,g$,u$[l$+7],10,1126891415),g$=c$(g$,v$,f$,m$,u$[l$+14],15,-1416354905),m$=c$(m$,g$,v$,f$,u$[l$+5],21,-57434055),f$=c$(f$,m$,g$,v$,u$[l$+12],6,1700485571),v$=c$(v$,f$,m$,g$,u$[l$+3],10,-1894986606),g$=c$(g$,v$,f$,m$,u$[l$+10],15,-1051523),m$=c$(m$,g$,v$,f$,u$[l$+1],21,-2054922799),f$=c$(f$,m$,g$,v$,u$[l$+8],6,1873313359),v$=c$(v$,f$,m$,g$,u$[l$+15],10,-30611744),g$=c$(g$,v$,f$,m$,u$[l$+6],15,-1560198380),m$=c$(m$,g$,v$,f$,u$[l$+13],21,1309151649),f$=c$(f$,m$,g$,v$,u$[l$+4],6,-145523070),v$=c$(v$,f$,m$,g$,u$[l$+11],10,-1120210379),g$=c$(g$,v$,f$,m$,u$[l$+2],15,718787259),m$=c$(m$,g$,v$,f$,u$[l$+9],21,-343485551),f$=n$(f$,d$),m$=n$(m$,h$),g$=n$(g$,p$),v$=n$(v$,_$);return r$(f$)+r$(m$)+r$(g$)+r$(v$)}var fB=1,Od=console,ze=class{static setLogger(e$){Od=e$}constructor(e$){jt(this,"lockingPromise",j.resolve()),jt(this,"locks",0),jt(this,"name",""),jt(this,"lockId",void 0),this.lockId=fB++,e$&&(this.name=e$),Od.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e$){let t$;this.locks+=1,Od.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof e$=="string"?e$:""));let r$=new j(i$=>{t$=()=>{this.locks-=1,Od.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof e$=="string"?e$:"")),i$()}}),n$=this.lockingPromise.then(()=>t$);return this.lockingPromise=this.lockingPromise.then(()=>r$),n$}};function $s(e$,t$){return function(r$,n$,i$){let o$=i$.value;if(typeof o$!="function")throw new Error("Cannot use mutex on object property.");return i$.value=async function(){let s$=this[t$];if(!s$)throw new Error("mutex property key ".concat(t$," doesn't exist on ").concat(e$));let a$=await s$.lock("From ".concat(e$,".").concat(n$));try{for(var c$=arguments.length,u$=new Array(c$),l$=0;l$<c$;l$++)u$[l$]=arguments[l$];return await o$.apply(this,u$)}finally{a$()}},i$}}var Ee={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function hf(e$,t$){let r$=Math.floor(t$.timeout*Math.pow(t$.timeoutFactor,e$));return Math.min(t$.maxRetryTimeout,r$)}function Wi(e$,t$,r$,n$){let i$=Object.assign({},Ee,n$),o$=i$.timeout,s$=async()=>{await function(u$){return new j(l$=>{window.setTimeout(l$,u$)})}(o$),o$*=i$.timeoutFactor,o$=Math.min(i$.maxRetryTimeout,o$)},a$=!1,c$=new j(async(u$,l$)=>{t$=t$||(()=>!1),r$=r$||(()=>!0);for(let d$=0;d$<i$.maxRetryCount;d$+=1){if(a$)return l$(new N(R.OPERATION_ABORTED));try{let h$=await e$();if(!t$(h$,d$)||d$+1===i$.maxRetryCount)return u$(h$);await s$()}catch(h$){if(!r$(h$,d$)||d$+1===i$.maxRetryCount)return l$(h$);await s$()}}});return c$.cancel=()=>a$=!0,c$}var Hl=class{constructor(e$){jt(this,"input",[]),jt(this,"size",void 0),this.size=e$}add(e$){this.input.push(e$),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e$;return this.input.length===0?0:ji(e$=this.input).call(e$,(t$,r$)=>t$+r$)/this.input.length}},Nd,Dd=0,Op=0;function LE(e$,t$,r$,n$){return new j((i$,o$)=>{t$.responseType=t$.responseType||"json",t$.data&&!r$?(t$.data=JSON.stringify(t$.data),Dd+=ar(t$.data)):r$&&(t$.data.size?Dd+=t$.data.size:t$.data instanceof FormData?Dd+=AO(t$.data):Dd+=ar(JSON.stringify(t$.data))),t$.headers=t$.headers||{},t$.headers["Content-Type"]=t$.headers["Content-Type"]||"application/json",t$.method="POST",t$.url=e$,mn.request(t$).then(s$=>{typeof s$.data=="string"?Op+=ar(s$.data):s$.data instanceof ArrayBuffer||s$.data instanceof Uint8Array?Op+=s$.data.byteLength:Op+=ar(JSON.stringify(s$.data)),i$(s$.data)}).catch(s$=>{mn.isCancel(s$)?o$(new N(R.OPERATION_ABORTED,"cancel token canceled")):s$.code==="ECONNABORTED"?o$(new N(R.NETWORK_TIMEOUT,s$.message)):s$.response?o$(new N(R.NETWORK_RESPONSE_ERROR,s$.response.status)):o$(new N(R.NETWORK_ERROR,s$.message))})})}async function gB(e$,t$){let r$=new Blob([t$.data],{type:"buffer"});return await LE(e$,J(J({},t$),{},{data:r$,headers:{"Content-Type":"application/octet-stream"}}),!0)}var vR=()=>window.isSecureContext!==void 0,ii=function(e$){if(e$.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e$;let t$=e$.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t$&&t$[1]&&t$[2]){let n$=t$[1],i$=t$[2];return"".concat(n$,".").concat(i$)}let r$=e$.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(r$&&r$[1]&&r$[2]){let n$=r$[1],i$=r$[2];return"".concat(n$,".").concat(100*(Number(i$)+1))}return"4.0.0.999"}("4.22.0"),pf=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),Oo=function(e$){return e$.Default="default",e$.Auto="auto",e$.Relay="relay",e$.SdRtn="sd-rtn",e$}({}),_f={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},Ef="v4.22.0-0-g8569241d-dirty(8/15/2024, 7:04:06 PM)",oe=J(J({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:_f,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1});function Ot(e$,t$,r$){var n$,i$,o$;W(n$=Object.keys(oe)).call(n$,e$)&&(!r$&&W(i$=Object.keys($r)).call(i$,e$)||(oe[e$]=t$,e$==="ENABLE_VIDEO_SEI"&&t$===!0&&(oe.ENABLE_ENCODED_TRANSFORM=!0),e$==="USE_NEW_NETWORK_CONFIG"&&t$&&(o$=!!t$,oe.USE_NEW_NETWORK_CONFIG=o$,o$&&(oe.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],oe.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],oe.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],oe.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],oe.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",oe.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",oe.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e$==="ENABLE_PRE_SUB"&&t$&&(oe.ENABLE_INSTANT_VIDEO=!0,oe.ENABLE_PREALLOC_PC=!0),e$==="ENABLE_SVC"&&t$&&(oe.ENABLE_AUT_CC=!0)))}function v(e$){return oe[e$]}var $r={},ct=function(e$){return e$.SET_SESSION_ID="SET_SESSION_ID",e$.SET_P2P_ID="SET_P2P_id",e$.SET_DC_ID="SET_DC_id",e$.SET_UID="SET_UID",e$.SET_INT_UID="SET_INT_UID",e$.SET_PUB_ID="SET_PUB_ID",e$.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e$.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e$.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e$.AVOID_JOIN_START="AVOID_JOIN_START",e$.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e$.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e$.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e$.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e$.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e$.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e$.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e$.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e$.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e$.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e$.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e$.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e$.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e$.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e$.RESET_KEY_METRICS="RESET_KEY_METRICS",e$.SET_USE_P2P="SET_USE_P2P",e$.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e$}(ct||{}),ME=class{constructor(e$,t$,r$,n$){jt(this,"state",void 0),this.state={codec:e$,audioCodec:t$,mode:r$,clientId:n$,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Oo.Default}}dispatch(e$){this.state=function(t$,r$){switch(r$.type){case ct.SET_SESSION_ID:return J(J({},t$),{},{sessionId:r$.sessionId});case ct.SET_P2P_ID:return J(J({},t$),{},{p2pId:r$.p2pId});case ct.SET_UID:return J(J({},t$),{},{uid:r$.uid});case ct.SET_INT_UID:return J(J({},t$),{},{intUid:r$.intUid});case ct.SET_PUB_ID:return J(J({},t$),{},{pubId:r$.pubId});case ct.KEY_METRIC_CLIENT_CREATED:return J(J({},t$),{},{keyMetrics:J(J({},t$.keyMetrics),{},{clientCreated:r$.metric})});case ct.KEY_METRIC_JOIN_START:return J(J({},t$),{},{keyMetrics:J(J({},t$.keyMetrics),{},{joinStart:r$.metric})});case ct.AVOID_JOIN_START:return J(J({},t$),{},{avoidJoinStart:r$.avoidJoinStart});case ct.KEY_METRIC_JOIN_END:return J(J({},t$),{},{keyMetrics:J(J({},t$.keyMetrics),{},{joinEnd:r$.metric})});case ct.KEY_METRIC_REQUEST_AP_START:return J(J({},t$),{},{keyMetrics:J(J({},t$.keyMetrics),{},{requestAPStart:r$.metric})});case ct.KEY_METRIC_REQUEST_AP_END:return J(J({},t$),{},{keyMetrics:J(J({},t$.keyMetrics),{},{requestAPEnd:r$.metric})});case ct.KEY_METRIC_JOIN_GATEWAY_START:return J(J({},t$),{},{keyMetrics:J(J({},t$.keyMetrics),{},{joinGatewayStart:r$.metric})});case ct.KEY_METRIC_JOIN_GATEWAY_END:return J(J({},t$),{},{keyMetrics:J(J({},t$.keyMetrics),{},{joinGatewayEnd:r$.metric})});case ct.KEY_METRIC_PEER_CONNECTION_START:return J(J({},t$),{},{keyMetrics:J(J({},t$.keyMetrics),{},{peerConnectionStart:r$.metric})});case ct.KEY_METRIC_PEER_CONNECTION_END:return J(J({},t$),{},{keyMetrics:J(J({},t$.keyMetrics),{},{peerConnectionEnd:r$.metric})});case ct.KEY_METRIC_DESCRIPTION_START:return J(J({},t$),{},{keyMetrics:J(J({},t$.keyMetrics),{},{descriptionStart:r$.metric})});case ct.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return J(J({},t$),{},{keyMetrics:J(J({},t$.keyMetrics),{},{signalChannelOpen:r$.metric})});case ct.KEY_METRIC_ICE_CONNECTION_END:return J(J({},t$),{},{keyMetrics:J(J({},t$.keyMetrics),{},{iceConnectionEnd:r$.metric})});case ct.KEY_METRIC_PUBLISH:{let n$=t$.keyMetrics.publish,i$=n$.findIndex(o$=>o$.trackId===r$.metric.trackId);return i$!==-1?(n$[i$]=J(J({},n$[i$]),r$.metric),J(J({},t$),{},{keyMetrics:J(J({},t$.keyMetrics),{},{publish:[...n$]})})):J(J({},t$),{},{keyMetrics:J(J({},t$.keyMetrics),{},{publish:[...t$.keyMetrics.publish,r$.metric]})})}case ct.KEY_METRIC_SUBSCRIBE:{let n$=t$.keyMetrics.subscribe,i$=n$.findIndex(o$=>o$.userId===r$.metric.userId&&o$.type===r$.metric.type);return i$!==-1?(n$[i$]=J(J({},n$[i$]),r$.metric),J(J({},t$),{},{keyMetrics:J(J({},t$.keyMetrics),{},{subscribe:[...n$]})})):J(J({},t$),{},{keyMetrics:J(J({},t$.keyMetrics),{},{subscribe:[...t$.keyMetrics.subscribe,r$.metric]})})}case ct.SET_CLOUD_PROXY_SERVER_MODE:return t$.cloudProxyServerMode=r$.mode,t$;case ct.RECORD_JOIN_CHANNEL_SERVICE:return typeof r$.index!="number"?t$.joinChannelServiceRecords=[...t$.joinChannelServiceRecords,r$.record]:(t$.joinChannelServiceRecords[r$.index]=J(J({},t$.joinChannelServiceRecords[r$.index]),r$.record),t$.joinChannelServiceRecords=[...t$.joinChannelServiceRecords]),t$;case ct.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return t$.joinChannelServiceRecords=[],t$;case ct.RESET_KEY_METRICS:return t$.keyMetrics={publish:[],subscribe:[]},t$;case ct.SET_USE_P2P:return J(J({},t$),{},{useP2P:r$.val});case ct.SET_TRANSPORT_TYPE:return J(J({},t$),{},{p2pTransport:r$.val});default:return t$}}(this.state,e$)}set sessionId(e$){this.dispatch({type:ct.SET_SESSION_ID,sessionId:e$})}get sessionId(){return this.state.sessionId}set codec(e$){this.state.codec=e$}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e$){this.dispatch({type:ct.SET_P2P_ID,p2pId:e$})}get p2pId(){return this.state.p2pId}set dcId(e$){this.dispatch({type:ct.SET_DC_ID,dcId:e$})}get dcId(){return this.state.dcId}set uid(e$){this.dispatch({type:ct.SET_UID,uid:e$})}get uid(){return this.state.uid}set intUid(e$){this.dispatch({type:ct.SET_INT_UID,intUid:e$})}get intUid(){return this.state.intUid}set pubId(e$){this.dispatch({type:ct.SET_PUB_ID,pubId:e$})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e$){this.dispatch({type:ct.SET_CLOUD_PROXY_SERVER_MODE,mode:e$})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e$){this.dispatch({type:ct.SET_USE_P2P,val:e$})}get useP2P(){return this.state.useP2P}set p2pTransport(e$){this.dispatch({type:ct.SET_TRANSPORT_TYPE,val:e$})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:ct.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ct.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:ct.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ct.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ct.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ct.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ct.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ct.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ct.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:ct.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ct.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ct.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e$,t$,r$,n$){this.dispatch({type:ct.KEY_METRIC_PUBLISH,metric:J(J({trackId:e$,type:t$},r$&&{publishStart:r$}),n$&&{publishEnd:n$})})}subscribe(e$,t$,r$,n$,i$,o$,s$){this.dispatch({type:ct.KEY_METRIC_SUBSCRIBE,metric:J(J(J(J(J({userId:e$,type:t$},r$&&{subscribeStart:r$}),n$&&{subscribeEnd:n$}),i$&&{firstFrame:i$}),o$&&{streamAdded:o$}),s$&&{firstDecoded:s$})})}massSubscribe(e$,t$,r$,n$){e$.forEach(i$=>{this.dispatch({type:ct.KEY_METRIC_SUBSCRIBE,metric:J(J(J({userId:i$.userId,type:i$.type},t$&&{subscribeStart:t$}),r$&&{subscribeEnd:r$}),n$&&{firstFrame:n$})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e$,t$){e$.service==="gateway"&&Array.isArray(e$.urls)&&(e$.urls=e$.urls.map(r$=>r$.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof t$!="number"?(this.dispatch({type:ct.RECORD_JOIN_CHANNEL_SERVICE,record:J(J({},e$),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t$<0||t$>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ct.RECORD_JOIN_CHANNEL_SERVICE,record:e$,index:t$}),t$)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ct.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ct.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e$){this.dispatch({type:ct.AVOID_JOIN_START,avoidJoinStart:e$})}},Ju=function(e$){return e$.h264="h264",e$.h265="h265",e$.vp8="vp8",e$.vp9="vp9",e$.av1="av1",e$}({});(function(e$){e$.opus="opus",e$.pcma="pcma",e$.pcmu="pcmu",e$.g722="g722"})({});var yR=128,TB=96,AR=1e3,us=10,SB=0;function re(e$,t$,r$){return(t$=function(n$){var i$=function(o$,s$){if(typeof o$!="object"||!o$)return o$;var a$=o$[Symbol.toPrimitive];if(a$!==void 0){var c$=a$.call(o$,"string");if(typeof c$!="object")return c$;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o$)}(n$);return typeof i$=="symbol"?i$:i$+""}(t$))in e$?Object.defineProperty(e$,t$,{value:r$,enumerable:!0,configurable:!0,writable:!0}):e$[t$]=r$,e$}function bR(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function ot(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?bR(Object(r$),!0).forEach(function(n$){re(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):bR(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var wO=new class extends Xt{constructor(){super(...arguments),re(this,"currentUploadLogID",0)}reportLogUploadError(e$){let{errorRange:t$}=e$;t$[t$.length-1]&&t$[t$.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t$[t$.length-1],this.emit("REPORT_LOG_UPLOAD",e$))}},UE=class{constructor(e$){re(this,"logger",void 0),re(this,"prefixLists",[]),this.logger=e$}debug(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];this.logger.debug(...this.prefixLists,...t$)}info(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];this.logger.info(...this.prefixLists,...t$)}warning(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];this.logger.warning(...this.prefixLists,...t$)}error(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];this.logger.error(...this.prefixLists,...t$)}prefix(e$){return this.prefixLists.push(e$),this}popPrefix(){return this.prefixLists.pop(),this}};function Np(){let e$=new Date;return e$.toTimeString().split(" ")[0]+":"+e$.getMilliseconds()}function wR(){let e$=new Date,t$=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t$?(t$==null?void 0:t$[0])+":"+e$.getUTCMilliseconds():e$.toTimeString().split(" ")[0]+":"+e$.getMilliseconds()}var Qn={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Pd=Date.now(),ka=e$=>{for(let t$ in Qn)if(Object.prototype.hasOwnProperty.call(Qn,t$)&&Qn[t$]===e$)return t$;return"DEFAULT"},_=new class{constructor(){re(this,"proxyServerURL",void 0),re(this,"logLevel",Qn.DEBUG),re(this,"uploadState","collecting"),re(this,"uploadLogWaitingList",[]),re(this,"uploadLogUploadingList",[]),re(this,"uploadErrorCount",0),re(this,"currentLogID",0),re(this,"url",void 0),re(this,"extLog",(e$,t$)=>{this.appendLogToWaitingList(e$,...t$)})}debug(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];let n$=[Qn.DEBUG].concat(t$);this.log.apply(this,n$)}info(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];let n$=[Qn.INFO].concat(t$);this.log.apply(this,n$)}warning(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];let n$=[Qn.WARNING].concat(t$);this.log.apply(this,n$)}warn(){this.warning(...arguments)}error(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];let n$=[Qn.ERROR].concat(t$);this.log.apply(this,n$)}upload(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];let n$=[Qn.DEBUG].concat(t$);this.uploadLog.apply(this,n$)}setLogLevel(e$){e$=Math.min(Math.max(0,e$),4),this.logLevel=e$}enableLogUpload(){Ot("UPLOAD_LOG",!0)}disableLogUpload(){Ot("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e$){this.proxyServerURL=e$}prefix(e$){return new UE(this).prefix(e$)}log(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];if(Date.now()-Pd<100)return void setTimeout(()=>{this.log(...t$)},Date.now()-Pd);let n$=Math.max(0,Math.min(4,t$[0]));if(t$[0]=Np()+" Agora-SDK [".concat(ka(n$),"]:"),this.appendLogToWaitingList(n$,...t$),n$<this.logLevel)return;let i$=Np()+" %cAgora-SDK [".concat(ka(n$),"]:"),o$=[];if(!v("USE_NEW_LOG"))switch(n$){case Qn.DEBUG:o$=[i$,"color: #64B5F6;"].concat(t$.slice(1)),console.log.apply(console,o$);break;case Qn.INFO:o$=[i$,"color: #1E88E5; font-weight: bold;"].concat(t$.slice(1)),console.log.apply(console,o$);break;case Qn.WARNING:o$=[i$,"color: #FB8C00; font-weight: bold;"].concat(t$.slice(1)),console.warn.apply(console,o$);break;case Qn.ERROR:o$=[i$,"color: #B00020; font-weight: bold;"].concat(t$.slice(1)),console.error.apply(console,o$)}}uploadLog(){for(var e$=arguments.length,t$=new Array(e$),r$=0;r$<e$;r$++)t$[r$]=arguments[r$];if(Date.now()-Pd<100)return void setTimeout(()=>{this.uploadLog(...t$)},Date.now()-Pd);let n$=Math.max(0,Math.min(4,t$[0]));t$[0]=Np()+" Agora-SDK [".concat(ka(n$),"]:"),this.appendLogToWaitingList(n$,...t$)}appendLogToWaitingList(e$){if(!v("UPLOAD_LOG"))return;for(var t$=arguments.length,r$=new Array(t$>1?t$-1:0),n$=1;n$<t$;n$++)r$[n$-1]=arguments[n$];Array.isArray(r$[0])?r$[0][0]=wR()+" Agora-SDK [".concat(ka(e$),"]:"):r$[0]=wR()+" Agora-SDK [".concat(ka(e$),"]:");let i$="";r$.forEach(o$=>{typeof o$=="object"&&(o$=JSON.stringify(o$)),i$+="".concat(o$," ")}),this.uploadLogWaitingList.push({payload_str:i$,log_level:e$,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let e$=this.uploadLogUploadingList,t$={sdk_version:ii,process_id:v("PROCESS_ID"),payload:JSON.stringify(e$)};return Wi(async()=>{let r$=await mn.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(v("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(v("LOG_UPLOAD_SERVER"),"/upload/v1")),t$,{responseType:"text"});if(r$.data!=="OK"){let n$=new Error("unexpected upload log response");throw n$.response=r$,n$}},()=>(this.uploadLogUploadingList=[],!1),r$=>{let n$={status:-1,message:r$.message,errorRange:e$.map(i$=>i$.log_item_id)};return r$.response?(n$.status=r$.response.status,n$.data=r$.response.data,n$.headers=r$.response.headers):r$.request&&(n$.status=r$.request.status),wO.reportLogUploadError(n$),!0},{timeout:v("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:v("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,v("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),v("UPLOAD_LOG_INTERVAL"))}).catch(e$=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),v("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),v("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}},OR;function RB(e$){return Pe(e$.reportId,"params.reportId",0,100,!1),Pe(e$.category,"params.category",0,100,!1),Pe(e$.event,"params.event",0,100,!1),Pe(e$.label,"params.label",0,100,!1),Nt(e$.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(OR={}).FREE="free",OR.UPLOADING="uploading",function(e$){e$[e$.MISC=0]="MISC",e$[e$.INTERNAL_EVENT=1]="INTERNAL_EVENT",e$[e$.PUBLIC_EVENT=2]="PUBLIC_EVENT",e$[e$.WEB_EVENT=3]="WEB_EVENT",e$[e$.INTERNAL_API=4]="INTERNAL_API",e$[e$.WEB_API=5]="WEB_API",e$[e$.PUBLIC_API=6]="PUBLIC_API"}({});var CB={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},De=function(e$){return e$.PUBLISH="publish",e$.SUBSCRIBE="subscribe",e$.WS_COMPRESSOR_INIT="ws_compressor_init",e$.SESSION_INIT="session_init",e$.JOIN_CHOOSE_SERVER="join_choose_server",e$.REQ_USER_ACCOUNT="req_user_account",e$.JOIN_GATEWAY="join_gateway",e$.REJOIN_GATEWAY="rejoin_gateway",e$.STREAM_SWITCH="stream_switch",e$.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e$.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e$.FIRST_VIDEO_RECEIVED="first_video_received",e$.FIRST_AUDIO_RECEIVED="first_audio_received",e$.FIRST_VIDEO_DECODE="first_video_decode",e$.FIRST_AUDIO_DECODE="first_audio_decode",e$.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e$.ON_ADD_VIDEO_STREAM="on_add_video_stream",e$.ON_UPDATE_STREAM="on_update_stream",e$.ON_REMOVE_STREAM="on_remove_stream",e$.USER_ANALYTICS="req_user_analytics",e$.PC_STATS="pc_stats",e$.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e$}({}),Jt=function(e$){return e$.SESSION="io.agora.pb.Wrtc.Session",e$.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e$.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e$.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e$.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e$.PUBLISH="io.agora.pb.Wrtc.Publish",e$.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e$.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e$.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e$.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e$.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e$.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e$.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e$.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e$.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e$.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e$.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e$.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e$.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e$.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e$.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e$.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e$.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e$.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e$.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e$.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e$.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e$.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e$.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e$.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e$.PC_STATS="io.agora.pb.Wrtc.PCStats",e$.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e$}({});(function(e$){e$[e$.WORKER_EVENT=156]="WORKER_EVENT",e$[e$.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});var IB=function(e$){return e$[e$.SESSION=26]="SESSION",e$[e$.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e$[e$.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e$[e$.JOIN_GATEWAY=28]="JOIN_GATEWAY",e$[e$.PUBLISH=30]="PUBLISH",e$[e$.SUBSCRIBE=29]="SUBSCRIBE",e$[e$.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e$[e$.STREAM_SWITCH=32]="STREAM_SWITCH",e$[e$.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e$[e$.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e$[e$.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e$[e$.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e$[e$.API_INVOKE=41]="API_INVOKE",e$[e$.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e$[e$.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e$[e$.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e$[e$.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e$[e$.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e$[e$.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e$[e$.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e$[e$.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e$[e$.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e$[e$.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e$[e$.WORKER_EVENT=156]="WORKER_EVENT",e$[e$.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e$[e$.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e$[e$.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e$[e$.USER_ANALYTICS=1e4]="USER_ANALYTICS",e$[e$.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e$}({}),bc=class I5{constructor(){re(this,"baseInfoMap",new Map),re(this,"proxyServer",void 0),re(this,"eventUploadTimer",void 0),re(this,"setSessionIdTimer",void 0),re(this,"url",void 0),re(this,"backupUrl",void 0),re(this,"_appId",void 0),re(this,"keyEventUploadPendingItems",[]),re(this,"normalEventUploadPendingItems",[]),re(this,"apiInvokeUploadPendingItems",[]),re(this,"apiInvokeCount",0),re(this,"ltsList",[]),re(this,"lastSendNormalEventTime",Date.now()),re(this,"customReportCounterTimer",void 0),re(this,"customReportCount",0),re(this,"extApiInvoke",async t$=>{for(let r$ of t$){let n$=ot(ot({},r$),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Zt.TRACER});this.sendApiInvoke(n$)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),v("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),v("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t$){return this.baseInfoMap.get(t$)}adjustSessionStartTime(t$){if(!this.baseInfoMap.has(t$)&&!this.baseInfoMap.get(t$))return void _.error("adjust session ".concat(t$," start time, sid is not exist or info is undefined"));let r$=this.baseInfoMap.get(t$),n$=Date.now(),i$=r$.startTime;r$.startTime=n$,_.debug("rewrite session ".concat(t$," startTime: ").concat(n$," , ").concat(n$-i$,"ms")),this.baseInfoMap.set(t$,r$)}setAppId(t$){this._appId=t$}reportApiInvoke(t$,r$,n$){r$.timeout=r$.timeout||6e4,r$.reportResult=r$.reportResult===void 0||r$.reportResult;let i$=Date.now();this.apiInvokeCount+=1;let o$=this.apiInvokeCount,s$=()=>({tag:r$.tag,invokeId:o$,sid:t$,name:r$.name,apiInvokeTime:i$,options:r$.options,states:r$.states||null}),a$=!!v("SHOW_REPORT_INVOKER_LOG");a$&&_.info("".concat(r$.name," start"),r$.options);let c$=!1;Me(r$.timeout).then(()=>{c$||(this.sendApiInvoke(ot(ot({},s$()),{},{error:R.API_INVOKE_TIMEOUT,success:!1})),_.debug("".concat(r$.name," timeout")))});let u$=new N(R.UNEXPECTED_ERROR,"".concat(r$.name,": this api invoke is end"));return{onSuccess:l$=>{let d$=()=>{if(c$)throw u$;return c$=!0,this.sendApiInvoke(ot(ot({},s$()),{},{success:!0},r$.reportResult&&{result:l$})),a$&&_.info("".concat(r$.name," onSuccess")),l$};return n$?RR(d$,r$.name+"Success",n$,()=>c$=!0):d$()},onError:l$=>{let d$=()=>{if(c$)throw l$;c$=!0,this.sendApiInvoke(ot(ot({},s$()),{},{success:!1,error:l$})),a$&&_.info("".concat(r$.name," onFailure"),l$.toString())};return n$?RR(d$,r$.name+"Error",n$,()=>c$=!0):d$()}}}sessionInit(t$,r$){if(this.baseInfoMap.has(t$))return;let n$=Date.now(),i$=this.createBaseInfo(t$,n$);i$.cname=r$.cname;let o$=Object.assign({},{willUploadConsoleLog:v("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:pf?"global":"oversea",areas:v("AREAS")&&v("AREAS").join(",")},r$.extend),{stringUid:s$,channelProfile:a$,channelMode:c$,isABTestSuccess:u$,lsid:l$,clientRole:d$}=r$,h$=Date.now(),p$=ot(ot({},i$),{},{eventType:De.SESSION_INIT,appid:r$.appid,browser:navigator.userAgent,buildFormat:r$.buildFormat,build:Ef,lts:h$,elapse:h$-n$,extend:JSON.stringify(o$),mode:r$.mode,process:v("PROCESS_ID"),appType:v("APP_TYPE"),success:!0,version:ii,stringUid:s$,channelProfile:a$,channelMode:c$,isABTestSuccess:u$,lsid:l$,clientType:W(_$=window.navigator.userAgent).call(_$,"AgoraWebView")?42:20,clientRole:d$,serviceId:v("PROCESS_ID"),extensionID:v("PLUGIN_INFO").join(",")||""});var _$;this.send({type:Jt.SESSION,data:p$},!0)}joinChooseServer(t$,r$){let n$=this.baseInfoMap.get(t$);if(!n$)return;let i$=n$.info,o$=Date.now(),s$=ot(ot({},i$),{},{eventType:De.JOIN_CHOOSE_SERVER,lts:o$,eventElapse:r$.elapse||o$-r$.lts,chooseServerAddr:r$.csAddr,errorCode:r$.ec,elapse:o$-n$.startTime,success:r$.succ,chooseServerAddrList:JSON.stringify(r$.serverList),uid:r$.uid?parseInt(r$.uid):null,cid:r$.cid?parseInt(r$.cid):null,chooseServerIp:r$.csIp||"",opid:r$.opid,unilbsServerIds:r$.unilbsServerIds,extend:r$.extend||void 0,isHttp3:r$.isHttp3});this.send({type:Jt.JOIN_CHOOSE_SERVER,data:s$},!0)}reqUserAccount(t$,r$){let n$=this.baseInfoMap.get(t$);if(!n$)return;let i$=n$.info,o$=Date.now(),s$=ot(ot({},i$),{},{eventType:De.REQ_USER_ACCOUNT,lts:o$,success:r$.success,serverAddress:r$.serverAddr,stringUid:r$.stringUid,uid:r$.uid,errorCode:r$.errorCode,elapse:r$.elapse||o$-n$.startTime,eventElapse:o$-r$.lts,extend:JSON.stringify(r$.extend)});this.send({type:Jt.REQ_USER_ACCOUNT,data:s$},!0)}joinGateway(t$,r$){let n$=this.baseInfoMap.get(t$);if(!n$)return;let i$=n$.info;r$.vid&&(i$.vid=r$.vid),i$.uid=r$.uid,i$.cid=r$.cid;let o$=Date.now(),{firstSuccess:s$,avoidJoinStartTime:a$}=r$,c$=o$-(s$&&a$?a$:n$.startTime),u$=ot(ot({},i$),{},{eventType:De.JOIN_GATEWAY,lts:o$,gatewayAddr:r$.addr,success:r$.succ,errorCode:r$.ec,errorMsg:r$.errorMsg||"",elapse:c$,eventElapse:o$-r$.lts,firstSuccess:s$,signalChannel:r$.signalChannel,preload:r$.preload?1:0});r$.succ&&(n$.lastJoinSuccessTime=o$),this.send({type:Jt.JOIN_GATEWAY,data:u$},!0)}joinChannelTimeout(t$,r$){let n$=this.baseInfoMap.get(t$);if(!n$)return;let i$=Date.now(),o$=ot(ot({},n$.info),{},{lts:i$,timeout:r$,elapse:i$-n$.startTime});this.send({type:Jt.JOIN_CHANNEL_TIMEOUT,data:o$},!0)}publish(t$,r$){let n$=this.baseInfoMap.get(t$);if(!n$)return;let i$=n$.info,o$=Date.now(),s$=ot(ot({},i$),{},{eventType:De.PUBLISH,lts:o$,eventElapse:r$.eventElapse,elapse:o$-n$.startTime,success:r$.succ,errorCode:r$.ec,videoName:r$.videoName,audioName:r$.audioName,screenName:r$.screenName,screenshare:r$.screenshare,audio:r$.audio,video:r$.video,p2pid:r$.p2pid,publishRequestid:r$.publishRequestid});this.send({type:Jt.PUBLISH,data:s$},!0)}subscribe(t$,r$,n$){let i$=this.baseInfoMap.get(t$);if(!i$)return;let o$=i$.info,s$=Date.now(),a$=ot(ot({},o$),{},{eventType:De.SUBSCRIBE,lts:s$,eventElapse:r$.eventElapse,elapse:s$-i$.startTime,success:r$.succ,errorCode:r$.ec,video:r$.video,audio:r$.audio,subscribeRequestid:r$.subscribeRequestid,p2pid:r$.p2pid,preSsrc:r$.preSsrc?1:0},n$&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r$.peerid=="string"?a$.peerSuid=r$.peerid:a$.peer=r$.peerid,this.send({type:Jt.SUBSCRIBE,data:a$},!0)}wsCompressorInit(t$){var r$;let n$=[...xn(r$=this.baseInfoMap).call(r$)],i$=n$.length?n$[0]:"UnableToGetSid",o$=this.baseInfoMap.get(i$);if(!o$)return;let s$=o$.info,a$=Date.now(),c$=ot(ot({},s$),{},{eventType:De.WS_COMPRESSOR_INIT,lts:a$,eventElapse:t$.eventElapse,elapse:a$-o$.startTime,status:t$.status?1:2});this.send({type:Jt.WS_COMPRESSOR_INIT,data:c$},!0)}firstRemoteVideoDecode(t$,r$,n$,i$){let o$=this.baseInfoMap.get(t$);if(!o$)return;let s$=o$.info,a$=Date.now(),c$=ot(ot(ot({},s$),i$),{},{elapse:a$-o$.startTime,eventType:r$,lts:a$,firstDecodeFrame:Math.max((i$.firstFrame||a$)-o$.startTime,0),apEnd:Math.max(i$.apEnd-o$.startTime,0),apStart:Math.max(i$.apStart-o$.startTime,0),joinGwEnd:Math.max(i$.joinGwEnd-o$.startTime,0),joinGwStart:Math.max(i$.joinGwStart-o$.startTime,0),pcEnd:Math.max(i$.pcEnd-o$.startTime,0),pcStart:Math.max(i$.pcStart-o$.startTime,0),subscriberEnd:Math.max(i$.subscriberEnd-o$.startTime,0),subscriberStart:Math.max(i$.subscriberStart-o$.startTime,0),videoAddNotify:Math.max(i$.videoAddNotify-o$.startTime,0)});this.send({type:n$,data:c$},!0)}firstRemoteFrame(t$,r$,n$,i$){let o$=this.baseInfoMap.get(t$);if(!o$)return;let s$=o$.info,a$=Date.now(),c$=ot(ot(ot({},s$),i$),{},{elapse:a$-o$.startTime,eventType:r$,lts:a$});this.send({type:n$,data:c$},!0)}pcStats(t$,r$){let n$=this.baseInfoMap.get(t$);if(!n$)return;let i$=n$.info,o$=Date.now(),s$=ot(ot(ot({},i$),r$),{},{vid:i$.vid===void 0?0:Number(i$.vid),elapse:o$-n$.startTime,eventType:De.PC_STATS,lts:o$,preallocation:r$.preallocation?1:0});this.send({type:Jt.PC_STATS,data:s$},!0)}updateRemoteRTPCapabilities(t$,r$){if(t$){let n$=this.baseInfoMap.get(t$);if(!n$)return;let i$=n$.info,o$=Date.now(),s$=ot(ot(ot({},i$),r$),{},{vid:i$.vid===void 0?0:Number(i$.vid),eventType:De.UPDATE_REMOTE_RTPCAPABILITIES,lts:o$});this.send({type:Jt.UPDATE_REMOTE_RTPCAPABILITIES,data:s$},!0)}}onGatewayStream(t$,r$,n$,i$){let o$=this.baseInfoMap.get(t$);if(!o$)return;let s$=o$.info,a$=Date.now(),c$=ot(ot(ot({},s$),i$),{},{eventType:r$,lts:a$});this.send({type:n$,data:c$},!0)}streamSwitch(t$,r$){let n$=this.baseInfoMap.get(t$);if(!n$)return;let i$=n$.info,o$=Date.now(),s$=ot(ot({},i$),{},{eventType:De.STREAM_SWITCH,lts:o$,isDual:r$.isdual,elapse:o$-n$.startTime,success:r$.succ});this.send({type:Jt.STREAM_SWITCH,data:s$},!0)}requestProxyAppCenter(t$,r$){let n$=this.baseInfoMap.get(t$);if(!n$)return;let i$=n$.info,o$=Date.now(),s$=ot(ot({},i$),{},{eventType:De.REQUEST_PROXY_APPCENTER,lts:o$,eventElapse:o$-r$.lts,elapse:o$-n$.startTime,APAddr:r$.APAddr,workerManagerList:r$.workerManagerList,response:r$.response,errorCode:r$.ec,success:r$.succ});this.send({type:Jt.REQUEST_PROXY_APPCENTER,data:s$},!0)}requestProxyWorkerManager(t$,r$){let n$=this.baseInfoMap.get(t$);if(!n$)return;let i$=n$.info,o$=Date.now(),s$=ot(ot({},i$),{},{eventType:De.REQUEST_PROXY_WORKER_MANAGER,lts:o$,eventElapse:o$-r$.lts,elapse:o$-n$.startTime,workerManagerAddr:r$.workerManagerAddr,response:r$.response,errorCode:r$.ec,success:r$.succ});this.send({type:Jt.REQUEST_PROXY_WORKER_MANAGER,data:s$},!0)}setProxyServer(t$){this.proxyServer=t$,t$?_.debug("reportProxyServerurl: ".concat(t$)):_.debug("disable reportProxyServerurl: ".concat(t$))}peerPublishStatus(t$,r$){let n$=this.baseInfoMap.get(t$);if(!n$)return;let i$=n$.info,o$=Date.now(),s$=ot(ot({},i$),{},{subscribeElapse:r$.subscribeElapse,peer:r$.peer,peerPublishDuration:Math.max(r$.audioPublishDuration,r$.videoPublishDuration),audiotag:r$.audioPublishDuration>0?1:-1,videotag:r$.videoPublishDuration>0?1:-1,lts:o$,elapse:o$-n$.startTime,joinChannelSuccessElapse:o$-(n$.lastJoinSuccessTime||o$),peerPublishDurationVideo:r$.videoPublishDuration,peerPublishDurationAudio:r$.audioPublishDuration});this.send({type:Jt.PEER_PUBLISH_STATUS,data:s$},!0)}workerEvent(t$,r$){let n$=this.baseInfoMap.get(t$);if(!n$)return;let i$=n$.info,o$=Date.now();(function(s$,a$,c$){let u$=s$[a$];if(!u$||typeof u$!="string")return[s$];s$[a$]="";let l$=ar(JSON.stringify(s$)),d$=0,h$=[],p$=0;for(let _$=0;_$<u$.length;_$++)p$+=u$.charCodeAt(_$)<=127?1:3,p$<=c$-l$||(h$[h$.length]=J(J({},s$),{},{[a$]:u$.substring(d$,_$)}),d$=_$,p$=u$.charCodeAt(_$)<=127?1:3);return d$!==u$.length-1&&(h$[h$.length]=J(J({},s$),{},{[a$]:u$.substring(d$)})),h$})(ot(ot(ot({},i$),r$),{},{elapse:o$-n$.startTime,lts:o$,productType:"WebRTC"}),"payload",1300).forEach(s$=>this.send({type:Jt.WORKER_EVENT,data:s$},!0))}apworkerEvent(t$,r$){let n$=this.baseInfoMap.get(t$);if(!n$)return;let i$=n$.info,o$=Date.now(),s$=ot(ot(ot({},i$),r$),{},{elapse:o$-n$.startTime,lts:o$});this.send({type:Jt.AP_WORKER_EVENT,data:s$},!0)}joinWebProxyAP(t$,r$){let n$=this.baseInfoMap.get(t$);if(!n$)return;let i$=n$.info,o$=Date.now(),s$=ot(ot(ot({},i$),r$),{},{elapse:o$-n$.startTime,lts:o$,extend:r$.extend||void 0});this.send({type:Jt.JOIN_WEB_PROXY_AP,data:s$},!0)}WebSocketQuit(t$,r$){let n$=this.baseInfoMap.get(t$);if(!n$)return;let i$=n$.info,o$=Date.now(),s$=ot(ot(ot({},i$),r$),{},{elapse:o$-n$.startTime,lts:o$});this.send({type:Jt.WEBSOCKET_QUIT,data:s$},!0)}async sendCustomReportMessage(t$,r$){if(this.customReportCount+=r$.length,this.customReportCount>v("CUSTOM_REPORT_LIMIT"))throw new N(R.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let n$=Date.now(),i$=r$.map(o$=>({type:Jt.USER_ANALYTICS,data:ot(ot({sid:t$},o$),{},{lts:n$})}));try{v("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i$):await this.postDataToStatsCollector(i$)}catch(o$){throw _.error("send custom report message failed",o$.toString()),new N(R.CUSTOM_REPORT_SEND_FAILED,o$.message)}}sendApiInvoke(t$){let r$=v("NOT_REPORT_EVENT");if(t$.tag&&W(r$)&&W(r$).call(r$,t$.tag))return!1;if(t$.sid===null)return this.apiInvokeUploadPendingItems.push(t$),!1;let n$=this.baseInfoMap.get(t$.sid);if(!n$)return this.apiInvokeUploadPendingItems.push(t$),!1;let{cname:i$,uid:o$,cid:s$}=n$.info,a$;if(t$.lts=t$.lts||Date.now(),t$.error)if(t$.error instanceof N){let{code:u$,message:l$}=t$.error;a$=u$||l$||t$.error.toString()}else a$=t$.error.toString();let c$={invokeId:t$.invokeId,sid:t$.sid,cname:i$,cid:s$,uid:o$,lts:t$.lts,success:t$.success,elapse:t$.lts-n$.startTime,execElapse:t$.lts-t$.apiInvokeTime,apiName:t$.name,options:t$.options?JSON.stringify(t$.options):void 0,execStates:t$.states?JSON.stringify(t$.states):void 0,execResult:t$.result?JSON.stringify(t$.result):void 0,errorCode:t$.error?a$:void 0,errorMsg:t$.error?JSON.stringify(t$.error):void 0};return this.send({type:Jt.API_INVOKE,data:c$},!1),!0}appendSessionId(){I5.__CLIENT_LIST__.forEach(t$=>{if(t$._sessionId){let r$=this.apiInvokeUploadPendingItems.length;for(let n$=0;n$<r$;n$++){let i$=this.apiInvokeUploadPendingItems.shift();i$&&(i$.sid=t$._sessionId,this.sendApiInvoke(Object.assign({},i$)))}}})}send(t$,r$){if(r$)return this.keyEventUploadPendingItems.push(t$),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t$),this.normalEventUploadPendingItems.length>v("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t$,r$){let n$=[],i$=[];for(;t$.length;){let s$=t$.shift();n$.length<20?n$.push(s$):i$.push(s$)}t$.push(...i$);for(let s$ of[...n$]){var o$;this.ltsList.indexOf(s$.data.lts)!==-1?(s$.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s$.data.lts)):(this.ltsList.push(s$.data.lts),ed(o$=this.ltsList).call(o$,(a$,c$)=>a$-c$))}return r$||(this.lastSendNormalEventTime=Date.now()),v("ENABLE_EVENT_REPORT")&&n$.length&&(v("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n$):this.postDataToStatsCollector(n$)).catch((s$=>a$=>{v("EVENT_REPORT_RETRY")&&(r$?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s$):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s$),this.normalEventUploadPendingItems.length>v("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-v("NORMAL_EVENT_QUEUE_CAPACITY")),_.warning("report: drop normal events"))))})(n$)),t$}async postDataToStatsCollector2(t$){he.networkState===wn.OFFLINE&&await j.race([he.onlineWaiter,Me(2*Ee.maxRetryTimeout)]);let r$=o$=>{let s$=new Uint8Array;return o$.forEach(a$=>{let c$=uf(JSON.stringify(a$.data)),u$=new ArrayBuffer(5),l$=(h$=>{let p$=0;return Object.entries(Jt).forEach(_$=>{let[f$,m$]=_$;m$===h$.type&&(p$=IB[f$])}),p$})(a$),d$=new DataView(u$);d$.setUint16(0,c$.byteLength,!0),d$.setUint8(2,255&l$),d$.setUint8(3,l$>>>8&255),d$.setUint8(4,l$>>>16&255),s$=ER(s$,new Uint8Array(u$)),s$=ER(s$,c$)}),s$},n$="event",i$=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(v("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n$):"https://".concat(v("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n$);for(let o$=0;o$<2;o$+=1){o$===1&&(i$=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(v("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n$):"https://".concat(v("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n$));try{await LE(i$,{timeout:1e4,data:r$(t$),headers:ot(ot({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s$){if(o$===1)throw s$;continue}return}}async postDataToStatsCollector(t$){let r$=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n$={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t$.map(s$=>JSON.stringify(s$)),vid:(s$=>{let a$=s$&&s$.data.sid&&this.baseInfoMap.get(s$.data.sid);return a$&&a$.info.vid&&+a$.info.vid||0})(t$[0])};he.networkState===wn.OFFLINE&&await j.race([he.onlineWaiter,Me(2*Ee.maxRetryTimeout)]);let i$=r$?"/events/proto-raws":"/events/messages",o$=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(v("EVENT_REPORT_DOMAIN"),"&p=").concat(v("STATS_COLLECTOR_PORT"),"&d=").concat(i$):"https://".concat(v("EVENT_REPORT_DOMAIN"),":").concat(v("STATS_COLLECTOR_PORT")).concat(i$));for(let s$=0;s$<2;s$+=1){s$===1&&(o$=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(v("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(v("STATS_COLLECTOR_PORT"),"&d=").concat(i$):"https://".concat(v("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(v("STATS_COLLECTOR_PORT")).concat(i$)));try{r$?await gB(o$,{timeout:1e4,data:n$}):await LE(o$,{timeout:1e4,data:n$})}catch(a$){if(s$===1)throw a$;continue}return}}createBaseInfo(t$,r$){let n$=Object.assign({},CB);return n$.sid=t$,this.baseInfoMap.set(t$,{info:n$,startTime:r$}),n$}reportResourceTiming(t$,r$){let n$=performance.getEntriesByName(t$),i$=n$[n$.length-1];i$&&this.reportApiInvoke(r$,{name:"Client.resourceTiming",options:i$,tag:Zt.TRACER}).onSuccess()}};function $(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t$,r$,n$){let i$=n$.value;if(typeof i$=="function"){let o$=e$.className||t$.__className__||(t$.constructor.name==="AgoraRTCClient"?"Client":t$.constructor.name);n$.value=function(){for(var s$=arguments.length,a$=new Array(s$),c$=0;c$<s$;c$++)a$[c$]=arguments[c$];let u$=a$;if(e$.argsMap)try{u$=e$.argsMap(this,...a$)}catch(d$){_.warning(d$),u$=[]}try{JSON.stringify(u$)}catch{_.warning("arguments for method ".concat(o$,".").concat(String(r$)," not serializable for apiInvoke.")),u$=[]}let l$=(e$.report||X).reportApiInvoke(this._sessionId||null,{name:"".concat(o$,".").concat(String(r$)),options:u$,tag:Zt.TRACER,reportResult:e$.reportResult},e$.throttleTime);try{let d$=i$.apply(this,a$);return d$ instanceof j?d$.then(h$=>(l$.onSuccess(e$.reportResult&&h$),h$)).catch(h$=>{throw l$.onError(h$),h$}):(l$.onSuccess(e$.reportResult&&d$),d$)}catch(d$){throw l$.onError(d$),d$}}}return n$}}re(bc,"__CLIENT_LIST__",[]);var X=new bc;wO.on("REPORT_LOG_UPLOAD",e$=>{e$.networkState=he.networkState,X.reportApiInvoke(null,{name:"logUploadError",options:e$,tag:Zt.TRACER}).onSuccess("logUploadError")});var vB=["CHINA","GLOBAL"],Ve=function(){let e$="us".concat("erna","me"),t$="pa".concat("sswo","rd"),r$=["t","s","t"];r$.splice(1,0,"e");let n$=r$.join(""),i$=[];for(let a$=0;a$<6;a$++)i$.push("1");let o$=i$.join(""),s$={};return s$[e$]=n$,s$[t$]=o$,Object.assign(s$,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ve,pf||(oe.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],oe.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],oe.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],oe.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],oe.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],oe.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],oe.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",oe.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",oe.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",oe.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",oe.AREAS=["NORTH_AMERICA","OVERSEA"]);var OO=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Jr=[];function Io(e$,t$){return!!t$&&Jr.some(r$=>r$.uid===e$&&r$.channelName===t$)}bc.__CLIENT_LIST__=Jr;var yB=bw.forEach,NR=Nu("forEach")?[].forEach:function(e$){return yB(this,e$,arguments.length>1?arguments[1]:void 0)};xt({target:"Array",proto:!0,forced:[].forEach!=NR},{forEach:NR});var AB=bi("Array").forEach,bB=Er,wB=Je,OB=hn,NB=AB,Dp=Array.prototype,DB={DOMTokenList:!0,NodeList:!0},PB=function(e$){var t$=e$.forEach;return e$===Dp||OB(Dp,e$)&&t$===Dp.forEach||wB(DB,bB(e$))?NB:t$},kB=ae(PB),LB=_r,DR=Lu;xt({target:"Object",stat:!0,forced:Se(function(){DR(1)})},{keys:function(e$){return DR(LB(e$))}});var NO=ae(Gi.Object.keys),MB=ae(VA),UB=xt,xB=nd,VB=me([].reverse),PR=[1,2];UB({target:"Array",proto:!0,forced:String(PR)===String(PR.reverse())},{reverse:function(){return xB(this)&&(this.length=this.length),VB(this)}});var FB=bi("Array").reverse,BB=hn,jB=FB,Pp=Array.prototype,GB=function(e$){var t$=e$.reverse;return e$===Pp||BB(Pp,e$)&&t$===Pp.reverse?jB:t$},DO=GB,WB=ae(DO),HB=xt,kR=nd,KB=xu,YB=Hn,LR=Om,qB=Lr,zB=Eo,JB=Bu,XB=pe,QB=Gm,ZB=Iw("slice"),$B=XB("species"),kp=Array,tj=Math.max;HB({target:"Array",proto:!0,forced:!ZB},{slice:function(e$,t$){var r$,n$,i$,o$=zB(this),s$=qB(o$),a$=LR(e$,s$),c$=LR(t$===void 0?s$:t$,s$);if(kR(o$)&&(r$=o$.constructor,(KB(r$)&&(r$===kp||kR(r$.prototype))||YB(r$)&&(r$=r$[$B])===null)&&(r$=void 0),r$===kp||r$===void 0))return QB(o$,a$,c$);for(n$=new(r$===void 0?kp:r$)(tj(c$-a$,0)),i$=0;a$<c$;a$++,i$++)a$ in o$&&JB(n$,i$,o$[a$]);return n$.length=i$,n$}});var ej=bi("Array").slice,nj=hn,ij=ej,Lp=Array.prototype,rj=function(e$){var t$=e$.slice;return e$===Lp||nj(Lp,e$)&&t$===Lp.slice?ij:t$},oj=ae(rj);function q(e$,t$,r$,n$,i$){var o$,s$,a$,c$={};return kB(o$=NO(n$)).call(o$,function(u$){c$[u$]=n$[u$]}),c$.enumerable=!!c$.enumerable,c$.configurable=!!c$.configurable,("value"in c$||c$.initializer)&&(c$.writable=!0),c$=MB(s$=WB(a$=oj(r$).call(r$)).call(a$)).call(s$,function(u$,l$){return l$(e$,t$,u$)||u$},c$),i$&&c$.initializer!==void 0&&(c$.value=c$.initializer?c$.initializer.call(i$):void 0,c$.initializer=void 0),c$.initializer===void 0&&(Rw(e$,t$,c$),c$=null),c$}var xE=function(e$){return e$.L1T1="L1T1",e$.L1T2="L1T2",e$.L1T3="L1T3",e$.L1T3_KEY="L1T3_KEY",e$.L2T1_KEY="L2T1_KEY",e$.L2T2_KEY="L2T2_KEY",e$.L2T3_KEY="L2T3_KEY",e$.L3T1_KEY="L3T1_KEY",e$.L3T2_KEY="L3T2_KEY",e$.L3T3_KEY="L3T3_KEY",e$}({}),kn=function(e$){return e$.CERTIFICATE="certificate",e$.CODEC="codec",e$.CANDIDATE_PAIR="candidate-pair",e$.LOCAL_CANDIDATE="local-candidate",e$.REMOTE_CANDIDATE="remote-candidate",e$.INBOUND="inbound-rtp",e$.TRACK="track",e$.OUTBOUND="outbound-rtp",e$.PC="peer-connection",e$.REMOTE_INBOUND="remote-inbound-rtp",e$.REMOTE_OUTBOUND="remote-outbound-rtp",e$.TRANSPORT="transport",e$.CSRC="csrc",e$.DATA_CHANNEL="data-channel",e$.STREAM="stream",e$.SENDER="sender",e$.RECEIVER="receiver",e$}({}),gl=function(e$){return e$[e$.ACCESS_POINT=101]="ACCESS_POINT",e$[e$.UNILBS=201]="UNILBS",e$[e$.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e$}({}),Mp=function(e$){return e$[e$.IIIEGAL_APPID=1]="IIIEGAL_APPID",e$[e$.IIIEGAL_UID=2]="IIIEGAL_UID",e$[e$.INTERNAL_ERROR=3]="INTERNAL_ERROR",e$}({}),ci=function(e$){return e$[e$.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e$[e$.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e$[e$.INTERNAL_ERROR=8]="INTERNAL_ERROR",e$[e$.NO_AUTHORIZED=9]="NO_AUTHORIZED",e$[e$.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e$[e$.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e$[e$.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e$[e$.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e$[e$.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e$[e$.USER_OVERLOAD=16]="USER_OVERLOAD",e$[e$.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e$[e$.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e$}({}),on=function(e$){return e$[e$.NO_FLAG_SET=100]="NO_FLAG_SET",e$[e$.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e$[e$.INVALID_FALG_SET=102]="INVALID_FALG_SET",e$[e$.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e$[e$.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e$[e$.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e$[e$.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e$[e$.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e$[e$.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e$[e$.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e$[e$.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e$[e$.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e$[e$.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e$[e$.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e$[e$.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e$[e$.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e$[e$.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e$[e$.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e$[e$.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e$}({}),Z=function(e$){return e$[e$.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e$[e$.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e$[e$.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e$[e$.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e$[e$.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e$[e$.K_TICKET_INVALID=7]="K_TICKET_INVALID",e$[e$.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e$[e$.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e$[e$.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e$[e$.K_UID_BANNED=14]="K_UID_BANNED",e$[e$.K_IP_BANNED=15]="K_IP_BANNED",e$[e$.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e$[e$.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e$[e$.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e$[e$.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e$[e$.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e$[e$.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e$[e$.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e$[e$.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e$[e$.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e$[e$.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e$[e$.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e$[e$.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e$[e$.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e$[e$.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e$[e$.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e$[e$.ERR_INVALID_UID=117]="ERR_INVALID_UID",e$[e$.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e$[e$.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e$[e$.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e$[e$.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e$[e$.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e$[e$.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e$[e$.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e$[e$.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e$[e$.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e$[e$.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e$[e$.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e$[e$.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e$[e$.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e$[e$.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e$[e$.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e$[e$.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e$[e$.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e$[e$.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e$[e$.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e$[e$.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e$[e$.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e$[e$.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e$[e$.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e$[e$.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e$[e$.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e$[e$.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e$[e$.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e$[e$.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e$[e$.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e$[e$.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e$[e$.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e$[e$.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e$[e$.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e$[e$.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e$[e$.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e$[e$.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e$[e$.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e$}({}),Lt=function(e$){return e$.CONNECTING="connecting",e$.CONNECTED="connected",e$.RECONNECTING="reconnecting",e$.CLOSED="closed",e$}({}),nt=function(e$){return e$.WS_CONNECTED="ws_connected",e$.WS_RECONNECTING="ws_reconnecting",e$.WS_CLOSED="ws_closed",e$.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e$.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e$.ON_BINARY_DATA="on_binary_data",e$.REQUEST_RECOVER="request_recover",e$.REQUEST_JOIN_INFO="request_join_info",e$.REQUEST_REJOIN_INFO="req_rejoin_info",e$.IS_P2P_DISCONNECTED="is_p2p_dis",e$.DISCONNECT_P2P="dis_p2p",e$.ABORT_P2P_EXECUTION="abort_p2p_execution",e$.NEED_RENEW_SESSION="need-sid",e$.REPORT_JOIN_GATEWAY="report_join_gateway",e$.REQUEST_TIMEOUT="request_timeout",e$.REQUEST_SUCCESS="request_success",e$.JOIN_RESPONSE="join_response",e$.PRE_CONNECT_PC="pre_connect_pc",e$.P2P_CONNECTION="p2p_connection",e$.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e$.P2P_SUBSCRIBE="p2p_subscribe",e$.P2P_UNSUBSCRIBE="p2p_unsubscribe",e$.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e$.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e$.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e$}({}),et=function(e$){return e$.PING="ping",e$.PING_BACK="ping_back",e$.JOIN="join_v3",e$.REJOIN="rejoin_v3",e$.LEAVE="leave",e$.SET_CLIENT_ROLE="set_client_role",e$.PUBLISH="publish",e$.PUBLISH_DATASTREAM="publish_datastream",e$.UNPUBLISH="unpublish",e$.UNPUBLISH_DATASTREAM="unpublish_datastream",e$.SUBSCRIBE="subscribe",e$.PRE_SUBSCRIBE="pre_subscribe",e$.SUBSCRIBE_DATASTREAM="subscribe_datastream",e$.SUBSCRIBE_STREAMS="subscribe_streams",e$.UNSUBSCRIBE="unsubscribe",e$.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e$.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e$.SUBSCRIBE_CHANGE="subscribe_change",e$.TRAFFIC_STATS="traffic_stats",e$.RENEW_TOKEN="renew_token",e$.SWITCH_VIDEO_STREAM="switch_video_stream",e$.DEFAULT_VIDEO_STREAM="default_video_stream",e$.SET_FALLBACK_OPTION="set_fallback_option",e$.GATEWAY_INFO="gateway_info",e$.CONTROL="control",e$.SEND_METADATA="send_metadata",e$.DATA_STREAM="data_stream",e$.PICK_SVC_LAYER="pick_svc_layer",e$.RESTART_ICE="restart_ice",e$.CONNECT_PC="connect_pc",e$.SET_VIDEO_PROFILE="set_video_profile",e$.SET_PARAMETER="set_parameter",e$.SET_RTM2_FLAG="set_rtm2_flag",e$}({}),wc=function(e$){return e$.WRTC_STATS="wrtc_stats",e$.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e$.DENOISER_STATS="denoiser_stats",e$.EXTENSION_USAGE_STATS="extension_usage_stats",e$}({}),dt=function(e$){return e$.ON_USER_ONLINE="on_user_online",e$.ON_USER_OFFLINE="on_user_offline",e$.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e$.ON_PUBLISH_STREAM="on_publish_stream",e$.ON_UPLINK_STATS="on_uplink_stats",e$.ON_P2P_LOST="on_p2p_lost",e$.ON_REMOVE_STREAM="on_remove_stream",e$.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e$.ON_ADD_VIDEO_STREAM="on_add_video_stream",e$.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e$.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e$.ON_USER_BANNED="on_user_banned",e$.ON_USER_LICENSE_BANNED="on_user_license_banned",e$.ON_NOTIFICATION="on_notification",e$.ON_CRYPT_ERROR="on_crypt_error",e$.MUTE_AUDIO="mute_audio",e$.MUTE_VIDEO="mute_video",e$.UNMUTE_AUDIO="unmute_audio",e$.UNMUTE_VIDEO="unmute_video",e$.ON_P2P_OK="on_p2p_ok",e$.RECEIVE_METADATA="receive_metadata",e$.ON_DATA_STREAM="on_data_stream",e$.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e$.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e$.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e$.ENABLE_LOCAL_VIDEO="enable_local_video",e$.DISABLE_LOCAL_VIDEO="disable_local_video",e$.ENABLE_LOCAL_AUDIO="enable_local_audio",e$.DISABLE_LOCAL_AUDIO="disable_local_audio",e$.ON_PUBLISHED_USER_LIST="on_published_user_list",e$}({}),cn=function(e$){return e$.SEND_ONLY="SEND_ONLY",e$.RECEIVE_ONLY="RECEIVE_ONLY",e$}({}),it=function(e$){return e$.CONNECTED="websocket:connected",e$.RECONNECTING="websocket:reconnecting",e$.WILL_RECONNECT="websocket:will_reconnect",e$.CLOSED="websocket:closed",e$.FAILED="websocket:failed",e$.ON_MESSAGE="websocket:on_message",e$.REQUEST_NEW_URLS="websocket:request_new_urls",e$.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e$.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e$.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e$}({}),O=class extends N{constructor(e$){super(e$,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),T(this,"name","AgoraRTCException")}print(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e$,_)}throw(){super.throw(_)}};function Xu(e$){if(typeof e$!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e$))throw _.error("Invalid Channel Name ".concat(e$)),new O(R.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Qu(e$){if(!function(t$){return typeof t$=="number"&&Math.floor(t$)===t$&&0<=t$&&t$<=4294967295}(e$)&&!RO(e$,1,255))throw new O(R.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof e$=="string"&&_.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}var er=function(e$){return e$.TRANSCODE="mix_streaming",e$.RAW="raw_streaming",e$}({}),sj={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Up={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function xp(e$,t$){Pe(e$.url,"".concat(t$,".url"),1,1e3,!1),zt(e$.x)||Nt(e$.x,"".concat(t$,".x"),0,1e4),zt(e$.y)||Nt(e$.y,"".concat(t$,".y"),0,1e4),zt(e$.width)||Nt(e$.width,"".concat(t$,".width"),0,1e4),zt(e$.height)||Nt(e$.height,"".concat(t$,".height"),0,1e4),zt(e$.zOrder)||Nt(e$.zOrder,"".concat(t$,".zOrder"),0,255),zt(e$.alpha)||Nt(e$.alpha,"".concat(t$,".alpha"),0,1,!1)}var aj={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},Xr=function(e$){return e$.WARNING="@live_uap-warning",e$.ERROR="@line_uap-error",e$.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e$.WORKER_STATUS="@live_uap-worker-status",e$.REQUEST_NEW_ADDRESS="@live_uap-request-address",e$}({}),VE=function(e$){return e$.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e$}({}),fe=function(e$){return e$[e$.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e$[e$.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e$[e$.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e$[e$.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e$[e$.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e$[e$.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e$[e$.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e$[e$.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e$[e$.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e$[e$.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e$[e$.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e$[e$.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e$[e$.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e$[e$.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e$[e$.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e$[e$.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e$[e$.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e$[e$.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e$[e$.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e$[e$.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e$[e$.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e$}({});function MR(e$){if(!e$.channelName)throw new O(R.INVALID_PARAMS,"invalid channelName in info");if(typeof e$.uid!="number")throw new O(R.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e$.token&&Pe(e$.token,"info.token",1,2047),Qu(e$.uid),Xu(e$.channelName),!0}var sn=function(e$){return e$[e$.SetSdkProfile=0]="SetSdkProfile",e$[e$.SetSourceChannel=1]="SetSourceChannel",e$[e$.SetSourceUserId=2]="SetSourceUserId",e$[e$.SetDestChannel=3]="SetDestChannel",e$[e$.StartPacketTransfer=4]="StartPacketTransfer",e$[e$.StopPacketTransfer=5]="StopPacketTransfer",e$[e$.UpdateDestChannel=6]="UpdateDestChannel",e$[e$.Reconnect=7]="Reconnect",e$[e$.SetVideoProfile=8]="SetVideoProfile",e$}({}),Ir=function(e$){return e$.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e$.NETWORK_CONNECTED="NETWORK_CONNECTED",e$.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e$.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e$.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e$.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e$.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e$.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e$.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e$.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e$}({}),Sn=function(e$){return e$.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e$.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e$.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e$.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e$}({}),ys=function(e$){return e$.RELAY_OK="RELAY_OK",e$.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e$.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e$.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e$}({}),Ct=function(e$){return e$.High="high",e$.Low="low",e$.Audio="audio",e$.Screen="screen",e$.ScreenLow="screen_low",e$}({}),xe=function(e$){return e$.DISCONNECT="disconnect",e$.CONNECTION_STATE_CHANGE="connection-state-change",e$.NETWORK_QUALITY="network-quality",e$.STREAM_TYPE_CHANGE="stream-type-change",e$.IS_P2P_DISCONNECTED="is-p2p-dis",e$.DISCONNECT_P2P="dis-p2p",e$.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e$.NEED_RENEW_SESSION="need-sid",e$.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e$.JOIN_RESPONSE="join-response",e$.RESET_CONNECTION_EVENTS="reset-connection-events",e$.PRE_CONNECT_PC="pre-connect_pc",e$}({}),Tl=function(e$){return e$.P2P_DISCONNECTED="P2P_DISCONNECTED",e$.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e$.TIMEOUT="TIMEOUT",e$.UNKNOWN_REASON="UNKNOWN_REASON",e$}({}),ve=function(e$){return e$[e$.Nothing=0]="Nothing",e$[e$.Audio=1]="Audio",e$[e$.LwoVideo=2]="LwoVideo",e$[e$.Video=4]="Video",e$[e$.Data=8]="Data",e$[e$.DataStream0=256]="DataStream0",e$[e$.DataStream1=512]="DataStream1",e$[e$.DataStream2=1024]="DataStream2",e$[e$.DataStream3=2048]="DataStream3",e$[e$.DataStream4=4096]="DataStream4",e$[e$.DataStream5=8192]="DataStream5",e$[e$.DataStream6=16384]="DataStream6",e$[e$.DataStream7=32768]="DataStream7",e$}({}),St=function(e$){return e$.CHINA="CHINA",e$.ASIA="ASIA",e$.NORTH_AMERICA="NORTH_AMERICA",e$.EUROPE="EUROPE",e$.JAPAN="JAPAN",e$.INDIA="INDIA",e$.KOREA="KOREA",e$.HKMC="HKMC",e$.US="US",e$.OCEANIA="OCEANIA",e$.SOUTH_AMERICA="SOUTH_AMERICA",e$.AFRICA="AFRICA",e$.OVERSEA="OVERSEA",e$.GLOBAL="GLOBAL",e$.EXTENSIONS="EXTENSIONS",e$}({}),UR=[St.AFRICA,St.ASIA,St.CHINA,St.EUROPE,St.GLOBAL,St.INDIA,St.JAPAN,St.NORTH_AMERICA,St.OCEANIA,St.OVERSEA,St.SOUTH_AMERICA],Ye=function(e$){return e$.CHINA="CN",e$.ASIA="AS",e$.NORTH_AMERICA="NA",e$.EUROPE="EU",e$.JAPAN="JP",e$.INDIA="IN",e$.KOREA="KR",e$.HKMC="HK",e$.US="US",e$.OCEANIA="OC",e$.SOUTH_AMERICA="SA",e$.AFRICA="AF",e$.OVERSEA="OVERSEA",e$.GLOBAL="GLOBAL",e$.EXTENSIONS="GLOBAL",e$}({}),Zu={CHINA:{},ASIA:{CODE:Ye.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Ye.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Ye.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Ye.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Ye.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Ye.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Ye.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Ye.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Ye.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Ye.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Ye.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Ye.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Ye.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};pf&&(Zu.CHINA={CODE:Ye.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});var FE=function(e$){return e$.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e$}({}),Kl=class extends Xt{constructor(e$,t$){super(),T(this,"onICEConnectionStateChange",void 0),T(this,"onConnectionStateChange",void 0),T(this,"onDTLSTransportStateChange",void 0),T(this,"onDTLSTransportError",void 0),T(this,"onICETransportStateChange",void 0),T(this,"onFirstAudioReceived",void 0),T(this,"onFirstVideoReceived",void 0),T(this,"onFirstAudioDecoded",void 0),T(this,"onFirstVideoDecoded",void 0),T(this,"onFirstVideoDecodedTimeout",void 0),T(this,"onSelectedLocalCandidateChanged",void 0),T(this,"onSelectedRemoteCandidateChanged",void 0),T(this,"getLocalVideoStats",void 0)}},Yl=class extends Kl{constructor(e$,t$){super(e$,t$),T(this,"establishPromise",void 0)}},Q=function(e$){return e$.VIDEO="video",e$.AUDIO="audio",e$}({}),On=function(e$){return e$[e$.UDP=0]="UDP",e$[e$.TCP=1]="TCP",e$[e$.RELAY=2]="RELAY",e$}({}),Tr=function(e$){return e$[e$.FIRST_CONNECTION=0]="FIRST_CONNECTION",e$[e$.TCP_RESTART=1]="TCP_RESTART",e$[e$.RELAY_RESTART=2]="RELAY_RESTART",e$[e$.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e$[e$.OLD_RESTART=11]="OLD_RESTART",e$[e$.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e$}({}),U=function(e$){return e$.LocalVideoTrack="videoTrack",e$.LocalAudioTrack="audioTrack",e$.LocalVideoLowTrack="videoLowTrack",e$}({}),Rt=function(e$){return e$.New="new",e$.Connected="connected",e$.Reconnecting="reconnecting",e$.Disconnected="disconnected",e$}({}),tt=function(e$){return e$.StateChange="stateChange",e$.IceConnectionStateChange="iceConnectionStateChange",e$.RequestMuteLocal="requestMuteLocal",e$.RequestUnmuteLocal="requestUnmuteLocal",e$.RequestRePublish="requestRePublish",e$.RequestRePublishDataChannel="requestRePublishDataChannel",e$.RequestReSubscribe="requestReSubscribe",e$.RequestUploadStats="requestUploadStats",e$.RequestUpload="requestUpload",e$.MediaReconnectStart="MediaReconnectStart",e$.MediaReconnectEnd="MediaReconnectEnd",e$.NeedSignalRTT="NeedSignalRTT",e$.RequestRestartICE="RequestRestartIce",e$.PeerConnectionStateChange="PeerConnectionStateChange",e$.RequestReconnect="RequestReconnect",e$.RequestReconnectPC="RequestReconnectPC",e$.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e$.P2PLost="P2PLost",e$.UpdateVideoEncoder="UpdateVideoEncoder",e$.ConnectionTypeChange="ConnectionTypeChange",e$.RequestLowStreamParameter="RequestLowStreamParameter",e$.QueryClientConnectionState="QueryClientConnectionState",e$.LocalCandidate="LocalCandidate",e$.RequestP2PMuteLocal="requestP2PMuteLocal",e$.RequestP2PUnPublish="RequestP2PUnPublish",e$.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e$.RequestP2PMuteRemote="RequestP2PMuteRemote",e$.RequestP2PRestartICE="RequestP2PRestartICE",e$}({}),Ei=function(e$){return e$.CONNECTING="CONNECTING",e$.RECONNECTING="RECONNECTING",e$.CONNECTED="CONNECTED",e$.CLOSED="CLOSED",e$}({}),di=function(e$){return e$[e$.CONNECT_AP=0]="CONNECT_AP",e$[e$.AP_CONNECTED=1]="AP_CONNECTED",e$[e$.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e$[e$.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e$[e$.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e$[e$.CONNECT_WORKER=5]="CONNECT_WORKER",e$[e$.WORKER_CONNECTED=6]="WORKER_CONNECTED",e$[e$.CLOSED=7]="CLOSED",e$}({}),we=function(e$){return e$.CONNECTION_STATE_CHANGE="connection-state-change",e$.STATE_CHANGE="state-change",e$.INSPECT_RESULT="inspect-result",e$.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e$.REQUEST_NEW_WORKER_URL="request-new-worker-url",e$}({}),PO=function(e$){return e$.CONNECTED="transmitter:connected",e$.RECONNECTING="transmitter:reconnecting",e$.WILL_RECONNECT="transmitter:will_reconnect",e$.CLOSED="transmitter:closed",e$.FAILED="transmitter:failed",e$.ON_MESSAGE="transmitter:on_message",e$.REQUEST_NEW_URLS="transmitter:request_new_urls",e$.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e$.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e$.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e$.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e$.FAILBACK="transmitter:failback",e$.PRE_CONNECT_PC="transmitter:pre_connect_pc",e$}({}),nr=function(e$){return e$.CAMERA_CHANGED="camera-changed",e$.MICROPHONE_CHANGED="microphone-changed",e$.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e$.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e$.AUTOPLAY_FAILED="autoplay-failed",e$.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e$.SECURITY_POLICY_VIOLATION="security-policy-violation",e$}({}),Xn=function(e$){return e$.CONNECTING="CONNECTING",e$.RECONNECTING="RECONNECTING",e$.CONNECTED="CONNECTED",e$.CLOSED="CLOSED",e$}({}),Mi=function(e$){return e$.CONNECTION_STATE_CHANGE="connection-state-change",e$.STATE_CHANGE="state-change",e$.INSPECT_RESULT="inspect-result",e$.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e$.REQUEST_NEW_WORKER_URL="request-new-worker-url",e$}({}),hs=function(e$){return e$[e$.CONNECT_AP=0]="CONNECT_AP",e$[e$.AP_CONNECTED=1]="AP_CONNECTED",e$[e$.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e$[e$.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e$[e$.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e$[e$.CONNECT_WORKER=5]="CONNECT_WORKER",e$[e$.WORKER_CONNECTED=6]="WORKER_CONNECTED",e$[e$.CLOSED=7]="CLOSED",e$}({}),ie=function(e$){return e$.CALL="call",e$.CANDIDATE="candidate",e$.PUBLISH="publish",e$.UNPUBLISH="unpublish",e$.CONTROL="control",e$.RESTART_ICE="restart_ice",e$.ACK="ack",e$.RESPONSE="response",e$.JOIN="join",e$.CHECK="check",e$}({}),ps=function(e$){return e$.ABORT="abort",e$}({}),to=function(e$){return e$.MUTE_LOCAL_AUDIO="mute_local_audio",e$.MUTE_LOCAL_VIDEO="mute_local_video",e$.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e$.UNMUTE_LOCAL_VIDEO="unmute_local_video",e$}({}),cj=function(e$){return e$.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e$.P2P_TOKEN_CHANGED="p2p_token_changed",e$}({}),dj={[gl.ACCESS_POINT]:{[on.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[on.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[on.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[on.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[on.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[on.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[on.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[on.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[on.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[on.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[on.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[on.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[on.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[on.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[on.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[on.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[on.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[on.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[gl.UNILBS]:{[ci.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ci.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ci.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ci.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ci.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ci.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ci.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ci.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ci.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ci.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ci.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ci.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[gl.STRING_UID_ALLOCATOR]:{[Mp.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Mp.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Mp.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function ta(e$){let t$=dj[Math.floor(e$/1e4)];if(!t$)return{desc:"unknown error",retry:!1};let r$=t$[e$%1e4];if(!r$){if(Math.floor(e$/1e4)===gl.ACCESS_POINT){let n$=e$%1e4;if(n$.toString()[0]==="1")return{desc:e$.toString(),retry:!1};if(n$.toString()[0]==="2")return{desc:e$.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r$}var lj={[Z.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Z.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Z.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Z.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Z.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Z.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Z.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Z.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Z.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Z.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Z.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Z.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Z.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Z.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Z.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Z.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Z.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Z.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Z.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Z.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Z.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Z.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Z.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Z.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Z.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Z.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Z.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Z.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Z.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Z.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Z.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Z.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Z.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Z.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Z.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Z.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Z.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Z.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Z.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Z.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Z.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Z.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Z.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Z.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Z.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Z.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Z.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Z.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Z.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Z.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Z.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Z.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Z.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Z.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Z.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Z.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Z.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Z.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Z.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Z.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Z.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Z.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Z.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Oc(e$){return lj[e$]||{desc:"UNKNOWN_ERROR_".concat(e$),action:"failed"}}function xR(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function Vp(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?xR(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):xR(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}function VR(e$){return e$.every(t$=>t$.readyState===WebSocket.CLOSED||t$.readyState===WebSocket.CLOSING)}function FR(e$,t$){if(typeof e$=="string")return e$;let{proxy:r$,host:n$,port:i$}=e$;if(t$){let o$=v("JOIN_GATEWAY_FALLBACK_PORT")||443;return o$===443?"wss://".concat(n$,"/ws/?p=").concat(Number(i$)+150):"wss://".concat(n$,":").concat(o$,"/ws/?p=").concat(Number(i$)+150)}return r$?"wss://".concat(r$,"/ws/?h=").concat(n$,"&p=").concat(i$):"wss://".concat(n$,":").concat(i$)}var uj=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,hj=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,pj=/wss:\/\/(.+):([0-9]+)\/?/,_j=/wss:\/\/(.[^\/]+)\/?/,Ej=0,BE=class{constructor(e$,t$){T(this,"id",0),T(this,"store",void 0),T(this,"recordIndex",void 0),T(this,"websockets",[]),T(this,"try443PortDuration",2e3),T(this,"forceCloseWSDuration",5e3),T(this,"try443PortTimeout",null),T(this,"forceCloseTimeout",null),T(this,"isTry443PortFailed",!1),T(this,"isNormalPortFailed",!1),T(this,"useDoubleDomain",!1),T(this,"useProxy",!1),T(this,"startTime",Date.now()),this.id=++Ej,this.try443PortDuration=v("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e$||5e3,this.store=t$}closeAllWebsockets(){this.websockets.forEach(e$=>{e$.onopen=null,e$.onclose=null,e$.onmessage=null,e$.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var e$;let t$=Date.now()-this.startTime;for(var r$=arguments.length,n$=new Array(r$),i$=0;i$<r$;i$++)n$[i$]=arguments[i$];_.debug("[choose-best-ws ".concat((e$=this.store)===null||e$===void 0?void 0:e$.clientId," ").concat(this.id,"] ").concat(t$,"ms:"),...n$)}createWebSocket(e$,t$,r$){this.logger("createWebSocket:",e$,{isTry443Port:t$,hasTimeoutDetection:r$});let n$=v("GATEWAY_DOMAINS"),i$=Date.now(),o$=[],s$=n$.find(u$=>{var l$;return W(l$=e$.host).call(l$,u$)});s$||(this.useDoubleDomain=!1);let a$=[];if(this.useDoubleDomain)n$.forEach(u$=>{a$.push(FR(Vp(Vp({},e$),{},{host:e$.host.replace(s$,u$)}),t$))});else{let u$=Vp({},e$);if(t$&&s$){let l$=n$.find(d$=>d$!==s$);l$&&(u$.host=u$.host.replace(s$,l$))}a$.push(FR(u$,t$))}try{a$.forEach(u$=>{let l$=new WebSocket(u$);l$.binaryType="arraybuffer",o$.push(l$),this.logger("ws is connecting:",l$.url)})}catch(u$){if(this.logger("ws create failed"),o$.forEach(l$=>l$.close()),o$.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e$,t$,r$);if(!t$&&Number(e$.port)!==443)return this.createWebSocket(e$,!0,r$);throw new O(R.WS_ERR,"init websocket failed! Error: ".concat(u$.toString()))}let c$=vc();return this.store&&this.store.recordJoinChannelService({urls:o$.map(u$=>u$.url),service:"gateway"},this.recordIndex),o$.forEach(u$=>{u$.onopen=()=>{this.logger("onopen: ws ".concat(u$.url," open cost ").concat(Date.now()-i$,"ms")),this.websockets.forEach(l$=>{l$!==u$&&(l$.onopen=null,l$.onclose=null,l$.onmessage=null,l$.close(),this.logger("close backup websocket: ".concat(l$.url)))}),this.websockets.length=0,c$.resolve(u$)},u$.onclose=l$=>{this.logger("onclose: ws ".concat(u$.url," closed cost ").concat(Date.now()-i$,"ms state: ").concat(u$.readyState)),t$?this.isTry443PortFailed=VR(o$):this.isNormalPortFailed=VR(o$),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(t$&&this.isTry443PortFailed||!t$&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(l$.reason)),c$.reject({code:l$.code,reason:Tl.A_ROUND_WS_FAILED}))},u$.onmessage=l$=>this.logger("".concat(u$.url," onmessage: ").concat(l$.data))}),this.websockets.push(...o$),r$||(()=>{let u$=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",c$.isResolved),this.websockets.forEach(l$=>l$.readyState!==WebSocket.OPEN&&l$.close())};if(t$||this.useProxy)return this.logger("add 5s timeout at ".concat(t$?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(u$,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",c$.isResolved),c$.isResolved)return u$();mt().os===ye.MAC_OS&&$t()&&u$(),this.createWebSocket(e$,!0,!0).then(l$=>c$.resolve(l$)).catch(l$=>{this.isNormalPortFailed&&c$.reject(l$),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(u$,this.forceCloseWSDuration)},this.try443PortDuration)})(),c$.promise}chooseBestWebsocket(e$,t$,r$,n$){return this.useDoubleDomain=!!t$,typeof e$=="string"&&(e$=function(i$){let o$,s$,a$;return[,o$,s$,a$]=i$.match(uj)||[],o$||([,s$,a$]=i$.match(hj)||[]),s$&&a$||([,s$,a$]=i$.match(pj)||[]),s$&&a$||([,s$]=i$.match(_j)||[]),s$||_.warning("un-destructible url: ",i$),{proxy:o$,host:s$,port:a$||"443"}}(e$)),this.recordIndex=n$,this.useProxy=!!e$.proxy,r$&&this.useProxy&&(_.warn("cannot use 443 only when use proxy"),r$=!1),this.createWebSocket(e$,!!r$,!1).finally(()=>this.clearTimeout())}};function BR(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}var ql=class extends Xt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e$){var t$;W(t$=["tryNext","recover"]).call(t$,e$)&&this.resetReconnectCount(e$),this._reconnectMode=e$}get state(){return this._state}set state(e$){e$!==this._state&&(this._state=e$,this._state==="reconnecting"?this.emit(it.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(it.CONNECTED):this._state==="closed"?this.emit(it.CLOSED):this._state==="failed"&&this.emit(it.FAILED))}resetReconnectCount(e$){_.debug("websocket reset reconnect count, reason: "+e$),this.reconnectCount=0}constructor(e$,t$){let r$=arguments.length>2&&arguments[2]!==void 0&&arguments[2],n$=arguments.length>3&&arguments[3]!==void 0&&arguments[3],i$=arguments.length>4&&arguments[4]!==void 0&&arguments[4],o$=arguments.length>5?arguments[5]:void 0;super(),T(this,"connectionID",0),T(this,"currentURLIndex",0),T(this,"urls",[]),T(this,"_reconnectMode","tryNext"),T(this,"reconnectReason",void 0),T(this,"_initMutex",new ze("websocket")),T(this,"name",void 0),T(this,"_state","closed"),T(this,"reconnectInterrupter",void 0),T(this,"websocket",void 0),T(this,"retryConfig",void 0),T(this,"reconnectCount",0),T(this,"forceCloseTimeout",5e3),T(this,"onlineReconnectListener",void 0),T(this,"useCompress",void 0),T(this,"tryDoubleDomain",!1),T(this,"use443PortOnly",!1),T(this,"wsInflateLength",0),T(this,"wsDeflateLength",0),T(this,"closeEstablishingWs",()=>{}),T(this,"store",void 0),T(this,"joinGatewayRecordIndex",void 0),this.store=o$,this.name=e$,this.retryConfig=function(l$){for(var d$=1;d$<arguments.length;d$++){var h$=arguments[d$]!=null?arguments[d$]:{};d$%2?BR(Object(h$),!0).forEach(function(p$){T(l$,p$,h$[p$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l$,Object.getOwnPropertyDescriptors(h$)):BR(Object(h$)).forEach(function(p$){Object.defineProperty(l$,p$,Object.getOwnPropertyDescriptor(h$,p$))})}return l$}({},t$),this.useCompress=r$,this.tryDoubleDomain=n$,this.use443PortOnly=i$;let{timeout:s$,timeoutFactor:a$}=t$,c$=Math.max(300,Math.floor(3*s$/5)),u$=Math.max(1.2,Math.floor(8*a$)/10);wn.ONLINE&&(this.retryConfig.timeout=c$,this.retryConfig.timeoutFactor=u$),he.on(ks.NETWORK_STATE_CHANGE,(l$,d$)=>{l$!==d$&&(this.resetReconnectCount("network state change: ".concat(d$," -> ").concat(l$)),l$===wn.ONLINE?(this.retryConfig.timeout=c$,this.retryConfig.timeoutFactor=u$):(this.retryConfig.timeout=s$,this.retryConfig.timeoutFactor=a$))})}getConnection(){return this.websocket||void 0}async init(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r$=await this._initMutex.lock();this.forceCloseTimeout=t$,this.urls=e$,this.state="connecting";try{let n$=vc(),i$=this.urls[this.currentURLIndex];v("ENABLE_PREALLOC_PC")&&this.emit(PO.PRE_CONNECT_PC),this.createWebSocketConnection(i$).then(n$.resolve).catch(n$.reject),this.once(it.CLOSED,()=>{n$.reject(new N(R.WS_DISCONNECT))}),this.once(it.CONNECTED,n$.resolve),await n$.promise}catch{}finally{r$()}}close(e$,t$){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let r$=this.websocket;t$?setTimeout(()=>r$.close(),500):r$.close(),this.websocket=void 0}this.state=e$?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e$,t$){if(!this.websocket)return void _.warning("[".concat(this.name,"] can not reconnect, no websocket"));e$!==void 0&&(this.reconnectMode=e$),_.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t$)]},this.joinGatewayRecordIndex);let r$=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r$&&r$.bind(this.websocket)({code:9999,reason:t$})}sendMessage(e$){let t$=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new N(R.WS_ABORT,"websocket is not ready");try{t$||(e$=JSON.stringify(e$)),this.websocket.send(e$)}catch(r$){throw new N(R.WS_ERR,"send websocket message error"+r$.toString())}}setWsInflateData(e$){this.wsDeflateLength=this.wsDeflateLength+e$.originLength,this.wsInflateLength=this.wsInflateLength+e$.compressedLength}getWsInflateData(){let e$=this.wsInflateLength,t$=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e$,wsDeflateLength:t$}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e$){var t$;let r$=vc();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let n$=u$=>{var l$;(l$=this.store)===null||l$===void 0||l$.signalChannelOpen(),_.debug("[".concat(this.name,"] websocket opened:"),u$),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r$.resolve()},i$=async u$=>{var l$;if(_.debug("[".concat(this.name,"] websocket close ").concat((l$=this.websocket)===null||l$===void 0?void 0:l$.url,", code: ").concat(u$.code,", reason: ").concat(u$.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r$.reject(new N(R.WS_DISCONNECT,"websocket close: ".concat(u$.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=u$.reason,this.state="reconnecting");let d$=ni(this,it.WILL_RECONNECT,this.reconnectMode,u$.reason)||this.reconnectMode,h$=await this.reconnectWithAction(d$);if(this.state==="closed")return void _.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!h$)return r$.reject(new N(R.WS_DISCONNECT,"websocket reconnect failed: ".concat(u$.code))),this.close(!0);r$.resolve()}},o$=u$=>{this.emit(it.ON_MESSAGE,u$)},s$=u$=>{_.warn("[".concat(this.connectionID,"] ws open error ").concat(u$))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),v("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e$=v("GATEWAY_WSS_ADDRESS")),_.debug("[".concat(this.name,"] start connect, url:"),e$);let a$=(t$=this.store)===null||t$===void 0?void 0:t$.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var c$;let u$=await this.chooseBestWebsocketConnection(e$);this.websocket=u$,n$&&n$(this.websocket.url),this.websocket.onclose=i$,this.websocket.onmessage=o$,this.websocket.onerror=s$,(c$=this.store)===null||c$===void 0||c$.recordJoinChannelService({endTs:Date.now(),status:"success"},a$),this.joinGatewayRecordIndex=a$}catch(u$){let l$=this.state==="closed",d$=u$ instanceof N,h$=d$&&u$.code===R.WS_ABORT,p$=d$&&u$.code===R.WS_ERR,_$=d$?u$.message:u$&&(u$.reason||u$.toString());_.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(_$)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:h$?"aborted":"error",errors:[u$]},a$),l$||p$?(r$.reject(l$?new N(R.WS_DISCONNECT,"websocket is closed: ".concat(_$)):new N(R.WS_ERR,"init websocket failed: ".concat(_$))),p$&&_.error("[".concat(this.name,"] init websocket failed: ").concat(_$))):i$&&i$(u$)}return r$.promise}async reconnectWithAction(e$){let t$=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;_.warning("[choose-best-ws] action: =>",e$),this.onlineReconnectListener||he.isOnline||!he.onlineWaiter||(this.onlineReconnectListener=he.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r$=!0;if(this.reconnectInterrupter=()=>r$=!1,t$){let o$=hf(this.reconnectCount,this.retryConfig);_.debug("[".concat(this.name,"] wait ").concat(o$,"ms to reconnect websocket, mode: ").concat(e$)),await j.race([Me(o$),this.onlineReconnectListener||new j(()=>{})])}if(this._state==="closed"||!r$)return!1;this.reconnectCount+=1;let n$=async(o$,s$)=>{this.emit(it.RECONNECT_CREATE_CONNECTION,s$),await this.createWebSocketConnection(o$)};try{if(e$==="retry")this.emit(it.RECONNECT_WAITTING_FINISH,e$),await n$(this.urls[this.currentURLIndex],e$);else if(e$==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);_.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(it.RECONNECT_WAITTING_FINISH,e$),await n$(this.urls[this.currentURLIndex],e$)}else e$==="recover"&&(_.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(it.RECONNECT_WAITTING_FINISH,e$),this.urls=await Ge(this,it.REQUEST_NEW_URLS),this.currentURLIndex=0,await n$(this.urls[this.currentURLIndex],e$))}catch(o$){var i$;_.error("[".concat(this.name,"] reconnect failed ").concat(o$&&o$.toString()));let s$=o$==null||(i$=o$.data)===null||i$===void 0?void 0:i$.desc;return Array.isArray(s$)&&W(s$).call(s$,"dynamic key expired")?(this.emit(it.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e$,t$)}return!0}},Nc=class extends ql{constructor(e$,t$){super(e$,t$,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e$,t$){let r$=vc(),n$=function(o$,s$){return new BE(o$,s$)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{_.debug("[choose-best-ws] close establishing websockets"),n$.closeAllWebsockets(),r$.reject(new N(R.WS_ABORT,"choose best websocket aborted"))};let i$=v("GATEWAY_DOMAINS");return _.debug("[choose-best-ws] currentDomain: ",e$,", domains: ",i$,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),n$.chooseBestWebsocket(e$,this.tryDoubleDomain,this.use443PortOnly,t$).then(r$.resolve).catch(r$.reject),r$.promise.finally(()=>{this.closeEstablishingWs=void 0})}},Qo=class extends ql{constructor(e$,t$){super(e$,t$,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e$,t$){return new j((r$,n$)=>{let i$=!1,o$=[];this.closeEstablishingWs=()=>{_.debug("[choose-best-ws] close establishing websockets"),o$.forEach(p$=>{p$.onclose=null,p$.onopen=null,p$.onmessage=null,p$.close()}),n$(new N(R.WS_ABORT,"choose best websocket aborted"))};let s$=v("GATEWAY_DOMAINS"),a$,c$=e$.indexOf("?h="),u$=s$.find(p$=>c$!==-1?W(e$).call(e$,p$,c$):W(e$).call(e$,p$));_.debug("[choose-best-ws] currentDomain: ",u$,", domains: ",s$);let l$=!this.tryDoubleDomain||!u$;if(!l$&&u$){var d$;let p$=Date.now();try{s$.forEach(_$=>{let f$=c$===-1?e$.replace(u$,_$):e$.substr(0,c$)+e$.substr(c$).replace(u$,_$),m$=new WebSocket(f$);m$.binaryType="arraybuffer",o$.push(m$),_.debug("[choose-best-ws] ws is connecting:",m$.url)})}catch{for(_.debug("[choose-best-ws] ws create failed, fallback to single url"),o$.forEach(_$=>_$.close());o$.length;)o$.pop();l$=!0}(d$=this.store)===null||d$===void 0||d$.recordJoinChannelService({urls:o$.map(_$=>_$.url),service:"gateway"},t$),o$.forEach(_$=>{_$.onopen=()=>{if(i$)return;let f$=Date.now()-p$;_.debug("[choose-best-ws] ws open cost ".concat(f$,"ms")),o$.filter(m$=>m$!==_$).forEach(m$=>{_.debug("[choose-best-ws]close backup websocket: ".concat(m$.url)),m$.close()}),i$=!0,r$(_$)},_$.onclose=f$=>{a$=f$,!i$&&(o$.find(m$=>!(m$.readyState===WebSocket.CLOSED||m$.readyState===WebSocket.CLOSING))||(_.debug("[choose-best-ws] all websocket is closed"),i$=!0,n$(a$)))},_$.onmessage=f$=>{_.debug("[choose-best-ws]".concat(_$.url," onmessage: ").concat(f$.data))}}),Me(this.forceCloseTimeout).then(()=>{o$.forEach(_$=>{_$.readyState!==WebSocket.OPEN&&_$.close()})})}if(l$){var h$;let p$;_.debug("[choose-best-ws] use single url: ",e$),(h$=this.store)===null||h$===void 0||h$.recordJoinChannelService({urls:[e$],service:"gateway"},t$);try{p$=new WebSocket(e$),o$.push(p$),p$.binaryType="arraybuffer"}catch(_$){let f$=new N(R.WS_ERR,"init websocket failed! Error: ".concat(_$.toString()));return _.error("[".concat(this.name,"]").concat(f$)),void n$(f$)}p$.onopen=()=>{r$(p$)},p$.onclose=_$=>{n$(_$)},p$.onmessage=_$=>{_.debug("[choose-best-ws]".concat(p$.url," onmessage: ").concat(_$.data))},Me(this.forceCloseTimeout).then(()=>{p$&&p$.readyState!==WebSocket.OPEN&&p$.close()})}}).then(r$=>(this.closeEstablishingWs=void 0,r$)).catch(r$=>{throw this.closeEstablishingWs=void 0,r$})}},jE=class extends Xt{get connectionState(){return this._connectionState}set connectionState(e$){e$!==this._connectionState&&(this._connectionState=e$,e$===Lt.CONNECTED?this.emit(nt.WS_CONNECTED):e$===Lt.RECONNECTING?this.emit(nt.WS_RECONNECTING,this._websocketReconnectReason):e$===Lt.CLOSED&&this.emit(nt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e$,t$){super(),T(this,"_disconnectedReason",void 0),T(this,"_websocketReconnectReason",void 0),T(this,"_connectionState",Lt.CLOSED),T(this,"reconnectToken",void 0),T(this,"websocket",void 0),T(this,"openConnectionTime",void 0),T(this,"clientId",void 0),T(this,"lastMsgTime",Date.now()),T(this,"uploadCache",[]),T(this,"uploadCacheInterval",void 0),T(this,"rttRolling",new Hl(5)),T(this,"pingpongTimer",void 0),T(this,"wsInflateDataTimer",void 0),T(this,"pingpongTimeoutCount",0),T(this,"joinResponse",void 0),T(this,"multiIpOption",void 0),T(this,"initError",void 0),T(this,"spec",void 0),T(this,"store",void 0),T(this,"onWebsocketMessage",r$=>{if(r$.data instanceof ArrayBuffer)return void this.emit(nt.ON_BINARY_DATA,r$.data);let n$=JSON.parse(r$.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(n$,"_id")){let i$="res-@".concat(n$._id);this.emit(i$,n$._result,n$._message)}else if(Object.prototype.hasOwnProperty.call(n$,"_type")){if(this.emit(n$._type,n$._message),n$._type===dt.ON_NOTIFICATION&&this.handleNotification(n$._message),n$._type===dt.ON_USER_BANNED)switch(n$._message.error_code){case 14:this.close(At.UID_BANNED);break;case 15:this.close(At.IP_BANNED);break;case 16:this.close(At.CHANNEL_BANNED)}if(n$._type===dt.ON_USER_LICENSE_BANNED)switch(n$._message.error_code){case Z.ERR_LICENSE_MISSING:this.close(At.LICENSE_MISSING);break;case Z.ERR_LICENSE_EXPIRED:this.close(At.LICENSE_EXPIRED);break;case Z.ERR_LICENSE_MINUTES_EXCEEDED:this.close(At.LICENSE_MINUTES_EXCEEDED);break;case Z.ERR_LICENSE_PERIOD_INVALID:this.close(At.LICENSE_PERIOD_INVALID);break;case Z.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(At.LICENSE_MULTIPLE_SDK_SERVICE);break;case Z.ERR_LICENSE_ILLEGAL:this.close(At.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e$.clientId,this.spec=e$,this.store=t$,this.websocket=new Nc("gateway-".concat(this.clientId),this.spec.retryConfig,!0,v("JOIN_GATEWAY_USE_DUAL_DOMAIN"),v("JOIN_GATEWAY_USE_443PORT_ONLY"),t$),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Lt.CONNECTED&&this.reconnect("retry",Be.OFFLINE)})}async request(e$,t$,r$,n$){let i$=Ut(6,""),o$={_id:i$,_type:e$,_message:t$},s$=this.websocket.connectionID,a$=()=>new j((p$,_$)=>{if(this.connectionState===Lt.CONNECTED)return p$();let f$=()=>{this.off(nt.WS_CLOSED,m$),p$()},m$=()=>{this.off(nt.WS_CONNECTED,f$),_$(new O(R.WS_ABORT))};this.once(nt.WS_CONNECTED,f$),this.once(nt.WS_CLOSED,m$),e$!==et.PUBLISH&&e$!==et.PUBLISH_DATASTREAM&&e$!==et.SUBSCRIBE&&e$!==et.SUBSCRIBE_DATASTREAM&&e$!==et.UNSUBSCRIBE&&e$!==et.UNSUBSCRIBE_DATASTREAM&&e$!==et.UNPUBLISH&&e$!==et.UNPUBLISH_DATASTREAM&&e$!==et.CONTROL&&e$!==et.RESTART_ICE||this.once(nt.DISCONNECT_P2P,()=>{_$(new O(R.DISCONNECT_P2P))}),e$!==et.PUBLISH&&e$!==et.RESTART_ICE||this.once(nt.ABORT_P2P_EXECUTION,()=>{_$(new O(R.DISCONNECT_P2P))})});if(this.connectionState!==Lt.CONNECTING&&this.connectionState!==Lt.RECONNECTING||e$===et.JOIN||e$===et.REJOIN||await a$(),this.websocket.sendMessage(o$,!0),n$)return;let c$=new j((p$,_$)=>{let f$=!1,m$=(v$,y$)=>{f$=!0,p$({isSuccess:v$==="success",message:y$||{}}),this.off(nt.WS_CLOSED,g$),this.off(nt.WS_RECONNECTING,g$),this.emit(nt.REQUEST_SUCCESS,e$,t$)};this.once("res-@".concat(i$),m$);let g$=()=>{_$(new O(R.WS_ABORT,"type: ".concat(e$))),this.off(nt.WS_CLOSED,g$),this.off(nt.WS_RECONNECTING,g$),this.off("res-@".concat(i$),m$)};this.once(nt.WS_CLOSED,g$),this.once(nt.WS_RECONNECTING,g$),Me(v("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==s$||f$||(_.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e$)),this.emit(nt.REQUEST_TIMEOUT,e$,t$))})}),u$=null;try{u$=await c$}catch(p$){if(this.connectionState===Lt.CLOSED||e$===et.LEAVE)throw new O(R.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r$?p$.throw():e$===et.JOIN||e$===et.REJOIN?null:(await a$(),await this.request(e$,t$))}if(u$.isSuccess)return u$.message;let l$=Number(u$.message.error_code||u$.message.code),d$=Oc(l$),h$=new O(R.UNEXPECTED_RESPONSE,"".concat(d$.desc,": ").concat(u$.message.error_str),{code:l$,data:u$.message,desc:d$.desc});return d$.action==="success"?u$.message:(_.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e$,", error_code: ").concat(l$,", message: ").concat(d$.desc,", action: ").concat(d$.action)),l$===Z.ERR_TOO_MANY_BROADCASTERS?((e$===et.JOIN||e$===et.REJOIN)&&(this.initError=h$,this.close()),h$.throw()):d$.action==="failed"?h$.throw():d$.action==="quit"?(this.initError=h$,this.close(),h$.throw()):(l$===Z.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=u$.message.option,_.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Be.MULTI_IP)):this.reconnect(d$.action,Be.SERVER_ERROR),e$===et.JOIN||e$===et.REJOIN?null:await this.request(e$,t$)))}waitMessage(e$,t$){return new j(r$=>{let n$=i$=>{(!t$||t$(i$))&&(this.off(e$,n$),r$(i$))};this.on(e$,n$)})}uploadWRTCStats(e$){if(!this.store.sessionId)return void _.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t$={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e$};this.upload(wc.WRTC_STATS,t$)}upload(e$,t$){let r$={_type:e$,_message:t$};try{this.websocket.sendMessage(r$)}catch{let n$=v("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r$),this.uploadCache.length>n$&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Lt.CONNECTED)return;let i$=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(i$._type,i$._message)},v("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e$,t$){let r$={_type:e$,_message:t$};this.websocket.sendMessage(r$)}init(e$,t$){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new j((r$,n$)=>{this.once(nt.WS_CONNECTED,()=>r$(this.joinResponse)),this.once(nt.WS_CLOSED,()=>n$(this.initError||new O(R.WS_ABORT))),this.connectionState=Lt.CONNECTING,this.websocket.init(e$).catch(n$),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e$){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e$||At.LEAVE,this.connectionState=Lt.CLOSED,_.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(nt.ABORT_P2P_EXECUTION);let e$=await Ge(this,nt.REQUEST_JOIN_INFO),t$=await this.request(et.JOIN,e$);if(!t$)return this.emit(nt.REPORT_JOIN_GATEWAY,Tl.TIMEOUT,this.url||""),!1;this.joinResponse=t$,this.emit(nt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Lt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new O(R.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let e$=Ac(this,nt.REQUEST_REJOIN_INFO);e$.token=this.reconnectToken;let t$=await this.request(et.REJOIN,e$);return!!t$&&(this.connectionState=Lt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t$.peers&&t$.peers.forEach(r$=>{this.emit(dt.ON_USER_ONLINE,{uid:r$.uid}),r$.audio&&this.emit(dt.ON_ADD_AUDIO_STREAM,{uid:r$.uid,uint_id:r$.uint_id,audio:!0,ssrcId:r$.audio_ssrc}),r$.video&&this.emit(dt.ON_ADD_VIDEO_STREAM,{uid:r$.uid,uint_id:r$.uint_id,video:!0,ssrcId:r$.video_ssrc}),r$.audio_mute?this.emit(dt.MUTE_AUDIO,{uid:r$.uid}):this.emit(dt.UNMUTE_AUDIO,{uid:r$.uid}),r$.video_mute?this.emit(dt.MUTE_VIDEO,{uid:r$.uid}):this.emit(dt.UNMUTE_VIDEO,{uid:r$.uid}),r$.audio_enable_local?this.emit(dt.ENABLE_LOCAL_AUDIO,{uid:r$.uid}):this.emit(dt.DISABLE_LOCAL_AUDIO,{uid:r$.uid}),r$.video_enable_local?this.emit(dt.ENABLE_LOCAL_VIDEO,{uid:r$.uid}):this.emit(dt.DISABLE_LOCAL_VIDEO,{uid:r$.uid}),r$.audio||r$.video||this.emit(dt.ON_REMOVE_STREAM,{uid:r$.uid,uint_id:r$.uint_id})}),!0)}reconnect(e$,t$){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e$,t$)}handleNotification(e$){_.debug("[".concat(this.clientId,"] receive notification: "),e$);let t$=Oc(e$.code);if(t$.action!=="success"){if(t$.action!=="failed")return t$.action==="quit"?(t$.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(At.UID_BANNED),void this.close()):void this.reconnect(t$.action,Be.SERVER_ERROR);_.error("[".concat(this.clientId,"] ignore error: "),t$.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e$=v("PING_PONG_TIME_OUT"),t$=Date.now();this.pingpongTimeoutCount>=e$&&(_.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t$-this.lastMsgTime,"ms")),t$-this.lastMsgTime>v("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Be.TIMEOUT):this.request(et.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let r$=Date.now()-t$;this.rttRolling.add(r$),v("REPORT_STATS")&&this.send(et.PING_BACK,{pingpongElapse:r$})}).catch(r$=>{})}handleWsInflateData(){let{wsInflateLength:e$,wsDeflateLength:t$}=this.websocket.getWsInflateData();e$!==0&&t$!==0&&this.upload(wc.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t$,ws_inflate_length:e$})}handleWebsocketEvents(){this.websocket.on(it.RECONNECT_WAITTING_FINISH,e$=>{this.emit(nt.WS_RECONNECT_WAITTING_FINISH,e$)}),this.websocket.on(it.RECONNECT_CREATE_CONNECTION,e$=>{this.emit(nt.WS_RECONNECT_CREATE_CONNECTION,e$)}),this.websocket.on(it.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(it.CLOSED,()=>{this.connectionState=Lt.CLOSED}),this.websocket.on(it.FAILED,()=>{this._disconnectedReason=At.NETWORK_ERROR,this.connectionState=Lt.CLOSED}),this.websocket.on(it.RECONNECTING,e$=>{this._websocketReconnectReason=e$,this.joinResponse=void 0,this.connectionState===Lt.CONNECTED?this.connectionState=Lt.RECONNECTING:this.connectionState=Lt.CONNECTING}),this.websocket.on(it.WILL_RECONNECT,(e$,t$,r$)=>{let n$=Ac(this,nt.IS_P2P_DISCONNECTED),i$=n$||e$!=="retry";n$&&e$==="retry"&&(_.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e$="tryNext",t$=Tl.P2P_DISCONNECTED),i$&&(_.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e$)),this.emit(nt.REPORT_JOIN_GATEWAY,t$||Tl.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(nt.DISCONNECT_P2P)),r$(e$)}),this.websocket.on(it.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e$=>{_.warning("[".concat(this.clientId,"] rejoin failed ").concat(e$)),this.reconnect("tryNext",Be.SERVER_ERROR)}):this.join().catch(e$=>{if(this.emit(nt.REPORT_JOIN_GATEWAY,e$,this.url||""),e$ instanceof O){if(e$.code===R.UNEXPECTED_RESPONSE&&e$.data.code===Z.ERR_NO_AUTHORIZED)return this.initError=new O(R.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),_.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Be.SERVER_ERROR);_.error("[".concat(this.clientId,"] join gateway request failed"),e$.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Be.SERVER_ERROR):(this.initError=e$,this.close())}})}),this.websocket.on(it.REQUEST_NEW_URLS,(e$,t$)=>{Ge(this,nt.REQUEST_RECOVER,this.multiIpOption).then(e$).catch(t$)}),this.websocket.on(it.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(PO.PRE_CONNECT_PC,()=>{this.emit(nt.PRE_CONNECT_PC)})}},ue=function(e$){return e$[e$.CHOOSE_SERVER=11]="CHOOSE_SERVER",e$[e$.CLOUD_PROXY=18]="CLOUD_PROXY",e$[e$.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e$[e$.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e$}({});function jR(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function kd(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?jR(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):jR(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}function Us(e$){return e$.match(/^[\.\:\d]+$/)?"".concat(e$.replace(/[^\d]/g,"-"),".").concat(v("TURN_DOMAIN")):(_.info("Unidentified as ip: ".concat(e$,", use as host")),e$)}function mf(e$,t$){e$.addresses||(e$.addresses=[]);let r$=function(a$,c$){if(v("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return a$.map(d$=>{let{ip:h$,port:p$}=d$;return{address:"".concat(h$,":").concat(p$)}});let u$=v("GATEWAY_DOMAINS"),l$=u$[1]&&W(c$).call(c$,u$[1])?1:0;return a$.map(d$=>{let{domain_prefix:h$,port:p$,ip:_$}=d$;if(h$)return{address:"".concat(h$,".").concat(u$[l$++%u$.length],":").concat(p$)};let f$=/^[\.\:\d]+$/.test(_$),m$=f$?"".concat(_$.replace(/[^\d]/g,"-"),".").concat(u$[l$++%u$.length],":").concat(p$):"".concat(_$,":").concat(p$);return f$||_.info("Unidentified as ip: ".concat(_$,", use as host")),{ip:_$,port:p$,address:m$}})}(e$.addresses,t$),n$=Array.isArray(e$.detail)&&e$.detail[18];if(n$&&typeof n$=="string"){let a$=n$.split(";");for(let c$=0;c$<a$.length;c$++){var i$;let u$=rn(i$=a$[c$]).call(i$);r$[c$]&&u$&&(r$[c$].ip6=u$)}}let o$=e$.detail&&e$.detail.candidate,s$;if(o$){let[a$,c$]=o$.split(":");a$&&c$&&(s$={port:Number(c$),ip:a$,address:"".concat(a$,":").concat(c$)})}return{gatewayAddrs:r$,apGatewayAddress:s$,uid:e$.uid,cid:e$.cid,cert:e$.cert,vid:e$.detail&&e$.detail[8],uni_lbs_ip:e$.detail&&e$.detail[1],res:e$,csIp:e$.detail&&e$.detail[502]}}function Nn(e$){return typeof e$=="number"?e$:e$.exact||e$.ideal||e$.max||e$.min||0}function GR(e$){let t$=e$._encoderConfig;if(!t$)return{};let r$={resolution:t$.width&&t$.height?"".concat(Nn(t$.width),"x").concat(Nn(t$.height)):void 0,maxVideoBW:t$.bitrateMax,minVideoBW:t$.bitrateMin};return typeof t$.frameRate=="number"?(r$.maxFrameRate=t$.frameRate,r$.minFrameRate=t$.frameRate):t$.frameRate&&(r$.maxFrameRate=t$.frameRate.max||t$.frameRate.ideal||t$.frameRate.exact||t$.frameRate.min,r$.minFrameRate=t$.frameRate.min||t$.frameRate.ideal||t$.frameRate.exact||t$.frameRate.max),r$}function WR(e$){return e$>=0&&e$<.17?1:e$>=.17&&e$<.36?2:e$>=.36&&e$<.59?3:e$>=.59&&e$<=1?4:e$>1?5:0}function Dc(e$,t$){let r$,n$,i$;switch(t$){case ue.CHOOSE_SERVER:n$=4096,i$="choose server";break;case ue.CLOUD_PROXY:n$=1048576,i$="proxy";break;case ue.CLOUD_PROXY_5:n$=4194304,i$="proxy5";break;case ue.CLOUD_PROXY_FALLBACK:n$=4194310,i$="proxy fallback";break;default:throw new O(R.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e$.detail&&e$.detail[502],retry:!1})}if(e$.response_body.forEach(o$=>{o$.buffer&&o$.buffer.flag===n$&&(r$={code:o$.buffer.code,addresses:(o$.buffer.edges_services||[]).map(s$=>kd(kd({},s$),{},{ticket:o$.buffer.cert})),server_ts:e$.enter_ts,uid:o$.buffer.uid,cid:o$.buffer.cid,cname:o$.buffer.cname,detail:kd(kd({},o$.buffer.detail),e$.detail),flag:o$.buffer.flag,opid:e$.opid,cert:o$.buffer.cert})}),!r$)throw new O(R.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i$," from multi unilbs response"),{csIp:e$.detail&&e$.detail[502]});return r$}async function kO(e$,t$){return await j.all(e$.addresses.map(async r$=>({address:Us(r$.ip),tcpport:r$.port,udpport:r$.port,username:t$&&v("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t$.toString():Ve.username,password:t$&&v("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await PE(t$.toString()):Ve.password})))}function GE(e$,t$){let r$=t$.getMediaStreamTrack(!0).getSettings(),n$=t$.videoHeight||r$.height,i$=t$.videoWidth||r$.width;return n$&&i$?Math.max(Math.min(n$,i$)/Math.min(Nn(e$.height),Nn(e$.width)),1):(_.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function eo(e$){let{candidateType:t$,relayProtocol:r$,type:n$,address:i$,port:o$,protocol:s$}=e$;return n$==="local-candidate"?{candidateType:t$,relayProtocol:r$,protocol:s$}:{candidateType:t$,relayProtocol:r$,address:i$,port:o$,protocol:s$}}var li,mj=ae(DO),fj=bi("Array").values,gj=Er,Tj=Je,Sj=hn,Rj=fj,Fp=Array.prototype,Cj={DOMTokenList:!0,NodeList:!0},Ij=function(e$){var t$=e$.values;return e$===Fp||Sj(Fp,e$)&&t$===Fp.values||Tj(Cj,gj(e$))?Rj:t$},Pr=ae(Ij),HR=ri,vj=me,yj=Ke,Aj=Se,Bp=Lu,bj=Xc,wj=Au,Oj=_r,Nj=bu,_s=Object.assign,KR=Object.defineProperty,Dj=vj([].concat),Pj=!_s||Aj(function(){if(HR&&_s({b:1},_s(KR({},"a",{enumerable:!0,get:function(){KR(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e$={},t$={},r$=Symbol(),n$="abcdefghijklmnopqrst";return e$[r$]=7,n$.split("").forEach(function(i$){t$[i$]=i$}),_s({},e$)[r$]!=7||Bp(_s({},t$)).join("")!=n$})?function(e$,t$){for(var r$=Oj(e$),n$=arguments.length,i$=1,o$=bj.f,s$=wj.f;n$>i$;)for(var a$,c$=Nj(arguments[i$++]),u$=o$?Dj(Bp(c$),o$(c$)):Bp(c$),l$=u$.length,d$=0;l$>d$;)a$=u$[d$++],HR&&!yj(s$,c$,a$)||(r$[a$]=c$[a$]);return r$}:_s,kj=Cn,Lj=XA,Mj=mo,Uj=Ke,xj=_r,Vj=function(e$,t$,r$,n$){try{return n$?t$(kj(r$)[0],r$[1]):t$(r$)}catch(i$){Lj(e$,"throw",i$)}},Fj=JA,Bj=xu,jj=Lr,YR=Bu,Gj=Um,Wj=Mu,qR=Array,is=me,jp=2147483647,Hj=/[^\0-\u007E]/,LO=/[.\u3002\uFF0E\uFF61]/g,zR="Overflow: input needs wider integers to process",JR=RangeError,Kj=is(LO.exec),xs=Math.floor,Gp=String.fromCharCode,XR=is("".charCodeAt),MO=is([].join),qr=is([].push),Yj=is("".replace),qj=is("".split),zj=is("".toLowerCase),QR=function(e$){return e$+22+75*(e$<26)},Jj=function(e$,t$,r$){var n$=0;for(e$=r$?xs(e$/700):e$>>1,e$+=xs(e$/t$);e$>455;)e$=xs(e$/35),n$+=36;return xs(n$+36*e$/(e$+38))},Xj=function(e$){var t$=[];e$=function(g$){for(var v$=[],y$=0,S$=g$.length;y$<S$;){var b$=XR(g$,y$++);if(b$>=55296&&b$<=56319&&y$<S$){var $$=XR(g$,y$++);(64512&$$)==56320?qr(v$,((1023&b$)<<10)+(1023&$$)+65536):(qr(v$,b$),y$--)}else qr(v$,b$)}return v$}(e$);var r$,n$,i$=e$.length,o$=128,s$=0,a$=72;for(r$=0;r$<e$.length;r$++)(n$=e$[r$])<128&&qr(t$,Gp(n$));var c$=t$.length,u$=c$;for(c$&&qr(t$,"-");u$<i$;){var l$=jp;for(r$=0;r$<e$.length;r$++)(n$=e$[r$])>=o$&&n$<l$&&(l$=n$);var d$=u$+1;if(l$-o$>xs((jp-s$)/d$))throw JR(zR);for(s$+=(l$-o$)*d$,o$=l$,r$=0;r$<e$.length;r$++){if((n$=e$[r$])<o$&&++s$>jp)throw JR(zR);if(n$==o$){for(var h$=s$,p$=36;;){var _$=p$<=a$?1:p$>=a$+26?26:p$-a$;if(h$<_$)break;var f$=h$-_$,m$=36-_$;qr(t$,Gp(QR(_$+f$%m$))),h$=xs(f$/m$),p$+=36}qr(t$,Gp(QR(h$))),a$=Jj(s$,d$,u$==c$),s$=0,u$++}}s$++,o$++}return MO(t$,"")},Qj=xt,ff=ri,Zj=rf,gf=We,ZR=mo,wi=me,Ld=go,ui=Uu,$j=Fm,WE=Je,Tf=Pj,Es=function(e$){var t$=xj(e$),r$=Bj(this),n$=arguments.length,i$=n$>1?arguments[1]:void 0,o$=i$!==void 0;o$&&(i$=Mj(i$,n$>2?arguments[2]:void 0));var s$,a$,c$,u$,l$,d$,h$=Wj(t$),p$=0;if(!h$||this===qR&&Fj(h$))for(s$=jj(t$),a$=r$?new this(s$):qR(s$);s$>p$;p$++)d$=o$?i$(t$[p$],p$):t$[p$],YR(a$,p$,d$);else for(l$=(u$=Gj(t$,h$)).next,a$=r$?new this:[];!(c$=Uj(l$,u$)).done;p$++)d$=o$?Vj(u$,i$,[c$.value,p$],!0):c$.value,YR(a$,p$,d$);return a$.length=p$,a$},Di=zm,tG=qm.codeAt,eG=function(e$){var t$,r$,n$=[],i$=qj(Yj(zj(e$),LO,"."),".");for(t$=0;t$<i$.length;t$++)r$=i$[t$],qr(n$,Kj(Hj,r$)?"xn--"+Xj(r$):r$);return MO(n$,".")},vr=oi,nG=To,iG=Vu,UO=yF,xO=ns,rG=xO.set,zl=xO.getterFor("URL"),oG=UO.URLSearchParams,sG=UO.getState,La=gf.URL,HE=gf.TypeError,Md=gf.parseInt,aG=Math.floor,$R=Math.pow,Ti=wi("".charAt),Li=wi(/./.exec),Ya=wi([].join),cG=wi(1 .toString),dG=wi([].pop),ms=wi([].push),Wp=wi("".replace),lG=wi([].shift),uG=wi("".split),qa=wi("".slice),Sl=wi("".toLowerCase),hG=wi([].unshift),Hp="Invalid scheme",vo="Invalid host",tC="Invalid port",VO=/[a-z]/i,pG=/[\d+-.a-z]/i,Kp=/\d/,_G=/^0x/i,EG=/^[0-7]+$/,mG=/^\d+$/,eC=/^[\da-f]+$/i,fG=/[\0\t\n\r #%/:<>?@[\\\]^|]/,gG=/[\0\t\n\r #/:<>?@[\\\]^|]/,TG=/^[\u0000-\u0020]+/,SG=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,RG=/[\t\n\r]/g,Ma=function(e$){var t$,r$,n$,i$;if(typeof e$=="number"){for(t$=[],r$=0;r$<4;r$++)hG(t$,e$%256),e$=aG(e$/256);return Ya(t$,".")}if(typeof e$=="object"){for(t$="",n$=function(o$){for(var s$=null,a$=1,c$=null,u$=0,l$=0;l$<8;l$++)o$[l$]!==0?(u$>a$&&(s$=c$,a$=u$),c$=null,u$=0):(c$===null&&(c$=l$),++u$);return u$>a$&&(s$=c$,a$=u$),s$}(e$),r$=0;r$<8;r$++)i$&&e$[r$]===0||(i$&&(i$=!1),n$===r$?(t$+=r$?":":"::",i$=!0):(t$+=cG(e$[r$],16),r$<7&&(t$+=":")));return"["+t$+"]"}return e$},Rl={},FO=Tf({},Rl,{" ":1,'"':1,"<":1,">":1,"`":1}),BO=Tf({},FO,{"#":1,"?":1,"{":1,"}":1}),Yp=Tf({},BO,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Br=function(e$,t$){var r$=tG(e$,0);return r$>32&&r$<127&&!WE(t$,e$)?e$:encodeURIComponent(e$)},Ud={ftp:21,file:null,http:80,https:443,ws:80,wss:443},za=function(e$,t$){var r$;return e$.length==2&&Li(VO,Ti(e$,0))&&((r$=Ti(e$,1))==":"||!t$&&r$=="|")},nC=function(e$){var t$;return e$.length>1&&za(qa(e$,0,2))&&(e$.length==2||(t$=Ti(e$,2))==="/"||t$==="\\"||t$==="?"||t$==="#")},CG=function(e$){return e$==="."||Sl(e$)==="%2e"},qp={},iC={},zp={},rC={},oC={},Jp={},sC={},aC={},xd={},Vd={},Xp={},Qp={},Zp={},$p={},cC={},t_={},fs={},qi={},dC={},yo={},Sr={},Sf=function(e$,t$,r$){var n$,i$,o$,s$=vr(e$);if(t$){if(i$=this.parse(s$))throw HE(i$);this.searchParams=null}else{if(r$!==void 0&&(n$=new Sf(r$,!0)),i$=this.parse(s$,null,n$))throw HE(i$);(o$=sG(new oG)).bindURL(this),this.searchParams=o$}};Sf.prototype={type:"URL",parse:function(e$,t$,r$){var n$,i$,o$,s$,a$,c$=this,u$=t$||qp,l$=0,d$="",h$=!1,p$=!1,_$=!1;for(e$=vr(e$),t$||(c$.scheme="",c$.username="",c$.password="",c$.host=null,c$.port=null,c$.path=[],c$.query=null,c$.fragment=null,c$.cannotBeABaseURL=!1,e$=Wp(e$,TG,""),e$=Wp(e$,SG,"$1")),e$=Wp(e$,RG,""),n$=Es(e$);l$<=n$.length;){switch(i$=n$[l$],u$){case qp:if(!i$||!Li(VO,i$)){if(t$)return Hp;u$=zp;continue}d$+=Sl(i$),u$=iC;break;case iC:if(i$&&(Li(pG,i$)||i$=="+"||i$=="-"||i$=="."))d$+=Sl(i$);else{if(i$!=":"){if(t$)return Hp;d$="",u$=zp,l$=0;continue}if(t$&&(c$.isSpecial()!=WE(Ud,d$)||d$=="file"&&(c$.includesCredentials()||c$.port!==null)||c$.scheme=="file"&&!c$.host))return;if(c$.scheme=d$,t$)return void(c$.isSpecial()&&Ud[c$.scheme]==c$.port&&(c$.port=null));d$="",c$.scheme=="file"?u$=$p:c$.isSpecial()&&r$&&r$.scheme==c$.scheme?u$=rC:c$.isSpecial()?u$=aC:n$[l$+1]=="/"?(u$=oC,l$++):(c$.cannotBeABaseURL=!0,ms(c$.path,""),u$=dC)}break;case zp:if(!r$||r$.cannotBeABaseURL&&i$!="#")return Hp;if(r$.cannotBeABaseURL&&i$=="#"){c$.scheme=r$.scheme,c$.path=Di(r$.path),c$.query=r$.query,c$.fragment="",c$.cannotBeABaseURL=!0,u$=Sr;break}u$=r$.scheme=="file"?$p:Jp;continue;case rC:if(i$!="/"||n$[l$+1]!="/"){u$=Jp;continue}u$=xd,l$++;break;case oC:if(i$=="/"){u$=Vd;break}u$=qi;continue;case Jp:if(c$.scheme=r$.scheme,i$==li)c$.username=r$.username,c$.password=r$.password,c$.host=r$.host,c$.port=r$.port,c$.path=Di(r$.path),c$.query=r$.query;else if(i$=="/"||i$=="\\"&&c$.isSpecial())u$=sC;else if(i$=="?")c$.username=r$.username,c$.password=r$.password,c$.host=r$.host,c$.port=r$.port,c$.path=Di(r$.path),c$.query="",u$=yo;else{if(i$!="#"){c$.username=r$.username,c$.password=r$.password,c$.host=r$.host,c$.port=r$.port,c$.path=Di(r$.path),c$.path.length--,u$=qi;continue}c$.username=r$.username,c$.password=r$.password,c$.host=r$.host,c$.port=r$.port,c$.path=Di(r$.path),c$.query=r$.query,c$.fragment="",u$=Sr}break;case sC:if(!c$.isSpecial()||i$!="/"&&i$!="\\"){if(i$!="/"){c$.username=r$.username,c$.password=r$.password,c$.host=r$.host,c$.port=r$.port,u$=qi;continue}u$=Vd}else u$=xd;break;case aC:if(u$=xd,i$!="/"||Ti(d$,l$+1)!="/")continue;l$++;break;case xd:if(i$!="/"&&i$!="\\"){u$=Vd;continue}break;case Vd:if(i$=="@"){h$&&(d$="%40"+d$),h$=!0,o$=Es(d$);for(var f$=0;f$<o$.length;f$++){var m$=o$[f$];if(m$!=":"||_$){var g$=Br(m$,Yp);_$?c$.password+=g$:c$.username+=g$}else _$=!0}d$=""}else if(i$==li||i$=="/"||i$=="?"||i$=="#"||i$=="\\"&&c$.isSpecial()){if(h$&&d$=="")return"Invalid authority";l$-=Es(d$).length+1,d$="",u$=Xp}else d$+=i$;break;case Xp:case Qp:if(t$&&c$.scheme=="file"){u$=t_;continue}if(i$!=":"||p$){if(i$==li||i$=="/"||i$=="?"||i$=="#"||i$=="\\"&&c$.isSpecial()){if(c$.isSpecial()&&d$=="")return vo;if(t$&&d$==""&&(c$.includesCredentials()||c$.port!==null))return;if(s$=c$.parseHost(d$))return s$;if(d$="",u$=fs,t$)return;continue}i$=="["?p$=!0:i$=="]"&&(p$=!1),d$+=i$}else{if(d$=="")return vo;if(s$=c$.parseHost(d$))return s$;if(d$="",u$=Zp,t$==Qp)return}break;case Zp:if(!Li(Kp,i$)){if(i$==li||i$=="/"||i$=="?"||i$=="#"||i$=="\\"&&c$.isSpecial()||t$){if(d$!=""){var v$=Md(d$,10);if(v$>65535)return tC;c$.port=c$.isSpecial()&&v$===Ud[c$.scheme]?null:v$,d$=""}if(t$)return;u$=fs;continue}return tC}d$+=i$;break;case $p:if(c$.scheme="file",i$=="/"||i$=="\\")u$=cC;else{if(!r$||r$.scheme!="file"){u$=qi;continue}if(i$==li)c$.host=r$.host,c$.path=Di(r$.path),c$.query=r$.query;else if(i$=="?")c$.host=r$.host,c$.path=Di(r$.path),c$.query="",u$=yo;else{if(i$!="#"){nC(Ya(Di(n$,l$),""))||(c$.host=r$.host,c$.path=Di(r$.path),c$.shortenPath()),u$=qi;continue}c$.host=r$.host,c$.path=Di(r$.path),c$.query=r$.query,c$.fragment="",u$=Sr}}break;case cC:if(i$=="/"||i$=="\\"){u$=t_;break}r$&&r$.scheme=="file"&&!nC(Ya(Di(n$,l$),""))&&(za(r$.path[0],!0)?ms(c$.path,r$.path[0]):c$.host=r$.host),u$=qi;continue;case t_:if(i$==li||i$=="/"||i$=="\\"||i$=="?"||i$=="#"){if(!t$&&za(d$))u$=qi;else if(d$==""){if(c$.host="",t$)return;u$=fs}else{if(s$=c$.parseHost(d$))return s$;if(c$.host=="localhost"&&(c$.host=""),t$)return;d$="",u$=fs}continue}d$+=i$;break;case fs:if(c$.isSpecial()){if(u$=qi,i$!="/"&&i$!="\\")continue}else if(t$||i$!="?")if(t$||i$!="#"){if(i$!=li&&(u$=qi,i$!="/"))continue}else c$.fragment="",u$=Sr;else c$.query="",u$=yo;break;case qi:if(i$==li||i$=="/"||i$=="\\"&&c$.isSpecial()||!t$&&(i$=="?"||i$=="#")){if((a$=Sl(a$=d$))===".."||a$==="%2e."||a$===".%2e"||a$==="%2e%2e"?(c$.shortenPath(),i$=="/"||i$=="\\"&&c$.isSpecial()||ms(c$.path,"")):CG(d$)?i$=="/"||i$=="\\"&&c$.isSpecial()||ms(c$.path,""):(c$.scheme=="file"&&!c$.path.length&&za(d$)&&(c$.host&&(c$.host=""),d$=Ti(d$,0)+":"),ms(c$.path,d$)),d$="",c$.scheme=="file"&&(i$==li||i$=="?"||i$=="#"))for(;c$.path.length>1&&c$.path[0]==="";)lG(c$.path);i$=="?"?(c$.query="",u$=yo):i$=="#"&&(c$.fragment="",u$=Sr)}else d$+=Br(i$,BO);break;case dC:i$=="?"?(c$.query="",u$=yo):i$=="#"?(c$.fragment="",u$=Sr):i$!=li&&(c$.path[0]+=Br(i$,Rl));break;case yo:t$||i$!="#"?i$!=li&&(i$=="'"&&c$.isSpecial()?c$.query+="%27":c$.query+=i$=="#"?"%23":Br(i$,Rl)):(c$.fragment="",u$=Sr);break;case Sr:i$!=li&&(c$.fragment+=Br(i$,FO))}l$++}},parseHost:function(e$){var t$,r$,n$;if(Ti(e$,0)=="["){if(Ti(e$,e$.length-1)!="]"||(t$=function(i$){var o$,s$,a$,c$,u$,l$,d$,h$=[0,0,0,0,0,0,0,0],p$=0,_$=null,f$=0,m$=function(){return Ti(i$,f$)};if(m$()==":"){if(Ti(i$,1)!=":")return;f$+=2,_$=++p$}for(;m$();){if(p$==8)return;if(m$()!=":"){for(o$=s$=0;s$<4&&Li(eC,m$());)o$=16*o$+Md(m$(),16),f$++,s$++;if(m$()=="."){if(s$==0||(f$-=s$,p$>6))return;for(a$=0;m$();){if(c$=null,a$>0){if(!(m$()=="."&&a$<4))return;f$++}if(!Li(Kp,m$()))return;for(;Li(Kp,m$());){if(u$=Md(m$(),10),c$===null)c$=u$;else{if(c$==0)return;c$=10*c$+u$}if(c$>255)return;f$++}h$[p$]=256*h$[p$]+c$,++a$!=2&&a$!=4||p$++}if(a$!=4)return;break}if(m$()==":"){if(f$++,!m$())return}else if(m$())return;h$[p$++]=o$}else{if(_$!==null)return;f$++,_$=++p$}}if(_$!==null)for(l$=p$-_$,p$=7;p$!=0&&l$>0;)d$=h$[p$],h$[p$--]=h$[_$+l$-1],h$[_$+--l$]=d$;else if(p$!=8)return;return h$}(qa(e$,1,-1)),!t$))return vo;this.host=t$}else if(this.isSpecial()){if(e$=eG(e$),Li(fG,e$)||(t$=function(i$){var o$,s$,a$,c$,u$,l$,d$,h$=uG(i$,".");if(h$.length&&h$[h$.length-1]==""&&h$.length--,(o$=h$.length)>4)return i$;for(s$=[],a$=0;a$<o$;a$++){if((c$=h$[a$])=="")return i$;if(u$=10,c$.length>1&&Ti(c$,0)=="0"&&(u$=Li(_G,c$)?16:8,c$=qa(c$,u$==8?1:2)),c$==="")l$=0;else{if(!Li(u$==10?mG:u$==8?EG:eC,c$))return i$;l$=Md(c$,u$)}ms(s$,l$)}for(a$=0;a$<o$;a$++)if(l$=s$[a$],a$==o$-1){if(l$>=$R(256,5-o$))return null}else if(l$>255)return null;for(d$=dG(s$),a$=0;a$<s$.length;a$++)d$+=s$[a$]*$R(256,3-a$);return d$}(e$),t$===null))return vo;this.host=t$}else{if(Li(gG,e$))return vo;for(t$="",r$=Es(e$),n$=0;n$<r$.length;n$++)t$+=Br(r$[n$],Rl);this.host=t$}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return WE(Ud,this.scheme)},shortenPath:function(){var e$=this.path,t$=e$.length;!t$||this.scheme=="file"&&t$==1&&za(e$[0],!0)||e$.length--},serialize:function(){var e$=this,t$=e$.scheme,r$=e$.username,n$=e$.password,i$=e$.host,o$=e$.port,s$=e$.path,a$=e$.query,c$=e$.fragment,u$=t$+":";return i$!==null?(u$+="//",e$.includesCredentials()&&(u$+=r$+(n$?":"+n$:"")+"@"),u$+=Ma(i$),o$!==null&&(u$+=":"+o$)):t$=="file"&&(u$+="//"),u$+=e$.cannotBeABaseURL?s$[0]:s$.length?"/"+Ya(s$,"/"):"",a$!==null&&(u$+="?"+a$),c$!==null&&(u$+="#"+c$),u$},setHref:function(e$){var t$=this.parse(e$);if(t$)throw HE(t$);this.searchParams.update()},getOrigin:function(){var e$=this.scheme,t$=this.port;if(e$=="blob")try{return new ea(e$.path[0]).origin}catch{return"null"}return e$!="file"&&this.isSpecial()?e$+"://"+Ma(this.host)+(t$!==null?":"+t$:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e$){this.parse(vr(e$)+":",qp)},getUsername:function(){return this.username},setUsername:function(e$){var t$=Es(vr(e$));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r$=0;r$<t$.length;r$++)this.username+=Br(t$[r$],Yp)}},getPassword:function(){return this.password},setPassword:function(e$){var t$=Es(vr(e$));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r$=0;r$<t$.length;r$++)this.password+=Br(t$[r$],Yp)}},getHost:function(){var e$=this.host,t$=this.port;return e$===null?"":t$===null?Ma(e$):Ma(e$)+":"+t$},setHost:function(e$){this.cannotBeABaseURL||this.parse(e$,Xp)},getHostname:function(){var e$=this.host;return e$===null?"":Ma(e$)},setHostname:function(e$){this.cannotBeABaseURL||this.parse(e$,Qp)},getPort:function(){var e$=this.port;return e$===null?"":vr(e$)},setPort:function(e$){this.cannotHaveUsernamePasswordPort()||((e$=vr(e$))==""?this.port=null:this.parse(e$,Zp))},getPathname:function(){var e$=this.path;return this.cannotBeABaseURL?e$[0]:e$.length?"/"+Ya(e$,"/"):""},setPathname:function(e$){this.cannotBeABaseURL||(this.path=[],this.parse(e$,fs))},getSearch:function(){var e$=this.query;return e$?"?"+e$:""},setSearch:function(e$){(e$=vr(e$))==""?this.query=null:(Ti(e$,0)=="?"&&(e$=qa(e$,1)),this.query="",this.parse(e$,yo)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e$=this.fragment;return e$?"#"+e$:""},setHash:function(e$){(e$=vr(e$))!=""?(Ti(e$,0)=="#"&&(e$=qa(e$,1)),this.fragment="",this.parse(e$,Sr)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var ea=function(e$){var t$=$j(this,yn),r$=iG(arguments.length,1)>1?arguments[1]:void 0,n$=rG(t$,new Sf(e$,!1,r$));ff||(t$.href=n$.serialize(),t$.origin=n$.getOrigin(),t$.protocol=n$.getProtocol(),t$.username=n$.getUsername(),t$.password=n$.getPassword(),t$.host=n$.getHost(),t$.hostname=n$.getHostname(),t$.port=n$.getPort(),t$.pathname=n$.getPathname(),t$.search=n$.getSearch(),t$.searchParams=n$.getSearchParams(),t$.hash=n$.getHash())},yn=ea.prototype,hi=function(e$,t$){return{get:function(){return zl(this)[e$]()},set:t$&&function(r$){return zl(this)[t$](r$)},configurable:!0,enumerable:!0}};ff&&(ui(yn,"href",hi("serialize","setHref")),ui(yn,"origin",hi("getOrigin")),ui(yn,"protocol",hi("getProtocol","setProtocol")),ui(yn,"username",hi("getUsername","setUsername")),ui(yn,"password",hi("getPassword","setPassword")),ui(yn,"host",hi("getHost","setHost")),ui(yn,"hostname",hi("getHostname","setHostname")),ui(yn,"port",hi("getPort","setPort")),ui(yn,"pathname",hi("getPathname","setPathname")),ui(yn,"search",hi("getSearch","setSearch")),ui(yn,"searchParams",hi("getSearchParams")),ui(yn,"hash",hi("getHash","setHash"))),Ld(yn,"toJSON",function(){return zl(this).serialize()},{enumerable:!0}),Ld(yn,"toString",function(){return zl(this).serialize()},{enumerable:!0}),La&&(e_=La.createObjectURL,n_=La.revokeObjectURL,e_&&Ld(ea,"createObjectURL",ZR(e_,La)),n_&&Ld(ea,"revokeObjectURL",ZR(n_,La)));var e_,n_;nG(ea,"URL"),Qj({global:!0,constructor:!0,forced:!Zj,sham:!ff},{URL:ea});var IG=xt,vG=Se,yG=Vu,lC=oi,AG=rf,uC=Dn("URL");IG({target:"URL",stat:!0,forced:!(AG&&vG(function(){uC.canParse()}))},{canParse:function(e$){var t$=yG(arguments.length,1),r$=lC(e$),n$=t$<2||arguments[1]===void 0?void 0:lC(arguments[1]);try{return!!new uC(r$,n$)}catch{return!1}}});var hC=ae(Gi.URL),Ne={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function ft(){return Ne}function jO(){return"setSinkId"in HTMLAudioElement.prototype&&(!v("RESTRICTION_SET_PLAYBACK_DEVICE")||(oo()||_O())&&!lf())}function pC(){return!Ne.supportUnifiedPlan||v("CHROME_FORCE_PLAN_B")&&ho()}var ke=function(e$){return e$.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e$.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e$.IOS_INTERRUPTION_START="ios-interruption-start",e$.IOS_INTERRUPTION_END="ios-interruption-end",e$.STATE_CHANGE="state-change",e$}({});function gs(e$,t$,r$){return{sampleRate:e$,stereo:t$,bitrate:r$}}function _t(e$,t$,r$,n$,i$){return{width:e$,height:t$,frameRate:r$,bitrateMin:n$,bitrateMax:i$}}function pi(e$,t$,r$,n$,i$){return{width:{max:e$},height:{max:t$},frameRate:r$,bitrateMin:n$,bitrateMax:i$}}function i_(e$,t$){return{numSpatialLayers:e$,numTemporalLayers:t$}}var bG={"90p":_t(160,90),"90p_1":_t(160,90),"120p":_t(160,120,15,30,65),"120p_1":_t(160,120,15,30,65),"120p_3":_t(120,120,15,30,50),"120p_4":_t(212,120),"180p":_t(320,180,15,30,140),"180p_1":_t(320,180,15,30,140),"180p_3":_t(180,180,15,30,100),"180p_4":_t(240,180,15,30,120),"240p":_t(320,240,15,40,200),"240p_1":_t(320,240,15,40,200),"240p_3":_t(240,240,15,40,140),"240p_4":_t(424,240,15,40,220),"360p":_t(640,360,15,80,400),"360p_1":_t(640,360,15,80,400),"360p_3":_t(360,360,15,80,260),"360p_4":_t(640,360,30,80,600),"360p_6":_t(360,360,30,80,400),"360p_7":_t(480,360,15,80,320),"360p_8":_t(480,360,30,80,490),"360p_9":_t(640,360,15,80,800),"360p_10":_t(640,360,24,80,800),"360p_11":_t(640,360,24,80,1e3),"480p":_t(640,480,15,100,500),"480p_1":_t(640,480,15,100,500),"480p_2":_t(640,480,30,100,1e3),"480p_3":_t(480,480,15,100,400),"480p_4":_t(640,480,30,100,750),"480p_6":_t(480,480,30,100,600),"480p_8":_t(848,480,15,100,610),"480p_9":_t(848,480,30,100,930),"480p_10":_t(640,480,10,100,400),"720p":_t(1280,720,15,120,1130),"720p_auto":_t(1280,720,30,900,3e3),"720p_1":_t(1280,720,15,120,1130),"720p_2":_t(1280,720,30,120,2e3),"720p_3":_t(1280,720,30,120,1710),"720p_5":_t(960,720,15,120,910),"720p_6":_t(960,720,30,120,1380),"1080p":_t(1920,1080,15,120,2080),"1080p_1":_t(1920,1080,15,120,2080),"1080p_2":_t(1920,1080,30,120,3e3),"1080p_3":_t(1920,1080,30,120,3150),"1080p_5":_t(1920,1080,60,120,4780),"1440p":_t(2560,1440,30,120,4850),"1440p_1":_t(2560,1440,30,120,4850),"1440p_2":_t(2560,1440,60,120,7350),"4k":_t(3840,2160,30,120,8910),"4k_1":_t(3840,2160,30,120,8910),"4k_3":_t(3840,2160,60,120,13500)},wG={"480p":pi(640,480,5),"480p_1":pi(640,480,5),"480p_2":pi(640,480,30),"480p_3":pi(640,480,15),"720p":pi(1280,720,5),"720p_auto":_t(1280,720,30,900,3e3),"720p_1":pi(1280,720,5),"720p_2":pi(1280,720,30),"720p_3":pi(1280,720,15),"1080p":pi(1920,1080,5),"1080p_1":pi(1920,1080,5),"1080p_2":pi(1920,1080,30),"1080p_3":pi(1920,1080,15)},OG={"1SL1TL":i_(1,1),"3SL3TL":i_(3,3),"2SL3TL":i_(2,3)};function cr(e$){return e$||(e$="480p_1"),typeof e$=="string"?Object.assign({},bG[e$]):e$}function r_(e$){return typeof e$=="string"?Object.assign({},wG[e$]):e$}function Fd(e$){return typeof e$=="string"?Object.assign({},OG[e$]):e$}var NG={speech_low_quality:gs(16e3,!1),speech_standard:gs(32e3,!1,18),music_standard:gs(48e3,!1),standard_stereo:gs(48e3,!0,56),high_quality:gs(48e3,!1,128),high_quality_stereo:gs(48e3,!0,192)};function Jl(e$){return typeof e$=="string"?Object.assign({},NG[e$]):e$}var As=[];function _C(e$){return Ce(e$,"mediaSource",["screen","window","application"]),!0}var H=function(e$){return e$.NEED_RENEGOTIATE="@need_renegotiate",e$.NEED_REPLACE_TRACK="@need_replace_track",e$.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e$.NEED_CLOSE="@need_close",e$.NEED_ENABLE_TRACK="@need_enable_track",e$.NEED_DISABLE_TRACK="@need_disable_track",e$.NEED_SESSION_ID="@need_sid",e$.SET_OPTIMIZATION_MODE="@set_optimization_mode",e$.GET_STATS="@get_stats",e$.GET_RTC_STATS="@get_rtc_stats",e$.GET_LOW_VIDEO_TRACK="@get_low_video_track",e$.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e$.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e$.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e$.NEED_MUTE_TRACK="@need_mute_track",e$.NEED_UNMUTE_TRACK="@need_unmute_track",e$}({}),Gt=function(e$){return e$.SCREEN_TRACK="screen_track",e$.CUSTOM_TRACK="custome_track",e$.LOW_STREAM="low_stream",e$}({}),na=function(e$){return e$[e$.HIGH_STREAM=0]="HIGH_STREAM",e$[e$.LOW_STREAM=1]="LOW_STREAM",e$}({}),DG=function(e$){return e$[e$.HIGH_STREAM=0]="HIGH_STREAM",e$[e$.LOW_STREAM=1]="LOW_STREAM",e$}({}),PG=function(e$){return e$[e$.DISABLE=0]="DISABLE",e$[e$.LOW_STREAM=1]="LOW_STREAM",e$[e$.AUDIO_ONLY=2]="AUDIO_ONLY",e$}({}),Ko=function(e$){return e$.TRANSCEIVER_UPDATED="transceiver-updated",e$.SEI_TO_SEND="sei-to-send",e$.SEI_RECEIVED="sei-received",e$.TRACK_UPDATED="track-updated",e$}({}),ma=function(e$){return e$.SOURCE_STATE_CHANGE="source-state-change",e$.TRACK_ENDED="track-ended",e$.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e$.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e$.CLOSED="closed",e$}({}),Ws=function(e$){return e$.FIRST_FRAME_DECODED="first-frame-decoded",e$.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e$.VIDEO_STATE_CHANGED="video-state-changed",e$}({}),fa=function(e$){return e$.AUDIO="audio",e$.VIDEO="video",e$.DATA="data",e$}({}),jn=function(e$){return e$.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e$.RECEIVE_TRACK_BUFFER="receive_track_buffer",e$.ON_AUDIO_BUFFER="on_audio_buffer",e$.UPDATE_SOURCE="update_source",e$}({});(function(e$){e$.UPDATE_TRACK_SOURCE="update-track-source"})({});var KE={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},YE={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},GO={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},kG={uplinkNetworkQuality:0,downlinkNetworkQuality:0},WO={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},un=function(e$){return e$.ON_TRACK="on_track",e$.ON_NODE="on_node",e$}({}),Wn=function(e$){return e$.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e$.REQUEST_CONSTRAINTS="request_constraints",e$}({}),Ua=function(e$){return e$.IDLE="IDLE",e$.INITING="INITING",e$.INITEND="INITEND",e$}({}),Bo=function(e$){return e$.STATE_CHANGE="state_change",e$.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e$.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e$.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e$}({}),nn=function(e$){return e$.NONE="none",e$.INIT="init",e$.CANPLAY="canplay",e$.PLAYING="playing",e$.PAUSED="paused",e$.SUSPEND="suspend",e$.STALLED="stalled",e$.WAITING="waiting",e$.ERROR="error",e$.DESTROYED="destroyed",e$.ABORT="abort",e$.ENDED="ended",e$.EMPTIED="emptied",e$.LOADEDDATA="loadeddata",e$}({}),zi=function(e$){return e$[e$.VideoStateStopped=0]="VideoStateStopped",e$[e$.VideoStateStarting=1]="VideoStateStarting",e$[e$.VideoStateDecoding=2]="VideoStateDecoding",e$[e$.VideoStateFrozen=3]="VideoStateFrozen",e$}({}),o_={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},Cl=function(e$){return e$.OPEN="open",e$.MESSAGE="message",e$.CLOSE="close",e$.CLOSING="closing",e$.ERROR="error",e$}({});function Et(e$,t$,r$,n$,i$){var o$,s$,a$={};return Object.keys(n$).forEach(function(c$){a$[c$]=n$[c$]}),a$.enumerable=!!a$.enumerable,a$.configurable=!!a$.configurable,("value"in a$||a$.initializer)&&(a$.writable=!0),a$=ji(o$=mj(s$=r$.slice()).call(s$)).call(o$,function(c$,u$){return u$(e$,t$,c$)||c$},a$),i$&&a$.initializer!==void 0&&(a$.value=a$.initializer?a$.initializer.call(i$):void 0,a$.initializer=void 0),a$.initializer===void 0&&(Object.defineProperty(e$,t$,a$),a$=null),a$}function P(e$,t$,r$){return(t$=function(n$){var i$=function(o$,s$){if(typeof o$!="object"||!o$)return o$;var a$=o$[Symbol.toPrimitive];if(a$!==void 0){var c$=a$.call(o$,"string");if(typeof c$!="object")return c$;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o$)}(n$);return typeof i$=="symbol"?i$:i$+""}(t$))in e$?Object.defineProperty(e$,t$,{value:r$,enumerable:!0,configurable:!0,writable:!0}):e$[t$]=r$,e$}function EC(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function Kt(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?EC(Object(r$),!0).forEach(function(n$){P(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):EC(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var Xl=class extends Xt{set _mediaStreamTrack(e$){e$!==this.mediaStreamTrack&&(this.safeEmit(Ko.TRACK_UPDATED,e$),this.mediaStreamTrack=e$)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e$,t$){super(),P(this,"trackMediaType",void 0),P(this,"_ID",void 0),P(this,"_rtpTransceiver",void 0),P(this,"_lowRtpTransceiver",void 0),P(this,"_hints",[]),P(this,"_isClosed",!1),P(this,"_originMediaStreamTrack",void 0),P(this,"mediaStreamTrack",void 0),P(this,"_external",{}),this._ID=t$||Ut(8,"track-"),this._originMediaStreamTrack=e$,this.mediaStreamTrack=e$,function(r$){W(As).call(As,r$)||As.push(r$)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e$){return e$||po(()=>{var t$;X.reportApiInvoke(null,{name:Te.GET_MEDIA_STREAM_TRACK,options:[],tag:Zt.TRACER}).onSuccess(((t$=this._mediaStreamTrack)===null||t$===void 0?void 0:t$.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e$){return e$===na.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e$){let t$=As.indexOf(e$);t$!==-1&&As.splice(t$,1)}(this),this.emit(ma.CLOSED),this.removeAllListeners(Ko.SEI_RECEIVED)}_updateRtpTransceiver(e$,t$){if(t$===na.LOW_STREAM){if(this._lowRtpTransceiver===e$)return;this._lowRtpTransceiver=e$}else{if(this._rtpTransceiver===e$)return;this._rtpTransceiver=e$}this.emit(Ko.TRANSCEIVER_UPDATED,e$,t$)}},no=class extends Xl{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e$,t$){super(e$,t$),P(this,"_enabled",!0),P(this,"_muted",!1),P(this,"_isExternalTrack",!1),P(this,"_isClosed",!1),P(this,"_enabledMutex",void 0),P(this,"processor",void 0),P(this,"_processorContext",void 0),P(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new ze("".concat(this.getTrackId())),e$.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e$,t$;return(e$=(t$=this._originMediaStreamTrack)===null||t$===void 0?void 0:t$.label)!==null&&e$!==void 0?e$:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,_.debug("[".concat(this.getTrackId(),"] close")),this.emit(H.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e$,t$){let r$=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r$,e$!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t$&&this._originMediaStreamTrack.stop()),e$.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e$,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await kt(this,H.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){_.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ma.TRACK_ENDED)}stateCheck(e$,t$){if(_.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e$,": ").concat(t$,"]")),Nr(t$,e$),this._enabled&&this._muted&&e$==="enabled"&&t$===!1)throw new N(R.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",_);if(!this._enabled&&!this._muted&&e$==="muted"&&t$===!0)throw new N(R.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",_)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():j.resolve([])}},mC=window.AudioContext||window.webkitAudioContext,Mn=null,wt=new class extends Xt{constructor(){super(...arguments),P(this,"prevState",void 0),P(this,"curState",void 0),P(this,"currentTime",void 0),P(this,"currentTimeStuckAt",void 0),P(this,"interruptDetectorTrack",void 0),P(this,"onLocalAudioTrackMute",()=>{_.info("ios15-interruption-start"),this.emit(ke.IOS_15_16_INTERRUPTION_START)}),P(this,"onLocalAudioTrackUnmute",async()=>{_.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?_.info("ios15-interruption-end-canceled"):(Mn&&await Mn.suspend(),this.emit(ke.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e$){_.debug("webaudio bindInterruptDetectorTrack ".concat(e$.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e$,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e$){_.debug("webaudio unbindInterruptDetectorTrack ".concat(e$.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e$&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function ga(){if(!Mn){if(function(){if(!mC)return void _.error("your browser is not support web audio");_.info("create audio context");let e$=Kt({},v("WEBAUDIO_INIT_OPTIONS"));_.debug("audio context init option:",JSON.stringify(e$)),Mn=new mC(e$),wt.curState=Mn.state,Mn.onstatechange=()=>{wt.prevState=wt.curState,wt.curState=Mn?Mn.state:void 0;let{prevState:t$,curState:r$}=wt,n$=r$==="running",i$=r$==="interrupted",o$=t$==="running",s$=t$==="suspended",a$=t$==="interrupted",c$=mt().osVersion;(ln()||vi())&&o$&&i$&&(_.info("ios".concat(c$,"-interruption-start")),wt.emit(ke.IOS_INTERRUPTION_START)),(ln()||vi())&&(s$||a$)&&n$&&(_.info("ios".concat(c$,"-interruption-end")),wt.emit(ke.IOS_INTERRUPTION_END)),t$!==r$&&wt.emit(ke.STATE_CHANGE,r$,t$)},setInterval(()=>{var t$;let r$=(t$=Mn)===null||t$===void 0?void 0:t$.currentTime;wt.currentTime!==r$?(wt.currentTimeStuckAt&&(_.debug("AudioContext current time resume at ".concat(r$)),wt.currentTimeStuckAt=void 0),wt.currentTime=r$):(r$!==wt.currentTimeStuckAt&&(X.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r$},tag:Zt.TRACER}).onSuccess(),_.warning("AudioContext current time stuck at ".concat(r$))),wt.currentTimeStuckAt=r$)},5e3),async function(t$){let r$=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],n$,i$=!1,o$=!1,s$=!1;function a$(f$){t$.state==="running"?c$(!1):ln()||vi()?t$.state==="suspended"&&(c$(!0),f$&&t$.resume().then(u$,u$)):t$.state!=="closed"&&(c$(!0),f$&&t$.resume().then(u$,u$))}function c$(f$){if(i$!==f$){i$=f$;for(let m$=0,g$=r$;m$<g$.length;m$+=1){let v$=g$[m$];f$?window.addEventListener(v$,l$,{capture:!0,passive:!0}):window.removeEventListener(v$,l$,{capture:!0,passive:!0})}}}function u$(){a$(!1)}function l$(){a$(!0)}function d$(f$){if(!s$)if(n$.paused)if(f$){let m$;h$(!1),s$=!0;try{m$=n$.play(),m$?m$.then(p$,p$):(n$.addEventListener("playing",p$),n$.addEventListener("abort",p$),n$.addEventListener("error",p$))}catch{p$()}}else h$(!0);else h$(!1)}function h$(f$){if(o$!==f$){o$=f$;for(let m$=0,g$=r$;m$<g$.length;m$++){let v$=g$[m$];f$?window.addEventListener(v$,_$,{capture:!0,passive:!0}):window.removeEventListener(v$,_$,{capture:!0,passive:!0})}}}function p$(){n$.removeEventListener("playing",p$),n$.removeEventListener("abort",p$),n$.removeEventListener("error",p$),s$=!1,d$(!1)}function _$(){d$(!0)}if(ln()){let f$=t$.createMediaStreamDestination(),m$=document.createElement("div");m$.innerHTML="<audio x-webkit-airplay='deny'></audio>",n$=m$.children.item(0),n$.controls=!1,n$.disableRemotePlayback=!0,n$.preload="auto",n$.srcObject=f$.stream,d$(!0)}wt.on(ke.STATE_CHANGE,function(){a$(!0)}),a$(!1)}(Mn)}(),!Mn)throw new N(R.NOT_SUPPORTED,"can not create audio context");return Mn}return Mn}function No(e$){if(function(){if(s_!==null)return s_;let n$=ga(),i$=n$.createBufferSource(),o$=n$.createGain(),s$=n$.createGain();i$.connect(o$),i$.connect(s$),i$.disconnect(o$);let a$=!1;try{i$.disconnect(o$)}catch{a$=!0}return i$.disconnect(),s_=a$,a$}())return;let t$=e$.connect,r$=e$.disconnect;e$.connect=(n$,i$,o$)=>{var s$;return e$._inputNodes||(e$._inputNodes=[]),W(s$=e$._inputNodes).call(s$,n$)||(n$ instanceof AudioNode?(e$._inputNodes.push(n$),t$.call(e$,n$,i$,o$)):t$.call(e$,n$,i$)),e$},e$.disconnect=(n$,i$,o$)=>{r$.call(e$),n$?Wl(e$._inputNodes,n$):e$._inputNodes=[];for(let s$ of e$._inputNodes)t$.call(e$,s$)}}var s_=null;function Rf(e$,t$){let r$=!1,n$=1/t$;if(v("DISABLE_WEBAUDIO")){let i$=window.setInterval(()=>{r$?window.clearInterval(i$):e$(performance.now()/1e3)},1e3*n$)}else{let i$=ga(),o$=i$.createGain();o$.gain.value=0,o$.connect(i$.destination);let s$=()=>{if(r$)return void(o$=null);let a$=i$.createOscillator();a$.onended=s$,a$.connect(o$),a$.start(0),a$.stop(i$.currentTime+n$),e$(i$.currentTime)};s$()}return()=>{r$=!0}}var Ql=class{constructor(){P(this,"context",void 0),P(this,"analyserNode",void 0),P(this,"sourceNode",void 0),this.context=ga(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e$){if(e$!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e$,e$==null||e$.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ln()||vi()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let e$=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e$);else{let r$=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r$);for(let n$=0;n$<e$.length;++n$)e$[n$]=r$[n$]/128-1}let t$=ji(e$).call(e$,(r$,n$)=>r$+n$*n$,0)/e$.length;return Math.max(10*Math.log10(t$)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e$,t$;(e$=this.sourceNode)===null||e$===void 0||e$.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(t$=this.sourceNode)===null||t$===void 0||t$.connect(this.analyserNode)}catch{_.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}},Zl=class extends Xt{get processSourceNode(){return this.sourceNode}set processedNode(e$){var t$;if(!this.isDestroyed&&this._processedNode!==e$){try{var r$;(r$=this.sourceNode)===null||r$===void 0||r$.disconnect(this.outputNode)}catch{}(t$=this._processedNode)===null||t$===void 0||t$.disconnect(),this._processedNode=e$,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),P(this,"outputNode",void 0),P(this,"outputTrack",void 0),P(this,"isPlayed",!1),P(this,"sourceNode",void 0),P(this,"context",void 0),P(this,"audioBufferNode",void 0),P(this,"destNode",void 0),P(this,"audioOutputLevel",0),P(this,"volumeLevelAnalyser",void 0),P(this,"_processedNode",void 0),P(this,"playNode",void 0),P(this,"isDestroyed",!1),P(this,"onNoAudioInput",void 0),P(this,"isNoAudioInput",!1),P(this,"_noAudioInputCount",0),this.context=ga(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),No(this.outputNode),this.volumeLevelAnalyser=new Ql}startGetAudioBuffer(e$){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e$),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=t$=>{this.emit(jn.ON_AUDIO_BUFFER,function(r$){for(let n$=0;n$<r$.outputBuffer.numberOfChannels;n$+=1){let i$=r$.outputBuffer.getChannelData(n$);for(let o$=0;o$<i$.length;o$+=1)i$[o$]=0}return r$.inputBuffer}(t$))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!ft().webAudioMediaStreamDest)throw new N(R.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e$){this.context.state!=="running"&&qu(()=>{wt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e$||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e$>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ln()||vi()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let t$=this.volumeLevelAnalyser.getAnalyserNode(),r$;t$.getFloatTimeDomainData?(r$=new Float32Array(t$.fftSize),t$.getFloatTimeDomainData(r$)):(r$=new Uint8Array(t$.fftSize),t$.getByteTimeDomainData(r$));let n$=!1;for(let i$=0;i$<r$.length;i$++)r$[i$]!==0&&(n$=!0);return n$?(this.isNoAudioInput=!1,!0):(await Me(200),await this.checkHasAudioInput(e$?e$+1:1)&&n$)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e$){this.outputNode.gain.setValueAtTime(e$,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e$,t$;(e$=this.processedNode)===null||e$===void 0||e$.disconnect(),(t$=this.sourceNode)===null||t$===void 0||t$.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e$;this.processedNode?(e$=this.processedNode)===null||e$===void 0||e$.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}},$l=class extends Zl{get isFreeze(){return!1}constructor(e$,t$,r$){var n$;if(super(),P(this,"sourceNode",void 0),P(this,"track",void 0),P(this,"clonedTrack",void 0),P(this,"audioElement",void 0),P(this,"isCurrentTrackCloned",!1),P(this,"isRemoteTrack",!1),P(this,"originVolumeLevelAnalyser",void 0),P(this,"rebuildWebAudio",async()=>{if(_.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void _.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>_.info("resume success")),_.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let s$=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?s$.stop():this.isCurrentTrackCloned=!0;let a$=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(a$),No(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let c$=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(c$,this.context.currentTime),No(this.outputNode),this.emit(jn.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=a$,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e$.kind!=="audio")throw new N(R.UNEXPECTED_ERROR);this.track=e$;let i$=new MediaStream([this.track]);if(this.isRemoteTrack=!!t$,this.sourceNode=this.context.createMediaStreamSource(i$),No(this.sourceNode),r$){let s$=r$.clone();s$.enabled=!0,this.clonedTrack=s$,_.debug("create an unmuted track ".concat(s$.id," from the original track ").concat(r$.id," to get the volume"));let a$=this.context.createMediaStreamSource(new MediaStream([s$]));No(a$),this.originVolumeLevelAnalyser=new Ql,this.originVolumeLevelAnalyser.updateSource(a$)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=i$;let o$=mt();t$&&o$.os===ye.IOS&&Number((n$=o$.osVersion)===null||n$===void 0?void 0:n$.split(".")[0])<15&&(wt.on(ke.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(s$=>{s$||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e$){this.sourceNode.disconnect(),this.track=e$,this.isCurrentTrackCloned=!1;let t$=new MediaStream([e$]);this.sourceNode=this.context.createMediaStreamSource(t$),No(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(jn.UPDATE_SOURCE),this.audioElement.srcObject=t$}destroy(){var e$;this.audioElement.srcObject=null,this.audioElement.remove(),wt.off("state-change",this.rebuildWebAudio),(e$=this.originVolumeLevelAnalyser)===null||e$===void 0||e$.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e$){return this.context.createMediaStreamSource(new MediaStream([e$]))}updateOriginTrack(e$){let t$=e$.clone();t$.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t$),_.debug("create an unmuted track ".concat(t$.id," from the original track ").concat(e$.id," to get the volume"));let r$=this.context.createMediaStreamSource(new MediaStream([t$]));No(r$),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r$)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}};async function HO(e$,t$,r$){let n$=(o$,s$)=>o$?typeof o$!="number"?o$.max||o$.exact||o$.ideal||o$.min||s$:o$:s$,i$={audio:!!r$&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e$,maxHeight:n$(t$.height,1080),maxWidth:n$(t$.width,1920)}}};return t$.frameRate&&typeof t$.frameRate!="number"?(i$.video.mandatory.maxFrameRate=t$.frameRate.max,i$.video.mandatory.minFrameRate=t$.frameRate.min):typeof t$.frameRate=="number"&&(i$.video.mandatory.maxFrameRate=t$.frameRate),await navigator.mediaDevices.getUserMedia(i$)}async function LG(e$,t$){let r$=await KO(e$.mediaSource),{sourceId:n$,audio:i$}=await function(o$){let s$=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new j((a$,c$)=>{let u$=document.createElement("div");u$.innerText="share screen",u$.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let l$=document.createElement("div");l$.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let d$=document.createElement("div");d$.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",d$.setAttribute("style","height: 12%;");let h$=document.createElement("div");h$.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let p$=document.createElement("div");p$.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let _$=document.createElement("button");_$.innerHTML="cancel",_$.setAttribute("style","width: 85px;"),_$.onclick=()=>{document.body.removeChild(g$);let v$=new Error("NotAllowedError");v$.name="NotAllowedError",c$(v$)};let f$=s$,m$=document.createElement("div");if(s$){let v$=document.createElement("input");v$.setAttribute("type","checkbox");let y$=document.createElement("span");v$.setAttribute("style","margin-right: 6px;"),y$.innerText="Share audio",v$.checked=f$,v$.onchange=()=>{f$=v$.checked},m$.appendChild(v$),m$.appendChild(y$)}p$.appendChild(m$),p$.appendChild(_$),l$.appendChild(d$),l$.appendChild(h$),l$.appendChild(p$);let g$=document.createElement("div");g$.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),g$.appendChild(u$),g$.appendChild(l$),document.body.appendChild(g$),o$.map(v$=>{if(v$.id){let y$=document.createElement("div");y$.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let S$=v$.thumbnail;try{let{width:b$}=S$.getSize();b$>1920&&(S$=S$.resize({width:1920}))}catch(b$){throw b$&&b$.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),b$}y$.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+S$.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+v$.name.replace(/[\u00A0-\u9999<>\&]/g,function(b$){return"&#"+b$.charCodeAt(0)+";"})+"</span>",y$.onclick=()=>{document.body.removeChild(g$),a$({sourceId:v$.id,audio:f$})},h$.appendChild(y$)}})})}(r$,t$);return await HO(n$,e$,i$)}async function KO(e$){let t$=["window","screen"];e$!=="application"&&e$!=="window"||(t$=["window"]),e$==="screen"&&(t$=["screen"]);let r$=IO();if(!r$)throw console.error("failed to fetch electron, please mount it to window"),new N(R.ELECTRON_IS_NULL);let n$=null;try{var i$;n$=((i$=r$.desktopCapturer)===null||i$===void 0?void 0:i$.getSources({types:t$}))||r$.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t$})}catch{n$=null}n$&&n$.then||(n$=new j((o$,s$)=>{r$.desktopCapturer.getSources({types:t$},(a$,c$)=>{a$?s$(a$):o$(c$)})}));try{return await n$}catch(o$){throw new N(R.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,o$.toString())}}var qE=new ze("safari"),YO=!1,qO=!1;async function Fn(e$,t$){let r$=0,n$=null;for(;r$<2;)try{n$=await MG(e$,t$,r$>0);break}catch(i$){if(i$ instanceof N)throw _.error("[".concat(t$,"] ").concat(i$.toString())),i$;let o$=Il(i$.name||i$.code||i$,i$.message);if(o$.code===R.MEDIA_OPTION_INVALID){_.debug("[".concat(t$,"] detect media option invalid, retry")),r$+=1,await Me(500);continue}throw _.error("[".concat(t$,"] ").concat(o$.toString())),o$}if(!n$)throw new N(R.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return n$}async function MG(e$,t$,r$){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new N(R.NOT_SUPPORTED,"can not find getUserMedia");r$&&(e$.video&&(delete e$.video.width,delete e$.video.height),e$.screen&&(delete e$.screen.width,delete e$.screen.height));let n$=ft(),i$=new MediaStream;if(e$.audioSource&&i$.addTrack(e$.audioSource),e$.videoSource&&i$.addTrack(e$.videoSource),!e$.audio&&!e$.video&&!e$.screen)return _.debug("Using Video Source/ Audio Source"),i$;if(e$.screen)if(IO())e$.screen.sourceId?Ts(i$,await HO(e$.screen.sourceId,e$.screen,e$.screenAudio)):Ts(i$,await LG(e$.screen,e$.screenAudio));else if(oo()&&e$.screen.extensionId&&e$.screen.mandatory){if(!n$.getStreamFromExtension)throw new N(R.NOT_SUPPORTED,"This browser does not support screen sharing");_.debug("[".concat(t$,'] Screen access on chrome stable, looking for extension"'));let h$=await(s$=e$.screen.extensionId,a$=t$,new j((p$,_$)=>{try{chrome.runtime.sendMessage(s$,{getStream:!0},f$=>{if(!f$||!f$.streamId)return _.error("[".concat(a$,"] No response from Chrome Plugin. Plugin not installed properly"),f$),void _$(new N(R.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));p$(f$.streamId)})}catch(f$){_.error("[".concat(a$,"] AgoraRTC screensharing plugin is not accessible(").concat(s$,")"),f$.toString()),_$(new N(R.CHROME_PLUGIN_NOT_INSTALL))}}));e$.screen.mandatory.chromeMediaSourceId=h$,Ts(i$,await navigator.mediaDevices.getUserMedia({video:{mandatory:e$.screen.mandatory}}))}else if(n$.getDisplayMedia){var o$;e$.screen.mediaSource&&_C(e$.screen.mediaSource);let h$={width:e$.screen.width,height:e$.screen.height,frameRate:e$.screen.frameRate,displaySurface:(o$=e$.screen.displaySurface)!==null&&o$!==void 0?o$:e$.screen.mediaSource==="screen"?"monitor":e$.screen.mediaSource},{selfBrowserSurface:p$,surfaceSwitching:_$,systemAudio:f$}=e$.screen,m$={selfBrowserSurface:p$,surfaceSwitching:_$,systemAudio:f$};!p$&&delete m$.selfBrowserSurface,!_$&&delete m$.surfaceSwitching,!f$&&delete m$.systemAudio,_.debug("[".concat(t$,"] getDisplayMedia:"),JSON.stringify({video:h$,audio:!!e$.screenAudio,controls:m$})),Ts(i$,await navigator.mediaDevices.getDisplayMedia(Kt({video:h$,audio:!!e$.screenAudio},m$)))}else{if(!$t())throw _.error("[".concat(t$,"] This browser does not support screenSharing")),new N(R.NOT_SUPPORTED,"This browser does not support screen sharing");{e$.screen.mediaSource&&_C(e$.screen.mediaSource);let h$={video:{mediaSource:e$.screen.mediaSource,width:e$.screen.width,height:e$.screen.height,frameRate:e$.screen.frameRate}};_.debug("[".concat(t$,"] getUserMedia: ").concat(JSON.stringify(h$))),Ts(i$,await navigator.mediaDevices.getUserMedia(h$))}}var s$,a$;if(!e$.video&&!e$.audio)return i$;let c$={video:e$.video,audio:e$.audio},u$=v("MEDIA_DEVICE_CONSTRAINTS");if(u$)try{typeof u$=="string"&&(u$=JSON.parse(u$)),c$=kE(c$,u$)}catch{}_.debug("[".concat(t$,"] GetUserMedia"),JSON.stringify(c$)),mt();let l$,d$=null;(je()||ln()||Gl())&&(d$=await qE.lock());try{l$=await navigator.mediaDevices.getUserMedia(c$)}catch(h$){throw d$&&d$(),h$}return c$.audio&&(YO=!0),c$.video&&(qO=!0),Ts(i$,l$),d$&&d$(),i$}function Il(e$,t$){switch(e$){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new N(R.MEDIA_OPTION_INVALID,"".concat(e$,": ").concat(t$));case"NotFoundError":case"DevicesNotFoundError":return new N(R.DEVICE_NOT_FOUND,"".concat(e$,": ").concat(t$));case"NotSupportedError":return new N(R.NOT_SUPPORTED,"".concat(e$,": ").concat(t$));case"NotReadableError":return new N(R.NOT_READABLE,"".concat(e$,": ").concat(t$));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new N(R.PERMISSION_DENIED,"".concat(e$,": ").concat(t$));case"ConstraintNotSatisfiedError":return new N(R.CONSTRAINT_NOT_SATISFIED,"".concat(e$,": ").concat(t$));default:return _.error("getUserMedia unexpected error",e$),new N(R.UNEXPECTED_ERROR,"".concat(e$,": ").concat(t$))}}function Ts(e$,t$){let r$=e$.getVideoTracks()[0],n$=e$.getAudioTracks()[0],i$=t$.getVideoTracks()[0],o$=t$.getAudioTracks()[0];o$&&(n$&&e$.removeTrack(n$),e$.addTrack(o$)),i$&&(r$&&e$.removeTrack(r$),e$.addTrack(i$))}var Gn=new class extends Xt{get state(){return this._state}set state(e$){e$!==this._state&&(this.emit(Bo.STATE_CHANGE,e$),this._state=e$)}constructor(){super(),P(this,"_state",Ua.IDLE),P(this,"isAccessMicrophonePermission",!1),P(this,"isAccessCameraPermission",!1),P(this,"lastAccessMicrophonePermission",!1),P(this,"lastAccessCameraPermission",!1),P(this,"checkdeviceMatched",!1),P(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(v("ENUMERATE_DEVICES_INTERVAL")||(Ku()||Hu()===ye.HARMONY_OS)&&ho())&&this.updateDevicesInfo()},v("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e$=>_.error(e$.toString()))}async enumerateDevices(e$,t$){let r$=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new N(R.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let n$=await navigator.mediaDevices.enumerateDevices(),i$=this.checkMediaDeviceInfoIsOk(n$),o$=!this.isAccessMicrophonePermission&&e$,s$=!this.isAccessCameraPermission&&t$;i$.audio&&(o$=!1),i$.video&&(s$=!1);let a$=null,c$=null,u$=null;if(!r$&&(o$||s$)){if(qE.isLocked&&(_.debug("[device manager] wait GUM lock"),(await qE.lock())(),_.debug("[device manager] GUM unlock")),YO&&(o$=!1,this.isAccessMicrophonePermission=!0),qO&&(s$=!1,this.isAccessCameraPermission=!0),_.debug("[device manager] check media device permissions",e$,t$,o$,s$),o$&&s$){try{u$=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(l$){let d$=Il(l$.name||l$.code||l$,l$.message);if(d$.code===R.PERMISSION_DENIED)throw d$;_.warning("getUserMedia failed in getDevices",d$)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o$){try{a$=await navigator.mediaDevices.getUserMedia({audio:e$})}catch(l$){let d$=Il(l$.name||l$.code||l$,l$.message);if(d$.code===R.PERMISSION_DENIED)throw d$;_.warning("getUserMedia failed in getDevices",d$)}this.isAccessMicrophonePermission=!0}else if(s$){try{c$=await navigator.mediaDevices.getUserMedia({video:t$})}catch(l$){let d$=Il(l$.name||l$.code||l$,l$.message);if(d$.code===R.PERMISSION_DENIED)throw d$;_.warning("getUserMedia failed in getDevices",d$)}this.isAccessCameraPermission=!0}_.debug("[device manager] mic permission",e$,"cam permission",t$)}try{let l$=await navigator.mediaDevices.enumerateDevices();return a$&&a$.getTracks().forEach(d$=>d$.stop()),c$&&c$.getTracks().forEach(d$=>d$.stop()),u$&&u$.getTracks().forEach(d$=>d$.stop()),a$=null,c$=null,u$=null,l$}catch(l$){return a$&&a$.getTracks().forEach(d$=>d$.stop()),c$&&c$.getTracks().forEach(d$=>d$.stop()),u$&&u$.getTracks().forEach(d$=>d$.stop()),a$=null,c$=null,u$=null,new N(R.ENUMERATE_DEVICES_FAILED,l$.toString()).throw()}}async getRecordingDevices(){let e$=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e$)).filter(t$=>t$.kind==="audioinput")}async getCamerasDevices(){let e$=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e$)).filter(t$=>t$.kind==="videoinput")}async getSpeakers(){let e$=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e$)).filter(t$=>t$.kind==="audiooutput")}searchDeviceIdByName(e$){let t$=null;return this.deviceInfoMap.forEach(r$=>{r$.device.label===e$&&(t$=r$.device.deviceId)}),t$}async getDeviceById(e$){let t$=(await this.enumerateDevices(!0,!0,!0)).find(r$=>r$.deviceId===e$);if(!t$)throw new N(R.DEVICE_NOT_FOUND,"deviceId: ".concat(e$));return t$}async init(){this.state=Ua.INITING;try{await this.updateDevicesInfo(),this.state=Ua.INITEND}catch(e$){throw _.warning("Device Detection functionality cannot start properly.",e$.toString()),this.state=Ua.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new N(R.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e$}}async updateDevicesInfo(){let e$=await this.enumerateDevices(!0,!0,!0),t$=Date.now(),r$=[];if(e$[0]&&e$[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let i$=e$.find(s$=>s$.kind==="audioinput"&&s$.deviceId==="default"),o$=e$.find(s$=>s$.kind==="audiooutput"&&s$.deviceId==="default");i$&&o$?o$.groupId===i$.groupId?_.debug("[device-check] default input ".concat(i$.label," and output ").concat(o$.label," is the same group")):_.warning("[device-check] default input ".concat(i$.label," and output ").concat(o$.label," is not the same group")):_.debug("[device-check] default input or output not found")}let n$=this.checkMediaDeviceInfoIsOk(e$);if(e$.forEach(i$=>{if(!i$.deviceId)return;let o$=this.deviceInfoMap.get("".concat(i$.kind,"_").concat(i$.deviceId));if((o$?o$.state:"INACTIVE")!=="ACTIVE"){let s$={initAt:t$,updateAt:t$,device:i$,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i$.kind,"_").concat(i$.deviceId),s$),r$.push(s$)}o$&&(o$.updateAt=t$)}),this.deviceInfoMap.forEach((i$,o$)=>{i$.state==="ACTIVE"&&i$.updateAt!==t$&&(i$.state="INACTIVE",r$.push(i$))}),this.state!==Ua.INITEND)return n$.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(n$.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r$.forEach(i$=>{switch(i$.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Bo.RECORDING_DEVICE_CHANGED,i$);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Bo.CAMERA_DEVICE_CHANGED,i$);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Bo.PLAYOUT_DEVICE_CHANGED,i$)}}),n$.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),n$.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e$){let t$=e$.filter(i$=>i$.kind==="audioinput"),r$=e$.filter(i$=>i$.kind==="videoinput"),n$={audio:!1,video:!1};for(let i$ of t$)if(i$.label&&i$.deviceId){n$.audio=!0;break}for(let i$ of r$)if(i$.label&&i$.deviceId){n$.video=!0;break}return n$}},a_=!1,Un=new class extends Xt{constructor(){super(...arguments),P(this,"onAutoplayFailed",void 0),P(this,"onAudioAutoplayFailed",void 0)}};function zO(){if(mt(),!a_){let e$=t$=>{t$.preventDefault(),a_=!1,yc()?document.body.removeEventListener("click",e$,!0):(document.body.removeEventListener("touchstart",e$,!0),document.body.removeEventListener("mousedown",e$,!0))};a_=!0,yc()?document.body.addEventListener("click",e$,!0):(document.body.addEventListener("touchstart",e$,!0),document.body.addEventListener("mousedown",e$,!0)),_.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Un.onAutoplayFailed?Un.onAutoplayFailed():Un.onAudioAutoplayFailed?_.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):_.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Un.emit("autoplay-failed")}}function JO(e$,t$,r$,n$){if(!e$)return;let i$=X.getBaseInfoBySessionId(e$);if(!i$)return;let o$=i$.info,s$=Date.now(),a$=Kt(Kt({},o$),{},{vid:o$.vid===void 0?0:Number(o$.vid),lts:s$,elapse:s$-i$.startTime,cbRegistered:Un.onAutoplayFailed||Un.onAudioAutoplayFailed?1:-1,errorMsg:r$,mediaType:t$,trackId:n$,extend:void 0});X.send({type:Jt.AUTOPLAY_FAILED,data:a$},!0)}var UG=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],En=new class{constructor(){P(this,"onAutoplayFailed",void 0),P(this,"elementMap",new Map),P(this,"elementStateMap",new Map),P(this,"elementsNeedToResume",[]),P(this,"sinkIdMap",new Map),P(this,"autoResumeAfterInterruption",e$=>{Array.from(this.elementMap.entries()).forEach(t$=>{let[r$,n$]=t$,i$=this.elementStateMap.get(r$),o$=n$.srcObject.getAudioTracks()[0],s$=o$&&o$.readyState;if(_.debug("resume after interrupted, ele: ".concat(i$," audio: ").concat(s$," ").concat(e$)),s$==="live"){if(e$)return n$.pause(),void n$.play();if(wt.curState==="running")return Zs()?(n$.pause(),void n$.play()):void(i$&&i$==="paused"&&n$.play())}})}),P(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e$=>{let[t$,r$]=e$,n$=r$.srcObject.getAudioTracks()[0];n$&&n$.readyState==="live"&&(_.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r$.pause(),r$.play())})}),this.autoResumeAudioElement(),wt.on(ke.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),wt.on(ke.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),wt.on(ke.STATE_CHANGE,()=>{ln()&&wt.prevState==="suspended"&&wt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e$,t$){let r$=this.elementMap.get(e$);if(this.sinkIdMap.set(e$,t$),r$)try{await r$.setSinkId(t$)}catch(n$){throw new N(R.PERMISSION_DENIED,"can not set sink id: "+n$.toString())}}play(e$,t$,r$,n$){if(this.elementMap.has(t$))return;let i$=document.createElement("audio");i$.autoplay=!0,i$.srcObject=new MediaStream([e$]),this.bindAudioElementEvents(t$,i$),this.elementMap.set(t$,i$),this.elementStateMap.set(t$,nn.INIT),this.setVolume(t$,r$);let o$=this.sinkIdMap.get(t$);if(o$)try{i$.setSinkId(o$).catch(a$=>{_.warning("[".concat(t$,"] set sink id failed"),a$.toString())})}catch(a$){_.warning("[".concat(t$,"] set sink id failed"),a$.toString())}let s$=i$.play();s$&&s$.then&&s$.catch(a$=>{n$&&JO(n$,"audio",a$.message,t$),_.warning("audio element play warning",a$.toString()),this.elementMap.has(t$)&&a$.name==="NotAllowedError"&&(_.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i$),qu(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),zO()}))})}updateTrack(e$,t$){let r$=this.elementMap.get(e$);r$&&(r$.srcObject=new MediaStream([t$]))}isPlaying(e$){return this.elementMap.has(e$)&&this.elementStateMap.get(e$)==="playing"}setVolume(e$,t$){let r$=this.elementMap.get(e$);r$&&(t$=Math.max(0,Math.min(100,t$)),r$.volume=t$/100)}stop(e$){let t$=this.elementMap.get(e$);if(this.sinkIdMap.delete(e$),!t$)return;let r$=this.elementsNeedToResume.indexOf(t$);this.elementsNeedToResume.splice(r$,1),t$.srcObject=null,t$.remove(),this.elementMap.delete(e$),this.elementStateMap.delete(e$)}bindAudioElementEvents(e$,t$){UG.forEach(r$=>{t$.addEventListener(r$,n$=>{let i$=this.elementStateMap.get(e$),o$=n$.type==="pause"?"paused":n$.type;if(_.debug("[".concat(e$,"] audio-element-status change ").concat(i$," => ").concat(o$)),n$.type==="error"){let s$=t$==null?void 0:t$.error;s$&&_.error("[".concat(e$,"] media error, code: ").concat(s$.code,", message: ").concat(s$.message))}this.elementStateMap.set(e$,o$)})})}getPlayerState(e$){return this.elementStateMap.get(e$)||"uninit"}autoResumeAudioElement(){let e$=()=>{this.elementsNeedToResume.forEach(t$=>{t$.play().then(r$=>{_.debug("Auto resume audio element success")}).catch(r$=>{_.warning("Auto resume audio element failed!",r$)})}),this.elementsNeedToResume=[]};new j(t$=>{document.body?t$():window.addEventListener("load",()=>t$())}).then(()=>{yc()?document.body.addEventListener("click",e$,!0):(document.body.addEventListener("touchstart",e$,!0),document.body.addEventListener("mousedown",e$,!0))})}};function se(){return function(e$,t$,r$){let n$=r$.value;return typeof n$=="function"&&(r$.value=function(){this._isClosed&&new N(R.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",_);for(var i$=arguments.length,o$=new Array(i$),s$=0;s$<i$;s$++)o$[s$]=arguments[s$];let a$=n$.apply(this,o$);return a$ instanceof j?new j((c$,u$)=>{a$.then(c$).catch(u$)}):a$}),r$}}var tu=class extends Xt{constructor(e$){super(),P(this,"name","VideoProcessorDestination"),P(this,"ID","0"),P(this,"_source",void 0),P(this,"videoContext",void 0),P(this,"inputTrack",void 0),this.videoContext=e$}get kind(){return"video"}get enabled(){return!0}pipe(){throw new N(R.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new N(R.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e$){if(e$.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e$.track&&e$.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e$.track,this.emit(un.ON_TRACK,e$.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(un.ON_TRACK,void 0)}},eu=class extends Xt{set chained(e$){this._chained=e$}get chained(){return this._chained}constructor(e$,t$){super(),P(this,"constraintsMap",new Map),P(this,"statsRegistry",[]),P(this,"usageRegistry",[]),P(this,"trackId",void 0),P(this,"direction",void 0),P(this,"_chained",!1),this.trackId=e$,this.direction=t$}async getConstraints(){return await Ge(this,Wn.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e$,t$){var r$;return _.info("processor ".concat(t$.name," requestApplyConstraints for ").concat(this.trackId)),e$&&this.constraintsMap.set(t$,e$),kt(this,Wn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pr(r$=this.constraintsMap).call(r$)))}async requestRevertConstraints(e$){var t$;if(this.constraintsMap.has(e$))return _.info("processor ".concat(e$.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e$),kt(this,Wn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pr(t$=this.constraintsMap).call(t$)))}registerStats(e$,t$,r$){this.statsRegistry.find(n$=>n$.processorID===e$.ID&&n$.processorName===e$.name&&n$.type===t$)||this.statsRegistry.push({processorName:e$.name,processorID:e$.ID,type:t$,cb:r$})}unregisterStats(e$,t$){let r$=this.statsRegistry.findIndex(n$=>n$.processorID===e$.ID&&n$.processorName===e$.name&&n$.type===t$);r$!==-1&&this.statsRegistry.splice(r$,1)}gatherStats(){let e$=[];for(let{processorID:t$,processorName:r$,type:n$,cb:i$}of this.statsRegistry)try{let o$=i$();e$.push({processorID:t$,processorName:r$,type:n$,stats:o$})}catch(o$){_.error(new N(R.UNEXPECTED_ERROR,o$.message))}return e$}registerUsage(e$,t$){this.usageRegistry.find(r$=>r$.processorID===e$.ID&&r$.processorName===e$.name)||this.usageRegistry.push({processorID:e$.ID,processorName:e$.name,cb:t$})}unregisterUsage(e$){let t$=this.usageRegistry.findIndex(r$=>r$.processorID===e$.ID&&r$.processorName===e$.name);t$!==-1&&this.usageRegistry.splice(t$,1)}async gatherUsage(){let e$=[];if(!this.chained)return[];for(let{cb:t$}of this.usageRegistry)try{let r$=t$();r$ instanceof j&&(r$=await r$),e$.push(Kt(Kt({},r$),{},{direction:this.direction}))}catch(r$){_.error("gather extension usage error",r$)}return e$}getDirection(){return this.direction}},nu=class extends Xt{constructor(e$){super(),P(this,"name","AudioProcessorDestination"),P(this,"ID","0"),P(this,"inputTrack",void 0),P(this,"inputNode",void 0),P(this,"audioProcessorContext",void 0),P(this,"_source",void 0),this.audioProcessorContext=e$}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new N(R.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new N(R.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(un.ON_TRACK,void 0),this.emit(un.ON_NODE,void 0)}updateInput(e$){if(e$.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e$.track&&this.inputTrack!==e$.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e$.track,this.emit(un.ON_TRACK,this.inputTrack)),e$.node&&this.inputNode!==e$.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e$.node,this.emit(un.ON_NODE,this.inputNode))}},iu=class extends Xt{set chained(e$){this._chained=e$}get chained(){return this._chained}constructor(e$,t$,r$){super(),P(this,"constraintsMap",new Map),P(this,"statsRegistry",[]),P(this,"audioContext",void 0),P(this,"trackId",void 0),P(this,"direction",void 0),P(this,"usageRegistry",[]),P(this,"_chained",!1),this.audioContext=e$,this.trackId=t$,this.direction=r$}async getConstraints(){return Ge(this,Wn.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e$,t$){var r$;return _.info("processor ".concat(t$.name," requestApplyConstraints for ").concat(this.trackId)),e$&&this.constraintsMap.set(t$,e$),kt(this,Wn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pr(r$=this.constraintsMap).call(r$)))}async requestRevertConstraints(e$){var t$;if(this.constraintsMap.has(e$))return this.constraintsMap.delete(e$),kt(this,Wn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pr(t$=this.constraintsMap).call(t$)))}registerStats(e$,t$,r$){this.statsRegistry.find(n$=>n$.processorID===e$.ID&&n$.processorName===e$.name&&n$.type===t$)||this.statsRegistry.push({processorName:e$.name,processorID:e$.ID,type:t$,cb:r$})}unregisterStats(e$,t$){let r$=this.statsRegistry.findIndex(n$=>n$.processorID===e$.ID&&n$.processorName===e$.name&&n$.type===t$);r$!==-1&&this.statsRegistry.splice(r$,1)}gatherStats(){let e$=[];for(let{processorID:t$,processorName:r$,type:n$,cb:i$}of this.statsRegistry)try{let o$=i$();e$.push({processorID:t$,processorName:r$,type:n$,stats:o$})}catch(o$){_.error(new N(R.UNEXPECTED_ERROR,o$.message))}return e$}registerUsage(e$,t$){this.usageRegistry.find(r$=>r$.processorID===e$.ID&&r$.processorName===e$.name)||this.usageRegistry.push({processorID:e$.ID,processorName:e$.name,cb:t$})}unregisterUsage(e$){let t$=this.usageRegistry.findIndex(r$=>r$.processorID===e$.ID&&r$.processorName===e$.name);t$!==-1&&this.usageRegistry.splice(t$,1)}async gatherUsage(){let e$=[];if(!this.chained)return[];for(let{cb:t$}of this.usageRegistry)try{let r$=t$();r$ instanceof j&&(r$=await r$),e$.push(Kt(Kt({},r$),{},{direction:this.direction}))}catch(r$){_.error("gather extension usage error",r$)}return e$}getDirection(){return this.direction}},Pc=class extends Xt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),P(this,"context",void 0),P(this,"processSourceNode",void 0),P(this,"outputTrack",void 0),P(this,"processedNode",void 0),P(this,"clonedTrack",void 0),P(this,"outputNode",void 0),this.outputNode=new zE}setVolume(){}createOutputTrack(){throw new N(R.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}},zE=class{disconnect(){}connect(){}};function XO(e$){return new j((t$,r$)=>{let n$=!1,i$=document.createElement("video");i$.setAttribute("autoplay",""),i$.setAttribute("muted",""),i$.muted=!0,i$.autoplay=!0,i$.setAttribute("playsinline",""),i$.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i$);let o$=ln()?"canplay":"playing";i$.addEventListener(o$,()=>{let s$=i$.videoWidth,a$=i$.videoHeight;!s$&&$t()||(n$=!0,i$.srcObject=null,i$.remove(),t$([s$,a$]))}),i$.srcObject=new MediaStream([e$]),i$.play().catch(zu),setTimeout(()=>{n$||(i$.srcObject=null,i$.remove(),t$([i$.videoWidth,i$.videoHeight]))},4e3)})}function ru(e$){let t$={};e$.facingMode&&(t$.facingMode=e$.facingMode),e$.cameraId&&(t$.deviceId={exact:e$.cameraId});let r$=cr(e$.encoderConfig);return r$.width!=null&&(t$.width=r$.width),r$.height!=null&&(t$.height=r$.height),!SO()&&r$.frameRate&&(t$.frameRate=r$.frameRate),_O()&&typeof t$.frameRate=="object"&&(t$.frameRate.max=60),$t()&&(t$.frameRate={ideal:30,max:30}),t$}function fC(e$){let t$={};if(SO()||(e$.AGC!==void 0&&(t$.autoGainControl=e$.AGC),e$.AEC!==void 0&&(t$.echoCancellation=e$.AEC),e$.ANS!==void 0&&(t$.noiseSuppression=e$.ANS,oo()&&e$.ANS&&(t$.googHighpassFilter=e$.ANS))),e$.encoderConfig){let r$=Jl(e$.encoderConfig);t$.channelCount=r$.stereo?2:1,t$.sampleRate=r$.sampleRate,t$.sampleSize=r$.sampleSize}return e$.microphoneId&&(t$.deviceId={exact:e$.microphoneId}),Ku()&&(t$.sampleRate=void 0),t$}var xG=e$=>{let t$=e$._encoderConfig;if(!t$)return;let{frameRate:r$,width:n$,height:i$}=e$.getMediaStreamTrackSettings(),{frameRate:o$=r$,width:s$=n$,height:a$=i$}=t$;if(!o$||!s$||!a$)return;s$=wp(s$),a$=wp(a$),o$=wp(o$);let{max:c$,min:u$}=function(p$,_$,f$){let m$=200*Math.pow(f$/15,.6)*Math.pow(p$*_$/640/360,.75);return{min:Math.floor(m$),max:Math.floor(4*m$)}}(s$,a$,o$),{bitrateMax:l$,bitrateMin:d$}=t$||{};l$||_.debug("calculate bitrate: [w: ".concat(s$,", h: ").concat(a$,", fps: ").concat(o$,"] => [brMax: ").concat(l$,", brMin: ").concat(d$,"]"));let{maxFramerate:h$}=v("ENCODER_CONFIG_LIMIT");return h$&&typeof h$=="number"&&(o$=Math.min(o$,h$)),{frameRate:o$,bitrateMax:l$||c$,bitrateMin:d$||u$,scaleResolutionDownBy:1,scale:0}},QO=async(e$,t$,r$)=>await(async(n$,i$,o$)=>{let s$=function(u$){let l$=[];for(let d$=0;d$<u$.length;d$+=2)l$.push(parseInt(u$.slice(d$,d$+2),16));return Uint8Array.from(l$)}(bO(""+i$+o$)).slice(0,16),a$=s$.slice(0,12),c$=await window.crypto.subtle.importKey("raw",s$,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a$},c$,n$))})(e$.buffer,t$,r$),Cf=e$=>{let t$=document.createElement("canvas");return t$.width=2,t$.height=2,new j((r$,n$)=>{t$.toBlob(async i$=>{if(t$.remove(),i$){let o$=await ZO(i$);r$({buffer:o$,width:t$.width,height:t$.height})}else n$(new N(R.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e$,1)})},ZO=async e$=>{let t$=await e$.arrayBuffer();return new Uint8Array(t$)},gC,TC,SC,RC,CC,IC,vC,yC,AC,bC,wC,OC,NC,DC,PC,kC,LC,MC,Yt,UC,xC,VC,FC,BC,jC,Ji,GC,WC,HC,KC,YC,qC,zC,JC,XC,QC,ZC,$C,tI,Ue,Qt=(gC=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$],throttleTime:300}),TC=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),SC=se(),RC=$s("LocalAudioTrack","_enabledMutex"),CC=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),IC=se(),vC=$s("LocalAudioTrack","_enabledMutex"),yC=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),AC=se(),bC=se(),wC=se(),OC=$({argsMap:e$=>[e$.getTrackId()]}),NC=se(),DC=$({argsMap:e$=>[e$.getTrackId()]}),PC=se(),kC=$({argsMap:e$=>[e$.getTrackId()]}),LC=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$.name]}),MC=$({argsMap:e$=>[e$.getTrackId()]}),Et((Yt=class extends no{get _source(){return this.initWebAudio()}set _source(e$){this._trackSource=e$}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?En.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e$,t$,r$,n$){super(e$,r$),P(this,"trackMediaType",fa.AUDIO),P(this,"_encoderConfig",void 0),P(this,"_trackSource",void 0),P(this,"_enabled",!0),P(this,"_volume",100),P(this,"_useAudioElement",!0),P(this,"_bypassWebAudio",!1),P(this,"processor",void 0),P(this,"_processorContext",void 0),P(this,"_processorDestination",void 0),P(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t$,this._getOriginVolumeLevel=!!n$,this._trackSource=new Pc,v("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),v("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),je()&&!Mn?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e$){Nt(e$,"volume",0,1e3),this._volume=e$,this._source.setVolume(e$/100),this._useAudioElement&&En.setVolume(this.getTrackId(),e$);try{if(this._bypassWebAudio)return void _.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let t$=this._source.createOutputTrack();this._mediaStreamTrack!==t$&&(this._mediaStreamTrack=t$,kt(this,H.NEED_REPLACE_TRACK,this).then(()=>{_.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(r$=>{_.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),r$)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e$){if(!this._useAudioElement||!jO())throw new N(R.NOT_SUPPORTED,"your browser does not support setting the audio output device");await En.setSinkID(this.getTrackId(),e$)}async setEnabled(e$,t$,r$){return this._setEnabled(e$,t$,r$)}async _setEnabled(e$,t$,r$){if(!r$){if(e$===this._enabled)return;this.stateCheck("enabled",e$)}if(_.info("[".concat(this.getTrackId(),"] start setEnabled"),e$),e$){this._originMediaStreamTrack.enabled=!0;try{r$||(this._enabled=!0),await kt(this,H.NEED_ENABLE_TRACK,this),_.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e$," success"))}catch(n$){throw r$||(this._enabled=!1),_.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n$.toString()),n$}}else{this._originMediaStreamTrack.enabled=!1,r$||(this._enabled=!1);try{await kt(this,H.NEED_DISABLE_TRACK,this)}catch(n$){throw r$||(this._enabled=!0),_.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n$.toString()),n$}}}async setMuted(e$){e$!==this._muted&&(this.stateCheck("muted",e$),this._muted=e$,this._originMediaStreamTrack.enabled=!e$,_.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e$)),e$?await kt(this,H.NEED_MUTE_TRACK,this):await kt(this,H.NEED_UNMUTE_TRACK,this))}getStats(){return po(()=>{_.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),ni(this,H.GET_STATS)||Kt({},KE)}setAudioFrameCallback(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e$)return this._source.removeAllListeners(jn.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t$),this._source.removeAllListeners(jn.ON_AUDIO_BUFFER),this._source.on(jn.ON_AUDIO_BUFFER,r$=>e$(r$))}play(){_.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(_.debug("[".concat(this.getTrackId(),"] start audio playback in element")),En.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){_.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?En.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e$=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];_.debug("[".concat(this.getTrackId(),"] update player source track")),e$&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&En.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e$,t$){this._originMediaStreamTrack!==e$&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t$&&this._originMediaStreamTrack.stop()),e$.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e$,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e$,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await kt(this,H.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e$))}renewMediaStreamTrack(e$){return j.resolve(void 0)}pipe(e$){if(this._bypassWebAudio)throw new N(R.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e$)return e$;if(e$._source)throw new N(R.INVALID_OPERATION,"Processor ".concat(e$.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e$,this.processor._source=this,e$.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e$}unpipe(){var e$;if(!this.processor)return;let t$=this.processor;(e$=this._source.processSourceNode)===null||e$===void 0||e$.disconnect(),this.processor._source=!1,this.processor=void 0,t$.reset()}bindProcessorDestinationEvents(e$){e$.on(un.ON_TRACK,async t$=>{t$?t$!==this._mediaStreamTrack&&(this._mediaStreamTrack=t$,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t$),await kt(this,H.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await kt(this,H.NEED_REPLACE_TRACK,this))}),e$.on(un.ON_NODE,t$=>{this._source.processedNode=t$})}unbindProcessorDestinationEvents(e$){e$.removeAllListeners(un.ON_TRACK),e$.removeAllListeners(un.ON_NODE)}bindProcessorContextEvents(e$){e$.on(Wn.REQUEST_CONSTRAINTS,async t$=>{t$(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e$){e$.removeAllListeners(Wn.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Pc&&(this._trackSource=new $l(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e$=new iu(this._source.context,this.getTrackId(),"local"),t$=new nu(e$);return this._processorContext=e$,this._processorDestination=t$,this.bindProcessorContextEvents(e$),this.bindProcessorDestinationEvents(t$),this._source.on(jn.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e$})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(En.stop(this.getTrackId()),this._source.play()),kt(this,H.NEED_REPLACE_MIXING_TRACK,this).then(()=>{_.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(r$=>{_.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),r$)})),{processorContext:e$,processorDestination:t$}}}).prototype,"setVolume",[gC],Object.getOwnPropertyDescriptor(Yt.prototype,"setVolume"),Yt.prototype),Et(Yt.prototype,"setPlaybackDevice",[TC,SC],Object.getOwnPropertyDescriptor(Yt.prototype,"setPlaybackDevice"),Yt.prototype),Et(Yt.prototype,"setEnabled",[RC,CC,IC],Object.getOwnPropertyDescriptor(Yt.prototype,"setEnabled"),Yt.prototype),Et(Yt.prototype,"setMuted",[vC,yC,AC],Object.getOwnPropertyDescriptor(Yt.prototype,"setMuted"),Yt.prototype),Et(Yt.prototype,"getStats",[bC],Object.getOwnPropertyDescriptor(Yt.prototype,"getStats"),Yt.prototype),Et(Yt.prototype,"setAudioFrameCallback",[wC],Object.getOwnPropertyDescriptor(Yt.prototype,"setAudioFrameCallback"),Yt.prototype),Et(Yt.prototype,"play",[OC,NC],Object.getOwnPropertyDescriptor(Yt.prototype,"play"),Yt.prototype),Et(Yt.prototype,"stop",[DC,PC],Object.getOwnPropertyDescriptor(Yt.prototype,"stop"),Yt.prototype),Et(Yt.prototype,"close",[kC],Object.getOwnPropertyDescriptor(Yt.prototype,"close"),Yt.prototype),Et(Yt.prototype,"pipe",[LC],Object.getOwnPropertyDescriptor(Yt.prototype,"pipe"),Yt.prototype),Et(Yt.prototype,"unpipe",[MC],Object.getOwnPropertyDescriptor(Yt.prototype,"unpipe"),Yt.prototype),Yt),ou=(UC=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),xC=se(),VC=$s("MicrophoneAudioTrack","_enabledMutex"),FC=$({argsMap:(e$,t$,r$)=>[e$.getTrackId(),t$,r$]}),BC=se(),jC=$({argsMap:e$=>[e$.getTrackId()]}),Et((Ji=class extends Qt{get __className__(){return"MicrophoneAudioTrack"}constructor(e$,t$,r$,n$){super(e$,t$.encoderConfig?Jl(t$.encoderConfig):{},n$,v("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),P(this,"_config",void 0),P(this,"_deviceName","default"),P(this,"_constraints",void 0),P(this,"_originalConstraints",void 0),P(this,"_enabled",!0),this._config=t$,this._constraints=r$,this._originalConstraints=r$,this._deviceName=e$.label,typeof t$.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t$.bypassWebAudio),(Zs()||NE())&&wt.bindInterruptDetectorTrack(this)}async setDevice(e$){if(_.info("[".concat(this.getTrackId(),"] start set device to ").concat(e$)),this._enabled)try{let t$=await Gn.getDeviceById(e$),r$={};r$.audio=Kt({},this._constraints),r$.audio.deviceId={exact:e$},this._originMediaStreamTrack.stop();let n$=null;try{n$=await Fn(r$,this.getTrackId())}catch(i$){throw _.error("[".concat(this.getTrackId(),"] setDevice failed"),i$.toString()),n$=await Fn({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n$.getAudioTracks()[0],!1),i$}await this._updateOriginMediaStreamTrack(n$.getAudioTracks()[0],!1),this._deviceName=t$.label,this._config.microphoneId=e$,this._constraints.deviceId={exact:e$}}catch(t$){throw _.error("[".concat(this.getTrackId(),"] setDevice error"),t$.toString()),t$}else try{let t$=await Gn.getDeviceById(e$);this._deviceName=t$.label,this._config.microphoneId=e$,this._constraints.deviceId={exact:e$}}catch(t$){throw _.error("[".concat(this.getTrackId(),"] setDevice error"),t$.toString()),t$}_.info("[".concat(this.getTrackId(),"] set device to ").concat(e$," success"))}async setEnabled(e$,t$,r$){if(t$)return _.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e$);if(!r$){if(e$===this._enabled)return;this.stateCheck("enabled",e$)}if(_.info("[".concat(this.getTrackId(),"] start setEnabled"),e$),v("AUTO_RESET_AUDIO_ROUTE")&&(ln()||vi())){let s$=navigator.audioSession;s$&&(e$||(s$.type="playback"),s$.type="auto")}if(!e$){var n$;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(n$=this._source.clonedTrack)===null||n$===void 0||n$.stop(),r$||(this._enabled=!1);try{await kt(this,H.NEED_DISABLE_TRACK,this)}catch(s$){throw _.error("[".concat(this.getTrackId(),"] setEnabled false failed"),s$.toString()),s$}return}let i$=Kt({},this._constraints),o$=Gn.searchDeviceIdByName(this._deviceName);o$&&!i$.deviceId&&(i$.deviceId=o$);try{r$||(this._enabled=!0);let s$=await Fn({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s$.getAudioTracks()[0],!1),await kt(this,H.NEED_ENABLE_TRACK,this)}catch(s$){throw r$||(this._enabled=!1),_.error("[".concat(this.getTrackId(),"] setEnabled true failed"),s$.toString()),s$}_.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Zs()||NE())&&wt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((ln()||vi())&&this._enabled&&!this._isClosed&&wt.duringInterruption){let e$=async()=>{wt.off(ke.IOS_INTERRUPTION_END,e$),this._enabled&&!this._isClosed&&(_.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};wt.on(ke.IOS_INTERRUPTION_END,e$)}else _.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ma.TRACK_ENDED)}async renewMediaStreamTrack(e$){let t$=e$||this._constraints,r$=Gn.searchDeviceIdByName(this._deviceName);if(r$&&!t$.deviceId&&(t$.deviceId=r$),this._constraints=t$,this._enabled){this._originMediaStreamTrack.stop();let n$=await Fn({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n$.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e$){super.bindProcessorContextEvents(e$),e$.on(Wn.REQUEST_UPDATE_CONSTRAINTS,async(t$,r$,n$)=>{try{let i$=Object.assign({},this._originalConstraints,...t$);await this.renewMediaStreamTrack(i$),r$()}catch(i$){n$(i$)}})}unbindProcessorContextEvents(e$){super.unbindProcessorContextEvents(e$),e$.removeAllListeners(Wn.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[UC,xC],Object.getOwnPropertyDescriptor(Ji.prototype,"setDevice"),Ji.prototype),Et(Ji.prototype,"setEnabled",[VC,FC,BC],Object.getOwnPropertyDescriptor(Ji.prototype,"setEnabled"),Ji.prototype),Et(Ji.prototype,"close",[jC],Object.getOwnPropertyDescriptor(Ji.prototype,"close"),Ji.prototype),Ji),VG=(GC=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$,e$.duration]}),WC=se(),HC=$({argsMap:e$=>[e$.getTrackId()]}),KC=se(),YC=$({argsMap:e$=>[e$.getTrackId()]}),qC=se(),zC=$({argsMap:e$=>[e$.getTrackId()]}),JC=se(),XC=$({argsMap:e$=>[e$.getTrackId()]}),QC=se(),ZC=$({argsMap:e$=>[e$.getTrackId()]}),$C=$({argsMap:e$=>[e$.getTrackId()]}),tI=se(),Et((Ue=class extends Qt{get __className__(){return"BufferSourceAudioTrack"}constructor(e$,t$,r$,n$){super(t$.createOutputTrack(),r$,n$),P(this,"source",void 0),P(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e$,this._bufferSource=t$,this._bufferSource.on(jn.AUDIO_SOURCE_STATE_CHANGE,i$=>{this.safeEmit(ma.SOURCE_STATE_CHANGE,i$)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e$){e$&&this._bufferSource.updateOptions(e$),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e$){this._bufferSource.seekAudioBuffer(e$)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e$){Nt(e$,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e$)}}).prototype,"startProcessAudioBuffer",[GC,WC],Object.getOwnPropertyDescriptor(Ue.prototype,"startProcessAudioBuffer"),Ue.prototype),Et(Ue.prototype,"pauseProcessAudioBuffer",[HC,KC],Object.getOwnPropertyDescriptor(Ue.prototype,"pauseProcessAudioBuffer"),Ue.prototype),Et(Ue.prototype,"seekAudioBuffer",[YC,qC],Object.getOwnPropertyDescriptor(Ue.prototype,"seekAudioBuffer"),Ue.prototype),Et(Ue.prototype,"resumeProcessAudioBuffer",[zC,JC],Object.getOwnPropertyDescriptor(Ue.prototype,"resumeProcessAudioBuffer"),Ue.prototype),Et(Ue.prototype,"stopProcessAudioBuffer",[XC,QC],Object.getOwnPropertyDescriptor(Ue.prototype,"stopProcessAudioBuffer"),Ue.prototype),Et(Ue.prototype,"close",[ZC],Object.getOwnPropertyDescriptor(Ue.prototype,"close"),Ue.prototype),Et(Ue.prototype,"setAudioBufferPlaybackSpeed",[$C,tI],Object.getOwnPropertyDescriptor(Ue.prototype,"setAudioBufferPlaybackSpeed"),Ue.prototype),Ue),ge=class A5 extends Qt{get __className__(){return"MixingAudioTrack"}get isActive(){for(let t$ of this.trackList)if(t$._enabled&&!t$._isClosed&&!t$.muted)return!0;return!1}constructor(){let t$=ga().createMediaStreamDestination();super(t$.stream.getAudioTracks()[0],void 0,Ut(8,"track-mix-")),P(this,"trackList",void 0),P(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t$,this.trackList=[]}hasAudioTrack(t$){return this.trackList.indexOf(t$)!==-1}addAudioTrack(t$){this.trackList.indexOf(t$)===-1?(_.debug("add ".concat(t$.getTrackId()," to mixing track")),t$._source.outputNode.connect(this.destNode),this.trackList.push(t$),this.updateEncoderConfig()):_.debug("track ".concat(t$.getTrackId()," is already added"))}removeAudioTrack(t$){if(this.trackList.indexOf(t$)!==-1){_.debug("remove ".concat(t$.getTrackId()," from mixing track"));try{t$._source.outputNode.disconnect(this.destNode)}catch{}Wl(this.trackList,t$),this.updateEncoderConfig()}}updateEncoderConfig(){let t$={};this.trackList.forEach(r$=>{r$._encoderConfig&&((r$._encoderConfig.bitrate||0)>(t$.bitrate||0)&&(t$.bitrate=r$._encoderConfig.bitrate),(r$._encoderConfig.sampleRate||0)>(t$.sampleRate||0)&&(t$.sampleRate=r$._encoderConfig.sampleRate),(r$._encoderConfig.sampleSize||0)>(t$.sampleSize||0)&&(t$.sampleSize=r$._encoderConfig.sampleSize),r$._encoderConfig.stereo&&(t$.stereo=!0))}),this._encoderConfig=t$}_updateRtpTransceiver(t$){this._rtpTransceiver!==t$&&(this._rtpTransceiver=t$,this.trackList.forEach(r$=>{r$ instanceof A5?r$.emit(Ko.TRANSCEIVER_UPDATED,t$):r$._updateRtpTransceiver(t$)}))}},JE=class extends Zl{set currentState(e$){e$!==this._currentState&&(this._currentState=e$,this.safeEmit(jn.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),P(this,"audioBuffer",void 0),P(this,"sourceNode",void 0),P(this,"startPlayTime",0),P(this,"startPlayOffset",0),P(this,"pausePlayTime",0),P(this,"options",void 0),P(this,"currentLoopCount",0),P(this,"currentPlaybackSpeed",100),P(this,"_currentState","stopped"),this.audioBuffer=e$,this.options=t$,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e$){this.currentState==="stopped"?(this.options=e$,this.startPlayOffset=this.options.startPlayTime||0):_.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e$){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e$,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e$))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e$){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e$/100),this.currentPlaybackSpeed=e$}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let e$=this.context.createBufferSource();return e$.buffer=this.audioBuffer,e$.loop=!!this.options.loop,e$.connect(this.outputNode),e$.playbackRate.value=this.currentPlaybackSpeed/100,e$}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}},eI=new Map,kc=class{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){let e$=this.renderStats.curTs-this.renderStats.lastTs,t$=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e$;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,t$}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e$){e$!==this._videoElementStatus&&(_.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e$)),this._videoElementStatus=e$)}get videoState(){return this._videoState}set videoState(e$){var t$;e$!==this._videoState&&(this._videoState=e$,(t$=this.onVideoStateChanged)===null||t$===void 0||t$.call(this,this.videoState))}constructor(e$){P(this,"trackId",void 0),P(this,"config",void 0),P(this,"onFirstVideoFrameDecoded",void 0),P(this,"onVideoStateChanged",void 0),P(this,"freezeTimeCounterList",[]),P(this,"renderFreezeAccTime",0),P(this,"isKeepLastFrame",!1),P(this,"timeUpdatedCount",0),P(this,"freezeTime",0),P(this,"playbackTime",0),P(this,"lastTimeUpdatedTime",0),P(this,"autoplayFailed",!1),P(this,"videoTrack",void 0),P(this,"videoElement",void 0),P(this,"cacheVideoElement",void 0),P(this,"renderStats",void 0),P(this,"_videoState",zi.VideoStateStopped),P(this,"videoElementCheckInterval",void 0),P(this,"videoElementFreezeTimeout",void 0),P(this,"_videoElementStatus",nn.NONE),P(this,"isGettingVideoDimensions",!1),P(this,"startGetVideoDimensions",()=>{let t$=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return _.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(t$,500)};!this.isGettingVideoDimensions&&t$()}),P(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&wt.curState==="running"&&(_.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(dR())),pR()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),P(this,"handleVideoEvents",t$=>{switch(t$.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=nn.PLAYING;break;case"loadeddata":if(this.videoState=zi.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=nn.CANPLAY;break;case"stalled":this.videoElementStatus=nn.STALLED;break;case"suspend":this.videoElementStatus=nn.SUSPEND;break;case"pause":this.videoElementStatus=nn.PAUSED,ln()||vi()||je()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(_.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=nn.WAITING;break;case"abort":this.videoElementStatus=nn.ABORT;break;case"ended":this.videoElementStatus=nn.ENDED;break;case"emptied":this.videoElementStatus=nn.EMPTIED;break;case"error":{let r$=this.videoElement.error;r$?(this.videoElementStatus=nn.ERROR,_.error("[".concat(this.trackId,"] media error: ").concat(r$.message," (").concat(r$.code,")"))):_.debug("[".concat(this.trackId,"] media not been an error."));break}case"timeupdate":{let r$=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r$);let n$=r$-this.lastTimeUpdatedTime,i$=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r$,yr.lastVisibleTime<yr.lastHiddenTime||i$<yr.lastHiddenTime||i$<yr.lastVisibleTime)return;for(n$>v("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=n$),this.playbackTime+=n$;this.playbackTime>=6e3;){this.playbackTime-=6e3;let o$=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(o$),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),P(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(_.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(dR())),pR()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e$.trackId,this.config=e$,e$.element instanceof HTMLVideoElement?this.videoElement=e$.element:this.videoElement=document.createElement("video"),wt.on(ke.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),wt.on(ke.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e$;return(e$=this.videoElement.parentElement)!==null&&e$!==void 0?e$:void 0}updateConfig(e$){this.config=e$,this.trackId=e$.trackId,e$.element!==this.videoElement&&(this.destroy(),this.videoElement=e$.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e$){this.videoTrack!==e$&&(this.videoTrack=e$,this.initVideoElement())}play(e$){let t$=this.videoElement.play();t$&&t$.catch&&t$.catch(n$=>{e$&&JO(e$,"video",n$.message,this.trackId),n$.name==="NotAllowedError"?(_.warning("detected video element autoplay failed",n$),this.autoplayFailed=!0,this.handleAutoPlayFailed()):_.warning("[".concat(this.trackId,"] play warning: "),n$)});let r$=mt();if((r$.name==="Safari"&&Number(r$.version)===15||Zs())&&t$&&t$.then){let n$=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t$.then(n$).catch(n$)}}getCurrentFrame(){let e$=document.createElement("canvas");e$.width=this.videoElement.videoWidth,e$.height=this.videoElement.videoHeight;let t$=e$.getContext("2d");if(!t$)return _.error("create canvas context failed!"),new ImageData(2,2);t$.drawImage(this.videoElement,0,0,e$.width,e$.height);let r$=t$.getImageData(0,0,e$.width,e$.height);return e$.remove(),r$}async getCurrentFrameToUint8Array(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r$=document.createElement("canvas");r$.width=this.videoElement.videoWidth,r$.height=this.videoElement.videoHeight;let n$=r$.getContext("2d");return n$?(n$.drawImage(this.videoElement,0,0,r$.width,r$.height),new j((i$,o$)=>{r$.toBlob(async s$=>{if(r$.remove(),s$){let a$=await ZO(s$);i$({buffer:a$,width:r$.width,height:r$.height})}else o$(new N(R.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e$,t$<0?.1:t$>1?1:t$)})):await Cf(e$)}destroy(){this.renderStats=void 0,wt.off(ke.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),wt.off(ke.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=zi.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=nn.INIT,!this.videoElementCheckInterval&&(nI.forEach(i$=>{this.videoElement.addEventListener(i$,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(i$){return i$!==document.body&&document.body.contains(i$)})(this.videoElement)||(this.videoElementStatus=nn.DESTROYED)},1e3),v("ENABLE_VIDEO_FRAME_CALLBACK"))){var e$,t$;let i$,o$=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",o$),this.videoElementFreezeTimeout=window.setTimeout(s$,v("VIDEO_FREEZE_DURATION")))},s$=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===zi.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=zi.VideoStateFrozen:document.addEventListener("visibilitychange",o$))},a$=(c$,u$)=>{if(this.videoElementStatus===nn.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=u$.mediaTime):this.renderStats={lastTs:u$.mediaTime,curTs:u$.mediaTime,lastRenderNum:0,renderNum:0},i$){let h$=u$.presentationTime-i$.presentationTime;this.videoState===zi.VideoStateStarting&&(this.videoState=zi.VideoStateDecoding),this.videoState===zi.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(s$,v("VIDEO_FREEZE_DURATION"))),h$<v("VIDEO_FREEZE_DURATION")&&this.videoState===zi.VideoStateFrozen&&(this.videoState=zi.VideoStateDecoding),h$>v("VIDEO_FREEZE_DURATION")&&yr.lastVisibleTime>=yr.lastHiddenTime&&i$.timestamp>yr.lastVisibleTime&&i$.timestamp>yr.lastHiddenTime&&(this.renderFreezeAccTime+=h$)}i$=Kt(Kt({},u$),{},{timestamp:c$})}var l$,d$;v("ENABLE_VIDEO_FRAME_CALLBACK")&&((l$=(d$=this.videoElement).requestVideoFrameCallback)===null||l$===void 0||l$.call(d$,a$))};(e$=(t$=this.videoElement).requestVideoFrameCallback)===null||e$===void 0||e$.call(t$,a$)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Ku()&&!v("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let r$=mt();r$.name==="Safari"&&Number(r$.version)===15||Zs()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,$t()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,$t()&&this.videoElement.load());let n$=this.videoElement.play();n$!==void 0&&n$.catch(i$=>{_.debug("[".concat(this.trackId,"] playback interrupted"),i$.toString())})}resetVideoElement(){nI.forEach(e$=>{this.videoElement&&this.videoElement.removeEventListener(e$,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=nn.NONE}handleAutoPlayFailed(){let e$=t$=>{t$.preventDefault(),this.videoElement.play().then(()=>{_.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r$=>{_.error(r$)}),this.autoplayFailed=!1,yc()?document.body.removeEventListener("click",e$,!0):(document.body.removeEventListener("touchstart",e$,!0),document.body.removeEventListener("mousedown",e$,!0))};yc()?document.body.addEventListener("click",e$,!0):(document.body.addEventListener("touchstart",e$,!0),document.body.addEventListener("mousedown",e$,!0)),zO()}},nI=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"],su=class extends kc{constructor(e$){super(e$),P(this,"container",void 0),P(this,"slot",void 0),this.slot=e$.element,this.updateConfig(e$)}updateConfig(e$){this.config=e$,this.trackId=e$.trackId;let t$=e$.element;t$!==this.slot&&(this.destroy(),this.slot=t$),this.createElements()}updateVideoTrack(e$){this.videoTrack!==e$&&(this.videoTrack=e$,this.createElements())}play(e$){var t$;(t$=this.container)!==null&&t$!==void 0&&t$.contains(this.videoElement)&&super.play(e$)}getCurrentFrame(){var e$;return(e$=this.container)!==null&&e$!==void 0&&e$.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e$){var t$;let r$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(t$=this.container)!==null&&t$!==void 0&&t$.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e$,r$):await Cf(e$)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",v("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e$;!this.container||(e$=this.container)!==null&&e$!==void 0&&e$.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e$;if((e$=this.container)!==null&&e$!==void 0&&e$.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e$;(e$=this.container)!==null&&e$!==void 0&&e$.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}},iI,rI,oI,sI,aI,cI,dI,lI,uI,hI,pI,_I,EI,mI,fI,gI,TI,SI,RI,CI,II,vI,yI,AI,ht,bI,wI,OI,NI,DI,PI,kI,LI,Ln,Ft=(iI=$({argsMap:(e$,t$,r$)=>[e$.getTrackId(),typeof t$=="string"?t$:t$ instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r$]}),rI=se(),oI=$({argsMap:e$=>[e$.getTrackId()]}),sI=$s("LocalVideoTrack","_enabledMutex"),aI=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),cI=se(),dI=$s("LocalVideoTrack","_enabledMutex"),lI=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),uI=se(),hI=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),pI=se(),_I=se(),EI=$({argsMap:(e$,t$,r$)=>[e$.getTrackId(),t$,r$]}),mI=se(),fI=se(),gI=se(),TI=se(),SI=se(),RI=se(),CI=se(),II=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$.name]}),vI=$({argsMap:e$=>[e$.getTrackId()]}),yI=$({argsMap:e$=>[e$.getTrackId()]}),AI=$({argsMap:(e$,t$,r$)=>[e$.getTrackId(),t$.label,r$]}),ht=class O5 extends no{get videoHeight(){if(je()){let{height:t$}=this._mediaStreamTrack.getSettings();return this._videoHeight=t$,this._videoHeight}return this._videoHeight}get videoWidth(){if(je()){let{width:t$}=this._mediaStreamTrack.getSettings();return this._videoWidth=t$,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==nn.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t$){this._processorContext=t$}get __className__(){return"LocalVideoTrack"}constructor(t$,r$,n$,i$,o$,s$){if(super(t$,o$),P(this,"trackMediaType",fa.VIDEO),P(this,"_player",void 0),P(this,"isUseScaleResolutionDownBy",!1),P(this,"_videoVisibleTimer",null),P(this,"_previousVideoVisibleStatus",void 0),P(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),P(this,"_encoderConfig",void 0),P(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),P(this,"_optimizationMode",void 0),P(this,"_videoHeight",void 0),P(this,"_videoWidth",void 0),P(this,"_forceBitrateLimit",void 0),P(this,"_enabled",!0),P(this,"_processorDestination",void 0),P(this,"_processorContext",void 0),je()){let{width:a$,height:c$}=t$.getSettings();this._videoWidth=a$,this._videoHeight=c$}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=r$,this._scalabilityMode=n$,this._optimizationMode=i$,this._hints=s$||[],this._hints.indexOf(Gt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(a$,c$,u$){let l$=mt();return!(l$.name!==a$||!l$.osVersion)&&Number(l$.version)===c$}(It.CHROME,115)&&Hu().indexOf("Windows")!==-1){let a$=function(c$,u$){if("VideoFrame"in window&&"TransformStream"in window&&ft().supportWebRTCInsertableStream){let l$=new MediaStreamTrackProcessor(c$),d$=new MediaStreamTrackGenerator({kind:"video"}),h$,p$,_$=Date.now(),f$=()=>{m$&&(clearInterval(m$),m$=void 0),h$&&(h$.close(),h$=void 0),c$.stop(),p$=void 0,d$.removeEventListener("ended",f$)},m$=window.setInterval(()=>{if(p$&&h$&&Date.now()-_$>1e3)try{d$.readyState==="live"?p$.enqueue(h$.clone()):f$()}catch{f$()}},1e3),g$=new TransformStream({transform:(v$,y$)=>{d$.readyState==="live"?(p$=y$,_$=Date.now(),h$===void 0?(h$=v$,y$.enqueue(v$.clone())):(y$.enqueue(h$),h$=v$)):v$.close()}});return d$.addEventListener("ended",f$),l$.readable.pipeThrough(g$).pipeTo(d$.writable),d$}}(t$);a$&&(_.info("local screen video track begin to inject frame"),this._mediaStreamTrack=a$)}r$&&this._hints.indexOf(Gt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(r$),this._processorContext=new eu(this.getTrackId(),"local"),this._processorDestination=new tu(this.processorContext),this.bindProcessorDestinationEvents()}play(t$){let r$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t$=="string"){let i$=document.getElementById(t$);i$?t$=i$:(_.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t$,'" element, use document.body')),t$=document.body)}_.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t$ instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r$));let n$=Kt(Kt(Kt({},this._getDefaultPlayerConfig()),r$),{},{trackId:this.getTrackId(),element:t$});this._player?this._player.updateConfig(n$):(t$ instanceof HTMLVideoElement?this._player=new kc(n$):this._player=new su(n$),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let i$=this.getVideoElementVisibleStatus();this.safeEmit(ma.VIDEO_ELEMENT_VISIBLE_STATUS,i$)}catch{}},v("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,_.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t$,r$){if(!r$){if(t$===this._enabled)return;this.stateCheck("enabled",t$)}if(_.info("[".concat(this.getTrackId(),"] start setEnabled"),t$),!t$){this._originMediaStreamTrack.enabled=!1;try{await kt(this,H.NEED_DISABLE_TRACK,this)}catch(n$){throw _.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n$.toString()),n$}return r$||(this._enabled=!1),void _.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await kt(this,H.NEED_ENABLE_TRACK,this)}catch(n$){throw _.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n$.toString()),n$}_.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r$||(this._enabled=!0)}async setMuted(t$){t$!==this._muted&&(this.stateCheck("muted",t$),this._muted=t$,this._originMediaStreamTrack.enabled=!t$,_.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t$)),t$?await kt(this,H.NEED_MUTE_TRACK,this):await kt(this,H.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t$,r$){if(!this._enabled)throw new N(R.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t$=cr(t$),this._forceBitrateLimit&&(t$.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t$.bitrateMax,t$.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t$.bitrateMin),t$.width||t$.height||t$.frameRate){let n$=ru({encoderConfig:t$});(je()||ln()||vi())&&(n$.deviceId=void 0),_.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t$),JSON.stringify(n$));try{await this._originMediaStreamTrack.applyConstraints(n$),this.updateMediaStreamTrackResolution()}catch(i$){let o$=new N(R.UNEXPECTED_ERROR,i$.toString());throw _.error("[".concat(this.getTrackId(),"] applyConstraints error"),o$.toString()),o$}}this._encoderConfig=t$,this._hints.indexOf(Gt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await kt(this,H.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n$){return n$.throw(_)}}getStats(){return po(()=>{_.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),ni(this,H.GET_STATS)||Kt({},YE)}async setBeautyEffect(t$){_.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t$){let r$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t$,r$):await Cf(t$)}async setBitrateLimit(t$){if(_.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t$))),t$){this._forceBitrateLimit=t$,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t$.max_bitrate?this._encoderConfig.bitrateMax:t$.max_bitrate:this._encoderConfig.bitrateMax=t$.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t$.min_bitrate);try{await kt(this,H.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r$){return r$.throw(_)}}}async setOptimizationMode(t$){if(t$!=="motion"&&t$!=="detail"&&t$!=="balanced")return void _.error(R.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let r$=this._optimizationMode;try{this._optimizationMode=t$,await kt(this,H.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(n$){throw this._optimizationMode=r$,_.error("[".concat(this.getTrackId(),"] set optimization mode failed"),n$.toString()),n$}_.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t$,")"))}setScalabiltyMode(t$){if(t$.numSpatialLayers===1&&t$.numTemporalLayers!==1)return _.error(R.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t$,_.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t$,")"))}updateMediaStreamTrackResolution(){XO(this._originMediaStreamTrack).then(t$=>{let[r$,n$]=t$;this._videoHeight=n$,this._videoWidth=r$}).catch(zu)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t$){if(!this._enabled)throw new N(R.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");_.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t$)),t$=cr(t$),this._forceBitrateLimit&&(t$.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t$.bitrateMax,t$.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t$.bitrateMin),this._encoderConfig=t$,this._hints.indexOf(Gt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await kt(this,H.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r$){return r$.throw(_)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:t$,height:r$,frameRate:n$}=this.getMediaStreamTrackSettings();if(!t$||!r$||!n$)return;let{bitrateMax:i$,bitrateMin:o$}=this._encoderConfig;if(o$==null||i$==null){let{max:s$,min:a$}=function(c$,u$,l$,d$,h$){let p$=v("BITRATE_ADAPTER_TYPE");if(p$==="DEFAULT_BITRATE")return{min:d$,max:h$};if(h$===void 0){var _$;let m$=Math.floor(200*Math.pow(l$/15,.6)*Math.pow(c$*u$/640/360,.75));h$=p$==="STANDARD_BITRATE"?4*m$:2*m$,d$=(_$=d$)!==null&&_$!==void 0?_$:m$}else{var f$;d$=(f$=d$)!==null&&f$!==void 0?f$:Math.floor(h$/10)}return{min:d$,max:h$}}(t$,r$,n$,o$,i$);this._encoderConfig.bitrateMin=a$,this._encoderConfig.bitrateMax=s$,_.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t$,", h: ").concat(r$,", fps: ").concat(n$,"] => [brMax: ").concat(s$,", brMin: ").concat(a$,"]"))}}getVideoElementVisibleStatus(){try{var t$,r$;let n$=this==null||(t$=this._player)===null||t$===void 0?void 0:t$.getContainerElement(),i$={track:this,element:this==null||(r$=this._player)===null||r$===void 0?void 0:r$.getVideoElement(),slot:n$==null?void 0:n$.parentElement},{element:o$,slot:s$}=i$;if(this.isPlaying&&o$ instanceof HTMLVideoElement&&s$ instanceof HTMLElement){let a$=CO.checkOneElementVisible(o$),c$=Object.assign({},a$);if(c$.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c$.visible;let u$=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});c$.visible?u$.onSuccess("Video is visible"):u$.onSuccess("Invisible because of ".concat(c$.reason))}return c$}return}catch(n$){throw new N(R.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n$.message)}}async renewMediaStreamTrack(t$){}pipe(t$){if(this.processor===t$)return t$;if(t$._source)throw new N(R.INVALID_OPERATION,"Processor ".concat(t$.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t$,this.processor._source=this,t$.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t$}unpipe(){if(!this.processor)return;let t$=this.processor;this.processor._source=void 0,this.processor=void 0,t$.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t$){let r$=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n$=this._encoderConfig;t$&&(n$=Kt(Kt({},n$),cr(t$))),n$=Vo(n$);let i$=Ut(8,"track-video-cloned-"),o$=new O5(r$?this._mediaStreamTrack.clone():this._mediaStreamTrack,n$,Vo(this._scalabilityMode),this._optimizationMode,i$,Vo(this._hints));return t$&&n$&&o$.setEncoderConfiguration(n$),_.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i$,", clone ").concat(r$)),o$}async replaceTrack(t$,r$){if(!(t$ instanceof MediaStreamTrack))throw new N(R.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t$.kind!=="video")throw new N(R.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t$,r$,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t$){if(po(()=>{X.reportApiInvoke(null,{name:Te.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Zt.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!v("ENABLE_VIDEO_SEI")||!v("ENABLE_ENCODED_TRANSFORM"))return void _.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t$ instanceof Uint8Array==0)return new N(R.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let r$=this.getRTCRtpTransceiver();if(!r$)return void _.warning("Video track is not published, SEI can not be send");let n$=r$.sender.getParameters();if(n$.codecs.length===0)return;let i$=n$.codecs[0].mimeType.toLocaleLowerCase();i$==="video/h264"?this.safeEmit("sei-to-send",t$):_.warning("SEI is not supported by ".concat(i$))}bindProcessorDestinationEvents(){this.processorDestination.on(un.ON_TRACK,async t$=>{t$?t$!==this._mediaStreamTrack&&(this._mediaStreamTrack=t$,this._updatePlayerSource(),await kt(this,H.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await kt(this,H.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(un.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Wn.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Wn.REQUEST_CONSTRAINTS)}},Et(ht.prototype,"play",[iI,rI],Object.getOwnPropertyDescriptor(ht.prototype,"play"),ht.prototype),Et(ht.prototype,"stop",[oI],Object.getOwnPropertyDescriptor(ht.prototype,"stop"),ht.prototype),Et(ht.prototype,"setEnabled",[sI,aI,cI],Object.getOwnPropertyDescriptor(ht.prototype,"setEnabled"),ht.prototype),Et(ht.prototype,"setMuted",[dI,lI,uI],Object.getOwnPropertyDescriptor(ht.prototype,"setMuted"),ht.prototype),Et(ht.prototype,"setEncoderConfiguration",[hI,pI],Object.getOwnPropertyDescriptor(ht.prototype,"setEncoderConfiguration"),ht.prototype),Et(ht.prototype,"getStats",[_I],Object.getOwnPropertyDescriptor(ht.prototype,"getStats"),ht.prototype),Et(ht.prototype,"setBeautyEffect",[EI,mI],Object.getOwnPropertyDescriptor(ht.prototype,"setBeautyEffect"),ht.prototype),Et(ht.prototype,"getCurrentFrameData",[fI],Object.getOwnPropertyDescriptor(ht.prototype,"getCurrentFrameData"),ht.prototype),Et(ht.prototype,"getCurrentFrameImage",[gI],Object.getOwnPropertyDescriptor(ht.prototype,"getCurrentFrameImage"),ht.prototype),Et(ht.prototype,"setBitrateLimit",[TI],Object.getOwnPropertyDescriptor(ht.prototype,"setBitrateLimit"),ht.prototype),Et(ht.prototype,"setOptimizationMode",[SI],Object.getOwnPropertyDescriptor(ht.prototype,"setOptimizationMode"),ht.prototype),Et(ht.prototype,"setScalabiltyMode",[RI],Object.getOwnPropertyDescriptor(ht.prototype,"setScalabiltyMode"),ht.prototype),Et(ht.prototype,"updateMediaStreamTrackResolution",[CI],Object.getOwnPropertyDescriptor(ht.prototype,"updateMediaStreamTrackResolution"),ht.prototype),Et(ht.prototype,"pipe",[II],Object.getOwnPropertyDescriptor(ht.prototype,"pipe"),ht.prototype),Et(ht.prototype,"unpipe",[vI],Object.getOwnPropertyDescriptor(ht.prototype,"unpipe"),ht.prototype),Et(ht.prototype,"close",[yI],Object.getOwnPropertyDescriptor(ht.prototype,"close"),ht.prototype),Et(ht.prototype,"replaceTrack",[AI],Object.getOwnPropertyDescriptor(ht.prototype,"replaceTrack"),ht.prototype),ht),XE=(bI=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),wI=se(),OI=$s("CameraVideoTrack","_enabledMutex"),NI=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),DI=se(),PI=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),kI=se(),LI=$({argsMap:e$=>[e$.getTrackId()]}),Ln=class N5 extends Ft{get __className__(){return"CameraVideoTrack"}constructor(t$,r$,n$,i$,o$,s$){super(t$,cr(r$.encoderConfig),i$,o$,s$),P(this,"_config",void 0),P(this,"_originalConstraints",void 0),P(this,"_constraints",void 0),P(this,"_enabled",!0),P(this,"_deviceName","default"),P(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Zs()||NE())&&!function(){let a$=mt();if(a$.os!==ye.IOS||!a$.osVersion)return!1;let c$=a$.osVersion.split(".");return Number(c$[0])===15&&Number(c$[1])>=2}()&&TO()&&this._enabled&&!this._isClosed&&(_.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=r$,this._originalConstraints=n$,this._constraints=n$,this._deviceName=t$.label,this._encoderConfig=cr(this._config.encoderConfig),wt.on(ke.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),wt.on(ke.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t$){return typeof t$=="string"?this._setDeviceById(t$):t$.deviceId?this._setDeviceById(t$.deviceId):t$.facingMode?this._setDeviceByFacingModel(t$.facingMode):void 0}async _setDeviceById(t$){if(_.info("[".concat(this.getTrackId(),"] set device to ").concat(t$)),this._enabled)try{let r$=await Gn.getDeviceById(t$),n$={};n$.video=Kt({},this._constraints),n$.video.deviceId={exact:t$},n$.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i$=null;try{i$=await Fn(n$,this.getTrackId())}catch(o$){throw _.error("[".concat(this.getTrackId(),"] setDevice failed"),o$.toString()),i$=await Fn({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i$.getVideoTracks()[0],!1),o$}await this._updateOriginMediaStreamTrack(i$.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=r$.label,this._config.cameraId=t$,this._constraints.deviceId={exact:t$}}catch(r$){throw _.error("[".concat(this.getTrackId(),"] setDevice error"),r$.toString()),r$}else try{let r$=await Gn.getDeviceById(t$);this._deviceName=r$.label,this._config.cameraId=t$,this._constraints.deviceId={exact:t$}}catch(r$){throw _.error("[".concat(this.getTrackId(),"] setDevice error"),r$.toString()),r$}_.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t$){_.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t$));let r$={video:Kt(Kt({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t$}})};if(this._enabled){this._originMediaStreamTrack.stop();let n$=null;try{n$=await Fn(r$,this.getTrackId())}catch(i$){throw _.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i$.toString()),n$=await Fn({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n$.getVideoTracks()[0],!1),i$}await this._updateOriginMediaStreamTrack(n$.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t$,this._config.cameraId=void 0,this._constraints=Kt({},r$.video),_.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t$,r$){if(!r$){if(t$===this._enabled)return;this.stateCheck("enabled",t$)}if(_.info("[".concat(this.getTrackId(),"] start setEnabled"),t$),t$){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let n$=await Fn({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n$.getVideoTracks()[0],!1)}await kt(this,H.NEED_ENABLE_TRACK,this)}catch(n$){throw _.error("[".concat(this.getTrackId(),"] setEnabled true error"),n$.toString()),n$}this.updateMediaStreamTrackResolution(),_.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r$||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),r$||(this._enabled=!1);try{await kt(this,H.NEED_DISABLE_TRACK,this)}catch(n$){throw _.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n$.toString()),n$}_.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t$,r$){if(!this._enabled)throw new N(R.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t$=cr(t$),this._forceBitrateLimit&&(t$.bitrateMax=this._forceBitrateLimit.max_bitrate||t$.bitrateMax,t$.bitrateMin=this._forceBitrateLimit.min_bitrate||t$.bitrateMin);let n$=le(this._config);n$.encoderConfig=t$;let i$=ru(n$);(je()||ln()||vi())&&(i$.deviceId=void 0),_.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t$),JSON.stringify(i$));try{await this._originMediaStreamTrack.applyConstraints(i$),this.updateMediaStreamTrackResolution()}catch(o$){let s$=new N(R.UNEXPECTED_ERROR,o$.toString());throw _.error("[".concat(this.getTrackId(),"] applyConstraints error"),s$.toString()),s$}this._config=n$,this._constraints=i$,this._originalConstraints=i$,this._encoderConfig=t$,this._hints.indexOf(Gt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await kt(this,H.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o$){return o$.throw(_)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ln()||vi())&&this._enabled&&!this._isClosed&&wt.duringInterruption){let t$=async()=>{wt.off(ke.IOS_INTERRUPTION_END,t$),this._enabled&&!this._isClosed&&(_.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};wt.on(ke.IOS_INTERRUPTION_END,t$)}else _.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ma.TRACK_ENDED)}async renewMediaStreamTrack(t$){let r$=t$||this._constraints,n$=Gn.searchDeviceIdByName(this._deviceName);if(n$&&!r$.deviceId&&(r$.deviceId={exact:n$}),this._enabled){let i$=await Fn({video:r$},this.getTrackId());this._constraints=r$,await this._updateOriginMediaStreamTrack(i$.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),wt.off(ke.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),wt.off(ke.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t$){let r$=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n$=this._encoderConfig;t$&&(n$=Kt(Kt({},n$),cr(t$))),n$=Vo(n$);let i$=Ut(8,"track-cam-cloned-"),o$=new N5(r$?this._mediaStreamTrack.clone():this._mediaStreamTrack,Vo(Kt(Kt({},this._config),{},{encoderConfig:n$})),Vo(this._constraints),Vo(this._scalabilityMode),this._optimizationMode,i$);return t$&&n$&&o$.setEncoderConfiguration(n$),_.debug("clone track from ".concat(this.getTrackId()," to ").concat(i$,", clone ").concat(r$)),o$}bindProcessorContextEvents(){this.processorContext.on(Wn.REQUEST_UPDATE_CONSTRAINTS,async(t$,r$,n$)=>{try{let i$=Object.assign({},this._originalConstraints,...t$);await this.renewMediaStreamTrack(i$),r$()}catch(i$){n$(i$)}}),this.processorContext.on(Wn.REQUEST_CONSTRAINTS,async t$=>{t$(this._originMediaStreamTrack.getSettings())})}},Et(Ln.prototype,"setDevice",[bI,wI],Object.getOwnPropertyDescriptor(Ln.prototype,"setDevice"),Ln.prototype),Et(Ln.prototype,"setEnabled",[OI,NI,DI],Object.getOwnPropertyDescriptor(Ln.prototype,"setEnabled"),Ln.prototype),Et(Ln.prototype,"setEncoderConfiguration",[PI,kI],Object.getOwnPropertyDescriptor(Ln.prototype,"setEncoderConfiguration"),Ln.prototype),Et(Ln.prototype,"close",[LI],Object.getOwnPropertyDescriptor(Ln.prototype,"close"),Ln.prototype),Ln);function c_(e$,t$,r$,n$){r$.optimizationMode&&(n$&&n$.width&&n$.height?(r$.encoderConfig=Kt(Kt({},n$),{},{bitrateMin:n$.bitrateMin,bitrateMax:n$.bitrateMax}),r$.optimizationMode!=="motion"&&r$.optimizationMode!=="detail"||(t$.contentHint=r$.optimizationMode,t$.contentHint===r$.optimizationMode?_.debug("[".concat(e$,"] set content hint to"),r$.optimizationMode):_.debug("[".concat(e$,"] set content hint failed")))):_.warning("[".concat(e$,"] can not apply optimization mode bitrate config, no encoderConfig")))}var MI,UI,xI,VI,zn,FI,BI,jI,GI,WI,HI,$e,au=class extends Xl{getUserId(){return this._userId}constructor(e$,t$,r$,n$){super(e$,"track-".concat(e$.kind,"-").concat(t$,"-").concat(n$.clientId,"_").concat(Ut(5,""))),P(this,"_userId",void 0),P(this,"_uintId",void 0),P(this,"_isDestroyed",!1),P(this,"store",void 0),P(this,"processor",void 0),P(this,"processorContext",void 0),this._userId=t$,this._uintId=r$,this.store=n$}_updateOriginMediaStreamTrack(e$){this._originMediaStreamTrack=e$,this._mediaStreamTrack=e$,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,_.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}},Hs=(MI=$({argsMap:(e$,t$,r$)=>[e$.getTrackId(),typeof t$=="string"?t$:t$ instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r$]}),UI=$({argsMap:e$=>[e$.getTrackId()]}),xI=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$.name]}),VI=$({argsMap:e$=>[e$.getTrackId()]}),Et((zn=class extends au{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==nn.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e$,t$,r$,n$){super(e$,t$,r$,n$),P(this,"_videoVisibleTimer",null),P(this,"_previousVideoVisibleStatus",void 0),P(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),P(this,"trackMediaType",fa.VIDEO),P(this,"_videoWidth",void 0),P(this,"_videoHeight",void 0),P(this,"_player",void 0),P(this,"processorDestination",void 0),P(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new eu(this.getTrackId(),"remote"),this.processorDestination=new tu(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return po(()=>{_.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),ni(this,H.GET_STATS)||Kt({},WO)}play(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e$=="string"){let n$=document.getElementById(e$);n$?e$=n$:(_.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e$,'" element, use document.body')),e$=document.body)}_.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e$ instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t$));let r$=Kt(Kt({fit:"cover"},t$),{},{trackId:this.getTrackId(),element:e$});this._player?this._player.updateConfig(r$):(e$ instanceof HTMLVideoElement?this._player=new kc(r$):this._player=new su(r$),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Ws.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=n$=>{this.safeEmit(Ws.VIDEO_STATE_CHANGED,n$)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let n$=this.getVideoElementVisibleStatus();this.safeEmit(Ws.VIDEO_ELEMENT_VISIBLE_STATUS,n$)}catch{}},v("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,_.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){XO(this._originMediaStreamTrack).then(e$=>{let[t$,r$]=e$;this._videoHeight=r$,this._videoWidth=t$}).catch(zu)}_updatePlayerSource(){_.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e$,t$;let r$=this==null||(e$=this._player)===null||e$===void 0?void 0:e$.getContainerElement(),n$={track:this,element:this==null||(t$=this._player)===null||t$===void 0?void 0:t$.getVideoElement(),slot:r$==null?void 0:r$.parentElement},{element:i$,slot:o$}=n$;if(this.isPlaying&&i$ instanceof HTMLVideoElement&&o$ instanceof HTMLElement){let s$=CO.checkOneElementVisible(i$),a$=Object.assign({},s$);if(a$.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=a$.visible;let c$=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});a$.visible?c$.onSuccess("Video is visible"):c$.onSuccess("Invisible because of ".concat(a$.reason))}return a$}return}catch(r$){throw new N(R.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r$.message)}}pipe(e$){if(this.processor===e$)return e$;if(e$._source)throw new N(R.INVALID_OPERATION,"Processor ".concat(e$.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e$,this.processor._source=this,e$.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e$}unpipe(){if(!this.processor)return;let e$=this.processor;this.processor._source=void 0,this.processor=void 0,e$.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(un.ON_TRACK,async e$=>{e$?e$!==this._mediaStreamTrack&&(this._mediaStreamTrack=e$,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(un.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e$){this.emit(Ko.SEI_RECEIVED,e$)}}).prototype,"play",[MI],Object.getOwnPropertyDescriptor(zn.prototype,"play"),zn.prototype),Et(zn.prototype,"stop",[UI],Object.getOwnPropertyDescriptor(zn.prototype,"stop"),zn.prototype),Et(zn.prototype,"pipe",[xI],Object.getOwnPropertyDescriptor(zn.prototype,"pipe"),zn.prototype),Et(zn.prototype,"unpipe",[VI],Object.getOwnPropertyDescriptor(zn.prototype,"unpipe"),zn.prototype),zn),Ks=(FI=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$],throttleTime:300}),BI=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$]}),jI=$({argsMap:e$=>[e$.getTrackId()]}),GI=$({argsMap:e$=>[e$.getTrackId()]}),WI=$({argsMap:(e$,t$)=>[e$.getTrackId(),t$.name]}),HI=$({argsMap:e$=>[e$.getTrackId()]}),Et(($e=class extends au{get isPlaying(){return this._useAudioElement?En.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e$,t$,r$,n$){super(e$,t$,r$,n$),P(this,"trackMediaType",fa.AUDIO),P(this,"_source",void 0),P(this,"_useAudioElement",!0),P(this,"_volume",100),P(this,"processorContext",void 0),P(this,"processorDestination",void 0),P(this,"_played",!1),P(this,"_bypassWebAudio",!1),v("DISABLE_WEBAUDIO")?(this._source=new Pc,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new $l(e$,!0),v("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(jn.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Ws.FIRST_FRAME_DECODED)}),this.processorContext=new iu(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new nu(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(jn.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e$)return this._source.removeAllListeners(jn.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t$),this._source.removeAllListeners(jn.ON_AUDIO_BUFFER),this._source.on(jn.ON_AUDIO_BUFFER,r$=>e$(r$))}setVolume(e$){this._volume=e$,this._useAudioElement?En.setVolume(this.getTrackId(),e$):this._source.setVolume(e$/100)}async setPlaybackDevice(e$){if(!this._useAudioElement||!jO())throw new N(R.NOT_SUPPORTED,"your browser does not support setting the audio output device");await En.setSinkID(this.getTrackId(),e$)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return po(()=>{_.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),ni(this,H.GET_STATS)||Kt({},GO)}play(){_.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(_.debug("[".concat(this.getTrackId(),"] use audio element to play")),En.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){_.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?En.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e$=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];_.debug("[".concat(this.getTrackId(),"] update player source track")),e$&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&En.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e$){if(this._bypassWebAudio)throw new N(R.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e$)return e$;if(e$._source)throw new N(R.INVALID_OPERATION,"Processor ".concat(e$.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e$,this.processor._source=this,e$.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e$}unpipe(){var e$;if(this._bypassWebAudio)throw new N(R.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t$=this.processor;(e$=this._source.processSourceNode)===null||e$===void 0||e$.disconnect(),this.processor._source=!1,this.processor=void 0,t$.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(un.ON_TRACK,async e$=>{e$?e$!==this._mediaStreamTrack&&(this._mediaStreamTrack=e$,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e$)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(un.ON_NODE,e$=>{this._source.processedNode=e$;let t$=!e$;this._useAudioElement!==t$&&(this._played?(this.stop(),this._useAudioElement=t$,this.play()):this._useAudioElement=t$)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(un.ON_TRACK),this.processorDestination.removeAllListeners(un.ON_NODE)}}).prototype,"setVolume",[FI],Object.getOwnPropertyDescriptor($e.prototype,"setVolume"),$e.prototype),Et($e.prototype,"setPlaybackDevice",[BI],Object.getOwnPropertyDescriptor($e.prototype,"setPlaybackDevice"),$e.prototype),Et($e.prototype,"play",[jI],Object.getOwnPropertyDescriptor($e.prototype,"play"),$e.prototype),Et($e.prototype,"stop",[GI],Object.getOwnPropertyDescriptor($e.prototype,"stop"),$e.prototype),Et($e.prototype,"pipe",[WI],Object.getOwnPropertyDescriptor($e.prototype,"pipe"),$e.prototype),Et($e.prototype,"unpipe",[HI],Object.getOwnPropertyDescriptor($e.prototype,"unpipe"),$e.prototype),$e),yr=new class extends Xt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),P(this,"_lastHiddenTime",0),P(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),_.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}},cu=class extends Xt{constructor(e$,t$){super(),P(this,"trackMediaType",fa.DATA),P(this,"_version",1),P(this,"_type",3),P(this,"_config",void 0),P(this,"_originDataChannel",void 0),P(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),P(this,"_dataStreamPacketHandler",{serialize:r$=>r$,deserialize:r$=>r$}),P(this,"_datachannelEventMap",new Map),this._config=e$,t$&&(this._originDataChannel=t$,this._bandDataChannelEvents(t$)),this._initPacketHeader()}useDataStream(e$){this._dataStreamPacketHandler=e$}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return v("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e$,t$;return(e$=(t$=this._originDataChannel)===null||t$===void 0?void 0:t$.readyState)!==null&&e$!==void 0?e$:"connecting"}get _originDataChannelId(){var e$,t$;return(e$=(t$=this._originDataChannel)===null||t$===void 0?void 0:t$.id)!==null&&e$!==void 0?e$:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new j((e$,t$)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e$();let r$=setTimeout(()=>{var n$;t$(new N(R.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((n$=this._originDataChannel)===null||n$===void 0?void 0:n$.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r$),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e$()},this._originDataChannel.onerror=()=>{throw clearTimeout(r$),new N(R.DATACHANNEL_CONNECTION_TIMEOUT)}}else t$(new N(R.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e$){this._originDataChannel=e$,this._bandDataChannelEvents(e$)}_initPacketHeader(){let e$=new DataView(this._dataStreamPacketHeader);e$.setUint16(0,this._version),e$.setUint8(2,this._type),e$.setUint8(3,this._config.id)}_bandDataChannelEvents(e$){this._unbindDataChannelEvents(e$),[Cl.OPEN,Cl.CLOSE,Cl.ERROR].forEach(t$=>{let r$=()=>{this.emit(t$)};this._datachannelEventMap.set(t$,r$),e$.addEventListener(t$,r$)})}_unbindDataChannelEvents(e$){Array.from(this._datachannelEventMap.entries()).forEach(t$=>{let[r$,n$]=t$;e$.removeEventListener(r$,n$)}),this._datachannelEventMap.clear()}},QE=class extends cu{constructor(e$){super(e$),P(this,"_messageListener",void 0),this._messageListener=t$=>{if(t$.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let r$=t$.data.slice(0,this._dataStreamPacketHeader.byteLength),n$=new DataView(r$).getUint8(3);if(n$!==this.id)return void(v("SHOW_DATASTREAM2_LOG")&&_.debug("invalid datachannel id: ".concat(n$," !== ").concat(this.id)));let i$=t$.data.slice(this._dataStreamPacketHeader.byteLength);i$=this._dataStreamPacketHandler.deserialize(i$),this.emit(Cl.MESSAGE,i$)}}_updateOriginDataChannel(e$){super._updateOriginDataChannel(e$),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}},ZE=class extends cu{send(e$){if(this._originDataChannel){let t$=e$;t$=this._dataStreamPacketHandler.serialize(e$);let r$=new Uint8Array(this._dataStreamPacketHeader.byteLength+t$.byteLength);r$.set(new Uint8Array(this._dataStreamPacketHeader),0),r$.set(new Uint8Array(t$),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r$.buffer)}}};function vl(){let e$=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>hC.revokeObjectURL(e$),0),new Worker(hC.createObjectURL(e$))}var Bd=new Map,jd=new Map;function FG(e$,t$,r$){let n$=new Uint8Array(e$,t$,r$),i$=[],o$=0;for(;i$.length<r$;)o$+3<r$&&n$[o$]===0&&n$[o$+1]===0&&n$[o$+2]===3&&(n$[o$+3]===0||n$[o$+3]===1||n$[o$+3]===2||n$[o$+3]===3)?(i$.push(n$[o$],n$[o$+1],n$[o$+3]),o$+=4):(i$.push(n$[o$]),o$++);return new Uint8Array(i$)}var Gd=new Map;async function BG(e$,t$){if(!ft().supportWebRTCEncodedTransform)return void _.warning("browser not support video encoded transform");if(Gd.has(e$)||!e$.track)return;let r$={track:e$.track};if(oo()){if(!e$.createEncodedStreams)return void _.warning("browser not support createEncodedStreams() API");let i$=null;try{i$=e$.createEncodedStreams()}catch(a$){return void _.error("create video-encoded-streams error",a$&&a$.message)}let o$=[];t$.on("sei-to-send",a$=>{o$.push(a$)});let s$=new TransformStream({transform(a$,c$){r$.controller||(r$.controller=c$),e$.track&&e$.track.id!==r$.track.id&&(_.debug("video track changed: ".concat(r$.track.id," => ").concat(e$.track.id)),r$.track.removeEventListener("ended",n$),r$.track=e$.track,r$.track.addEventListener("ended",n$));let u$=o$.shift();u$&&(a$.data=function(l$,d$){let h$=function(v$){let y$=v$.length,S$=[],b$=0;for(;b$<y$;)b$+2<y$&&v$[b$]===0&&v$[b$+1]===0&&(v$[b$+2]===0||v$[b$+2]===1||v$[b$+2]===2||v$[b$+2]===3)?(S$.push(v$[b$],v$[b$+1],3,v$[b$+2]),b$+=3):(S$.push(v$[b$]),b$++);return new Uint8Array(S$)}(d$),p$=h$.length,_$=Math.floor(p$/255),f$=p$%255,m$=new Uint8Array(6+_$+1+p$+l$.byteLength);m$[0]=0,m$[1]=0,m$[2]=0,m$[3]=1,m$[4]=6,m$[5]=101;let g$=0;for(;g$<_$;)m$[6+g$]=255,g$++;return m$[6+g$]=f$,g$++,m$.set(h$,6+g$),m$.set(new Uint8Array(l$),6+g$+p$),m$.buffer}(a$.data,u$)),c$.enqueue(a$)}});i$.readable.pipeThrough(s$).pipeTo(i$.writable)}else{if(!je())return;{if(typeof RTCRtpScriptTransform>"u")return void _.warning("browser not support RTCRtpScriptTransform");let i$=vl(),o$=new MessageChannel;await new j(a$=>i$.onmessage=c$=>{c$.data==="registered"&&a$(void 0)});let s$=new RTCRtpScriptTransform(i$,{name:"tx",port:o$.port2},[o$.port2]);e$.transform=s$,await new j(a$=>i$.onmessage=c$=>{c$.data==="started"&&a$(void 0)}),t$.on("sei-to-send",a$=>{o$.port1.postMessage({sei:a$})}),o$.port1.onmessage=a$=>{var c$;a$.data.transformed&&e$.track&&((c$=e$.track)===null||c$===void 0?void 0:c$.id)!==r$.track.id&&(_.debug("video track changed: ".concat(r$.track.id," => ").concat(e$.track.id)),r$.track.removeEventListener("ended",n$),r$.track=e$.track,r$.track.addEventListener("ended",n$))},r$.worker=i$}}function n$(){if(e$.track){if(this.id!==e$.track.id)return;e$.track.removeEventListener("ended",n$)}let i$=Gd.get(e$);if(i$){Gd.delete(e$);try{var o$,s$;(o$=i$.controller)===null||o$===void 0||o$.terminate(),(s$=i$.worker)===null||s$===void 0||s$.terminate()}catch(a$){_.warning(a$&&a$.message)}}}Gd.set(e$,r$),e$.track.addEventListener("ended",n$)}var xa=new Map;(function(){let e$=mt();Ne.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ne.getStreamFromExtension=e$.name===It.CHROME&&Number(e$.version)>34,Ne.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t$=new RTCPeerConnection,r$=!1;try{t$.addTransceiver("audio"),r$=!0}catch{}return t$.close(),r$}(),Ne.supportMinBitrate=e$.name===It.CHROME||e$.name===It.EDGE,Ne.supportSetRtpSenderParameters=function(){let t$=mt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!ho()||!(!je()&&!Gl())||t$.name===It.FIREFOX&&Number(t$.version)>=64)}(),e$.name===It.SAFARI&&(Number(e$.version)>=14?Ne.supportDualStream=!0:Ne.supportDualStream=!1),Ne.webAudioMediaStreamDest=function(){let t$=mt();return!(t$.name===It.SAFARI&&Number(t$.version)<12)}(),Ne.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Ne.supportWebGL=typeof WebGLRenderingContext<"u",Ne.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,ho()||(Ne.webAudioWithAEC=!0),Ne.supportShareAudio=function(){let t$=mt();return(t$.os===ye.WIN_10||t$.os===ye.WIN_81||t$.os===ye.WIN_7||t$.os===ye.LINUX||t$.os===ye.MAC_OS||t$.os===ye.CHROMIUM_OS)&&t$.name===It.CHROME&&Number(t$.version)>=74}(),Ne.supportDataChannel=!!(OE(76)||function(t$){let r$=mt();return!(r$.name!==It.FIREFOX||!r$.osVersion)&&Number(r$.version)>=t$}(68)||mO(14)),Ne.supportPCSetConfiguration=function(){let t$=window.RTCPeerConnection;return!$t()&&!!t$&&t$.prototype.setConfiguration instanceof Function}(),Ne.supportWebRTCEncodedTransform=function(){let t$=mt();return t$.name==="Chrome"&&Number(t$.version)>=86||t$.name==="Safari"&&Number(t$.version)>=15}(),Ne.supportWebRTCInsertableStream=function(){let t$=mt();return(t$.name===It.CHROME||t$.name===It.EDGE)&&Number(t$.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Ne.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Ne.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,qu(()=>{Ne.supportDualStreamEncoding=function(){let t$=mt();return!!v("DISABLE_WEBAUDIO")||t$.name==="Safari"&&Number(t$.version)>=14||!!(t$.name==="Chrome"&&/Windows/i.test(t$.os||"")&&Number(t$.version)>=100&&v("CHROME_DUAL_STREAM_USE_ENCODING"))}(),_.info("browser compatibility",JSON.stringify(Ne),JSON.stringify(e$))})})();var ia=class g5 extends Xt{constructor(t$,r$){super(),T(this,"signal",void 0),T(this,"token",void 0),T(this,"tokenTimeout",void 0),T(this,"tokenInterval",void 0),T(this,"_sequence",0),T(this,"userMap",new Map),T(this,"encoder",new TextEncoder),this.signal=t$,this.token=r$;let n$=()=>{this.signal.connectionState===Lt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(n$,1e3):this.tokenInterval=window.setTimeout(n$,3*v("P2P_TOKEN_INTERVAL"))};n$()}async send(t$,r$,n$,i$,o$){var s$,a$,c$;if(this.userMap.size===0)return;let u$=Array.from(Pr(s$=this.userMap).call(s$))[0].token;typeof r$!="string"&&(r$=JSON.stringify(r$)),i$=(a$=i$)!==null&&a$!==void 0?a$:Ut(6,""),o$=(c$=o$)!==null&&c$!==void 0?c$:this._sequence++;let l$={_id:i$,_type:t$,_seq:o$,_message:r$,token:"".concat(this.token,"_").concat(u$)};v("SHOW_P2P_LOG")&&_.debug("send message",l$,"noNeedResponse : ".concat(n$)),this.splitMessage(JSON.stringify(l$)).forEach(h$=>{this.signal.request(et.DATA_STREAM,{payload:so(this.encoder.encode(h$))})});let d$=new j((h$,p$)=>{let _$=window.setTimeout(()=>{this.off("res-@".concat(i$,"_ack"),f$),this.off("res-@".concat(i$),g$),this.off(ps.ABORT,m$),_.debug("[external-signal] request timeout, type: ".concat(t$,", requestId: ").concat(i$)),this.userMap.size===0?p$(new N(R.INVALID_REMOTE_USER)):p$(new N(R.TIMEOUT))},v("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),f$=()=>{_$&&window.clearTimeout(_$),this.off(ps.ABORT,m$),n$&&h$()},m$=()=>{_$&&window.clearTimeout(_$),this.off("res-@".concat(i$,"_ack"),f$),this.off("res-@".concat(i$),g$),p$(new N(R.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t$,", requestId: ").concat(i$)))};this.once(ps.ABORT,m$),this.once("res-@".concat(i$,"_ack"),f$);let g$=(y$,S$)=>{v$=!0,_$&&window.clearTimeout(_$),this.off("res-@".concat(i$,"_ack"),f$),this.off(ps.ABORT,m$),y$==="success"?h$(S$):p$(new N(R.P2P_MESSAGE_FAILED,"request ".concat(t$," failed, requestId: ").concat(i$)))},v$=!1;n$||(this.once("res-@".concat(i$),g$),Me(v("SIGNAL_REQUEST_TIMEOUT")).then(()=>{v$||_.warning("external_signal request timeout, type: ".concat(t$,", requestId: ").concat(i$,", ").concat(l$))}))});try{return await d$}catch(h$){if(h$.code===R.TIMEOUT)return await this.send(t$,r$,n$,i$,o$);throw h$}}onMessage(t$){var r$;let{_uid:n$}=t$,i$,o$=this.userMap.get(n$);if(o$)i$=o$.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t$)||t$._type!==ie.CHECK)return;let{token:u$}=t$;i$=new Map,o$={uid:n$,isStart:!0,token:u$,splitMessageMap:i$,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(n$,o$),this.signal.emit(dt.ON_USER_ONLINE,{uid:n$}),this.handleUserOnline()}if("id"in t$&&"total"in t$){var s$;let{id:u$,total:l$}=t$,d$=(s$=i$.get(u$))!==null&&s$!==void 0?s$:[];if(d$.push(t$),i$.has(u$)||i$.set(u$,d$),d$.length!==l$)return;{let h$=ed(d$).call(d$,(p$,_$)=>p$.index-_$.index).map(p$=>p$.payload).join("");i$.delete(u$),(t$=JSON.parse(h$))._uid=n$}}let{_type:a$,token:c$}=t$;if(W(r$=[ie.ACK,ie.CHECK]).call(r$,a$))return a$===ie.CHECK&&this.handleCheckToken(o$,c$),void this.receiveMessage(t$);c$==="".concat(o$.token,"_").concat(this.token)?this.handleReceivedMessage(t$):_.debug('Receive unexpected message", '.concat(c$,", cur_token: ").concat(o$.token,"_").concat(this.token),t$)}check(){let t$={_id:Ut(6,""),token:this.token,_type:ie.CHECK};v("SHOW_P2P_LOG")&&_.debug("send message",t$),this.signal.request(et.DATA_STREAM,{payload:so(this.encoder.encode(JSON.stringify(t$)))})}ack(t$){let r$={_id:t$,_type:ie.ACK,token:this.token};v("SHOW_P2P_LOG")&&_.debug("send message",r$),this.signal.request(et.DATA_STREAM,{payload:so(this.encoder.encode(JSON.stringify(r$)))})}response(t$,r$,n$){this.send(ie.RESPONSE,JSON.stringify({success:!n$,message:r$}),!0,t$)}handleReceivedMessage(t$){let r$=()=>{this.userMap.forEach(u$=>{let{receivedMessagesMap:l$,nextExpectedSequenceNumber:d$}=u$;for(;l$.has(d$);){let h$=l$.get(d$);l$.delete(d$),this.receiveMessage(h$),u$.nextExpectedSequenceNumber++}})};if(!t$)return void r$();let{_uid:n$,_seq:i$}=t$,o$=this.userMap.get(n$),{receivedMessagesMap:s$,isStart:a$,nextExpectedSequenceNumber:c$}=o$;if(i$<c$)return this.ack(t$._id),void _.debug("[external-signal] receive old message, seq: ".concat(i$,", ").concat(t$._message));s$.set(i$,t$),a$&&i$===c$&&(this.receiveMessage(t$),s$.delete(c$),o$.nextExpectedSequenceNumber++,r$())}receiveMessage(t$){let{_id:r$,_type:n$,_message:i$,_uid:o$}=t$;if(v("SHOW_P2P_LOG")&&_.debug("receive message",t$),r$){let s$;switch(t$._type!==ie.ACK&&(i$&&(s$=JSON.parse(i$)),this.ack(t$._id)),t$._type){case ie.CANDIDATE:case ie.CONTROL:this.signal.emit(n$,s$,o$);break;case ie.PUBLISH:case ie.UNPUBLISH:case ie.RESTART_ICE:case ie.CALL:s$.uid=o$,Ge(this.signal,n$,s$).then(a$=>{this.response(t$._id,a$)}).catch(()=>{this.response(t$._id,void 0,!0)});break;case ie.ACK:this.getListeners("res-@".concat(r$,"_ack")).length>0&&this.emit("res-@".concat(r$,"_ack"));break;case ie.RESPONSE:{let{success:a$,message:c$}=s$;this.emit("res-@".concat(r$),a$?"success":"failed",c$);break}}}}splitMessage(t$){if(t$.length<g5.MAX_MESSAGE_SIZE)return[t$];let r$=[],{remoteToken:n$}=JSON.parse(t$),i$=Ut(6,""),o$=0,s$=800,a$=Math.ceil(t$.length/s$);for(;t$.length>0;){o$++;let c$={id:i$,index:o$,total:a$,payload:t$.slice(0,s$),token:"".concat(this.token,"_").concat(n$)};JSON.stringify(c$).length>g5.MAX_MESSAGE_SIZE?s$-=50:(r$.push(c$),t$=t$.slice(s$))}return r$.map(c$=>JSON.stringify(c$))}handleCheckToken(t$,r$){return t$.token!==r$?(_.debug("token changed, from ".concat(t$.token," to ").concat(r$)),this.reset(t$.uid,r$),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{_.debug("token timeout, ".concat(r$)),this.reset(t$.uid)},v("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let t$=await Ge(this.signal,ie.CALL,void 0),r$=await this.send(ie.CALL,t$);this.signal.emit(nt.P2P_CONNECTION,r$,!0)}async reset(t$,r$){let n$=this.userMap.get(t$);n$&&(this.emit(ps.ABORT),this.signal.emit(dt.ON_USER_OFFLINE,{uid:n$.uid,reason:cj.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),r$||(_.debug("change local token from ".concat(r$," to ").concat(r$)),this.token=Ut(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(ps.ABORT)}};T(ia,"MAX_SIZE",1),T(ia,"MAX_MESSAGE_SIZE",1024);var du=class extends Xt{get connectionState(){return this._connectionState}set connectionState(e$){e$!==this._connectionState&&(this._connectionState=e$,e$===Lt.CONNECTED?this.emit(nt.WS_CONNECTED):e$===Lt.RECONNECTING?this.emit(nt.WS_RECONNECTING,this._websocketReconnectReason):e$===Lt.CLOSED&&this.emit(nt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e$,t$){super(),T(this,"_disconnectedReason",void 0),T(this,"_websocketReconnectReason",void 0),T(this,"_connectionState",Lt.CLOSED),T(this,"reconnectToken",void 0),T(this,"p2pToken",void 0),T(this,"websocket",void 0),T(this,"openConnectionTime",void 0),T(this,"clientId",void 0),T(this,"lastMsgTime",Date.now()),T(this,"uploadCache",[]),T(this,"uploadCacheInterval",void 0),T(this,"rttRolling",new Hl(5)),T(this,"pingpongTimer",void 0),T(this,"pingpongTimeoutCount",0),T(this,"joinResponse",void 0),T(this,"multiIpOption",void 0),T(this,"initError",void 0),T(this,"spec",void 0),T(this,"store",void 0),T(this,"_external_signal",void 0),T(this,"onWebsocketMessage",r$=>{if(r$.data instanceof ArrayBuffer)return void this.emit(nt.ON_BINARY_DATA,r$.data);let n$=JSON.parse(r$.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(n$,"_id")){let i$="res-@".concat(n$._id);this.emit(i$,n$._result,n$._message)}else if(Object.prototype.hasOwnProperty.call(n$,"_type")){switch(n$._type){case dt.ON_DATA_STREAM:return void this.handleDataStream(n$._message);case dt.MUTE_AUDIO:case dt.MUTE_VIDEO:case dt.ON_P2P_LOST:case dt.ON_USER_ONLINE:return;case dt.ON_USER_OFFLINE:let{uid:i$}=n$._message;return _.debug("[".concat(this.clientId,"] user-offline uid: ").concat(i$)),void this._external_signal.reset(i$)}if(this.emit(n$._type,n$._message),n$._type===dt.ON_NOTIFICATION&&this.handleNotification(n$._message),n$._type===dt.ON_USER_BANNED)switch(n$._message.error_code){case 14:this.close(At.UID_BANNED);break;case 15:this.close(At.IP_BANNED);break;case 16:this.close(At.CHANNEL_BANNED)}if(n$._type===dt.ON_USER_LICENSE_BANNED)switch(n$._message.error_code){case Z.ERR_LICENSE_MISSING:this.close(At.LICENSE_MISSING);break;case Z.ERR_LICENSE_EXPIRED:this.close(At.LICENSE_EXPIRED);break;case Z.ERR_LICENSE_MINUTES_EXCEEDED:this.close(At.LICENSE_MINUTES_EXCEEDED);break;case Z.ERR_LICENSE_PERIOD_INVALID:this.close(At.LICENSE_PERIOD_INVALID);break;case Z.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(At.LICENSE_MULTIPLE_SDK_SERVICE);break;case Z.ERR_LICENSE_ILLEGAL:this.close(At.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e$.clientId,this.spec=e$,this.store=t$,this.websocket=new Nc("gateway-".concat(this.clientId),this.spec.retryConfig,!0,v("JOIN_GATEWAY_USE_DUAL_DOMAIN"),v("JOIN_GATEWAY_USE_443PORT_ONLY"),t$),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Lt.CONNECTED&&this.reconnect("retry",Be.OFFLINE)}),this.p2pToken=Ut(6,""),this._external_signal=new ia(this,this.p2pToken)}async request(e$,t$,r$,n$){let i$=Ut(6,""),o$={_id:i$,_type:e$,_message:t$},s$=this.websocket.connectionID,a$=()=>new j((p$,_$)=>{if(this.connectionState===Lt.CONNECTED)return p$();let f$=()=>{this.off(nt.WS_CLOSED,m$),p$()},m$=()=>{this.off(nt.WS_CONNECTED,f$),_$(new N(R.WS_ABORT))};this.once(nt.WS_CONNECTED,f$),this.once(nt.WS_CLOSED,m$)});if(this.connectionState!==Lt.CONNECTING&&this.connectionState!==Lt.RECONNECTING||e$===et.JOIN||e$===et.REJOIN||await a$(),this.websocket.sendMessage(o$,!0),n$)return;let c$=new j((p$,_$)=>{let f$=!1,m$=(v$,y$)=>{f$=!0,p$({isSuccess:v$==="success",message:y$||{}}),this.off(nt.WS_CLOSED,g$),this.off(nt.WS_RECONNECTING,g$),this.emit(nt.REQUEST_SUCCESS,e$,t$)};this.once("res-@".concat(i$),m$);let g$=()=>{_$(new N(R.WS_ABORT,"type: ".concat(e$))),this.off(nt.WS_CLOSED,g$),this.off(nt.WS_RECONNECTING,g$),this.off("res-@".concat(i$),m$)};this.once(nt.WS_CLOSED,g$),this.once(nt.WS_RECONNECTING,g$),Me(v("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==s$||f$||(_.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e$)),this.emit(nt.REQUEST_TIMEOUT,e$,t$))})}),u$=null;try{u$=await c$}catch(p$){if(this.connectionState===Lt.CLOSED||e$===et.LEAVE)throw new N(R.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r$?p$.throw():e$===et.JOIN||e$===et.REJOIN?null:(await a$(),await this.request(e$,t$))}if(u$.isSuccess)return u$.message;let l$=Number(u$.message.error_code||u$.message.code),d$=Oc(l$),h$=new N(R.UNEXPECTED_RESPONSE,"".concat(d$.desc,": ").concat(u$.message.error_str),{code:l$,data:u$.message,desc:d$.desc});return d$.action==="success"?u$.message:(_.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e$,", error_code: ").concat(l$,", message: ").concat(d$.desc,", action: ").concat(d$.action)),l$===Z.ERR_TOO_MANY_BROADCASTERS?((e$===et.JOIN||e$===et.REJOIN)&&(this.initError=h$,this.close()),h$.throw()):d$.action==="failed"?h$.throw():d$.action==="quit"?(this.initError=h$,this.close(),h$.throw()):(l$===Z.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=u$.message.option,_.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Be.MULTI_IP)):this.reconnect(d$.action,Be.SERVER_ERROR),e$===et.JOIN||e$===et.REJOIN?null:await this.request(e$,t$)))}waitMessage(e$,t$){return new j(r$=>{let n$=i$=>{(!t$||t$(i$))&&(this.off(e$,n$),r$(i$))};this.on(e$,n$)})}uploadWRTCStats(e$){if(!this.store.sessionId)return void _.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t$={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e$};this.upload(wc.WRTC_STATS,t$)}upload(e$,t$){let r$={_type:e$,_message:t$};try{this.websocket.sendMessage(r$)}catch{let n$=v("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r$),this.uploadCache.length>n$&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Lt.CONNECTED)return;let i$=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(i$._type,i$._message)},v("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e$,t$){let r$={_type:e$,_message:t$};this.websocket.sendMessage(r$)}async sendExtensionMessage(e$,t$,r$){return await this._external_signal.send(e$,t$,r$)}init(e$){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new j((t$,r$)=>{this.once(nt.WS_CONNECTED,()=>t$(this.joinResponse)),this.once(nt.WS_CLOSED,()=>r$(this.initError||new N(R.WS_ABORT))),this.connectionState=Lt.CONNECTING,this.websocket.init(e$).catch(r$)})}close(e$){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e$||At.LEAVE,this.connectionState=Lt.CLOSED,_.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Ut(6,""),this._external_signal.clear(),this._external_signal=new ia(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(nt.ABORT_P2P_EXECUTION);let e$=await Ge(this,nt.REQUEST_JOIN_INFO),t$=await this.request(et.JOIN,e$);if(!t$)return this.emit(nt.REPORT_JOIN_GATEWAY,R.TIMEOUT,this.url||""),!1;this.joinResponse=t$,this.emit(nt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Lt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e$,t$){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e$,t$)}handleDataStream(e$){try{var t$;let r$=Fo(e$.payload),n$=new TextDecoder().decode(r$),i$=JSON.parse(n$);"total"in i$&&"id"in i$||W(t$=Object.values(ie)).call(t$,i$._type)?(i$._uid=e$.uid,this._external_signal.onMessage(i$)):this.emit(dt.ON_DATA_STREAM,e$)}catch{this.emit(dt.ON_DATA_STREAM,e$)}}handleNotification(e$){_.debug("[".concat(this.clientId,"] receive notification: "),e$);let t$=Oc(e$.code);if(t$.action!=="success"){if(t$.action!=="failed")return t$.action==="quit"?(t$.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(At.UID_BANNED),void this.close()):void this.reconnect(t$.action,Be.SERVER_ERROR);_.error("[".concat(this.clientId,"] ignore error: "),t$.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e$=v("PING_PONG_TIME_OUT"),t$=Date.now();this.pingpongTimeoutCount>=e$&&(_.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t$-this.lastMsgTime,"ms")),t$-this.lastMsgTime>v("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Be.TIMEOUT):this.request(et.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let r$=Date.now()-t$;this.rttRolling.add(r$),v("REPORT_STATS")&&this.send(et.PING_BACK,{pingpongElapse:r$})}).catch(r$=>{})}handleWebsocketEvents(){this.websocket.on(it.RECONNECT_WAITTING_FINISH,e$=>{this.emit(nt.WS_RECONNECT_WAITTING_FINISH,e$)}),this.websocket.on(it.RECONNECT_CREATE_CONNECTION,e$=>{this.emit(nt.WS_RECONNECT_CREATE_CONNECTION,e$)}),this.websocket.on(it.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(it.CLOSED,()=>{this.connectionState=Lt.CLOSED}),this.websocket.on(it.FAILED,()=>{this._disconnectedReason=At.NETWORK_ERROR,this.connectionState=Lt.CLOSED}),this.websocket.on(it.RECONNECTING,e$=>{this._websocketReconnectReason=e$,this.joinResponse=void 0,this.connectionState===Lt.CONNECTED?this.connectionState=Lt.RECONNECTING:this.connectionState=Lt.CONNECTING}),this.websocket.on(it.WILL_RECONNECT,(e$,t$,r$)=>{e$!=="retry"?(_.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e$)),this.reconnectToken=void 0):_.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r$(e$)}),this.websocket.on(it.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e$=>{if(this.emit(nt.REPORT_JOIN_GATEWAY,e$,this.url||""),e$ instanceof N&&e$.code===R.UNEXPECTED_RESPONSE&&e$.data.code===Z.ERR_NO_AUTHORIZED)return _.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Be.SERVER_ERROR);_.error("[".concat(this.clientId,"] join gateway request failed"),e$.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Be.SERVER_ERROR):(this.initError=e$,this.close())})}),this.websocket.on(it.REQUEST_NEW_URLS,(e$,t$)=>{Ge(this,nt.REQUEST_RECOVER,this.multiIpOption).then(e$).catch(t$)}),this.websocket.on(it.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}},e0={exports:{}};e0.exports=(()=>{var e$={8:(n$,i$,o$)=>{o$.r(i$),o$.d(i$,{Parser:()=>k$,Printer:()=>L$,parse:()=>I$,print:()=>P$});let s$=`
`,a$="".concat("\r").concat(s$),c$=" ",u$;function l$(w$){return w$>="0"&&w$<="9"}function d$(w$){return w$>="!"&&w$<="~"}function h$(w$){return d$(w$)||w$>=""&&w$<=""}function p$(w$){return w$==="!"||w$>="#"&&w$<="'"||w$>="*"&&w$<="+"||w$>="-"&&w$<="."||w$>="0"&&w$<="9"||w$>="A"&&w$<="Z"||w$>="^"&&w$<="~"}function _$(w$){return w$>="1"&&w$<="9"}function f$(w$){return w$>="A"&&w$<="Z"||w$>="a"&&w$<="z"}function m$(w$){return w$==="d"||w$==="h"||w$==="m"||w$==="s"}function g$(w$){return w$>""&&w$<"	"||w$>"\v"&&w$<"\f"||w$>""&&w$<""}function v$(w$){return f$(w$)||l$(w$)||w$==="+"||w$==="/"}function y$(w$){return l$(w$)||f$(w$)||w$==="+"||w$==="/"||w$==="-"||w$==="_"}function S$(w$){return f$(w$)||l$(w$)||w$==="+"||w$==="/"}function b$(w$,E$){var T$=Object.keys(w$);if(Object.getOwnPropertySymbols){var R$=Object.getOwnPropertySymbols(w$);E$&&(R$=R$.filter(function(D$){return Object.getOwnPropertyDescriptor(w$,D$).enumerable})),T$.push.apply(T$,R$)}return T$}function $$(w$){for(var E$=1;E$<arguments.length;E$++){var T$=arguments[E$]!=null?arguments[E$]:{};E$%2?b$(Object(T$),!0).forEach(function(R$){C$(w$,R$,T$[R$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w$,Object.getOwnPropertyDescriptors(T$)):b$(Object(T$)).forEach(function(R$){Object.defineProperty(w$,R$,Object.getOwnPropertyDescriptor(T$,R$))})}return w$}function C$(w$,E$,T$){return E$ in w$?Object.defineProperty(w$,E$,{value:T$,enumerable:!0,configurable:!0,writable:!0}):w$[E$]=T$,w$}(function(w$){w$.VERSION="v",w$.ORIGIN="o",w$.SESSION_NAME="s",w$.INFORMATION="i",w$.URI="u",w$.EMAIL="e",w$.PHONE="p",w$.CONNECTION="c",w$.BANDWIDTH="b",w$.TIME="t",w$.REPEAT="r",w$.ZONE_ADJUSTMENTS="z",w$.KEY="k",w$.ATTRIBUTE="a",w$.MEDIA="m"})(u$||(u$={}));class N${consumeText(E$,T$){let R$=T$;for(;R$<E$.length;){let D$=E$[R$];if(D$==="\0"||D$==="\r"||D$===s$)break;R$+=1}if(R$-T$==0)throw new Error("Invalid text, at ".concat(E$));return R$}consumeUnicastAddress(E$,T$,R$){return this.consumeTill(E$,T$,c$)}consumeOneOrMore(E$,T$,R$){let D$=T$;for(;R$(E$[D$]);)D$++;if(D$-T$==0)throw new Error("Invalid rule at ".concat(T$,"."));return D$}consumeSpace(E$,T$){if(E$[T$]===c$)return T$+1;throw new Error("Invalid space at ".concat(T$,"."))}consumeIP4Address(E$,T$){let R$=T$;for(let D$=0;D$<4;D$++)if(R$=this.consumeDecimalUChar(E$,R$),D$!==3){if(E$[R$]!==".")throw new Error("Invalid IP4 address.");R$++}return R$}consumeDecimalUChar(E$,T$){let R$=T$;for(let j$=0;j$<3&&l$(E$[R$]);j$++,R$++);if(R$-T$==0)throw new Error("Invalid decimal uchar.");let D$=parseInt(E$.slice(T$,R$));if(D$>=0&&D$<=255)return R$;throw new Error("Invalid decimal uchar")}consumeIP6Address(E$,T$){let R$=this.consumeHexpart(E$,T$);return E$[R$]===":"&&(R$+=1,R$=this.consumeIP4Address(E$,R$)),R$}consumeHexpart(E$,T$){let R$=T$;if(E$[R$]===":"&&E$[R$+1]===":"){R$+=2;try{R$=this.consumeHexseq(E$,R$)}catch{}return R$}if(R$=this.consumeHexseq(E$,R$),E$[R$]===":"&&E$[R$+1]===":"){R$+=2;try{R$=this.consumeHexseq(E$,R$)}catch{}return R$}return R$}consumeHexseq(E$,T$){let R$=T$;for(;R$=this.consumeHex4(E$,R$),E$[R$]===":"&&E$[R$+1]!==":";)R$+=1;return R$}consumeHex4(E$,T$){let R$=0;for(;R$<4;R$++)if(!((D$=E$[T$+R$])>="0"&&D$<="9"||D$>="a"&&D$<="f"||D$>="A"&&D$<="F")){if(R$===0)throw new Error("Invalid hex 4");break}var D$;return T$+R$}consumeFQDN(E$,T$){let R$=T$;for(;l$(E$[R$])||f$(E$[R$])||E$[R$]==="-"||E$[R$]===".";)R$+=1;if(R$-T$<4)throw new Error("Invalid FQDN");return R$}consumeExtnAddr(E$,T$){return this.consumeOneOrMore(E$,T$,h$)}consumeMulticastAddress(E$,T$,R$){switch(R$){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(E$,T$);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(E$,T$);default:try{return this.consumeFQDN(E$,T$)}catch{return this.consumeExtnAddr(E$,T$)}}}consumeIP6MulticastAddress(E$,T$){let R$=this.consumeHexpart(E$,T$);return E$[R$]==="/"?this.consumeInteger(E$,R$+1):R$}consumeIP4MulticastAddress(E$,T$){let R$=T$+3,D$=E$.slice(T$,R$),j$=parseInt(D$);if(j$<224||j$>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let G$=0;G$<3;G$++){if(E$[R$]!==".")throw new Error("Invalid IP4 multicast address.");R$+=1,R$=this.consumeDecimalUChar(E$,R$)}return E$[R$]==="/"&&(R$+=1),R$=this.consumeTTL(E$,R$),E$[R$]==="/"&&(R$=this.consumeInteger(E$,R$)),R$}consumeInteger(E$,T$){if(!_$(E$[T$]))throw new Error("Invalid integer.");for(T$+=1;l$(E$[T$]);)T$+=1;return T$}consumeTTL(E$,T$){if(E$[T$]==="0")return T$+1;if(!_$(E$[T$]))throw new Error("Invalid TTL.");T$+=1;for(let R$=0;R$<2&&l$(E$[T$]);R$++)T$+=1;return T$}consumeToken(E$,T$){return this.consumeOneOrMore(E$,T$,p$)}consumeTime(E$,T$){let R$=T$;if(E$[R$]==="0")return R$+1;for(_$(E$[R$])&&(R$+=1);l$(E$[R$]);)R$++;if(R$-T$<10)throw new Error("Invalid time");return R$}consumeAddress(E$,T$){return this.consumeTill(E$,T$,c$)}consumeTypedTime(E$,T$){let R$=T$;return R$=this.consumeOneOrMore(E$,R$,l$),m$(E$[R$])?R$+1:R$}consumeRepeatInterval(E$,T$){if(!_$(E$[T$]))throw new Error("Invalid repeat interval");for(T$+=1;l$(E$[T$]);)T$+=1;return m$(E$[T$])&&(T$+=1),T$}consumePort(E$,T$){return this.consumeOneOrMore(E$,T$,l$)}consume(E$,T$,R$){for(let D$=0;D$<R$.length;D$++){if(T$+D$>=E$.length)throw new Error("consume exceeding value length");if(E$[T$+D$]!==R$[D$])throw new Error("consume ".concat(R$," failed at ").concat(D$))}return T$+R$.length}consumeTill(E$,T$,R$){let D$=T$;for(;D$<E$.length&&(typeof R$!="string"||E$[D$]!==R$)&&(typeof R$!="function"||!R$(E$[D$]));)D$++;return D$}}class k$ extends N${constructor(){super(),C$(this,"records",[]),C$(this,"currentLine",0)}parse(E$){let T$=this.probeEOL(E$);this.records=E$.split(T$).filter(B$=>!!rn(B$).call(B$)).map(this.parseLine),this.currentLine=0;let R$=this.parseVersion(),D$=this.parseOrigin(),j$=this.parseSessionName(),G$=this.parseInformation(),z$=this.parseUri(),J$=this.parseEmail(),t5=this.parsePhone(),a5=this.parseConnection(),s5=this.parseBandWidth(),t3=this.parseTimeFields(),Q$=this.parseKey(),Y$=this.parseSessionAttribute(),K$=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:R$,origin:D$,sessionName:j$,information:G$,uri:z$,emails:J$,phones:t5,connection:a5,bandwidths:s5,timeFields:t3,key:Q$,attributes:Y$,mediaDescriptions:K$}}getCurrentRecord(){let E$=this.records[this.currentLine];if(!E$)throw new Error("Record doesn't exit.");return E$}probeEOL(E$){for(let T$=0;T$<E$.length;T$++)if(E$[T$]===s$)return E$[T$-1]==="\r"?a$:s$;throw new Error("Invalid newline character.")}parseLine(E$,T$){if(E$.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let R$=E$[0];if(E$[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:R$,value:E$.slice(2),line:T$,cur:0}}parseSessionAttribute(){let E$=new U$;for(;this.currentLine<this.records.length;){let T$=this.getCurrentRecord();if(T$.type!==u$.ATTRIBUTE)break;let R$={attField:this.extractOneOrMore(T$,D$=>p$(D$)&&D$!==":"),_cur:0};T$.value[T$.cur]===":"&&(T$.cur+=1,R$.attValue=this.extractOneOrMore(T$,g$)),E$.parse(R$),this.currentLine++}return E$.digest()}parseMediaAttributes(E$){let T$=new x$(E$);for(;this.currentLine<this.records.length;){let R$=this.getCurrentRecord();if(R$.type!==u$.ATTRIBUTE)break;let D$={attField:this.extractOneOrMore(R$,j$=>p$(j$)&&j$!==":"),_cur:0};R$.value[R$.cur]===":"&&(R$.cur+=1,D$.attValue=this.extractOneOrMore(R$,g$)),T$.parse(D$),this.currentLine++}return T$.digest()}parseKey(){let E$=this.getCurrentRecord();if(E$.type===u$.KEY){if(E$.value==="prompt"||E$.value==="clear:"||E$.value==="base64:"||E$.value==="uri:")return E$.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let E$=this.getCurrentRecord();if(E$.type===u$.ZONE_ADJUSTMENTS){let T$=[];for(;;)try{let R$=this.extract(E$,this.consumeTime);this.consumeSpaceForRecord(E$);let D$=!1;E$.value[E$.cur]==="-"&&(D$=!0,E$.cur+=1);let j$=this.extract(E$,this.consumeTypedTime);T$.push({time:R$,typedTime:j$,back:D$})}catch{break}if(T$.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,T$}return[]}parseRepeat(){let E$=[];for(;;){let T$=this.getCurrentRecord();if(T$.type!==u$.REPEAT)break;{let R$=this.extract(T$,this.consumeRepeatInterval),D$=this.parseTypedTime(T$);E$.push({repeatInterval:R$,typedTimes:D$}),this.currentLine++}}return E$}parseTypedTime(E$){let T$=[];for(;;)try{this.consumeSpaceForRecord(E$),T$.push(this.extract(E$,this.consumeTypedTime))}catch{break}if(T$.length===0)throw new Error("Invalid typed time.");return T$}parseTime(){let E$=this.getCurrentRecord(),T$=this.extract(E$,this.consumeTime);this.consumeSpaceForRecord(E$);let R$=this.extract(E$,this.consumeTime);return this.currentLine++,{startTime:T$,stopTime:R$}}parseBandWidth(){let E$=[];for(;this.currentLine<this.records.length;){let T$=this.getCurrentRecord();if(T$.type!==u$.BANDWIDTH)break;{let R$=this.extractOneOrMore(T$,p$);if(T$.value[T$.cur]!==":")throw new Error("Invalid bandwidth field.");T$.cur++;let D$=this.extractOneOrMore(T$,l$);E$.push({bwtype:R$,bandwidth:D$}),this.currentLine++}}return E$}parseVersion(){let E$=this.getCurrentRecord();if(E$.type!==u$.VERSION)throw new Error("first sdp record must be version");let T$=E$.value.slice(0,this.consumeOneOrMore(E$.value,0,l$));if(T$.length!==E$.value.length)throw new Error('invalid proto version, "v='.concat(E$.value,'"'));return this.currentLine++,T$}parseOrigin(){let E$=this.getCurrentRecord();if(E$.type!==u$.ORIGIN)throw new Error("second line of sdp must be origin");let T$=this.extractOneOrMore(E$,h$);this.consumeSpaceForRecord(E$);let R$=this.extractOneOrMore(E$,l$);this.consumeSpaceForRecord(E$);let D$=this.extractOneOrMore(E$,l$);this.consumeSpaceForRecord(E$);let j$=this.extractOneOrMore(E$,p$);this.consumeSpaceForRecord(E$);let G$=this.extractOneOrMore(E$,p$);this.consumeSpaceForRecord(E$);let z$=this.extract(E$,this.consumeUnicastAddress);return this.currentLine++,{username:T$,sessId:R$,sessVersion:D$,nettype:j$,addrtype:G$,unicastAddress:z$}}parseSessionName(){let E$=this.getCurrentRecord();if(E$.type===u$.SESSION_NAME){let T$=this.extract(E$,this.consumeText);return this.currentLine++,T$}}parseInformation(){let E$=this.getCurrentRecord();if(E$.type!==u$.INFORMATION)return;let T$=this.extract(E$,this.consumeText);return this.currentLine++,T$}parseUri(){let E$=this.getCurrentRecord();if(E$.type===u$.URI)return this.currentLine++,E$.value}parseEmail(){let E$=[];for(;;){let T$=this.getCurrentRecord();if(T$.type!==u$.EMAIL)break;E$.push(T$.value),this.currentLine++}return E$}parsePhone(){let E$=[];for(;;){let T$=this.getCurrentRecord();if(T$.type!==u$.PHONE)break;E$.push(T$.value),this.currentLine++}return E$}parseConnection(){let E$=this.getCurrentRecord();if(E$.type===u$.CONNECTION){let T$=this.extractOneOrMore(E$,p$);this.consumeSpaceForRecord(E$);let R$=this.extractOneOrMore(E$,p$);this.consumeSpaceForRecord(E$);let D$=this.extract(E$,this.consumeAddress);return this.currentLine++,{nettype:T$,addrtype:R$,address:D$}}}parseMedia(){let E$=this.getCurrentRecord(),T$=this.extract(E$,this.consumeToken);this.consumeSpaceForRecord(E$);let R$=this.extract(E$,this.consumePort);E$.value[E$.cur]==="/"&&(E$.cur+=1,R$+=this.extract(E$,this.consumeInteger)),this.consumeSpaceForRecord(E$);let D$=[];for(D$.push(this.extract(E$,this.consumeToken));E$.value[E$.cur]==="/";)E$.cur+=1,D$.push(this.extract(E$,this.consumeToken));if(D$.length===0)throw new Error("Invalid proto");let j$=this.parseFmt(E$);return this.currentLine++,{mediaType:T$,port:R$,protos:D$,fmts:j$}}parseTimeFields(){let E$=[];for(;this.getCurrentRecord().type===u$.TIME;){let T$=this.parseTime(),R$=this.parseRepeat(),D$=this.parseZone();E$.push({time:T$,repeats:R$,zones:D$})}return E$}parseMediaDescription(){let E$=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===u$.MEDIA;){let T$=this.parseMedia(),R$=this.parseInformation(),D$=this.parseConnections(),j$=this.parseBandWidth(),G$=this.parseKey(),z$=this.parseMediaAttributes(T$);E$.push({media:T$,information:R$,connections:D$,bandwidths:j$,key:G$,attributes:z$})}return E$}parseConnections(){let E$=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===u$.CONNECTION;)E$.push(this.parseConnection());return E$}parseFmt(E$){let T$=[];for(;;)try{this.consumeSpaceForRecord(E$),T$.push(this.extract(E$,this.consumeToken))}catch{break}if(T$.length===0)throw new Error("Invalid fmts");return T$}extract(E$,T$){for(var R$=arguments.length,D$=new Array(R$>2?R$-2:0),j$=2;j$<R$;j$++)D$[j$-2]=arguments[j$];let G$=T$.call(this,E$.value,E$.cur,...D$),z$=E$.value.slice(E$.cur,G$);return E$.cur=G$,z$}extractOneOrMore(E$,T$){let R$=this.consumeOneOrMore(E$.value,E$.cur,T$),D$=E$.value.slice(E$.cur,R$);return E$.cur=R$,D$}consumeSpaceForRecord(E$){if(E$.value[E$.cur]!==c$)throw new Error("Invalid space at ".concat(E$.cur,"."));E$.cur+=1}}class O$ extends N${constructor(){super(...arguments),C$(this,"attributes",void 0),C$(this,"digested",!1)}extractOneOrMore(E$,T$,R$){let D$=this.consumeOneOrMore(E$.attValue,E$._cur,T$),j$=E$.attValue.slice(E$._cur,D$),[G$,z$]=R$||[];if(typeof G$=="number"&&j$.length<G$)throw new Error("error in length, should be more or equal than ".concat(G$," characters."));if(typeof z$=="number"&&j$.length>z$)throw new Error("error in length, should be less or equal than ".concat(z$," characters."));return E$._cur=D$,j$}consumeAttributeSpace(E$){if(E$.attValue[E$._cur]!==c$)throw new Error("Invalid space at ".concat(E$._cur,"."));E$._cur+=1}extract(E$,T$){if(!E$.attValue)throw new Error("Nothing to extract from attValue.");for(var R$=arguments.length,D$=new Array(R$>2?R$-2:0),j$=2;j$<R$;j$++)D$[j$-2]=arguments[j$];let G$=T$.call(this,E$.attValue,E$._cur,...D$),z$=E$.attValue.slice(E$._cur,G$);return E$._cur=G$,z$}atEnd(E$){if(!E$.attValue)throw new Error;return E$._cur>=E$.attValue.length}peekChar(E$){if(!E$.attValue)throw new Error;return E$.attValue[E$._cur]}peek(E$,T$){if(!E$.attValue)throw new Error;for(let R$=0;R$<T$.length;R$++)if(T$[R$]!==E$.attValue[E$._cur+R$])return!1;return!0}parseIceUfrag(E$){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(E$,v$,[4,256])}parseIcePwd(E$){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(E$,v$,[22,256])}parseIceOptions(E$){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let T$=[];for(;!this.atEnd(E$);){T$.push(this.extractOneOrMore(E$,v$));try{this.consumeAttributeSpace(E$)}catch(R$){if(this.atEnd(E$))break;throw R$}}this.attributes.iceOptions=T$}parseFingerprint(E$){let T$=this.extract(E$,this.consumeToken);this.consumeAttributeSpace(E$);let R$=this.extract(E$,this.consumeTill);this.attributes.fingerprints.push({hashFunction:T$,fingerprint:R$})}parseExtmap(E$){let T$=this.extractOneOrMore(E$,l$),R$;this.peekChar(E$)==="/"&&(this.extract(E$,this.consume,"/"),R$=this.extract(E$,this.consumeToken)),this.consumeAttributeSpace(E$);let D$=this.extract(E$,this.consumeTill,c$),j$=$$($$({entry:parseInt(T$,10)},R$&&{direction:R$}),{},{extensionName:D$});this.peekChar(E$)===c$&&(this.consumeAttributeSpace(E$),j$.extensionAttributes=this.extract(E$,this.consumeTill)),this.attributes.extmaps.push(j$)}parseSetup(E$){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let T$=this.extract(E$,this.consumeTill);if(T$!=="active"&&T$!=="passive"&&T$!=="actpass"&&T$!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=T$}}class U$ extends O${constructor(){super(...arguments),C$(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(E$){if(this.digested)throw new Error("already digested");try{switch(E$.attField){case"group":this.parseGroup(E$);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(E$);break;case"ice-pwd":this.parseIcePwd(E$);break;case"ice-options":this.parseIceOptions(E$);break;case"fingerprint":this.parseFingerprint(E$);break;case"setup":this.parseSetup(E$);break;case"tls-id":this.parseTlsId(E$);break;case"identity":this.parseIdentity(E$);break;case"extmap":this.parseExtmap(E$);break;case"msid-semantic":this.parseMsidSemantic(E$);break;default:E$.ignored=!0,this.attributes.unrecognized.push(E$)}}catch(T$){throw console.error("parsing session attribute ".concat(E$.attField,' error, "a=').concat(E$.attField,":").concat(E$.attValue,'"')),T$}if(!E$.ignored&&E$.attValue&&!this.atEnd(E$))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(E$){let T$=this.extract(E$,this.consumeToken),R$=[];for(;!this.atEnd(E$)&&this.peekChar(E$)===c$;)this.consumeAttributeSpace(E$),R$.push(this.extract(E$,this.consumeToken));this.attributes.groups.push({semantic:T$,identificationTag:R$})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(E$){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(E$,y$)}parseIdentity(E$){let T$=this.extractOneOrMore(E$,S$),R$=[];for(;!this.atEnd(E$)&&this.peekChar(E$)===c$;){this.consumeAttributeSpace(E$);let D$=this.extract(E$,this.consumeToken);this.extract(E$,this.consume,"=");let j$=this.extractOneOrMore(E$,G$=>G$!==c$&&g$(G$));R$.push({name:D$,value:j$})}this.attributes.identities.push({assertionValue:T$,extensions:R$})}parseMsidSemantic(E$){this.peekChar(E$)===c$&&this.consumeAttributeSpace(E$);let T$={semantic:this.extract(E$,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(E$)}catch{break}if(this.peekChar(E$)==="*"){this.extract(E$,this.consume,"*"),T$.applyForAll=!0;break}{let R$=this.extract(E$,this.consumeTill,c$);T$.identifierList.push(R$)}}this.attributes.msidSemantic=T$}}class x$ extends O${constructor(E$){super(),C$(this,"attributes",void 0),E$.protos.indexOf("RTP")!==-1||E$.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(E$){if(this.digested)throw new Error("already digested");try{switch(E$.attField){case"extmap":this.parseExtmap(E$);break;case"setup":this.parseSetup(E$);break;case"ice-ufrag":this.parseIceUfrag(E$);break;case"ice-pwd":this.parseIcePwd(E$);break;case"ice-options":this.parseIceOptions(E$);break;case"candidate":this.parseCandidate(E$);break;case"remote-candidate":this.parseRemoteCandidate(E$);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(E$);break;case"rtpmap":this.parseRtpmap(E$);break;case"ptime":this.parsePtime(E$);break;case"maxptime":this.parseMaxPtime(E$);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(E$);break;case"ssrc":this.parseSSRC(E$);break;case"fmtp":this.parseFmtp(E$);break;case"rtcp-fb":this.parseRtcpFb(E$);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(E$);break;case"mid":this.parseMid(E$);break;case"msid":this.parseMsid(E$);break;case"imageattr":this.parseImageAttr(E$);break;case"rid":this.parseRid(E$);break;case"simulcast":this.parseSimulcast(E$);break;case"sctp-port":this.parseSctpPort(E$);break;case"max-message-size":this.parseMaxMessageSize(E$);break;case"ssrc-group":this.parseSSRCGroup(E$);break;default:E$.ignored=!0,this.attributes.unrecognized.push(E$)}}catch(T$){throw console.error("parsing media attribute ".concat(E$.attField,' error, "a=').concat(E$.attField,":").concat(E$.attValue,'"')),T$}if(!E$.ignored&&E$.attValue&&!this.atEnd(E$))throw new Error("attribute parsing error")}parseCandidate(E$){let T$=this.extractOneOrMore(E$,v$,[1,32]);this.consumeAttributeSpace(E$);let R$=this.extractOneOrMore(E$,l$,[1,5]);this.consumeAttributeSpace(E$);let D$=this.extract(E$,this.consumeToken);this.consumeAttributeSpace(E$);let j$=this.extractOneOrMore(E$,l$,[1,10]);this.consumeAttributeSpace(E$);let G$=this.extract(E$,this.consumeAddress);this.consumeAttributeSpace(E$);let z$=this.extract(E$,this.consumePort);this.consumeAttributeSpace(E$),this.extract(E$,this.consume,"typ"),this.consumeAttributeSpace(E$);let J$={foundation:T$,componentId:R$,transport:D$,priority:j$,connectionAddress:G$,port:z$,type:this.extract(E$,this.consumeToken),extension:{}};for(this.peek(E$," raddr")&&(this.extract(E$,this.consume," raddr"),this.consumeAttributeSpace(E$),J$.relAddr=this.extract(E$,this.consumeAddress)),this.peek(E$," rport")&&(this.extract(E$,this.consume," rport"),this.consumeAttributeSpace(E$),J$.relPort=this.extract(E$,this.consumePort));this.peekChar(E$)===c$;){this.consumeAttributeSpace(E$);let t5=this.extract(E$,this.consumeToken);this.consumeAttributeSpace(E$),J$.extension[t5]=this.extractOneOrMore(E$,d$)}this.attributes.candidates.push(J$)}parseRemoteCandidate(E$){let T$=[];for(;;){let R$=this.extractOneOrMore(E$,l$,[1,5]);this.consumeAttributeSpace(E$);let D$=this.extract(E$,this.consumeAddress);this.consumeAttributeSpace(E$);let j$=this.extract(E$,this.consumePort);T$.push({componentId:R$,connectionAddress:D$,port:j$});try{this.consumeAttributeSpace(E$)}catch{break}}this.attributes.remoteCandidatesList.push(T$)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(E$){let T$=this.extract(E$,this.consumeToken);this.consumeAttributeSpace(E$);let R$=this.extract(E$,this.consumeTill,"/");this.extract(E$,this.consume,"/");let D$={encodingName:R$,clockRate:this.extractOneOrMore(E$,l$)};this.atEnd(E$)||this.peekChar(E$)!=="/"||(this.extract(E$,this.consume,"/"),D$.encodingParameters=parseInt(this.extract(E$,this.consumeTill),10));let j$=this.attributes.payloads.find(G$=>G$.payloadType===parseInt(T$,10));j$?j$.rtpMap=D$:this.attributes.payloads.push({payloadType:parseInt(T$,10),rtpMap:D$,rtcpFeedbacks:[]})}parsePtime(E$){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(E$,this.consumeTill)}parseMaxPtime(E$){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(E$,this.consumeTill)}parseDirection(E$){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=E$.attField}parseSSRC(E$){let T$=this.extractOneOrMore(E$,l$);this.consumeAttributeSpace(E$);let R$=this.extract(E$,this.consumeTill,":"),D$;this.peekChar(E$)===":"&&(this.extract(E$,this.consume,":"),D$=this.extract(E$,this.consumeTill));let j$=this.attributes.ssrcs.find(G$=>G$.ssrcId===parseInt(T$,10));j$?j$.attributes[R$]=D$:this.attributes.ssrcs.push({ssrcId:parseInt(T$,10),attributes:{[R$]:D$}})}parseFmtp(E$){let T$=this.extract(E$,this.consumeTill,c$);this.consumeAttributeSpace(E$);let R$=this.extract(E$,this.consumeTill),D$={};R$.split(";").forEach(G$=>{let[z$,J$]=G$.split("=");z$=rn(z$).call(z$);let t5=typeof J$=="string"?rn(J$).call(J$):null;typeof z$=="string"&&z$.length>0&&(D$[z$]=t5)});let j$=this.attributes.payloads.find(G$=>G$.payloadType===parseInt(T$,10));j$?j$.fmtp={parameters:D$}:this.attributes.payloads.push({payloadType:parseInt(T$,10),rtcpFeedbacks:[],fmtp:{parameters:D$}})}parseFmtParameters(E$){let T$={},R$=this.extract(E$,this.consumeTill,"=");E$._cur++;let D$=this.extract(E$,this.consumeTill,";");for(T$[R$]=D$;E$.attValue[E$._cur]===";";){let j$=this.extract(E$,this.consumeTill,"=");E$._cur++;let G$=this.extract(E$,this.consumeTill,";");T$[j$]=G$}return T$}parseRtcpFb(E$){let T$="";T$=this.peekChar(E$)==="*"?this.extract(E$,this.consume,"*"):this.extract(E$,this.consumeTill,c$),this.consumeAttributeSpace(E$);let R$=this.extract(E$,this.consumeTill,c$),D$;if(R$==="trr-int")D$={type:R$,interval:this.extract(E$,this.consumeTill)};else{let j$={type:R$};this.peekChar(E$)===c$&&(this.consumeAttributeSpace(E$),j$.parameter=this.extract(E$,this.consumeToken),this.peekChar(E$)===c$&&(j$.additional=this.extract(E$,this.consumeTill))),D$=j$}if(T$==="*")this.attributes.rtcpFeedbackWildcards.push(D$);else{let j$=this.attributes.payloads.find(G$=>G$.payloadType===parseInt(T$,10));j$?j$.rtcpFeedbacks.push(D$):this.attributes.payloads.push({payloadType:parseInt(T$,10),rtcpFeedbacks:[D$]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(E$){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let T$={port:this.extract(E$,this.consumePort)};this.peekChar(E$)===c$&&(this.consumeAttributeSpace(E$),T$.netType=this.extractOneOrMore(E$,p$),this.consumeAttributeSpace(E$),T$.addressType=this.extractOneOrMore(E$,p$),this.consumeAttributeSpace(E$),T$.address=this.extract(E$,this.consumeAddress)),this.attributes.rtcp=T$}parseMsid(E$){let T$={id:this.extractOneOrMore(E$,p$,[1,64])};this.peekChar(E$)===c$&&(this.consumeAttributeSpace(E$),T$.appdata=this.extractOneOrMore(E$,p$,[1,64])),this.attributes.msids.push(T$)}parseImageAttr(E$){this.attributes.imageattr.push(E$.attValue)}parseRid(E$){let T$=this.extractOneOrMore(E$,D$=>f$(D$)||l$(D$)||D$==="_"||D$==="-");this.consumeAttributeSpace(E$);let R$={id:T$,direction:this.extract(E$,this.consumeToken),params:[]};if(this.peekChar(E$)===c$){if(this.consumeAttributeSpace(E$),this.peek(E$,"pt=")){this.extract(E$,this.consume,"pt=");let D$=[];for(;;){let j$=this.extract(E$,this.consumeToken);D$.push(j$);try{this.extract(E$,this.consume,",")}catch{break}}R$.payloads=D$,this.peekChar(E$)===c$&&this.extract(E$,this.consume,c$)}for(;;){let D$=this.extract(E$,this.consumeToken);switch(D$){case"depend":{let j$={type:D$,rids:this.extract(E$,this.consume,"=").split(",")};R$.params.push(j$);break}default:{let j$={type:D$};this.peekChar(E$)==="="&&(this.extract(E$,this.consume,"="),j$.val=this.extract(E$,this.consumeTill,";")),R$.params.push(j$)}}try{this.extract(E$,this.consume,";")}catch{break}}}this.attributes.rids.push(R$)}parseSimulcast(E$){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=E$.attValue,this.extract(E$,this.consumeTill)}parseSctpPort(E$){this.attributes.sctpPort=this.extractOneOrMore(E$,l$,[1,5])}parseMaxMessageSize(E$){this.attributes.maxMessageSize=this.extractOneOrMore(E$,l$,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(E$){this.attributes.mid=this.extract(E$,this.consumeToken)}parseSSRCGroup(E$){let T$=this.extract(E$,this.consumeToken),R$=[];for(;;)try{this.consumeAttributeSpace(E$);let D$=this.extract(E$,this.consumeInteger);R$.push(parseInt(D$,10))}catch{break}this.attributes.ssrcGroups.push({semantic:T$,ssrcIds:R$})}}function F$(w$,E$,T$){return E$ in w$?Object.defineProperty(w$,E$,{value:T$,enumerable:!0,configurable:!0,writable:!0}):w$[E$]=T$,w$}class L${constructor(){F$(this,"eol",a$)}print(E$,T$){let R$="";return T$&&(this.eol=T$),R$+=this.printVersion(E$.version),R$+=this.printOrigin(E$.origin),R$+=this.printSessionName(E$.sessionName),R$+=this.printInformation(E$.information),R$+=this.printUri(E$.uri),R$+=this.printEmail(E$.emails),R$+=this.printPhone(E$.phones),R$+=this.printConnection(E$.connection),R$+=this.printBandwidth(E$.bandwidths),R$+=this.printTimeFields(E$.timeFields),R$+=this.printKey(E$.key),R$+=this.printSessionAttributes(E$.attributes),R$+=this.printMediaDescription(E$.mediaDescriptions),R$}printVersion(E$){return"v=".concat(E$).concat(this.eol)}printOrigin(E$){return"o=".concat(E$.username," ").concat(E$.sessId," ").concat(E$.sessVersion," ").concat(E$.nettype," ").concat(E$.addrtype," ").concat(E$.unicastAddress).concat(this.eol)}printSessionName(E$){return E$?"s=".concat(E$).concat(this.eol):""}printInformation(E$){return E$?"i=".concat(E$).concat(this.eol):""}printUri(E$){return E$?"u=".concat(E$).concat(this.eol):""}printEmail(E$){let T$="";for(let R$ of E$)T$+="e=".concat(R$).concat(this.eol);return T$}printPhone(E$){let T$="";for(let R$ of E$)T$+="e=".concat(R$).concat(this.eol);return T$}printConnection(E$){return E$?"c=".concat(E$.nettype," ").concat(E$.addrtype," ").concat(E$.address).concat(this.eol):""}printBandwidth(E$){let T$="";for(let R$ of E$)T$+="b=".concat(R$.bwtype,":").concat(R$.bandwidth).concat(this.eol);return T$}printTimeFields(E$){let T$="";for(let R$ of E$){T$+="t=".concat(R$.time.startTime," ").concat(R$.time.startTime).concat(this.eol);for(let D$ of R$.repeats)T$+="r=".concat(D$.repeatInterval," ").concat(D$.typedTimes.join(" ")).concat(this.eol);R$.zoneAdjustments&&(T$+="z=",T$+="z=".concat(R$.zoneAdjustments.map(D$=>"".concat(D$.time," ").concat(D$.back?"-":""," ").concat(D$.typedTime)).join(" ")).concat(this.eol),T$+=this.eol)}return T$}printKey(E$){return E$?"k=".concat(E$).concat(this.eol):""}printAttributes(E$){let T$="";for(let R$ of E$)T$+="a=".concat(R$.attField).concat(R$.attValue?":".concat(R$.attValue):"").concat(this.eol);return T$}printMediaDescription(E$){let T$="";for(let R$ of E$)T$+=this.printMedia(R$.media),T$+=this.printInformation(R$.information),T$+=this.printConnections(R$.connections),T$+=this.printBandwidth(R$.bandwidths),T$+=this.printKey(R$.key),T$+=this.printMediaAttributes(R$);return T$}printConnections(E$){let T$="";for(let R$ of E$)T$+=this.printConnection(R$);return T$}printMedia(E$){return"m=".concat(E$.mediaType," ").concat(E$.port," ").concat(E$.protos.join("/")," ").concat(E$.fmts.join(" ")).concat(this.eol)}printSessionAttributes(E$){return new V$(this.eol).print(E$)}printMediaAttributes(E$){return new A$(this.eol).print(E$)}}class M${constructor(E$){F$(this,"eol",void 0),this.eol=E$}printIceUfrag(E$){return E$===void 0?"":"a=ice-ufrag:".concat(E$).concat(this.eol)}printIcePwd(E$){return E$===void 0?"":"a=ice-pwd:".concat(E$).concat(this.eol)}printIceOptions(E$){return E$===void 0?"":"a=ice-options:".concat(E$.join(c$)).concat(this.eol)}printFingerprints(E$){return E$.length>0?E$.map(T$=>"a=fingerprint:".concat(T$.hashFunction).concat(c$).concat(T$.fingerprint)).join(this.eol)+this.eol:""}printExtmap(E$){return E$.map(T$=>"a=extmap:".concat(T$.entry).concat(T$.direction?"/".concat(T$.direction):"").concat(c$).concat(T$.extensionName).concat(T$.extensionAttributes?"".concat(c$).concat(T$.extensionAttributes):"").concat(this.eol)).join("")}printSetup(E$){return E$===void 0?"":"a=setup:".concat(E$).concat(this.eol)}printUnrecognized(E$){return E$.map(T$=>"a=".concat(T$.attField).concat(T$.attValue?":".concat(T$.attValue):"").concat(this.eol)).join("")}}class V$ extends M${print(E$){let T$="";return T$+=this.printGroups(E$.groups),T$+=this.printMsidSemantic(E$.msidSemantic),T$+=this.printIceLite(E$.iceLite),T$+=this.printIceUfrag(E$.iceUfrag),T$+=this.printIcePwd(E$.icePwd),T$+=this.printIceOptions(E$.iceOptions),T$+=this.printFingerprints(E$.fingerprints),T$+=this.printSetup(E$.setup),T$+=this.printTlsId(E$.tlsId),T$+=this.printIdentity(E$.identities),T$+=this.printExtmap(E$.extmaps),T$+=this.printUnrecognized(E$.unrecognized),T$}printGroups(E$){let T$="";return E$.length>0&&(T$+=E$.map(R$=>"a=group:".concat(R$.semantic).concat(R$.identificationTag.map(D$=>"".concat(c$).concat(D$)).join("")).concat(this.eol)).join("")),T$}printIceLite(E$){return E$===void 0?"":"a=ice-lite"+this.eol}printTlsId(E$){return E$?"a=tls-id:".concat(E$).concat(this.eol):""}printIdentity(E$){return E$.length===0?"":E$.map(T$=>"a=identity:".concat(T$.assertionValue).concat(T$.extensions.map(R$=>"".concat(c$).concat(R$.name).concat(R$.value?"=".concat(R$.value):"")))).join(this.eol)+this.eol}printMsidSemantic(E$){if(!E$)return"";let T$="a=msid-semantic:".concat(E$.semantic);return E$.applyForAll?T$+="".concat(c$,"*"):E$.identifierList.length>0&&(T$+=E$.identifierList.map(R$=>"".concat(c$).concat(R$))),T$+this.eol}}class A$ extends M${print(E$){let T$=E$.attributes,R$="";return R$+=this.printRTCP(T$.rtcp),R$+=this.printIceUfrag(T$.iceUfrag),R$+=this.printIcePwd(T$.icePwd),R$+=this.printIceOptions(T$.iceOptions),R$+=this.printCandidates(T$.candidates),R$+=this.printRemoteCandidatesList(T$.remoteCandidatesList),R$+=this.printEndOfCandidates(T$.endOfCandidates),R$+=this.printFingerprints(T$.fingerprints),R$+=this.printSetup(T$.setup),R$+=this.printMid(T$.mid),R$+=this.printExtmap(T$.extmaps),R$+=this.printRTPRelated(T$),R$+=this.printPtime(T$.ptime),R$+=this.printMaxPtime(T$.maxPtime),R$+=this.printDirection(T$.direction),R$+=this.printSSRCGroups(T$.ssrcGroups),R$+=this.printSSRC(T$.ssrcs),R$+=this.printRTCPMux(T$.rtcpMux),R$+=this.printRTCPMuxOnly(T$.rtcpMuxOnly),R$+=this.printRTCPRsize(T$.rtcpRsize),R$+=this.printMSId(T$.msids),R$+=this.printImageattr(T$.imageattr),R$+=this.printRid(T$.rids),R$+=this.printSimulcast(T$.simulcast),R$+=this.printSCTPPort(T$.sctpPort),R$+=this.printMaxMessageSize(T$.maxMessageSize),R$+=this.printUnrecognized(T$.unrecognized),R$}printCandidates(E$){return E$.map(T$=>"a=candidate:".concat(T$.foundation).concat(c$).concat(T$.componentId).concat(c$).concat(T$.transport).concat(c$).concat(T$.priority).concat(c$).concat(T$.connectionAddress).concat(c$).concat(T$.port).concat(c$,"typ").concat(c$).concat(T$.type).concat(T$.relAddr?"".concat(c$,"raddr").concat(c$).concat(T$.relAddr):"").concat(T$.relPort?"".concat(c$,"rport").concat(c$).concat(T$.relPort):"").concat(Object.keys(T$.extension).map(R$=>"".concat(c$).concat(R$).concat(c$).concat(T$.extension[R$])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(E$){return E$.map(T$=>"a=remote-candidates:".concat(T$.join(c$)).concat(this.eol)).join("")}printEndOfCandidates(E$){return E$===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(E$){if(!E$.payloads)return"";let T$=E$.payloads,R$="";R$+=E$.rtcpFeedbackWildcards.map(D$=>this.printRTCPFeedback("*",D$)).join("");for(let D$ of T$)R$+=this.printRtpMap(D$.payloadType,D$.rtpMap),R$+=this.printFmtp(D$.payloadType,D$.fmtp),R$+=D$.rtcpFeedbacks.map(j$=>this.printRTCPFeedback(D$.payloadType,j$)).join("");return R$}printFmtp(E$,T$){if(!T$)return"";let R$=Object.keys(T$.parameters);return R$.length===1&&T$.parameters[R$[0]]===null?"a=fmtp:".concat(E$).concat(c$).concat(R$[0]).concat(this.eol):"a=fmtp:".concat(E$).concat(c$).concat(Object.keys(T$.parameters).map(D$=>"".concat(D$,"=").concat(T$.parameters[D$])).join(";")).concat(this.eol)}printRtpMap(E$,T$){return T$?"a=rtpmap:".concat(E$).concat(c$).concat(T$.encodingName,"/").concat(T$.clockRate).concat(T$.encodingParameters?"/".concat(T$.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(E$,T$){let R$="a=rtcp-fb:".concat(E$).concat(c$),D$=T$;return D$.type==="trr-int"?R$+="ttr-int".concat(c$).concat(D$.interval):(R$+="".concat(D$.type),D$.parameter&&(R$+="".concat(c$).concat(D$.parameter),D$.additional&&(R$+="".concat(c$).concat(D$.additional)))),R$+this.eol}printPtime(E$){return E$===void 0?"":"a=ptime:".concat(E$).concat(this.eol)}printMaxPtime(E$){return E$===void 0?"":"a=maxptime:".concat(E$).concat(this.eol)}printDirection(E$){return E$===void 0?"":"a=".concat(E$).concat(this.eol)}printSSRC(E$){return E$.map(T$=>Object.keys(T$.attributes).map(R$=>"a=ssrc:".concat(T$.ssrcId.toString(10)).concat(c$).concat(R$).concat(T$.attributes[R$]?":".concat(T$.attributes[R$]):"").concat(this.eol)).join("")).join("")}printRTCPMux(E$){return E$===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(E$){return E$===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(E$){return E$===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(E$){if(E$===void 0)return"";let T$="a=rtcp:".concat(E$.port);return E$.netType&&(T$+="".concat(c$).concat(E$.netType)),E$.addressType&&(T$+="".concat(c$).concat(E$.addressType)),E$.address&&(T$+="".concat(c$).concat(E$.address)),T$+this.eol}printMSId(E$){return E$.map(T$=>"a=msid:".concat(T$.id).concat(T$.appdata?"".concat(c$).concat(T$.appdata):"").concat(this.eol)).join("")}printImageattr(E$){return E$.map(T$=>"a=imageattr:".concat(T$).concat(this.eol)).join("")}printRid(E$){return E$.map(T$=>{let R$="a=rid:".concat(T$.id).concat(c$).concat(T$.direction);return T$.payloads&&(R$+="".concat(c$,"pt=").concat(T$.payloads.join(","))),T$.params.length>0&&(R$+="".concat(c$).concat(T$.params.map(D$=>D$.type==="depend"?"depend=".concat(D$.rids.join(",")):"".concat(D$.type,"=").concat(D$.val)).join(";"))),R$+this.eol}).join("")}printSimulcast(E$){return E$===void 0?"":"a=simulcast:".concat(E$).concat(this.eol)}printSCTPPort(E$){return E$===void 0?"":"a=sctp-port:".concat(E$).concat(this.eol)}printMaxMessageSize(E$){return E$===void 0?"":"a=max-message-size:".concat(E$).concat(this.eol)}printMid(E$){return E$===void 0?"":"a=mid:".concat(E$).concat(this.eol)}printSSRCGroups(E$){return E$.map(T$=>"a=ssrc-group:".concat(T$.semantic).concat(T$.ssrcIds.map(R$=>"".concat(c$).concat(R$.toString(10))).join("")).concat(this.eol)).join("")}}function I$(w$){return new k$().parse(w$)}function P$(w$,E$){return new L$().print(w$,E$)}}},t$={};function r$(n$){if(t$[n$])return t$[n$].exports;var i$=t$[n$]={exports:{}};return e$[n$](i$,i$.exports,r$),i$.exports}return r$.d=(n$,i$)=>{for(var o$ in i$)r$.o(i$,o$)&&!r$.o(n$,o$)&&Object.defineProperty(n$,o$,{enumerable:!0,get:i$[o$]})},r$.o=(n$,i$)=>Object.prototype.hasOwnProperty.call(n$,i$),r$.r=n$=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n$,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n$,"__esModule",{value:!0})},r$(8)})();var Le=e0.exports;function $E(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:v("SVC_MODE");if(v("ENABLE_SVC"))return function(t$){return t$ in xE}(e$)?e$:xE.L1T3}function KI(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function YI(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?KI(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):KI(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}function Lc(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n$=arguments.length>3?arguments[3]:void 0,{filterRTX:i$,filterVideoFec:o$,filterAudioFec:s$,filterAudioCodec:a$,filterVideoCodec:c$}=t$,{useXR:u$}=r$,l$=[],d$=[],h$=[],p$=[],_$=!1,f$=!1;if(Le.parse(e$).mediaDescriptions.forEach(g$=>{n$&&n$!==g$.attributes.direction||(g$.media.mediaType!=="video"||_$||(d$=g$.attributes.payloads,p$=g$.attributes.extmaps,_$=!0),g$.media.mediaType!=="audio"||f$||(l$=g$.attributes.payloads,h$=g$.attributes.extmaps,f$=!0))}),!p$||d$.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!h$||l$.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(d$.forEach(g$=>{var v$;(v$=g$.rtpMap)!==null&&v$!==void 0&&v$.clockRate&&(g$.rtpMap.clockRate=parseInt(g$.rtpMap.clockRate)),u$&&g$.rtcpFeedbacks.push({type:"rrtr"})}),l$.forEach(g$=>{var v$;(v$=g$.rtpMap)!==null&&v$!==void 0&&v$.clockRate&&(g$.rtpMap.clockRate=parseInt(g$.rtpMap.clockRate)),u$&&g$.rtcpFeedbacks.push({type:"rrtr"})}),i$&&(l$=l$.filter(g$=>{var v$;return((v$=g$.rtpMap)===null||v$===void 0?void 0:v$.encodingName.toLowerCase())!=="rtx"}),d$=d$.filter(g$=>{var v$;return((v$=g$.rtpMap)===null||v$===void 0?void 0:v$.encodingName.toLowerCase())!=="rtx"})),o$&&(d$=d$.filter(g$=>{var v$;return!/(red)|(ulpfec)|(flexfec)/i.test(((v$=g$.rtpMap)===null||v$===void 0?void 0:v$.encodingName)||"")})),s$&&(l$=l$.filter(g$=>{var v$;return!/(red)|(ulpfec)|(flexfec)/i.test(((v$=g$.rtpMap)===null||v$===void 0?void 0:v$.encodingName)||"")})),a$&&(a$==null?void 0:a$.length)>0&&(l$=l$.filter(g$=>{var v$;return W(a$).call(a$,((v$=g$.rtpMap)===null||v$===void 0?void 0:v$.encodingName.toLowerCase())||"")})),c$&&(c$==null?void 0:c$.length)>0){let g$=d$.filter(v$=>{var y$;return W(c$).call(c$,((y$=v$.rtpMap)===null||y$===void 0?void 0:y$.encodingName.toLowerCase())||"")});d$=g$.concat(i$?[]:yf(g$,d$))}let m$=v("UNSUPPORTED_VIDEO_CODEC");return m$&&m$.length>0&&(d$=d$.filter(g$=>!(g$.rtpMap&&W(m$).call(m$,g$.rtpMap.encodingName.toLowerCase())))),{audioCodecs:l$,videoCodecs:d$,audioExtensions:h$,videoExtensions:p$}}function io(e$){let t$=Le.parse(e$),r$,n$;for(let i$ of t$.mediaDescriptions){if(!r$){let o$=i$.attributes.iceUfrag,s$=i$.attributes.icePwd;if(!o$||!s$)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r$={iceUfrag:o$,icePwd:s$}}if(!n$){let o$=i$.attributes.fingerprints;o$.length>0&&(n$={fingerprints:o$})}}if(!n$&&t$.attributes.fingerprints.length>0&&(n$={fingerprints:t$.attributes.fingerprints}),!n$||!r$)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r$,dtlsParameters:n$}}function n0(e$,t$){let r$=[],n$=e$.attributes.ssrcGroups.filter(s$=>s$.semantic==="FID"),i$=e$.attributes.ssrcGroups.find(s$=>s$.semantic==="SIM"),o$=e$.attributes.ssrcs;if(i$)i$.ssrcIds.forEach(s$=>{var a$;let c$=(a$=n$.find(u$=>u$.ssrcIds[0]===s$))===null||a$===void 0?void 0:a$.ssrcIds[1];r$.push({ssrcId:s$,rtx:t$?c$:void 0})});else if(n$.length>0){let s$=n$[0].ssrcIds[0],a$=n$[0].ssrcIds[1];r$.push({ssrcId:s$,rtx:t$?a$:void 0})}else{if(o$.length===0)throw new Error("No ssrcs found on local media description.");r$.push({ssrcId:o$[0].ssrcId})}return r$}function qI(e$,t$,r$){let{cname:n$}=e$,i$;t$?i$=i0(t$):(i$=e$.iceParameters.candidates.map(l$=>({foundation:l$.foundation,componentId:"1",transport:l$.protocol,priority:l$.priority.toString(),connectionAddress:l$.ip,port:l$.port.toString(),type:l$.type,extension:{}})),_.debug("Using candidates from gateway."));let o$={fingerprints:e$.dtlsParameters.fingerprints.map(l$=>({hashFunction:l$.algorithm,fingerprint:l$.fingerprint}))},s$={iceUfrag:e$.iceParameters.iceUfrag,icePwd:e$.iceParameters.icePwd},a$;switch(e$.dtlsParameters.role){case"server":a$="passive";break;case"client":a$="active";break;case"auto":a$="actpass"}let c$=uu(e$.rtpCapabilities),u$=[];return Array.isArray(r$)&&r$.length>0&&r$.forEach(l$=>{u$.push({kind:Q.VIDEO,ssrcId:l$.v,rtx:l$.v_rtx,mslabel:"".concat(l$.v,"_").concat(l$.a)},{kind:Q.AUDIO,ssrcId:l$.a,mslabel:"".concat(l$.v,"_").concat(l$.a)})}),{dtlsParameters:o$,iceParameters:s$,candidates:i$,rtpCapabilities:c$,setup:a$,cname:n$,preSSRCs:u$}}function i0(e$){let t$=[];return e$.ip&&typeof e$.port=="number"&&(t$=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e$.ip,port:e$.port.toString(),type:"host",extension:{}}],_.debug("Using remote candidate from AP ".concat(e$.ip,":").concat(e$.port)),e$.ip6&&(t$.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e$.ip6,port:e$.port.toString(),type:"host",extension:{}}),_.debug("Using IPV6 remote candidate from AP ".concat(e$.ip6,":").concat(e$.port)))),t$}function Lo(e$,t$,r$){let n$=[],i$=[];return e$.forEach(o$=>{let{ssrcId:s$,rtx:a$}=o$,c$=Ut(8,"track-"),u$={ssrcId:s$,attributes:YI({label:c$,mslabel:r$=r$||Ut(10,""),msid:"".concat(r$," ").concat(c$)},t$&&{cname:t$})};if(n$.push(u$),a$!==void 0){let l$={ssrcId:a$,attributes:YI({label:c$,mslabel:r$,msid:"".concat(r$," ").concat(c$)},t$&&{cname:t$})};n$.push(l$),i$.push({semantic:"FID",ssrcIds:[s$,a$]})}}),e$.length>1&&i$.push({semantic:"SIM",ssrcIds:e$.map(o$=>{let{ssrcId:s$}=o$;return s$})}),{ssrcs:n$,ssrcGroups:i$}}function ra(e$,t$){t$ instanceof Qt&&e$.attributes.payloads.forEach(r$=>{var n$;let i$=(n$=r$.rtpMap)===null||n$===void 0?void 0:n$.encodingName.toLowerCase();if(!i$||["opus","pcmu","pcma","g722"].indexOf(i$)===-1)return;r$.fmtp||(r$.fmtp={parameters:{}}),r$.fmtp.parameters.minptime="10",r$.fmtp.parameters.useinbandfec="1";let o$=t$._encoderConfig;o$&&i$!=="pcmu"&&i$!=="pcma"&&i$!=="g722"&&(o$.bitrate&&!$t()&&(r$.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*o$.bitrate))),o$.sampleRate&&(r$.fmtp.parameters.maxplaybackrate="".concat(o$.sampleRate),r$.fmtp.parameters["sprop-maxcapturerate"]="".concat(o$.sampleRate)),o$.stereo&&(r$.fmtp.parameters.stereo="1",r$.fmtp.parameters["sprop-stereo"]="1"))})}function If(e$){let t$=e$.attributes.unrecognized.findIndex(r$=>r$.attField==="x-google-flag"&&r$.attValue==="conference");t$!==-1&&e$.attributes.unrecognized.splice(t$,1)}function vf(e$,t$){var r$;if(!(t$ instanceof Ft&&t$._encoderConfig&&t$._hints.indexOf(Gt.SCREEN_TRACK)===-1))return;let n$=t$._encoderConfig;ft().supportMinBitrate&&n$.bitrateMin&&e$.attributes.payloads.forEach(i$=>{var o$,s$;W(o$=["h264","h265","vp8","vp9","av1"]).call(o$,((s$=i$.rtpMap)===null||s$===void 0?void 0:s$.encodingName.toLowerCase())||"")&&(i$.fmtp||(i$.fmtp={parameters:{}}),i$.fmtp.parameters["x-google-min-bitrate"]="".concat(n$.bitrateMin))}),ft().supportMinBitrate&&!W(r$=t$._hints).call(r$,Gt.LOW_STREAM)&&n$.bitrateMax&&e$.attributes.payloads.forEach(i$=>{var o$,s$;W(o$=["h264","h265","vp8","vp9","av1"]).call(o$,((s$=i$.rtpMap)===null||s$===void 0?void 0:s$.encodingName.toLowerCase())||"")&&(i$.fmtp||(i$.fmtp={parameters:{}}),i$.fmtp.parameters["x-google-start-bitrate"]="".concat(v("X_GOOGLE_START_BITRATE")||Math.floor(n$.bitrateMax)))})}function r0(e$){if(e$.media.mediaType!=="video")return;let t$=mt();if(t$.name!==It.SAFARI&&t$.os!==ye.IOS)return;let r$=e$.attributes.extmaps.findIndex(n$=>/video-orientation/g.test(n$.extensionName));r$!==-1&&e$.attributes.extmaps.splice(r$,1)}function lu(e$,t$,r$){if(!t$)return;let n$,i$;if(e$.media.mediaType==="video"?(n$=r$.videoExtensions,i$=r$.videoCodecs):(n$=r$.audioExtensions,i$=r$.audioCodecs),t$.twcc===!0){let o$=n$.find(s$=>s$.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o$&&(e$.attributes.extmaps.find(s$=>s$.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e$.attributes.extmaps.push({entry:o$.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(s$,a$){return a$.filter(c$=>!!s$.find(u$=>u$.payloadType===c$.payloadType&&!!u$.rtcpFeedbacks.find(l$=>l$.type==="transport-cc")))}(i$,e$.attributes.payloads).forEach(s$=>{s$.rtcpFeedbacks.find(a$=>a$.type==="transport-cc")||s$.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t$.twcc===!1){let o$=e$.attributes.extmaps.findIndex(s$=>s$.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o$!==-1&&e$.attributes.extmaps.splice(o$,1),e$.attributes.payloads.forEach(s$=>{let a$=s$.rtcpFeedbacks.findIndex(c$=>c$.type==="transport-cc");a$!==-1&&s$.rtcpFeedbacks.splice(a$,1)})}if(t$.remb===!0){let o$=n$.find(s$=>s$.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");o$&&(e$.attributes.extmaps.find(s$=>s$.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e$.attributes.extmaps.push({entry:o$.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(s$,a$){return a$.filter(c$=>!!s$.find(u$=>u$.payloadType===c$.payloadType&&!!u$.rtcpFeedbacks.find(l$=>l$.type==="goog-remb")))}(i$,e$.attributes.payloads).forEach(s$=>{s$.rtcpFeedbacks.find(a$=>a$.type==="goog-remb")||s$.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t$.remb===!1){let o$=e$.attributes.extmaps.findIndex(s$=>s$.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");o$!==-1&&e$.attributes.extmaps.splice(o$,1),e$.attributes.payloads.forEach(s$=>{let a$=s$.rtcpFeedbacks.findIndex(c$=>c$.type==="goog-remb");a$!==-1&&s$.rtcpFeedbacks.splice(a$,1)})}}function o0(e$,t$,r$){if($t()||e$.media.mediaType!=="video"||!(t$ instanceof Ft)||r$!=="vp9"&&r$!=="vp8"||r$==="vp8"&&!v("SIMULCAST")||r$==="vp9"&&v("ENABLE_SVC")||t$._scalabilityMode===void 0||t$._scalabilityMode.numSpatialLayers<=1)return;let n$=r$==="vp8"?2:t$._scalabilityMode.numSpatialLayers,i$=e$.attributes.ssrcs[0],o$=e$.attributes.ssrcGroups.find(a$=>a$.semantic==="FID"&&a$.ssrcIds[0]===i$.ssrcId),s$={semantic:"SIM",ssrcIds:[i$.ssrcId]};for(let a$=1;a$<n$;a$++)e$.attributes.ssrcs.push({ssrcId:i$.ssrcId+a$,attributes:le(i$.attributes)}),s$.ssrcIds.push(i$.ssrcId+a$),o$&&(e$.attributes.ssrcs.push({ssrcId:o$.ssrcIds[1]+a$,attributes:le(i$.attributes)}),e$.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i$.ssrcId+a$,o$.ssrcIds[1]+a$]}));e$.attributes.ssrcGroups.unshift(s$)}async function s0(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r$=new RTCPeerConnection;r$.addTransceiver("video",{direction:"sendonly"}),r$.addTransceiver("audio",{direction:"sendonly"}),r$.addTransceiver("video",{direction:"recvonly"}),r$.addTransceiver("audio",{direction:"recvonly"});let n$=(await r$.createOffer()).sdp,{send:i$,recv:o$,sendrecv:s$}=function(){let a$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u$=arguments.length>2?arguments[2]:void 0,l$=Lc(u$,a$,c$,"sendonly"),d$=Lc(u$,a$,c$,"recvonly"),h$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ii(l$,d$,"videoExtensions",h$,p$,_$),Ii(l$,d$,"videoCodecs",h$,p$,_$),Ii(l$,d$,"audioExtensions",h$,p$,_$),Ii(l$,d$,"audioCodecs",h$,p$,_$),v("RAISE_H264_BASELINE_PRIORITY")){let f$=_$.videoCodecs.findIndex(m$=>{var g$,v$;return((g$=m$.rtpMap)===null||g$===void 0?void 0:g$.encodingName.toLocaleLowerCase())==="h264"&&((v$=m$.fmtp)===null||v$===void 0?void 0:v$.parameters["profile-level-id"])==="42001f"});if(f$!==-1){let m$=_$.videoCodecs.findIndex(g$=>{var v$;return((v$=g$.rtpMap)===null||v$===void 0?void 0:v$.encodingName.toLocaleLowerCase())==="h264"});if(m$<f$){_.debug("raising H264 baseline profile priority");let g$=_$.videoCodecs[f$];_$.videoCodecs.splice(f$,1),_$.videoCodecs.splice(m$,0,g$)}m$!==-1&&(p$.videoCodecs=p$.videoCodecs.filter(g$=>{var v$,y$;return!(((v$=g$.rtpMap)===null||v$===void 0?void 0:v$.encodingName.toLocaleLowerCase())==="h264"&&((y$=g$.fmtp)===null||y$===void 0?void 0:y$.parameters["profile-level-id"])!=="42001f")})),m$!==-1&&v("FILTER_SEND_H264_BASELINE")&&(h$.videoCodecs=h$.videoCodecs.filter(g$=>{var v$,y$;return!(((v$=g$.rtpMap)===null||v$===void 0?void 0:v$.encodingName.toLocaleLowerCase())==="h264"&&((y$=g$.fmtp)===null||y$===void 0?void 0:y$.parameters["profile-level-id"])!=="42001f")}))}}return{send:h$,recv:p$,sendrecv:_$}}(e$,t$,n$);try{r$.close()}catch{}return{send:i$,recv:o$,sendrecv:s$}}function zI(){let e$={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t$=Lc(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),r$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ii(e$,t$,"videoExtensions",r$,n$,i$),Ii(e$,t$,"videoCodecs",r$,n$,i$),Ii(e$,t$,"audioExtensions",r$,n$,i$),Ii(e$,t$,"audioCodecs",r$,n$,i$),v("RAISE_H264_BASELINE_PRIORITY")){let o$=i$.videoCodecs.findIndex(s$=>s$.rtpMap&&s$.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&s$.fmtp&&s$.fmtp.parameters["profile-level-id"]==="42001f");if(o$!==-1){let s$=i$.videoCodecs.findIndex(a$=>a$.rtpMap&&a$.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(s$<o$){_.debug("raising H264 baseline profile priority");let a$=i$.videoCodecs[o$];i$.videoCodecs.splice(o$,1),i$.videoCodecs.splice(s$,0,a$)}s$!==-1&&(n$.videoCodecs=n$.videoCodecs.filter(a$=>!(a$.rtpMap&&a$.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&a$.fmtp&&a$.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:r$,recv:n$,sendrecv:i$}}function Ii(e$,t$,r$,n$,i$,o$){if(r$==="videoExtensions"||r$==="audioExtensions"){let s$=[];return e$[r$].forEach(a$=>{t$[r$].some((c$,u$)=>{if(a$.entry===c$.entry&&a$.extensionName===c$.extensionName)return s$.push(u$),!0})?o$[r$].push(a$):n$[r$].push(a$)}),void t$[r$].forEach((a$,c$)=>{s$.indexOf(c$)===-1&&i$[r$].push(a$)})}if(r$==="videoCodecs"||r$==="audioCodecs"){let s$=[];return e$[r$].forEach(a$=>{t$[r$].some((c$,u$)=>{if(a$.payloadType===c$.payloadType&&JSON.stringify(a$)===JSON.stringify(c$))return s$.push(u$),!0})?o$[r$].push(a$):n$[r$].push(a$)}),void t$[r$].forEach((a$,c$)=>{s$.indexOf(c$)===-1&&i$[r$].push(a$)})}}function uu(e$){let{send:t$,recv:r$,sendrecv:n$}=e$;if(!n$){if(!t$||!r$)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t$,recv:r$}}let i$,o$;return t$?(i$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i$.audioCodecs=[...t$.audioCodecs,...n$.audioCodecs],i$.videoCodecs=[...t$.videoCodecs,...n$.videoCodecs],i$.audioExtensions=[...t$.audioExtensions,...n$.audioExtensions],i$.videoExtensions=[...t$.videoExtensions,...n$.videoExtensions]):i$=n$,r$?(o$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o$.audioCodecs=[...r$.audioCodecs,...n$.audioCodecs],o$.videoCodecs=[...r$.videoCodecs,...n$.videoCodecs],o$.audioExtensions=[...r$.audioExtensions,...n$.audioExtensions],o$.videoExtensions=[...r$.videoExtensions,...n$.videoExtensions]):o$=n$,{send:i$,recv:o$}}function oa(e$){e$.media.mediaType==="audio"&&e$.attributes.payloads.filter(t$=>{var r$;return((r$=t$.rtpMap)===null||r$===void 0?void 0:r$.encodingName.toLowerCase())==="opus"}).forEach(t$=>{t$.fmtp||(t$.fmtp={parameters:{}}),t$.fmtp.parameters.stereo="1",t$.fmtp.parameters["sprop-stereo"]="1"})}function ac(e$,t$,r$,n$){let i$=[];if(e$===Q.VIDEO){if(v("H264_PROFILE_LEVEL_ID")&&n$==="h264"&&(i$=t$.videoCodecs.filter(o$=>{var s$;return W(s$=o$.rtpMap&&o$.rtpMap.encodingName.toLowerCase()||"").call(s$,n$)&&o$&&o$.fmtp&&o$.fmtp.parameters["profile-level-id"]===v("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i$)||i$.length===0){let o$=[],s$=[],a$=[],c$=[];if(r$.videoCodecs.forEach(u$=>{let l$=u$.rtpMap&&u$.rtpMap.encodingName.toLowerCase()||"";W(l$).call(l$,n$)?o$.push(u$):W(l$).call(l$,"vp9")?s$.push(u$):W(l$).call(l$,"vp8")?a$.push(u$):W(l$).call(l$,"h264")&&c$.push(u$)}),o$.length===0){let u$="";s$.length!==0?(o$=s$,u$="vp9"):a$.length!==0?(o$=a$,u$="vp8"):c$.length!==0&&(o$=c$,u$="h264"),_.warning("codec ".concat(n$," not included in rtpCapabilities, fallback to default payloads: ").concat(u$))}o$.length!==0&&(i$=t$.videoCodecs.filter(u$=>o$.some(l$=>l$.payloadType===u$.payloadType)))}if(i$.length===0&&(_.warning("codec ".concat(n$," not included in rtpCapabilities, fallback to default payloads: ").concat(t$.videoCodecs[0].rtpMap&&t$.videoCodecs[0].rtpMap.encodingName)),i$=t$.videoCodecs),v("USE_PUB_RTX")||v("USE_SUB_RTX")){let o$=yf(i$,t$.videoCodecs);i$=[...i$,...o$]}}else i$=t$.audioCodecs.filter(o$=>{var s$;return W(s$=o$.rtpMap&&o$.rtpMap.encodingName.toLowerCase()||"").call(s$,n$)}),i$.length===0&&(_.warning("codec ".concat(n$," not included in rtpCapabilities, fallback to opus")),i$=t$.audioCodecs.filter(o$=>{var s$;return W(s$=o$.rtpMap&&o$.rtpMap.encodingName.toLowerCase()||"").call(s$,"opus")}));return i$}function yf(e$,t$){let r$=e$.map(n$=>n$.payloadType.toString());return t$.filter(n$=>n$.rtpMap&&n$.rtpMap.encodingName==="rtx"&&n$.fmtp&&n$.fmtp.parameters.apt&&W(r$).call(r$,n$.fmtp&&n$.fmtp.parameters.apt))}async function Wd(e$,t$,r$){let n$=t$.toString(),i$=c0(n$,"offer","remote","exchangeSDP");await e$.setRemoteDescription({type:"offer",sdp:n$});let o$=await e$.createAnswer();if(!o$.sdp)throw new Error("cannot get answer sdp");let s$=o$.sdp;s$=a0(s$,r$||{}),i$==null||i$(s$||""),await e$.setLocalDescription({type:"answer",sdp:s$})}function a0(e$,t$,r$){let n$=Le.parse(e$),{useXR:i$}=t$;return n$.mediaDescriptions.forEach(o$=>{var s$;o$.attributes.mid&&(Array.isArray(r$)&&!W(r$).call(r$,o$.attributes.mid)||(o$.media.mediaType==="audio"&&oa(o$),i$&&W(s$=["audio","video"]).call(s$,o$.media.mediaType)&&o$.attributes.payloads.forEach(a$=>{a$.rtcpFeedbacks.findIndex(c$=>c$.type==="rrtr")===-1&&a$.rtcpFeedbacks.push({type:"rrtr"})})))}),Le.print(n$)}function c0(e$,t$,r$,n$){if(v("SDP_LOGGING"))return _.upload("exchanging ".concat(r$," ").concat(t$," SDP during P2PConnection.").concat(n$,`
`),e$),t$==="offer"?i$=>{c0(i$,"answer",r$==="local"?"remote":"local",n$)}:void 0}function Xi(e$,t$){return typeof v(e$)===t$?v(e$):void 0}function JI(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function jr(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?JI(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):JI(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var d_=new Map,tm=class extends Xt{get state(){return this._state}set state(e$){if(e$===this._state)return;let t$=this._state;this._state=e$,e$==="DISCONNECTED"&&this._disconnectedReason?this.emit(xe.CONNECTION_STATE_CHANGE,e$,t$,this._disconnectedReason):this.emit(xe.CONNECTION_STATE_CHANGE,e$,t$)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e$){_.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e$)),this._joinGatewayStartTime=e$}constructor(e$,t$){super(),T(this,"store",void 0),T(this,"joinInfo",void 0),T(this,"key",void 0),T(this,"ntpOffset",0),T(this,"signal",void 0),T(this,"role",void 0),T(this,"inChannelInfo",{joinAt:null,duration:0}),T(this,"spec",void 0),T(this,"_state","DISCONNECTED"),T(this,"_statsCollector",void 0),T(this,"_disconnectedReason",void 0),T(this,"isSignalRecover",!1),T(this,"hasChangeBGPAddress",!1),T(this,"trafficStatsInterval",void 0),T(this,"networkQualityInterval",void 0),T(this,"_joinGatewayStartTime",0),T(this,"_signalTimeout",!1),T(this,"_clientRoleOptions",void 0),T(this,"_isProactiveJoin",!1),this.store=e$,this.spec=t$,this.signal=this.store.useP2P?new du(jr(jr({},t$),{},{retryConfig:t$.websocketRetryConfig}),e$):new jE(jr(jr({},t$),{},{retryConfig:t$.websocketRetryConfig}),e$),this._statsCollector=t$.statsCollector,this.role=t$.role||"audience",this._clientRoleOptions=t$.clientRoleOptions,this.handleSignalEvents()}async join(e$,t$,r$){this.store.joinGatewayStart(),e$.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let n$=Date.now(),i$=d_.get(e$.cname);if(i$||(i$=new Map,d_.set(e$.cname,i$)),this._isProactiveJoin=!0,i$.has(e$.uid)){let c$=new O(R.UID_CONFLICT);throw X.joinGateway(e$.sid,{lts:n$,succ:!1,ec:c$.code,addr:null,uid:e$.uid,cid:e$.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e$.proxyServer,signalChannel:"0",preload:e$.preload}),this._isProactiveJoin=!1,c$}i$.set(e$.uid,!0),this.joinInfo=e$,this.key=t$;let o$=0;this.joinGatewayStartTime=n$;let s$=e$.proxyServer;try{_.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o$));let c$=e$.gatewayAddrs.map(u$=>{let{address:l$}=u$,[d$,h$]=l$.split(":"),p$={host:d$,port:h$};return e$.proxyServer&&(p$.proxy=e$.proxyServer),p$});o$=(await this.signal.init(c$,r$)).uid,_.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o$," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(c$){var a$;throw _.error("[".concat(this.store.clientId,"] User join failed"),c$.toString()),X.joinGateway(e$.sid,{lts:n$,succ:!1,ec:((a$=c$.data)===null||a$===void 0?void 0:a$.desc)||c$.code,errorMsg:c$.message,addr:this.signal.url,uid:e$.uid,cid:e$.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!s$,signalChannel:"0",preload:e$.preload}),this._isProactiveJoin=!1,i$.delete(e$.uid),this.signal.close(),c$}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),_.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(c$=>{_.warning("[".concat(this.store.clientId,"] get traffic stats error"),c$.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(xe.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(xe.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(xe.NETWORK_QUALITY,{uplinkNetworkQuality:WR(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:WR(this._statsCollector.trafficStats.B_dnq)}):this.emit(xe.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),o$}async leave(){let e$=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t$=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){t$!==At.FALLBACK&&(this.state="DISCONNECTING");try{e$||this.signal.connectionState!==Lt.CONNECTED||await function(r$,n$){return n$===1/0?r$:j.race([r$,mB(n$)])}(this.signal.request(et.LEAVE,void 0,!0),3e3)}catch(r$){_.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r$)}this.signal.close(t$),t$!==At.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e$,t$,r$){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let n$={state:"offer",p2p_id:this.store.p2pId,ortc:t$,mode:this.spec.mode,extend:v("PUB_EXTEND"),twcc:!!v("PUBLISH_TWCC"),rtx:!!v("USE_PUB_RTX")};try{return(await this.signal.request(et.PUBLISH,n$,!0))._message}catch(i$){if(r$&&i$.data&&i$.data.code===Z.ERR_PUBLISH_REQUEST_INVALID)return _.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),i$.toString()),await this.tryUnpubBeforeRepub(e$,t$),this.publish(e$,t$,!1);throw i$}}async publishDataChannel(e$,t$,r$){var n$;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let i$={stream_id:t$.streamId,ordered:t$.ordered?1:0,max_retrans_times:(n$=t$.maxRetransmits)!==null&&n$!==void 0?n$:10,channel_id:t$.channelId,metadata:t$.metadata};try{await this.signal.request(et.PUBLISH_DATASTREAM,i$,!0)}catch(o$){if(r$&&o$.data&&o$.data.code===Z.ERR_PUBLISH_REQUEST_INVALID)return _.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),o$.toString()),await this.tryUnpubDataChannelBeforeRepub(e$,t$),this.publishDataChannel(e$,t$,!1);throw o$}}async unpublish(e$,t$){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(et.UNPUBLISH,{stream_id:t$,ortc:e$},!0)}catch(r$){_.warning("[".concat(this.store.clientId,"] unpublish warning: "),r$)}}async unpublishDataChannel(e$){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await j.all(e$.map(t$=>this.signal.request(et.UNPUBLISH_DATASTREAM,{channel_id:t$},!0)))}catch(t$){_.warning("unpublish datachannels warning: ",t$)}}async presubscribe(e$,t$,r$){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let n$={stream_id:e$,stream_type:t$,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!v("SUBSCRIBE_TWCC"),rtx:!!v("USE_SUB_RTX")||void 0,extend:v("SUB_EXTEND"),svc:Array.isArray(v("SVC"))&&v("SVC").length!==0?v("SVC"):void 0};try{return await this.signal.request(et.PRE_SUBSCRIBE,n$,!0)}catch(i$){if(r$&&i$.data&&i$.data.code===Z.ERR_SUBSCRIBE_REQUEST_INVALID)return _.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),i$.toString()),this.presubscribe(e$,t$,!1);throw i$}}async subscribe(e$,t$,r$){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let n$={stream_id:e$,stream_type:t$.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!v("SUBSCRIBE_TWCC"),rtx:!!v("USE_SUB_RTX"),extend:v("SUB_EXTEND"),ssrcId:t$.ssrcId,svc:Array.isArray(v("SVC"))&&v("SVC").length!==0?v("SVC"):void 0};try{return(await this.signal.request(et.SUBSCRIBE,n$,!0))._message}catch(i$){if(r$&&i$.data&&i$.data.code===Z.ERR_SUBSCRIBE_REQUEST_INVALID)return _.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),i$.toString()),await this.tryUnsubBeforeResub(e$,t$),await this.subscribe(e$,t$,!1);throw i$}}async subscribeDataChannel(e$,t$,r$){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let n$={uid:e$,stream_id:t$.id,channel_id:t$.datachannelId};try{return void await this.signal.request(et.SUBSCRIBE_DATASTREAM,n$,!0)}catch(i$){if(r$&&i$.data&&i$.data.code===Z.ERR_SUBSCRIBE_REQUEST_INVALID)return _.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),i$.toString()),await this.tryUnsubDataChannelBeforeResub(e$,t$),await this.subscribeDataChannel(e$,t$,!1);throw i$}}async subscribeAll(e$,t$){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let r$={p2p_id:this.store.p2pId,users:e$,dtx:!1,rtx:!!v("USE_SUB_RTX"),twcc:!!v("SUBSCRIBE_TWCC"),svc:Array.isArray(v("SVC"))&&v("SVC").length!==0?v("SVC"):void 0};try{return await this.signal.request(et.SUBSCRIBE_STREAMS,r$,!0)}catch(n$){if(t$&&n$.data&&n$.data.code===Z.ERR_SUBSCRIBE_REQUEST_INVALID)return _.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),n$.toString()),await this.tryMassUnsubBeforeResub(e$),await this.subscribeAll(e$,!1);throw n$}}async setVideoProfile(e$){let t$=function(r$){if(!(r$.bitrateMax&&r$.bitrateMin&&r$.frameRate&&r$.height&&r$.width))return;let n$=r$.frameRate,i$=r$.width,o$=r$.height,s$=!0;return typeof n$!="number"&&(n$=n$.exact||n$.ideal||n$.max||n$.min||0,n$||(s$=!1)),typeof i$!="number"&&(i$=i$.exact||i$.ideal||i$.max||i$.min||0,i$||(s$=!1)),typeof o$!="number"&&(o$=o$.exact||o$.ideal||o$.max||o$.min||0,n$||(s$=!1)),s$?{stream_type:0,width:i$,height:o$,fps:n$,start_bps:1e3*r$.bitrateMax,min_bps:1e3*r$.bitrateMin,target_bps:1e3*r$.bitrateMax}:void 0}(e$);if(t$)return this.signal.request(et.SET_VIDEO_PROFILE,t$);_.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e$,t$){try{await this.signal.request(et.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e$,stream_id:t$},!0)}catch(r$){_.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r$)}}async unsubscribeDataChannel(e$,t$){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await j.all(e$.map(r$=>this.signal.request(et.UNSUBSCRIBE_DATASTREAM,{stream_id:r$,uid:t$},!0)))}catch(r$){_.warning("unsubscribeDataChannel warning: ",r$)}}async massUnsubscribe(e$){try{await this.signal.request(et.UNSUBSCRIBE_STREAMS,e$,!0)}catch(t$){_.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),t$)}}async reconnectPC(e$){let{iceParameters:t$,dtlsParameters:r$,rtpCapabilities:n$}=e$;return{gatewayEstablishParams:await this.signal.request(et.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t$,dtlsParameters:r$,rtpCapabilities:n$}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(et.GATEWAY_INFO)}async renewToken(e$){await this.signal.request(et.RENEW_TOKEN,e$),this.key=e$.token}async setClientRole(e$,t$){if(t$&&(this._clientRoleOptions=Object.assign({},t$)),this.state!=="CONNECTED")return void(this.role=e$);let r$,n$=0;e$==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r$=this._clientRoleOptions.delay,n$=1):n$=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:n$=0,await this.signal.request(et.SET_CLIENT_ROLE,{role:e$,level:n$,delay:r$,client_ts:Date.now()}),this.role=e$}async setRemoteVideoStreamType(e$,t$){await this.signal.request(et.SWITCH_VIDEO_STREAM,{stream_id:e$,stream_type:t$})}async setDefaultRemoteVideoStreamType(e$){await this.signal.request(et.DEFAULT_VIDEO_STREAM,{stream_type:e$})}async setStreamFallbackOption(e$,t$){await this.signal.request(et.SET_FALLBACK_OPTION,{stream_id:e$,fallback_type:t$})}async pickSVCLayer(e$,t$){await this.signal.request(et.PICK_SVC_LAYER,{stream_id:e$,spatial_layer:t$.spatialLayer,temporal_layer:t$.temporalLayer})}async setRTM2Flag(e$){await this.signal.request(et.SET_RTM2_FLAG,{rtm2_flag:e$})}async sendExtensionMessage(e$,t$,r$){if(this.signal instanceof du)return this.signal.sendExtensionMessage(e$,t$,r$)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),jr({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(et.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let e$=d_.get(this.joinInfo.cname);e$&&e$.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let e$=function(t$){let r$;return r$=t$.startsWith("dc")?t$.match(/(dc\:\/\/)?([^:]+):(\d+)/):t$.match(/(wss\:\/\/)?([^:]+):(\d+)/),r$?{username:Ve.username,password:Ve.password,turnServerURL:r$[2],tcpport:parseInt(r$[3])+30,udpport:parseInt(r$[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e$&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(jr(jr({},Ve),{},{turnServerURL:e$.turnServerURL,tcpport:e$.tcpport,udpport:e$.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let e$=await this.signal.request(et.TRAFFIC_STATS,void 0,!0);e$.timestamp=Date.now(),e$.ntp_offset!=null&&(this.ntpOffset=e$.ntp_offset),e$.peer_delay.forEach(t$=>{let r$=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(n$=>n$.peer_uid===t$.peer_uid);r$&&r$.B_st!==t$.B_st&&qu(()=>{this.emit(xe.STREAM_TYPE_CHANGE,t$.peer_uid,t$.B_st)})}),this._statsCollector.updateTrafficStats(e$)}getJoinMessage(e$){if(!this.joinInfo||!this.key)throw new O(R.UNEXPECTED_ERROR,"can not generate join message, no join info");let t$=Object.assign({},this.joinInfo.apResponse),r$=v("REPORT_APP_SCENARIO");if(typeof r$!="string")try{r$=JSON.stringify(r$)}catch{r$=void 0}r$&&r$.length>128&&(r$=void 0);let n$=!($t()||EO(87)||pC())&&typeof v("ENABLE_PRE_SUB")=="boolean"&&v("ENABLE_PRE_SUB"),i$=!pC()&&Xi("ENABLE_PREALLOC_PC","boolean"),o$=jr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:ii,browser:navigator.userAgent,process_id:v("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t$,extend:v("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r$,attributes:{userAttributes:{enablePublishedUserList:v("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:v("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof v("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?v("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof v("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?v("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof v("ENABLE_USER_LICENSE_CHECK")=="boolean"?v("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:v("USE_PUB_RTX")===!0||v("USE_SUB_RTX")===!0||void 0,disableFEC:v("DISABLE_FEC"),enableNTPReport:!!v("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!v("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!v("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Xi("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!v("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!v("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Xi("USE_XR","boolean"),enableLossbasedBwe:Xi("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!v("ENABLE_AUT_CC")||void 0,enableCCFallback:Xi("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:i$,preSubNum:n$?Xi("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Xi("PUBLISH_TWCC","boolean"),enableSubTWCC:Xi("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Xi("USE_PUB_RTX","boolean"),enableSubRTX:Xi("USE_SUB_RTX","boolean"),enableSubSVC:v("ENABLE_SVC")?v("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(v("SVC"))&&v("SVC").length!==0?v("SVC"):void 0}},join_ts:this.joinGatewayStartTime},e$);return this.joinInfo.stringUid&&(o$.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(o$.aes_mode=this.joinInfo.aesmode,v("ENCRYPT_AES")?(o$.aes_secret=this.joinInfo.aespassword,o$.aes_encrypt=!0):o$.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(o$.aes_salt=this.joinInfo.aessalt)),t$.addresses[this.signal.websocket.currentURLIndex]&&(o$.ap_response.ticket=t$.addresses[this.signal.websocket.currentURLIndex].ticket,delete t$.addresses),this.joinInfo.defaultVideoStream!==void 0&&(o$.default_video_stream=this.joinInfo.defaultVideoStream),o$}getRejoinMessage(){if(!this.joinInfo)throw new O(R.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(nt.WS_RECONNECT_WAITTING_FINISH,e$=>{var t$;W(t$=["tryNext","recover"]).call(t$,e$)&&this.joinInfo&&X.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(nt.WS_RECONNECT_CREATE_CONNECTION,e$=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(nt.WS_RECONNECTING,e$=>{this.joinInfo&&X.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e$||Be.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",X.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:2}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(nt.WS_CLOSED,e$=>{let t$;switch(e$){case At.LEAVE:t$=Be.LEAVE;break;case At.UID_BANNED:case At.IP_BANNED:case At.CHANNEL_BANNED:case At.SERVER_ERROR:t$=Be.SERVER_ERROR;break;case At.FALLBACK:t$=Be.FALLBACK;break;case At.LICENSE_MISSING:case At.LICENSE_EXPIRED:case At.LICENSE_MINUTES_EXCEEDED:case At.LICENSE_PERIOD_INVALID:case At.LICENSE_MULTIPLE_SDK_SERVICE:case At.LICENSE_ILLEGAL:case At.TOKEN_EXPIRE:t$=e$;break;default:t$=Be.NETWORK_ERROR}_.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t$||"undefined -> "+Be.NETWORK_ERROR)),this.joinInfo&&X.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e$===At.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t$}),this._disconnectedReason=e$,e$!==At.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(nt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(_.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),X.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){let e$=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e$)return void _.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e$));Ot("EVENT_REPORT_DOMAIN",e$[1]),Ot("EVENT_REPORT_BACKUP_DOMAIN",e$[1]),Ot("LOG_UPLOAD_SERVER","".concat(e$[1],":6444"))}}),this.signal.on(dt.ON_UPLINK_STATS,e$=>{this._statsCollector.updateUplinkStats(e$)}),this.signal.on(nt.REQUEST_RECOVER,(e$,t$,r$)=>{if(!this.joinInfo)return r$(new O(R.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e$&&(this.joinInfo.multiIP=e$,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Ge(this,xe.REQUEST_NEW_GATEWAY_LIST).then(t$).catch(r$)}),this.signal.on(nt.REQUEST_JOIN_INFO,async e$=>{var t$;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e$(this.getJoinMessage({ortc:{}}));let{iceParameters:r$,dtlsParameters:n$,rtpCapabilities:i$}=await Ge(this,xe.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(t$=this.joinInfo)===null||t$===void 0?void 0:t$.turnServer});e$(this.getJoinMessage({ortc:{iceParameters:r$,dtlsParameters:n$,rtpCapabilities:i$,version:"2"}}))}),this.signal.on(nt.REQUEST_REJOIN_INFO,e$=>{e$(this.getRejoinMessage())}),this.signal.on(nt.REPORT_JOIN_GATEWAY,(e$,t$)=>{if(!this.joinInfo)return;let r$,n$="";var i$;e$ instanceof O?(r$=((i$=e$.data)===null||i$===void 0?void 0:i$.desc)||e$.code,n$=e$.message):r$=e$,X.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r$,errorMsg:n$,addr:t$,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1}),this.signal.on(nt.IS_P2P_DISCONNECTED,e$=>{e$(Ac(this,xe.IS_P2P_DISCONNECTED))}),this.signal.on(nt.DISCONNECT_P2P,()=>{this.emit(xe.DISCONNECT_P2P)}),this.signal.on(nt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(nt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(nt.JOIN_RESPONSE,e$=>{let t$=this.getCurrentGatewayAddress();this.emit(xe.JOIN_RESPONSE,e$,t$)}),this.signal.on(nt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();let e$=this.getCurrentGatewayAddress(),t$=v("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e$&&t$){let r$=i0(e$);this.emit(xe.PRE_CONNECT_PC,{candidates:r$,fingerprint:t$})}}})}async tryUnsubBeforeResub(e$,t$){try{await this.signal.request(et.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e$,ortc:[t$]},!0)}catch(r$){throw _.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r$),r$}}async tryUnsubDataChannelBeforeResub(e$,t$){try{await this.signal.request(et.UNSUBSCRIBE,{stream_id:t$.id},!0)}catch(r$){throw _.warning("unsubscribe datachannel warning",r$),r$}}async tryUnpubBeforeRepub(e$,t$){try{await this.signal.request(et.UNPUBLISH,{stream_id:e$,ortc:t$},!0)}catch(r$){throw _.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r$),r$}}async tryUnpubDataChannelBeforeRepub(e$,t$){try{await this.signal.request(et.UNPUBLISH_DATASTREAM,{channnel_id:t$.channelId},!0)}catch(r$){throw _.warning("unpublish datastream warning: ",r$),r$}}async tryMassUnsubBeforeResub(e$){let t$={users:e$.map(r$=>({stream_id:r$.stream_id,stream_type:r$.stream_type}))};try{await this.signal.request(et.UNSUBSCRIBE_STREAMS,t$,!0)}catch(r$){throw _.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r$),r$}}async muteLocal(e$,t$){let r$={action:e$.find(n$=>n$.stream_type===Ct.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e$,stream_id:t$};try{await this.signal.request(et.CONTROL,r$,!0,!0)}catch(n$){throw _.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),n$),n$}}async unmuteLocal(e$,t$){let r$={action:e$.find(n$=>n$.stream_type===Ct.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e$,stream_id:t$};try{await this.signal.request(et.CONTROL,r$,!0,!0)}catch(n$){throw _.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),n$),n$}}async muteRemote(e$,t$){let r$={action:e$===Q.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t$};try{await this.signal.request(et.CONTROL,r$,!0,!0)}catch(n$){throw _.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),n$),n$}}async unmuteRemote(e$,t$){let r$={action:e$===Q.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t$};try{await this.signal.request(et.CONTROL,r$,!0,!0)}catch(n$){throw _.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),n$),n$}}uploadWRTCStats(e$){this.signal.uploadWRTCStats(e$)}upload(e$,t$){this.signal.upload(e$,t$)}getSignalRTT(){return this.signal.rtt}async restartICE(e$){let t$={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e$};try{return await this.signal.request(et.RESTART_ICE,t$,!0)}catch(r$){throw _.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r$),r$}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,Be.P2P_FAILED)}getCurrentGatewayAddress(){var e$,t$;if(!v("GATEWAY_WSS_ADDRESS"))return v("USE_CANDIDATE_FROM_AP_DETAIL")&&(e$=this.joinInfo)!==null&&e$!==void 0&&e$.apGatewayAddress?(_.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(t$=this.joinInfo)!==null&&t$!==void 0&&t$.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e$){await this.signal.request(et.SET_PARAMETER,{enablePublishAudioFilter:e$})}},Hd=0,l_=0;function Hi(e$,t$,r$,n$){return new j((i$,o$)=>{t$.timeout=t$.timeout||v("HTTP_CONNECT_TIMEOUT"),t$.responseType=t$.responseType||"json",t$.data&&!r$?(t$.data=JSON.stringify(t$.data),Hd+=ar(t$.data)):r$&&(t$.data.size?Hd+=t$.data.size:t$.data instanceof FormData?Hd+=AO(t$.data):Hd+=ar(JSON.stringify(t$.data))),t$.headers=t$.headers||{},t$.headers["Content-Type"]=t$.headers["Content-Type"]||"application/json",t$.method="POST",t$.url=e$,mn.request(t$).then(s$=>{typeof s$.data=="string"?l_+=ar(s$.data):s$.data instanceof ArrayBuffer||s$.data instanceof Uint8Array?l_+=s$.data.byteLength:l_+=ar(JSON.stringify(s$.data)),n$&&i$({data:s$.data,headers:s$.headers}),i$(s$.data)}).catch(s$=>{mn.isCancel(s$)?o$(new O(R.OPERATION_ABORTED,"cancel token canceled")):s$.code==="ECONNABORTED"?o$(new O(R.NETWORK_TIMEOUT,s$.message)):s$.response?o$(new O(R.NETWORK_RESPONSE_ERROR,s$.response.status)):o$(new O(R.NETWORK_ERROR,s$.message))})})}(function(){var e$;function t$(A$){var I$=0;return function(){return I$<A$.length?{done:!1,value:A$[I$++]}:{done:!0}}}var r$=typeof Object.defineProperties=="function"?Object.defineProperty:function(A$,I$,P$){return A$==Array.prototype||A$==Object.prototype||(A$[I$]=P$.value),A$},n$,i$=function(A$){A$=[typeof globalThis=="object"&&globalThis,A$,typeof window=="object"&&window,typeof self=="object"&&self,typeof Vs=="object"&&Vs];for(var I$=0;I$<A$.length;++I$){var P$=A$[I$];if(P$&&P$.Math==Math)return P$}throw Error("Cannot find global object")}(this);function o$(A$,I$){if(I$)e:{var P$=i$;A$=A$.split(".");for(var w$=0;w$<A$.length-1;w$++){var E$=A$[w$];if(!(E$ in P$))break e;P$=P$[E$]}(I$=I$(w$=P$[A$=A$[A$.length-1]]))!=w$&&I$!=null&&r$(P$,A$,{configurable:!0,writable:!0,value:I$})}}function s$(A$){return(A$={next:A$})[Symbol.iterator]=function(){return this},A$}function a$(A$){var I$=typeof Symbol<"u"&&Symbol.iterator&&A$[Symbol.iterator];return I$?I$.call(A$):{next:t$(A$)}}if(o$("Symbol",function(A$){function I$(E$,T$){this.A=E$,r$(this,"description",{configurable:!0,writable:!0,value:T$})}if(A$)return A$;I$.prototype.toString=function(){return this.A};var P$="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",w$=0;return function E$(T$){if(this instanceof E$)throw new TypeError("Symbol is not a constructor");return new I$(P$+(T$||"")+"_"+w$++,T$)}}),o$("Symbol.iterator",function(A$){if(A$)return A$;A$=Symbol("Symbol.iterator");for(var I$="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),P$=0;P$<I$.length;P$++){var w$=i$[I$[P$]];typeof w$=="function"&&typeof w$.prototype[A$]!="function"&&r$(w$.prototype,A$,{configurable:!0,writable:!0,value:function(){return s$(t$(this))}})}return A$}),typeof Object.setPrototypeOf=="function")n$=Object.setPrototypeOf;else{var c$;e:{var u$={};try{u$.__proto__={a:!0},c$=u$.a;break e}catch{}c$=!1}n$=c$?function(A$,I$){if(A$.__proto__=I$,A$.__proto__!==I$)throw new TypeError(A$+" is not extensible");return A$}:null}var l$=n$;function d$(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h$(A$){if(A$.m)throw new TypeError("Generator is already running");A$.m=!0}function p$(A$,I$){return A$.h=3,{value:I$}}function _$(A$){this.g=new d$,this.G=A$}function f$(A$,I$,P$,w$){try{var E$=I$.call(A$.g.j,P$);if(!(E$ instanceof Object))throw new TypeError("Iterator result "+E$+" is not an object");if(!E$.done)return A$.g.m=!1,E$;var T$=E$.value}catch(R$){return A$.g.j=null,A$.g.s(R$),m$(A$)}return A$.g.j=null,w$.call(A$.g,T$),m$(A$)}function m$(A$){for(;A$.g.h;)try{var I$=A$.G(A$.g);if(I$)return A$.g.m=!1,{value:I$.value,done:!1}}catch(P$){A$.g.v=void 0,A$.g.s(P$)}if(A$.g.m=!1,A$.g.l){if(I$=A$.g.l,A$.g.l=null,I$.F)throw I$.D;return{value:I$.return,done:!0}}return{value:void 0,done:!0}}function g$(A$){this.next=function(I$){return A$.o(I$)},this.throw=function(I$){return A$.s(I$)},this.return=function(I$){return function(P$,w$){h$(P$.g);var E$=P$.g.j;return E$?f$(P$,"return"in E$?E$.return:function(T$){return{value:T$,done:!0}},w$,P$.g.return):(P$.g.return(w$),m$(P$))}(A$,I$)},this[Symbol.iterator]=function(){return this}}function v$(A$,I$){return I$=new g$(new _$(I$)),l$&&A$.prototype&&l$(I$,A$.prototype),I$}if(d$.prototype.o=function(A$){this.v=A$},d$.prototype.s=function(A$){this.l={D:A$,F:!0},this.h=this.C||this.u},d$.prototype.return=function(A$){this.l={return:A$},this.h=this.u},_$.prototype.o=function(A$){return h$(this.g),this.g.j?f$(this,this.g.j.next,A$,this.g.o):(this.g.o(A$),m$(this))},_$.prototype.s=function(A$){return h$(this.g),this.g.j?f$(this,this.g.j.throw,A$,this.g.o):(this.g.s(A$),m$(this))},o$("Array.prototype.entries",function(A$){return A$||function(){return function(I$,P$){I$ instanceof String&&(I$+="");var w$=0,E$=!1,T$={next:function(){if(!E$&&w$<I$.length){var R$=w$++;return{value:P$(R$,I$[R$]),done:!1}}return E$=!0,{done:!0,value:void 0}}};return T$[Symbol.iterator]=function(){return T$},T$}(this,function(I$,P$){return[I$,P$]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var y$=function(A$,I$){for(var P$=0;P$<A$.length;P$++)I$(A$[P$])},S$=function(A$){return A$.replace(/\r?\n|\r/g,`\r
`)},b$=function(A$,I$,P$){return I$ instanceof Blob?(P$=P$!==void 0?P$+"":typeof I$.name=="string"?I$.name:"blob",I$.name===P$&&Object.prototype.toString.call(I$)!=="[object Blob]"||(I$=new File([I$],P$)),[String(A$),I$]):[String(A$),String(I$)]},$$=function(A$,I$){if(A$.length<I$)throw new TypeError(I$+" argument required, but only "+A$.length+" present.")},C$=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,N$=C$.FormData,k$=C$.XMLHttpRequest&&C$.XMLHttpRequest.prototype.send,O$=C$.Request&&C$.fetch,U$=C$.navigator&&C$.navigator.sendBeacon,x$=C$.Element&&C$.Element.prototype,F$=C$.Symbol&&Symbol.toStringTag;F$&&(Blob.prototype[F$]||(Blob.prototype[F$]="Blob"),"File"in C$&&!File.prototype[F$]&&(File.prototype[F$]="File"));try{new File([],"")}catch{C$.File=function(A$,I$,P$){return A$=new Blob(A$,P$||{}),Object.defineProperties(A$,{name:{value:I$},lastModified:{value:+(P$&&P$.lastModified!==void 0?new Date(P$.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),F$&&Object.defineProperty(A$,F$,{value:"File"}),A$}}var L$=function(A$){return A$.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},M$=function(A$){this.i=[];var I$=this;A$&&y$(A$.elements,function(P$){if(P$.name&&!P$.disabled&&P$.type!=="submit"&&P$.type!=="button"&&!P$.matches("form fieldset[disabled] *"))if(P$.type==="file"){var w$=P$.files&&P$.files.length?P$.files:[new File([],"",{type:"application/octet-stream"})];y$(w$,function(E$){I$.append(P$.name,E$)})}else P$.type==="select-multiple"||P$.type==="select-one"?y$(P$.options,function(E$){!E$.disabled&&E$.selected&&I$.append(P$.name,E$.value)}):P$.type==="checkbox"||P$.type==="radio"?P$.checked&&I$.append(P$.name,P$.value):(w$=P$.type==="textarea"?S$(P$.value):P$.value,I$.append(P$.name,w$))})};if((e$=M$.prototype).append=function(A$,I$,P$){$$(arguments,2),this.i.push(b$(A$,I$,P$))},e$.delete=function(A$){$$(arguments,1);var I$=[];A$=String(A$),y$(this.i,function(P$){P$[0]!==A$&&I$.push(P$)}),this.i=I$},e$.entries=function A$(){var I$,P$=this;return v$(A$,function(w$){if(w$.h==1&&(I$=0),w$.h!=3)return I$<P$.i.length?w$=p$(w$,P$.i[I$]):(w$.h=0,w$=void 0),w$;I$++,w$.h=2})},e$.forEach=function(A$,I$){$$(arguments,1);for(var P$=a$(this),w$=P$.next();!w$.done;w$=P$.next()){var E$=a$(w$.value);w$=E$.next().value,E$=E$.next().value,A$.call(I$,E$,w$,this)}},e$.get=function(A$){$$(arguments,1);var I$=this.i;A$=String(A$);for(var P$=0;P$<I$.length;P$++)if(I$[P$][0]===A$)return I$[P$][1];return null},e$.getAll=function(A$){$$(arguments,1);var I$=[];return A$=String(A$),y$(this.i,function(P$){P$[0]===A$&&I$.push(P$[1])}),I$},e$.has=function(A$){$$(arguments,1),A$=String(A$);for(var I$=0;I$<this.i.length;I$++)if(this.i[I$][0]===A$)return!0;return!1},e$.keys=function A$(){var I$,P$,w$,E$,T$=this;return v$(A$,function(R$){if(R$.h==1&&(I$=a$(T$),P$=I$.next()),R$.h!=3)return P$.done?void(R$.h=0):(w$=P$.value,E$=a$(w$),p$(R$,E$.next().value));P$=I$.next(),R$.h=2})},e$.set=function(A$,I$,P$){$$(arguments,2),A$=String(A$);var w$=[],E$=b$(A$,I$,P$),T$=!0;y$(this.i,function(R$){R$[0]===A$?T$&&(T$=!w$.push(E$)):w$.push(R$)}),T$&&w$.push(E$),this.i=w$},e$.values=function A$(){var I$,P$,w$,E$,T$=this;return v$(A$,function(R$){if(R$.h==1&&(I$=a$(T$),P$=I$.next()),R$.h!=3)return P$.done?void(R$.h=0):(w$=P$.value,(E$=a$(w$)).next(),p$(R$,E$.next().value));P$=I$.next(),R$.h=2})},M$.prototype._asNative=function(){for(var A$=new N$,I$=a$(this),P$=I$.next();!P$.done;P$=I$.next()){var w$=a$(P$.value);P$=w$.next().value,w$=w$.next().value,A$.append(P$,w$)}return A$},M$.prototype._blob=function(){var A$="----formdata-polyfill-"+Math.random(),I$=[],P$="--"+A$+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(w$,E$){return typeof w$=="string"?I$.push(P$+L$(S$(E$))+`"\r
\r
`+S$(w$)+`\r
`):I$.push(P$+L$(S$(E$))+'"; filename="'+L$(w$.name)+`"\r
Content-Type: `+(w$.type||"application/octet-stream")+`\r
\r
`,w$,`\r
`)}),I$.push("--"+A$+"--"),new Blob(I$,{type:"multipart/form-data; boundary="+A$})},M$.prototype[Symbol.iterator]=function(){return this.entries()},M$.prototype.toString=function(){return"[object FormData]"},x$&&!x$.matches&&(x$.matches=x$.matchesSelector||x$.mozMatchesSelector||x$.msMatchesSelector||x$.oMatchesSelector||x$.webkitMatchesSelector||function(A$){for(var I$=(A$=(this.document||this.ownerDocument).querySelectorAll(A$)).length;0<=--I$&&A$.item(I$)!==this;);return-1<I$}),F$&&(M$.prototype[F$]="FormData"),k$){var V$=C$.XMLHttpRequest.prototype.setRequestHeader;C$.XMLHttpRequest.prototype.setRequestHeader=function(A$,I$){V$.call(this,A$,I$),A$.toLowerCase()==="content-type"&&(this.B=!0)},C$.XMLHttpRequest.prototype.send=function(A$){A$ instanceof M$?(A$=A$._blob(),this.B||this.setRequestHeader("Content-Type",A$.type),k$.call(this,A$)):k$.call(this,A$)}}O$&&(C$.fetch=function(A$,I$){return I$&&I$.body&&I$.body instanceof M$&&(I$.body=I$.body._blob()),O$.call(this,A$,I$)}),U$&&(C$.navigator.sendBeacon=function(A$,I$){return I$ instanceof M$&&(I$=I$._asNative()),U$.call(this,A$,I$)}),C$.FormData=M$}})();var Mc=()=>{let e$=v("AREAS");return e$.length===0&&e$.push(St.GLOBAL),ji(e$).call(e$,(t$,r$,n$)=>{let i$=d0(r$);return i$?n$===0?i$:"".concat(t$,",").concat(i$):t$},"")},d0=e$=>e$===St.OVERSEA?"".concat(Ye.ASIA,",").concat(Ye.EUROPE,",").concat(Ye.AFRICA,",").concat(Ye.NORTH_AMERICA,",").concat(Ye.SOUTH_AMERICA,",").concat(Ye.OCEANIA):Ye[e$],jG=e$=>{let t$={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e$.map(r$=>{let n$=Zu[r$],i$=Object.keys(n$);i$&&i$.map(o$=>{o$!=="CODE"&&(t$[o$]=t$[o$].concat(n$[o$]))})}),t$},yl={GLOBAL:{ASIA:[St.CHINA,St.JAPAN,St.INDIA,St.KOREA,St.HKMC],EUROPE:[],NORTH_AMERICA:[St.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Kd=Object.keys(yl[St.GLOBAL]),u_=[St.CHINA,St.NORTH_AMERICA,St.EUROPE,St.ASIA,St.JAPAN,St.INDIA,St.OCEANIA,St.SOUTH_AMERICA,St.AFRICA,St.KOREA,St.HKMC,St.US],GG=function(e$,t$){let r$=[];if(W(e$).call(e$,St.GLOBAL)){let o$=[St.GLOBAL,St.OVERSEA],s$=Object.keys(Zu);if(t$===St.GLOBAL)throw new O(R.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t$===St.CHINA)r$=[St.OVERSEA];else if(i$=t$,W(Kd).call(Kd,i$)){let a$=(n$=t$,yl[St.GLOBAL][n$]||[]),c$=[...o$,t$,...a$];r$=s$.filter(u$=>!W(c$).call(c$,u$))}else if(function(a$){let c$=!1;return Kd.forEach(u$=>{var l$;W(l$=yl[St.GLOBAL][u$]).call(l$,a$)&&(c$=!0)}),c$}(t$)){let a$=function(u$){let l$;return Kd.forEach(d$=>{var h$;W(h$=yl[St.GLOBAL][d$]).call(h$,u$)&&(l$=d$)}),l$}(t$),c$=[...o$,a$,t$];r$=s$.filter(u$=>!W(c$).call(c$,u$))}else r$=e$;r$=function(a$){let c$=[];return u_.forEach(u$=>{W(a$).call(a$,u$)&&c$.push(u$)}),c$.concat(a$.filter(u$=>!W(u_).call(u_,u$)))}(r$)}else r$=e$;var n$,i$;return r$};function XI(e$){var t$,r$;if(!e$&&W(t$=v("AREAS")).call(t$,St.EXTENSIONS))return _.debug("update area from ap : reset"),void Af(vB,!0);if(!W(r$=v("AREAS")).call(r$,St.GLOBAL)||!e$)return;let n$=Zu.EXTENSIONS;n$&&(n$={CODE:d0(St.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e$,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e$,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e$,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e$,".agora.io"),"cds-ap-web-2-".concat(e$,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e$,".agora.io"),"sua-ap-web-2-".concat(e$,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e$,".agora.io"),"uap-ap-web-2-".concat(e$,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e$,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e$,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e$,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e$,".agora.io")]},_.debug("update area from ap success: ".concat(e$,",config is "),n$),Ot("AREAS",[St.EXTENSIONS],!0),Object.keys(n$).map(i$=>{i$==="LOG_UPLOAD_SERVER"||i$==="EVENT_REPORT_DOMAIN"||i$==="EVENT_REPORT_BACKUP_DOMAIN"||i$==="PROXY_SERVER_TYPE3"?Ot(i$,n$[i$][0]):Ot(i$,n$[i$])}))}function Af(e$){let t$=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r$=X.reportApiInvoke(null,{name:Te.SET_AREA,options:e$,tag:Zt.TRACER});try{let n$=[];if(typeof e$=="string"&&(n$=[e$]),Array.isArray(e$)&&(e$.forEach(o$=>{if(!W(UR).call(UR,o$))throw new O(R.INVALID_PARAMS,"invalid area code")}),n$=e$),Object.prototype.toString.call(e$)==="[object Object]"){let{areaCode:o$,excludedArea:s$}=e$;if(!o$)throw new O(R.INVALID_PARAMS,"area code is needed");let a$=o$;typeof o$=="string"&&(a$=[o$]),n$=s$?GG(a$,s$):a$}if(!t$){if($r.AREAS){let o$=new O(R.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r$.onError(o$),void _.warning("setArea is prohibited because of config-distribute")}if(W(n$).call(n$,St.GLOBAL)&&v("AREAS")===St.EXTENSIONS){let o$=new O(R.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r$.onError(o$),void _.warning("setArea is prohibited because of ap extensions")}}Ot("AREAS",n$,t$);let i$=jG(n$);Object.keys(i$).map(o$=>{o$==="LOG_UPLOAD_SERVER"||o$==="EVENT_REPORT_DOMAIN"||o$==="EVENT_REPORT_BACKUP_DOMAIN"||o$==="PROXY_SERVER_TYPE3"?Ot(o$,i$[o$][0]):Ot(o$,i$[o$])}),_.debug("set area success:",n$.join(","))}catch(n$){throw r$.onError(n$),n$}r$.onSuccess()}function QI(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function em(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?QI(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):QI(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var h_=1;function WG(e$,t$,r$,n$,i$){h_+=1;let o$={sid:r$.sid,command:"convergeAllocateEdge",uid:"666",appId:r$.appId,ts:Math.floor(Date.now()/1e3),seq:h_,requestId:h_,version:ii,cname:r$.cname},s$={service_name:t$,json_body:JSON.stringify(o$)},a$,c$,u$=e$[0];return Wi(async()=>{a$=Date.now();let l$=await Hi(u$,{data:s$,cancelToken:n$,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c$=Date.now()-a$,l$.code!==0){let p$=new O(R.UNEXPECTED_RESPONSE,"live streaming ap error, code"+l$.code,{retry:!0,responseTime:c$});throw _.error(p$.toString()),p$}let d$=JSON.parse(l$.json_body);if(d$.code!==200){let p$=new O(R.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(d$.code,", reason: ").concat(d$.reason),{code:d$.code,responseTime:c$});throw _.error(p$.toString()),p$}if(!d$.servers||d$.servers.length===0){let p$=new O(R.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:d$.code,responseTime:c$});throw _.error(p$.toString()),p$}let h$=function(p$,_$){return{addressList:p$.servers.map(f$=>"wss://".concat(f$.address.replace(/\./g,"-"),".").concat(v("WORKER_DOMAIN"),":").concat(f$.wss,"?serviceName=").concat(encodeURIComponent(_$))),workerToken:p$.workerToken,vid:p$.vid}}(d$,t$);return v("LIVE_STREAMING_ADDRESS")&&(h$.addressList=v("LIVE_STREAMING_ADDRESS")instanceof Array?v("LIVE_STREAMING_ADDRESS"):[v("LIVE_STREAMING_ADDRESS")]),em(em({},h$),{},{responseTime:c$})},(l$,d$)=>(X.apworkerEvent(r$.sid,{success:!0,sc:200,serviceName:t$,responseDetail:JSON.stringify(l$.addressList),firstSuccess:d$===0,responseTime:c$,serverIp:e$[d$%e$.length]}),!1),(l$,d$)=>(X.apworkerEvent(r$.sid,{success:!1,sc:l$.data&&l$.data.code||200,serviceName:t$,responseTime:c$,serverIp:e$[d$%e$.length]}),!!(l$.code!==R.OPERATION_ABORTED&&l$.code!==R.UNEXPECTED_RESPONSE||l$.data&&l$.data.retry)&&(u$=e$[(d$+1)%e$.length],!0)),i$)}var p_=1;function ZI(e$,t$,r$,n$){let{url:i$,areaCode:o$}=e$,{clientId:s$,sid:a$}=t$,c$=Date.now(),u$,[l$,d$]=wf(t$,o$,[ue.CHOOSE_SERVER]),h$=he.networkState;return Wi(async()=>{h$&&he.networkState===wn.OFFLINE&&he.onlineWaiter&&await j.race([he.onlineWaiter,Me(n$&&n$.maxRetryTimeout||Ee.maxRetryTimeout)]),h$=he.networkState;let{data:p$,headers:_$}=await Hi(i$,{data:l$,cancelToken:r$,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u$=_$.http3==="1"?1:-1,X.reportResourceTiming(i$,a$),l0(p$,i$,t$,c$,[ue.CHOOSE_SERVER],u$);let f$=Dc(p$,ue.CHOOSE_SERVER);return bf(f$),mf(f$,i$)},p$=>(p$&&X.joinChooseServer(a$,{lts:c$,succ:!0,csAddr:i$,opid:d$,serverList:p$.gatewayAddrs.map(_$=>_$.address),ec:null,cid:p$.cid.toString(),uid:p$.uid.toString(),csIp:p$.csIp,unilbsServerIds:[ue.CHOOSE_SERVER].toString(),isHttp3:u$}),!1),p$=>p$.code!==R.OPERATION_ABORTED&&(p$.code===R.CAN_NOT_GET_GATEWAY_SERVER?p$.data.retry:(X.joinChooseServer(a$,{lts:c$,succ:!1,csAddr:i$,serverList:null,opid:d$,ec:p$.code,csIp:p$.data&&p$.data.csIp,unilbsServerIds:[ue.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:h$}),isHttp3:u$}),_.warning("[".concat(s$||"sid-".concat(a$.slice(0,6)),"] Choose server network error, retry"),p$),!0)),n$)}function $I(e$,t$,r$,n$){let i$,{url:o$,areaCode:s$,serviceIds:a$}=e$,c$=Date.now(),[u$,l$]=wf(t$,s$,a$),d$;return Wi(async()=>{d$&&he.networkState===wn.OFFLINE&&he.onlineWaiter&&await j.race([he.onlineWaiter,Me(n$&&n$.maxRetryTimeout||Ee.maxRetryTimeout)]),d$=he.networkState;let{data:h$,headers:p$}=await Hi(o$,{data:u$,cancelToken:r$,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i$=p$.http3==="1"?1:-1,X.reportResourceTiming(o$,t$.sid),l0(h$,o$,t$,c$,a$,i$);let _$=Dc(h$,ue.CHOOSE_SERVER),f$=Dc(h$,t$.cloudProxyServer==="proxy5"?ue.CLOUD_PROXY_5:t$.cloudProxyServer==="proxy3"||t$.cloudProxyServer==="proxy4"?ue.CLOUD_PROXY:ue.CLOUD_PROXY_FALLBACK);return bf(_$),{gatewayInfo:mf(_$,o$),proxyInfo:f$,url:o$}},h$=>(h$.gatewayInfo&&X.joinChooseServer(t$.sid,{lts:c$,succ:!0,csAddr:o$,serverList:h$.gatewayInfo.gatewayAddrs.map(p$=>p$.address),ec:null,opid:l$,cid:h$.gatewayInfo.cid.toString(),uid:h$.gatewayInfo.uid.toString(),csIp:h$.gatewayInfo.csIp,unilbsServerIds:a$.toString(),isHttp3:i$}),h$.proxyInfo&&X.joinWebProxyAP(t$.sid,{lts:c$,sucess:1,apServerAddr:o$,turnServerAddrList:h$.proxyInfo.addresses.map(p$=>p$.ip).join(","),errorCode:null,eventType:t$.cloudProxyServer,unilbsServerIds:a$.toString()}),!1),h$=>h$.code!==R.OPERATION_ABORTED&&(h$.code===R.CAN_NOT_GET_GATEWAY_SERVER?h$.data.retry:(X.joinWebProxyAP(t$.sid,{lts:c$,sucess:0,apServerAddr:o$,turnServerAddrList:null,errorCode:h$.code,eventType:t$.cloudProxyServer,unilbsServerIds:a$.toString(),extend:JSON.stringify({networkState:d$})}),_.warning("[".concat(t$.clientId,"] multi unilbs network error, retry"),h$),!0)),n$)}var l0=(e$,t$,r$,n$,i$,o$)=>{let{sid:s$,clientId:a$,cloudProxyServer:c$}=r$,u$=[],l$=d$=>{d$.flag===4096?X.joinChooseServer(s$,{lts:n$,succ:!1,csAddr:t$,opid:e$.opid,serverList:null,ec:d$.error.message,csIp:d$.error.data&&d$.error.data.csIp,unilbsServerIds:i$.toString(),isHttp3:o$}):d$.flag!==1048576&&d$.flag!==4194304&&d$.flag!==4194310||X.joinWebProxyAP(s$,{lts:n$,sucess:0,apServerAddr:t$,turnServerAddrList:null,errorCode:d$.error.code,eventType:c$,unilbsServerIds:i$.toString()})};if(e$.response_body.forEach(d$=>{let h$=d$.buffer.code;if(d$.uri===23&&h$===0&&!d$.buffer.edges_services)if(d$.buffer.flag===4194310)_.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),d$.buffer.edges_services=[];else{let p$={error:new O(R.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e$.detail[502]}),flag:d$.buffer.flag};u$.push(p$),l$(p$)}if(h$!==0){let p$=ta(h$),_$={error:new O(R.CAN_NOT_GET_GATEWAY_SERVER,p$.desc,{desc:p$.desc,retry:p$.retry,csIp:e$.detail[502]}),flag:d$.buffer.flag};d$.buffer.flag===4194310?_.warning(_$.error.toString()):u$.push(_$),l$(_$)}}),u$.length)throw _.warning("[".concat(a$||"sid-".concat(s$.slice(0,6)),"] multi unilbs ").concat(t$," failed, ").concat(u$.map(d$=>"flag: ".concat(d$.flag,", message: ").concat(d$.error.message,", retry: ").concat(d$.error.data.retry)).join(" | "))),new O(R.CAN_NOT_GET_GATEWAY_SERVER,u$.map(d$=>"flag: ".concat(d$.flag,", message: ").concat(d$.error.message)).join(" | "),{retry:!!u$.find(d$=>d$.error.data.retry),csIp:e$.detail[502],desc:[...new Set(u$.map(d$=>{var h$;return d$==null||(h$=d$.error)===null||h$===void 0||(h$=h$.data)===null||h$===void 0?void 0:h$.desc}).filter(d$=>!!d$))]})},bf=e$=>{var t$,r$,n$,i$;if(e$.addresses&&e$.addresses.length===0&&e$.code===0)throw new O(R.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e$.detail&&e$.detail[502]});if(v("AP_AREA")&&((n$=e$.detail)!==null&&n$!==void 0&&n$[23]&&typeof((i$=e$.detail)===null||i$===void 0?void 0:i$[23])=="string"?XI(e$.detail[23].toLowerCase()):XI()),(t$=e$.detail)!==null&&t$!==void 0&&t$[19]&&typeof((r$=e$.detail)===null||r$===void 0?void 0:r$[19])=="string"){let s$=e$.detail[19],a$=s$==null?void 0:s$.split(";");for(let c$=0;c$<a$.length;c$++){var o$;let u$=rn(o$=a$[c$]).call(o$);e$.addresses[c$]&&a$&&(e$.addresses[c$].fingerprint=u$)}}if(v("GATEWAY_ADDRESS")&&v("GATEWAY_ADDRESS").length>0){_.debug("assign gateway address to",v("GATEWAY_ADDRESS"));let s$=v("GATEWAY_ADDRESS").map(a$=>{var c$,u$;let l$=(c$=(u$=e$.addresses.find(d$=>d$.ip===a$.ip&&d$.port===a$.port))===null||u$===void 0?void 0:u$.fingerprint)!==null&&c$!==void 0?c$:"";return{ip:a$.ip,port:a$.port,ticket:e$.addresses[0]&&e$.addresses[0].ticket,fingerprint:l$}});e$.addresses=s$}},HG=(e$,t$)=>{if(e$.response_body&&e$.response_body.length){let r$=e$.response_body[0];if(r$.buffer.code!==0){let n$=ta(r$.buffer.code);throw new O(R.UPDATE_TICKET_FAILED,"[".concat(r$.buffer.code,"]: ").concat(n$.desc),{retry:n$.retry})}return r$.buffer.ticket}throw _.debug("update ticket request received ap response without response body:",t$),new O(R.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},wf=(e$,t$,r$)=>{let n$=Math.floor(Math.random()*1e12),i$={appid:e$.appId,client_ts:Date.now(),opid:n$,sid:e$.sid,request_bodies:[{uri:22,buffer:{cname:e$.cname,detail:em({6:e$.stringUid,11:t$,12:v("USE_NEW_TOKEN")?"1":void 0,22:t$},e$.apRTM?{26:"RTM2"}:{}),key:e$.token,service_ids:r$,uid:e$.uid||0}}]};i$.request_bodies.forEach(s$=>{e$.multiIP&&e$.multiIP.gateway_ip&&(s$.buffer.detail[5]=JSON.stringify({vocs_ip:[e$.multiIP.uni_lbs_ip],vos_ip:[e$.multiIP.gateway_ip]}))});let o$=new FormData;return o$.append("request",JSON.stringify(i$)),[o$,n$]},KG=(e$,t$)=>{let r$=Math.floor(Math.random()*1e12),n$={appid:e$.appId,client_ts:Date.now(),opid:r$,sid:e$.sid,request_bodies:[{uri:28,buffer:{cname:e$.cname,detail:{1:"",6:e$.stringUid,12:"1"},token:e$.token,service_ids:t$,uid:e$.uid||0,edges_services:e$.apResponse.addresses.map(o$=>({ip:o$.ip,port:o$.port}))}}]},i$=new FormData;return i$.append("request",JSON.stringify(n$)),[i$,r$]},Ys=0;function Ta(e$){return j.all(e$.map(t$=>t$.then(r$=>{throw r$},r$=>r$))).then(t$=>{throw t$},t$=>t$)}var Uc=async e$=>{let{fragementLength:t$,referenceList:r$,asyncMapHandler:n$,allFailedhandler:i$,promisesCollector:o$}=e$,s$=0,a$=t$,c$,u$=0,l$=async()=>{let d$=(()=>{let h$=s$*a$,p$=h$+a$;return r$.slice(h$,p$).map(n$)})();o$&&o$.push(...d$);try{c$=await Ta(d$)}catch(h$){if(u$+=a$,s$++,!(u$>=r$.length))return void await l$();i$(h$)}d$.forEach(h$=>h$.cancel())};return await l$(),c$},u0=async e$=>{let{referenceList:t$,asyncMapHandler:r$,closeFn:n$}=e$,i$=t$.length,o$=0,s$=async()=>{let a$=r$(t$.shift());try{return await a$}catch(c$){if(o$++,o$>=i$||n$!=null&&n$(c$))throw c$;return s$()}};return s$()};async function nm(e$,t$,r$,n$){return{gatewayInfo:await async function(i$,o$,s$,a$){let c$=null,u$=[],l$=async()=>{let h$=v("WEBCS_DOMAIN").slice(0,v("AJAX_REQUEST_CONCURRENT")).map(f$=>({url:i$.proxyServer?"https://".concat(i$.proxyServer,"/ap/?url=").concat(f$+"/api/v2/transpond/webrtc?v=2"):"https://".concat(f$,"/api/v2/transpond/webrtc?v=2"),areaCode:Mc()})),p$=a$.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:h$.map(f$=>f$.url)}),_$=await Uc({fragementLength:v("FRAGEMENT_LENGTH"),referenceList:h$,asyncMapHandler:f$=>(_.debug("[".concat(i$.clientId,"] Connect to choose_server:"),f$.url),ZI(f$,i$,o$,s$)),allFailedhandler:f$=>{throw a$.recordJoinChannelService({endTs:Date.now(),status:"error",errors:f$},p$),f$[0]},promisesCollector:u$});return a$.recordJoinChannelService({endTs:Date.now(),status:"success"},p$),_$},d$=async()=>{if(await Me(1e3),c$!==null)return c$;let h$=v("WEBCS_DOMAIN_BACKUP_LIST").map(f$=>({url:i$.proxyServer?"https://".concat(i$.proxyServer,"/ap/?url=").concat(f$+"/api/v2/transpond/webrtc?v=2"):"https://".concat(f$,"/api/v2/transpond/webrtc?v=2"),areaCode:Mc()})),p$=a$.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:h$.map(f$=>f$.url)}),_$=await Uc({fragementLength:v("FRAGEMENT_LENGTH"),referenceList:h$,asyncMapHandler:f$=>(_.debug("[".concat(i$.clientId,"] Connect to backup choose_server:"),f$.url),ZI(f$,i$,o$,s$)),allFailedhandler:f$=>{throw a$.recordJoinChannelService({endTs:Date.now(),status:"error",errors:f$},p$),f$[0]},promisesCollector:u$});return a$.recordJoinChannelService({endTs:Date.now(),status:"success"},p$),_$};try{return c$=await Ta([l$(),d$()]),u$.length&&u$.forEach(h$=>h$.cancel&&typeof h$.cancel=="function"&&h$.cancel()),c$}catch(h$){throw h$[0]}}(e$,t$,r$,n$)}}async function tv(e$,t$,r$,n$,i$){let o$=e$.cloudProxyServer;if(o$==="disabled"){if(e$.useLocalAccessPoint)return await nm(e$,t$,r$,i$);if(v("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:h$,proxyInfo:p$}=await nv(e$,t$,r$,i$);if(e$.turnServer&&e$.turnServer.mode!=="auto")return{gatewayInfo:h$};let _$=p$.map(f$=>({turnServerURL:f$.address,tcpport:f$.tcpport||Ve.tcpport,udpport:f$.udpport||Ve.udpport,username:f$.username||Ve.username,password:f$.password||Ve.password,forceturn:!1,security:!0}));if(i$.useP2P){var s$;let f$=(s$=e$.uid)!==null&&s$!==void 0?s$:h$.uid,m$="glb:".concat(f$.toString()),g$=await PE(m$),v$=p$.map(y$=>({turnServerURL:y$.address,tcpport:y$.tcpport||Ve.tcpport,udpport:y$.udpport||Ve.udpport,username:m$,password:g$,forceturn:!1,security:!0}));_$.push(...v$)}return e$.turnServer={mode:"manual",servers:_$},{gatewayInfo:h$}}return await nm(e$,t$,r$,i$)}let{proxyInfo:a$,gatewayInfo:c$}=await nv(e$,t$,r$,i$),u$={gatewayInfo:c$},l$=a$.map(h$=>({turnServerURL:h$.address,tcpport:o$==="proxy3"?void 0:h$.tcpport?h$.tcpport:Ve.tcpport,udpport:o$==="proxy4"?void 0:h$.udpport?h$.udpport:Ve.udpport,username:h$.username||Ve.username,password:h$.password||Ve.password,forceturn:o$!=="proxy4",security:o$==="proxy5"}));if(i$.useP2P){var d$;let h$=(d$=e$.uid)!==null&&d$!==void 0?d$:c$.uid,p$="glb:".concat(h$.toString()),_$=await PE(p$),f$=a$.map(m$=>({turnServerURL:m$.address,tcpport:o$==="proxy3"?void 0:m$.tcpport||Ve.tcpport,udpport:o$==="proxy4"?void 0:m$.udpport||Ve.udpport,username:p$,password:_$,forceturn:o$!=="proxy4",security:o$==="proxy5"}));l$.push(...f$)}return e$.turnServer={mode:"manual",servers:l$},_.debug("[".concat(e$.clientId,"] set proxy server: ").concat(e$.proxyServer,", mode: ").concat(o$)),u$}async function h0(e$,t$,r$,n$,i$){let o$=v("ACCOUNT_REGISTER").slice(0,v("AJAX_REQUEST_CONCURRENT")),s$=[];s$=t$.proxyServer?o$.map(c$=>"https://".concat(t$.proxyServer,"/ap/?url=").concat(c$+"/api/v1")):o$.map(c$=>"https://".concat(c$,"/api/v1"));let a$=i$==null?void 0:i$.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:s$});try{let c$=await async function(u$,l$,d$,h$,p$){let _$=Date.now(),f$={sid:d$.sid,opid:10,appid:d$.appId,string_uid:l$},m$=u$[0],g$=await Wi(()=>Hi(m$+"".concat(m$.indexOf("?")===-1?"?":"&","action=stringuid"),{data:f$,cancelToken:h$,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(v$,y$)=>{if(v$.code===0){if(v$.uid<=0||v$.uid>=Math.pow(2,32))throw _.error("Invalid Uint Uid ".concat(l$," => ").concat(v$.uid),v$),X.reqUserAccount(f$.sid,{lts:_$,success:!1,serverAddr:m$,stringUid:f$.string_uid,uid:v$.uid,errorCode:R.INVALID_UINT_UID_FROM_STRING_UID,extend:f$}),new O(R.INVALID_UINT_UID_FROM_STRING_UID);return X.reqUserAccount(f$.sid,{lts:_$,success:!0,serverAddr:m$,stringUid:f$.string_uid,uid:v$.uid,errorCode:null,extend:f$}),!1}let S$=ta(v$.code);return S$.retry&&(m$=u$[(y$+1)%u$.length]),X.reqUserAccount(f$.sid,{lts:_$,success:!1,serverAddr:m$,stringUid:f$.string_uid,uid:v$.uid,errorCode:S$.desc,extend:f$}),S$.retry},(v$,y$)=>v$.code!==R.OPERATION_ABORTED&&(X.reqUserAccount(f$.sid,{lts:_$,success:!1,serverAddr:m$,stringUid:f$.string_uid,uid:null,errorCode:v$.code,extend:f$}),m$=u$[(y$+1)%u$.length],!0),p$);if(g$.code!==0){let v$=ta(g$.code);throw new O(R.UNEXPECTED_RESPONSE,v$.desc)}return g$}(s$,e$,t$,r$,n$);return i$==null||i$.recordJoinChannelService({status:"success",endTs:Date.now()},a$),c$.uid}catch(c$){throw i$==null||i$.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[c$]},a$),c$}}async function YG(e$,t$,r$){let n$=v("ACCOUNT_REGISTER"),i$=[];i$=t$.proxyServer?n$.map(o$=>"https://".concat(t$.proxyServer,"/ap/?url=").concat(o$+"/api/v1")):n$.map(o$=>"https://".concat(o$,"/api/v1"));try{return await u0({referenceList:i$,asyncMapHandler:o$=>async function(s$,a$,c$,u$){let l$=Date.now(),d$={sid:c$.sid,opid:10,appid:c$.appId,string_uid:a$};try{let h$=await Hi(s$+"".concat(s$.indexOf("?")===-1?"?":"&","action=stringuid"),{data:d$,cancelToken:u$,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(h$.code!==0){let p$=ta(h$.code);throw new O(R.UNEXPECTED_RESPONSE,"preload sua error:".concat(p$.desc),p$)}if(h$.uid<=0||h$.uid>=Math.pow(2,32))throw new O(R.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:l$,url:s$,req:d$,uid:h$.uid,elapse:Date.now()-l$}}catch(h$){throw h$}}(o$,e$,t$,r$),closeFn:o$=>o$.code===R.OPERATION_ABORTED||o$.code===R.UNEXPECTED_RESPONSE&&!o$.data.retry})}catch(o$){throw o$}}async function qG(e$,t$,r$){let n$=v("CDS_AP").slice(0,v("AJAX_REQUEST_CONCURRENT")).map(c$=>e$.proxyServer?"https://".concat(e$.proxyServer,"/ap/?url=").concat(c$+"/api/v1"):"https://".concat(c$,"/api/v1?action=config")),i$=n$.map(c$=>function(u$,l$,d$,h$){let p$=mt(),_$={flag:64,cipher_method:0,features:{device:p$.name,system:p$.os,system_general:navigator.userAgent,vendor:l$.appId,version:ii,cname:l$.cname,sid:l$.sid,session_id:l$.sid,detail:"",proxyServer:l$.proxyServer}};return Wi(()=>Hi(u$,{data:_$,timeout:1e3,cancelToken:d$,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,f$=>f$.code!==R.OPERATION_ABORTED,h$)}(c$,e$,t$,r$)),o$=null,s$=null,a$={};try{o$=await Ta(i$)}catch(c$){if(c$.code===R.OPERATION_ABORTED)throw c$;s$=c$}if(i$.forEach(c$=>c$.cancel()),X.reportApiInvoke(e$.sid,{name:Te.REQUEST_CONFIG_DISTRIBUTE,options:{error:s$,res:o$}}).onSuccess(),o$&&o$.test_tags)try{a$=function(c$){if(!c$.test_tags)return{};let u$=c$.test_tags,l$=Object.keys(u$),d$={};return l$.forEach(h$=>{var p$;let _$=rn(p$=h$.slice(4)).call(p$),f$=JSON.parse(u$[h$])[1];d$[_$]=f$}),d$}(o$)}catch{}return a$}async function ev(e$,t$){let r$=v("WEBCS_DOMAIN").concat(v("WEBCS_DOMAIN_BACKUP_LIST")).map(n$=>({url:"https://".concat(n$,"/api/v2/transpond/webrtc?v=2"),areaCode:Mc(),serviceIds:[ue.CHOOSE_SERVER,ue.CLOUD_PROXY_FALLBACK]}));try{return await u0({referenceList:r$,asyncMapHandler:n$=>async function(i$,o$,s$){let a$,{url:c$,areaCode:u$,serviceIds:l$}=i$,d$=Date.now(),[h$,p$]=wf(o$,u$,l$),_$=he.networkState;try{_$&&he.networkState===wn.OFFLINE&&he.onlineWaiter&&await j.race([he.onlineWaiter,Me(Ee.maxRetryTimeout)]),_$=he.networkState;let{data:f$,headers:m$}=await Hi(c$,{data:h$,cancelToken:s$,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);a$=m$.http3==="1"?1:-1,(y$=>{let S$=[];if(y$.response_body.forEach(b$=>{let $$=b$.buffer.code;if(b$.uri===23&&$$===0&&!b$.buffer.edges_services)if(b$.buffer.flag===4194310)b$.buffer.edges_services=[];else{let C$={error:new O(R.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:y$.detail[502]}),flag:b$.buffer.flag};S$.push(C$)}if($$!==0){let C$=ta($$),N$={error:new O(R.CAN_NOT_GET_GATEWAY_SERVER,C$.desc,{desc:C$.desc,retry:C$.retry,csIp:y$.detail[502]}),flag:b$.buffer.flag};b$.buffer.flag===4194310?_.warning(N$.error.toString()):S$.push(N$)}}),S$.length)throw new O(R.CAN_NOT_GET_GATEWAY_SERVER,S$.map(b$=>"flag: ".concat(b$.flag,", message: ").concat(b$.error.message)).join(" | "),{retry:!!S$.find(b$=>b$.error.data.retry),csIp:y$.detail[502],desc:[...new Set(S$.map(b$=>{var $$;return b$==null||($$=b$.error)===null||$$===void 0||($$=$$.data)===null||$$===void 0?void 0:$$.desc}).filter(b$=>!!b$))]})})(f$);let g$=Dc(f$,ue.CHOOSE_SERVER),v$=Dc(f$,ue.CLOUD_PROXY_FALLBACK);return bf(g$),{gatewayInfo:mf(g$,c$),proxyInfo:v$,opid:p$,requestTime:d$,url:c$,isHttp3:a$,elapse:Date.now()-d$}}catch(f$){throw f$}}(n$,e$,t$),closeFn:n$=>n$.code===R.OPERATION_ABORTED||n$.code===R.CAN_NOT_GET_GATEWAY_SERVER&&!n$.data.retry})}catch(n$){throw n$}}async function nv(e$,t$,r$,n$){let i$=v("PROXY_SERVER_TYPE3"),o$=(p$,_$,f$)=>{let m$=f$||i$;return Array.isArray(m$)&&(m$=_$%2==0?i$[1]:i$[0]),"https://".concat(m$,"/ap/?url=").concat(p$)},s$=null,a$=[],c$=async()=>{let p$=v("WEBCS_DOMAIN").slice(0,v("AJAX_REQUEST_CONCURRENT")).map((m$,g$)=>{let v$;return v$=e$.cloudProxyServer==="disabled"&&e$.proxyServer?o$("".concat(m$,"/api/v2/transpond/webrtc?v=2"),g$,e$.proxyServer):e$.cloudProxyServer==="disabled"||e$.cloudProxyServer==="fallback"?"https://".concat(m$,"/api/v2/transpond/webrtc?v=2"):o$("".concat(m$,"/api/v2/transpond/webrtc?v=2"),g$),{url:v$,areaCode:Mc(),serviceIds:[ue.CHOOSE_SERVER,e$.cloudProxyServer==="proxy5"?ue.CLOUD_PROXY_5:e$.cloudProxyServer==="proxy3"||e$.cloudProxyServer==="proxy4"?ue.CLOUD_PROXY:ue.CLOUD_PROXY_FALLBACK]}}),_$=n$.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p$.map(m$=>m$.url)}),f$=await Uc({fragementLength:v("FRAGEMENT_LENGTH"),referenceList:p$,asyncMapHandler:m$=>(_.debug("[".concat(e$.clientId,"] Connect to choose_server:"),m$.url),$I(m$,e$,t$,r$)),allFailedhandler:m$=>{throw n$.recordJoinChannelService({endTs:Date.now(),status:"error",errors:m$},_$),m$[0]},promisesCollector:a$});return n$.recordJoinChannelService({endTs:Date.now(),status:"success"},_$),f$},u$=async()=>{if(await Me(1e3),s$!==null)return s$;let p$=v("WEBCS_DOMAIN_BACKUP_LIST").map((m$,g$)=>{let v$;return v$=e$.cloudProxyServer==="disabled"&&e$.proxyServer?o$("".concat(m$,"/api/v2/transpond/webrtc?v=2"),g$,e$.proxyServer):e$.cloudProxyServer==="disabled"||e$.cloudProxyServer==="fallback"?"https://".concat(m$,"/api/v2/transpond/webrtc?v=2"):o$("".concat(m$,"/api/v2/transpond/webrtc?v=2"),g$),{url:v$,areaCode:Mc(),serviceIds:[ue.CHOOSE_SERVER,e$.cloudProxyServer==="proxy5"?ue.CLOUD_PROXY_5:e$.cloudProxyServer==="proxy3"||e$.cloudProxyServer==="proxy4"?ue.CLOUD_PROXY:ue.CLOUD_PROXY_FALLBACK]}}),_$=n$.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p$.map(m$=>m$.url)}),f$=await Uc({fragementLength:v("FRAGEMENT_LENGTH"),referenceList:p$,asyncMapHandler:m$=>(_.debug("[".concat(e$.clientId,"] Connect to backup choose_server:"),m$.url),$I(m$,e$,t$,r$)),allFailedhandler:m$=>{throw n$.recordJoinChannelService({endTs:Date.now(),status:"error",errors:m$},_$),m$[0]},promisesCollector:a$});return n$.recordJoinChannelService({endTs:Date.now(),status:"success"},_$),f$},l$,d$,h$;try{({gatewayInfo:l$,proxyInfo:d$,url:h$}=await Ta([c$(),u$()]))}catch(p$){throw p$[0]}if(a$.length&&a$.forEach(p$=>p$.cancel&&typeof p$.cancel=="function"&&p$.cancel()),!l$||!d$)throw new O(R.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e$.apUrl=h$,e$.cloudProxyServer!=="disabled"&&Array.isArray(i$)&&h$){let p$=/^https?:\/\/(.+?)(\/.*)?$/.exec(h$)[1];W(i$).call(i$,p$)&&(e$.proxyServer=p$,_.setProxyServer(p$),X.setProxyServer(p$))}return s$={gatewayInfo:l$,proxyInfo:await kO(d$,l$.uid)},s$}async function zG(e$,t$,r$){let n$=v("UAP_AP").slice(0,v("AJAX_REQUEST_CONCURRENT")).map(o$=>e$.proxyServer?"https://".concat(e$.proxyServer,"/ap/?url=").concat(o$+"/api/v1?action=uap"):"https://".concat(o$,"/api/v1?action=uap")),i$=n$.map(o$=>function(s$,a$,c$,u$){let l$={command:"convergeAllocateEdge",sid:a$.sid,appId:a$.appId,token:a$.token,ts:Date.now(),version:ii,cname:a$.cname,uid:a$.uid.toString(),requestId:p_,seq:p_};p_+=1;let d$={service_name:"tele_channel",json_body:JSON.stringify(l$)};return Wi(async()=>{let h$=await Hi(s$,{data:d$,cancelToken:c$,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(h$.code!==0){let _$=new O(R.UNEXPECTED_RESPONSE,"cross channel ap error, code"+h$.code,{retry:!0});throw _.error(_$.toString()),_$}let p$=JSON.parse(h$.json_body);if(p$.code!==200){let _$=new O(R.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(p$.code,", reason: ").concat(p$.reason));throw _.error(_$.toString()),_$}if(!p$.servers||p$.servers.length===0){let _$=new O(R.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw _.error(_$.toString()),_$}return{vid:p$.vid,workerToken:p$.workerToken,addressList:(v("CHANNEL_MEDIA_RELAY_SERVERS")||p$.servers).map(_$=>"wss://".concat(_$.address.replace(/\./g,"-"),".").concat(v("WORKER_DOMAIN"),":").concat(_$.wss))}},void 0,h$=>!!(h$.code!==R.OPERATION_ABORTED&&h$.code!==R.UNEXPECTED_RESPONSE||h$.data&&h$.data.retry),u$)}(o$,e$,t$,r$));try{let o$=await Ta(i$);return i$.forEach(s$=>s$.cancel()),o$}catch(o$){throw o$[0]}}async function JG(e$,t$,r$){let n$=null,i$=[],o$=async s$=>{let a$=v(s$?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(c$=>e$.proxyServer?"https://".concat(e$.proxyServer,"/ap/?url=").concat(c$+"/api/v2/transpond/webrtc?v=2"):"https://".concat(c$,"/api/v2/transpond/webrtc?v=2"));return s$&&(await Me(1e3),n$!==null)?n$:await Uc({fragementLength:v("FRAGEMENT_LENGTH"),referenceList:a$,asyncMapHandler:c$=>(_.debug("[".concat(e$.clientId,"] update ticket, Connect to ").concat(s$?"backup":""," choose_server:"),c$),function(u$,l$,d$,h$){let[p$]=KG(l$,[ue.CHOOSE_SERVER]),_$=he.networkState;return Wi(async()=>{_$&&he.networkState===wn.OFFLINE&&he.onlineWaiter&&await j.race([he.onlineWaiter,Me(h$&&h$.maxRetryTimeout||Ee.maxRetryTimeout)]),_$=he.networkState;let f$=await Hi(u$,{data:p$,cancelToken:d$,headers:{"Content-Type":"multipart/form-data;"}},!0);return HG(f$,u$)},()=>!1,f$=>f$.code!==R.OPERATION_ABORTED&&(f$.code===R.UPDATE_TICKET_FAILED?f$.data.retry:(_.warning("[".concat(l$.clientId,"] update ticket network error, retry"),f$),!0)),h$)}(c$,e$,t$,r$)),allFailedhandler:c$=>{throw c$[0]},promisesCollector:i$})};try{return n$=await Ta([o$(!1),o$(!0)]),i$.length&&i$.forEach(s$=>s$.cancel&&typeof s$.cancel=="function"&&s$.cancel()),n$}catch(s$){throw s$[0]}}function iv(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function rv(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?iv(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):iv(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var im=class extends Xt{get isSuccess(){return!!this.configs}constructor(){super(),T(this,"configs",void 0),T(this,"joinInfo",void 0),T(this,"cancelToken",void 0),T(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),T(this,"interval",void 0),T(this,"mutex",new ze("config-distribute")),T(this,"mutableParamsRead",!1)}startGetConfigDistribute(e$,t$){this.joinInfo=e$,this.cancelToken=t$,this.interval&&this.stopGetConfigDistribute(),v("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},v("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,X.reportApiInvoke(null,{options:void 0,name:Te.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Zt.TRACER}).onSuccess(JSON.stringify($r))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void _.debug("[config-distribute] get config distribute interrupted have no joininfo");let e$,t$=await this.mutex.lock();try{e$=await qG(this.joinInfo,this.cancelToken,this.retryConfig),_.debug("[config-distribute] get config distribute",JSON.stringify(e$)),e$.limit_bitrate&&this.handleBitrateLimit(e$.limit_bitrate),this.cacheGlobalParameterConfig(e$),this.configs=e$}catch(r$){let n$=new O(R.NETWORK_RESPONSE_ERROR,r$);_.warning("[config-distribute] ".concat(n$.toString()))}finally{t$()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e$){var t$;(t$=e$)&&t$.uplink&&t$.id&&t$.uplink.max_bitrate!==void 0&&t$.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e$.id&&this.emit(FE.UPDATE_BITRATE_LIMIT,e$):this.emit(FE.UPDATE_BITRATE_LIMIT,e$))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&rv({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e$){var t$;let r$=ed(t$=Object.keys(e$).filter(i$=>/^webrtc_ng_global_parameter/.test(i$))).call(t$);for(let i$=0;i$<r$.length;i$++)for(let o$=r$.length-1;o$>i$;o$--){let s$=r$[o$];if(typeof e$[s$].__priority=="number"){let a$=e$[s$].__priority,c$=r$[o$-1];if(typeof e$[c$].__priority=="number"){if(!(a$>e$[c$].__priority))continue;{let u$=s$;r$[o$]=r$[o$-1],r$[o$-1]=u$}}else{let u$=s$;r$[o$]=r$[o$-1],r$[o$-1]=u$}}}let n$={};r$.forEach(i$=>{let o$=e$[i$],s$=o$.__expires;Object.keys(o$).forEach(a$=>{a$==="__priority"||a$==="__expires"||Object.prototype.hasOwnProperty.call(n$,a$)||(n$[a$]=rv({value:o$[a$]},s$&&{expires:s$}))})});try{(function(s$){try{let a$=Date.now();Object.keys(s$).forEach(c$=>{switch(c$){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(oe,c$)){let{value:u$,expires:l$}=s$[c$];if(l$&&l$<=a$)return;$r[c$]=u$,oe[c$]=u$,_.debug("Update global parameters from config distribute",c$,u$)}}})}catch(a$){_.error("Error update config immediately: ".concat(s$),a$.message)}})(n$);let i$=JSON.stringify(n$),o$=window.btoa(i$);window.localStorage.setItem("websdk_ng_global_parameter",o$),_.debug("Caching global parameters ".concat(i$))}catch(i$){_.error("Error caching global parameters:",i$.message)}}},rm=class extends Xt{constructor(){super(...arguments),T(this,"resultStorage",new Map)}setLocalAudioStats(e$,t$,r$){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e$,this.checkAudioInputLevel(r$,t$)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e$,this.checkSendAudioBitrate(r$,t$))}setLocalVideoStats(e$,t$,r$){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e$,this.checkSendVideoBitrate(r$,t$)),this.record("FRAMERATE_INPUT_TOO_LOW",e$,this.checkFramerateInput(r$,t$)),this.record("FRAMERATE_SENT_TOO_LOW",e$,this.checkFramerateSent(r$))}setRemoteAudioStats(e$,t$){let r$=e$.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r$,this.checkAudioOutputLevel(t$))}setRemoteVideoStats(e$,t$){let r$=e$.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r$,this.checkVideoDecode(t$))}record(e$,t$,r$){if(v("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e$)||this.resultStorage.set(e$,{result:[],isPrevNormal:!0});let n$=this.resultStorage.get(e$);if(n$&&(n$.result.push(r$),n$.result.length>=5)){var i$;let o$=W(i$=n$.result).call(i$,!0);n$.isPrevNormal&&!o$&&this.emit("exception",ov[e$],e$,t$),!n$.isPrevNormal&&o$&&this.emit("exception",ov[e$]+2e3,e$+"_RECOVER",t$),n$.isPrevNormal=o$,n$.result=[]}}checkAudioOutputLevel(e$){return!(e$.receiveBitrate>0&&e$.receiveLevel===0)}checkAudioInputLevel(e$,t$){return t$ instanceof ge&&!t$.isActive||!!t$.muted||e$.sendVolumeLevel!==0}checkFramerateInput(e$,t$){let r$=null;t$._encoderConfig&&t$._encoderConfig.frameRate&&(r$=Nn(t$._encoderConfig.frameRate));let n$=e$.captureFrameRate;return!r$||!n$||!(r$>10&&n$<5||r$<10&&r$>=5&&n$<=1)}checkFramerateSent(e$){return!(e$.captureFrameRate&&e$.sendFrameRate&&e$.captureFrameRate>5&&e$.sendFrameRate<=1)}checkSendVideoBitrate(e$,t$){return!!t$.muted||e$.sendBitrate!==0}checkSendAudioBitrate(e$,t$){return t$ instanceof ge&&!t$.isActive||!!t$.muted||e$.sendBitrate!==0}checkVideoDecode(e$){return e$.receiveBitrate===0||e$.decodeFrameRate!==0}},ov={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},qe=new class{markSubscribeStart(e$,t$){performance.mark("agora-web-sdk/".concat(e$,"/subscribe-").concat(t$))}markPublishStart(e$,t$){performance.mark("agora-web-sdk/".concat(e$,"/publish-").concat(t$))}measureFromSubscribeStart(e$,t$){let r$=performance.getEntriesByName("agora-web-sdk/".concat(e$,"/subscribe-").concat(t$));if(r$.length>0){let n$=r$[r$.length-1];return Math.round(performance.now()-n$.startTime)}return 0}measureFromPublishStart(e$,t$){let r$=performance.getEntriesByName("agora-web-sdk/".concat(e$,"/publish-").concat(t$));if(r$.length>0){let n$=r$[r$.length-1];return Math.round(performance.now()-n$.startTime)}return 0}};function Of(e$,t$){this.v=e$,this.k=t$}function Tt(e$){return new Of(e$,0)}var XG=Lb,QG=mr;xt({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e$=QG.f(this);return{promise:e$.promise,resolve:e$.resolve,reject:e$.reject}}});var ZG=mr,$G=_a;xt({target:"Promise",stat:!0,forced:!0},{try:function(e$){var t$=ZG.f(this),r$=$G(e$);return(r$.error?t$.reject:t$.resolve)(r$.value),t$.promise}});var om=ae(XG),p0=Ea.f("asyncIterator"),tW=ae(p0);function Ja(e$){var t$,r$;function n$(o$,s$){try{var a$=e$[o$](s$),c$=a$.value,u$=c$ instanceof Of;om.resolve(u$?c$.v:c$).then(function(l$){if(u$){var d$=o$==="return"?"return":"next";if(!c$.k||l$.done)return n$(d$,l$);l$=e$[d$](l$).value}i$(a$.done?"return":"normal",l$)},function(l$){n$("throw",l$)})}catch(l$){i$("throw",l$)}}function i$(o$,s$){switch(o$){case"return":t$.resolve({value:s$,done:!0});break;case"throw":t$.reject(s$);break;default:t$.resolve({value:s$,done:!1})}(t$=t$.next)?n$(t$.key,t$.arg):r$=null}this._invoke=function(o$,s$){return new om(function(a$,c$){var u$={key:o$,arg:s$,resolve:a$,reject:c$,next:null};r$?r$=r$.next=u$:(t$=r$=u$,n$(o$,s$))})},typeof e$.return!="function"&&(this.return=void 0)}function Bi(e$){return function(){return new Ja(e$.apply(this,arguments))}}Ja.prototype[typeof Ds=="function"&&tW||"@@asyncIterator"]=function(){return this},Ja.prototype.next=function(e$){return this._invoke("next",e$)},Ja.prototype.throw=function(e$){return this._invoke("throw",e$)},Ja.prototype.return=function(e$){return this._invoke("return",e$)};var sv=ae(Gi.Object.getOwnPropertySymbols),eW=xt,nW=Nm.indexOf,iW=Nu,sm=gc([].indexOf),av=!!sm&&1/sm([1],1,-0)<0;eW({target:"Array",proto:!0,forced:av||!iW("indexOf")},{indexOf:function(e$){var t$=arguments.length>1?arguments[1]:void 0;return av?sm(this,e$,t$)||0:nW(this,e$,t$)}});var rW=bi("Array").indexOf,oW=hn,sW=rW,__=Array.prototype,aW=function(e$){var t$=e$.indexOf;return e$===__||oW(__,e$)&&t$===__.indexOf?sW:t$},cv=ae(aW);function cW(e$,t$){if(e$==null)return{};var r$,n$,i$=function(s$,a$){if(s$==null)return{};var c$,u$,l$={},d$=NO(s$);for(u$=0;u$<d$.length;u$++)c$=d$[u$],cv(a$).call(a$,c$)>=0||(l$[c$]=s$[c$]);return l$}(e$,t$);if(sv){var o$=sv(e$);for(n$=0;n$<o$.length;n$++)r$=o$[n$],cv(t$).call(t$,r$)>=0||Object.prototype.propertyIsEnumerable.call(e$,r$)&&(i$[r$]=e$[r$])}return i$}function Si(e$){if(Array.isArray(e$))return e$.map(r$=>r$);if(!dv(e$))return e$;let t$={};for(let r$ in e$){let n$=e$[r$];dv(n$)||Array.isArray(n$)?t$[r$]=Si(n$):t$[r$]=n$}return t$}function dv(e$){return!(typeof e$!="object"||Array.isArray(e$)||!e$)}var cc=class{constructor(e$){T(this,"input",[]),T(this,"size",void 0),this.size=e$}add(e$){this.input.push(e$),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},hr={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},xc={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:hr,remoteCandidate:hr}},_0={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},E0={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},m0={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},f0={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function lv(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function uv(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?lv(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):lv(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var Vc=class{constructor(e$,t$){T(this,"onFirstVideoReceived",void 0),T(this,"onFirstVideoDecoded",void 0),T(this,"onFirstAudioReceived",void 0),T(this,"onFirstVideoDecodedTimeout",void 0),T(this,"onFirstAudioDecoded",void 0),T(this,"onSelectedLocalCandidateChanged",void 0),T(this,"onSelectedRemoteCandidateChanged",void 0),T(this,"videoIsReady",!1),T(this,"videoIsReady2",{}),T(this,"pc",void 0),T(this,"options",void 0),T(this,"intervalTimer",void 0),T(this,"stats",Si(xc)),T(this,"isFirstVideoReceived",{}),T(this,"isFirstVideoDecoded",{}),T(this,"isFirstAudioReceived",{}),T(this,"isFirstAudioDecoded",{}),T(this,"isFirstVideoDecodedTimeout",{}),T(this,"lossRateWindowStats",[]),this.pc=e$,this.options=t$,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new j(e$=>{e$({local:uv({},hr),remote:uv({},hr)})})}setVideoIsReady(e$){this.videoIsReady=e$}setVideoIsReady2(e$,t$){this.videoIsReady2[e$]=t$}getVideoIsReady(e$){return this.videoIsReady2[e$]||!1}setIsFirstAudioDecoded(e$){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e$){this.lossRateWindowStats.push(e$),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t$=this.lossRateWindowStats.length,r$=["videoSend","audioSend","videoRecv","audioRecv"],n$=0,i$=0,o$=0,s$=0;for(let a$ of r$)e$[a$].forEach((c$,u$)=>{if(!this.lossRateWindowStats[t$-1][a$][u$]||!this.lossRateWindowStats[0][a$][u$])return;let l$=this.lossRateWindowStats[t$-1][a$][u$].packets-this.lossRateWindowStats[0][a$][u$].packets,d$=this.lossRateWindowStats[t$-1][a$][u$].packetsLost-this.lossRateWindowStats[0][a$][u$].packetsLost;a$==="videoSend"||a$==="audioSend"?(n$+=l$,o$+=d$):(i$+=l$,s$+=d$),Number.isNaN(l$)||Number.isNaN(l$)?c$.packetLostRate=0:c$.packetLostRate=l$<=0||d$<=0?0:d$/(l$+d$)});e$.sendPacketLossRate=n$<=0||o$<=0?0:o$/(n$+o$),e$.recvPacketLossRate=i$<=0||s$<=0?0:s$/(i$+s$)}};function hv(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function dW(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?hv(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):hv(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var am=class extends Vc{constructor(){super(...arguments),T(this,"_stats",xc),T(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let e$=await this._getStats(),t$=this.statsResponsesToObjects(e$);this._stats=Si(xc);let r$=t$.filter(i$=>i$.type==="ssrc");this.processSSRCStats(r$);let n$=t$.find(i$=>i$.type==="VideoBwe");n$&&this.processBandwidthStats(n$),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e$){this._stats.bitrate={actualEncoded:Number(e$.googActualEncBitrate),targetEncoded:Number(e$.googTargetEncBitrate),retransmit:Number(e$.googRetransmitBitrate),transmit:Number(e$.googTransmitBitrate)},this._stats.sendBandwidth=Number(e$.googAvailableSendBandwidth)}processSSRCStats(e$){e$.forEach(t$=>{var r$;let n$=W(r$=t$.id).call(r$,"send");switch("".concat(t$.mediaType,"_").concat(n$?"send":"recv")){case"video_send":{let i$=Si(E0);i$.codec=t$.googCodecName,i$.adaptionChangeReason="none",t$.googCpuLimitedResolution&&(i$.adaptionChangeReason="cpu"),t$.googBandwidthLimitedResolution&&(i$.adaptionChangeReason="bandwidth"),i$.avgEncodeMs=Number(t$.googAvgEncodeMs),i$.inputFrame={width:Number(t$.googFrameWidthInput)||Number(t$.googFrameWidthSent),height:Number(t$.googFrameHeightInput)||Number(t$.googFrameHeightSent),frameRate:Number(t$.googFrameRateInput)},i$.sentFrame={width:Number(t$.googFrameWidthSent),height:Number(t$.googFrameHeightSent),frameRate:Number(t$.googFrameRateInput)},i$.firsCount=Number(t$.googFirReceived),i$.nacksCount=Number(t$.googNacksReceived),i$.plisCount=Number(t$.googPlisReceived),i$.frameCount=Number(t$.framesEncoded),i$.bytes=Number(t$.bytesSent),i$.packets=Number(t$.packetsSent),i$.packetsLost=Number(t$.packetsLost),i$.ssrc=Number(t$.ssrc),i$.rttMs=Number(t$.googRtt||0),this._stats.videoSend.push(i$),this._stats.rtt=i$.rttMs;break}case"video_recv":{let i$=Si(_0),o$=this.lastDecodeVideoReceiverStats.get(Number(t$.ssrc));if(i$.codec=t$.googCodecName,i$.targetDelayMs=Number(t$.googTargetDelayMs),i$.renderDelayMs=Number(t$.googRenderDelayMs),i$.currentDelayMs=Number(t$.googCurrentDelayMs),i$.minPlayoutDelayMs=Number(t$.googMinPlayoutDelayMs),i$.decodeMs=Number(t$.googDecodeMs),i$.maxDecodeMs=Number(t$.googMaxDecodeMs),i$.receivedFrame={width:Number(t$.googFrameWidthReceived),height:Number(t$.googFrameHeightReceived),frameRate:Number(t$.googFrameRateReceived)},i$.decodedFrame={width:Number(t$.googFrameWidthReceived),height:Number(t$.googFrameHeightReceived),frameRate:Number(t$.googFrameRateDecoded)},i$.decodeFrameRate=Number(t$.googFrameRateDecoded),i$.outputFrame={width:Number(t$.googFrameWidthReceived),height:Number(t$.googFrameHeightReceived),frameRate:Number(t$.googFrameRateOutput)},i$.jitterBufferMs=Number(t$.googJitterBufferMs),i$.firsCount=Number(t$.googFirsSent),i$.nacksCount=Number(t$.googNacksSent),i$.plisCount=Number(t$.googPlisSent),i$.framesDecodeCount=Number(t$.framesDecoded),i$.bytes=Number(t$.bytesReceived),i$.packets=Number(t$.packetsReceived),i$.packetsLost=Number(t$.packetsLost),i$.ssrc=Number(t$.ssrc),i$.packets>0&&!this.isFirstVideoReceived[i$.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i$.ssrc),this.isFirstVideoReceived[i$.ssrc]=!0),i$.framesDecodeCount>0&&!this.isFirstVideoDecoded[i$.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i$.ssrc,i$.decodedFrame.width,i$.decodedFrame.height),this.isFirstVideoDecoded[i$.ssrc]=!0),o$){let s$=o$.stats,a$=Date.now()-o$.lts;i$.framesDecodeFreezeTime=s$.framesDecodeFreezeTime,i$.framesDecodeInterval=s$.framesDecodeInterval,i$.framesDecodeCount>s$.framesDecodeCount&&this.isFirstVideoDecoded[i$.ssrc]?(o$.lts=Date.now(),i$.framesDecodeInterval=a$,i$.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t$.ssrc,10))?i$.framesDecodeFreezeTime+=i$.framesDecodeInterval:this.setVideoIsReady2(parseInt(t$.ssrc,10),!0))):i$.framesDecodeCount<o$.stats.framesDecodeCount&&(i$.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(i$.ssrc,{stats:dW({},i$),lts:Date.now()}),this._stats.videoRecv.push(i$);break}case"audio_recv":{let i$=Si(f0);i$.codec=t$.googCodecName,i$.outputLevel=Math.abs(Number(t$.audioOutputLevel))/32767,i$.decodingCNG=Number(t$.googDecodingCNG),i$.decodingCTN=Number(t$.googDecodingCTN),i$.decodingCTSG=Number(t$.googDecodingCTSG),i$.decodingNormal=Number(t$.googDecodingNormal),i$.decodingPLC=Number(t$.googDecodingPLC),i$.decodingPLCCNG=Number(t$.googDecodingPLCCNG),i$.expandRate=Number(t$.googExpandRate),i$.accelerateRate=Number(t$.googAccelerateRate),i$.preemptiveExpandRate=Number(t$.googPreemptiveExpandRate),i$.secondaryDecodedRate=Number(t$.googSecondaryDecodedRate),i$.speechExpandRate=Number(t$.googSpeechExpandRate),i$.preferredJitterBufferMs=Number(t$.googPreferredJitterBufferMs),i$.jitterBufferMs=Number(t$.googJitterBufferMs),i$.jitterMs=Number(t$.googJitterReceived),i$.bytes=Number(t$.bytesReceived),i$.packets=Number(t$.packetsReceived),i$.packetsLost=Number(t$.packetsLost),i$.ssrc=Number(t$.ssrc),i$.receivedFrames=Number(t$.googDecodingCTN)||Number(t$.packetsReceived),i$.droppedFrames=Number(t$.googDecodingPLC)+Number(t$.googDecodingPLCCNG)||Number(t$.packetsLost),i$.receivedFrames>0&&!this.isFirstAudioReceived[i$.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i$.ssrc),this.isFirstAudioReceived[i$.ssrc]=!0),i$.decodingNormal>0&&!this.isFirstAudioDecoded[i$.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i$.ssrc),this.isFirstAudioDecoded[i$.ssrc]=!0),this._stats.audioRecv.push(i$);break}case"audio_send":{let i$=Si(m0);i$.codec=t$.googCodecName,i$.inputLevel=Math.abs(Number(t$.audioInputLevel))/32767,i$.aecReturnLoss=Number(t$.googEchoCancellationReturnLoss||0),i$.aecReturnLossEnhancement=Number(t$.googEchoCancellationReturnLossEnhancement||0),i$.residualEchoLikelihood=Number(t$.googResidualEchoLikelihood||0),i$.residualEchoLikelihoodRecentMax=Number(t$.googResidualEchoLikelihoodRecentMax||0),i$.bytes=Number(t$.bytesSent),i$.packets=Number(t$.packetsSent),i$.packetsLost=Number(t$.packetsLost),i$.ssrc=Number(t$.ssrc),i$.rttMs=Number(t$.googRtt||0),this._stats.rtt=i$.rttMs,this._stats.audioSend.push(i$);break}}})}_getStats(){return new j((e$,t$)=>{this.pc.getStats(e$,t$)})}statsResponsesToObjects(e$){let t$=[];return e$.result().forEach(r$=>{let n$={id:r$.id,timestamp:r$.timestamp.valueOf().toString(),type:r$.type};r$.names().forEach(i$=>{n$[i$]=r$.stat(i$)}),t$.push(n$)}),t$}};function pv(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function Ao(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?pv(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):pv(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var hu=class extends Vc{constructor(){super(...arguments),T(this,"_stats",xc),T(this,"report",void 0),T(this,"lastDecodeVideoReceiverStats",new Map),T(this,"lastVideoFramesRecv",new Map),T(this,"lastVideoFramesSent",new Map),T(this,"lastVideoFramesDecode",new Map),T(this,"lastVideoFramesOutput",new Map),T(this,"lastVideoJBDelay",new Map),T(this,"lastAudioJBDelay",new Map),T(this,"mediaBytesSent",new Map),T(this,"mediaBytesRetransmit",new Map),T(this,"mediaBytesTargetEncode",new Map),T(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Si(xc),this.report.forEach(e$=>{switch(e$.type){case kn.OUTBOUND:case kn.INBOUND:{let t$=e$.mediaType||e$.kind,r$=!t$&&"frameWidth"in e$,n$=!t$&&!("frameWidth"in e$);e$.type===kn.OUTBOUND?t$==="audio"||n$?this.processAudioOutboundStats(e$):(t$==="video"||r$)&&this.processVideoOutboundStats(e$):e$.type===kn.INBOUND&&(t$==="audio"||n$?this.processAudioInboundStats(e$):(t$==="video"||r$)&&this.processVideoInboundStats(e$));break}case kn.TRANSPORT:{let t$=this.report.get(e$.selectedCandidatePairId);t$&&this.processCandidatePairStats(t$);break}case kn.CANDIDATE_PAIR:e$.selected&&this.processCandidatePairStats(e$)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let e$=await this.pc.getStats(),t$={local:Ao({},hr),remote:Ao({},hr)};return e$.forEach(r$=>{let n$;if(r$.type===kn.TRANSPORT&&(n$=e$.get(r$.selectedCandidatePairId)),r$.type===kn.CANDIDATE_PAIR&&r$.selected&&(n$=r$),n$){let i$=(o$,s$)=>{o$.type=s$.type,o$.id=s$.id,s$.address&&(o$.address=s$.address),s$.candidateType&&(o$.candidateType=s$.candidateType),s$.port&&(o$.port=s$.port),s$.priority&&(o$.priority=s$.priority),s$.protocol&&(o$.protocol=s$.protocol),s$.relayProtocol&&(o$.relayProtocol=s$.relayProtocol)};if(n$.localCandidateId){let o$=e$.get(n$.localCandidateId);o$&&i$(t$.local,o$)}if(n$.remoteCandidateId){let o$=e$.get(n$.remoteCandidateId);o$&&i$(t$.remote,o$)}}}),t$}processCandidatePairStats(e$){if(this._stats.sendBandwidth=e$.availableOutgoingBitrate||0,e$.currentRoundTripTime&&(this._stats.rtt=1e3*e$.currentRoundTripTime),this._stats.videoSend.forEach(t$=>{e$.currentRoundTripTime&&(t$.rttMs=1e3*e$.currentRoundTripTime)}),this._stats.audioSend.forEach(t$=>{e$.currentRoundTripTime&&(t$.rttMs=1e3*e$.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e$.id,e$.localCandidateId){let t$=this.report.get(e$.localCandidateId);t$&&this.processCandidateStats(t$)}if(e$.remoteCandidateId){let t$=this.report.get(e$.remoteCandidateId);t$&&this.processCandidateStats(t$)}}processCandidateStats(e$){let t$;e$.type===kn.LOCAL_CANDIDATE&&(t$=this._stats.selectedCandidatePair.localCandidate),e$.type===kn.REMOTE_CANDIDATE&&(t$=this._stats.selectedCandidatePair.remoteCandidate),t$&&(t$.type=e$.type,t$.id=e$.id,e$.address&&(t$.address=e$.address),e$.candidateType&&(t$.candidateType=e$.candidateType),e$.port&&(t$.port=e$.port),e$.priority&&(t$.priority=e$.priority),e$.protocol&&(t$.protocol=e$.protocol),e$.relayProtocol&&(t$.relayProtocol=e$.relayProtocol),e$.type===kn.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t$.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Ao({},t$),Ao({},this.stats.selectedCandidatePair.localCandidate)),e$.type===kn.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t$.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Ao({},t$),Ao({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e$){let t$=this._stats.audioRecv.find(r$=>r$.ssrc===e$.ssrc);t$||(t$=Si(f0),this._stats.audioRecv.push(t$)),t$.ssrc=e$.ssrc,t$.packets=e$.packetsReceived,t$.packetsLost=e$.packetsLost,t$.packetsDiscarded=e$.packetsDiscarded,t$.bytes=e$.bytesReceived,t$.jitterMs=1e3*e$.jitter,this.processAudioTrackReceiverStats(e$,e$.trackId,t$),e$.codecId&&(t$.codec=this.getCodecFromCodecStats(e$.codecId)),t$.receivedFrames||(t$.receivedFrames=e$.packetsReceived),t$.droppedFrames||(t$.droppedFrames=e$.packetsLost),t$.receivedFrames>0&&!this.isFirstAudioReceived[t$.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t$.ssrc),this.isFirstAudioReceived[t$.ssrc]=!0),t$.outputLevel&&t$.outputLevel>0&&!this.isFirstAudioDecoded[t$.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t$.ssrc),this.isFirstAudioDecoded[t$.ssrc]=!0),typeof e$.concealedSamples=="number"&&(t$.concealedSamples=e$.concealedSamples)}processVideoInboundStats(e$){let t$=this._stats.videoRecv.find(s$=>s$.ssrc===e$.ssrc);t$||(t$=Si(_0),this._stats.videoRecv.push(t$)),t$.ssrc=e$.ssrc,t$.packets=e$.packetsReceived,t$.packetsLost=e$.packetsLost,t$.bytes=e$.bytesReceived,t$.firsCount=e$.firCount,t$.nacksCount=e$.nackCount,t$.plisCount=e$.pliCount,t$.framesDecodeCount=e$.framesDecoded,t$.framesDroppedCount=e$.framesDropped,t$.totalInterFrameDelay=e$.totalInterFrameDelay,t$.totalSquaredInterFrameDelay=e$.totalSquaredInterFrameDelay,t$.totalFreezesDuration=e$.totalFreezesDuration;let r$=this.lastDecodeVideoReceiverStats.get(t$.ssrc),n$=this.lastVideoFramesDecode.get(t$.ssrc),i$=this.lastVideoFramesOutput.get(t$.ssrc),o$=Date.now();if(t$.framesDecodeCount>0&&!this.isFirstVideoDecoded[t$.ssrc]){let s$=t$.decodedFrame?t$.decodedFrame.width:0,a$=t$.decodedFrame?t$.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t$.ssrc,s$,a$),this.isFirstVideoDecoded[t$.ssrc]=!0}if(r$){let s$=r$.stats,a$=o$-r$.lts;t$.framesDecodeFreezeTime=s$.framesDecodeFreezeTime,t$.framesDecodeInterval=s$.framesDecodeInterval,!this.isFirstVideoDecoded[t$.ssrc]&&a$>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t$.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t$.ssrc),this.isFirstVideoDecodedTimeout[t$.ssrc]=!0),t$.framesDecodeCount>s$.framesDecodeCount&&this.isFirstVideoDecoded[t$.ssrc]?(r$.lts=Date.now(),t$.framesDecodeInterval=a$,t$.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e$.ssrc))?t$.framesDecodeFreezeTime+=t$.framesDecodeInterval:this.setVideoIsReady2(parseInt(e$.ssrc,10),!0))):t$.framesDecodeCount<s$.framesDecodeCount&&(t$.framesDecodeInterval=0),e$.framesDecoded&&e$.qpSum&&(r$.stats.framesDecodeCount>e$.framesDecoded?t$.qpSumPerFrame=e$.qpSum/e$.framesDecoded:t$.qpSumPerFrame=(e$.qpSum-r$.qpSum)/(e$.framesDecoded-r$.stats.framesDecodeCount))}n$&&o$-n$.lts>=800?(t$.decodeFrameRate=Math.round((t$.framesDecodeCount-n$.count)/((o$-n$.lts)/1e3)),this.lastVideoFramesDecode.set(t$.ssrc,{count:t$.framesDecodeCount,lts:o$,rate:t$.decodeFrameRate})):n$?t$.decodeFrameRate=n$.rate:this.lastVideoFramesDecode.set(t$.ssrc,{count:t$.framesDecodeCount,lts:o$,rate:0}),t$.framesDroppedCount&&e$.framesReceived&&(i$&&o$-i$.lts>=800?(t$.outputFrameRate=Math.round((e$.framesReceived-t$.framesDroppedCount-i$.count)/((o$-i$.lts)/1e3)),this.lastVideoFramesOutput.set(t$.ssrc,{count:e$.framesReceived-t$.framesDroppedCount,lts:o$,rate:Math.max(t$.outputFrameRate,0)})):i$?t$.outputFrameRate=i$.rate:this.lastVideoFramesOutput.set(t$.ssrc,{count:e$.framesReceived-t$.framesDroppedCount,lts:o$,rate:0})),e$.totalDecodeTime&&(t$.decodeMs=1e3*e$.totalDecodeTime),this.processVideoTrackReceiverStats(e$,e$.trackId,t$),e$.codecId&&(t$.codec=this.getCodecFromCodecStats(e$.codecId)),e$.framerateMean&&(t$.framesRateFirefox=e$.framerateMean),t$.packets>0&&!this.isFirstVideoReceived[t$.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t$.ssrc),this.isFirstVideoReceived[t$.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t$.ssrc,{stats:Ao({},t$),lts:r$?r$.lts:Date.now(),qpSum:e$.qpSum})}processVideoOutboundStats(e$){let t$=this._stats.videoSend.find(n$=>n$.ssrc===e$.ssrc);t$||(t$=Si(E0),this._stats.videoSend.push(t$));let r$=this.mediaBytesSent.get(e$.ssrc);if(r$)r$.add(e$.bytesSent);else{let n$=new cc(10);n$.add(e$.bytesSent),this.mediaBytesSent.set(e$.ssrc,n$)}if(e$.retransmittedBytesSent!==void 0){let n$=this.mediaBytesRetransmit.get(e$.ssrc);if(n$)n$.add(e$.retransmittedBytesSent);else{let i$=new cc(10);i$.add(e$.retransmittedBytesSent),this.mediaBytesRetransmit.set(e$.ssrc,i$)}}if(e$.totalEncodedBytesTarget){let n$=this.mediaBytesTargetEncode.get(e$.ssrc);if(n$)n$.add(e$.totalEncodedBytesTarget);else{let i$=new cc(10);i$.add(e$.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e$.ssrc,i$)}}if(t$.ssrc=e$.ssrc,t$.bytes=e$.bytesSent,t$.packets=e$.packetsSent,t$.firsCount=e$.firCount,t$.nacksCount=e$.nackCount,t$.plisCount=e$.pliCount,t$.frameCount=e$.framesEncoded,t$.adaptionChangeReason=e$.qualityLimitationReason,t$.scalabilityMode=e$.scalabilityMode,e$.totalEncodeTime&&e$.framesEncoded){let n$=this.lastEncoderMs.get(e$.ssrc);if(!n$||n$.lastFrameCount>e$.framesEncoded)t$.avgEncodeMs=1e3*e$.totalEncodeTime/e$.framesEncoded;else{let i$=e$.framesEncoded-n$.lastFrameCount,o$=e$.totalEncodeTime-n$.lastEncoderTime;t$.avgEncodeMs=1e3*o$/i$}}if(e$.framesEncoded&&e$.qpSum){let n$=this.lastEncoderMs.get(e$.ssrc);!n$||n$.lastFrameCount>e$.framesEncoded?t$.qpSumPerFrame=e$.qpSum/e$.framesEncoded:t$.qpSumPerFrame=(e$.qpSum-n$.lastQpSum)/(e$.framesEncoded-n$.lastFrameCount)}if(this.lastEncoderMs.set(e$.ssrc,{lastFrameCount:e$.framesEncoded,lastEncoderTime:e$.totalEncodeTime,lastQpSum:e$.qpSum,lts:Date.now()}),e$.codecId&&(t$.codec=this.getCodecFromCodecStats(e$.codecId)),e$.mediaSourceId&&this.processVideoMediaSource(e$.mediaSourceId,t$),this.processVideoTrackSenderStats(e$,e$.trackId,t$),e$.remoteId)this.processRemoteInboundStats(e$.remoteId,t$);else{let n$=this.findRemoteStatsId(e$.ssrc,kn.REMOTE_INBOUND);n$&&this.processRemoteInboundStats(n$,t$)}}processAudioOutboundStats(e$){let t$=this._stats.audioSend.find(r$=>r$.ssrc===e$.ssrc);if(t$||(t$=Si(m0),this._stats.audioSend.push(t$)),t$.ssrc=e$.ssrc,t$.packets=e$.packetsSent,t$.bytes=e$.bytesSent,e$.mediaSourceId&&this.processAudioMediaSource(e$.mediaSourceId,t$),e$.codecId&&(t$.codec=this.getCodecFromCodecStats(e$.codecId)),this.processAudioTrackSenderStats(e$,e$.trackId,t$),e$.remoteId)this.processRemoteInboundStats(e$.remoteId,t$);else{let r$=this.findRemoteStatsId(e$.ssrc,kn.REMOTE_INBOUND);r$&&this.processRemoteInboundStats(r$,t$)}}findRemoteStatsId(e$,t$){var r$;let n$=Array.from(Pr(r$=this.report).call(r$)).find(i$=>i$.type===t$&&i$.ssrc===e$);return n$?n$.id:null}processVideoMediaSource(e$,t$){let r$=this.report.get(e$);r$&&r$.width&&r$.height&&r$.framesPerSecond&&(t$.inputFrame={width:r$.width,height:r$.height,frameRate:r$.framesPerSecond})}processAudioMediaSource(e$,t$){let r$=this.report.get(e$);r$&&(t$.inputLevel=r$.audioLevel)}processVideoTrackSenderStats(e$,t$,r$){var n$,i$,o$,s$;let a$=t$?this.report.get(t$):void 0,c$=(n$=a$==null?void 0:a$.framesSent)!==null&&n$!==void 0?n$:e$.framesSent;if(typeof c$!="number")return;let u$=(i$=a$==null?void 0:a$.frameWidth)!==null&&i$!==void 0?i$:e$.frameWidth,l$=(o$=a$==null?void 0:a$.frameHeight)!==null&&o$!==void 0?o$:e$.frameHeight,d$=(s$=a$==null?void 0:a$.framesPerSecond)!==null&&s$!==void 0?s$:e$.framesPerSecond;if(typeof u$=="number"&&typeof l$=="number"||(u$=0,l$=0),d$==null){let h$=Date.now(),p$=this.lastVideoFramesSent.get(r$.ssrc);p$&&h$-p$.lts>=800?(d$=Math.round((c$-p$.count)/((h$-p$.lts)/1e3)),this.lastVideoFramesSent.set(r$.ssrc,{count:c$,lts:h$,rate:d$})):p$?d$=p$.rate:this.lastVideoFramesSent.set(r$.ssrc,{count:c$,lts:h$,rate:0})}r$.sentFrame={width:u$,height:l$,frameRate:Math.max(0,d$)}}processVideoTrackReceiverStats(e$,t$,r$){var n$,i$,o$,s$,a$;let c$=t$?this.report.get(t$):void 0,u$=(n$=c$==null?void 0:c$.framesReceived)!==null&&n$!==void 0?n$:e$.framesReceived,l$=(i$=c$==null?void 0:c$.frameWidth)!==null&&i$!==void 0?i$:e$.frameWidth,d$=(o$=c$==null?void 0:c$.frameHeight)!==null&&o$!==void 0?o$:e$.frameHeight,h$=(s$=c$==null?void 0:c$.jitterBufferDelay)!==null&&s$!==void 0?s$:e$.jitterBufferDelay,p$=(a$=c$==null?void 0:c$.jitterBufferEmittedCount)!==null&&a$!==void 0?a$:e$.jitterBufferEmittedCount;if(typeof u$=="number"){let _$=this.lastVideoFramesRecv.get(r$.ssrc),f$=Date.now();r$.framesReceivedCount=u$;let m$=0;_$&&f$-_$.lts>=800?(m$=Math.round((u$-_$.count)/((f$-_$.lts)/1e3)),this.lastVideoFramesRecv.set(r$.ssrc,{count:u$,lts:f$,rate:m$})):_$?m$=_$.rate:this.lastVideoFramesRecv.set(r$.ssrc,{count:u$,lts:f$,rate:0}),r$.receivedFrame={width:l$||0,height:d$||0,frameRate:m$||0},r$.decodedFrame={width:l$||0,height:d$||0,frameRate:r$.decodeFrameRate||0},r$.outputFrame={width:l$||0,height:d$||0,frameRate:r$.outputFrameRate||r$.decodeFrameRate||0}}if(h$&&p$){let _$=this.lastVideoJBDelay.get(r$.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},f$=_$.jitterBufferMs,m$=p$-_$.jitterBufferEmittedCount;m$>0&&(f$=1e3*(h$-_$.jitterBufferDelay)/m$),r$.jitterBufferMs=f$,r$.currentDelayMs=Math.round(f$),this.lastVideoJBDelay.set(r$.ssrc,{jitterBufferDelay:h$,jitterBufferEmittedCount:p$,jitterBufferMs:r$.currentDelayMs})}}processAudioTrackSenderStats(e$,t$,r$){var n$,i$,o$,s$;let a$=t$?this.report.get(t$):void 0,c$=(n$=(i$=a$==null?void 0:a$.echoReturnLoss)!==null&&i$!==void 0?i$:e$.echoReturnLoss)!==null&&n$!==void 0?n$:0,u$=(o$=(s$=a$==null?void 0:a$.echoReturnLossEnhancement)!==null&&s$!==void 0?s$:e$.echoReturnLossEnhancement)!==null&&o$!==void 0?o$:0;r$.aecReturnLoss=c$,r$.aecReturnLossEnhancement=u$}processAudioTrackReceiverStats(e$,t$,r$){var n$,i$,o$,s$,a$,c$,u$;let l$=t$?this.report.get(t$):void 0,d$=(n$=l$==null?void 0:l$.removedSamplesForAcceleration)!==null&&n$!==void 0?n$:e$.removedSamplesForAcceleration,h$=(i$=l$==null?void 0:l$.totalSamplesReceived)!==null&&i$!==void 0?i$:e$.totalSamplesReceived,p$=(o$=l$==null?void 0:l$.jitterBufferDelay)!==null&&o$!==void 0?o$:e$.jitterBufferDelay,_$=(s$=l$==null?void 0:l$.jitterBufferEmittedCount)!==null&&s$!==void 0?s$:e$.jitterBufferEmittedCount,f$=(a$=l$==null?void 0:l$.audioLevel)!==null&&a$!==void 0?a$:e$==null?void 0:e$.audioLevel,m$=(c$=l$==null?void 0:l$.totalSamplesDuration)!==null&&c$!==void 0?c$:e$==null?void 0:e$.totalSamplesDuration,g$=(u$=l$==null?void 0:l$.concealedSamples)!==null&&u$!==void 0?u$:e$.concealedSamples;if(d$&&h$&&(r$.accelerateRate=d$/h$),p$&&_$){let y$=this.lastAudioJBDelay.get(r$.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},S$=y$.jitterBufferMs,b$=_$-y$.jitterBufferEmittedCount;b$>0&&(S$=1e3*(p$-y$.jitterBufferDelay)/b$),r$.jitterBufferMs=Math.round(S$),this.lastAudioJBDelay.set(r$.ssrc,{jitterBufferDelay:p$,jitterBufferEmittedCount:_$,jitterBufferMs:r$.jitterBufferMs})}r$.outputLevel=f$;let v$=1920;m$&&h$&&(v$=h$/m$/50,r$.receivedFrames=Math.round(h$/v$)),g$&&(r$.droppedFrames=Math.round(g$/v$))}processRemoteInboundStats(e$,t$){let r$=this.report.get(e$);r$&&(t$.packetsLost=r$.packetsLost,r$.roundTripTime&&(t$.rttMs=1e3*r$.roundTripTime),r$.jitter&&(t$.jitterMs=1e3*r$.jitter),r$.timestamp&&(t$.timestamp=r$.timestamp))}getCodecFromCodecStats(e$){let t$=this.report.get(e$);if(!t$)return"";let r$=t$.mimeType.match(/\/(.*)$/);return r$&&r$[1]?r$[1]:""}updateSendBitrate(){let e$=0,t$=null,r$=null;this.mediaBytesSent.forEach(i$=>{e$+=i$.diffMean()}),this.mediaBytesRetransmit.forEach(i$=>{t$=t$===null?i$.diffMean():t$+i$.diffMean()}),this.mediaBytesTargetEncode.forEach(i$=>{r$=r$===null?i$.diffMean():r$+i$.diffMean()});let n$=t$!==null?e$-t$:e$;this._stats.bitrate={actualEncoded:8*n$/(this.options.updateInterval/1e3),transmit:8*e$/(this.options.updateInterval/1e3)},t$!==null&&(this._stats.bitrate.retransmit=8*t$/(this.options.updateInterval/1e3)),r$!==null&&(this._stats.bitrate.targetEncoded=8*r$/(this.options.updateInterval/1e3))}},cm=class extends Vc{updateStats(){return j.resolve()}};function Nf(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,r$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,n$=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i$=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,o$=function(){let s$=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return s$&&s$[0]?Number(s$[0].split("/")[1]):null}();return o$?o$<76?new am(e$,{updateInterval:t$,lossRateInterval:r$,freezeRateLimit:n$,firstVideoDecodedTimeout:i$}):new hu(e$,{updateInterval:t$,lossRateInterval:r$,freezeRateLimit:n$,firstVideoDecodedTimeout:i$}):function(s$){if(!window.RTCStatsReport)return!1;let a$=s$.getStats();return!!(a$ instanceof j||function(c$){return!!c$&&(typeof c$=="object"||typeof c$=="function")&&typeof c$.then=="function"}(a$))}(e$)?new hu(e$,{updateInterval:t$,lossRateInterval:r$,freezeRateLimit:n$,firstVideoDecodedTimeout:i$}):new cm(e$,{updateInterval:t$,lossRateInterval:r$,freezeRateLimit:n$,firstVideoDecodedTimeout:i$})}var _v=class{get localCapabilities(){return le(this._localCapabilities)}get rtpCapabilities(){return le(this._rtpCapabilities)}get candidates(){return le(this._candidates)}get iceParameters(){return le(this._iceParameters)}get dtlsParameters(){return le(this._dtlsParameters)}constructor(e$){T(this,"sessionDesc",void 0),T(this,"_localCapabilities",void 0),T(this,"_rtpCapabilities",void 0),T(this,"_candidates",void 0),T(this,"_iceParameters",void 0),T(this,"_dtlsParameters",void 0),T(this,"setup",void 0),T(this,"currentMidIndex",void 0),T(this,"cname","o/i14u9pJrxRKAsu"),T(this,"firefoxSsrcMidMap",new Map),e$=le(e$);let{remoteIceParameters:t$,remoteDtlsParameters:r$,candidates:n$,remoteRTPCapabilities:i$,localCapabilities:o$,direction:s$,setup:a$,videoCodec:c$,audioCodec:u$}=e$,l$;this.setup=a$,l$=s$===cn.RECEIVE_ONLY?Le.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Le.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i$,this._candidates=n$,this._iceParameters=t$,this._dtlsParameters=r$,this._localCapabilities=o$;let d$=s$===cn.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,h$=s$===cn.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,p$=s$===cn.RECEIVE_ONLY?i$.send.videoCodecs:ac(Q.VIDEO,d$,h$,c$),_$=s$===cn.RECEIVE_ONLY?i$.send.audioCodecs:ac(Q.AUDIO,d$,h$,u$);for(let f$ of l$.mediaDescriptions)f$.attributes.iceUfrag=t$.iceUfrag,f$.attributes.icePwd=t$.icePwd,f$.attributes.fingerprints=r$.fingerprints,f$.attributes.candidates=n$,f$.attributes.setup=this.setup,f$.media.mediaType==="application"&&(f$.attributes.sctpPort="5000"),f$.media.mediaType==="video"&&(f$.media.fmts=p$.map(m$=>m$.payloadType.toString(10)),f$.attributes.payloads=p$,f$.attributes.extmaps=d$.videoExtensions),f$.media.mediaType==="audio"&&(f$.media.fmts=_$.map(m$=>m$.payloadType.toString(10)),f$.attributes.payloads=_$,f$.attributes.extmaps=d$.audioExtensions,oa(f$));this.sessionDesc=l$,this.currentMidIndex=l$.mediaDescriptions.length-1}toString(){return Le.print(this.sessionDesc)}hasMid(e$){return Array.isArray(e$)?e$.every(t$=>this.hasMid(t$)):this.sessionDesc.mediaDescriptions.some(t$=>t$.attributes.mid===e$)}send(e$,t$,r$,n$,i$){r$=r$.replace(/ /g,"-");let{ssrcs:o$,ssrcGroups:s$}=Lo(t$,this.cname,v("SYNC_GROUP")?r$:void 0),a$=this.findPreloadMediaDesc(o$);if(a$){if($t()&&this.firefoxSsrcMidMap.set(o$[0].ssrcId,a$.attributes.mid),i$&&(i$.twcc||i$.remb)){let c$=this.sessionDesc.mediaDescriptions.indexOf(a$);return this.sessionDesc.mediaDescriptions[c$]=this.mungSendMediaDesc(a$,i$),{mid:a$.attributes.mid,needExchangeSDP:!0}}return{mid:a$.attributes.mid,needExchangeSDP:!1}}{let c$=this.findAvailableMediaIndex(e$,o$,n$),u$;return c$===-1?(u$=this.createOrRecycleSendMedia(e$,o$,s$,"sendonly",n$,i$),this.updateBundleMids()):(u$=le(this.sessionDesc.mediaDescriptions[c$]),u$.attributes.direction="sendonly",u$.attributes.ssrcs=o$,u$.attributes.ssrcGroups=s$,this.sessionDesc.mediaDescriptions[c$]=this.mungSendMediaDesc(u$,i$)),$t()&&this.firefoxSsrcMidMap.set(o$[0].ssrcId,u$.attributes.mid),{needExchangeSDP:!0,mid:u$.attributes.mid}}}stopSending(e$){let t$=this.sessionDesc.mediaDescriptions.filter(r$=>r$.attributes.mid&&e$.indexOf(r$.attributes.mid)!==-1);if(t$.length!==e$.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t$.forEach(r$=>{r$.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e$,t$,r$){let n$=[];return e$.forEach(i$=>{let o$=i$._mediaStreamTrack.kind,s$=this.findAvailableRecvMediaIndex(o$),a$,c$=!1;s$===-1?(c$=!0,a$=this.createOrRecycleRecvMedia(i$,[],"recvonly",t$,r$),this.updateBundleMids()):(a$=le(this.sessionDesc.mediaDescriptions[s$]),a$.attributes.direction="recvonly"),n$.push({mid:a$.attributes.mid,needCreateTransceiver:c$})}),n$}stopReceiving(e$){let t$=this.sessionDesc.mediaDescriptions.filter(r$=>e$.indexOf(r$.attributes.mid)!==-1);if(t$.length!==e$.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t$.forEach(r$=>{r$.media.port="0",r$.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e$){let{foundation:t$,protocol:r$,address:n$,port:i$,type:o$,relatedAddress:s$,relatedPort:a$,priority:c$}=new RTCIceCandidate(e$),u$={foundation:t$??"",componentId:"1",transport:r$??"",priority:c$?c$+"":"",connectionAddress:n$??"",port:i$?i$+"":"",type:o$?o$+"":"",relAddr:s$??"",relPort:a$?a$+"":"",extension:{}};this.candidates.some(l$=>l$.priority===u$.priority&&l$.connectionAddress===u$.connectionAddress&&l$.port===u$.port)||(this._candidates.push(u$),this.sessionDesc.mediaDescriptions.forEach(l$=>{l$.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e$,t$,r$,n$,i$){let o$=e$._mediaStreamTrack.kind,s$=this.rtpCapabilities.recv,a$=ac(o$,s$,this.localCapabilities.send,o$===Q.AUDIO?i$:n$),c$=o$===Q.VIDEO?s$.videoExtensions:s$.audioExtensions,u$="".concat(++this.currentMidIndex),l$={media:{mediaType:o$,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a$.map(h$=>h$.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c$,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t$,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:a$,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r$,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u$)}};l$=this.mungRecvMediaDsec(l$,e$);let d$=this.findFirstClosedMedia(o$);if(d$){let h$=this.sessionDesc.mediaDescriptions.indexOf(d$);this.sessionDesc.mediaDescriptions[h$]=l$}else this.sessionDesc.mediaDescriptions.push(l$);return l$}muteRemote(e$){let t$=this.sessionDesc.mediaDescriptions.filter(r$=>W(e$).call(e$,r$.attributes.mid||""));if(t$.length!==e$.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t$.forEach(r$=>{r$.attributes.direction="inactive"})}unmuteRemote(e$){let t$=this.sessionDesc.mediaDescriptions.filter(r$=>W(e$).call(e$,r$.attributes.mid||""));if(t$.length!==e$.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t$.forEach(r$=>{r$.attributes.direction="recvonly"})}findAvailableMediaIndex(e$,t$,r$){return this.sessionDesc.mediaDescriptions.findIndex(n$=>{let i$=n$.media.mediaType===e$&&n$.media.port!=="0"&&(n$.attributes.direction==="sendonly"||n$.attributes.direction==="sendrecv")&&n$.attributes.ssrcs.length===0;if($t()){if(i$){let o$=this.firefoxSsrcMidMap.get(t$[0].ssrcId);return!(o$||n$.attributes.mid!=="0"&&n$.attributes.mid!=="1")||!(!o$||o$!==n$.attributes.mid)}return!1}return i$&&n$.attributes.mid===r$})}findAvailableRecvMediaIndex(e$){return this.sessionDesc.mediaDescriptions.findIndex(t$=>{let r$=t$.media.mediaType===e$&&t$.media.port!=="0"&&(t$.attributes.direction==="recvonly"||t$.attributes.direction==="sendrecv");return t$.attributes.mid!=="0"&&t$.attributes.mid!=="1"&&r$})}predictReceivingMids(e$){let t$=[];for(let r$=0;r$<e$;r$++)t$.push((this.currentMidIndex+r$+1).toString(10));return t$}restartICE(e$){e$=le(e$),this._iceParameters=e$,this.sessionDesc.mediaDescriptions.forEach(t$=>{t$.attributes.iceUfrag=e$.iceUfrag,t$.attributes.icePwd=e$.icePwd})}createOrRecycleSendMedia(e$,t$,r$,n$,i$,o$){let s$=this.rtpCapabilities.send,a$=e$===Q.VIDEO?s$.videoCodecs:s$.audioCodecs,c$=e$===Q.VIDEO?s$.videoExtensions:s$.audioExtensions;$t()&&(i$="".concat(++this.currentMidIndex));let u$={media:{mediaType:e$,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a$.map(d$=>d$.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c$,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t$,ssrcGroups:r$,rtcpFeedbackWildcards:[],payloads:a$,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n$,rtcpMux:!0,rtcpRsize:!0,mid:i$}};u$=this.mungSendMediaDesc(u$,o$);let l$=this.findFirstClosedMedia(e$);if(l$){let d$=this.sessionDesc.mediaDescriptions.indexOf(l$);this.sessionDesc.mediaDescriptions[d$]=u$}else this.sessionDesc.mediaDescriptions.push(u$);return u$}mungRecvMediaDsec(e$,t$,r$){let n$=le(e$);return If(n$),ra(n$,t$),vf(n$,t$),r0(n$),lu(n$,r$,this.localCapabilities.send),n$}mungSendMediaDesc(e$,t$){let r$=le(e$);return lu(r$,t$,this.localCapabilities.recv),oa(r$),r$}updateRecvMedia(e$,t$){let r$=this.sessionDesc.mediaDescriptions.findIndex(n$=>n$.attributes.mid===e$);if(r$!==-1){let n$=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r$],t$);this.sessionDesc.mediaDescriptions[r$]=n$}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e$=>e$.media.port!=="0").map(e$=>e$.attributes.mid)}findPreloadMediaDesc(e$){return this.sessionDesc.mediaDescriptions.find(t$=>{var r$;return((r$=t$.attributes)===null||r$===void 0||(r$=r$.ssrcs[0])===null||r$===void 0?void 0:r$.ssrcId)===e$[0].ssrcId})}findFirstClosedMedia(e$){return this.sessionDesc.mediaDescriptions.find(t$=>$t()?t$.media.port==="0"&&t$.media.mediaType===e$:t$.media.port==="0")}},lW=["sdp"],Vt;function Ev(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function Gr(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?Ev(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):Ev(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var mv=(Vt=class u5 extends Kl{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t$,r$;return(t$=(r$=this.peerConnection.getReceivers()[0])===null||r$===void 0||(r$=r$.transport)===null||r$===void 0?void 0:r$.state)!==null&&t$!==void 0?t$:null}get localCodecs(){return[]}set isInRestartIce(t$){this._isInRestartIce=t$}get isInRestartIce(){return this._isInRestartIce}constructor(t$,r$,n$){super(t$,r$),T(this,"direction",void 0),T(this,"name",void 0),T(this,"store",void 0),T(this,"spec",void 0),T(this,"peerConnection",void 0),T(this,"initialOffer",void 0),T(this,"transport",void 0),T(this,"statsFilter",void 0),T(this,"localCandidateCount",0),T(this,"_isInRestartIce",!1),T(this,"mutex",new ze("P2PConnection-mutex")),T(this,"onLocalCandidate",void 0),T(this,"remoteSDP",void 0),T(this,"pendingCandidates",[]),T(this,"localCapabilities",void 0),T(this,"isReady",!1),T(this,"restartCnt",0),T(this,"curTurnServerIndex",0),this.store=r$,this.spec=t$,this.peerConnection=new RTCPeerConnection(u5.resolvePCConfiguration(t$,r$.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=n$??cn.SEND_ONLY,this.name=this.direction===cn.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Nf(this.peerConnection,v("STATS_UPDATE_INTERVAL"),void 0,$t()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t$){try{let r$=await s0();if(this.localCapabilities=uu(r$),t$){let{sdp:n$}=t$,i$=cW(t$,lW),o$=function(){let l$={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},d$=Lc(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),h$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ii(d$,l$,"videoExtensions",h$,p$,_$),Ii(d$,l$,"videoCodecs",h$,p$,_$),Ii(d$,l$,"audioExtensions",h$,p$,_$),Ii(d$,l$,"audioCodecs",h$,p$,_$),v("RAISE_H264_BASELINE_PRIORITY")){let f$=_$.videoCodecs.findIndex(m$=>m$.rtpMap&&m$.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m$.fmtp&&m$.fmtp.parameters["profile-level-id"]==="42001f");if(f$!==-1){let m$=_$.videoCodecs.findIndex(g$=>g$.rtpMap&&g$.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(m$<f$){_.debug("raising H264 baseline profile priority");let g$=_$.videoCodecs[f$];_$.videoCodecs.splice(f$,1),_$.videoCodecs.splice(m$,0,g$)}m$!==-1&&v("FILTER_SEND_H264_BASELINE")&&(h$.videoCodecs=h$.videoCodecs.filter(g$=>!(g$.rtpMap&&g$.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&g$.fmtp&&g$.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:h$,recv:p$,sendrecv:_$}}({},{},n$);this.remoteSDP=new _v({remoteIceParameters:i$.iceParameters,remoteDtlsParameters:i$.dtlsParameters,candidates:[],remoteRTPCapabilities:o$,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let s$=await this.peerConnection.createAnswer();if(!s$.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let a$=io(s$.sdp);await this.peerConnection.setLocalDescription(s$);let c$=await zI({},{},s$.sdp);this.localCapabilities=uu(c$);let u$=this.peerConnection.getTransceivers()[0];return u$!=null&&u$.receiver&&u$.receiver.transport&&this.tryBindTransportEvents(u$.receiver.transport),Gr(Gr({},a$),{},{sdp:s$.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let n$=await this.peerConnection.createOffer();if(!n$.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i$=io(n$.sdp);return this.initialOffer=n$,Gr(Gr({},i$),{},{sdp:n$.sdp})}}catch(r$){throw new N(R.GET_LOCAL_CONNECTION_PARAMS_FAILED,r$.toString())}}async connect(t$){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:r$,iceParameters:n$,dtlsParameters:i$}=t$,o$=await zI({},{},r$);this.remoteSDP=new _v({remoteIceParameters:n$,remoteDtlsParameters:i$,candidates:[],remoteRTPCapabilities:o$,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let s$=this.peerConnection.getTransceivers()[0];s$!=null&&s$.sender&&s$.sender.transport&&this.tryBindTransportEvents(s$.sender.transport)}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r$.toString()))}}async addRemoteCandidate(t$){try{t$&&this.pendingCandidates.push(t$),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(r$=>{this.peerConnection.addIceCandidate(r$)}),this.pendingCandidates=[])}catch(r$){throw new N(R.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(r$.toString()))}}send(t$,r$,n$){var i$=this;return Bi(function*(){let o$=yield Tt(i$.mutex.lock("From P2PConnection.send"));try{if(!i$.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let s$=[],a$=i$.remoteSDP.receive(t$,r$,n$);t$.forEach((m$,g$)=>{if(a$[g$].needCreateTransceiver){let v$=i$.peerConnection.addTransceiver(m$._mediaStreamTrack,{direction:"sendonly"});s$.push(v$),m$._updateRtpTransceiver(v$)}else{let v$=i$.peerConnection.getTransceivers().find(y$=>y$.mid===a$[g$].mid);if(!v$)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(a$[g$].mid));s$.push(v$),m$._updateRtpTransceiver(v$)}}),$t()&&v("SIMULCAST")===!0&&(yield Tt(i$.applySimulcastForFirefox(s$,t$)));let c$=a$.map(m$=>m$.mid),u$=yield Tt(i$.peerConnection.createOffer()),l$=i$.mungSendOfferSDP(u$.sdp,t$,c$),d$=Le.parse(l$),h$=c$.map(m$=>{let g$=d$.mediaDescriptions.find(v$=>v$.attributes.mid===m$);if(!g$)throw new Error("Cannot extract ssrc from mediaDescription.");return n0(g$,v("USE_PUB_RTX"))}),p$=s$.map((m$,g$)=>{let v$=c$[g$];return{localSSRC:h$[g$],id:v$}});yield Tt(i$.peerConnection.setLocalDescription({type:"offer",sdp:l$}));try{yield p$}catch(m$){let g$=i$.remoteSDP.toString();throw yield Tt(i$.peerConnection.setLocalDescription({type:"offer",sdp:l$})),yield Tt(i$.peerConnection.setRemoteDescription({type:"answer",sdp:g$})),yield Tt(i$.stopSending(c$,!0)),m$}yield Tt(i$.applySimulcastEncodings(s$,t$)),yield Tt(i$.applySendEncodings(s$,t$));let _$=i$.remoteSDP.toString(),f$=i$.logSDPExchange(l$,"offer","local","send");return f$==null||f$(_$),yield Tt(i$.setRemoteDescription({type:"answer",sdp:_$})),s$.map((m$,g$)=>{let v$=c$[g$];return{localSSRC:h$[g$],id:v$}})}catch(s$){throw s$ instanceof N?s$:new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s$.toString()))}finally{o$()}})()}async stopSending(t$,r$){let n$=r$?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let i$=this.peerConnection.getTransceivers().filter(c$=>t$.indexOf(c$.mid)!==-1);if(i$.length!==t$.length)throw new Error("Transceivers' length (".concat(i$.length,") doesn't match mids' length (").concat(t$.length,") when trying to call P2PConnection.stopSending."));i$.map(c$=>{var u$;c$.direction="inactive",(u$=c$.stop)===null||u$===void 0||u$.call(c$)});let o$=await this.peerConnection.createOffer(),s$=this.logSDPExchange(o$.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o$),this.remoteSDP.stopReceiving(t$);let a$=this.remoteSDP.toString();s$==null||s$(a$),await this.setRemoteDescription({type:"answer",sdp:a$})}catch(i$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i$.toString()))}finally{n$&&n$()}}async receive(t$,r$,n$,i$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t$," before remoteSDP created."));let{mid:o$,needExchangeSDP:s$}=this.remoteSDP.send(t$,r$,n$,i$);if(s$){let c$=this.remoteSDP.toString(),u$=this.logSDPExchange(c$,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:c$});let l$=await this.peerConnection.createAnswer(),d$=this.mungReceiveAnswerSDP(l$.sdp,o$,t$);u$==null||u$(d$||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:d$}),_.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t$," by exchanging SDP."))}else _.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t$," no need to exchange SDP."));let a$=this.peerConnection.getTransceivers().find(c$=>c$.mid===o$);if(!a$||a$.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a$.receiver.track,mid:a$.mid,transceiver:a$}}catch(o$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o$.toString()))}}async mockReceive(t$,r$,n$,i$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t$," before remoteSDP created."));let{mid:o$,needExchangeSDP:s$}=this.remoteSDP.send(t$,r$,n$,i$);if(s$){let a$=this.remoteSDP.toString(),c$=this.logSDPExchange(a$,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:a$});let u$=await this.peerConnection.createAnswer(),l$=this.mungReceiveAnswerSDP(u$.sdp,o$,t$);c$==null||c$(l$||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:l$}),_.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t$," by exchanging SDP."))}else _.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t$," no need to exchange SDP."))}catch(o$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o$.toString()))}}async stopReceiving(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t$);let r$=this.remoteSDP.toString(),n$=this.logSDPExchange(r$,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:r$});let i$=await this.peerConnection.createAnswer();n$==null||n$(i$.sdp||""),await this.peerConnection.setLocalDescription(i$)}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r$.toString()))}}async restartICE(t$){try{if(this.store.p2pTransport===Oo.Auto&&(this.store.p2pTransport=Oo.SdRtn,ft().supportPCSetConfiguration&&this.peerConnection.setConfiguration(u5.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,ft().supportPCSetConfiguration&&this.peerConnection.setConfiguration(u5.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t$){this.restartCnt++,this.isReady=!1;let r$=await this.peerConnection.createOffer({iceRestart:!0});if(!r$.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:n$}=io(r$.sdp);return this.store.descriptionStart(),this.direction===cn.SEND_ONLY&&await this.peerConnection.setLocalDescription(r$),n$}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t$),this.store.descriptionStart(),this.direction===cn.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let r$=await this.peerConnection.createAnswer();if(!r$.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:n$}=io(r$.sdp);return await this.peerConnection.setLocalDescription(r$),n$}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r$.toString()))}}close(){var t$;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t$=this.onConnectionStateChange)===null||t$===void 0||t$.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t$){return this.statsFilter.getVideoIsReady(t$)}async updateEncoderConfig(t$,r$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n$=await this.peerConnection.createOffer(),i$=this.mungSendOfferSDP(n$.sdp,[r$],[t$]);this.remoteSDP.updateRecvMedia(t$,r$);let o$=this.remoteSDP.toString(),s$=this.logSDPExchange(i$,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i$}),s$==null||s$(o$),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o$})}catch(n$){throw new N(R.EXCHANGE_SDP_FAILED,n$.toString())}}async updateSendParameters(t$,r$){let n$=this.peerConnection.getTransceivers().filter(i$=>i$.mid===t$);n$.length===1&&(this.isVP8Simulcast(r$)?$t()||await this.applySimulcastEncodings(n$,[r$]):await this.applySendEncodings(n$,[r$]))}setStatsRemoteVideoIsReady(t$,r$){this.statsFilter.setVideoIsReady2(t$,r$)}async replaceTrack(t$,r$){let n$=this.peerConnection.getTransceivers().find(i$=>i$.mid===r$);n$&&await n$.sender.replaceTrack(t$._mediaStreamTrack)}async getSelectedCandidatePair(){let t$=this.peerConnection.getReceivers();if(t$.length>0&&t$[0].transport&&t$[0].transport.iceTransport&&t$[0].transport.iceTransport.getSelectedCandidatePair&&t$[0].transport.iceTransport.getSelectedCandidatePair()){let r$=t$[0].transport.iceTransport,{local:n$,remote:i$}=r$.getSelectedCandidatePair();return{local:Gr(Gr({},hr),{},{candidateType:n$.type,protocol:n$.protocol,address:n$.address,port:n$.port}),remote:Gr(Gr({},hr),{},{candidateType:i$.type,protocol:i$.protocol,address:i$.address,port:i$.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t$,r$;W(t$=["connected","completed"]).call(t$,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(r$=this.onICEConnectionStateChange)===null||r$===void 0||r$.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t$;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t$=this.onConnectionStateChange)===null||t$===void 0||t$.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t$=>{if(t$.candidate){var r$;t$.candidate.candidate&&((r$=this.onLocalCandidate)===null||r$===void 0||r$.call(this,t$.candidate.toJSON())),this.localCandidateCount+=1}else _.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t$,r$){let n$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i$={iceServers:[]};var o$;return t$.iceServers?i$.iceServers=t$.iceServers:t$.turnServer&&t$.turnServer.mode!=="off"&&(Yu(t$.turnServer.servers)?i$.iceServers=t$.turnServer.servers:(i$.iceServers&&i$.iceServers.push(...u5.turnServerConfigToIceServers(t$.turnServer.servers,r$,n$)),v("USE_TURN_SERVER_OF_GATEWAY")&&i$.iceServers&&t$.turnServer.serversFromGateway&&i$.iceServers.push(...u5.turnServerConfigToIceServers(t$.turnServer.serversFromGateway,r$,n$)),W(o$=[Oo.Relay,Oo.SdRtn]).call(o$,r$)&&(i$.iceTransportPolicy="relay"),v("FORCE_TURN_TCP")?i$.iceTransportPolicy="relay":t$.turnServer.servers.concat(t$.turnServer.serversFromGateway||[]).forEach(s$=>{s$.forceturn&&(i$.iceTransportPolicy="relay")}))),v("ENABLE_ENCODED_TRANSFORM")&&ft().supportWebRTCEncodedTransform&&(i$.encodedInsertableStreams=!0),_.debug("P2PConnection p2pTransport is ".concat(r$)),i$}static turnServerConfigToIceServers(t$,r$){let n$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i$=[],o$=t$.filter(a$=>a$.tcpport);_.debug("P2PConnection turnServers is ".concat(o$,", current index is ").concat(n$));let s$=o$.length>n$?o$[n$]:o$[0];switch(r$){case Oo.SdRtn:let a$=t$.filter(u$=>{var l$;return W(l$=u$.username).call(l$,"glb:")&&u$.turnServerURL==u$.turnServerURL}),c$=a$.length>n$?a$[n$]:a$[0];c$&&(i$.push({username:c$.username,credential:c$.password,credentialType:"password",urls:"turn:".concat(Us(c$.turnServerURL),":").concat(c$.tcpport,"?transport=udp")}),i$.push({username:c$.username,credential:c$.password,credentialType:"password",urls:"turns:".concat(Us(c$.turnServerURL),":").concat(c$.tcpport,"?transport=tcp")}));break;case Oo.Relay:s$&&(i$.push({username:s$.username,credential:s$.password,credentialType:"password",urls:"turn:".concat(s$.turnServerURL,":").concat(s$.tcpport,"?transport=udp")}),i$.push({username:s$.username,credential:s$.password,credentialType:"password",urls:"turns:".concat(Us(s$.turnServerURL),":").concat(s$.tcpport,"?transport=tcp")}));break;default:s$&&(i$.push({username:s$.username,credential:s$.password,credentialType:"password",urls:"turn:".concat(s$.turnServerURL,":").concat(s$.tcpport,"?transport=udp")}),i$.push({username:s$.username,credential:s$.password,credentialType:"password",urls:"turns:".concat(Us(s$.turnServerURL),":").concat(s$.tcpport,"?transport=tcp")}),i$.push({username:s$.username,credential:s$.password,credentialType:"password",urls:"stun:".concat(s$.turnServerURL,":").concat(s$.tcpport)}))}return i$}tryBindTransportEvents(t$){if(t$){this.transport=t$,t$.onstatechange=()=>{var n$;t$!=null&&t$.state&&((n$=this.onDTLSTransportStateChange)===null||n$===void 0||n$.call(this,t$.state))},t$.onerror=n$=>{var i$;(i$=this.onDTLSTransportError)===null||i$===void 0||i$.call(this,"error"in n$?n$.error:n$)};let r$=t$.iceTransport;r$&&(r$.onstatechange=()=>{let n$=t$==null?void 0:t$.iceTransport.state;var i$;n$&&((i$=this.onICETransportStateChange)===null||i$===void 0||i$.call(this,n$))},r$.getSelectedCandidatePair&&(r$.onselectedcandidatepairchange=()=>{if(r$.getSelectedCandidatePair()){let{local:n$,remote:i$}=r$.getSelectedCandidatePair();_.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:n$.type,protocol:n$.protocol}),", remote ").concat(JSON.stringify({candidateType:i$.type,protocol:i$.protocol,address:i$.address,port:i$.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t$,r$){var n$;if(r$||(r$=this.peerConnection.getSenders().find(l$=>l$.track===t$._mediaStreamTrack)),!r$)return _.warn("[".concat(t$.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t$))return _.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ft().supportSetRtpSenderParameters)return _.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let i$={},o$={};switch(t$._optimizationMode){case"motion":i$.degradationPreference="maintain-framerate";break;case"detail":i$.degradationPreference="maintain-resolution";break;default:i$.degradationPreference="balanced"}if(t$._encoderConfig){var s$;let{bitrateMax:l$,frameRate:d$,scaleResolutionDownBy:h$}=t$._encoderConfig;l$&&(o$.maxBitrate=1e3*l$),W(s$=t$._hints).call(s$,Gt.LOW_STREAM)&&(d$&&(o$.maxFramerate=Nn(d$)),h$&&h$>=1&&(o$.scaleResolutionDownBy=h$))}if(v("DSCP_TYPE")&&ho()){var a$;let l$=v("DSCP_TYPE");W(a$=["very-low","low","medium","high"]).call(a$,l$)&&(o$.networkPriority=l$)}let c$=r$.getParameters(),u$=(n$=c$.encodings)===null||n$===void 0?void 0:n$[0];$t()&&!u$&&(i$.encodings=[o$]),u$&&Object.assign(u$,o$),Object.assign(c$,i$),_.debug("[".concat(t$.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c$.encodings))),await r$.setParameters(c$)}async applySendEncodings(t$,r$){try{if(!ft().supportSetRtpSenderParameters||t$.length!==r$.length)return;for(let n$=0;n$<t$.length;n$++){let i$=t$[n$],o$=r$[n$];o$ instanceof Ft&&!this.isVP8Simulcast(o$)&&await this.updateRtpSenderEncodings(o$,i$.sender)}}catch{_.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t$,r$,n$){let i$=Le.parse(t$);return r$.forEach((o$,s$)=>{let a$=n$[s$],c$=i$.mediaDescriptions.find(u$=>u$.attributes.mid===a$);c$&&(ra(c$,o$),o0(c$,o$,this.store.codec))}),Le.print(i$)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t$=>{var r$;(r$=this.onFirstAudioReceived)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstVideoReceived=t$=>{var r$;(r$=this.onFirstVideoReceived)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstAudioDecoded=t$=>{var r$;(r$=this.onFirstAudioDecoded)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstVideoDecoded=(t$,r$,n$)=>{var i$;(i$=this.onFirstVideoDecoded)===null||i$===void 0||i$.call(this,t$,r$,n$)},this.statsFilter.onSelectedLocalCandidateChanged=(t$,r$)=>{var n$;(n$=this.onSelectedLocalCandidateChanged)===null||n$===void 0||n$.call(this,t$,r$)},this.statsFilter.onSelectedRemoteCandidateChanged=(t$,r$)=>{var n$;(n$=this.onSelectedRemoteCandidateChanged)===null||n$===void 0||n$.call(this,t$,r$)},this.statsFilter.onFirstVideoDecodedTimeout=t$=>{var r$;(r$=this.onFirstVideoDecodedTimeout)===null||r$===void 0||r$.call(this,t$)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t$,r$){if(t$.length===r$.length)for(let c$=0;c$<t$.length;c$++){var n$,i$,o$,s$,a$;let u$=t$[c$],l$=r$[c$];if(l$ instanceof Ft&&!W(n$=l$._hints).call(n$,Gt.LOW_STREAM)&&(i$=l$._encoderConfig)!==null&&i$!==void 0&&i$.bitrateMax&&((o$=l$._encoderConfig)===null||o$===void 0?void 0:o$.bitrateMax)>200&&(s$=l$._scalabilityMode)!==null&&s$!==void 0&&s$.numSpatialLayers&&((a$=l$._scalabilityMode)===null||a$===void 0?void 0:a$.numSpatialLayers)>1&&this.store.codec==="vp8"){let d$={},h$={high:1e3*(l$._encoderConfig.bitrateMax-50),medium:5e4};d$.encodings=[{rid:"m",active:!0,maxBitrate:h$.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:h$.high}];let p$=u$.sender.getParameters();await u$.sender.setParameters(Object.assign(p$,d$))}}}async applySimulcastEncodings(t$,r$){if(!$t()&&t$.length===r$.length)for(let n$=0;n$<t$.length;n$++){let i$=r$[n$];if(i$ instanceof Ft&&this.isVP8Simulcast(i$)){let o$=t$[n$],s$={},a$={high:1e3*(i$._encoderConfig.bitrateMax-50),medium:5e4};s$.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a$.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a$.medium,scaleResolutionDownBy:4}];let c$=o$.sender.getParameters();await o$.sender.setParameters(Object.assign(c$,s$))}}}isVP8Simulcast(t$){var r$,n$,i$,o$,s$;return!!(t$ instanceof Ft&&v("SIMULCAST")&&this.store.codec==="vp8"&&!W(r$=t$._hints).call(r$,Gt.LOW_STREAM)&&(n$=t$._encoderConfig)!==null&&n$!==void 0&&n$.bitrateMax&&((i$=t$._encoderConfig)===null||i$===void 0?void 0:i$.bitrateMax)>200&&(o$=t$._scalabilityMode)!==null&&o$!==void 0&&o$.numSpatialLayers&&((s$=t$._scalabilityMode)===null||s$===void 0?void 0:s$.numSpatialLayers)>1)}logSDPExchange(t$,r$,n$,i$){if(v("SDP_LOGGING"))return _.upload("[".concat(this.store.clientId,"] exchanging ").concat(n$," ").concat(r$," SDP during P2PConnection.").concat(i$,`
`),t$),r$==="offer"?o$=>{this.logSDPExchange(o$,"answer",n$==="local"?"remote":"local",i$)}:void 0}async muteLocal(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r$=this.peerConnection.getTransceivers().filter(s$=>s$.mid&&t$.indexOf(s$.mid)!==-1);if(r$.length!==t$.length)throw new Error("Transceivers' length doesn't match mids' length.");r$.map(s$=>{s$.direction="inactive"});let n$=await this.peerConnection.createOffer(),i$=this.logSDPExchange(n$.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n$),this.remoteSDP.muteRemote(t$);let o$=this.remoteSDP.toString();i$==null||i$(o$),await this.setRemoteDescription({type:"answer",sdp:o$})}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r$.toString()))}}async unmuteLocal(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r$=this.peerConnection.getTransceivers().filter(s$=>s$.mid&&t$.indexOf(s$.mid)!==-1);if(r$.length!==t$.length)throw new Error("Transceivers' length doesn't match mids' length.");r$.map(async s$=>{s$.direction="sendonly"});let n$=await this.peerConnection.createOffer(),i$=this.logSDPExchange(n$.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n$),this.remoteSDP.unmuteRemote(t$);let o$=this.remoteSDP.toString();i$==null||i$(o$),await this.setRemoteDescription({type:"answer",sdp:o$})}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r$.toString()))}}async getRemoteSSRC(t$,r$){var n$,i$;if(r$=(n$=r$)!==null&&n$!==void 0?n$:(i$=this.currentRemoteDescription)===null||i$===void 0?void 0:i$.sdp){var o$;let s$=(o$=Le.parse(r$).mediaDescriptions.find(a$=>a$.attributes.mid===t$))===null||o$===void 0?void 0:o$.attributes.ssrcs;return s$==null?void 0:s$[0].ssrcId}}async setRemoteDescription(t$){var r$;await this.peerConnection.setRemoteDescription(t$),W(r$=["connected","completed"]).call(r$,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t$,r$,n$){let i$=Le.parse(t$),o$=i$.mediaDescriptions.find(s$=>s$.attributes.mid===r$);return o$&&n$===Q.AUDIO&&o$.media.mediaType==="audio"&&oa(o$),Le.print(i$)}},q(Vt.prototype,"establish",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"establish"),Vt.prototype),q(Vt.prototype,"connect",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"connect"),Vt.prototype),q(Vt.prototype,"receive",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"receive"),Vt.prototype),q(Vt.prototype,"mockReceive",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"mockReceive"),Vt.prototype),q(Vt.prototype,"stopReceiving",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"stopReceiving"),Vt.prototype),q(Vt.prototype,"restartICE",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"restartICE"),Vt.prototype),q(Vt.prototype,"close",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"close"),Vt.prototype),q(Vt.prototype,"updateEncoderConfig",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"updateEncoderConfig"),Vt.prototype),q(Vt.prototype,"updateSendParameters",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"updateSendParameters"),Vt.prototype),q(Vt.prototype,"replaceTrack",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"replaceTrack"),Vt.prototype),q(Vt.prototype,"muteLocal",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"muteLocal"),Vt.prototype),q(Vt.prototype,"unmuteLocal",[_i],Object.getOwnPropertyDescriptor(Vt.prototype,"unmuteLocal"),Vt.prototype),Vt);function _i(e$,t$,r$){let n$=e$[t$];if(typeof n$!="function")throw new Error("Cannot use mutex on object property.");return r$.value=async function(){let i$=this.mutex,o$=await i$.lock("From P2PConnection.".concat(t$));try{for(var s$=arguments.length,a$=new Array(s$),c$=0;c$<s$;c$++)a$[c$]=arguments[c$];return await n$.apply(this,a$)}finally{o$()}},r$}function dm(e$,t$){let r$=document.createElement("video"),n$=document.createElement("canvas");r$.setAttribute("style","display:none"),n$.setAttribute("style","display:none"),r$.setAttribute("muted",""),r$.muted=!0,r$.setAttribute("autoplay",""),r$.autoplay=!0,r$.setAttribute("playsinline",""),n$.width=Nn(t$.width),n$.height=Nn(t$.height);let i$=Nn(t$.framerate||15);document.body.append(r$),document.body.append(n$);let o$=e$._mediaStreamTrack;r$.srcObject=new MediaStream([o$]),r$.play();let s$=n$.getContext("2d");if(!s$)throw new O(R.UNEXPECTED_ERROR,"can not get canvas context");let a$=ft(),c$=n$.captureStream(a$.supportRequestFrame?0:i$).getVideoTracks()[0];c$.canvas||(c$.canvas=n$),n$.startCapture=()=>{if(!r$)return n$.stopCapture&&n$.stopCapture();if(r$.paused&&r$.play(),r$.videoHeight>2&&r$.videoWidth>2){let l$=r$.videoWidth,d$=r$.videoHeight/l$,h$=n$.width*d$;Math.abs(h$-n$.height)>=2&&(_.debug("adjust low stream resolution","".concat(n$.width,"x").concat(n$.height," -> ").concat(n$.width,"x").concat(h$)),n$.height=h$)}s$.drawImage(r$,0,0,n$.width,n$.height),c$.requestFrame&&c$.requestFrame(),o$!==e$._mediaStreamTrack&&(o$=e$._mediaStreamTrack,r$.srcObject=new MediaStream([o$]))},n$.stopCapture=Rf(()=>n$.startCapture&&n$.startCapture(),i$);let u$=c$.stop;return c$.stop=()=>{u$.call(c$),r$&&(r$.remove(),r$.srcObject=null,r$=null),n$&&(n$.width=0,n$.remove(),n$.stopCapture&&n$.stopCapture(),n$.startCapture=void 0,n$.stopCapture=void 0,n$=null),_.debug("clean low stream renderer")},c$}var Al=function(e$){return e$[e$.HEIGHT=2033]="HEIGHT",e$[e$.FRAME_RATE=2034]="FRAME_RATE",e$[e$.WIDTH=2035]="WIDTH",e$}(Al||{}),Ie=function(e$){return e$[e$.FRAME_RATE=2002]="FRAME_RATE",e$[e$.WIDTH=2003]="WIDTH",e$[e$.HEIGHT=2004]="HEIGHT",e$[e$.PACKAGE_LOST=2005]="PACKAGE_LOST",e$[e$.AVG_ENCODE=2007]="AVG_ENCODE",e$[e$.NACKS=2009]="NACKS",e$[e$.PLIS=2010]="PLIS",e$[e$.FIRS=2011]="FIRS",e$[e$.BITRATE=2012]="BITRATE",e$[e$.PACKAGE_RATE=2031]="PACKAGE_RATE",e$[e$.ADAPTATION=2032]="ADAPTATION",e$[e$.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e$[e$.BANDWIDTH=2061]="BANDWIDTH",e$[e$.RETRANSMIT=2062]="RETRANSMIT",e$[e$.TARGET_ENCODED=2064]="TARGET_ENCODED",e$[e$.TRANSMIT=2066]="TRANSMIT",e$[e$.FREEZE=2082]="FREEZE",e$[e$.DISABLED=2095]="DISABLED",e$[e$.PLAYER_STATUS=2128]="PLAYER_STATUS",e$[e$.QP_SUM=2143]="QP_SUM",e$}(Ie||{}),Do=function(e$){return e$[e$.BITRATE=2069]="BITRATE",e$[e$.PACKAGE_LOST=2070]="PACKAGE_LOST",e$[e$.PACKAGE_RATE=2071]="PACKAGE_RATE",e$[e$.HEIGHT=2073]="HEIGHT",e$[e$.FRAME_RATE=2075]="FRAME_RATE",e$[e$.WIDTH=2077]="WIDTH",e$}(Do||{}),Qe=function(e$){return e$[e$.JITTER=-1]="JITTER",e$[e$.PACKAGE_LOST=2014]="PACKAGE_LOST",e$[e$.WIDTH=2018]="WIDTH",e$[e$.HEIGHT=2019]="HEIGHT",e$[e$.FRAME_RATE=2020]="FRAME_RATE",e$[e$.JITTER_BUFFER=2023]="JITTER_BUFFER",e$[e$.CURRENT_DELAY=2024]="CURRENT_DELAY",e$[e$.NACKS=2026]="NACKS",e$[e$.PLIS=2027]="PLIS",e$[e$.FIRS=2028]="FIRS",e$[e$.BITRATE=2029]="BITRATE",e$[e$.PACKAGE_RATE=2078]="PACKAGE_RATE",e$[e$.FREEZE=2084]="FREEZE",e$[e$.DISABLED=2101]="DISABLED",e$[e$.PLAYER_STATUS=2129]="PLAYER_STATUS",e$[e$.QP_SUM=2144]="QP_SUM",e$[e$.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e$}(Qe||{}),Po=function(e$){return e$[e$.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e$[e$.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e$[e$.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e$[e$.FREEZE_TIME=2109]="FREEZE_TIME",e$[e$.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e$[e$.FREEZE_DURATION=2156]="FREEZE_DURATION",e$}(Po||{}),g0=function(e$){return e$[e$.PCM_LEVEL=2104]="PCM_LEVEL",e$}(g0||{}),zr=function(e$){return e$[e$.PACKAGE_LOST=-1]="PACKAGE_LOST",e$[e$.LEVEL=2038]="LEVEL",e$[e$.BITRATE=2039]="BITRATE",e$[e$.PACKAGE_RATE=2040]="PACKAGE_RATE",e$[e$.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e$[e$.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e$[e$.FREEZE=2081]="FREEZE",e$[e$.DISABLED=2096]="DISABLED",e$}(zr||{}),mi=function(e$){return e$[e$.BITRATE=2044]="BITRATE",e$[e$.PACKAGE_LOST=2045]="PACKAGE_LOST",e$[e$.PACKAGE_RATE=2046]="PACKAGE_RATE",e$[e$.CURRENT_DELAY=2047]="CURRENT_DELAY",e$[e$.JITTER_BUFFER=2054]="JITTER_BUFFER",e$[e$.JITTER=2055]="JITTER",e$[e$.FREEZE=2083]="FREEZE",e$[e$.DISABLED=2102]="DISABLED",e$[e$.PCM_LEVEL=2105]="PCM_LEVEL",e$[e$.PLAYER_STATUS=2130]="PLAYER_STATUS",e$[e$.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e$}(mi||{}),T0=function(e$){return e$[e$.FREEZE_TIME=-1]="FREEZE_TIME",e$[e$.LEVEL=2043]="LEVEL",e$}(T0||{}),$n=function(e$){return e$[e$.RTT=2006]="RTT",e$[e$.CONN_TYPE=801]="CONN_TYPE",e$}($n||{}),Rr=1e3,bo=3;function st(e$,t$,r$){r$!=null&&Number.isFinite(r$)&&(e$[t$]=Math.round(Math.max(0,r$)))}function fv(e$){let t$={[$n.CONN_TYPE]:0,[$n.RTT]:e$.rtt};switch(e$.selectedCandidatePair.localCandidate.candidateType){case"relay":{let r$=e$.selectedCandidatePair.localCandidate.relayProtocol;r$==="udp"&&(t$[$n.CONN_TYPE]=1),r$==="tcp"&&(t$[$n.CONN_TYPE]=3),r$==="tls"&&(t$[$n.CONN_TYPE]=4);break}case"srflx":t$[$n.CONN_TYPE]=2}return t$}function gv(e$){let t$=0;switch(e$){case"none":t$=0;break;case"cpu":t$=1;break;case"bandwidth":t$=2;break;case"other":t$=3}return t$}var pu=class extends Xt{constructor(e$){super(),T(this,"store",void 0),T(this,"uploadWRTCStatsTimer",void 0),T(this,"uploadOutboundDenoiserStatsTimer",void 0),T(this,"uploadExtStatsTimer",void 0),T(this,"uploadExtUsageStatsTimer",void 0),T(this,"uploadInboundExtStatsTimer",void 0),T(this,"requestStats",void 0),T(this,"requestTransportStats",void 0),T(this,"requestLocalMedia",void 0),T(this,"requestRemoteMedia",void 0),T(this,"requestAllTracks",void 0),T(this,"requestVideoIsReady",void 0),T(this,"requestUploadStats",void 0),T(this,"requestUpload",void 0),T(this,"uploadOutboundStarted",!1),T(this,"uploadInboundStarted",!1),T(this,"uploadTransportStarted",!1),T(this,"uploadExtensionUsageStarted",!1),T(this,"lastRecvStats",void 0),T(this,"lastSendStats",void 0),T(this,"lastFullRecvStats",void 0),T(this,"lastFullSendStats",void 0),T(this,"needUploadRenderFreezeTime",!0),this.store=e$}uploadWRTCStats(e$){if(!this.requestStats||!this.requestUploadStats)return;let t$,r$;if(this.uploadTransportStarted&&(t$=this.requestStats(),this.store.useP2P&&(r$=this.requestStats(!0))),!t$&&this.uploadOutboundStarted&&(t$=this.requestStats()),!r$&&this.uploadInboundStarted&&(r$=this.requestStats(!0)),t$||r$){let n$={};if(this.uploadTransportStarted&&t$){let i$=this.getTransportStats(t$,r$,e$);i$&&(n$.misc=[i$])}if(this.uploadOutboundStarted&&t$){let i$=this.getOutboundStats(t$,e$?this.lastSendStats:this.lastFullSendStats,e$);i$&&(n$.outbound=[i$])}if(this.uploadInboundStarted&&r$){let i$=this.getInboundStats(r$,e$?this.lastRecvStats:this.lastFullRecvStats,e$);i$&&(n$.inbound=i$)}this.requestUploadStats(n$)}this.lastRecvStats=r$,this.lastSendStats=t$,e$||(this.lastFullRecvStats=r$,this.lastFullSendStats=t$)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let e$=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(e$!==bo),++e$===bo+1&&(e$=1)},Rr)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e$,t$,r$){if(!this.requestStats)return;if(r$)return e$.rtt==null?void 0:{addition:{[$n.RTT]:e$.rtt,[$n.CONN_TYPE]:void 0}};let n$=fv(e$);if(this.store.useP2P){if(t$){let i$=fv(t$);n$[$n.CONN_TYPE]+=i$[$n.CONN_TYPE]<<3}n$[$n.CONN_TYPE]+=110}else n$[$n.CONN_TYPE]+=100;return{addition:n$}}getOutboundStats(e$,t$,r$){if(!this.requestUploadStats||!this.requestLocalMedia)return;let n$=this.requestLocalMedia();if(!n$||n$.length===0)return;let i$,o$,s$;return n$.forEach(a$=>{let[c$,{track:u$,ssrcs:l$}]=a$;switch(c$){case U.LocalVideoLowTrack:case U.LocalVideoTrack:if(c$===U.LocalVideoTrack){let d$=function(_$,f$,m$,g$,v$){let y$=f$.videoSend.find(k$=>k$.ssrc===_$);if(!y$)return;let S$={},{sentFrame:b$,inputFrame:$$}=y$;if($$&&b$){let k$=$$.frameRate,O$=b$.frameRate;S$[Ie.FREEZE]=function(U$,x$){let F$=!0;return F$=!(U$<=5)&&(U$<=10?x$<3:U$<=20?x$<4:x$<5),F$}(k$,O$)?1:0}if(st(S$,Ie.QP_SUM,y$.qpSumPerFrame),v$)return S$;switch(b$&&(st(S$,Ie.HEIGHT,b$.height),st(S$,Ie.WIDTH,b$.width),st(S$,Ie.FRAME_RATE,b$.frameRate)),S$[Ie.DISABLED]=g$._originMediaStreamTrack&&!g$._originMediaStreamTrack.enabled||g$._mediaStreamTrack&&!g$._mediaStreamTrack.enabled?1:0,y$.adaptionChangeReason){case"none":S$[Ie.ADAPTATION]=0;break;case"cpu":S$[Ie.ADAPTATION]=1;break;case"bandwidth":S$[Ie.ADAPTATION]=2;break;case"other":S$[Ie.ADAPTATION]=3}let C$=0;y$.adaptionChangeReason&&(C$+=gv(y$.adaptionChangeReason)),f$.qualityLimitationReason&&(C$+=gv(f$.qualityLimitationReason)<<3),S$[Ie.ADAPTATION]=C$,S$[Ie.PLAYER_STATUS]=o_[g$._player?g$._player.videoElementStatus:"uninit"],st(S$,Ie.NACKS,y$.nacksCount),st(S$,Ie.PLIS,y$.plisCount),st(S$,Ie.FIRS,y$.firsCount),st(S$,Ie.AVG_ENCODE,y$.avgEncodeMs);let N$=m$&&m$.videoSend.find(k$=>k$.ssrc===_$);if(N$){let k$=v$?Rr:Rr*bo;N$.timestamp&&y$.timestamp&&(k$=y$.timestamp-N$.timestamp),N$.packets!=null&&y$.packets!=null&&st(S$,Ie.PACKAGE_RATE,1e3*(y$.packets-N$.packets)/k$),y$.packetsLost!=null&&N$.packetsLost!=null&&st(S$,Ie.PACKAGE_LOST,y$.packetsLost-N$.packetsLost),N$.bytes!=null&&y$.bytes!=null&&st(S$,Ie.BITRATE,8*(y$.bytes-N$.bytes)/k$)}return S$}(l$[0].ssrcId,e$,t$,u$,r$),h$=r$?null:function(_$,f$,m$){let g$=f$.videoSend.find(C$=>C$.ssrc===_$);if(!g$)return null;let v$={},y$=g$.inputFrame,S$=y$&&y$.height||m$&&m$.videoHeight||0,b$=y$&&y$.width||m$&&m$.videoWidth||0,$$=y$&&y$.frameRate||0;return st(v$,Al.HEIGHT,S$),st(v$,Al.WIDTH,b$),st(v$,Al.FRAME_RATE,$$),v$}(l$[0].ssrcId,e$,u$),p$=r$?null:function(_$){let f$={};return st(f$,Ie.RETRANSMIT,_$.bitrate.retransmit),st(f$,Ie.TARGET_ENCODED,_$.bitrate.targetEncoded),st(f$,Ie.ACTUAL_ENCODED,_$.bitrate.actualEncoded),st(f$,Ie.TRANSMIT,_$.bitrate.transmit),st(f$,Ie.BANDWIDTH,_$.sendBandwidth),f$}(e$);o$=Object.assign({},d$,h$,p$)}else s$=r$?void 0:function(d$,h$,p$){let _$=h$.videoSend.find(g$=>g$.ssrc===d$);if(!_$)return;let f$={},m$=_$.sentFrame;if(m$&&(st(f$,Do.HEIGHT,m$.height),st(f$,Do.WIDTH,m$.width),st(f$,Do.FRAME_RATE,m$.frameRate)),p$){let g$=p$.videoSend.find(v$=>v$.ssrc===d$);if(g$){let v$=Rr*bo;g$.timestamp&&_$.timestamp&&(v$=_$.timestamp-g$.timestamp),g$.packets!=null&&_$.packets!=null&&st(f$,Do.PACKAGE_RATE,1e3*(_$.packets-g$.packets)/v$),_$.packetsLost!=null&&g$.packetsLost!=null&&st(f$,Do.PACKAGE_LOST,_$.packetsLost-g$.packetsLost),g$.bytes!=null&&_$.bytes!=null&&st(f$,Do.BITRATE,8*(_$.bytes-g$.bytes)/v$)}}return f$}(l$[0].ssrcId,e$,t$);break;case U.LocalAudioTrack:i$=r$?void 0:function(d$,h$,p$,_$){let f$=h$.audioSend.find(S$=>S$.ssrc===d$);if(!f$)return;let m$={};m$[zr.DISABLED]=_$._originMediaStreamTrack&&!_$._originMediaStreamTrack.enabled||_$._mediaStreamTrack&&!_$._mediaStreamTrack.enabled?1:0;let g$=100*_$._source.getAccurateVolumeLevel(),v$=f$.inputLevel;if(v$!=null){let S$=Math.ceil(50*Math.log10(100*v$+1));st(m$,zr.LEVEL,S$)}st(m$,g0.PCM_LEVEL,g$),st(m$,zr.AEC_RETURN_LOSS,f$.aecReturnLoss),st(m$,zr.AEC_RETURN_LOSS_ENH,f$.aecReturnLossEnhancement),m$[zr.FREEZE]=0;let y$=p$&&p$.audioSend.find(S$=>S$.ssrc===d$);if(y$){let S$=Rr*bo;y$.timestamp&&f$.timestamp&&(S$=f$.timestamp-y$.timestamp),y$.bytes!=null&&f$.bytes!=null&&st(m$,zr.BITRATE,8*(f$.bytes-y$.bytes)/S$),y$.packets!=null&&f$.packets!=null&&st(m$,zr.PACKAGE_RATE,1e3*(f$.packets-y$.packets)/S$)}return m$}(l$[0].ssrcId,e$,t$,u$)}}),{high:o$,low:s$,audio:i$}}getInboundStats(e$,t$,r$){if(!this.requestRemoteMedia)return;let n$=this.requestRemoteMedia()||[],i$=[];return n$.forEach(o$=>{let[s$,a$]=o$,c$={peer:s$.uid};if(a$.has(Q.VIDEO)&&s$.videoTrack){let u$=s$._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(s$._videoSSRC)||!1,l$=s$.videoTrack?function(d$,h$,p$,_$,f$,m$,g$){var v$;let y$=h$.videoRecv.find(O$=>O$.ssrc===d$);if(!y$)return;let S$={},{receivedFrame:b$,outputFrame:$$,decodeFrameRate:C$}=y$,N$=p$&&p$.videoRecv.find(O$=>O$.ssrc===d$);if(S$[Qe.FREEZE]=f$&&_u.isRemoteVideoFreeze(_$,y$,N$)?1:0,st(S$,Po.FRAME_RATE_DECODE,C$),st(S$,Qe.QP_SUM,y$.qpSumPerFrame),y$.framesRateFirefox&&st(S$,Qe.FRAME_RATE,y$.framesRateFirefox),b$&&st(S$,Qe.FRAME_RATE,b$.frameRate),N$){let O$=h$.timestamp-p$.timestamp||(g$?Rr:bo*Rr);y$.packetsLost!=null&&N$.packetsLost!=null&&st(S$,Qe.PACKAGE_LOST,y$.packetsLost-N$.packetsLost),N$.bytes!=null&&y$.bytes!=null&&st(S$,Qe.BITRATE,8*(y$.bytes-N$.bytes)/O$),N$.packets!=null&&y$.packets!=null&&st(S$,Qe.PACKAGE_RATE,1e3*(y$.packets-N$.packets)/O$)}if(g$)return S$;b$?(st(S$,Qe.HEIGHT,b$.height),st(S$,Qe.WIDTH,b$.width)):_$&&(st(S$,Qe.HEIGHT,_$._videoHeight||0),st(S$,Qe.WIDTH,_$._videoWidth||0)),$$&&st(S$,Po.FRAME_RATE_OUTPUT,$$.frameRate);let k$=(v$=_$._player)===null||v$===void 0?void 0:v$.rendFrameRate.toFixed(0);if(k$&&st(S$,Po.FRAME_RATE_RENDER,+k$),st(S$,Qe.JITTER_BUFFER,y$.jitterBufferMs),st(S$,Qe.CURRENT_DELAY,y$.currentDelayMs),st(S$,Qe.FIRS,y$.firsCount),st(S$,Qe.NACKS,y$.nacksCount),st(S$,Qe.PLIS,y$.plisCount),_$){S$[Qe.DISABLED]=_$._originMediaStreamTrack.enabled&&_$._mediaStreamTrack.enabled?0:1;let O$=_$._player;if(O$){let{freezeTimeCounterList:U$,renderFreezeAccTime:x$,videoElementStatus:F$}=O$;if(U$&&U$.length>0&&st(S$,Po.FREEZE_TIME,U$.splice(0,1)[0]),m$&&yr.visibility==="visible"&&F$===nn.PLAYING&&ft().supportRequestVideoFrameCallback){let L$=Math.min(6e3,x$);O$.renderFreezeAccTime=Math.max(0,x$-L$),st(S$,Po.FREEZE_TIME_RENDER,L$)}if(typeof y$.totalFreezesDuration=="number"){let L$=N$&&N$.totalFreezesDuration?y$.totalFreezesDuration-N$.totalFreezesDuration:y$.totalFreezesDuration;st(S$,Po.FREEZE_DURATION,1e3*L$)}}}if(S$[Qe.PLAYER_STATUS]=o_[_$._player?_$._player.videoElementStatus:"uninit"],N$&&y$.totalInterFrameDelay!==void 0&&y$.totalSquaredInterFrameDelay!==void 0&&N$.totalInterFrameDelay!==void 0&&N$.totalSquaredInterFrameDelay!==void 0){let O$=y$.totalInterFrameDelay-N$.totalInterFrameDelay,U$=y$.totalSquaredInterFrameDelay-N$.totalSquaredInterFrameDelay,x$=y$.framesDecodeCount-N$.framesDecodeCount,F$=O$/x$*1e3,L$=Math.round(1e3*Math.sqrt((U$-Math.pow(O$,2)/x$)/x$));!isNaN(L$)&&F$+L$>Math.max(3*F$,F$+150)&&(S$[Qe.I_FRAME_DELAY]=L$)}return S$}(s$._videoSSRC,e$,t$,s$.videoTrack,u$===!0,this.needUploadRenderFreezeTime,r$):void 0;l$&&(c$.video=l$)}if(a$.has(Q.AUDIO)&&s$.audioTrack){let u$=s$.audioTrack?function(l$,d$,h$,p$,_$){let f$=d$.audioRecv.find(N$=>N$.ssrc===l$);if(!f$)return;let m$={},g$=h$&&h$.audioRecv.find(N$=>N$.ssrc===l$),{receivedFrames:v$,droppedFrames:y$}=f$;var S$,b$;if(st(m$,mi.JITTER,f$.jitterMs),v$!=null&&y$!=null&&(m$[mi.FREEZE]=(b$=y$,(S$=v$)===0||100*b$/S$>20?1:0)),g$){let N$=d$.timestamp-h$.timestamp||(_$?Rr:Rr*bo);f$.packets!=null&&g$.packets!=null&&st(m$,mi.PACKAGE_RATE,1e3*(f$.packets-g$.packets)/N$),g$.bytes!=null&&f$.bytes!=null&&st(m$,mi.BITRATE,8*(f$.bytes-g$.bytes)/N$),f$.packetsLost!=null&&g$.packetsLost!=null&&st(m$,mi.PACKAGE_LOST,f$.packetsLost-g$.packetsLost)}if(_$)return m$;let $$=100*p$._source.getAccurateVolumeLevel(),C$=f$.outputLevel;if(C$!=null){let N$=Math.ceil(50*Math.log10(100*C$+1));st(m$,T0.LEVEL,N$)}if(st(m$,mi.PCM_LEVEL,$$),p$&&(m$[mi.DISABLED]=p$._originMediaStreamTrack.enabled&&p$._mediaStreamTrack.enabled?0:1),st(m$,mi.JITTER_BUFFER,f$.jitterBufferMs),st(m$,mi.CURRENT_DELAY,f$.jitterBufferMs),m$[mi.PLAYER_STATUS]=o_[En.getPlayerState(p$.getTrackId())],g$){let N$=f$.concealedSamples-g$.concealedSamples;N$>0&&st(m$,mi.CONCEALED_SAMPLES,N$)}return m$}(s$._audioSSRC,e$,t$,s$.audioTrack,r$):void 0;u$&&(c$.audio=u$)}(c$.video||c$.audio)&&i$.push(c$)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,i$}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let e$=(this.requestAllTracks()||[]).find(t$=>t$ instanceof ou);if(e$&&e$._external.getDenoiserStats){let t$=e$._external.getDenoiserStats();t$&&this.requestUpload(wc.DENOISER_STATS,t$)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e$=>{e$.getProcessorStats().forEach(t$=>{this.requestUpload&&this.requestUpload(t$.type,t$.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e$=>{let[t$,r$]=e$;r$.has(Q.VIDEO)&&t$.videoTrack&&t$.videoTrack.getProcessorStats().forEach(n$=>{this.requestUpload&&this.requestUpload(n$.type,n$.stats)}),r$.has(Q.AUDIO)&&t$.audioTrack&&t$.audioTrack.getProcessorStats().forEach(n$=>{this.requestUpload&&this.requestUpload(n$.type,n$.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let e$=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let t$=Date.now(),r$={connectionInterval:v("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t$},n$=[],i$=this.requestAllTracks&&this.requestAllTracks()||[];for(let c$ of i$)!c$.muted&&c$.enabled&&(n$=n$.concat(await c$.getProcessorUsage()));let o$=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[c$,u$]of o$)u$.has(Q.VIDEO)&&c$.videoTrack&&(n$=n$.concat(await c$.videoTrack.getProcessorUsage())),u$.has(Q.AUDIO)&&c$.audioTrack&&(n$=n$.concat(await c$.audioTrack.getProcessorUsage()));if(n$.length===0)return;r$.details=function(c$,u$){let l$={};for(let{id:_$,value:f$,level:m$,direction:g$}of c$){var d$;let v$=(d$=u$.get(_$))!==null&&d$!==void 0?d$:0,y$=f$===2?v$+v("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:v$;var h$,p$;u$.set(_$,y$),l$[_$]?(f$===2&&(l$[_$].value=f$),m$>l$[_$].level&&(l$[_$].level=m$),g$==="remote"&&(l$[_$].remoteUidCount+=1),l$[_$].totalTs=(h$=u$.get(_$))!==null&&h$!==void 0?h$:0):l$[_$]={value:f$,level:m$,remoteUidCount:g$==="local"?0:1,totalTs:(p$=u$.get(_$))!==null&&p$!==void 0?p$:0}}return Object.keys(l$).map(_$=>{let{level:f$,value:m$,totalTs:g$}=l$[_$];return{id:_$,level:f$,value:m$,totalTs:g$}})}(n$,e$);let s$=Date.now(),a$=s$>t$?s$:t$+1;this.requestUpload&&this.requestUpload(wc.EXTENSION_USAGE_STATS,{usageStats:r$,sendTs:a$})},v("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}},ir=class{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e$,t$){T(this,"uid",void 0),T(this,"_uintid",void 0),T(this,"_trust_in_room_",!0),T(this,"_trust_audio_enabled_state_",!0),T(this,"_trust_video_enabled_state_",!0),T(this,"_trust_audio_mute_state_",!0),T(this,"_trust_video_mute_state_",!0),T(this,"_audio_muted_",!1),T(this,"_video_muted_",!1),T(this,"_audio_enabled_",!0),T(this,"_video_enabled_",!0),T(this,"_audio_added_",!1),T(this,"_video_added_",!1),T(this,"_is_pre_created",!1),T(this,"_video_pre_subscribed",!1),T(this,"_audio_pre_subscribed",!1),T(this,"_trust_video_stream_added_state_",!0),T(this,"_trust_audio_stream_added_state_",!0),T(this,"_audioTrack",void 0),T(this,"_videoTrack",void 0),T(this,"_dataChannels",[]),T(this,"_audioSSRC",void 0),T(this,"_videoSSRC",void 0),T(this,"_audioOrtc",void 0),T(this,"_videoOrtc",void 0),T(this,"_cname",void 0),T(this,"_rtxSsrcId",void 0),T(this,"_videoMid",void 0),T(this,"_audioMid",void 0),this.uid=e$,this._uintid=t$}},Ui=function(e$){return e$.SEND_ONLY="SEND_ONLY",e$.RECEIVE_ONLY="RECEIVE_ONLY",e$}({});function uW(e$,t$){var r$;let n$;switch(t$){case U.LocalAudioTrack:n$=Ct.Audio;break;case U.LocalVideoTrack:n$=W(r$=e$._hints).call(r$,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High;break;case U.LocalVideoLowTrack:n$=Ct.Low}return n$}function lm(e$){let t$=ft();if(e$.some(r$=>r$._bypassWebAudio))throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t$.webAudioMediaStreamDest)throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function E_(e$,t$){lm(e$);let r$=new ge;return e$.forEach(n$=>r$.addAudioTrack(n$)),r$}var Tv,Sv,Rv,Cv,Iv,vv,yv,Av,bv,wv,Ov,Ht;function Nv(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function Yd(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?Nv(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):Nv(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var An=(Tv=Pi(Ui.SEND_ONLY),Sv=Pi(Ui.SEND_ONLY),Rv=Pi(),Cv=Pi(Ui.RECEIVE_ONLY),Iv=Pi(Ui.RECEIVE_ONLY),vv=Pi(Ui.RECEIVE_ONLY),yv=Pi(Ui.RECEIVE_ONLY),Av=Pi(Ui.RECEIVE_ONLY),bv=Pi(Ui.RECEIVE_ONLY),wv=Pi(),Ov=Pi(Ui.RECEIVE_ONLY),Ht=class extends Xt{get state(){return this._state}set state(e$){let t$=this._state;this._state=e$,this.emit(tt.StateChange,t$,this._state)}constructor(e$,t$){super(),T(this,"isPlanB",!1),T(this,"store",void 0),T(this,"statsUploader",void 0),T(this,"sendConnection",void 0),T(this,"recvConnection",void 0),T(this,"localTrackMap",new Map),T(this,"remoteUserMap",new Map),T(this,"localDataChannels",[]),T(this,"pendingLocalTracks",[]),T(this,"pendingRemoteTracks",[]),T(this,"statsCollector",void 0),T(this,"dtlsFailedCount",0),T(this,"sendMutex",new ze("P2PChannel2-send-mutex")),T(this,"recvMutex",new ze("P2PChannel2-recv-mutex")),T(this,"_state",Rt.Disconnected),T(this,"_restartStates",["disconnected","failed"]),T(this,"reconnectInterval",void 0),T(this,"uploadUnplinkStarted",!1),T(this,"uploadDownlinkStarted",!1),T(this,"uplinkStateUploadInterval",void 0),T(this,"downlinkStatsUploadInterval",void 0),T(this,"handleMuteLocalTrack",async(r$,n$,i$)=>{let o$=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Rt.Connected)return void i$(new N(R.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let c$=this.filterTobeMutedTracks(r$);if(c$.length===0)return void n$();let u$=c$.find(p$=>p$[0]==="videoLowTrack");u$&&u$[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(c$.map(p$=>{let[,{id:_$}]=p$;return _$}));let l$=!1;var s$,a$;r$.trackMediaType==="video"?l$=!((s$=this.localTrackMap.get(U.LocalAudioTrack))===null||s$===void 0||!s$.track._muted):l$=((a$=this.localTrackMap.get(U.LocalVideoTrack))===null||a$===void 0?void 0:a$.id)===void 0;let d$=this.createMuteMessage(c$);await kt(this,tt.RequestMuteLocal,d$);let h$=r$.trackMediaType==="video"?to.MUTE_LOCAL_VIDEO:to.MUTE_LOCAL_AUDIO;await kt(this,tt.RequestP2PMuteLocal,{action:h$,message:d$,isMuteAll:l$}),n$()}catch(c$){i$(c$)}finally{o$()}}),T(this,"handleUnmuteLocalTrack",async(r$,n$,i$)=>{let o$=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Rt.Connected)return void i$(new N(R.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let s$=this.filterTobeUnmutedTracks(r$);if(s$.length===0)return void n$();await this.sendConnection.unmuteLocal(s$.map(u$=>{let[,{id:l$}]=u$;return l$}));let a$=this.createUnmuteMessage(s$),c$=r$.trackMediaType==="video"?to.UNMUTE_LOCAL_VIDEO:to.UNMUTE_LOCAL_AUDIO;await kt(this,tt.RequestP2PMuteLocal,{action:c$,message:a$}),n$()}catch(s$){i$(s$)}finally{o$()}}),T(this,"handleUpdateVideoEncoder",async(r$,n$,i$)=>{let o$=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{let s$=this.localTrackMap.get(U.LocalVideoTrack);if(!this.sendConnection||!s$||s$.track!==r$||this.state!==Rt.Connected)return void n$();let{id:a$,track:c$}=s$;a$&&(await this.sendConnection.updateSendParameters(a$,c$),await this.sendConnection.updateEncoderConfig(a$,c$),this.emit(tt.UpdateVideoEncoder,c$)),n$()}catch(s$){i$(s$)}finally{o$()}}),T(this,"handleUpdateVideoSendParameters",async(r$,n$,i$)=>{let o$=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let s$=this.localTrackMap.get(U.LocalVideoTrack);if(!this.sendConnection||!s$||s$.track!==r$||this.state!==Rt.Connected)return void n$();let{id:a$,track:c$}=s$;a$&&await this.sendConnection.updateSendParameters(a$,c$),n$()}catch(s$){i$(s$)}finally{o$()}}),T(this,"handleReplaceTrack",async(r$,n$,i$,o$)=>{let s$;_.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(r$.getTrackId(),"]")),typeof o$=="boolean"&&o$||(s$=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var a$;let u$=Array.from(this.localTrackMap.entries()).find(l$=>{let[,{track:d$}]=l$;return r$===d$});if(!this.sendConnection||!u$||u$[1].id===void 0||this.state!==Rt.Connected)return void n$();if(await((a$=this.sendConnection)===null||a$===void 0?void 0:a$.replaceTrack(r$,u$[1].id)),u$[0]===U.LocalVideoTrack&&ft().supportDualStreamEncoding){let l$=this.localTrackMap.get(U.LocalVideoLowTrack);if(l$){let d$=r$._mediaStreamTrack.clone();l$.track._originMediaStreamTrack.stop(),l$.track._mediaStreamTrack=d$,l$.track._originMediaStreamTrack=d$,await new j((h$,p$)=>{this.handleReplaceTrack(l$.track,h$,p$,!0)})}}n$()}catch(u$){i$(u$)}finally{var c$;(c$=s$)===null||c$===void 0||c$()}}),T(this,"handleGetLocalVideoStats",r$=>{r$(this.statsCollector.getLocalVideoTrackStats())}),T(this,"handleGetLocalAudioStats",r$=>{r$(this.statsCollector.getLocalAudioTrackStats())}),T(this,"handleGetRemoteVideoStats",r$=>this.statsCollector.getRemoteVideoTrackStats(r$.uid)[r$.uid]),T(this,"handleGetRemoteAudioStats",r$=>this.statsCollector.getRemoteAudioTrackStats(r$.uid)[r$.uid]),this.store=e$,this.statsCollector=t$,this.statsCollector.addP2PChannel(this),this.statsUploader=new pu(e$),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(r$=>{r$&&(r$.iceConnectionState!=="disconnected"&&r$.iceConnectionState!=="failed"||this.handleDisconnect(r$.direction))})},v("ICE_RESTART_INTERVAL"))}async startP2PConnection(e$,t$){throw new N(R.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e$){throw new N(R.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e$,t$){let r$;try{if(t$){this.recvConnection&&(_.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),r$=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new mv(e$,this.store,cn.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let n$=await this.recvConnection.establish(t$);return{iceParameters:n$.iceParameters,dtlsParameters:n$.dtlsParameters,sdp:n$.sdp}}{this.state=Rt.New,this.sendConnection&&(_.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),r$=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new mv(e$,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let n$=await this.sendConnection.establish();return{iceParameters:n$.iceParameters,dtlsParameters:n$.dtlsParameters,sdp:n$.sdp}}}finally{r$&&r$()}}async p2pConnect(e$){if(!this.sendConnection)throw new N(R.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e$),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Rt.Connected}async addRemoteCandidate(e$,t$){if(t$===cn.RECEIVE_ONLY){if(!this.sendConnection)throw new N(R.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e$)}else{if(!this.recvConnection)throw new N(R.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e$)}}publish(e$,t$,r$){var n$=this;return Bi(function*(){let i$=yield Tt(n$.sendMutex.lock("From P2PChannel.publish"));try{if(!n$.sendConnection||n$.state!==Rt.Connected){n$.throwIfTrackTypeNotMatch(e$);let u$=e$.filter(l$=>n$.pendingLocalTracks.indexOf(l$)===-1);return void(n$.pendingLocalTracks=n$.pendingLocalTracks.concat(u$))}n$.store.pubId=n$.store.pubId+1,qe.markPublishStart(n$.store.clientId,n$.store.pubId);let o$=n$.filterTobePublishedTracks(e$,t$,r$);if(o$.length===0)return void(yield Tt(n$.tryToUnmuteAudio(e$)));o$.forEach(u$=>{let{track:l$,type:d$}=u$,h$=Date.now();n$.store.publish(l$.getTrackId(),d$===U.LocalAudioTrack?"audio":"video",h$)}),n$.bindLocalTrackEvents(o$);let s$=yield Tt(n$.sendConnection.send(o$.map(u$=>{let{track:l$}=u$;return l$}),n$.store.codec,n$.store.audioCodec)),a$=(yield Tt(s$.next())).value,c$=n$.createGatewayPublishMessage(o$,a$);try{yield c$}catch(u$){throw s$.throw(u$),(u$==null?void 0:u$.code)===R.WS_ABORT&&o$.forEach(l$=>{let{track:d$}=l$;n$.pendingLocalTracks.indexOf(d$)===-1&&n$.pendingLocalTracks.push(d$)}),n$.unbindLocalTrackEvents(o$),u$}yield Tt(s$.next()),o$.forEach(u$=>{let{type:l$}=u$;n$.statsCollector.addLocalStats(l$)}),n$.statsUploader.startUploadOutboundStats(),n$.assignLocalTracks(o$,a$),o$.forEach(u$=>{let{track:l$,type:d$}=u$,h$=Date.now();n$.store.publish(l$.getTrackId(),d$===U.LocalAudioTrack?"audio":"video",void 0,h$)}),n$.startUploadUplinkState()}finally{i$()}})()}async unpublish(e$){if(!this.sendConnection||this.state!==Rt.Connected)return void(e$.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i$=>!W(e$).call(e$,i$)));let t$=this.filterTobeUnpublishedTracks(e$);if(t$.length===0)return;let r$=t$.find(i$=>i$[0]==="videoLowTrack");r$&&r$[1].track.close();let n$=this.createGatewayUnpublishMessage(t$);if(await this.sendConnection.stopSending(t$.map(i$=>{let[,{id:o$}]=i$;return o$})),this.withdrawLocalTracks(t$),this.unbindLocalTrackEvents(t$.map(i$=>{let[o$,{track:s$}]=i$;return{type:o$,track:s$}})),t$.forEach(i$=>{let[o$]=i$;this.statsCollector.removeLocalStats(o$)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Rt.Connected)return r$&&r$[1].track.close(),n$;e$.forEach(i$=>{let o$=this.pendingLocalTracks.indexOf(i$);o$!==-1&&this.pendingLocalTracks.splice(o$,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e$=()=>{let t$=[],r$=[];Array.from(this.localTrackMap.entries()).forEach(n$=>{let[i$,{track:o$,ssrcs:s$}]=n$,a$={stream_type:uW(o$,i$),ssrcs:s$};o$._muted||!o$._enabled?t$.push(a$):r$.push(a$)}),t$.length>0&&t$.forEach(n$=>{kt(this,tt.RequestMuteLocal,[n$])}),r$.length>0&&r$.forEach(n$=>{kt(this,tt.RequestUnmuteLocal,[n$])})};e$(),this.uplinkStateUploadInterval=window.setInterval(()=>{e$()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e$){return Bi(function*(){throw new N(R.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(_.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ge(this,tt.RequestRePublish,this.pendingLocalTracks),this.emit(tt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new N(R.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e$,t$,r$,n$){var i$;if(!this.recvConnection)throw new N(R.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i$=this.remoteUserMap.get(e$))!==null&&i$!==void 0&&i$.has(t$))return;let{track:o$,mid:s$,transceiver:a$}=await this.recvConnection.receive(t$,[{ssrcId:r$}],String(e$.uid),n$);t$===Q.AUDIO?(e$._audioTrack?e$._audioTrack._updateOriginMediaStreamTrack(o$):(e$._audioTrack=new Ks(o$,e$.uid,e$._uintid,this.store),_.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e$._audioTrack.getTrackId()))),a$&&e$._audioTrack._updateRtpTransceiver(a$),this.bindRemoteTrackEvents(e$,e$._audioTrack)):(e$._videoSSRC=r$,e$._videoTrack?e$._videoTrack._updateOriginMediaStreamTrack(o$):(e$._videoTrack=new Hs(o$,e$.uid,e$._uintid,this.store),_.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e$._videoTrack.getTrackId()))),a$&&e$._videoTrack._updateRtpTransceiver(a$),this.bindRemoteTrackEvents(e$,e$._videoTrack));let c$=this.remoteUserMap.get(e$);c$?c$.set(t$,s$):this.remoteUserMap.set(e$,new Map([[t$,s$]])),this.statsCollector.addRemoteStats(e$.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let u$=this.pendingRemoteTracks.findIndex(l$=>{let{user:d$,kind:h$}=l$;return d$.uid===e$.uid&&t$===h$});u$!==-1&&(this.pendingRemoteTracks.splice(u$,1),this.emit(tt.MediaReconnectEnd,e$.uid))}async mockSubscribe(e$,t$,r$,n$){if(!this.recvConnection)throw new N(R.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t$,[{ssrcId:r$}],String(e$.uid),n$)}async unsubscribe(e$,t$,r$){let n$=this.pendingRemoteTracks.filter(o$=>{let{user:s$,kind:a$}=o$;return t$!==void 0?s$.uid===e$.uid&&t$===a$:s$.uid===e$.uid});if(n$.forEach(o$=>{let s$=this.pendingRemoteTracks.indexOf(o$);this.pendingRemoteTracks.splice(s$,1)}),this.recvConnection||r$||n$.forEach(o$=>{let{kind:s$}=o$;var a$;if(s$===Q.AUDIO)(a$=e$._audioTrack)===null||a$===void 0||a$._destroy(),e$._audioTrack=void 0;else if(s$===Q.VIDEO){var c$;(c$=e$._videoTrack)===null||c$===void 0||c$._destroy(),e$._videoTrack=void 0}}),!this.recvConnection)return;let i$=this.filterTobeUnSubscribedTracks(e$,t$);i$.length!==0&&(await this.recvConnection.stopReceiving(i$.map(o$=>{let[,{id:s$}]=o$;return s$})),this.withdrawRemoteTracks(i$),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i$.forEach(o$=>{let[s$,{kind:a$}]=o$;var c$,u$;if(a$===Q.VIDEO&&s$._videoSSRC&&((c$=this.recvConnection)===null||c$===void 0||c$.setStatsRemoteVideoIsReady(s$._videoSSRC,!1)),a$===Q.VIDEO)this.unbindRemoteTrackEvents(s$._videoTrack),r$||((u$=s$._videoTrack)===null||u$===void 0||u$._destroy(),s$._videoTrack=void 0);else if(a$===Q.AUDIO){var l$;this.unbindRemoteTrackEvents(s$._audioTrack),!r$&&((l$=s$._audioTrack)===null||l$===void 0||l$._destroy(),s$._audioTrack=void 0)}}),i$.forEach(o$=>{let[,{kind:s$}]=o$;kt(this,tt.RequestP2PMuteRemote,s$)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e$=()=>Array.from(this.remoteUserMap.entries()).forEach(t$=>{let[,r$]=t$;[Q.VIDEO,Q.AUDIO].forEach(n$=>{r$.has(n$)?kt(this,tt.RequestP2PUnmuteRemote,n$):kt(this,tt.RequestP2PMuteRemote,n$)})});e$(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e$()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e$){throw new N(R.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e$){throw new N(R.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e$){throw new N(R.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e$){throw new N(R.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e$,t$){if(!this.recvConnection)return;let r$=this.remoteUserMap.get(e$);if(!r$)return void _.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e$.uid,"."));if(!r$.get(t$))return void _.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e$.uid," media type ").concat(t$,"."));let n$=t$===Q.VIDEO?e$._videoSSRC:e$._audioSSRC;n$!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(n$,!1)}async unmuteRemote(e$,t$){return this.unmuteRemoteNoLock(e$,t$)}async unmuteRemoteNoLock(e$,t$){if(!this.recvConnection)return;let r$=this.remoteUserMap.get(e$);if(!r$)return void _.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e$.uid,"."));r$.get(t$)||_.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e$.uid," media type ").concat(t$,"."))}getAllTracks(e$){let t$=this.localTrackMap.get(U.LocalAudioTrack);if((t$==null?void 0:t$.track)instanceof ge){let r$=t$.track;return Array.from(this.localTrackMap.entries()).filter(n$=>{let[i$]=n$;return i$!==U.LocalAudioTrack}).filter(n$=>{let[i$]=n$;return!(e$&&i$===U.LocalVideoLowTrack)}).map(n$=>{let[,{track:i$}]=n$;return i$}).concat(r$.trackList)}return Array.from(this.localTrackMap.entries()).filter(r$=>{let[n$]=r$;return!(e$&&n$===U.LocalVideoLowTrack)}).map(r$=>{let[,{track:n$}]=r$;return n$})}reportPublishEvent(e$,t$,r$,n$,i$){if(e$){let s$=this.localTrackMap.get(U.LocalAudioTrack),a$=n$?this.localTrackMap.get(U.LocalVideoLowTrack):this.localTrackMap.get(U.LocalVideoTrack);X.publish(this.store.sessionId,{eventElapse:qe.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e$,ec:t$,audioName:s$==null?void 0:s$.track.getTrackLabel(),videoName:a$==null?void 0:a$.track.getTrackLabel(),screenshare:(a$==null?void 0:a$.track._hints.indexOf(Gt.SCREEN_TRACK))!==-1,audio:!!s$,video:!!a$,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i$})}else{var o$;r$||(r$=[]);let s$=r$.find(c$=>c$ instanceof Qt),a$=n$?(o$=this.localTrackMap.get(U.LocalVideoTrack))===null||o$===void 0?void 0:o$.track:r$.find(c$=>c$ instanceof Ft);X.publish(this.store.sessionId,{eventElapse:qe.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e$,ec:t$,audioName:s$==null?void 0:s$.getTrackLabel(),videoName:a$==null?void 0:a$.getTrackLabel(),screenshare:(a$==null?void 0:a$._hints.indexOf(Gt.SCREEN_TRACK))!==-1,audio:!!s$,video:!!a$,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i$})}}reportSubscribeEvent(e$,t$,r$,n$){let i$=n$===Q.VIDEO?r$._videoSSRC:r$._audioSSRC;i$&&X.subscribe(this.store.sessionId,{succ:e$,ec:t$,video:n$===Q.VIDEO,audio:n$===Q.AUDIO,peerid:r$.uid,subscribeRequestid:n$===Q.VIDEO?r$._videoSSRC:r$._audioSSRC,p2pid:this.store.p2pId,eventElapse:qe.measureFromSubscribeStart(this.store.clientId,i$)})}reset(){_.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new ze("P2PChannel2-send-mutex"),this.sendMutex=new ze("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e$=this.localTrackMap.get(U.LocalAudioTrack);if((e$==null?void 0:e$.track)instanceof ge){if(e$.track.trackList.length>0){let t$=e$.track;e$.track.trackList.forEach(r$=>{t$.removeAudioTrack(r$)})}e$.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Rt.Disconnected}getStats(e$){var t$,r$;return e$?(r$=this.recvConnection)===null||r$===void 0?void 0:r$.getStats():(t$=this.sendConnection)===null||t$===void 0?void 0:t$.getStats()}getRemoteVideoIsReady(e$){var t$;return((t$=this.recvConnection)===null||t$===void 0?void 0:t$.getRemoteVideoIsReady(e$))||!1}getLocalAudioVolume(){let e$=this.localTrackMap.get(U.LocalAudioTrack);if(e$)return e$.track.getVolumeLevel()}getLocalVideoSize(){let e$=this.localTrackMap.get(U.LocalVideoTrack);if(e$)return{width:e$.track.videoWidth||0,height:e$.track.videoHeight||0}}getEncoderConfig(e$){let t$=this.localTrackMap.get(e$);return t$&&t$.track instanceof Ft||t$&&t$.track instanceof Qt?t$.track._encoderConfig:void 0}getLocalMedia(e$){return this.localTrackMap.get(e$)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e$,t$){if(!e$)return this.remoteUserMap.size>0;let r$=this.remoteUserMap.get(e$);return!!r$&&(!t$||r$.has(t$))}async hasRemoteMediaWithLock(e$,t$){if(!e$)return this.remoteUserMap.size>0;let r$=this.remoteUserMap.get(e$);return!!r$&&(!t$||r$.has(t$))}getRemoteMedia(e$){var t$;let r$=Array.from(xn(t$=this.remoteUserMap).call(t$)).find(n$=>n$.uid===e$);return r$?{audioTrack:r$.audioTrack,audioSSRC:r$._audioSSRC,videoTrack:r$.videoTrack,videoSSRC:r$._videoSSRC}:{}}getAudioLevels(){let e$=Array.from(this.remoteUserMap.entries()).map(r$=>{let[n$]=r$;return{uid:n$.uid,level:n$.audioTrack?100*n$.audioTrack._source.getAccurateVolumeLevel():0}}),t$=this.localTrackMap.get(U.LocalAudioTrack);return t$&&e$.push({level:100*t$.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e$=ed(e$).call(e$,(r$,n$)=>r$.level-n$.level),e$}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(_.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Rt.Reconnecting,v("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e$=>{let[t$]=e$;var r$;t$._videoTrack&&t$._videoTrack._player&&((r$=t$._videoTrack._player.getVideoElement())===null||r$===void 0||r$.pause(),t$._videoTrack._player.isKeepLastFrame=!0,t$._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e$=>{var t$;let[r$,{track:n$}]=e$;switch(r$){case U.LocalVideoTrack:W(t$=n$._hints).call(t$,Gt.LOW_STREAM)?n$.close():this.pendingLocalTracks.push(n$);break;case U.LocalAudioTrack:n$ instanceof ge?this.pendingLocalTracks=this.pendingLocalTracks.concat(n$.trackList):this.pendingLocalTracks.push(n$);case U.LocalVideoLowTrack:}}),this.emit(tt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e$=>{let[t$,r$]=e$;Array.from(xn(r$).call(r$)).forEach(n$=>{this.setPendingRemoteMedia(t$,n$)}),this.emit(tt.MediaReconnectStart,t$.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),_.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e$,t$){for(let r$ of this.pendingRemoteTracks){let{user:n$,kind:i$}=r$;if((e$ instanceof ir?e$.uid:e$)===n$.uid&&t$===i$)return!0}return!1}setPendingRemoteMedia(e$,t$){this.hasPendingRemoteMedia(e$,t$)||this.pendingRemoteTracks.push({user:e$,kind:t$})}async restartICE(e$,t$){let r$,n$;if(e$===cn.SEND_ONLY){if(!this.sendConnection)throw new N(R.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");r$=await this.sendMutex.lock("From P2PChannel.restartICE"),n$=this.sendConnection}else{if(!this.recvConnection)throw new N(R.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");r$=await this.recvMutex.lock("From P2PChannel.restartICE"),n$=this.recvConnection}try{if(t$){let i$=await n$.restartICE(t$);return n$.isInRestartIce=!1,i$}{let i$=await n$.restartICE();if(i$){let o$=await Ge(this,tt.RequestP2PRestartICE,{direction:cn.RECEIVE_ONLY,iceParameter:i$});await n$.restartICE(o$),n$.isInRestartIce=!1}}}finally{r$()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e$=this.sendConnection.getStats(),t$=this.localTrackMap.get(U.LocalVideoTrack),r$=this.localTrackMap.get(U.LocalAudioTrack),n$=e$.videoSend.find(p$=>{var _$;return p$.ssrc===(t$==null||(_$=t$.ssrcs)===null||_$===void 0?void 0:_$[0].ssrcId)}),i$=e$.audioSend.find(p$=>{var _$;return p$.ssrc===(r$==null||(_$=r$.ssrcs)===null||_$===void 0?void 0:_$[0].ssrcId)});if(!n$||!i$)return 1;let o$=ni(this,tt.NeedSignalRTT),s$=n$?n$.rttMs:void 0,a$=i$?i$.rttMs:void 0,c$=s$&&a$?(s$+a$)/2:s$||a$,u$=(c$&&o$?(c$+o$)/2:c$||o$)||0,l$=100*e$.sendPacketLossRate*.7/50+.3*u$/1500,d$=l$<.17?1:l$<.36?2:l$<.59?3:l$<.1?4:5,h$=t$==null?void 0:t$.track;if(h$&&h$._encoderConfig&&h$._hints.indexOf(Gt.SCREEN_TRACK)===-1){let p$=h$._encoderConfig.bitrateMax,_$=e$.bitrate.actualEncoded;if(p$&&_$){let f$=(1e3*p$-_$)/(1e3*p$);return OO[f$<.15?0:f$<.3?1:f$<.45?2:f$<.6?3:4][d$]}}return d$}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e$=this.recvConnection.getStats(),t$=0;return Array.from(this.remoteUserMap.entries()).forEach(r$=>{let[n$]=r$,i$=n$._audioSSRC,o$=n$._videoSSRC,s$=e$.audioRecv.find(_$=>_$.ssrc===i$),a$=e$.videoRecv.find(_$=>_$.ssrc===o$);if(!s$&&!a$)return void(t$+=1);let c$=ni(this,tt.NeedSignalRTT),u$=e$.rtt,l$=(u$&&c$?(u$+c$)/2:u$||c$)||0,d$=s$?s$.jitterMs:void 0,h$=e$.recvPacketLossRate,p$=.7*h$*100/50+.3*l$/1500;d$&&(p$=.6*h$*100/50+.2*l$/1500+.2*d$/400),t$+=p$<.1?1:p$<.17?2:p$<.36?3:p$<.59?4:5}),this.remoteUserMap.size>0?Math.round(t$/this.remoteUserMap.size):t$}async muteLocalTrack(e$){return new j((t$,r$)=>{this.handleMuteLocalTrack(e$,t$,r$)})}filterTobePublishedTracks(e$,t$,r$){let n$=[],i$=ft(),o$=this.getAllTracks();e$=Ls(e$=e$.filter(c$=>o$.indexOf(c$)===-1));let s$=!1,a$=!1;for(let c$ of e$){if(c$ instanceof Ft&&(this.localTrackMap.has(U.LocalVideoTrack)||s$?new N(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n$.push({track:c$,type:U.LocalVideoTrack}),s$=!0),t$)){let u$=this.getLowVideoTrack(c$,r$);n$.push({track:u$,type:U.LocalVideoLowTrack})}if(c$ instanceof Qt){let u$=this.localTrackMap.get(U.LocalAudioTrack);if(u$){if(!(u$.track instanceof ge))throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c$._bypassWebAudio)throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");u$.track.addAudioTrack(c$),this.bindLocalAudioTrackEvents(c$,!0)}else if(a$){let l$=n$.find(d$=>{let{type:h$}=d$;return h$===U.LocalAudioTrack});if(!(l$.track instanceof ge))throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c$._bypassWebAudio)throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");l$.track.addAudioTrack(c$)}else{if(!i$.webAudioMediaStreamDest||c$ instanceof ge||c$._bypassWebAudio)n$.push({track:c$,type:U.LocalAudioTrack});else{let l$=new ge;l$.addAudioTrack(c$),n$.push({track:l$,type:U.LocalAudioTrack})}a$=!0}}}return n$}filterTobeUnpublishedTracks(e$){let t$=[],r$=this.getAllTracks();e$=Ls(e$=e$.filter(n$=>r$.indexOf(n$)!==-1));for(let n$ of e$){if(n$ instanceof Qt){let i$=this.localTrackMap.get(U.LocalAudioTrack);if(!i$)continue;i$.track instanceof ge?(i$.track.removeAudioTrack(n$),this.unbindLocalAudioTrackEvents(n$),i$.track.trackList.length===0&&(t$.push([U.LocalAudioTrack,i$]),i$.track.close())):t$.push([U.LocalAudioTrack,i$])}if(n$ instanceof Ft){let i$=this.localTrackMap.get(U.LocalVideoTrack);if(!i$)continue;t$.push([U.LocalVideoTrack,i$]);let o$=this.localTrackMap.get(U.LocalVideoLowTrack);o$&&t$.push([U.LocalVideoLowTrack,o$])}}return t$}bindLocalTrackEvents(e$){e$.forEach(t$=>{let{track:r$,type:n$}=t$;switch(n$){case U.LocalVideoTrack:r$.addListener(H.GET_STATS,this.handleGetLocalVideoStats),r$.addListener(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r$.addListener(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r$.addListener(H.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r$.addListener(H.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r$.addListener(H.NEED_REPLACE_TRACK,this.handleReplaceTrack),r$.addListener(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r$.addListener(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case U.LocalAudioTrack:this.bindLocalAudioTrackEvents(r$);case U.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e$,t$){e$ instanceof ge?e$.trackList.forEach(r$=>{r$.addListener(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r$.addListener(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r$.addListener(H.GET_STATS,this.handleGetLocalAudioStats),r$.addListener(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r$.addListener(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e$.addListener(H.GET_STATS,this.handleGetLocalAudioStats),e$.addListener(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e$.addListener(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e$.addListener(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e$.addListener(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t$||e$.addListener(H.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e$){e$||(e$=Array.from(this.localTrackMap.entries()).map(t$=>{let[r$,{track:n$}]=t$;return{track:n$,type:r$}})),e$.forEach(t$=>{let{track:r$,type:n$}=t$;switch(n$){case U.LocalVideoTrack:r$.off(H.GET_STATS,this.handleGetLocalVideoStats),r$.off(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r$.off(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r$.off(H.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r$.off(H.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r$.off(H.NEED_REPLACE_TRACK,this.handleReplaceTrack),r$.off(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r$.off(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case U.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r$);case U.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e$){e$ instanceof ge?e$.trackList.forEach(t$=>{t$.off(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t$.off(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t$.off(H.GET_STATS,this.handleGetLocalAudioStats),t$.off(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t$.off(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e$.off(H.GET_STATS,this.handleGetLocalAudioStats),e$.off(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e$.off(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e$.off(H.NEED_REPLACE_TRACK,this.handleReplaceTrack),e$.off(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e$.off(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e$,t$){t$ instanceof Hs&&t$.addListener(H.GET_STATS,r$=>{r$(this.handleGetRemoteVideoStats(e$))}),t$ instanceof Ks&&t$.addListener(H.GET_STATS,r$=>{r$(this.handleGetRemoteAudioStats(e$))})}unbindRemoteTrackEvents(e$){e$&&e$.removeAllListeners(H.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e$=>{let[t$,r$]=e$;r$.has(Q.AUDIO)&&this.unbindRemoteTrackEvents(t$._audioTrack),r$.has(Q.VIDEO)&&this.unbindRemoteTrackEvents(t$._videoTrack)})}createGatewayPublishMessage(e$,t$){return e$.map((r$,n$)=>{var i$;let o$,{track:s$,type:a$}=r$;switch(a$){case U.LocalAudioTrack:o$=Ct.Audio;break;case U.LocalVideoTrack:o$=W(i$=s$._hints).call(i$,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High;break;case U.LocalVideoLowTrack:o$=Ct.Low}return{kind:a$===U.LocalAudioTrack?Q.AUDIO:Q.VIDEO,stream_type:o$,mid:t$[n$].id,ssrcs:t$[n$].localSSRC,isMuted:s$.muted||!s$.enabled}})}createGatewayUnpublishMessage(e$){return e$.map(t$=>{var r$;let n$,[i$,{track:o$,ssrcs:s$,id:a$}]=t$;switch(i$){case U.LocalVideoTrack:n$=W(r$=o$._hints).call(r$,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High;break;case U.LocalAudioTrack:n$=Ct.Audio;break;case U.LocalVideoLowTrack:n$=Ct.Low}return{stream_type:n$,ssrcs:s$,mid:a$}})}assignLocalTracks(e$,t$){e$.forEach((r$,n$)=>{let{track:i$,type:o$}=r$;this.localTrackMap.set(o$,{track:i$,id:t$[n$].id,ssrcs:t$[n$].localSSRC})})}withdrawLocalTracks(e$){e$.forEach(t$=>{let[r$]=t$;this.localTrackMap.delete(r$)})}bindConnectionEvents(e$){e$.onConnectionStateChange=async t$=>{var r$;_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e$.name,".onConnectionStateChange(").concat(t$,")")),this.emit(tt.PeerConnectionStateChange,t$),t$!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t$==="connected"&&(e$.isInRestartIce=!1),W(r$=this._restartStates).call(r$,t$)&&!e$.isInRestartIce&&(t$==="disconnected"&&await Me(800),e$.iceConnectionState!=="disconnected"&&e$.iceConnectionState!=="failed"||this.handleDisconnect(e$.direction))},e$.onICEConnectionStateChange=t$=>{t$!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t$,")")),X.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t$,tag:Zt.TRACER}).onSuccess(),this.emit(tt.IceConnectionStateChange,t$)},e$.onICETransportStateChange=t$=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t$,")"))},e$.onDTLSTransportStateChange=t$=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t$,")"))},e$.onDTLSTransportError=t$=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t$,")"))},e$.onFirstAudioDecoded=t$=>{var r$;let n$=Array.from(xn(r$=this.remoteUserMap).call(r$)).find(o$=>o$._audioSSRC===t$);var i$;n$&&(this.store.subscribe(n$.uid,"audio",void 0,void 0,void 0,Date.now()),(i$=n$.audioTrack)===null||i$===void 0||i$.emit(Ws.FIRST_FRAME_DECODED),X.firstRemoteFrame(this.store.sessionId,De.FIRST_AUDIO_DECODE,Jt.FIRST_AUDIO_DECODE,{peer:n$._uintid,subscribeElapse:qe.measureFromSubscribeStart(this.store.clientId,t$),subscribeRequestid:t$,p2pid:this.store.p2pId}))},e$.onFirstAudioReceived=t$=>{var r$;let n$=Array.from(xn(r$=this.remoteUserMap).call(r$)).find(i$=>i$._audioSSRC===t$);n$&&X.firstRemoteFrame(this.store.sessionId,De.FIRST_AUDIO_RECEIVED,Jt.FIRST_AUDIO_RECEIVED,{peer:n$._uintid,subscribeElapse:qe.measureFromSubscribeStart(this.store.clientId,t$),subscribeRequestid:t$,p2pid:this.store.p2pId})},e$.onFirstVideoDecoded=(t$,r$,n$)=>{this.reportVideoFirstFrameDecoded(t$,r$,n$)},e$.onFirstVideoReceived=t$=>{var r$;let n$=Array.from(xn(r$=this.remoteUserMap).call(r$)).find(i$=>i$._videoSSRC===t$);n$&&X.firstRemoteFrame(this.store.sessionId,De.FIRST_VIDEO_RECEIVED,Jt.FIRST_VIDEO_RECEIVED,{peer:n$._uintid,subscribeElapse:qe.measureFromSubscribeStart(this.store.clientId,t$),subscribeRequestid:t$,p2pid:this.store.p2pId})},e$.onSelectedLocalCandidateChanged=(t$,r$)=>{let n$=t$.candidateType==="relay",i$=r$.candidateType==="relay";r$.candidateType!=="unknown"&&n$===i$||this.emit(tt.ConnectionTypeChange,n$),_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(eo(r$))," -> ").concat(JSON.stringify(eo(t$)),")"))},e$.onSelectedRemoteCandidateChanged=(t$,r$)=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(eo(r$))," -> ").concat(JSON.stringify(eo(t$)),")"))},e$.onFirstVideoDecodedTimeout=t$=>{this.reportVideoFirstFrameDecoded(t$,void 0,void 0,!0)},e$.onLocalCandidate=t$=>{this.emit(tt.LocalCandidate,{candidate:t$,direction:e$.direction})}}unbindConnectionEvents(e$){e$.onConnectionStateChange=void 0,e$.onICEConnectionStateChange=void 0,e$.onICETransportStateChange=void 0,e$.onDTLSTransportStateChange=void 0,e$.onDTLSTransportError=void 0,e$.onFirstAudioDecoded=void 0,e$.onFirstAudioReceived=void 0,e$.onFirstVideoDecoded=void 0,e$.onFirstVideoReceived=void 0,e$.onSelectedLocalCandidateChanged=void 0,e$.onSelectedRemoteCandidateChanged=void 0,e$.onFirstVideoDecodedTimeout=void 0,e$.onLocalCandidate=void 0}async handleDisconnect(e$){let t$=e$===cn.SEND_ONLY?this.sendConnection:this.recvConnection;t$&&!t$.isInRestartIce&&(t$.isInRestartIce=!0,_.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t$.name,"] start use restartICE")),e$===cn.SEND_ONLY?this.restartICE(e$):Ge(this,tt.RequestP2PRestartICE,{direction:cn.SEND_ONLY}))}filterTobeMutedTracks(e$){let t$=[];if(this.getAllTracks().indexOf(e$)===-1)return t$;let r$=this.localTrackMap.get(U.LocalAudioTrack);if(e$ instanceof Qt&&(r$==null?void 0:r$.track)instanceof ge)return r$.track.isActive||t$.push([U.LocalAudioTrack,r$]),t$;let n$=Array.from(this.localTrackMap.entries()).find(i$=>{let[,{track:o$}]=i$;return e$===o$});if(n$&&(t$.push(n$),n$[0]===U.LocalVideoTrack)){let i$=this.localTrackMap.get(U.LocalVideoLowTrack);i$&&t$.push([U.LocalVideoLowTrack,i$])}return t$}filterTobeUnmutedTracks(e$){let t$=[],r$=this.localTrackMap.get(U.LocalAudioTrack);if(e$ instanceof Qt&&(r$==null?void 0:r$.track)instanceof ge)return r$.track.isActive&&t$.push([U.LocalAudioTrack,r$]),t$;let n$=Array.from(this.localTrackMap.entries()).find(i$=>{let[,{track:o$}]=i$;return e$===o$});if(n$)if(n$[0]===U.LocalVideoTrack){t$.push(n$);let i$=this.localTrackMap.get(U.LocalVideoLowTrack);i$&&t$.push([U.LocalVideoLowTrack,i$])}else t$.push(n$);return t$}createMuteMessage(e$){return e$.map(t$=>{var r$;let n$,[i$,{track:o$,ssrcs:s$,id:a$}]=t$;switch(i$){case U.LocalAudioTrack:n$=Ct.Audio;break;case U.LocalVideoTrack:n$=W(r$=o$._hints).call(r$,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High;break;case U.LocalVideoLowTrack:n$=Ct.Low}return{stream_type:n$,ssrcs:s$,mid:a$}})}createUnmuteMessage(e$){return e$.map(t$=>{var r$;let n$,[i$,{track:o$,ssrcs:s$,id:a$}]=t$;switch(i$){case U.LocalAudioTrack:n$=Ct.Audio;break;case U.LocalVideoTrack:n$=W(r$=o$._hints).call(r$,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High;break;case U.LocalVideoLowTrack:n$=Ct.Low}return{stream_type:n$,ssrcs:s$,mid:a$}})}filterTobeUnSubscribedTracks(e$,t$){let r$=[],n$=this.remoteUserMap.get(e$);if(!n$)return r$;if(t$){let i$=n$.get(t$);if(!i$)return r$;r$.push([e$,{kind:t$,id:i$}])}else Array.from(n$.entries()).forEach(i$=>{let[o$,s$]=i$;r$.push([e$,{kind:o$,id:s$}])});return r$}createUnsubscribeMessage(e$){let t$=[];return e$.forEach(r$=>{let[n$,{kind:i$,id:o$}]=r$;switch(i$){case Q.VIDEO:return void(n$._videoSSRC&&t$.push({stream_type:Q.VIDEO,ssrcId:n$._videoSSRC}));case Q.AUDIO:return void(n$._audioSSRC&&t$.push({stream_type:Q.AUDIO,ssrcId:n$._audioSSRC}))}}),t$}withdrawRemoteTracks(e$){e$.forEach(t$=>{let[r$,{kind:n$}]=t$,i$=this.remoteUserMap.get(r$);i$&&(i$.delete(n$),Array.from(i$.entries()).length===0&&this.remoteUserMap.delete(r$))})}async updateBitrateLimit(e$){let t$=this.localTrackMap.get(U.LocalVideoTrack),r$=this.localTrackMap.get(U.LocalVideoLowTrack);t$&&await t$.track.setBitrateLimit(e$.uplink),r$&&e$.low_stream_uplink&&await r$.track.setBitrateLimit({max_bitrate:e$.low_stream_uplink.bitrate,min_bitrate:e$.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e$=this.sendConnection.peerConnectionState,t$=this.recvConnection.peerConnectionState;return e$!=="connected"&&t$!=="connected"}return!0}async tryToUnmuteAudio(e$){for(let t$=0;t$<e$.length;t$++)if(e$[t$]instanceof Qt){let r$=this.filterTobeUnmutedTracks(e$[t$]);if(r$.length===0)continue;let n$=this.createUnmuteMessage(r$);return void await kt(this,tt.RequestUnmuteLocal,n$)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e$=>this.getStats(e$),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e$=>{let[,{ssrcs:t$}]=e$;return!!t$}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e$=>{var t$;return!((t$=this.recvConnection)===null||t$===void 0||!t$.getRemoteVideoIsReady(e$))},this.statsUploader.requestUpload=(e$,t$)=>this.emit(tt.RequestUpload,e$,t$),this.statsUploader.requestUploadStats=e$=>this.emit(tt.RequestUploadStats,e$),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Me(hf(this.dtlsFailedCount,Ee)),this.emit(tt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(U.LocalVideoTrack)||this.pendingLocalTracks.some(e$=>e$ instanceof Ft)}throwIfTrackTypeNotMatch(e$){if(e$.filter(t$=>t$ instanceof Ft).length>1)throw new N(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e$.filter(t$=>t$ instanceof Qt).length>1&&(e$.some(t$=>t$ instanceof Qt&&t$._bypassWebAudio)||!ft().webAudioMediaStreamDest))throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t$ of e$){if(t$ instanceof Ft&&this.pendingLocalTracks.some(r$=>r$ instanceof Ft))throw new N(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t$ instanceof Qt&&this.pendingLocalTracks.some(r$=>r$ instanceof Qt)&&(!ft().webAudioMediaStreamDest||t$._bypassWebAudio||this.pendingLocalTracks.some(r$=>r$ instanceof Qt&&r$._bypassWebAudio)))throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e$,t$){let r$=!v("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding,n$=Yd(Yd({},{width:160,height:120,framerate:15,bitrate:50}),t$),i$;i$=r$?e$._mediaStreamTrack.clone():dm(e$,n$);let o$=Ut(8,"track-low-"),s$=new Ft(i$,Yd(Yd({},r$&&{scaleResolutionDownBy:GE(n$,e$)}),{},{frameRate:n$.framerate,bitrateMax:n$.bitrate,bitrateMin:n$.bitrate}),void 0,void 0,o$);return s$.on(Ko.TRANSCEIVER_UPDATED,a$=>{e$._updateRtpTransceiver(a$,na.LOW_STREAM)}),s$._hints.push(Gt.LOW_STREAM),e$.addListener(H.NEED_CLOSE,()=>{s$.close()}),s$}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e$,t$,r$,n$){var i$;let o$=Array.from(xn(i$=this.remoteUserMap).call(i$)).find(s$=>s$._videoSSRC===e$);if(o$){n$||this.store.subscribe(o$.uid,"video",void 0,void 0,void 0,void 0,Date.now());let s$=this.store.keyMetrics,a$=s$.subscribe.find(c$=>c$.userId===o$.uid&&c$.type==="video");X.firstRemoteVideoDecode(this.store.sessionId,De.FIRST_VIDEO_DECODE,Jt.FIRST_VIDEO_DECODE,{peer:o$._uintid,videowidth:t$,videoheight:r$,subscribeElapse:qe.measureFromSubscribeStart(this.store.clientId,e$),subscribeRequestid:e$,p2pid:this.store.p2pId,apEnd:s$.requestAPEnd||0,apStart:s$.requestAPStart||0,joinGwEnd:s$.joinGatewayEnd||0,joinGwStart:s$.joinGatewayStart||0,pcEnd:s$.peerConnectionEnd||0,pcStart:s$.peerConnectionStart||0,subscriberEnd:(a$==null?void 0:a$.subscribeEnd)||0,subscriberStart:(a$==null?void 0:a$.subscribeStart)||0,videoAddNotify:(a$==null?void 0:a$.streamAdded)||0,state:n$?1:0})}}async remoteMediaSsrcChanged(e$,t$,r$){if(!this.recvConnection)return!1;let n$=this.remoteUserMap.get(e$);if(!n$)return!1;let i$=n$.get(t$);if(!i$)return!1;let o$=await this.recvConnection.getRemoteSSRC(i$);return o$!==void 0&&o$!==r$}isPreSubScribe(e$){return!1}async publishDataChannel(e$){throw new N(R.NOT_SUPPORTED)}async unpublishDataChannel(e$){throw new N(R.NOT_SUPPORTED)}async subscribeDataChannel(e$,t$){throw new N(R.NOT_SUPPORTED)}async unsubscribeDataChannel(e$,t$){throw new N(R.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e$,t$){throw new N(R.NOT_SUPPORTED)}setPendingRemoteDataChannel(e$,t$){throw new N(R.NOT_SUPPORTED)}async preConnect(e$){throw new N(R.NOT_SUPPORTED)}getEstablishParams(){throw new N(R.NOT_SUPPORTED)}async reSubscribe(e$){throw new N(R.NOT_SUPPORTED)}async updateVideoStreamParameter(e$,t$){throw new N(R.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e$=>{let[t$,{track:r$}]=e$;t$===U.LocalVideoLowTrack?r$._updateRtpTransceiver(void 0,na.LOW_STREAM):r$._updateRtpTransceiver(void 0)})}},q(Ht.prototype,"p2pConnect",[Tv],Object.getOwnPropertyDescriptor(Ht.prototype,"p2pConnect"),Ht.prototype),q(Ht.prototype,"unpublish",[Sv],Object.getOwnPropertyDescriptor(Ht.prototype,"unpublish"),Ht.prototype),q(Ht.prototype,"unpublishLowStream",[Rv],Object.getOwnPropertyDescriptor(Ht.prototype,"unpublishLowStream"),Ht.prototype),q(Ht.prototype,"subscribe",[Cv],Object.getOwnPropertyDescriptor(Ht.prototype,"subscribe"),Ht.prototype),q(Ht.prototype,"mockSubscribe",[Iv],Object.getOwnPropertyDescriptor(Ht.prototype,"mockSubscribe"),Ht.prototype),q(Ht.prototype,"unsubscribe",[vv],Object.getOwnPropertyDescriptor(Ht.prototype,"unsubscribe"),Ht.prototype),q(Ht.prototype,"muteRemote",[yv],Object.getOwnPropertyDescriptor(Ht.prototype,"muteRemote"),Ht.prototype),q(Ht.prototype,"unmuteRemote",[Av],Object.getOwnPropertyDescriptor(Ht.prototype,"unmuteRemote"),Ht.prototype),q(Ht.prototype,"hasRemoteMediaWithLock",[bv],Object.getOwnPropertyDescriptor(Ht.prototype,"hasRemoteMediaWithLock"),Ht.prototype),q(Ht.prototype,"disconnectForReconnect",[wv],Object.getOwnPropertyDescriptor(Ht.prototype,"disconnectForReconnect"),Ht.prototype),q(Ht.prototype,"remoteMediaSsrcChanged",[Ov],Object.getOwnPropertyDescriptor(Ht.prototype,"remoteMediaSsrcChanged"),Ht.prototype),Ht);function Pi(e$){return function(t$,r$,n$){let i$=t$[r$];if(typeof i$!="function")throw new Error("Cannot use mutex on object property.");return n$.value=async function(){for(var o$=arguments.length,s$=new Array(o$),a$=0;a$<o$;a$++)s$[a$]=arguments[a$];switch(e$){case Ui.SEND_ONLY:{let c$=await this.sendMutex.lock("From P2PChannel2.".concat(r$));try{return await i$.apply(this,s$)}finally{c$()}}case Ui.RECEIVE_ONLY:{let c$=await this.recvMutex.lock("From P2PChannel2.".concat(r$));try{return await i$.apply(this,s$)}finally{c$()}}default:{let c$=await this.sendMutex.lock("From P2PChannel2.".concat(r$)),u$=await this.recvMutex.lock("From P2PChannel2.".concat(r$));try{return await i$.apply(this,s$)}finally{c$(),u$()}}}},n$}}function Dv(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function wo(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?Dv(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):Dv(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var _u=class v5{constructor(t$){T(this,"store",void 0),T(this,"onStatsException",void 0),T(this,"onUploadPublishDuration",void 0),T(this,"onStatsChanged",void 0),T(this,"localStats",new Map),T(this,"remoteStats",new Map),T(this,"updateStatsInterval",void 0),T(this,"trafficStats",void 0),T(this,"trafficStatsPeerList",[]),T(this,"uplinkStats",void 0),T(this,"exceptionMonitor",void 0),T(this,"p2pChannel",void 0),T(this,"scalabilityMode",xE.L1T1),T(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t$,this.exceptionMonitor=new rm,this.exceptionMonitor.on("exception",(r$,n$,i$)=>{this.onStatsException&&this.onStatsException(r$,n$,i$)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(U.LocalAudioTrack)||wo({},KE)}getLocalVideoTrackStats(){return this.localStats.get(U.LocalVideoTrack)||wo({},YE)}getRemoteAudioTrackStats(t$){let r$=(o$,s$)=>{if(!this.trafficStats)return s$;let a$=this.trafficStats.peer_delay.find(c$=>c$.peer_uid===o$);return a$&&(s$.publishDuration=a$.B_ppad+(Date.now()-this.trafficStats.timestamp)),s$},n$={};if(t$){var i$;let o$=(i$=this.remoteStats.get(t$))===null||i$===void 0?void 0:i$.audioStats;o$&&(n$[t$]=r$(t$,o$))}else Array.from(this.remoteStats.entries()).forEach(o$=>{let[s$,{audioStats:a$}]=o$;a$&&(n$[s$]=r$(s$,a$))});return n$}getRemoteNetworkQualityStats(t$){let r$={};if(t$){var n$;let i$=(n$=this.remoteStats.get(t$))===null||n$===void 0?void 0:n$.networkStats;i$&&(r$[t$]=i$)}else Array.from(this.remoteStats.entries()).forEach(i$=>{let[o$,{networkStats:s$}]=i$;s$&&(r$[o$]=s$)});return r$}getRemoteVideoTrackStats(t$){let r$=(o$,s$)=>{if(!this.trafficStats)return s$;let a$=this.trafficStats.peer_delay.find(c$=>c$.peer_uid===o$);return a$&&(s$.publishDuration=a$.B_ppvd+(Date.now()-this.trafficStats.timestamp)),s$},n$={};if(t$){var i$;let o$=(i$=this.remoteStats.get(t$))===null||i$===void 0?void 0:i$.videoStats;o$&&(n$[t$]=r$(t$,o$))}else Array.from(this.remoteStats.entries()).forEach(o$=>{let[s$,{videoStats:a$}]=o$;a$&&(n$[s$]=r$(s$,a$))});return n$}getRTCStats(){let t$=0,r$=0,n$=0,i$=0,o$=this.localStats.get(U.LocalAudioTrack);o$&&(t$+=o$.sendBytes,r$+=o$.sendBitrate);let s$=this.localStats.get(U.LocalVideoTrack);s$&&(t$+=s$.sendBytes,r$+=s$.sendBitrate);let a$=this.localStats.get(U.LocalVideoLowTrack);a$&&(t$+=a$.sendBytes,r$+=a$.sendBitrate),this.remoteStats.forEach(u$=>{let{audioStats:l$,videoStats:d$}=u$;l$&&(n$+=l$.receiveBytes,i$+=l$.receiveBitrate),d$&&(n$+=d$.receiveBytes,i$+=d$.receiveBitrate)});let c$=1;return this.trafficStats&&(c$+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:c$,SendBitrate:r$,SendBytes:t$,RecvBytes:n$,RecvBitrate:i$,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t$){this.localStats.set(t$,void 0)}removeLocalStats(t$){t$?this.localStats.delete(t$):this.localStats.clear()}addRemoteStats(t$){this.remoteStats.set(t$,{})}removeRemoteStats(t$){t$?this.remoteStats.delete(t$):this.remoteStats.clear()}addP2PChannel(t$){this.p2pChannel=t$}updateTrafficStats(t$){t$.peer_delay=t$.peer_delay.filter(r$=>r$.B_ppad!==void 0||r$.B_ppvd!==void 0),t$.peer_delay.filter(r$=>this.trafficStatsPeerList.indexOf(r$.peer_uid)===-1).forEach(r$=>{var n$;let i$=(n$=this.p2pChannel)===null||n$===void 0?void 0:n$.getRemoteMedia(r$.peer_uid),o$=i$!=null&&i$.videoSSRC?qe.measureFromSubscribeStart(this.store.clientId,i$.videoSSRC):0,s$=i$!=null&&i$.audioSSRC?qe.measureFromSubscribeStart(this.store.clientId,i$.audioSSRC):0;r$.B_ppad!==void 0&&r$.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r$.peer_uid,r$.B_ppad,r$.B_ppvd,o$>s$?o$:s$),this.trafficStatsPeerList.push(r$.peer_uid))}),this.trafficStats=t$}updateUplinkStats(t$){this.uplinkStats&&this.uplinkStats.B_fir!==t$.B_fir&&_.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t$.B_fir)),this.uplinkStats=t$}static isRemoteVideoFreeze(t$,r$,n$){if(!t$)return!1;let i$=!!n$&&r$.framesDecodeFreezeTime>n$.framesDecodeFreezeTime,o$=!n$||r$.framesDecodeCount>n$.framesDecodeCount;return i$||!o$}static isRemoteAudioFreeze(t$){return!!t$&&t$._isFreeze()}isLocalVideoFreeze(t$){return!(!t$.inputFrame||!t$.sentFrame)&&t$.inputFrame.frameRate>5&&t$.sentFrame.frameRate<3}updateLocalStats(t$){Array.from(this.localStats.entries()).forEach(r$=>{let[n$,i$]=r$;switch(n$){case U.LocalVideoTrack:case U.LocalVideoLowTrack:{let s$=i$,a$=wo({},YE),c$=t$.getStats(),u$=t$.getLocalMedia(n$);if(c$){let l$=c$.videoSend.find(d$=>d$.ssrc===(u$==null?void 0:u$.ssrcs[0].ssrcId));if(l$){let d$=t$.getLocalVideoSize(),h$=t$.getEncoderConfig(U.LocalVideoTrack);l$.codec!=="H264"&&l$.codec!=="H265"&&l$.codec!=="VP8"&&l$.codec!=="VP9"&&l$.codec!=="AV1X"&&l$.codec!=="AV1"||(a$.codecType=l$.codec),a$.sendBytes=l$.bytes,a$.sendBitrate=s$?8*Math.max(0,a$.sendBytes-s$.sendBytes):0,l$.inputFrame?(a$.captureFrameRate=l$.inputFrame.frameRate,a$.captureResolutionHeight=l$.inputFrame.height,a$.captureResolutionWidth=l$.inputFrame.width):d$&&(a$.captureResolutionWidth=d$.width,a$.captureResolutionHeight=d$.height),l$.sentFrame?(a$.sendFrameRate=l$.sentFrame.frameRate,a$.sendResolutionHeight=l$.sentFrame.height,a$.sendResolutionWidth=l$.sentFrame.width):d$&&(a$.sendResolutionWidth=d$.width,a$.sendResolutionHeight=d$.height),l$.avgEncodeMs&&(a$.encodeDelay=l$.avgEncodeMs),h$&&h$.bitrateMax&&(a$.targetSendBitrate=1e3*h$.bitrateMax),a$.sendPackets=l$.packets,a$.sendPacketsLost=l$.packetsLost,a$.sendJitterMs=l$.jitterMs,a$.sendRttMs=l$.rttMs,a$.totalDuration=s$?s$.totalDuration+1:1,a$.totalFreezeTime=s$?s$.totalFreezeTime:0,this.isLocalVideoFreeze(l$)&&(a$.totalFreezeTime+=1),l$.scalabilityMode&&this.scalabilityMode!==l$.scalabilityMode&&(_.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(l$.scalabilityMode)),this.scalabilityMode=l$.scalabilityMode)}this.trafficStats&&(a$.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o$;this.localStats.set(n$,a$),((s$==null?void 0:s$.sendResolutionWidth)!==a$.sendResolutionWidth||(s$==null?void 0:s$.sendResolutionHeight)!==a$.sendResolutionHeight)&&((o$=this.onStatsChanged)===null||o$===void 0||o$.call(this,"resolution",{width:a$.sendResolutionWidth,height:a$.sendResolutionHeight})),a$&&u$&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,u$.track,a$);break}case U.LocalAudioTrack:{let s$=i$,a$=wo({},KE),c$=t$.getStats(),u$=t$.getLocalMedia(n$);if(c$){let l$=c$.audioSend.find(d$=>d$.ssrc===(u$==null?void 0:u$.ssrcs[0].ssrcId));if(l$){if(l$.codec!=="opus"&&l$.codec!=="aac"&&l$.codec!=="PCMU"&&l$.codec!=="PCMA"&&l$.codec!=="G722"||(a$.codecType=l$.codec),l$.inputLevel)a$.sendVolumeLevel=Math.round(32767*l$.inputLevel);else{let d$=t$.getLocalAudioVolume();d$&&(a$.sendVolumeLevel=Math.round(32767*d$))}a$.sendBytes=l$.bytes,a$.sendPackets=l$.packets,a$.sendPacketsLost=l$.packetsLost,a$.sendJitterMs=l$.jitterMs,a$.sendRttMs=l$.rttMs,a$.sendBitrate=s$?8*Math.max(0,a$.sendBytes-s$.sendBytes):0}}this.trafficStats&&(a$.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(U.LocalAudioTrack,a$),a$&&u$&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,u$.track,a$);break}}})}updateRemoteStats(t$){Array.from(this.remoteStats.entries()).forEach(r$=>{var n$,i$;let[o$,{videoStats:s$,audioStats:a$,videoPcStats:c$}]=r$,u$=a$,l$=s$,d$=c$,h$=wo({},GO),p$=wo({},WO),_$=wo({},kG),{audioTrack:f$,videoTrack:m$,audioSSRC:g$,videoSSRC:v$}=t$.getRemoteMedia(o$),y$;y$=t$ instanceof An?t$.getStats(!0):t$.getStats();let S$=(n$=y$)===null||n$===void 0?void 0:n$.audioRecv.find(C$=>C$.ssrc===g$),b$=(i$=y$)===null||i$===void 0?void 0:i$.videoRecv.find(C$=>C$.ssrc===v$),$$=this.trafficStats&&this.trafficStats.peer_delay.find(C$=>C$.peer_uid===o$);if(S$&&(S$.codec!=="opus"&&S$.codec!=="aac"&&S$.codec!=="PCMU"&&S$.codec!=="PCMA"&&S$.codec!=="G722"||(h$.codecType=S$.codec),S$.outputLevel?h$.receiveLevel=Math.round(32767*S$.outputLevel):f$&&(h$.receiveLevel=Math.round(32767*f$.getVolumeLevel())),h$.receiveBytes=S$.bytes,h$.receivePackets=S$.packets,h$.receivePacketsLost=S$.packetsLost,h$.receivePacketsDiscarded=S$.packetsDiscarded,h$.packetLossRate=h$.receivePacketsLost/(h$.receivePackets+h$.receivePacketsLost),h$.receiveBitrate=u$?8*Math.max(0,h$.receiveBytes-u$.receiveBytes):0,h$.totalDuration=u$?u$.totalDuration+1:1,h$.totalFreezeTime=u$?u$.totalFreezeTime:0,h$.freezeRate=h$.totalFreezeTime/h$.totalDuration,h$.receiveDelay=S$.jitterBufferMs,h$.totalDuration>10&&v5.isRemoteAudioFreeze(f$)&&(h$.totalFreezeTime+=1)),b$){b$.codec!=="H264"&&b$.codec!=="H265"&&b$.codec!=="VP8"&&b$.codec!=="VP9"&&b$.codec!=="AV1X"&&b$.codec!=="AV1"||(p$.codecType=b$.codec),p$.receiveBytes=b$.bytes,p$.receiveBitrate=l$?8*Math.max(0,p$.receiveBytes-l$.receiveBytes):0,p$.decodeFrameRate=b$.decodeFrameRate<0?0:b$.decodeFrameRate,p$.renderFrameRate=b$.decodeFrameRate<0?0:b$.decodeFrameRate,b$.outputFrame&&(p$.renderFrameRate=b$.outputFrame.frameRate),b$.receivedFrame?(p$.receiveFrameRate=b$.receivedFrame.frameRate,p$.receiveResolutionHeight=b$.receivedFrame.height,p$.receiveResolutionWidth=b$.receivedFrame.width):m$&&(p$.receiveResolutionHeight=m$._videoHeight||0,p$.receiveResolutionWidth=m$._videoWidth||0),b$.framesRateFirefox!==void 0&&(p$.receiveFrameRate=Math.round(b$.framesRateFirefox)),p$.receivePackets=b$.packets,p$.receivePacketsLost=b$.packetsLost,p$.packetLossRate=p$.receivePacketsLost/(p$.receivePackets+p$.receivePacketsLost),p$.totalDuration=l$?l$.totalDuration+1:1,p$.totalFreezeTime=l$?l$.totalFreezeTime:0,p$.receiveDelay=b$.jitterBufferMs||0;let C$=!!v$&&t$.getRemoteVideoIsReady(v$);m$&&C$&&v5.isRemoteVideoFreeze(m$,b$,d$)&&(p$.totalFreezeTime+=1),p$.freezeRate=p$.totalFreezeTime/p$.totalDuration}$$&&(h$.end2EndDelay=$$.B_ad,p$.end2EndDelay=$$.B_vd,h$.transportDelay=$$.B_ed,p$.transportDelay=$$.B_ed,h$.currentPacketLossRate=$$.B_ealr4/100,p$.currentPacketLossRate=$$.B_evlr4/100,_$.uplinkNetworkQuality=$$.B_punq?$$.B_punq:0,_$.downlinkNetworkQuality=$$.B_pdnq?$$.B_pdnq:0),this.remoteStats.set(o$,{audioStats:h$,videoStats:p$,videoPcStats:b$,networkStats:_$}),f$&&this.exceptionMonitor.setRemoteAudioStats(f$,h$),m$&&this.exceptionMonitor.setRemoteVideoStats(m$,p$)})}},Eu=class{constructor(){T(this,"destChannelMediaInfos",new Map),T(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e$){MR(e$),this.srcChannelMediaInfo=e$}addDestChannelInfo(e$){MR(e$),this.destChannelMediaInfos.set(e$.channelName,e$)}removeDestChannelInfo(e$){Xu(e$),this.destChannelMediaInfos.delete(e$)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}};function Pv(e$){if(!(e$ instanceof Eu))return new O(R.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t$=e$.getSrcChannelMediaInfo(),r$=e$.getDestChannelMediaInfo();if(!t$)return new O(R.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(r$.size===0)return new O(R.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}function kv(e$){var t$={},r$=!1;function n$(i$,o$){return r$=!0,{done:!1,value:new Of(o$=new om(function(s$){s$(e$[i$](o$))}),1)}}return t$[Ds!==void 0&&zw||"@@iterator"]=function(){return this},t$.next=function(i$){return r$?(r$=!1,i$):n$("next",i$)},typeof e$.throw=="function"&&(t$.throw=function(i$){if(r$)throw r$=!1,i$;return n$("throw",i$)}),typeof e$.return=="function"&&(t$.return=function(i$){return r$?(r$=!1,i$):n$("return",i$)}),t$}var hW=ae(p0);function Lv(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function Mv(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?Lv(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):Lv(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var Pt;function Uv(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function qd(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?Uv(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):Uv(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var Va=(Pt=class p5 extends Yl{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t$=>t$.rtpMap&&t$.rtpMap.encodingName.toLowerCase()||"").filter(t$=>{var r$;return W(r$=Object.keys(Ju)).call(r$,t$)}))]}constructor(t$,r$){super(t$,r$),T(this,"store",void 0),T(this,"peerConnection",void 0),T(this,"remoteSDP",void 0),T(this,"initialOffer",void 0),T(this,"statsFilter",void 0),T(this,"useRTX",!1),T(this,"localCapabilities",void 0),T(this,"localCandidateCount",0),T(this,"allCandidatesReceived",!1),T(this,"establishPromise",void 0),T(this,"mutex",new ze("P2PConnection-mutex")),this.store=r$,this.peerConnection=new RTCPeerConnection(p5.resolvePCConfiguration(t$),{optional:[{googDscp:!0}]}),this.statsFilter=Nf(this.peerConnection,v("STATS_UPDATE_INTERVAL"),void 0,$t()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let t$=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t$.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r$=io(t$.sdp),n$=Lc(t$.sdp,{filterRTX:!this.useRTX,filterVideoFec:v("FILTER_VIDEO_FEC"),filterAudioFec:v("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n$,this.initialOffer=t$,qd(qd({},r$),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n$},offerSDP:t$.sdp})}catch(t$){throw new N(R.GET_LOCAL_CONNECTION_PARAMS_FAILED,t$.toString())}}async updateRemoteConnect(){}async connect(t$){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(n$){T(this,"sessionDesc",void 0),T(this,"localCapabilities",void 0),T(this,"rtpCapabilities",void 0),T(this,"candidates",void 0),T(this,"iceParameters",void 0),T(this,"dtlsParameters",void 0),T(this,"setup",void 0),T(this,"currentMidIndex",void 0),T(this,"cname",void 0),n$=le(n$);let{iceParameters:i$,dtlsParameters:o$,candidates:s$,rtpCapabilities:a$,setup:c$,localCapabilities:u$,sdkCodec:l$,cname:d$}=n$,h$=Le.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=a$,this.candidates=s$,this.iceParameters=i$,this.dtlsParameters=o$,this.setup=c$,this.localCapabilities=u$,this.cname=d$;for(let p$=0;p$<h$.mediaDescriptions.length;p$++){let _$=h$.mediaDescriptions[p$];if(_$.attributes.iceUfrag=i$.iceUfrag,_$.attributes.icePwd=i$.icePwd,_$.attributes.fingerprints=o$.fingerprints,_$.attributes.candidates=s$,_$.attributes.setup=c$,_$.media.mediaType==="video"){_$.media.fmts=a$.videoCodecs.map(m$=>m$.payloadType.toString(10));let f$=a$.videoCodecs.filter(m$=>{var g$,v$;return(g$=m$.rtpMap)===null||g$===void 0?void 0:W(v$=g$.encodingName.toLowerCase()).call(v$,l$)});f$.length===0&&(f$=a$.videoCodecs),_$.attributes.payloads=f$,_$.attributes.extmaps=a$.videoExtensions}_$.media.mediaType==="audio"&&(_$.media.fmts=a$.audioCodecs.map(f$=>f$.payloadType.toString(10)),_$.attributes.payloads=a$.audioCodecs,_$.attributes.extmaps=a$.audioExtensions),h$.mediaDescriptions[p$]=this.mungMediaDesc(_$)}this.sessionDesc=h$,this.currentMidIndex=h$.mediaDescriptions.length-1}toString(){return Le.print(this.sessionDesc)}send(n$,i$,o$){let{ssrcs:s$,ssrcGroups:a$}=Lo(i$,this.cname),c$=this.sessionDesc.mediaDescriptions.find(d$=>n$===Q.VIDEO?d$.media.mediaType==="video":d$.media.mediaType==="audio"),u$=s$[0].attributes.label,l$=s$[0].attributes.mslabel;return c$.attributes.ssrcs=c$.attributes.ssrcs.concat(s$),c$.attributes.ssrcGroups=c$.attributes.ssrcGroups.concat(a$),{id:u$,mslabel:l$}}batchSend(n$){return n$.map(i$=>{let{kind:o$,ssrcMsg:s$}=i$;return this.send(o$,s$,void 0)})}stopSending(n$){this.sessionDesc.mediaDescriptions.forEach(i$=>{let o$=[],s$=[],a$=[];i$.attributes.ssrcs.forEach(c$=>{W(n$).call(n$,c$.attributes.label||"")?a$.push(c$):o$.push(c$)}),i$.attributes.ssrcGroups.forEach(c$=>{var u$;W(u$=a$.map(l$=>l$.ssrcId)).call(u$,c$.ssrcIds[0])||s$.push(c$)}),i$.attributes.ssrcs=o$,i$.attributes.ssrcGroups=s$})}mute(n$){let i$=this.sessionDesc.mediaDescriptions.find(o$=>o$.attributes.mid===n$);if(!i$)throw new Error("mediaDescription not found with ".concat(n$," in remote SDP when calling RemoteSDP.mute."));i$.attributes.direction="inactive"}unmute(n$){let i$=this.sessionDesc.mediaDescriptions.find(o$=>o$.attributes.mid===n$);if(!i$)throw new Error("mediaDescription not found with ".concat(n$," in remote SDP when calling RemoteSDP.unmute."));i$.attributes.direction="sendonly"}receive(n$,i$,o$){n$.forEach((s$,a$)=>{let c$=s$._mediaStreamTrack,u$=this.sessionDesc.mediaDescriptions.findIndex(d$=>d$.attributes.mid===c$.kind),l$=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[u$],s$);this.sessionDesc.mediaDescriptions[u$]=l$})}stopReceiving(n$){}updateCandidates(n$){n$===On.TCP?this.candidates.forEach(i$=>{this.candidates.findIndex(o$=>o$.transport==="tcp"&&o$.connectionAddress===i$.connectionAddress&&o$.port===i$.port)===-1&&this.candidates.push(Mv(Mv({},i$),{},{foundation:"tcpcandidate",priority:Number(i$.priority)-1+"",transport:"tcp",port:Number(i$.port)+90+""}))}):this.candidates=this.candidates.filter(i$=>i$.transport!=="tcp");for(let i$ of this.sessionDesc.mediaDescriptions)i$.attributes.candidates=this.candidates}restartICE(n$){n$=le(n$),this.iceParameters=n$,this.sessionDesc.mediaDescriptions.forEach(i$=>{i$.attributes.iceUfrag=n$.iceUfrag,i$.attributes.icePwd=n$.icePwd})}predictReceivingMids(n$){let i$=[];for(let o$=0;o$<n$;o$++)i$.push((this.currentMidIndex+o$+1).toString(10));return i$}mungRecvMediaDsec(n$,i$){let o$=le(n$);return ra(o$,i$),vf(o$,i$),o$}updateRecvMedia(n$,i$){let o$=this.sessionDesc.mediaDescriptions.findIndex(s$=>s$.attributes.mid===n$);if(o$!==-1){let s$=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o$],i$);this.sessionDesc.mediaDescriptions[o$]=s$}}bumpMid(n$){this.currentMidIndex+=n$}updateTrackLabel(n$,i$,o$){let s$=this.sessionDesc.mediaDescriptions.find(c$=>n$===Q.VIDEO?c$.attributes.mid==="video":c$.attributes.mid==="audio");if(s$){let c$=s$.attributes.ssrcs.find(u$=>u$.attributes.label===i$);var a$;c$&&(c$.attributes.label=o$,(a$=c$.attributes.msid)===null||a$===void 0||a$.replace(i$,o$))}}mungMediaDesc(n$){let i$=le(n$);return If(i$),function(o$){let s$=o$.attributes.extmaps.find(a$=>a$.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");s$&&o$.attributes.extmaps.splice(o$.attributes.extmaps.indexOf(s$),1),o$.attributes.payloads.forEach(a$=>{let c$=a$.rtcpFeedbacks.findIndex(u$=>u$.type==="transport-cc");c$!==-1&&a$.rtcpFeedbacks.splice(c$,1)})}(i$),i$}getSSRC(n$){for(let i$ of this.sessionDesc.mediaDescriptions)for(let o$ of i$.attributes.ssrcs)if(o$.attributes.label===n$)return[o$]}}(qd(qd({},t$),{},{rtpCapabilities:t$.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let r$=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r$})}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r$.toString()))}}async updateRemoteRTPCapabilities(t$,r$){throw new N(R.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t$){}send(t$,r$){var n$=this;return Bi(function*(){let i$=yield Tt(n$.mutex.lock());try{if(!n$.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let o$=t$.map(h$=>n$.peerConnection.addTrack(h$._mediaStreamTrack)),s$=yield Tt(n$.peerConnection.createOffer()),a$=Le.parse(s$.sdp),c$=t$.map(h$=>{let p$=h$._mediaStreamTrack,_$=a$.mediaDescriptions.find(f$=>f$.attributes.mid===p$.kind);if(!_$)throw new Error("Cannot extract ssrc from mediaDescription.");return function(f$,m$,g$){let v$=f$.attributes.ssrcs.filter(S$=>S$.attributes.label===m$),y$=f$.attributes.ssrcGroups;if(v$.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(y$&&v$.length>1){let S$=y$.find(b$=>b$.ssrcIds.indexOf(v$[0].ssrcId)!==-1);return S$?[{ssrcId:S$.ssrcIds[0],rtx:g$?S$.ssrcIds[1]:void 0}]:[{ssrcId:v$[0].ssrcId}]}return[{ssrcId:v$[0].ssrcId}]}(_$,p$.id,n$.useRTX)}),u$;try{u$=yield c$}catch(h$){throw o$.forEach(p$=>{je()&&p$.replaceTrack(null),n$.peerConnection.removeTrack(p$)}),h$}let l$=n$.mungSendOfferSDP(s$.sdp,t$);n$.remoteSDP.receive(t$,r$,u$);let d$=n$.remoteSDP.toString();return yield Tt(n$.peerConnection.setLocalDescription({type:"offer",sdp:l$})),yield Tt(n$.applySendEncodings(o$,t$)),yield Tt(n$.peerConnection.setRemoteDescription({type:"answer",sdp:d$})),t$.map((h$,p$)=>{let _$=h$._mediaStreamTrack.id;return{localSSRC:c$[p$],id:_$}})}catch(o$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o$.toString()))}finally{i$()}})()}async stopSending(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let r$=this.peerConnection.getSenders().filter(o$=>{var s$;return t$.indexOf(((s$=o$.track)===null||s$===void 0?void 0:s$.id)||"")!==-1});if(r$.length!==t$.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r$.map(o$=>{je()&&o$.replaceTrack(null),this.peerConnection.removeTrack(o$)});let n$=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n$),this.remoteSDP.stopReceiving(t$);let i$=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i$})}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r$.toString()))}}async receive(t$,r$,n$,i$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t$," before remoteSDP created."));let{id:o$,mslabel:s$}=this.remoteSDP.send(t$,r$,i$),a$=new j((l$,d$)=>{let h$=setTimeout(()=>{d$(new Error("Cannot receive track, id: ".concat(o$)))},1e4),p$=_$=>{let f$=mt();if((f$.name==="Safari"&&Number(f$.version)===11||ln())&&_$.track.id!==o$&&_$.streams[0].id===s$){var m$;let g$=_$.streams[0].getTracks()[0];return(m$=this.remoteSDP)===null||m$===void 0||m$.updateTrackLabel(t$,o$,_$.track.id),this.peerConnection.removeEventListener("track",p$),clearTimeout(h$),void l$(g$)}if(_$.track.id===o$)return this.peerConnection.removeEventListener("track",p$),clearTimeout(h$),void l$(_$.track)};this.peerConnection.addEventListener("track",p$)}),c$=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c$});let u$=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(u$),{track:await a$,id:o$}}catch(o$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o$.toString()))}}async stopReceiving(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t$);let r$=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r$});let n$=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n$)}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r$.toString()))}}async muteRemote(t$){}async unmuteRemote(t$){}async muteLocal(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r$=this.peerConnection.getSenders().filter(n$=>{var i$;return t$.indexOf(((i$=n$.track)===null||i$===void 0?void 0:i$.id)||"")!==-1});if(r$.length!==t$.length)throw new Error("sender' length doesn't match mids' length.");r$.map(n$=>{if(je()&&n$.track)n$.track.enabled=!1;else{let i$=n$.getParameters();i$.encodings.forEach(o$=>o$.active=!1),n$.setParameters(i$)}})}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r$.toString()))}}async unmuteLocal(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r$=this.peerConnection.getSenders().filter(o$=>{var s$;return t$.indexOf(((s$=o$.track)===null||s$===void 0?void 0:s$.id)||"")!==-1});if(r$.length!==t$.length)throw new Error("Senders' length doesn't match mids' length.");r$.map(async o$=>{if(je()&&o$.track)o$.track.enabled=!0;else{let s$=o$.getParameters();s$.encodings.forEach(a$=>a$.active=!0),await o$.setParameters(s$)}});let n$=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n$);let i$=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i$})}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r$.toString()))}}restartICE(t$){var r$=this;return Bi(function*(){let n$=yield Tt(r$.mutex.lock("From P2PConnection.restartICE"));try{if(!r$.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ft().supportPCSetConfiguration){let c$=r$.peerConnection.getConfiguration(),u$=t$===On.RELAY?"relay":"all";c$.iceTransportPolicy!==u$&&(_.debug("[".concat(r$.store.clientId,"] restartICE change iceTransportPolicy from [").concat(c$.iceTransportPolicy,"] to [").concat(u$,"]")),c$.iceTransportPolicy=u$,r$.peerConnection.setConfiguration(c$))}else if(t$===On.RELAY)return;t$!==On.RELAY&&r$.remoteSDP.updateCandidates(t$);let i$=yield Tt(r$.peerConnection.createOffer({iceRestart:!0}));if(!i$.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let o$=io(i$.sdp),{remoteIceParameters:s$}=yield o$.iceParameters;r$.remoteSDP.restartICE(s$);let a$=r$.remoteSDP.toString();yield Tt(r$.peerConnection.setLocalDescription(i$)),yield Tt(r$.peerConnection.setRemoteDescription({type:"answer",sdp:a$}))}catch(i$){_.warning("[".concat(r$.store.clientId,"] restart ICE failed, abort operation"),i$)}finally{n$()}})()}close(){var t$;this.peerConnection.close(),(t$=this.onConnectionStateChange)===null||t$===void 0||t$.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t$){return this.statsFilter.getVideoIsReady(t$)}async updateEncoderConfig(t$,r$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n$=await this.peerConnection.createOffer(),i$=this.mungSendOfferSDP(n$.sdp,[r$]);this.remoteSDP.updateRecvMedia(r$._mediaStreamTrack.kind,r$);let o$=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i$}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o$})}catch(n$){throw new N(R.EXCHANGE_SDP_FAILED,n$.toString())}}async updateSendParameters(t$,r$){let n$=this.peerConnection.getSenders().filter(i$=>{var o$;return((o$=i$.track)===null||o$===void 0?void 0:o$.id)===t$});n$.length===1&&await this.applySendEncodings(n$,[r$])}setStatsRemoteVideoIsReady(t$,r$){this.statsFilter.setVideoIsReady2(t$,r$)}async replaceTrack(t$,r$){let n$=this.peerConnection.getSenders().find(i$=>{var o$;return((o$=i$.track)===null||o$===void 0?void 0:o$.id)===r$});n$&&await n$.replaceTrack(t$._mediaStreamTrack)}createDataChannels(t$,r$){throw new N(R.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t$){throw new N(R.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t$;(t$=this.onICEConnectionStateChange)===null||t$===void 0||t$.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t$;(t$=this.onConnectionStateChange)===null||t$===void 0||t$.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t$=>{t$.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,_.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,_.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},v("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t$){let r$={iceServers:[],sdpSemantics:"plan-b"};return t$.iceServers?r$.iceServers=t$.iceServers:t$.turnServer&&t$.turnServer.mode!=="off"&&(Yu(t$.turnServer.servers)?r$.iceServers=t$.turnServer.servers:(r$.iceServers&&r$.iceServers.push(...p5.turnServerConfigToIceServers(t$.turnServer.servers)),v("USE_TURN_SERVER_OF_GATEWAY")&&r$.iceServers&&t$.turnServer.serversFromGateway&&r$.iceServers.push(...p5.turnServerConfigToIceServers(t$.turnServer.serversFromGateway)),t$.turnServer.servers.concat(t$.turnServer.serversFromGateway||[]).forEach(n$=>{n$.forceturn&&(r$.iceTransportPolicy="relay")}))),r$}static turnServerConfigToIceServers(t$){let r$=[];return t$.forEach(n$=>{n$.security?n$.tcpport&&r$.push({username:n$.username,credential:n$.password,credentialType:"password",urls:"turns:".concat(n$.turnServerURL,":").concat(n$.tcpport,"?transport=tcp")}):(n$.udpport&&r$.push({username:n$.username,credential:n$.password,credentialType:"password",urls:"turn:".concat(n$.turnServerURL,":").concat(n$.udpport,"?transport=udp")}),n$.tcpport&&r$.push({username:n$.username,credential:n$.password,credentialType:"password",urls:"turn:".concat(n$.turnServerURL,":").concat(n$.tcpport,"?transport=tcp")}))}),r$}async updateRtpSenderEncodings(t$,r$){var n$;if(r$||(r$=this.peerConnection.getSenders().find(u$=>{var l$;return((l$=u$.track)===null||l$===void 0?void 0:l$.id)===t$._mediaStreamTrack.id})),!r$)return _.warn("[".concat(t$.getTrackId(),"] no rtpSender found}"));if(!ft().supportSetRtpSenderParameters)return _.warn("Browser not support set rtp-sender parameters");let i$={},o$={};if(t$ instanceof Ft)switch(t$._optimizationMode){case"motion":i$.degradationPreference="maintain-framerate";break;case"detail":i$.degradationPreference="maintain-resolution";break;default:i$.degradationPreference="balanced"}if(v("DSCP_TYPE")&&ho()){var s$;let u$=v("DSCP_TYPE");W(s$=["very-low","low","medium","high"]).call(s$,u$)&&(o$.networkPriority=u$)}let a$=r$.getParameters(),c$=(n$=a$.encodings)===null||n$===void 0?void 0:n$[0];c$&&Object.assign(c$,o$),Object.assign(a$,i$),_.debug("[".concat(t$.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a$.encodings))),await r$.setParameters(a$)}async applySendEncodings(t$,r$){try{if(!ft().supportSetRtpSenderParameters||t$.length!==r$.length)return;for(let n$=0;n$<t$.length;n$++){let i$=t$[n$],o$=r$[n$];i$&&o$&&await this.updateRtpSenderEncodings(o$,i$)}}catch{_.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t$,r$){let n$=Le.parse(t$);return r$.forEach((i$,o$)=>{let s$=i$._mediaStreamTrack,a$=n$.mediaDescriptions.find(c$=>c$.attributes.mid===s$.kind);a$&&ra(a$,i$)}),Le.print(n$)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t$=>{var r$;(r$=this.onFirstAudioReceived)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstVideoReceived=t$=>{var r$;(r$=this.onFirstVideoReceived)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstAudioDecoded=t$=>{var r$;(r$=this.onFirstAudioDecoded)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstVideoDecoded=(t$,r$,n$)=>{var i$;(i$=this.onFirstVideoDecoded)===null||i$===void 0||i$.call(this,t$,r$,n$)},this.statsFilter.onSelectedLocalCandidateChanged=(t$,r$)=>{var n$;(n$=this.onSelectedLocalCandidateChanged)===null||n$===void 0||n$.call(this,t$,r$)},this.statsFilter.onSelectedRemoteCandidateChanged=(t$,r$)=>{var n$;(n$=this.onSelectedRemoteCandidateChanged)===null||n$===void 0||n$.call(this,t$,r$)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let r$=this.remoteSDP.batchSend(t$).map((o$,s$)=>{let{id:a$,mslabel:c$}=o$,{kind:u$}=t$[s$];return new j((l$,d$)=>{let h$=setTimeout(()=>{d$(new Error("Cannot receive track, id: ".concat(a$)))},1e4),p$=_$=>{let f$=mt();if(f$.name==="Safari"&&Number(f$.version)===11&&_$.track.id!==a$&&_$.streams[0].id===c$){var m$;let g$=_$.streams[0].getTracks()[0];return(m$=this.remoteSDP)===null||m$===void 0||m$.updateTrackLabel(u$,a$,_$.track.id),this.peerConnection.removeEventListener("track",p$),clearTimeout(h$),void l$({track:g$,id:a$})}if(_$.track.id===a$)return this.peerConnection.removeEventListener("track",p$),clearTimeout(h$),void l$({track:_$.track,id:a$})};this.peerConnection.addEventListener("track",p$)})}),n$=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n$});let i$=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i$),await j.all(r$)}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r$.toString()))}}async getRemoteSSRC(t$){if(!this.remoteSDP)return;let r$=this.remoteSDP.getSSRC(t$);return r$==null?void 0:r$[0].ssrcId}setConfiguration(t$){if(ft().supportPCSetConfiguration){let r$=p5.resolvePCConfiguration(t$);this.peerConnection.setConfiguration(r$)}}},q(Pt.prototype,"connect",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"connect"),Pt.prototype),q(Pt.prototype,"stopSending",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"stopSending"),Pt.prototype),q(Pt.prototype,"receive",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"receive"),Pt.prototype),q(Pt.prototype,"stopReceiving",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"stopReceiving"),Pt.prototype),q(Pt.prototype,"muteRemote",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"muteRemote"),Pt.prototype),q(Pt.prototype,"unmuteRemote",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"unmuteRemote"),Pt.prototype),q(Pt.prototype,"muteLocal",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"muteLocal"),Pt.prototype),q(Pt.prototype,"unmuteLocal",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"unmuteLocal"),Pt.prototype),q(Pt.prototype,"close",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"close"),Pt.prototype),q(Pt.prototype,"updateEncoderConfig",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"updateEncoderConfig"),Pt.prototype),q(Pt.prototype,"updateSendParameters",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"updateSendParameters"),Pt.prototype),q(Pt.prototype,"replaceTrack",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"replaceTrack"),Pt.prototype),q(Pt.prototype,"getRemoteSSRC",[Jn],Object.getOwnPropertyDescriptor(Pt.prototype,"getRemoteSSRC"),Pt.prototype),Pt);function Jn(e$,t$,r$){let n$=e$[t$];if(typeof n$!="function")throw new Error("Cannot use mutex on object property.");return r$.value=async function(){let i$=this.mutex,o$=await i$.lock("Locking from P2PConnection.".concat(t$));try{for(var s$=arguments.length,a$=new Array(s$),c$=0;c$<s$;c$++)a$[c$]=arguments[c$];return await n$.apply(this,a$)}finally{o$()}},r$}function xv(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function Wr(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?xv(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):xv(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var Fa="9",Vv=4e4,um=class{get localCapabilities(){return le(this._localCapabilities)}get rtpCapabilities(){return le(this._rtpCapabilities)}get candidates(){return le(this._candidates)}get iceParameters(){return le(this._iceParameters)}get dtlsParameters(){return le(this._dtlsParameters)}constructor(e$){T(this,"sessionDesc",void 0),T(this,"_localCapabilities",void 0),T(this,"_rtpCapabilities",void 0),T(this,"_candidates",void 0),T(this,"_iceParameters",void 0),T(this,"_dtlsParameters",void 0),T(this,"setup",void 0),T(this,"currentMidIndex",void 0),T(this,"cname",void 0),T(this,"firefoxSsrcMidMap",new Map),e$=le(e$);let{iceParameters:t$,dtlsParameters:r$,candidates:n$,rtpCapabilities:i$,setup:o$,localCapabilities:s$,cname:a$}=e$;this._rtpCapabilities=i$,this._candidates=n$,this._iceParameters=t$,this._dtlsParameters=r$,this._localCapabilities=s$,this.setup=o$,this.cname=a$,this.sessionDesc=this.updateRemoteRTPCapabilities(i$),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(e$){let t$=this.candidates,r$=this.dtlsParameters,n$=this.iceParameters,i$=this.rtpCapabilities.send,o$=this.sessionDesc.mediaDescriptions.length-1;for(let s$=1;s$<e$;s$++){let a$=2*s$+2e4,c$=2*s$+Vv,{ssrcs:u$,ssrcGroups:l$}=Lo([{ssrcId:a$}],this.cname),{ssrcs:d$,ssrcGroups:h$}=Lo([{ssrcId:c$,rtx:v("USE_SUB_RTX")?c$+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Fa,protos:["UDP","TLS","RTP","SAVPF"],fmts:i$.videoCodecs.map(p$=>p$.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:n$.iceUfrag,icePwd:n$.icePwd,unrecognized:[],candidates:t$,extmaps:i$.videoExtensions,fingerprints:r$.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d$,ssrcGroups:h$,rtcpFeedbackWildcards:[],payloads:i$.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o$)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Fa,protos:["UDP","TLS","RTP","SAVPF"],fmts:i$.audioCodecs.map(p$=>p$.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:n$.iceUfrag,icePwd:n$.icePwd,unrecognized:[],candidates:t$,extmaps:i$.audioExtensions,fingerprints:r$.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u$,ssrcGroups:l$,rtcpFeedbackWildcards:[],payloads:i$.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o$)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Le.print(this.sessionDesc)}send(e$,t$,r$,n$){let{ssrcs:i$,ssrcGroups:o$}=Lo(t$,this.cname,v("SYNC_GROUP")?r$:void 0),s$=this.findPreloadMediaDesc(i$);if(s$){if($t()&&this.firefoxSsrcMidMap.set(i$[0].ssrcId,s$.attributes.mid),n$&&(n$.twcc||n$.remb)){let a$=this.sessionDesc.mediaDescriptions.indexOf(s$);return this.sessionDesc.mediaDescriptions[a$]=this.mungSendMediaDesc(s$,n$),{mid:s$.attributes.mid,needExchangeSDP:!0}}return{mid:s$.attributes.mid,needExchangeSDP:!1}}{let a$=this.findAvailableMediaIndex(e$,i$),c$;return a$===-1||a$===1&&(je()||function(){let u$=mt();return!(u$.name!==It.CHROME||!u$.osVersion)&&Number(u$.version)<=90}())||a$===0&&v("USE_SUB_RTX")||hR()?(c$=this.createOrRecycleSendMedia(e$,i$,o$,"sendonly",n$),this.updateBundleMids()):(c$=le(this.sessionDesc.mediaDescriptions[a$]),c$.attributes.direction="sendonly",c$.attributes.ssrcs=i$,c$.attributes.ssrcGroups=o$,this.sessionDesc.mediaDescriptions[a$]=this.mungSendMediaDesc(c$,n$)),$t()&&this.firefoxSsrcMidMap.set(i$[0].ssrcId,c$.attributes.mid),{mid:c$.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:e$,needExchangeSDP:t$}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e$.attributes.mid,needExchangeSDP:t$}}batchSend(e$){let t$=e$.map(i$=>{let{kind:o$,ssrcMsg:s$,mslabel:a$}=i$;return this.send(o$,s$,a$)}),r$=[],n$=!1;return t$.forEach(i$=>{let{mid:o$,needExchangeSDP:s$}=i$;s$&&(n$=!0),r$.push(o$)}),{mids:r$,needExchangeSDP:n$}}stopSending(e$){let t$=this.sessionDesc.mediaDescriptions.filter(r$=>r$.attributes.mid&&e$.indexOf(r$.attributes.mid)!==-1);if(t$.length!==e$.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t$.forEach(r$=>{r$.attributes.mid==="0"||$t()||hR()?r$.attributes.ssrcs=[]:(r$.attributes.ssrcs=[],r$.attributes.direction="inactive",r$.media.port="0")}),this.updateBundleMids()}mute(e$){let t$=this.sessionDesc.mediaDescriptions.find(r$=>r$.attributes.mid===e$);if(!t$)throw new Error("mediaDescription not found with ".concat(e$," in remote SDP when calling RemoteSDP.mute."));t$.attributes.direction="inactive"}unmute(e$){let t$=this.sessionDesc.mediaDescriptions.find(r$=>r$.attributes.mid===e$);if(!t$)throw new Error("mediaDescription not found with ".concat(e$," in remote SDP when calling RemoteSDP.unmute."));t$.attributes.direction="sendonly"}muteRemote(e$){let t$=this.sessionDesc.mediaDescriptions.filter(r$=>W(e$).call(e$,r$.attributes.mid||""));if(t$.length!==e$.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t$.forEach(r$=>{r$.attributes.direction="inactive"})}unmuteRemote(e$){let t$=this.sessionDesc.mediaDescriptions.filter(r$=>W(e$).call(e$,r$.attributes.mid||""));if(t$.length!==e$.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t$.forEach(r$=>{r$.attributes.direction="recvonly"})}receive(e$,t$,r$,n$){e$.forEach((i$,o$)=>{this.createOrRecycleRecvMedia(i$,[],"recvonly",t$,r$,n$[o$])}),this.updateBundleMids()}stopReceiving(e$){let t$=this.sessionDesc.mediaDescriptions.filter(r$=>e$.indexOf(r$.attributes.mid)!==-1);if(t$.length!==e$.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t$.forEach(r$=>{r$.media.port="0",r$.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e$){let t$=this.sessionDesc||Le.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=e$;let r$=this.rtpCapabilities.send,n$=this.localCapabilities.send;for(let i$ of t$.mediaDescriptions){if(i$.attributes.iceUfrag=this._iceParameters.iceUfrag,i$.attributes.icePwd=this._iceParameters.icePwd,i$.attributes.fingerprints=this._dtlsParameters.fingerprints,i$.attributes.candidates=this._candidates,i$.attributes.setup=this.setup,i$.media.mediaType==="application"&&(i$.attributes.sctpPort="5000"),i$.media.mediaType==="video"){if(r$.videoCodecs.length===0){let o$=n$.videoCodecs.filter(s$=>{var a$,c$;return(a$=s$.rtpMap)===null||a$===void 0?void 0:W(c$=a$.encodingName.toLowerCase()).call(c$,"vp8")})||[n$.videoCodecs[0]];i$.media.fmts=o$.map(s$=>s$.payloadType.toString(10)),i$.attributes.payloads=o$,i$.attributes.extmaps=[]}else if(i$.media.fmts=r$.videoCodecs.map(o$=>o$.payloadType.toString(10)),i$.attributes.payloads=r$.videoCodecs,i$.attributes.extmaps=r$.videoExtensions,v("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:o$,ssrcGroups:s$}=Lo([{ssrcId:Vv,rtx:v("USE_SUB_RTX")?40001:void 0}],this.cname);i$.attributes.ssrcs=o$,i$.attributes.ssrcGroups=s$}}if(i$.media.mediaType==="audio"){if(r$.audioCodecs.length===0){let o$=n$.audioCodecs.filter(s$=>{var a$,c$;return(a$=s$.rtpMap)===null||a$===void 0?void 0:W(c$=a$.encodingName.toLowerCase()).call(c$,"opus")})||[n$.audioCodecs[0]];i$.media.fmts=o$.map(s$=>s$.payloadType.toString(10)),i$.attributes.payloads=o$,i$.attributes.extmaps=[]}else if(i$.media.fmts=r$.audioCodecs.map(o$=>o$.payloadType.toString(10)),i$.attributes.payloads=r$.audioCodecs,i$.attributes.extmaps=r$.audioExtensions,oa(i$),v("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:o$,ssrcGroups:s$}=Lo([{ssrcId:2e4}],this.cname);i$.attributes.ssrcs=o$,i$.attributes.ssrcGroups=s$}}}return this.sessionDesc=t$,this.currentMidIndex=t$.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(e$){let t$=this._candidates.filter(r$=>r$.transport==="udp");if(e$===On.TCP){if(t$.length===0)return;if(v("TCP_CANDIDATE_ONLY")){let r$=this._candidates.filter(n$=>n$.transport==="tcp");t$.forEach(n$=>{r$.findIndex(i$=>i$.connectionAddress===n$.connectionAddress)===-1&&r$.push(Wr(Wr({},n$),{},{foundation:"tcpcandidate",priority:Number(n$.priority)-1+"",transport:"tcp",port:Number(n$.port)+90+""}))}),this._candidates=r$}else{let r$=[];t$.forEach(n$=>{r$.push(Wr(Wr({},n$),{},{foundation:"tcpcandidate",priority:Number(n$.priority)-1+"",transport:"tcp",port:Number(n$.port)+90+""}))}),this._candidates=[...t$,...r$]}}else if(e$===On.RELAY){if(t$.length!==0)return;{let r$=this._candidates.filter(n$=>n$.transport==="tcp");r$.forEach(n$=>{t$.push(Wr(Wr({},n$),{},{foundation:"udpcandidate",priority:Number(n$.priority)+1+"",transport:"udp",port:Number(n$.port)-90+""}))}),this._candidates=[...t$,...r$]}}else t$.length===0?(this._candidates.filter(r$=>r$.transport==="tcp").forEach(r$=>{t$.push(Wr(Wr({},r$),{},{foundation:"udpcandidate",priority:Number(r$.priority)+1+"",transport:"udp",port:Number(r$.port)-90+""}))}),this._candidates=t$):this._candidates=this._candidates.filter(r$=>r$.transport!=="tcp");for(let r$ of this.sessionDesc.mediaDescriptions)r$.attributes.candidates=this.candidates}restartICE(e$){e$=le(e$),this._iceParameters=e$,this.sessionDesc.mediaDescriptions.forEach(t$=>{t$.attributes.iceUfrag=e$.iceUfrag,t$.attributes.icePwd=e$.icePwd})}predictReceivingMids(e$){let t$=[];for(let r$=0;r$<e$;r$++)t$.push((this.currentMidIndex+r$+1).toString(10));return t$}findAvailableMediaIndex(e$,t$){return this.sessionDesc.mediaDescriptions.findIndex(r$=>{let n$=r$.media.mediaType===e$&&r$.media.port!=="0"&&(r$.attributes.direction==="sendonly"||r$.attributes.direction==="sendrecv")&&r$.attributes.ssrcs.length===0;if($t()){if(n$){let i$=this.firefoxSsrcMidMap.get(t$[0].ssrcId);return!(i$||r$.attributes.mid!=="0"&&r$.attributes.mid!=="1")||!(!i$||i$!==r$.attributes.mid)}return!1}return n$})}createOrRecycleDataChannel(){for(let r$ of this.sessionDesc.mediaDescriptions)if(r$.media.mediaType==="application")return{mediaDesc:r$,needExchangeSDP:!1};this.currentMidIndex+=1;let e$="".concat(this.currentMidIndex),t$={media:{mediaType:"application",port:Fa,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e$),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t$),{mediaDesc:t$,needExchangeSDP:!0}}createOrRecycleRecvMedia(e$,t$,r$,n$,i$,o$){let s$=e$._mediaStreamTrack.kind,a$=this.rtpCapabilities.recv,c$=ac(s$,a$,this.localCapabilities.send,s$===Q.VIDEO?n$:i$),u$=s$===Q.VIDEO?a$.videoExtensions:a$.audioExtensions;this.currentMidIndex+=1;let l$="".concat(this.currentMidIndex),d$={media:{mediaType:s$,port:Fa,protos:["UDP","TLS","RTP","SAVPF"],fmts:c$.map(p$=>p$.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:u$,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t$,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c$,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r$,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l$)}};d$=this.mungRecvMediaDsec(d$,e$,o$);let h$=this.findFirstClosedMedia(s$);if(h$){let p$=this.sessionDesc.mediaDescriptions.indexOf(h$);this.sessionDesc.mediaDescriptions[p$]=d$}else this.sessionDesc.mediaDescriptions.push(d$);return d$}updateRemoteCodec(e$,t$,r$){let n$=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(d$=>d$.rtpMap&&d$.rtpMap.encodingName.toLowerCase()||"").filter(d$=>{var h$;return W(h$=Object.keys(Ju)).call(h$,d$)}))],i$=new Set(t$);if(n$.every(d$=>i$.has(d$)))return _.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t$)),!1;let o$=this._rtpCapabilities.recv.videoCodecs.filter(d$=>t$.some(h$=>{var p$;return W(p$=d$.rtpMap&&d$.rtpMap.encodingName.toLowerCase()||"").call(p$,h$)}));if(o$.length===0)return _.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(n$," codecs: ").concat(t$)),!1;let s$=[...new Set(o$.map(d$=>d$.rtpMap&&d$.rtpMap.encodingName.toLowerCase()||""))],a$;if(_.debug("updateRemoteCodec, from ".concat(n$," to ").concat(s$)),e$.length===0)a$=this.sessionDesc.mediaDescriptions.filter(d$=>d$.media.mediaType==="video"&&d$.attributes.direction==="recvonly");else if(a$=this.sessionDesc.mediaDescriptions.filter(d$=>d$.attributes.mid&&W(e$).call(e$,d$.attributes.mid)&&d$.attributes.direction==="recvonly"),a$.length!==e$.length)return _.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e$,", codecs: ").concat(t$)),!1;if(v("USE_PUB_RTX")||v("USE_SUB_RTX")){let d$=yf(o$,this.rtpCapabilities.recv.videoCodecs);o$.push(...d$)}this._rtpCapabilities.recv.videoCodecs=o$;let c$=this.localCapabilities.send,u$=this.rtpCapabilities.recv,l$=ac(Q.VIDEO,u$,c$,r$);return a$.forEach(d$=>{let h$=l$.map(p$=>p$.payloadType.toString(10));_.debug("updateRemoteCodec mid: ".concat(d$.attributes.mid,", from ").concat(d$.attributes.payloads," to ").concat(l$)),d$.attributes.payloads=l$,d$.media.fmts=h$}),!0}createOrRecycleSendMedia(e$,t$,r$,n$,i$){let o$=this.rtpCapabilities.send,s$=e$===Q.VIDEO?o$.videoCodecs:o$.audioCodecs,a$=e$===Q.VIDEO?o$.videoExtensions:o$.audioExtensions;this.currentMidIndex+=1;let c$="".concat(this.currentMidIndex),u$={media:{mediaType:e$,port:Fa,protos:["UDP","TLS","RTP","SAVPF"],fmts:s$.map(d$=>d$.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:a$,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t$,ssrcGroups:r$,rtcpFeedbackWildcards:[],payloads:s$,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n$,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c$)}};u$=this.mungSendMediaDesc(u$,i$);let l$=this.findFirstClosedMedia(e$);if(l$){let d$=this.sessionDesc.mediaDescriptions.indexOf(l$);this.sessionDesc.mediaDescriptions[d$]=u$}else this.sessionDesc.mediaDescriptions.push(u$);return u$}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e$=>e$.media.port!=="0").map(e$=>e$.attributes.mid)}mungRecvMediaDsec(e$,t$,r$){let n$=le(e$);return If(n$),ra(n$,t$),vf(n$,t$),r0(n$),lu(n$,r$,this.localCapabilities.send),n$}mungSendMediaDesc(e$,t$){let r$=le(e$);return lu(r$,t$,this.localCapabilities.recv),oa(r$),r$}updateRecvMedia(e$,t$){let r$=this.sessionDesc.mediaDescriptions.findIndex(n$=>n$.attributes.mid===e$);if(r$!==-1){let n$=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r$],t$);this.sessionDesc.mediaDescriptions[r$]=n$}}bumpMid(e$){this.currentMidIndex+=e$}findFirstClosedMedia(e$){return this.sessionDesc.mediaDescriptions.find(t$=>$t()?t$.media.port==="0"&&t$.media.mediaType===e$:t$.media.port==="0")}findPreloadMediaDesc(e$){return this.sessionDesc.mediaDescriptions.find(t$=>{var r$;return((r$=t$.attributes)===null||r$===void 0||(r$=r$.ssrcs[0])===null||r$===void 0?void 0:r$.ssrcId)===e$[0].ssrcId})}getSSRC(e$){var t$;return(t$=this.sessionDesc.mediaDescriptions.find(r$=>r$.attributes.mid===e$))===null||t$===void 0?void 0:t$.attributes.ssrcs}};function Fv(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function Ar(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?Fv(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):Fv(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var dc=function(e$){return e$.BANDWIDTH="bandwidth",e$.CPU="cpu",e$.NONE="none",e$.OTHER="other",e$}({}),qs=function(e$){return e$[e$.DOWN=0]="DOWN",e$[e$.UP=1]="UP",e$}(qs||{}),mu=new Map;function Bv(e$,t$,r$,n$){let{scale:i$}=e$;if(i$===0&&n$===qs.UP||i$>=t$.length-1&&n$===qs.DOWN)return e$;let o$=Ar(Ar({},e$),{},{scale:n$===qs.DOWN?++i$:--i$});switch(r$){case"maintain-framerate":o$=Ar(Ar({},o$),t$[i$].motion);break;case"maintain-resolution":o$=Ar(Ar({},o$),t$[i$].detail);break;case"balanced":o$=Ar(Ar({},o$),t$[i$].balanced)}return o$}function S0(e$,t$){if(t$){let r$={overUse:0,underUse:0,adaptationList:R0(t$)};mu.set(e$,r$)}else mu.delete(e$)}function R0(e$){let t$=Ar({},e$),{bitrateMax:r$,frameRate:n$,scaleResolutionDownBy:i$,bitrateMin:o$}=t$,{MIN_FRAME_RATE:s$,MAX_THRESHOLD_FRAMERATE:a$,MAX_SCALE:c$,BITRATE_MIN_THRESHOLD:u$,BITRATE_MAX_THRESHOLD:l$,BWE_SCALE_UP_THRESHOLD:d$,BWE_SCALE_DOWN_THRESHOLD:h$,PERF_SCALE_DOWN_THRESHOLD:p$,PERF_SCALE_UP_THRESHOLD:_$,BALANCE_BITRATE_FACTOR:f$,BALANCE_FRAMERATE_FACTOR:m$,BALANCE_RESOLUTION_FACTOR:g$,MOTION_RESOLUTION_FACTOR:v$,MOTION_BITRATE_FACTOR:y$,DETAIL_FRAMERATE_FACTOR:S$,DETAIL_BITRATE_FACTOR:b$}=_f,$$=Math.min(t$.frameRate,a$),C$=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h$,1)*r$),bwe_up:r$,fps_down:Math.round(Math.pow(p$,1)*$$),fps_up:n$},balanced:{scaleResolutionDownBy:1,frameRate:n$,bitrateMax:r$,bitrateMin:o$},motion:{scaleResolutionDownBy:1,frameRate:n$,bitrateMax:r$,bitrateMin:o$},detail:{scaleResolutionDownBy:1,frameRate:n$,bitrateMax:r$,bitrateMin:o$}}];for(let N$=1;N$<=c$;N$++){let k$={bwe_up:Math.round(Math.pow(d$,N$)*r$),bwe_down:Math.round(Math.pow(h$,N$+1)*r$),fps_up:Math.round(Math.pow(_$,N$)*$$),fps_down:Math.round(Math.pow(p$,N$+1)*$$)},O$={scaleResolutionDownBy:i$/Math.pow(g$,N$),frameRate:Math.max(Math.round(Math.pow(m$,N$)*n$),s$),bitrateMax:Math.max(Math.round(Math.pow(f$,N$)*r$),l$),bitrateMin:Math.max(Math.round(Math.pow(f$,N$)*o$),u$)},U$={scaleResolutionDownBy:i$/Math.pow(v$,N$),frameRate:n$,bitrateMax:Math.max(Math.round(Math.pow(y$,N$)*r$),l$),bitrateMin:Math.max(Math.round(Math.pow(y$,N$)*o$),u$)},x$={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(S$,N$)*n$),s$),bitrateMax:Math.max(Math.round(Math.pow(b$,N$)*r$),l$),bitrateMin:Math.max(Math.round(Math.pow(b$,N$)*o$),u$)};C$.push({scale:N$,threshold:k$,balanced:O$,motion:U$,detail:x$})}return C$}function pW(e$,t$,r$,n$,i$,o$){let s$=mu.get(e$)||{overUse:0,underUse:0,adaptationList:R0(i$)},{adaptationList:a$}=s$;mu.set(e$,s$);let{OVERUSE_TIMES_THRESHOLD:c$,UNDERUSE_TIMES_THRESHOLD:u$}=_f,{scale:l$}=n$,d$,h$;return typeof t$=="number"&&t$>0&&function(p$,_$,f$,m$){if(_$>=f$.length)return!1;let{threshold:{fps_down:g$}}=f$[_$];return v("FORCE_AG_HIGH_FRAMERATE")&&m$==="maintain-framerate"&&(g$=f$[0].threshold.fps_down),p$<g$}(t$,l$,a$,o$)&&(s$.overUse++,h$=dc.CPU,s$.overUse>c$)||typeof r$=="number"&&r$>0&&function(p$,_$,f$){if(_$>=f$.length)return!1;let{threshold:{bwe_down:m$}}=f$[_$];return p$<m$}(r$,l$,a$)&&(s$.overUse++,h$=dc.BANDWIDTH,s$.overUse>c$)?(s$.overUse=0,s$.underUse=0,d$=Bv(n$,a$,o$,qs.DOWN),[d$,h$]):(typeof t$=="number"&&t$>0&&typeof r$=="number"&&r$>0&&function(p$,_$,f$,m$){if(_$===0)return;let{threshold:{fps_up:g$}}=f$[_$];return v("FORCE_AG_HIGH_FRAMERATE")&&m$==="maintain-framerate"&&(g$=f$[1].threshold.fps_up),p$>g$}(t$,l$,a$,o$)&&function(p$,_$,f$){if(_$===0)return;let{threshold:{bwe_up:m$}}=f$[_$];return p$>m$}(r$,l$,a$)&&(s$.underUse++,s$.underUse>u$&&(s$.overUse=0,s$.underUse=0,d$=Bv(n$,a$,o$,qs.UP),d$.scale===0&&(h$=dc.NONE))),[d$,h$])}function jv(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function m_(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?jv(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):jv(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}function _W(e$){var t$;return!!v("ENABLE_AG_ADAPTATION")&&!!(e$ instanceof XE||W(t$=e$._hints).call(t$,Gt.CUSTOM_TRACK))&&(!!v("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(r$){let n$=mt();if(n$.os!==ye.IOS||!n$.osVersion)return!1;let i$=n$.osVersion.split(".");return Number(i$[0])>=r$}(14)&&fO(17,4)||mO(14)&&gO(17,4)))}var fu=new Map;function zd(e$,t$){let r$=fu.get(e$);if(r$){let{timer:n$}=r$;window.clearTimeout(n$),fu.delete(e$)}t$.qualityLimitationReason=dc.NONE,S0(e$)}var pt;function Gv(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function Qi(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?Gv(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):Gv(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var ki=(pt=class f5 extends Yl{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t$,r$;return(t$=(r$=this.peerConnection.getReceivers()[0])===null||r$===void 0||(r$=r$.transport)===null||r$===void 0?void 0:r$.state)!==null&&t$!==void 0?t$:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t$=>t$.rtpMap&&t$.rtpMap.encodingName.toLowerCase()||"").filter(t$=>{var r$;return W(r$=Object.keys(Ju)).call(r$,t$)}))]}constructor(t$,r$){super(t$,r$),T(this,"store",void 0),T(this,"peerConnection",void 0),T(this,"id",Ut(5,"connection-")),T(this,"remoteSDP",void 0),T(this,"initialOffer",void 0),T(this,"transportEventReceiver",void 0),T(this,"statsFilter",void 0),T(this,"extension",{useXR:v("USE_XR")}),T(this,"localCapabilities",void 0),T(this,"remoteCodecs",void 0),T(this,"localCandidateCount",0),T(this,"allCandidatesReceived",!1),T(this,"isPreallocation",!1),T(this,"preSSRCMap",new Map),T(this,"dataStreamChannelMap",new Map),T(this,"establishPromise",void 0),T(this,"recoveredDataChannelIds",[]),T(this,"currentDataChannelId",1),T(this,"mutex",new ze("P2PConnection-mutex")),T(this,"qualityLimitationReason",dc.NONE),this.store=r$,this.peerConnection=new RTCPeerConnection(f5.resolvePCConfiguration(t$),{optional:[{googDscp:!0}]}),this.statsFilter=Nf(this.peerConnection,v("STATS_UPDATE_INTERVAL"),void 0,$t()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t$){let r$=this.preSSRCMap.get(t$);if(r$!==void 0){let n$=this.peerConnection.getTransceivers().find(i$=>i$.mid===r$);if(n$)return{transceiver:n$,track:n$.receiver.track,id:r$}}}async updateRemoteRTPCapabilities(t$,r$){if(this.remoteCodecs=r$,!this.remoteSDP)return void _.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r$));if(this.remoteSDP.updateRemoteCodec(t$,r$,this.store.codec)){let n$=await this.peerConnection.createOffer(),i$=this.logSDPExchange(n$.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n$);let o$=this.remoteSDP.toString();i$==null||i$(o$),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o$})}else _.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let t$=await this.peerConnection.createOffer();if(!t$.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r$=io(t$.sdp),n$=await s0({filterRTX:!v("USE_PUB_RTX")&&!v("USE_SUB_RTX"),filterVideoFec:v("FILTER_VIDEO_FEC"),filterAudioFec:v("FILTER_AUDIO_FEC"),filterVideoCodec:v("FILTER_VIDEO_CODEC")},this.extension);return this.localCapabilities=uu(n$),this.initialOffer=t$,Qi(Qi({},r$),{},{rtpCapabilities:n$,offerSDP:t$.sdp})}catch(t$){throw new N(R.GET_LOCAL_CONNECTION_PARAMS_FAILED,t$.toString())}}async connect(t$){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new um(Qi(Qi({},t$),{},{localCapabilities:this.localCapabilities})),t$.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let r$=this.remoteSDP.toString(),n$=a0(this.initialOffer.sdp,this.extension),i$=this.logSDPExchange(n$||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:n$}),i$==null||i$(r$),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r$});let o$=this.peerConnection.getTransceivers()[0];if(o$!=null&&o$.receiver&&this.tryBindTransportEvents(o$.receiver),v("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(v("PRELOAD_MEDIA_COUNT"));let a$=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a$});let c$=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c$)}let{preSSRCs:s$}=t$;if(Array.isArray(s$)&&s$.length>0){let{mids:a$}=this.remoteSDP.batchSend(s$.map(c$=>({kind:c$.kind,ssrcMsg:[{ssrcId:c$.ssrcId,rtx:c$.rtx}],mslabel:c$.mslabel})));a$.forEach((c$,u$)=>{this.preSSRCMap.set(s$[u$].ssrcId,c$)}),await Wd(this.peerConnection,this.remoteSDP,this.extension),_.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r$.toString()))}}async updateRemoteConnect(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let{rtpCapabilities:r$}=t$;this.remoteSDP.updateRemoteRTPCapabilities(r$),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let{preSSRCs:n$}=t$;if(Array.isArray(n$)&&n$.length>0){let{mids:i$}=this.remoteSDP.batchSend(n$.map(o$=>Object.assign({},{kind:o$.kind,ssrcMsg:[{ssrcId:o$.ssrcId,rtx:o$.rtx}],mslabel:o$.mslabel})));i$.forEach((o$,s$)=>{this.preSSRCMap.set(n$[s$].ssrcId,o$)})}await Wd(this.peerConnection,this.remoteSDP,this.extension),_.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(r$.toString()))}}send(t$,r$,n$){var i$=this;return Bi(function*(){let o$=yield Tt(i$.mutex.lock("From P2PConnection.send"));try{if(!i$.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let s$=[];t$.forEach(f$=>{let m$=i$.peerConnection.addTransceiver(f$._mediaStreamTrack,{direction:"sendonly"});s$.push(m$),f$._updateRtpTransceiver(m$)}),$t()&&v("SIMULCAST")===!0&&(yield Tt(i$.applySimulcastForFirefox(s$,t$)));let a$=yield Tt(i$.peerConnection.createOffer()),c$=i$.remoteSDP.predictReceivingMids(t$.length),u$=i$.mungSendOfferSDP(a$.sdp,t$,c$),l$=Le.parse(u$),d$=c$.map(f$=>{let m$=l$.mediaDescriptions.find(g$=>g$.attributes.mid===f$);if(!m$)throw new Error("Cannot extract ssrc from mediaDescription.");return n0(m$,v("USE_PUB_RTX"))}),h$;try{h$=yield d$}catch(f$){h$=[],i$.remoteSDP.receive(t$,r$,n$,h$);let m$=i$.remoteSDP.toString();throw yield Tt(i$.peerConnection.setLocalDescription({type:"offer",sdp:u$})),yield Tt(i$.peerConnection.setRemoteDescription({type:"answer",sdp:m$})),yield Tt(i$.stopSending(c$,!0)),f$}i$.remoteSDP.receive(t$,r$,n$,h$);let p$=i$.remoteSDP.toString(),_$=i$.logSDPExchange(u$,"offer","local","send");return yield Tt(i$.peerConnection.setLocalDescription({type:"offer",sdp:u$})),yield Tt(i$.applySimulcastEncodings(s$,t$)),yield Tt(i$.applySendEncodings(s$,t$)),_$==null||_$(p$),yield Tt(i$.peerConnection.setRemoteDescription({type:"answer",sdp:p$})),s$.map((f$,m$)=>{let g$=c$[m$];return{localSSRC:d$[m$],id:g$,transceiver:f$}})}catch(s$){throw s$ instanceof N?s$:new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s$.toString()))}finally{o$()}})()}async createDataChannels(t$,r$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n$=this.dataStreamChannelMap.get(t$);if(n$&&n$.readyState==="open")_.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let o$=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof o$!="number")throw new Error("create DataChannel error, because cannot get dc id");n$=this.peerConnection.createDataChannel("datastream-channel",{id:o$,negotiated:!0,ordered:!1,maxRetransmits:v("DATASTREAM_MAX_RETRANSMITS")}),n$.binaryType="arraybuffer",this.dataStreamChannelMap.set(t$,n$)}r$.forEach(o$=>{o$._updateOriginDataChannel(n$)});let{needExchangeSDP:i$}=this.remoteSDP.sendDataChannel();if(i$){let o$=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o$});let s$=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s$),_.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else _.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(n$){throw n$ instanceof N?n$:new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(n$.toString()))}}async stopDataChannels(t$){try{let r$=this.dataStreamChannelMap.get(t$);return r$&&(r$.id&&this.recoveredDataChannelIds.push(r$.id),r$.close()),void this.dataStreamChannelMap.delete(t$)}catch(r$){throw r$ instanceof N?r$:new N(R.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(r$.toString()))}}async stopSending(t$,r$){let n$=r$?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let i$=this.peerConnection.getTransceivers().filter(c$=>t$.indexOf(c$.mid)!==-1);if(i$.length!==t$.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i$.map(c$=>{var u$;zd(this.id+c$.mid,this),c$.direction="inactive",(u$=c$.stop)===null||u$===void 0||u$.call(c$)});let o$=await this.peerConnection.createOffer(),s$=this.logSDPExchange(o$.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o$),this.remoteSDP.stopReceiving(t$);let a$=this.remoteSDP.toString();s$==null||s$(a$),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a$})}catch(i$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i$.toString()))}finally{n$&&n$()}}async receive(t$,r$,n$,i$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t$," before remoteSDP created."));let{mid:o$,needExchangeSDP:s$}=this.remoteSDP.send(t$,r$,n$,i$);s$&&(await Wd(this.peerConnection,this.remoteSDP,this.extension),_.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t$," by exchanging SDP.")));let a$=this.peerConnection.getTransceivers().find(c$=>c$.mid===o$);if(!a$)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a$.receiver.track,id:o$,transceiver:a$}}catch(o$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o$.toString()))}}async batchReceive(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:r$,needExchangeSDP:n$}=this.remoteSDP.batchSend(t$);return n$&&(await Wd(this.peerConnection,this.remoteSDP,this.extension),_.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),r$.map(i$=>{let o$=this.peerConnection.getTransceivers().find(s$=>s$.mid===i$);if(!o$)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o$.receiver.track,id:i$,transceiver:o$}})}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r$.toString()))}}async stopReceiving(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t$.forEach(o$=>{Array.from(this.preSSRCMap.entries()).some(s$=>{let[a$,c$]=s$;if(c$===o$)return this.preSSRCMap.delete(a$),!0})}),this.remoteSDP.stopSending(t$);let r$=this.remoteSDP.toString(),n$=this.logSDPExchange(r$,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r$});let i$=await this.peerConnection.createAnswer();n$==null||n$(i$.sdp||""),await this.peerConnection.setLocalDescription(i$)}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r$.toString()))}}async muteRemote(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t$," before remote SDP created."));this.remoteSDP.mute(t$);let r$=this.remoteSDP.toString(),n$=this.logSDPExchange(r$,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r$});let i$=await this.peerConnection.createAnswer();n$==null||n$(i$.sdp||""),await this.peerConnection.setLocalDescription(i$)}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(r$.toString()))}}async unmuteRemote(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t$," before remote SDP created."));this.remoteSDP.unmute(t$);let r$=this.remoteSDP.toString(),n$=this.logSDPExchange(r$,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r$});let i$=await this.peerConnection.createAnswer();n$==null||n$(i$.sdp||""),await this.peerConnection.setLocalDescription(i$)}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(r$.toString()))}}async muteLocal(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r$=this.peerConnection.getTransceivers().filter(s$=>s$.mid&&t$.indexOf(s$.mid)!==-1);if(r$.length!==t$.length)throw new Error("Transceivers' length doesn't match mids' length.");r$.map(s$=>{s$.direction="inactive"});let n$=await this.peerConnection.createOffer(),i$=this.logSDPExchange(n$.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n$),this.remoteSDP.muteRemote(t$);let o$=this.remoteSDP.toString();i$==null||i$(o$),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o$})}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r$.toString()))}}async unmuteLocal(t$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r$=this.peerConnection.getTransceivers().filter(s$=>s$.mid&&t$.indexOf(s$.mid)!==-1);if(r$.length!==t$.length)throw new Error("Transceivers' length doesn't match mids' length.");r$.map(async(s$,a$)=>{s$.direction="sendonly"});let n$=await this.peerConnection.createOffer(),i$=this.logSDPExchange(n$.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n$),this.remoteSDP.unmuteRemote(t$);let o$=this.remoteSDP.toString();i$==null||i$(o$),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o$})}catch(r$){throw new N(R.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r$.toString()))}}restartICE(t$){var r$=this;return Bi(function*(){let n$=yield Tt(r$.mutex.lock("From P2PConnection.restartICE"));try{if(!r$.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ft().supportPCSetConfiguration){let u$=r$.peerConnection.getConfiguration(),l$=t$===On.RELAY?"relay":"all";u$.iceTransportPolicy!==l$&&(_.debug("[".concat(r$.store.clientId,"] restartICE change iceTransportPolicy from [").concat(u$.iceTransportPolicy,"] to [").concat(l$,"]")),u$.iceTransportPolicy=l$,r$.peerConnection.setConfiguration(u$))}else if(t$===On.RELAY)return;r$.remoteSDP.updateCandidates(t$);let i$=yield Tt(r$.peerConnection.createOffer({iceRestart:!0}));if(!i$.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let o$=io(i$.sdp),{remoteIceParameters:s$}=yield o$.iceParameters;r$.remoteSDP.restartICE(s$);let a$=r$.remoteSDP.toString(),c$=r$.logSDPExchange(i$.sdp||"","offer","local","restartICE");r$.store.descriptionStart(),yield Tt(r$.peerConnection.setLocalDescription(i$)),c$==null||c$(a$),yield Tt(r$.peerConnection.setRemoteDescription({type:"answer",sdp:a$}))}catch(i$){_.warning("[".concat(r$.store.clientId,"] restart ICE failed, abort operation"),i$)}finally{n$()}})()}close(){var t$;this.peerConnection.getTransceivers().forEach(r$=>{zd(this.id+r$.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(t$=this.onConnectionStateChange)===null||t$===void 0||t$.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Qi(Qi({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t$){return this.statsFilter.getVideoIsReady(t$)}async updateEncoderConfig(t$,r$){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n$=await this.peerConnection.createOffer(),i$=this.mungSendOfferSDP(n$.sdp,[r$],[t$]);this.remoteSDP.updateRecvMedia(t$,r$);let o$=this.remoteSDP.toString(),s$=this.logSDPExchange(i$,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i$}),s$==null||s$(o$),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o$})}catch(n$){throw new N(R.EXCHANGE_SDP_FAILED,n$.toString())}}async updateSendParameters(t$,r$){let n$=this.peerConnection.getTransceivers().filter(i$=>i$.mid===t$);n$.length===1&&(this.isVP8Simulcast(r$)?$t()||await this.applySimulcastEncodings(n$,[r$]):await this.applySendEncodings(n$,[r$]))}setStatsRemoteVideoIsReady(t$,r$){this.statsFilter.setVideoIsReady2(t$,r$)}async replaceTrack(t$,r$){let n$=this.peerConnection.getTransceivers().find(i$=>i$.mid===r$);n$&&await n$.sender.replaceTrack(t$._mediaStreamTrack)}async getSelectedCandidatePair(){let t$=this.peerConnection.getReceivers();if(t$.length>0&&t$[0].transport&&t$[0].transport.iceTransport&&t$[0].transport.iceTransport.getSelectedCandidatePair&&t$[0].transport.iceTransport.getSelectedCandidatePair()){let r$=t$[0].transport.iceTransport,{local:n$,remote:i$}=r$.getSelectedCandidatePair();return{local:Qi(Qi({},hr),{},{candidateType:n$.type,protocol:n$.protocol,address:n$.address,port:n$.port}),remote:Qi(Qi({},hr),{},{candidateType:i$.type,protocol:i$.protocol,address:i$.address,port:i$.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t$;(t$=this.onICEConnectionStateChange)===null||t$===void 0||t$.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t$;(t$=this.onConnectionStateChange)===null||t$===void 0||t$.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t$=>{t$.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,_.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,_.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},v("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t$){let r$={iceServers:[]};return t$.iceServers?r$.iceServers=t$.iceServers:t$.turnServer&&t$.turnServer.mode!=="off"&&(Yu(t$.turnServer.servers)?r$.iceServers=t$.turnServer.servers:(r$.iceServers&&r$.iceServers.push(...f5.turnServerConfigToIceServers(t$.turnServer.servers)),v("USE_TURN_SERVER_OF_GATEWAY")&&r$.iceServers&&t$.turnServer.serversFromGateway&&r$.iceServers.push(...f5.turnServerConfigToIceServers(t$.turnServer.serversFromGateway)),v("FORCE_TURN_TCP")?r$.iceTransportPolicy="relay":t$.turnServer.servers.concat(t$.turnServer.serversFromGateway||[]).forEach(n$=>{n$.forceturn&&(r$.iceTransportPolicy="relay")}))),v("ENABLE_ENCODED_TRANSFORM")&&ft().supportWebRTCEncodedTransform&&(r$.encodedInsertableStreams=!0),r$}static turnServerConfigToIceServers(t$){let r$=[];return t$.forEach(n$=>{n$.security?n$.tcpport&&r$.push({username:n$.username,credential:n$.password,credentialType:"password",urls:"turns:".concat(Us(n$.turnServerURL),":").concat(n$.tcpport,"?transport=tcp")}):(n$.udpport&&!v("FORCE_TURN_TCP")&&r$.push({username:n$.username,credential:n$.password,credentialType:"password",urls:"turn:".concat(n$.turnServerURL,":").concat(n$.udpport,"?transport=udp")}),n$.tcpport&&r$.push({username:n$.username,credential:n$.password,credentialType:"password",urls:"turn:".concat(n$.turnServerURL,":").concat(n$.tcpport,"?transport=tcp")}))}),r$}tryBindTransportEvents(t$){let r$=t$.transport;if(r$){this.transportEventReceiver=t$,r$.onstatechange=()=>{var i$;r$!=null&&r$.state&&((i$=this.onDTLSTransportStateChange)===null||i$===void 0||i$.call(this,r$.state))},r$.onerror=i$=>{var o$;(o$=this.onDTLSTransportError)===null||o$===void 0||o$.call(this,"error"in i$?i$.error:i$)};let n$=r$.iceTransport;n$&&(n$.onstatechange=()=>{let i$=r$==null?void 0:r$.iceTransport.state;var o$;i$&&((o$=this.onICETransportStateChange)===null||o$===void 0||o$.call(this,i$))},n$.getSelectedCandidatePair&&(n$.onselectedcandidatepairchange=()=>{if(n$.getSelectedCandidatePair()){let{local:i$,remote:o$}=n$.getSelectedCandidatePair();_.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i$.type,protocol:i$.protocol}),", remote ").concat(JSON.stringify({candidateType:o$.type,protocol:o$.protocol,address:o$.address,port:o$.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t$,r$){var n$,i$;if(r$||(r$=this.peerConnection.getSenders().find(f$=>f$.track===t$._mediaStreamTrack)),!r$)return _.warn("[".concat(t$.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t$))return _.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ft().supportSetRtpSenderParameters)return _.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let o$={},s$={};switch(t$._optimizationMode){case"motion":o$.degradationPreference="maintain-framerate";break;case"detail":o$.degradationPreference="maintain-resolution";break;case"balanced":o$.degradationPreference="balanced"}let a$=function(f$,m$){return f$.getTransceivers().find(g$=>g$.sender.track===m$||g$.receiver.track===m$)}(this.peerConnection,t$._mediaStreamTrack),c$=xG(t$);if(_W(t$)&&a$&&r$&&c$&&this.getLocalVideoStats&&W(n$=["vp8","vp9"]).call(n$,this.store.codec)){var u$;let f$=o$.degradationPreference||(W(u$=t$._hints).call(u$,Gt.CUSTOM_TRACK)?v("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(m$,g$,v$,y$,S$,b$){if(zd(m$,v$),S$(g$),y$!=="balanced"&&y$!=="maintain-framerate"&&y$!=="maintain-resolution")return;let $$=-1;S0(m$,g$);let C$=window.setInterval(()=>{let k$=fu.get(m$);if(!v("ENABLE_AG_ADAPTATION")||!k$)return zd(m$,v$),void S$(g$);let O$=b$();if(O$.sendPackets>0&&O$.OutgoingAvailableBandwidth>0){if($$===-1)return void($$=Date.now());if(Date.now()-$$<1e3)return;let U$=O$.sendFrameRate,x$=O$.OutgoingAvailableBandwidth,[F$,L$]=pW(m$,U$,x$,k$.adaptationConfig,g$,y$);L$&&(v$.qualityLimitationReason=L$),F$&&k$.adaptationConfig.scale!==F$.scale&&(_.debug("[".concat(m$,"] applyAdaptation: ").concat(v$.qualityLimitationReason,`
           sendFps `).concat(U$,", bwe ").concat(x$,", switch from ").concat(k$.adaptationConfig.scale," to ").concat(F$.scale," ")),k$.adaptationConfig=m_(m_({},k$.adaptationConfig),F$),S$(F$))}},v("CHECK_LOCAL_STATS_INTERVAL")),N$=m_({},g$);fu.set(m$,{timer:C$,adaptationConfig:N$,originConfig:g$,adaptationFunc:S$}),_.debug("[".concat(m$,"] start adaptation, originConfig: ").concat(JSON.stringify(g$),", degradationPreference: ").concat(y$))})(this.id+a$.mid,c$,this,f$,m$=>{r$&&this.updateAdaptation(r$,m$)},this.getLocalVideoStats.bind(this))}if(t$._encoderConfig){var l$;let{bitrateMax:f$,frameRate:m$,scaleResolutionDownBy:g$}=t$._encoderConfig;f$&&(s$.maxBitrate=1e3*f$),(W(l$=t$._hints).call(l$,Gt.LOW_STREAM)||t$.isUseScaleResolutionDownBy)&&(m$&&(s$.maxFramerate=Nn(m$)),g$&&g$>=1&&(s$.scaleResolutionDownBy=g$))}let{maxFramerate:d$}=v("ENCODER_CONFIG_LIMIT");if(d$&&typeof d$=="number"&&(s$.maxFramerate=s$.maxFramerate?Math.min(s$.maxFramerate,d$):d$),v("DSCP_TYPE")&&ho()){var h$;let f$=v("DSCP_TYPE");W(h$=["very-low","low","medium","high"]).call(h$,f$)&&(s$.networkPriority=f$)}let p$=r$.getParameters(),_$=(i$=p$.encodings)===null||i$===void 0?void 0:i$[0];$t()&&!_$&&(o$.encodings=[s$]),_$&&Object.assign(_$,s$),Object.assign(p$,o$),_.debug("[".concat(t$.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p$.encodings))),await r$.setParameters(p$),await async function(f$,m$,g$){try{var v$;if(!ft().supportSetRtpSenderParameters||!function(C$){return C$==="vp9"}(f$)||!v("ENABLE_SVC"))return;let y$={},S$={},b$=m$.getParameters(),$$=(v$=b$.encodings)===null||v$===void 0?void 0:v$[0];S$.scalabilityMode=$E(g$),$$&&Object.assign($$,S$),Object.assign(b$,y$),await m$.setParameters(b$),_.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(b$.encodings)))}catch(y$){_.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",y$)}}(this.store.codec,r$,v("SVC_MODE"))}async updateAdaptation(t$,r$){var n$,i$;if(!t$)return _.debug("[updateAdaptation] no rtpSender found");if(!ft().supportSetRtpSenderParameters)return _.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let o$={},{bitrateMax:s$,frameRate:a$,scaleResolutionDownBy:c$}=r$;s$&&(o$.maxBitrate=1e3*s$),a$&&(o$.maxFramerate=Nn(a$)),c$&&c$>=1&&W(n$=["vp8","vp9"]).call(n$,this.store.codec)&&(o$.scaleResolutionDownBy=c$);let u$=t$.getParameters(),l$=(i$=u$.encodings)===null||i$===void 0?void 0:i$[0];l$&&Object.assign(l$,o$),Object.assign(u$,{});try{await t$.setParameters(u$),_.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(u$.encodings)))}catch(d$){!("transport"in t$)||t$.transport&&t$.transport.state==="connected"?this.peerConnectionState!=="connected"?_.debug("[updateAdaptation] peerConnection not connected}"):_.debug("[updateAdaptation] updateRtpSenderEncodings failed",d$):_.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t$,r$){try{if(!ft().supportSetRtpSenderParameters||t$.length!==r$.length)return;for(let n$=0;n$<t$.length;n$++){let i$=t$[n$],o$=r$[n$];o$ instanceof Ft&&!this.isVP8Simulcast(o$)&&await this.updateRtpSenderEncodings(o$,i$.sender)}}catch{_.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t$,r$,n$){let i$=Le.parse(t$);return r$.forEach((o$,s$)=>{let a$=n$[s$],c$=i$.mediaDescriptions.find(u$=>u$.attributes.mid===a$);c$&&(ra(c$,o$),o0(c$,o$,this.store.codec))}),Le.print(i$)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t$=>{var r$;(r$=this.onFirstAudioReceived)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstVideoReceived=t$=>{var r$;(r$=this.onFirstVideoReceived)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstAudioDecoded=t$=>{var r$;(r$=this.onFirstAudioDecoded)===null||r$===void 0||r$.call(this,t$)},this.statsFilter.onFirstVideoDecoded=(t$,r$,n$)=>{var i$;(i$=this.onFirstVideoDecoded)===null||i$===void 0||i$.call(this,t$,r$,n$)},this.statsFilter.onSelectedLocalCandidateChanged=(t$,r$)=>{var n$;(n$=this.onSelectedLocalCandidateChanged)===null||n$===void 0||n$.call(this,t$,r$)},this.statsFilter.onSelectedRemoteCandidateChanged=(t$,r$)=>{var n$;(n$=this.onSelectedRemoteCandidateChanged)===null||n$===void 0||n$.call(this,t$,r$)},this.statsFilter.onFirstVideoDecodedTimeout=t$=>{var r$;(r$=this.onFirstVideoDecodedTimeout)===null||r$===void 0||r$.call(this,t$)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t$,r$){if(t$.length===r$.length)for(let c$=0;c$<t$.length;c$++){var n$,i$,o$,s$,a$;let u$=t$[c$],l$=r$[c$];if(l$ instanceof Ft&&!W(n$=l$._hints).call(n$,Gt.LOW_STREAM)&&(i$=l$._encoderConfig)!==null&&i$!==void 0&&i$.bitrateMax&&((o$=l$._encoderConfig)===null||o$===void 0?void 0:o$.bitrateMax)>200&&(s$=l$._scalabilityMode)!==null&&s$!==void 0&&s$.numSpatialLayers&&((a$=l$._scalabilityMode)===null||a$===void 0?void 0:a$.numSpatialLayers)>1&&this.store.codec==="vp8"){let d$={},h$={high:1e3*(l$._encoderConfig.bitrateMax-50),medium:5e4};d$.encodings=[{rid:"m",active:!0,maxBitrate:h$.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:h$.high}];let p$=u$.sender.getParameters();await u$.sender.setParameters(Object.assign(p$,d$))}}}async applySimulcastEncodings(t$,r$){if(!$t()&&t$.length===r$.length)for(let n$=0;n$<t$.length;n$++){let i$=r$[n$];if(i$ instanceof Ft&&this.isVP8Simulcast(i$)){let o$=t$[n$],s$={},a$={high:1e3*(i$._encoderConfig.bitrateMax-50),medium:5e4};s$.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a$.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a$.medium,scaleResolutionDownBy:4}];let c$=o$.sender.getParameters();await o$.sender.setParameters(Object.assign(c$,s$))}}}isVP8Simulcast(t$){var r$,n$,i$,o$,s$;return!!(t$ instanceof Ft&&v("SIMULCAST")&&this.store.codec==="vp8"&&!W(r$=t$._hints).call(r$,Gt.LOW_STREAM)&&(n$=t$._encoderConfig)!==null&&n$!==void 0&&n$.bitrateMax&&((i$=t$._encoderConfig)===null||i$===void 0?void 0:i$.bitrateMax)>200&&(o$=t$._scalabilityMode)!==null&&o$!==void 0&&o$.numSpatialLayers&&((s$=t$._scalabilityMode)===null||s$===void 0?void 0:s$.numSpatialLayers)>1)}logSDPExchange(t$,r$,n$,i$){if(v("SDP_LOGGING"))return _.upload("[".concat(this.store.clientId,"] exchanging ").concat(n$," ").concat(r$," SDP during P2PConnection.").concat(i$,`
`),t$),r$==="offer"?o$=>{this.logSDPExchange(o$,"answer",n$==="local"?"remote":"local",i$)}:void 0}async getRemoteSSRC(t$){if(!this.remoteSDP)return;let r$=this.remoteSDP.getSSRC(t$);return r$&&r$.length!==0?r$[0].ssrcId:void 0}setConfiguration(t$){if(ft().supportPCSetConfiguration){let r$=f5.resolvePCConfiguration(t$);this.peerConnection.setConfiguration(r$)}}},q(pt.prototype,"updateRemoteRTPCapabilities",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"updateRemoteRTPCapabilities"),pt.prototype),q(pt.prototype,"connect",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"connect"),pt.prototype),q(pt.prototype,"updateRemoteConnect",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"updateRemoteConnect"),pt.prototype),q(pt.prototype,"createDataChannels",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"createDataChannels"),pt.prototype),q(pt.prototype,"receive",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"receive"),pt.prototype),q(pt.prototype,"batchReceive",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"batchReceive"),pt.prototype),q(pt.prototype,"stopReceiving",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"stopReceiving"),pt.prototype),q(pt.prototype,"muteRemote",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"muteRemote"),pt.prototype),q(pt.prototype,"unmuteRemote",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"unmuteRemote"),pt.prototype),q(pt.prototype,"muteLocal",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"muteLocal"),pt.prototype),q(pt.prototype,"unmuteLocal",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"unmuteLocal"),pt.prototype),q(pt.prototype,"close",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"close"),pt.prototype),q(pt.prototype,"updateEncoderConfig",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"updateEncoderConfig"),pt.prototype),q(pt.prototype,"updateSendParameters",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"updateSendParameters"),pt.prototype),q(pt.prototype,"replaceTrack",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"replaceTrack"),pt.prototype),q(pt.prototype,"updateAdaptation",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"updateAdaptation"),pt.prototype),q(pt.prototype,"getRemoteSSRC",[pn],Object.getOwnPropertyDescriptor(pt.prototype,"getRemoteSSRC"),pt.prototype),pt);function pn(e$,t$,r$){let n$=e$[t$];if(typeof n$!="function")throw new Error("Cannot use mutex on object property.");return r$.value=async function(){let i$=this.mutex,o$=await i$.lock("From P2PConnection.".concat(t$));try{for(var s$=arguments.length,a$=new Array(s$),c$=0;c$<s$;c$++)a$[c$]=arguments[c$];return await n$.apply(this,a$)}finally{o$()}},r$}var at;function Wv(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function Zi(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?Wv(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):Wv(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}function Hv(e$){var t$,r$,n$,i$=2;for(typeof Symbol<"u"&&(r$=hW,n$=Symbol.iterator);i$--;){if(r$&&(t$=e$[r$])!=null)return t$.call(e$);if(n$&&(t$=e$[n$])!=null)return new bl(t$.call(e$));r$="@@asyncIterator",n$="@@iterator"}throw new TypeError("Object is not async iterable")}function bl(e$){function t$(r$){if(Object(r$)!==r$)return j.reject(new TypeError(r$+" is not an object."));var n$=r$.done;return j.resolve(r$.value).then(function(i$){return{value:i$,done:n$}})}return bl=function(r$){this.s=r$,this.n=r$.next},bl.prototype={s:null,n:null,next:function(){return t$(this.n.apply(this.s,arguments))},return:function(r$){var n$=this.s.return;return n$===void 0?j.resolve({value:r$,done:!0}):t$(n$.apply(this.s,arguments))},throw:function(r$){var n$=this.s.return;return n$===void 0?j.reject(r$):t$(n$.apply(this.s,arguments))}},new bl(e$)}var Jd=(at=class extends Xt{get state(){return this._state}set state(e$){let t$=this._state;this._state=e$,this.emit(tt.StateChange,t$,this._state)}constructor(e$,t$){super(),T(this,"isPlanB",void 0),T(this,"store",void 0),T(this,"statsUploader",void 0),T(this,"connection",void 0),T(this,"localTrackMap",new Map),T(this,"remoteUserMap",new Map),T(this,"localDataChannels",[]),T(this,"remoteDataChannelMap",new Map),T(this,"pendingLocalTracks",[]),T(this,"pendingRemoteTracks",[]),T(this,"pendingLocalDataChannels",[]),T(this,"pendingRemoteDataChannels",[]),T(this,"statsCollector",void 0),T(this,"shouldForwardP2PCreation",void 0),T(this,"iceFailedCount",0),T(this,"dtlsFailedCount",0),T(this,"mutex",new ze("P2PChannel-mutex")),T(this,"_state",Rt.Disconnected),T(this,"_pcStatsUploadType",v("NEW_ICE_RESTART")?Tr.FIRST_CONNECTION:Tr.OLD_FIRST_CONNECTION),T(this,"_isInRestartIce",!1),T(this,"_isStartRestartIce",!1),T(this,"_restartStates",["disconnected","failed"]),T(this,"_restartTimer",void 0),T(this,"_isFirstConnected",!0),T(this,"handleMuteLocalTrack",async(r$,n$,i$)=>{let o$=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Rt.Connected)return void i$(new N(R.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let s$=this.filterTobeMutedTracks(r$);if(s$.length===0)return void n$();let a$=s$.find(u$=>u$[0]==="videoLowTrack");a$&&a$[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(s$.map(u$=>{let[,{id:l$}]=u$;return l$}));let c$=this.createMuteMessage(s$);await kt(this,tt.RequestMuteLocal,c$),n$()}catch(s$){i$(s$)}finally{o$()}}),T(this,"handleUnmuteLocalTrack",async(r$,n$,i$)=>{let o$=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Rt.Connected)return void i$(new N(R.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let s$=this.filterTobeUnmutedTracks(r$);if(s$.length===0)return void n$();let a$=s$.find(u$=>u$[0]==="videoLowTrack");if(a$){let u$=a$[1];if(u$.track._originMediaStreamTrack.stop(),!v("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding){let l$=r$._mediaStreamTrack.clone();u$.track._mediaStreamTrack=l$,u$.track._originMediaStreamTrack=l$}else{let l$=dm(r$,Ac(this,tt.RequestLowStreamParameter));u$.track._mediaStreamTrack=l$,u$.track._originMediaStreamTrack=l$}await new j((l$,d$)=>{this.handleReplaceTrack(u$.track,l$,d$,!0)})}await this.connection.unmuteLocal(s$.map(u$=>{let[,{id:l$}]=u$;return l$}));let c$=this.createUnmuteMessage(s$);await kt(this,tt.RequestUnmuteLocal,c$),n$()}catch(s$){i$(s$)}finally{o$()}}),T(this,"handleUpdateVideoEncoder",async(r$,n$,i$)=>{let o$=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{let s$=this.localTrackMap.get(U.LocalVideoTrack);if(!this.connection||!s$||s$.track!==r$||this.state!==Rt.Connected)return void n$();let{id:a$,track:c$}=s$;await this.connection.updateSendParameters(a$,c$),await this.connection.updateEncoderConfig(a$,c$),this.emit(tt.UpdateVideoEncoder,c$),n$()}catch(s$){i$(s$)}finally{o$()}}),T(this,"handleUpdateVideoSendParameters",async(r$,n$,i$)=>{let o$=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let s$=this.localTrackMap.get(U.LocalVideoTrack);if(!this.connection||!s$||s$.track!==r$||this.state!==Rt.Connected)return void n$();let{id:a$,track:c$}=s$;await this.connection.updateSendParameters(a$,c$),n$()}catch(s$){i$(s$)}finally{o$()}}),T(this,"handleReplaceMixingTrack",async(r$,n$,i$,o$)=>{if(!this.connection||this.state!==Rt.Connected)return void n$();let s$=E_([r$]),a$;_.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(s$.getTrackId(),"]")),typeof o$=="boolean"&&o$||(a$=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(r$,s$),n$()}catch(u$){i$(u$)}finally{var c$;(c$=a$)===null||c$===void 0||c$()}}),T(this,"handleReplaceTrack",async(r$,n$,i$,o$)=>{let s$;_.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(r$.getTrackId(),"]")),typeof o$=="boolean"&&o$||(s$=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var a$;let u$=Array.from(this.localTrackMap.entries()).find(l$=>{let[,{track:d$}]=l$;return r$===d$});if(!this.connection||!u$||this.state!==Rt.Connected)return void n$();if(await((a$=this.connection)===null||a$===void 0?void 0:a$.replaceTrack(r$,u$[1].id)),this.isPlanB){let l$=u$[1];l$.id=r$._mediaStreamTrack.id,this.localTrackMap.set(u$[0],l$)}if(u$[0]===U.LocalVideoTrack&&!v("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding){let l$=this.localTrackMap.get(U.LocalVideoLowTrack);if(l$){let d$=r$._mediaStreamTrack.clone();l$.track._originMediaStreamTrack.stop(),l$.track._mediaStreamTrack=d$,l$.track._originMediaStreamTrack=d$,await new j((h$,p$)=>{this.handleReplaceTrack(l$.track,h$,p$,!0)})}}n$()}catch(u$){i$(u$)}finally{var c$;(c$=s$)===null||c$===void 0||c$()}}),T(this,"handleGetRTCStats",r$=>{r$(this.statsCollector.getRTCStats())}),T(this,"handleGetLocalVideoStats",r$=>{r$(this.statsCollector.getLocalVideoTrackStats())}),T(this,"handleGetLocalAudioStats",r$=>{r$(this.statsCollector.getLocalAudioTrackStats())}),T(this,"handleGetRemoteVideoStats",r$=>this.statsCollector.getRemoteVideoTrackStats(r$.uid)[r$.uid]),T(this,"handleGetRemoteAudioStats",r$=>this.statsCollector.getRemoteAudioTrackStats(r$.uid)[r$.uid]),this.store=e$,this.statsCollector=t$,this.statsCollector.addP2PChannel(this),this.statsUploader=new pu(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!ft().supportUnifiedPlan||v("CHROME_FORCE_PLAN_B")&&ho(),this.shouldForwardP2PCreation=v("FORWARD_P2P_CREATION")&&ft().supportPCSetConfiguration&&lf(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Va({},this.store):new ki({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e$){var t$;this.state=Rt.New;let r$=this.shouldForwardP2PCreation&&((t$=this.connection)===null||t$===void 0?void 0:t$.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!r$||(r$&&this.connection&&(_.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.isPlanB?new Va(e$,this.store):new ki(e$,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new N(R.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=v("NEW_ICE_RESTART")?Tr.FIRST_CONNECTION:Tr.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e$),this.connection.establishPromise}async connect(e$){if(!this.connection)throw new N(R.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");v("ENABLE_PREALLOC_PC")&&this.state===Rt.Connected?await this.connection.updateRemoteConnect(e$):(this.store.peerConnectionStart(),await this.connection.connect(e$),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Rt.Connected)}updateRemoteRTPCapabilities(e$){let t$=Array.from(this.localTrackMap.entries()).filter(i$=>{var o$;let[s$]=i$;return W(o$=[U.LocalVideoLowTrack,U.LocalVideoTrack]).call(o$,s$)}),r$=t$.map(i$=>{let[,{id:o$}]=i$;return o$}),n$=t$.map(i$=>{let[o$]=i$;return o$});if(this.connection instanceof ki){if(X.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(n$),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e$)}),!W(e$).call(e$,this.store.codec)){let i$=["vp9","vp8","h264"].find(o$=>W(e$).call(e$,o$));i$&&(this.store.codec=i$,_.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i$,".")))}this.connection.updateRemoteRTPCapabilities(r$,e$)}}async getEstablishParams(){var e$;if(this.connection instanceof ki&&this.connection.peerConnectionState!=="closed"&&W(e$=[Rt.New,Rt.Connected]).call(e$,this.state))return this.connection.establishPromise}async publishDataChannel(e$){if(!this.connection||this.state!==Rt.Connected){if(this.state===Rt.Disconnected)throw new N(R.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e$.forEach(r$=>{var n$;W(n$=this.pendingLocalDataChannels).call(n$,r$)||this.pendingLocalDataChannels.push(r$)}),[]}let t$=this.filterTobePublishedDataChannels(e$);return t$.length===0?[]:(t$.forEach(r$=>{let n$=Date.now();this.store.publish(r$.id.toString(),"datachannel",n$)}),await this.connection.createDataChannels(this.store.uid,t$),t$.forEach(r$=>{this.localDataChannels.push(r$);let n$=Date.now();this.store.publish(r$.id+"","datachannel",void 0,n$)}),e$.map(r$=>({streamId:r$.id,ordered:r$.ordered,maxRetransmits:r$.maxRetransmits,metadata:r$.metadata,channelId:r$._originDataChannelId})))}publish(e$,t$,r$){var n$=this;return Bi(function*(){let i$=yield Tt(n$.mutex.lock("From P2PChannel.publish"));try{if(!n$.connection||n$.state!==Rt.Connected){if(n$.state===Rt.Disconnected)throw new N(R.UNEXPECTED_ERROR,"PeerConnection already disconnected.");n$.throwIfTrackTypeNotMatch(e$);let s$=e$.filter(a$=>n$.pendingLocalTracks.indexOf(a$)===-1);return void(n$.pendingLocalTracks=n$.pendingLocalTracks.concat(s$))}n$.store.pubId=n$.store.pubId+1,qe.markPublishStart(n$.store.clientId,n$.store.pubId);let o$=n$.filterTobePublishedTracks(e$,t$,r$);if(o$.length===0)return void(yield Tt(n$.tryToUnmuteAudio(e$)));yield*kv(Hv(n$.doPublish(n$.connection,o$)))}finally{i$()}})()}doPublish(e$,t$){var r$=this;return Bi(function*(){t$.forEach(d$=>{let{track:h$,type:p$}=d$,_$=Date.now();r$.store.publish(h$.getTrackId(),p$===U.LocalAudioTrack?"audio":"video",_$)}),r$.bindLocalTrackEvents(t$);let n$=t$.map(d$=>{let{track:h$}=d$;return h$}),i$=yield Tt(e$.send(t$.map(d$=>{let{track:h$}=d$;return h$}),r$.store.codec,r$.store.audioCodec)),o$=(yield Tt(i$.next())).value,s$=r$.createGatewayPublishMessage(t$,o$),a$;try{a$=yield s$}catch(d$){throw i$.throw(d$),(d$==null?void 0:d$.code)===R.WS_ABORT&&t$.forEach(h$=>{let{track:p$}=h$;r$.pendingLocalTracks.indexOf(p$)===-1&&r$.pendingLocalTracks.push(p$)}),r$.unbindLocalTrackEvents(t$),d$}let c$=r$.mapPubResToRemoteConfig(s$,a$),u$=(yield Tt(i$.next(c$))).value,l$=v("ENABLE_VIDEO_SEI");n$.forEach(async d$=>{let h$=d$.getRTCRtpTransceiver();h$&&l$&&(d$.trackMediaType===Q.VIDEO?await BG(h$.sender,d$):d$.trackMediaType===Q.AUDIO&&await async function(p$){if(!ft().supportWebRTCEncodedTransform)return void _.warning("browser not support audio encoded transform");if(Bd.has(p$)||!p$.track)return;let _$={track:p$.track};if(oo()){if(!p$.createEncodedStreams)return void _.warning("browser not support createEncodedStreams() API");let m$=null;try{m$=p$.createEncodedStreams()}catch(v$){return void _.error("create audio-encoded-streams error",v$&&v$.message)}let g$=new TransformStream({transform(v$,y$){_$.controller||(_$.controller=y$),p$.track&&p$.track.id!==_$.track.id&&(_.debug("audio track changed: ".concat(_$.track.id," => ").concat(p$.track.id)),_$.track.removeEventListener("ended",f$),_$.track=p$.track,_$.track.addEventListener("ended",f$)),y$.enqueue(v$)}});m$.readable.pipeThrough(g$).pipeTo(m$.writable)}else if(je()){if(typeof RTCRtpScriptTransform>"u")return void _.warning("browser not support RTCRtpScriptTransform");let m$=vl(),g$=new MessageChannel;await new j(y$=>m$.onmessage=S$=>{S$.data==="registered"&&y$(void 0)});let v$=new RTCRtpScriptTransform(m$,{name:"tx",port:g$.port2},[g$.port2]);p$.transform=v$,await new j(y$=>m$.onmessage=S$=>{S$.data==="started"&&y$(void 0)}),g$.port1.onmessage=y$=>{var S$;y$.data.transformed&&p$.track&&((S$=p$.track)===null||S$===void 0?void 0:S$.id)!==_$.track.id&&(_.debug("audio track changed: ".concat(_$.track.id," => ").concat(p$.track.id)),_$.track.removeEventListener("ended",f$),_$.track=p$.track,_$.track.addEventListener("ended",f$))},_$.worker=m$}function f$(){if(p$.track){if(this.id!==p$.track.id)return;p$.track.removeEventListener("ended",f$)}let m$=Bd.get(p$);if(m$){Bd.delete(p$);try{var g$,v$;(g$=m$.controller)===null||g$===void 0||g$.terminate(),(v$=m$.worker)===null||v$===void 0||v$.terminate()}catch(y$){_.warning(y$&&y$.message)}}}Bd.set(p$,_$),p$.track.addEventListener("ended",f$)}(h$.sender))}),t$.forEach(d$=>{let{type:h$}=d$;r$.statsCollector.addLocalStats(h$)}),r$.assignLocalTracks(t$,u$),r$.statsUploader.startUploadOutboundStats(),t$.forEach(d$=>{let{track:h$,type:p$}=d$,_$=Date.now();r$.store.publish(h$.getTrackId(),p$===U.LocalAudioTrack?"audio":"video",void 0,_$)})})()}async updateVideoStreamParameter(e$,t$){let r$=this.localTrackMap.get(t$);if(!r$)return;if(!(r$.track instanceof Ft))return _.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof ki||this.connection instanceof Va))return _.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");let{track:n$}=r$,i$=function(o$,s$){let a$={};return o$.height&&o$.width&&(a$.scaleResolutionDownBy=GE(o$,s$)),a$.maxFramerate=o$.framerate?Nn(o$.framerate):void 0,a$.maxBitrate=o$.bitrate?1e3*o$.bitrate:void 0,a$}(e$,n$);if(n$._encoderConfig||(n$._encoderConfig={}),t$!==U.LocalVideoLowTrack||!v("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding)i$.scaleResolutionDownBy!=null&&(n$._encoderConfig.scaleResolutionDownBy=i$.scaleResolutionDownBy);else{let o$=n$._originMediaStreamTrack;if(!o$.canvas)return _.warn("[".concat(n$.getTrackId(),"] no canvas on track"));(function(s$,a$){let c$=s$.canvas;a$.width&&(c$.width=Nn(a$.width)),a$.height&&(c$.height=Nn(a$.height)),a$.framerate&&(c$.stopCapture&&c$.stopCapture(),c$.stopCapture=Rf(()=>{!c$.startCapture&&c$.stopCapture&&c$.stopCapture(),c$.startCapture&&c$.startCapture()},Nn(a$.framerate)))})(o$,e$)}i$.maxBitrate!=null&&(n$._encoderConfig.bitrateMax=i$.maxBitrate/1e3),i$.maxFramerate!=null&&(n$._encoderConfig.frameRate&&typeof n$._encoderConfig.frameRate=="object"?n$._encoderConfig.frameRate.max=i$.maxFramerate:n$._encoderConfig.frameRate={max:i$.maxFramerate}),_.debug("[".concat(n$.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(n$._encoderConfig))),await this.connection.updateRtpSenderEncodings(n$)}publishLowStream(e$){var t$=this;return Bi(function*(){if(!t$.connection||t$.state!==Rt.Connected)return;let r$=yield Tt(t$.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let i$=t$.localTrackMap.get(U.LocalVideoTrack);if(!i$)throw new N(R.UNEXPECTED_ERROR,"Could not find high stream");if(t$.localTrackMap.has(U.LocalVideoLowTrack))throw new N(R.UNEXPECTED_ERROR,"[".concat(t$.store.clientId,"] Can't publish low stream when stream already publish"));let o$=[{track:t$.getLowVideoTrack(i$.track,e$),type:U.LocalVideoLowTrack}];if(yield*kv(Hv(t$.doPublish(t$.connection,o$))),i$.track.muted||!i$.track.enabled){var n$;let s$=(n$=t$.localTrackMap.get(U.LocalVideoLowTrack))===null||n$===void 0?void 0:n$.id;s$!==void 0&&(yield Tt(t$.connection.muteLocal([s$])))}}finally{r$()}})()}async republish(){this.pendingLocalTracks.length>0&&(_.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ge(this,tt.RequestRePublish,this.pendingLocalTracks),this.emit(tt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(_.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Ge(this,tt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e$){for(let t$=this.pendingRemoteTracks.length-1;t$>=0;t$--){let{user:r$,kind:n$}=this.pendingRemoteTracks[t$];(n$!==Q.AUDIO||r$._audio_added_&&r$._audioSSRC)&&(n$!==Q.VIDEO||r$._video_added_&&r$._videoSSRC)||this.pendingRemoteTracks.splice(t$,1)}if(e$)await Ge(this,tt.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t$,kind:r$}of this.pendingRemoteTracks)await this.subscribe(t$,r$,r$===Q.VIDEO?t$._videoSSRC:t$._audioSSRC);this.pendingRemoteTracks.forEach(t$=>{let{user:r$}=t$;this.emit(tt.MediaReconnectEnd,r$.uid)}),this.pendingRemoteTracks=[]}async unpublish(e$){if(!this.connection||this.state!==Rt.Connected)return void e$.forEach(n$=>{let i$=this.pendingLocalTracks.indexOf(n$);i$!==-1&&this.pendingLocalTracks.splice(i$,1)});let t$=this.filterTobeUnpublishedTracks(e$);if(t$.length===0)return;let r$=t$.find(n$=>n$[0]==="videoLowTrack");return r$&&r$[1].track.close(),this.doUnpublish(this.connection,t$)}async unpublishDataChannel(e$){if(!this.connection||this.state!==Rt.Connected)return void e$.forEach(r$=>{let n$=this.pendingLocalDataChannels.indexOf(r$);n$!==-1&&this.pendingLocalDataChannels.splice(n$,1)});let t$=this.filterTobeUnpublishedDataChannels(e$);return t$.length!==0?(t$.forEach(r$=>{let n$=this.localDataChannels.indexOf(r$);n$!==-1&&this.localDataChannels.splice(n$,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t$.map(r$=>r$.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Rt.Connected)return;let e$=this.localTrackMap.get(U.LocalVideoLowTrack);if(!e$)return;e$.track.close();let t$=[[U.LocalVideoLowTrack,e$]];return this.doUnpublish(this.connection,t$)}async doUnpublish(e$,t$){let r$=this.createGatewayUnpublishMessage(t$);return await e$.stopSending(t$.map(n$=>{let[,{id:i$}]=n$;return i$})),this.withdrawLocalTracks(t$),this.unbindLocalTrackEvents(t$.map(n$=>{let[i$,{track:o$}]=n$;return{type:i$,track:o$}})),t$.forEach(n$=>{let[i$]=n$;this.statsCollector.removeLocalStats(i$)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),r$}async subscribeDataChannel(e$,t$){if(!this.connection||this.state!==Rt.Connected)throw new N(R.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let r$=t$.filter(n$=>{var i$;return!((i$=this.remoteDataChannelMap.get(e$))!==null&&i$!==void 0&&i$.get(n$.id))});if(r$.length!==0)return await this.connection.createDataChannels(e$.uid,r$),r$.forEach(n$=>{var i$;this.remoteDataChannelMap.has(e$)?(i$=this.remoteDataChannelMap.get(e$))===null||i$===void 0||i$.set(n$.id,n$):this.remoteDataChannelMap.set(e$,new Map([[n$.id,n$]]));let o$=this.pendingRemoteDataChannels.findIndex(s$=>{let{user:a$,id:c$}=s$;return a$.uid===e$.uid&&c$===n$.id});o$!==-1&&this.pendingRemoteDataChannels.splice(o$,1)}),r$.map(n$=>n$.id)}async subscribe(e$,t$,r$,n$,i$){var o$;if(!this.connection||this.state!==Rt.Connected)throw new N(R.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((o$=this.remoteUserMap.get(e$))!==null&&o$!==void 0&&o$.has(t$))return;let s$,a$,c$,u$=this.connection.getPreMedia(r$);if(u$)_.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r$,", no need to send sub to gateway.")),c$=u$.transceiver,s$=u$.track,a$=u$.id;else if(i$){let h$=i$.find(_$=>{let{stream_type:f$}=_$;return f$===t$});if(!h$)throw new N(R.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t$," for user: ").concat(e$.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t$,"."));let p$=await this.connection.receive(t$,h$.ssrcs,String(e$._uintid),h$.attributes);this.connection instanceof ki&&(c$=p$.transceiver),s$=p$.track,a$=p$.id}else{let h$=await this.connection.receive(t$,[{ssrcId:r$,rtx:n$}],String(e$._uintid),void 0);this.connection instanceof ki&&(c$=h$.transceiver),s$=h$.track,a$=h$.id}t$===Q.AUDIO?(e$._audioTrack?e$._audioTrack._updateOriginMediaStreamTrack(s$):(e$._audioTrack=new Ks(s$,e$.uid,e$._uintid,this.store),_.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e$._audioTrack.getTrackId()))),c$&&e$._audioTrack._updateRtpTransceiver(c$),this.bindRemoteTrackEvents(e$,e$._audioTrack)):(e$._videoTrack?e$._videoTrack._updateOriginMediaStreamTrack(s$):(e$._videoTrack=new Hs(s$,e$.uid,e$._uintid,this.store),_.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e$._videoTrack.getTrackId()))),c$&&e$._videoTrack._updateRtpTransceiver(c$),this.bindRemoteTrackEvents(e$,e$._videoTrack)),v("ENABLE_VIDEO_SEI")&&c$&&(t$==Q.VIDEO?await async function(h$){let p$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ft().supportWebRTCEncodedTransform)return void _.warning("browser not support video encoded transform");if(!h$.track)return;if(xa.has(h$)){let m$=xa.get(h$);return void(m$&&(m$.onSei=p$.onSei))}let _$={track:h$.track,onSei:p$.onSei};if(oo()){if(!h$.createEncodedStreams)return void _.warning("browser not support createEncodedStreams() API");let m$=null;try{m$=h$.createEncodedStreams()}catch(v$){return void _.error("create video-encoded-streams error",v$&&v$.message)}let g$=new TransformStream({transform(v$,y$){_$.controller||(_$.controller=y$),h$.track&&h$.track.id!==_$.track.id&&(_.debug("video track changed: ".concat(_$.track.id," => ").concat(h$.track.id)),_$.track.removeEventListener("ended",f$),_$.track=h$.track,_$.track.addEventListener("ended",f$));let S$=function(b$){let $$=new DataView(b$.data),C$=0;for(;C$+4<b$.data.byteLength;){if($$.getUint8(C$+0)===0&&$$.getUint8(C$+1)===0&&$$.getUint8(C$+2)===0&&$$.getUint8(C$+3)===1&&$$.getUint8(C$+4)===6){let N$=C$+6,k$=0,O$=0;for(;(O$=$$.getUint8(N$++))===255;)k$+=255;k$+=O$;let U$=FG(b$.data,N$,k$);return new Uint8Array(U$)}C$++}return null}(v$);S$&&_$.onSei&&_$.onSei(S$),y$.enqueue(v$)}});m$.readable.pipeThrough(g$).pipeTo(m$.writable)}else if(je()){if(typeof RTCRtpScriptTransform>"u")return void _.warning("browser not support RTCRtpScriptTransform");let m$=vl(),g$=new MessageChannel;await new j(y$=>m$.onmessage=S$=>{S$.data==="registered"&&y$(void 0)});let v$=new RTCRtpScriptTransform(m$,{name:"rx",port:g$.port2},[g$.port2]);h$.transform=v$,await new j(y$=>m$.onmessage=S$=>{S$.data==="started"&&y$(void 0)}),g$.port1.onmessage=y$=>{var S$;y$.data.transformed&&h$.track&&((S$=h$.track)===null||S$===void 0?void 0:S$.id)!==_$.track.id?(_.debug("video track changed: ".concat(_$.track.id," => ").concat(h$.track.id)),_$.track.removeEventListener("ended",f$),_$.track=h$.track,_$.track.addEventListener("ended",f$)):y$.data.sei&&_$.onSei&&_$.onSei(y$.data.sei)},_$.worker=m$}function f$(){if(h$.track){if(this.id!==h$.track.id)return;h$.track.removeEventListener("ended",f$)}(function(m$){let g$=xa.get(m$);if(g$){xa.delete(m$);try{var v$,y$;(v$=g$.controller)===null||v$===void 0||v$.terminate(),(y$=g$.worker)===null||y$===void 0||y$.terminate()}catch(S$){_.warning(S$&&S$.message)}}})(h$)}xa.set(h$,_$),h$.track.addEventListener("ended",f$)}(c$.receiver,{onSei:h$=>{var p$;(p$=e$._videoTrack)===null||p$===void 0||p$._onSei(h$)}}):t$==Q.AUDIO&&await async function(h$){if(!ft().supportWebRTCEncodedTransform)return void _.warning("browser not support audio encoded transform");if(jd.has(h$))return;let p$={track:h$.track};if(oo()){if(!h$.createEncodedStreams)return void _.warning("browser not support createEncodedStreams() API");let f$=null;try{f$=h$.createEncodedStreams()}catch(g$){return void _.error("create audio-encoded-streams error",g$&&g$.message)}let m$=new TransformStream({transform(g$,v$){p$.controller||(p$.controller=v$),h$.track&&h$.track.id!==p$.track.id&&(_.debug("audio track changed: ".concat(p$.track.id," => ").concat(h$.track.id)),p$.track.removeEventListener("ended",_$),p$.track=h$.track,p$.track.addEventListener("ended",_$)),v$.enqueue(g$)}});f$.readable.pipeThrough(m$).pipeTo(f$.writable)}else if(je()){if(typeof RTCRtpScriptTransform>"u")return void _.warning("browser not support RTCRtpScriptTransform");let f$=vl(),m$=new MessageChannel;await new j(v$=>f$.onmessage=y$=>{y$.data==="registered"&&v$(void 0)});let g$=new RTCRtpScriptTransform(f$,{name:"rx",port:m$.port2},[m$.port2]);h$.transform=g$,await new j(v$=>f$.onmessage=y$=>{y$.data==="started"&&v$(void 0)}),m$.port1.onmessage=v$=>{var y$;v$.data.transformed&&h$.track&&((y$=h$.track)===null||y$===void 0?void 0:y$.id)!==p$.track.id&&(_.debug("audio track changed: ".concat(p$.track.id," => ").concat(h$.track.id)),p$.track.removeEventListener("ended",_$),p$.track=h$.track,p$.track.addEventListener("ended",_$))},p$.worker=f$}function _$(){h$.track.removeEventListener("ended",_$),function(f$){let m$=jd.get(f$);if(m$){jd.delete(f$);try{var g$,v$;(g$=m$.controller)===null||g$===void 0||g$.terminate(),(v$=m$.worker)===null||v$===void 0||v$.terminate()}catch(y$){_.warning(y$&&y$.message)}}}(h$)}jd.set(h$,p$),h$.track.addEventListener("ended",_$)}(c$.receiver));let l$=this.remoteUserMap.get(e$);l$?l$.set(t$,a$):this.remoteUserMap.set(e$,new Map([[t$,a$]])),this.statsCollector.addRemoteStats(e$.uid),this.statsUploader.startUploadInboundStats();let d$=this.pendingRemoteTracks.findIndex(h$=>{let{user:p$,kind:_$}=h$;return p$.uid===e$.uid&&t$===_$});d$!==-1&&(this.pendingRemoteTracks.splice(d$,1),this.emit(tt.MediaReconnectEnd,e$.uid))}async massSubscribe(e$){return this.massSubscribeNoLock(e$)}async massSubscribeNoLock(e$){if(!this.connection||this.state!==Rt.Connected)throw new N(R.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e$=e$.filter(i$=>{var o$;let{user:s$,mediaType:a$}=i$;return!((o$=this.remoteUserMap.get(s$))!==null&&o$!==void 0&&o$.has(a$))});let t$=[],r$=new Map;e$.forEach(i$=>{if(!this.connection)return;let o$=this.connection.getPreMedia(i$.ssrcId);o$?r$.set(i$.ssrcId,o$):t$.push(i$)});let n$=await this.connection.batchReceive(t$.map(i$=>{let{user:o$,mediaType:s$,ssrcId:a$,rtxSsrcId:c$}=i$;return{kind:s$,ssrcMsg:[{ssrcId:a$,rtx:c$}],mslabel:String(o$._uintid)}}));t$.forEach((i$,o$)=>{r$.set(i$.ssrcId,n$[o$])}),e$.forEach(i$=>{let{user:o$,mediaType:s$,ssrcId:a$}=i$,c$=r$.get(a$);if(!c$)return void _.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(o$.uid," subscribe data,").concat(s$,", ").concat(a$));let{track:u$,id:l$,transceiver:d$}=c$;s$===Q.AUDIO?(o$._audioTrack?o$._audioTrack._updateOriginMediaStreamTrack(u$):(o$._audioTrack=new Ks(u$,o$.uid,o$._uintid,this.store),_.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o$._audioTrack.getTrackId()))),d$&&o$._audioTrack._updateRtpTransceiver(d$),this.bindRemoteTrackEvents(o$,o$._audioTrack)):(o$._videoTrack?o$._videoTrack._updateOriginMediaStreamTrack(u$):(o$._videoTrack=new Hs(u$,o$.uid,o$._uintid,this.store),_.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o$._videoTrack.getTrackId()))),d$&&o$._videoTrack._updateRtpTransceiver(d$),this.bindRemoteTrackEvents(o$,o$._videoTrack));let h$=this.remoteUserMap.get(o$);h$?h$.set(s$,l$):this.remoteUserMap.set(o$,new Map([[s$,l$]])),this.statsCollector.addRemoteStats(o$.uid),this.statsUploader.startUploadInboundStats();let p$=this.pendingRemoteTracks.findIndex(_$=>{let{user:f$,kind:m$}=_$;return f$.uid===o$.uid&&s$===m$});p$!==-1&&(this.pendingRemoteTracks.splice(p$,1),this.emit(tt.MediaReconnectEnd,o$.uid))})}async unsubscribe(e$,t$,r$){let n$=this.pendingRemoteTracks.filter(s$=>{let{user:a$,kind:c$}=s$;return t$!==void 0?a$.uid===e$.uid&&t$===c$:a$.uid===e$.uid});if(n$.forEach(s$=>{let a$=this.pendingRemoteTracks.indexOf(s$);this.pendingRemoteTracks.splice(a$,1)}),this.connection&&this.state===Rt.Connected||r$||n$.forEach(s$=>{let{kind:a$}=s$;var c$;if(a$===Q.AUDIO)(c$=e$._audioTrack)===null||c$===void 0||c$._destroy(),e$._audioTrack=void 0;else if(a$===Q.VIDEO){var u$;(u$=e$._videoTrack)===null||u$===void 0||u$._destroy(),e$._videoTrack=void 0}}),!this.connection||this.state!==Rt.Connected)return;let i$=this.filterTobeUnSubscribedTracks(e$,t$);if(i$.length===0)return;await this.connection.stopReceiving(i$.map(s$=>{let[,{id:a$}]=s$;return a$}));let o$=this.createUnsubscribeMessage(i$);return this.withdrawRemoteTracks(i$),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i$.forEach(s$=>{let[a$,{kind:c$}]=s$;var u$,l$;if(c$===Q.VIDEO&&a$._videoSSRC&&((u$=this.connection)===null||u$===void 0||u$.setStatsRemoteVideoIsReady(a$._videoSSRC,!1)),c$===Q.VIDEO)this.unbindRemoteTrackEvents(a$._videoTrack),r$||((l$=a$._videoTrack)===null||l$===void 0||l$._destroy(),a$._videoTrack=void 0);else if(c$===Q.AUDIO){var d$;this.unbindRemoteTrackEvents(a$._audioTrack),!r$&&((d$=a$._audioTrack)===null||d$===void 0||d$._destroy(),a$._audioTrack=void 0)}}),o$}async unsubscribeDataChannel(e$,t$){if(t$.forEach(i$=>{let o$=this.pendingRemoteDataChannels.findIndex(s$=>s$.id===i$.id);o$!==-1&&this.pendingRemoteDataChannels.splice(o$,1)}),!this.connection)return;let r$=this.filterTobeUnSubscribedDataChannels(e$,t$);if(r$.length===0)return;t$.forEach(i$=>{i$._close()});let n$=this.remoteDataChannelMap.get(e$);return r$.forEach(i$=>{n$&&n$.delete(i$.id)}),n$&&n$.size===0&&(this.remoteDataChannelMap.delete(e$),await this.connection.stopDataChannels(e$.uid)),r$.map(i$=>i$.id)}async massUnsubscribe(e$){return this.massUnsubscribeNoLock(e$)}async massUnsubscribeNoLock(e$){let t$=[];for(let{user:i$,mediaType:o$}of e$){let s$=this.pendingRemoteTracks.filter(a$=>{let{user:c$,kind:u$}=a$;return o$!==void 0?c$.uid===i$.uid&&o$===u$:c$.uid===i$.uid});s$.forEach(a$=>{let c$=this.pendingRemoteTracks.indexOf(a$);this.pendingRemoteTracks.splice(c$,1)}),t$=t$.concat(s$)}if(!this.connection||this.state!==Rt.Connected)return void t$.forEach(i$=>{let{user:o$,kind:s$}=i$;var a$;if(s$===Q.AUDIO)(a$=o$._audioTrack)===null||a$===void 0||a$._destroy(),o$._audioTrack=void 0;else if(s$===Q.VIDEO){var c$;(c$=o$._videoTrack)===null||c$===void 0||c$._destroy(),o$._videoTrack=void 0}});let r$=ji(e$).call(e$,(i$,o$)=>{let{user:s$,mediaType:a$}=o$,c$=this.filterTobeUnSubscribedTracks(s$,a$);return i$.concat(c$)},[]);if(r$.length===0)return;await this.connection.stopReceiving(r$.map(i$=>{let[,{id:o$}]=i$;return o$}));let n$=this.createUnsubscribeAllMessage(r$);return this.withdrawRemoteTracks(r$),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r$.forEach(i$=>{let[o$,{kind:s$}]=i$;var a$,c$;if(s$===Q.VIDEO&&o$._videoSSRC&&((a$=this.connection)===null||a$===void 0||a$.setStatsRemoteVideoIsReady(o$._videoSSRC,!1)),s$===Q.VIDEO)this.unbindRemoteTrackEvents(o$._videoTrack),(c$=o$._videoTrack)===null||c$===void 0||c$._destroy(),o$._videoTrack=void 0;else if(s$===Q.AUDIO){var u$;this.unbindRemoteTrackEvents(o$._audioTrack),(u$=o$._audioTrack)===null||u$===void 0||u$._destroy(),o$._audioTrack=void 0}}),n$}isPreSubScribe(e$){return!this.connection||this.state!==Rt.Connected?!1:!!this.connection.getPreMedia(e$)}async muteRemote(e$,t$){if(!this.connection)return;let r$=this.remoteUserMap.get(e$);if(!r$)return void _.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e$.uid,"."));if(!r$.get(t$))return void _.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e$.uid," media type ").concat(t$,"."));let n$=t$===Q.VIDEO?e$._videoSSRC:e$._audioSSRC;n$!==void 0&&this.connection.setStatsRemoteVideoIsReady(n$,!1)}async unmuteRemote(e$,t$){return this.unmuteRemoteNoLock(e$,t$)}async unmuteRemoteNoLock(e$,t$){if(!this.connection)return;let r$=this.remoteUserMap.get(e$);if(!r$)return void _.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e$.uid,"."));r$.get(t$)||_.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e$.uid," media type ").concat(t$,"."))}getAllTracks(e$){let t$=this.localTrackMap.get(U.LocalAudioTrack);if((t$==null?void 0:t$.track)instanceof ge){let r$=t$.track;return Array.from(this.localTrackMap.entries()).filter(n$=>{let[i$]=n$;return i$!==U.LocalAudioTrack}).filter(n$=>{let[i$]=n$;return!(e$&&i$===U.LocalVideoLowTrack)}).map(n$=>{let[,{track:i$}]=n$;return i$}).concat(r$.trackList)}return Array.from(this.localTrackMap.entries()).filter(r$=>{let[n$]=r$;return!(e$&&n$===U.LocalVideoLowTrack)}).map(r$=>{let[,{track:n$}]=r$;return n$})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e$,t$,r$,n$,i$){if(e$){let s$=this.localTrackMap.get(U.LocalAudioTrack),a$=n$?this.localTrackMap.get(U.LocalVideoLowTrack):this.localTrackMap.get(U.LocalVideoTrack);X.publish(this.store.sessionId,{eventElapse:qe.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e$,ec:t$,audioName:s$==null?void 0:s$.track.getTrackLabel(),videoName:a$==null?void 0:a$.track.getTrackLabel(),screenshare:(a$==null?void 0:a$.track._hints.indexOf(Gt.SCREEN_TRACK))!==-1,audio:!!s$,video:!!a$,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i$})}else{var o$;r$||(r$=[]);let s$=r$.find(c$=>c$ instanceof Qt),a$=n$?(o$=this.localTrackMap.get(U.LocalVideoTrack))===null||o$===void 0?void 0:o$.track:r$.find(c$=>c$ instanceof Ft);X.publish(this.store.sessionId,{eventElapse:qe.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e$,ec:t$,audioName:s$==null?void 0:s$.getTrackLabel(),videoName:a$==null?void 0:a$.getTrackLabel(),screenshare:(a$==null?void 0:a$._hints.indexOf(Gt.SCREEN_TRACK))!==-1,audio:!!s$,video:!!a$,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i$})}}reportSubscribeEvent(e$,t$,r$,n$){let i$=n$===Q.VIDEO?r$._videoSSRC:r$._audioSSRC;i$&&X.subscribe(this.store.sessionId,{succ:e$,ec:t$,video:n$===Q.VIDEO,audio:n$===Q.AUDIO,peerid:r$.uid,subscribeRequestid:i$,p2pid:this.store.p2pId,eventElapse:qe.measureFromSubscribeStart(this.store.clientId,i$),preSsrc:this.isPreSubScribe(i$)})}reset(){_.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new ze("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Va({},this.store):new ki({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e$=this.localTrackMap.get(U.LocalAudioTrack);if((e$==null?void 0:e$.track)instanceof ge){if(e$.track.trackList.length>0){let t$=e$.track;e$.track.trackList.forEach(r$=>{t$.removeAudioTrack(r$)})}e$.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Rt.Disconnected}getStats(){var e$;return(e$=this.connection)===null||e$===void 0?void 0:e$.getStats()}getRemoteVideoIsReady(e$){var t$;return((t$=this.connection)===null||t$===void 0?void 0:t$.getRemoteVideoIsReady(e$))||!1}getLocalAudioVolume(){let e$=this.localTrackMap.get(U.LocalAudioTrack);if(e$)return e$.track.getVolumeLevel()}getLocalVideoSize(){let e$=this.localTrackMap.get(U.LocalVideoTrack);if(e$)return{width:e$.track.videoWidth||0,height:e$.track.videoHeight||0}}getEncoderConfig(e$){let t$=this.localTrackMap.get(e$);return t$&&t$.track instanceof Ft||t$&&t$.track instanceof Qt?t$.track._encoderConfig:void 0}getLocalMedia(e$){return this.localTrackMap.get(e$)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e$,t$){if(!e$)return this.remoteUserMap.size>0;let r$=this.remoteUserMap.get(e$);return!!r$&&(!t$||r$.has(t$))}async hasRemoteMediaWithLock(e$,t$){if(!e$)return this.remoteUserMap.size>0;let r$=this.remoteUserMap.get(e$);return!!r$&&(!t$||r$.has(t$))}getRemoteMedia(e$){var t$;let r$=Array.from(xn(t$=this.remoteUserMap).call(t$)).find(n$=>n$.uid===e$);return r$?{audioTrack:r$.audioTrack,audioSSRC:r$._audioSSRC,videoTrack:r$.videoTrack,videoSSRC:r$._videoSSRC}:{}}getAudioLevels(){let e$=Array.from(this.remoteUserMap.entries()).map(r$=>{let[n$]=r$;return{uid:n$.uid,level:n$.audioTrack?100*n$.audioTrack._source.getAccurateVolumeLevel():0}}),t$=this.localTrackMap.get(U.LocalAudioTrack);return t$&&e$.push({level:100*t$.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e$=ed(e$).call(e$,(r$,n$)=>r$.level-n$.level),e$}async disconnectForReconnect(){this.connection&&(_.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Rt.Reconnecting,v("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e$=>{let[t$]=e$;var r$;t$._videoTrack&&t$._videoTrack._player&&((r$=t$._videoTrack._player.getVideoElement())===null||r$===void 0||r$.pause(),t$._videoTrack._player.isKeepLastFrame=!0,t$._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Va({},this.store):new ki({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e$=>{var t$;let[r$,{track:n$}]=e$;switch(r$){case U.LocalVideoTrack:W(t$=n$._hints).call(t$,Gt.LOW_STREAM)?n$.close():this.pendingLocalTracks.push(n$);break;case U.LocalAudioTrack:n$ instanceof ge?this.pendingLocalTracks=this.pendingLocalTracks.concat(n$.trackList):this.pendingLocalTracks.push(n$);case U.LocalVideoLowTrack:}}),this.emit(tt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e$=>{let[t$,r$]=e$;Array.from(xn(r$).call(r$)).forEach(n$=>{this.setPendingRemoteMedia(t$,n$)}),this.emit(tt.MediaReconnectStart,t$.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e$=>{this.pendingLocalDataChannels.push(e$)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e$=>{let[t$,r$]=e$;Array.from(xn(r$).call(r$)).forEach(n$=>{this.setPendingRemoteDataChannel(t$,n$)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),_.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e$,t$){for(let r$ of this.pendingRemoteDataChannels){let{user:n$,id:i$}=r$;if((e$ instanceof ir?e$.uid:e$)===n$.uid&&i$===t$)return!0}return!1}setPendingRemoteDataChannel(e$,t$){this.hasPendingRemoteDataChannel(e$,t$)||this.pendingRemoteDataChannels.push({user:e$,id:t$})}hasPendingRemoteMedia(e$,t$){for(let r$ of this.pendingRemoteTracks){let{user:n$,kind:i$}=r$;if((e$ instanceof ir?e$.uid:e$)===n$.uid&&t$===i$)return!0}return!1}setPendingRemoteMedia(e$,t$){this.hasPendingRemoteMedia(e$,t$)||this.pendingRemoteTracks.push({user:e$,kind:t$})}restartICE(e$){var t$=this;return Bi(function*(){if(!t$.connection||t$.state!==Rt.Connected)return;let r$=yield Tt(t$.mutex.lock("From P2PChannel.restartICE")),n$;try{n$=yield Tt(t$.connection.restartICE(e$));let o$=yield Tt(n$.next());if(o$.done)return;let s$=o$.value,a$=yield s$;switch(t$.reportPCDisconnectedOrFailed(e$),e$){case On.TCP:t$._pcStatsUploadType=Tr.TCP_RESTART;break;case On.RELAY:t$._pcStatsUploadType=Tr.RELAY_RESTART;break;default:t$._pcStatsUploadType=Tr.OLD_RESTART}t$._isInRestartIce=!0,n$.next(a$)}catch(o$){var i$;(i$=n$)===null||i$===void 0||i$.throw(o$)}finally{r$()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e$=this.connection.getStats(),t$=this.localTrackMap.get(U.LocalVideoTrack),r$=this.localTrackMap.get(U.LocalAudioTrack),n$=e$.videoSend.find(p$=>p$.ssrc===(t$==null?void 0:t$.ssrcs[0].ssrcId)),i$=e$.audioSend.find(p$=>p$.ssrc===(r$==null?void 0:r$.ssrcs[0].ssrcId));if(!n$||!i$)return 1;let o$=ni(this,tt.NeedSignalRTT),s$=n$?n$.rttMs:void 0,a$=i$?i$.rttMs:void 0,c$=s$&&a$?(s$+a$)/2:s$||a$,u$=(c$&&o$?(c$+o$)/2:c$||o$)||0,l$=100*e$.sendPacketLossRate*.7/50+.3*u$/1500,d$=l$<.17?1:l$<.36?2:l$<.59?3:l$<.1?4:5,h$=t$==null?void 0:t$.track;if(h$&&h$._encoderConfig&&h$._hints.indexOf(Gt.SCREEN_TRACK)===-1){let p$=h$._encoderConfig.bitrateMax,_$=e$.bitrate.actualEncoded;if(p$&&_$){let f$=(1e3*p$-_$)/(1e3*p$);return OO[f$<.15?0:f$<.3?1:f$<.45?2:f$<.6?3:4][d$]}}return d$}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e$=this.connection.getStats(),t$=0;return Array.from(this.remoteUserMap.entries()).forEach(r$=>{let[n$]=r$,i$=n$._audioSSRC,o$=n$._videoSSRC,s$=e$.audioRecv.find(_$=>_$.ssrc===i$),a$=e$.videoRecv.find(_$=>_$.ssrc===o$);if(!s$&&!a$)return void(t$+=1);let c$=ni(this,tt.NeedSignalRTT),u$=e$.rtt,l$=(u$&&c$?(u$+c$)/2:u$||c$)||0,d$=s$?s$.jitterMs:void 0,h$=e$.recvPacketLossRate,p$=.7*h$*100/50+.3*l$/1500;d$&&(p$=.6*h$*100/50+.2*l$/1500+.2*d$/400),t$+=p$<.1?1:p$<.17?2:p$<.36?3:p$<.59?4:5}),this.remoteUserMap.size>0?Math.round(t$/this.remoteUserMap.size):t$}async muteLocalTrack(e$){return new j((t$,r$)=>{this.handleMuteLocalTrack(e$,t$,r$)})}async replaceTrack(e$,t$){var r$;if(_.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e$.getTrackId(),"] to [").concat(t$.getTrackId(),"]")),!this.connection||this.state!==Rt.Connected)return;let n$=Array.from(this.localTrackMap.entries()).find(o$=>{let[,{track:s$}]=o$;return e$===s$});if(!n$)return;let i$=n$[0];if(e$!==t$&&(this.unbindLocalTrackEvents([{track:e$,type:i$}]),this.bindLocalTrackEvents([{track:t$,type:i$}]),n$[1].track=t$),await((r$=this.connection)===null||r$===void 0?void 0:r$.replaceTrack(t$,n$[1].id)),this.isPlanB){let o$=n$[1];o$.id=t$._mediaStreamTrack.id,this.localTrackMap.set(i$,o$)}if(i$===U.LocalVideoTrack&&!v("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding){let o$=this.localTrackMap.get(U.LocalVideoLowTrack);if(o$){let s$=e$._mediaStreamTrack.clone();o$.track._originMediaStreamTrack.stop(),o$.track._mediaStreamTrack=s$,o$.track._originMediaStreamTrack=s$,await new j((a$,c$)=>{this.handleReplaceTrack(o$.track,a$,c$,!0)})}}}filterTobePublishedTracks(e$,t$,r$){let n$=[],i$=this.getAllTracks();e$=Ls(e$=e$.filter(c$=>i$.indexOf(c$)===-1));let o$,s$=!1,a$=this.localTrackMap.get(U.LocalAudioTrack);for(let c$ of e$){if(c$ instanceof Ft&&(this.localTrackMap.has(U.LocalVideoTrack)||s$?new N(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n$.push({track:c$,type:U.LocalVideoTrack}),s$=!0),t$)){let u$=this.getLowVideoTrack(c$,r$);n$.push({track:u$,type:U.LocalVideoLowTrack})}if(c$ instanceof Qt)if(a$){let u$=a$.track;if(u$ instanceof ge)lm([c$]),u$.addAudioTrack(c$),this.bindLocalAudioTrackEvents(c$,!0);else{let l$=E_([u$,c$]);_.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(l$.getTrackId(),"]")),this.replaceTrack(u$,l$)}}else o$ instanceof ge?(lm([c$]),o$.addAudioTrack(c$)):o$||!c$._useAudioElement&&ft().webAudioMediaStreamDest&&!c$._bypassWebAudio?o$=E_(o$?[c$,o$]:[c$]):o$=c$}return o$&&(_.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o$.getTrackId(),"]")),n$.push({track:o$,type:U.LocalAudioTrack})),n$}filterTobeUnpublishedTracks(e$){let t$=[],r$=this.getAllTracks();e$=Ls(e$=e$.filter(n$=>r$.indexOf(n$)!==-1));for(let n$ of e$){if(n$ instanceof Qt){let i$=this.localTrackMap.get(U.LocalAudioTrack);if(!i$)continue;i$.track instanceof ge?(i$.track.removeAudioTrack(n$),this.unbindLocalAudioTrackEvents(n$),i$.track.trackList.length===0&&(t$.push([U.LocalAudioTrack,i$]),i$.track.close())):t$.push([U.LocalAudioTrack,i$])}if(n$ instanceof Ft){let i$=this.localTrackMap.get(U.LocalVideoTrack);if(!i$)continue;t$.push([U.LocalVideoTrack,i$]);let o$=this.localTrackMap.get(U.LocalVideoLowTrack);o$&&t$.push([U.LocalVideoLowTrack,o$])}}return t$}filterTobePublishedDataChannels(e$){return e$=(e$=Ls(e$)).filter(t$=>this.localDataChannels.findIndex(r$=>r$.id===t$.id)===-1)}filterTobeUnpublishedDataChannels(e$){return e$=(e$=(e$=Ls(e$)).filter(t$=>this.localDataChannels.indexOf(t$)!==-1)).filter(t$=>t$._originDataChannel)}bindLocalTrackEvents(e$){e$.forEach(t$=>{let{track:r$,type:n$}=t$;switch(n$){case U.LocalVideoTrack:r$.addListener(H.GET_STATS,this.handleGetLocalVideoStats),r$.addListener(H.GET_RTC_STATS,this.handleGetRTCStats),r$.addListener(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r$.addListener(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r$.addListener(H.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r$.addListener(H.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r$.addListener(H.NEED_REPLACE_TRACK,this.handleReplaceTrack),r$.addListener(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r$.addListener(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case U.LocalAudioTrack:this.bindLocalAudioTrackEvents(r$);case U.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e$,t$){e$ instanceof ge?e$.trackList.forEach(r$=>{r$.addListener(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r$.addListener(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r$.addListener(H.GET_STATS,this.handleGetLocalAudioStats),r$.addListener(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r$.addListener(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e$.addListener(H.GET_STATS,this.handleGetLocalAudioStats),e$.addListener(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e$.addListener(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e$.addListener(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e$.addListener(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t$||(e$.addListener(H.NEED_REPLACE_TRACK,this.handleReplaceTrack),e$.addListener(H.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e$){e$||(e$=Array.from(this.localTrackMap.entries()).map(t$=>{let[r$,{track:n$}]=t$;return{track:n$,type:r$}})),e$.forEach(t$=>{let{track:r$,type:n$}=t$;switch(n$){case U.LocalVideoTrack:r$.off(H.GET_STATS,this.handleGetLocalVideoStats),r$.off(H.GET_RTC_STATS,this.handleGetRTCStats),r$.off(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r$.off(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r$.off(H.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r$.off(H.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r$.off(H.NEED_REPLACE_TRACK,this.handleReplaceTrack),r$.off(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r$.off(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case U.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r$);case U.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e$){e$ instanceof ge?e$.trackList.forEach(t$=>{t$.off(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t$.off(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t$.off(H.GET_STATS,this.handleGetLocalAudioStats),t$.off(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t$.off(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e$.off(H.GET_STATS,this.handleGetLocalAudioStats),e$.off(H.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e$.off(H.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e$.off(H.NEED_REPLACE_TRACK,this.handleReplaceTrack),e$.off(H.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e$.off(H.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e$.off(H.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e$,t$){t$ instanceof Hs&&t$.addListener(H.GET_STATS,r$=>{r$(this.handleGetRemoteVideoStats(e$))}),t$ instanceof Ks&&t$.addListener(H.GET_STATS,r$=>{r$(this.handleGetRemoteAudioStats(e$))})}unbindRemoteTrackEvents(e$){e$&&e$.removeAllListeners(H.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e$=>{let[t$,r$]=e$;r$.has(Q.AUDIO)&&this.unbindRemoteTrackEvents(t$._audioTrack),r$.has(Q.VIDEO)&&this.unbindRemoteTrackEvents(t$._videoTrack)})}createGatewayPublishMessage(e$,t$){return e$.map((r$,n$)=>{var i$;let o$,s$,{track:a$,type:c$}=r$;switch(c$){case U.LocalAudioTrack:o$=Ct.Audio,s$={dtx:a$ instanceof ou&&a$._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case U.LocalVideoTrack:o$=W(i$=a$._hints).call(i$,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High,s$=Zi(Zi({},GR(a$)),{},{codec:this.store.codec,svc_mode:$E()});break;case U.LocalVideoLowTrack:o$=Ct.Low,s$=Zi(Zi({},GR(a$)),{},{codec:this.store.codec,svc_mode:$E()})}return{stream_type:o$,attributes:s$,ssrcs:t$[n$]}})}createGatewayUnpublishMessage(e$){return e$.map(t$=>{var r$;let n$,[i$,{track:o$,ssrcs:s$,id:a$}]=t$;switch(i$){case U.LocalVideoTrack:n$=W(r$=o$._hints).call(r$,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High;break;case U.LocalAudioTrack:n$=Ct.Audio;break;case U.LocalVideoLowTrack:n$=Ct.Low}return{stream_type:n$,ssrcs:s$,mid:a$}})}assignLocalTracks(e$,t$){e$.forEach((r$,n$)=>{let{track:i$,type:o$}=r$;this.localTrackMap.set(o$,{track:i$,id:t$[n$].id,ssrcs:t$[n$].localSSRC})})}withdrawLocalTracks(e$){e$.forEach(t$=>{let[r$]=t$;this.localTrackMap.delete(r$)})}bindConnectionEvents(e$){e$.onConnectionStateChange=async t$=>{if(_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t$,")")),this.emit(tt.PeerConnectionStateChange,t$),t$!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t$==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),v("NEW_ICE_RESTART")){var r$;if(W(r$=this._restartStates).call(r$,t$)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let n$=s$=>{(e$.iceConnectionState==="disconnected"||e$.iceConnectionState==="checking"||e$.iceConnectionState==="failed")&&(_.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(s$)),ni(this,tt.QueryClientConnectionState)==="CONNECTED"&&this.emit(tt.RequestRestartICE,s$))},i$=()=>{e$.iceConnectionState!=="disconnected"&&e$.iceConnectionState!=="checking"&&e$.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),_.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(tt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},o$=v("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(v("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&ft().supportPCSetConfiguration)n$(On.RELAY),this._restartTimer=window.setTimeout(i$,o$);else if($t())n$(On.UDP),this._restartTimer=window.setTimeout(i$,4e3);else{if(n$(On.TCP),ft().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{n$(On.RELAY),this._restartTimer=window.setTimeout(i$,o$)},o$));this._restartTimer=window.setTimeout(i$,o$)}},800))}}else{if(t$==="disconnected"&&e$.iceConnectionState==="disconnected")return setTimeout(()=>{e$.iceConnectionState==="disconnected"&&v("ICE_RESTART")&&ni(this,tt.QueryClientConnectionState)==="CONNECTED"&&this.emit(tt.RequestRestartICE)},800),void setTimeout(()=>{e$.peerConnectionState==="disconnected"&&(_.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(tt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t$==="failed"&&(_.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(tt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e$.onICEConnectionStateChange=t$=>{t$!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t$,")")),X.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t$,tag:Zt.TRACER}).onSuccess(),this.emit(tt.IceConnectionStateChange,t$)},e$.onICETransportStateChange=t$=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t$,")"))},e$.onDTLSTransportStateChange=t$=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t$,")"))},e$.onDTLSTransportError=t$=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t$,")"))},e$.onFirstAudioDecoded=t$=>{var r$;let n$=Array.from(xn(r$=this.remoteUserMap).call(r$)).find(o$=>o$._audioSSRC===t$);var i$;n$&&(this.store.subscribe(n$.uid,"audio",void 0,void 0,void 0,Date.now()),(i$=n$.audioTrack)===null||i$===void 0||i$.emit(Ws.FIRST_FRAME_DECODED),X.firstRemoteFrame(this.store.sessionId,De.FIRST_AUDIO_DECODE,Jt.FIRST_AUDIO_DECODE,{peer:n$._uintid,subscribeElapse:qe.measureFromSubscribeStart(this.store.clientId,t$),subscribeRequestid:t$,p2pid:this.store.p2pId}))},e$.onFirstAudioReceived=t$=>{var r$;let n$=Array.from(xn(r$=this.remoteUserMap).call(r$)).find(i$=>i$._audioSSRC===t$);n$&&X.firstRemoteFrame(this.store.sessionId,De.FIRST_AUDIO_RECEIVED,Jt.FIRST_AUDIO_RECEIVED,{peer:n$._uintid,subscribeElapse:qe.measureFromSubscribeStart(this.store.clientId,t$),subscribeRequestid:t$,p2pid:this.store.p2pId})},e$.onFirstVideoDecoded=(t$,r$,n$)=>{this.reportVideoFirstFrameDecoded(t$,r$,n$)},e$.onFirstVideoReceived=t$=>{var r$;let n$=Array.from(xn(r$=this.remoteUserMap).call(r$)).find(i$=>i$._videoSSRC===t$);n$&&X.firstRemoteFrame(this.store.sessionId,De.FIRST_VIDEO_RECEIVED,Jt.FIRST_VIDEO_RECEIVED,{peer:n$._uintid,subscribeElapse:qe.measureFromSubscribeStart(this.store.clientId,t$),subscribeRequestid:t$,p2pid:this.store.p2pId})},e$.onSelectedLocalCandidateChanged=(t$,r$)=>{let n$=t$.candidateType==="relay",i$=r$.candidateType==="relay";r$.candidateType!=="unknown"&&n$===i$||this.emit(tt.ConnectionTypeChange,n$),_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(eo(r$))," -> ").concat(JSON.stringify(eo(t$)),")"))},e$.onSelectedRemoteCandidateChanged=(t$,r$)=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(eo(r$))," -> ").concat(JSON.stringify(eo(t$)),")"))},e$.onFirstVideoDecodedTimeout=t$=>{this.reportVideoFirstFrameDecoded(t$,void 0,void 0,!0)},e$.getLocalVideoStats=()=>{let t$=this.statsCollector.getLocalVideoTrackStats(),r$=this.statsCollector.getRTCStats();return Zi(Zi({},t$),r$)}}unbindConnectionEvents(e$){e$.onConnectionStateChange=void 0,e$.onICEConnectionStateChange=void 0,e$.onICETransportStateChange=void 0,e$.onDTLSTransportStateChange=void 0,e$.onDTLSTransportError=void 0,e$.onFirstAudioDecoded=void 0,e$.onFirstAudioReceived=void 0,e$.onFirstVideoDecoded=void 0,e$.onFirstVideoReceived=void 0,e$.onSelectedLocalCandidateChanged=void 0,e$.onSelectedRemoteCandidateChanged=void 0,e$.onFirstVideoDecodedTimeout=void 0,e$.getLocalVideoStats=void 0}filterTobeMutedTracks(e$){let t$=[];if(this.getAllTracks().indexOf(e$)===-1)return t$;let r$=this.localTrackMap.get(U.LocalAudioTrack);if(e$ instanceof Qt&&(r$==null?void 0:r$.track)instanceof ge)return r$.track.isActive||t$.push([U.LocalAudioTrack,r$]),t$;let n$=Array.from(this.localTrackMap.entries()).find(i$=>{let[,{track:o$}]=i$;return e$===o$});if(n$&&(t$.push(n$),n$[0]===U.LocalVideoTrack)){let i$=this.localTrackMap.get(U.LocalVideoLowTrack);i$&&t$.push([U.LocalVideoLowTrack,i$])}return t$}filterTobeUnmutedTracks(e$){let t$=[],r$=this.localTrackMap.get(U.LocalAudioTrack);if(e$ instanceof Qt&&(r$==null?void 0:r$.track)instanceof ge)return r$.track.isActive&&t$.push([U.LocalAudioTrack,r$]),t$;let n$=Array.from(this.localTrackMap.entries()).find(i$=>{let[,{track:o$}]=i$;return e$===o$});if(n$)if(n$[0]===U.LocalVideoTrack){t$.push(n$);let i$=this.localTrackMap.get(U.LocalVideoLowTrack);i$&&t$.push([U.LocalVideoLowTrack,i$])}else t$.push(n$);return t$}createMuteMessage(e$){return e$.map(t$=>{var r$;let n$,[i$,{track:o$,ssrcs:s$,id:a$}]=t$;switch(i$){case U.LocalAudioTrack:n$=Ct.Audio;break;case U.LocalVideoTrack:n$=W(r$=o$._hints).call(r$,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High;break;case U.LocalVideoLowTrack:n$=Ct.Low}return{stream_type:n$,ssrcs:s$,mid:a$}})}createUnmuteMessage(e$){return e$.map(t$=>{var r$;let n$,[i$,{track:o$,ssrcs:s$,id:a$}]=t$;switch(i$){case U.LocalAudioTrack:n$=Ct.Audio;break;case U.LocalVideoTrack:n$=W(r$=o$._hints).call(r$,Gt.SCREEN_TRACK)?Ct.Screen:Ct.High;break;case U.LocalVideoLowTrack:n$=Ct.Low}return{stream_type:n$,ssrcs:s$,mid:a$}})}filterTobeUnSubscribedTracks(e$,t$){let r$=[],n$=this.remoteUserMap.get(e$);if(!n$)return r$;if(t$){let i$=n$.get(t$);if(!i$)return r$;r$.push([e$,{kind:t$,id:i$}])}else Array.from(n$.entries()).forEach(i$=>{let[o$,s$]=i$;r$.push([e$,{kind:o$,id:s$}])});return r$}filterTobeUnSubscribedDataChannels(e$,t$){let r$=[];return t$.forEach(n$=>{var i$;(i$=this.remoteDataChannelMap.get(e$))!==null&&i$!==void 0&&i$.has(n$.id)&&r$.push(n$)}),r$}createUnsubscribeMessage(e$){let t$=[];return e$.forEach(r$=>{let[n$,{kind:i$,id:o$}]=r$;switch(i$){case Q.VIDEO:return void(n$._videoSSRC&&t$.push({stream_type:Q.VIDEO,ssrcId:n$._videoSSRC}));case Q.AUDIO:return void(n$._audioSSRC&&t$.push({stream_type:Q.AUDIO,ssrcId:n$._audioSSRC}))}}),t$}createUnsubscribeAllMessage(e$){let t$=new Map;return e$.forEach(r$=>{let[n$,{kind:i$}]=r$;if(t$.has(n$)){let o$=t$.get(n$);i$===Q.VIDEO?o$|=ve.Video:o$|=ve.Audio,t$.set(n$,o$)}else i$===Q.VIDEO?t$.set(n$,ve.Video):t$.set(n$,ve.Audio)}),{users:Array.from(t$.entries()).map(r$=>{let[n$,i$]=r$;return{stream_id:n$.uid,stream_type:i$}})}}withdrawRemoteTracks(e$){e$.forEach(t$=>{let[r$,{kind:n$}]=t$,i$=this.remoteUserMap.get(r$);i$&&(i$.delete(n$),Array.from(i$.entries()).length===0&&this.remoteUserMap.delete(r$))})}async updateBitrateLimit(e$){let t$=this.localTrackMap.get(U.LocalVideoTrack),r$=this.localTrackMap.get(U.LocalVideoLowTrack);t$&&await t$.track.setBitrateLimit(e$.uplink),r$&&e$.low_stream_uplink&&await r$.track.setBitrateLimit({max_bitrate:e$.low_stream_uplink.bitrate,min_bitrate:e$.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e$,t$){return e$.map((r$,n$)=>{var i$;let{stream_type:o$}=r$;return(i$=t$.find(s$=>{let{stream_type:a$}=s$;return o$===a$}))===null||i$===void 0?void 0:i$.attributes})}async tryToUnmuteAudio(e$){for(let r$=0;r$<e$.length;r$++)if(e$[r$]instanceof Qt){var t$;let n$=this.filterTobeUnmutedTracks(e$[r$]);if(n$.length===0)continue;await((t$=this.connection)===null||t$===void 0?void 0:t$.unmuteLocal(n$.map(o$=>{let[,{id:s$}]=o$;return s$})));let i$=this.createUnmuteMessage(n$);return void await kt(this,tt.RequestUnmuteLocal,i$)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e$=>{var t$;return!((t$=this.connection)===null||t$===void 0||!t$.getRemoteVideoIsReady(e$))},this.statsUploader.requestUpload=(e$,t$)=>this.emit(tt.RequestUpload,e$,t$),this.statsUploader.requestUploadStats=e$=>this.emit(tt.RequestUploadStats,e$),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Me(hf(this.dtlsFailedCount,Ee)),this.emit(tt.RequestReconnect)}async reconnectP2P(){let e$=Array.from(this.localTrackMap.entries()),t$=this.createGatewayUnpublishMessage(e$);Array.from(this.remoteUserMap.entries()),t$.length>0&&await Ge(this,tt.RequestUnpublishForReconnectPC,t$),this.disconnectForReconnect(),this.emit(tt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(U.LocalVideoTrack)||this.pendingLocalTracks.some(e$=>e$ instanceof Ft)}throwIfTrackTypeNotMatch(e$){if(e$.filter(t$=>t$ instanceof Ft).length>1)throw new N(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e$.filter(t$=>t$ instanceof Qt).length>1&&(e$.some(t$=>t$ instanceof Qt&&t$._bypassWebAudio)||!ft().webAudioMediaStreamDest))throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t$ of e$){if(t$ instanceof Ft&&this.pendingLocalTracks.some(r$=>r$ instanceof Ft))throw new N(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t$ instanceof Qt&&this.pendingLocalTracks.some(r$=>r$ instanceof Qt)&&(!ft().webAudioMediaStreamDest||t$._bypassWebAudio||this.pendingLocalTracks.some(r$=>r$ instanceof Qt&&r$._bypassWebAudio)))throw new N(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e$,t$){let r$=!v("DISABLE_DUAL_STREAM_USE_ENCODING")&&ft().supportDualStreamEncoding,n$=Zi(Zi({},{width:160,height:120,framerate:15,bitrate:50}),t$),i$;i$=r$?e$._mediaStreamTrack.clone():dm(e$,n$);let o$=Ut(8,"track-low-"),s$=new Ft(i$,Zi(Zi({},r$&&{scaleResolutionDownBy:GE(n$,e$)}),{},{frameRate:n$.framerate,bitrateMax:n$.bitrate,bitrateMin:n$.bitrate}),void 0,void 0,o$);return s$.on(Ko.TRANSCEIVER_UPDATED,a$=>{e$._updateRtpTransceiver(a$,na.LOW_STREAM)}),s$._hints.push(Gt.LOW_STREAM),e$.on("sei-to-send",a$=>{s$.emit("sei-to-send",a$)}),e$.addListener(H.NEED_CLOSE,()=>{s$.close()}),s$}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e$,t$,r$){let n$=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof ki){var i$,o$,s$,a$;let c$=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:u$,dtlsTransportState:l$,peerConnectionState:d$}=this.connection,{local:h$,remote:p$}=await this.connection.getSelectedCandidatePair();X.pcStats(this.store.sessionId,{startTime:c$,eventElapse:e$-c$||0,iceconnectionsate:u$,dtlsstate:l$,connectionstate:d$,intSucc:t$?1:2,error:n$,selectedLocalCandidateProtocol:(i$=h$==null?void 0:h$.protocol)!==null&&i$!==void 0?i$:"",selectedLocalCandidateType:(o$=h$.candidateType)!==null&&o$!==void 0?o$:"",selectedLocalCandidateAddress:"".concat(h$.address,":").concat(h$.port),selectedRemoteCandidateProtocol:(s$=p$.protocol)!==null&&s$!==void 0?s$:"",selectedRemoteCandidateType:(a$=p$.candidateType)!==null&&a$!==void 0?a$:"",selectedRemoteCandidateAddress:"".concat(p$.address,":").concat(p$.port),restartCnt:r$,preallocation:this.connection.isPreallocation})}}reportVideoFirstFrameDecoded(e$,t$,r$,n$){var i$;let o$=Array.from(xn(i$=this.remoteUserMap).call(i$)).find(s$=>s$._videoSSRC===e$);if(o$){n$||this.store.subscribe(o$.uid,"video",void 0,void 0,void 0,void 0,Date.now());let s$=this.store.keyMetrics,a$=s$.subscribe.find(c$=>c$.userId===o$.uid&&c$.type==="video");X.firstRemoteVideoDecode(this.store.sessionId,De.FIRST_VIDEO_DECODE,Jt.FIRST_VIDEO_DECODE,{peer:o$._uintid,videowidth:t$,videoheight:r$,subscribeElapse:qe.measureFromSubscribeStart(this.store.clientId,e$),subscribeRequestid:e$,p2pid:this.store.p2pId,apEnd:s$.requestAPEnd||0,apStart:s$.requestAPStart||0,joinGwEnd:s$.joinGatewayEnd||0,joinGwStart:s$.joinGatewayStart||0,pcEnd:s$.peerConnectionEnd||0,pcStart:s$.peerConnectionStart||0,subscriberEnd:(a$==null?void 0:a$.subscribeEnd)||0,subscriberStart:(a$==null?void 0:a$.subscribeStart)||0,videoAddNotify:(a$==null?void 0:a$.streamAdded)||0,state:n$?1:0,firstFrame:(a$==null?void 0:a$.firstFrame)||0})}}async remoteMediaSsrcChanged(e$,t$,r$){if(!this.connection)return!1;let n$=this.remoteUserMap.get(e$);if(!n$)return!1;let i$=n$.get(t$);if(!i$)return!1;let o$=await this.connection.getRemoteSSRC(i$);return o$!==void 0&&o$!==r$}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e$=>{let[t$,{track:r$}]=e$;t$===U.LocalVideoLowTrack?r$._updateRtpTransceiver(void 0,na.LOW_STREAM):r$._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e$){this.connection&&this.connection instanceof ki&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Tr.TCP_RESTART&&e$===On.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Tr.DISCONNECTED_OR_FAILED)))}},q(at.prototype,"startP2PConnection",[tn],Object.getOwnPropertyDescriptor(at.prototype,"startP2PConnection"),at.prototype),q(at.prototype,"connect",[tn],Object.getOwnPropertyDescriptor(at.prototype,"connect"),at.prototype),q(at.prototype,"updateRemoteRTPCapabilities",[tn],Object.getOwnPropertyDescriptor(at.prototype,"updateRemoteRTPCapabilities"),at.prototype),q(at.prototype,"publishDataChannel",[tn],Object.getOwnPropertyDescriptor(at.prototype,"publishDataChannel"),at.prototype),q(at.prototype,"unpublish",[tn],Object.getOwnPropertyDescriptor(at.prototype,"unpublish"),at.prototype),q(at.prototype,"unpublishDataChannel",[tn],Object.getOwnPropertyDescriptor(at.prototype,"unpublishDataChannel"),at.prototype),q(at.prototype,"unpublishLowStream",[tn],Object.getOwnPropertyDescriptor(at.prototype,"unpublishLowStream"),at.prototype),q(at.prototype,"subscribeDataChannel",[tn],Object.getOwnPropertyDescriptor(at.prototype,"subscribeDataChannel"),at.prototype),q(at.prototype,"subscribe",[tn],Object.getOwnPropertyDescriptor(at.prototype,"subscribe"),at.prototype),q(at.prototype,"massSubscribe",[tn],Object.getOwnPropertyDescriptor(at.prototype,"massSubscribe"),at.prototype),q(at.prototype,"unsubscribe",[tn],Object.getOwnPropertyDescriptor(at.prototype,"unsubscribe"),at.prototype),q(at.prototype,"unsubscribeDataChannel",[tn],Object.getOwnPropertyDescriptor(at.prototype,"unsubscribeDataChannel"),at.prototype),q(at.prototype,"massUnsubscribe",[tn],Object.getOwnPropertyDescriptor(at.prototype,"massUnsubscribe"),at.prototype),q(at.prototype,"muteRemote",[tn],Object.getOwnPropertyDescriptor(at.prototype,"muteRemote"),at.prototype),q(at.prototype,"unmuteRemote",[tn],Object.getOwnPropertyDescriptor(at.prototype,"unmuteRemote"),at.prototype),q(at.prototype,"hasRemoteMediaWithLock",[tn],Object.getOwnPropertyDescriptor(at.prototype,"hasRemoteMediaWithLock"),at.prototype),q(at.prototype,"disconnectForReconnect",[tn],Object.getOwnPropertyDescriptor(at.prototype,"disconnectForReconnect"),at.prototype),q(at.prototype,"updateBitrateLimit",[tn],Object.getOwnPropertyDescriptor(at.prototype,"updateBitrateLimit"),at.prototype),q(at.prototype,"remoteMediaSsrcChanged",[tn],Object.getOwnPropertyDescriptor(at.prototype,"remoteMediaSsrcChanged"),at.prototype),at);function tn(e$,t$,r$){let n$=e$[t$];if(typeof n$!="function")throw new Error("Cannot use mutex on object property.");return r$.value=async function(){let i$=this.mutex,o$=await i$.lock("From P2PChannel.".concat(t$));try{for(var s$=arguments.length,a$=new Array(s$),c$=0;c$<s$;c$++)a$[c$]=arguments[c$];return await n$.apply(this,a$)}finally{o$()}},r$}var C0={};function Ba(e$){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&_.debug("install service ".concat(e$.name)),C0[e$.name]=e$}function Za(e$){let t$=C0[e$];if(!t$)throw new N(R.INVALID_OPERATION,"".concat(e$," not found, please use AgoraRTC.use(").concat(e$,"Service) to load it first"));return t$}function Kv(e$,t$){return Za("DataStream").create(e$,t$)}function Yv(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function qv(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?Yv(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):Yv(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var EW=Date.now(),mW=20,hm=new Map,wl=new Map;async function I0(e$){let t$=hm.get(e$),r$=Array.isArray(t$)&&t$[t$.length-1],n$=wl.get(e$);if(!r$)return void(n$.isSyncing=!1);let i$={uid:r$.uid,payload:r$.payload};n$.firstRecvTs===0&&(n$.firstRecvTs=r$.recvTs,n$.firstSendTs=r$.sendTs);let o$=r$.sendTs-n$.firstSendTs,s$=o$-(Date.now()-n$.firstRecvTs);s$>0&&(n$.firstRecvTs=Date.now()-o$);let a$=r$.mediaDelay+s$;a$<=0?(t$.pop(),v0(r$.context,i$),a$=0):a$=Math.min(a$,mW),setTimeout(()=>t$.length&&I0(e$),a$)}function v0(e$,t$){e$.safeEmit(ut.STREAM_MESSAGE,t$.uid,t$.payload),e$.onStreamMessage&&e$.onStreamMessage(t$)}function fW(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r$=arguments.length>2?arguments[2]:void 0;if(!e$.syncWithAudio)return v0(r$,{uid:e$.uid,payload:e$.payload});let n$="".concat(r$.id,"-").concat(e$.uid),i$=hm.get(n$)||[],o$=i$.findIndex(u$=>e$.sendTs>=u$.sendTs),s$=qv(qv({},e$),{},{context:r$,mediaDelay:t$,recvTs:Date.now()});o$===-1?i$.push(s$):i$.splice(o$,0,s$),hm.set(n$,i$);let a$=!1;var c$;wl.has(n$)?a$=!((c$=wl.get(n$))===null||c$===void 0||!c$.isSyncing):wl.set(n$,{isSyncing:a$,firstRecvTs:0,firstSendTs:0}),a$||I0(n$)}var gW=mt().name;function zv(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function Jv(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?zv(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):zv(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var zs="websdk_ng_cache_parameter",TW=v("MAX_PRELOAD_ASYNC_LENGTH"),SW=1e4,Mo=new Map,Uo=[],f_=null,g_=0,T_=0,Xd=new Map,RW=function(e$,t$){let r$=[],n$=0,i$=async()=>{let o$=r$.shift();o$&&await o$(),r$.length>0&&n$<t$?i$():n$--};return async function(){for(var o$=arguments.length,s$=new Array(o$),a$=0;a$<o$;a$++)s$[a$]=arguments[a$];return new j(async(c$,u$)=>{r$.push(async()=>{try{let l$=await e$(...s$);c$(l$)}catch(l$){u$(l$)}}),n$<t$&&(n$++,i$())})}}(y0,TW),S_=mn.CancelToken.source();async function y0(e$,t$,r$,n$,i$,o$){try{if(!v("ENABLE_PRELOAD"))return;if(!ft().supportWebCrypto)return void po(()=>{_.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!r$&&r$!==null)throw new N(R.INVALID_PARAMS,"Invalid token: ".concat(r$,". If you don not use token, set it to null"));r$&&Pe(r$,"token",1,2047),Pe(e$,"appid",1,2047),Xu(t$),n$&&Qu(n$);let s$=Ms();_.debug("preload channel ".concat(t$,", uid is ").concat(n$));let a$={appId:e$,cname:t$,token:r$||e$,uid:typeof n$!="string"?n$:null,sid:s$,proxyServer:i$},c$,u$;typeof n$=="string"?(a$.stringUid=n$,[u$,c$]=await j.all([YG(n$,{sid:s$,appId:e$},S_.token),ev(Jv(Jv({},a$),{},{token:r$||e$,uid:0}),S_.token)]),a$.uid=u$.uid,c$.gatewayInfo.uid=a$.uid,c$.gatewayInfo.res.uid=a$.uid):(o$&&(a$.stringUid=o$),c$=await ev(a$,S_.token));let l$={sid:s$,appId:e$,cname:t$,token:r$||e$,uid:a$.stringUid||n$,intUid:a$.uid||c$.gatewayInfo.uid,stringUid:a$.stringUid,ts:Date.now(),sua:u$,ap:c$};await async function(d$){let h$;try{d$.uid&&A0({appId:d$.appId,cname:d$.cname,token:d$.token,uid:d$.uid,stringUid:d$.stringUid});let p$=O0(d$),_$=await async function(m$,g$){try{let v$=await window.crypto.subtle.importKey("raw",yO(g$),"AES-GCM",!1,["encrypt"]),y$=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},v$,Fo(window.btoa(JSON.stringify(m$))));return so(new Uint8Array(y$))}catch{return}}(d$,d$.token||d$.appId);if(!_$)return;h$=w0(zs);let f$=h$?JSON.parse(h$):[];f$.push({[p$]:_$}),f$.length>v("AP_CACHE_NUM")&&f$.shift(),gu(zs,JSON.stringify(f$))}catch(p$){_.warn("Error caching server parameters:",p$.message),gu(zs,"")}}(l$),g_++}catch(s$){throw T_++,function(a$){f_||(f_=window.setTimeout(()=>{let u$="";Xd.forEach((l$,d$)=>{u$+="".concat(d$,": ").concat(l$," ;")}),X.reportApiInvoke(null,{name:Te.PRELOAD,options:{success:g_,failed:T_,err:u$}}).onError(a$),g_=0,T_=0,Xd.clear(),f_=null},SW));let c$=Xd.get(a$.code)||0;Xd.set(a$.code,c$+1)}(s$),s$}}async function Xv(e$){try{let t$=A0(e$);if(!t$||e$.cloudProxyServer!=="disabled")return;let r$=await async function(n$,i$){try{let o$=await window.crypto.subtle.importKey("raw",yO(i$),"AES-GCM",!1,["decrypt"]),s$=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},o$,Fo(n$));return JSON.parse(window.atob(so(new Uint8Array(s$))))}catch{return}}(t$,e$.token||e$.appId);if(!r$||!function(n$,i$){return n$.cname===i$.cname&&n$.appId===i$.appId&&n$.token===i$.token?i$.stringUid?n$.stringUid===i$.stringUid:typeof i$.uid=="number"?n$.uid===i$.uid:n$.uid==i$.uid:!1}(r$,e$))return;if(r$&&Date.now()-r$.ts<v("AP_CACHE_LIFETIME"))return r$}catch(t$){_.warn("Error get preloadInfo",t$.message)}}function A0(e$){let t$;try{if(t$=w0(zs),!t$)return;let r$=JSON.parse(t$),n$=O0(e$),i$=function(s$,a$){for(let c$=s$.length-1;c$>=0;c$--)if(a$(s$[c$]))return c$;return-1}(r$,s$=>n$ in s$);if(i$===-1)return;let o$=r$.splice(i$,1)[0];return gu(zs,JSON.stringify(r$)),o$[n$]}catch(r$){_.warn("Error delete preload info: ".concat(t$),r$.message),gu(zs,"")}}function Df(e$){if(e$){let t$=Mo.get(e$);t$&&(window.clearTimeout(t$),t$=null,Mo.delete(e$)),W(Uo).call(Uo,e$)||e$.cloudProxyServer!=="disabled"||Uo.push(e$)}if(Mo.size<v("AP_CACHE_NUM")&&Uo.length>0){let t$=Uo.shift();Mo.set(t$,window.setTimeout(async()=>{let{appId:r$,cname:n$,token:i$,stringUid:o$,uid:s$,proxyServer:a$}=t$;try{await RW(r$,n$,i$,s$,a$,o$),Mo.has(t$)&&Df(t$)}catch(c$){_.warn("update preload failed",c$.message),b0(t$)}},v("AP_UPDATE_INTERVAL")))}}function b0(e$){let t$=Uo.indexOf(e$);t$!==-1&&Uo.splice(t$,1);let r$=Mo.get(e$);r$&&(window.clearTimeout(r$),r$=null,Mo.delete(e$),Df())}function Qv(e$,t$){let r$=e$.sua,n$=e$.ap;t$&&r$&&X.reqUserAccount(e$.sid,{lts:r$.requestTime,elapse:r$.elapse,success:!0,serverAddr:r$.url,stringUid:t$,uid:e$.intUid,errorCode:null,extend:r$.req}),X.reportResourceTiming(e$.ap.url,e$.sid),X.joinWebProxyAP(e$.sid,{lts:n$.requestTime,elapse:n$.elapse,sucess:1,apServerAddr:n$.url,turnServerAddrList:n$.proxyInfo.addresses.map(i$=>i$.ip).join(","),eventType:"disabled",unilbsServerIds:[ue.CHOOSE_SERVER,ue.CLOUD_PROXY_FALLBACK].toString()}),X.joinChooseServer(e$.sid,{lts:n$.requestTime,elapse:n$.elapse,succ:!0,csAddr:n$.url,opid:n$.opid,serverList:n$.gatewayInfo.gatewayAddrs.map(i$=>i$.address),ec:null,cid:n$.gatewayInfo.cid.toString(),uid:n$.gatewayInfo.uid.toString(),csIp:n$.gatewayInfo.csIp,unilbsServerIds:[ue.CHOOSE_SERVER].toString(),isHttp3:n$.isHttp3})}function w0(e$){return window.atob(window.localStorage.getItem(e$)||"")}function gu(e$,t$){window.localStorage.setItem(e$,window.btoa(t$))}function O0(e$){let t$="".concat(e$.appId,"_").concat(e$.cname);return typeof e$.uid=="string"&&(t$+="_s_".concat(e$.uid)),typeof e$.uid=="number"&&(t$+="_".concat(e$.uid)),e$.token&&(t$+="_".concat(e$.token)),bO(t$)}function CW(e$){let t$=function(){let r$=yW.pop();return r$?(r$.offset=r$.limit=0,r$):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r$,n$){let i$=r$.appId;i$!==void 0&&(de(n$,10),Hr(n$,i$));let o$=r$.cid;o$!==void 0&&(de(n$,16),de(n$,o$));let s$=r$.cname;s$!==void 0&&(de(n$,26),Hr(n$,s$));let a$=r$.deviceId;a$!==void 0&&(de(n$,34),Hr(n$,a$));let c$=r$.elapse;c$!==void 0&&(de(n$,40),Kr(n$,c$));let u$=r$.fileSize;u$!==void 0&&(de(n$,48),Kr(n$,Ss(u$)));let l$=r$.height;l$!==void 0&&(de(n$,56),Kr(n$,Ss(l$)));let d$=r$.jpg;d$!==void 0&&(de(n$,66),de(n$,d$.length),Zv(n$,d$));let h$=r$.networkType;h$!==void 0&&(de(n$,72),Kr(n$,Ss(h$)));let p$=r$.osType;p$!==void 0&&(de(n$,80),Kr(n$,Ss(p$)));let _$=r$.requestId;_$!==void 0&&(de(n$,90),Hr(n$,_$));let f$=r$.sdkVersion;f$!==void 0&&(de(n$,98),Hr(n$,f$));let m$=r$.sequence;m$!==void 0&&(de(n$,104),Kr(n$,Ss(m$)));let g$=r$.sid;g$!==void 0&&(de(n$,114),Hr(n$,g$));let v$=r$.timestamp;v$!==void 0&&(de(n$,120),Kr(n$,v$));let y$=r$.uid;y$!==void 0&&(de(n$,128),de(n$,y$));let S$=r$.vid;S$!==void 0&&(de(n$,136),de(n$,S$));let b$=r$.width;b$!==void 0&&(de(n$,144),Kr(n$,Ss(b$)));let $$=r$.service;$$!==void 0&&(de(n$,152),de(n$,$$));let C$=r$.callbackData;C$!==void 0&&(de(n$,162),de(n$,C$.length),Zv(n$,C$));let N$=r$.ticket;N$!==void 0&&(de(n$,170),Hr(n$,N$));let k$=r$.vendorConfigs;k$!==void 0&&(de(n$,178),Hr(n$,k$))}(e$,t$),function(r$){let n$=r$.bytes,i$=r$.limit;return n$.length===i$?n$:n$.subarray(0,i$)}(t$)}function IW(e$){return function(r$){let n$={};e:for(;!AW(r$);){let i$=$a(r$);switch(i$>>>3){case 0:break e;case 1:n$.code=$a(r$);break;case 2:n$.msg=$v(r$,$a(r$));break;case 3:n$.requestId=$v(r$,$a(r$));break;case 4:n$.timestamp=bW(r$,!1);break;default:vW(r$,7&i$)}}return n$}({bytes:t$=e$,offset:0,limit:t$.length});var t$}function vW(e$,t$){switch(t$){case 0:for(;128&gi(e$););break;case 2:R_(e$,$a(e$));break;case 5:R_(e$,4);break;case 1:R_(e$,8);break;default:throw new Error("Unimplemented type: "+t$)}}function Ss(e$){return{low:e$|=0,high:e$>>31,unsigned:e$>=0}}var yW=[];function R_(e$,t$){if(e$.offset+t$>e$.limit)throw new Error("Skip past limit");e$.offset+=t$}function AW(e$){return e$.offset>=e$.limit}function $u(e$,t$){let r$=e$.bytes,n$=e$.offset,i$=e$.limit,o$=n$+t$;if(o$>r$.length){let s$=new Uint8Array(2*o$);s$.set(r$),e$.bytes=s$}return e$.offset=o$,o$>i$&&(e$.limit=o$),n$}function N0(e$,t$){let r$=e$.offset;if(r$+t$>e$.limit)throw new Error("Read past limit");return e$.offset+=t$,r$}function Zv(e$,t$){let r$=$u(e$,t$.length);e$.bytes.set(t$,r$)}function $v(e$,t$){let r$=N0(e$,t$),n$=String.fromCharCode,i$=e$.bytes,o$="",s$="";for(let a$=0;a$<t$;a$++){let c$,u$,l$,d$,h$=i$[a$+r$];128&h$?(224&h$)==192?a$+1>=t$?s$+=o$:(c$=i$[a$+r$+1],(192&c$)!=128?s$+=o$:(d$=(31&h$)<<6|63&c$,d$<128?s$+=o$:(s$+=n$(d$),a$++))):(240&h$)==224?a$+2>=t$?s$+=o$:(c$=i$[a$+r$+1],u$=i$[a$+r$+2],(49344&(c$|u$<<8))!=32896?s$+=o$:(d$=(15&h$)<<12|(63&c$)<<6|63&u$,d$<2048||d$>=55296&&d$<=57343?s$+=o$:(s$+=n$(d$),a$+=2))):(248&h$)==240?a$+3>=t$?s$+=o$:(c$=i$[a$+r$+1],u$=i$[a$+r$+2],l$=i$[a$+r$+3],(12632256&(c$|u$<<8|l$<<16))!=8421504?s$+=o$:(d$=(7&h$)<<18|(63&c$)<<12|(63&u$)<<6|63&l$,d$<65536||d$>1114111?s$+=o$:(d$-=65536,s$+=n$(55296+(d$>>10),56320+(1023&d$)),a$+=3))):s$+=o$:s$+=n$(h$)}return s$}function Hr(e$,t$){let r$=t$.length,n$=0;for(let s$=0;s$<r$;s$++){let a$=t$.charCodeAt(s$);a$>=55296&&a$<=56319&&s$+1<r$&&(a$=(a$<<10)+t$.charCodeAt(++s$)-56613888),n$+=a$<128?1:a$<2048?2:a$<65536?3:4}de(e$,n$);let i$=$u(e$,n$),o$=e$.bytes;for(let s$=0;s$<r$;s$++){let a$=t$.charCodeAt(s$);a$>=55296&&a$<=56319&&s$+1<r$&&(a$=(a$<<10)+t$.charCodeAt(++s$)-56613888),a$<128?o$[i$++]=a$:(a$<2048?o$[i$++]=a$>>6&31|192:(a$<65536?o$[i$++]=a$>>12&15|224:(o$[i$++]=a$>>18&7|240,o$[i$++]=a$>>12&63|128),o$[i$++]=a$>>6&63|128),o$[i$++]=63&a$|128)}}function gi(e$){return e$.bytes[N0(e$,1)]}function ty(e$,t$){let r$=$u(e$,1);e$.bytes[r$]=t$}function $a(e$){let t$,r$=0,n$=0;do t$=gi(e$),r$<32&&(n$|=(127&t$)<<r$),r$+=7;while(128&t$);return n$}function de(e$,t$){for(t$>>>=0;t$>=128;)ty(e$,127&t$|128),t$>>>=7;ty(e$,t$)}function bW(e$,t$){let r$,n$=0,i$=0,o$=0;return r$=gi(e$),n$=127&r$,128&r$&&(r$=gi(e$),n$|=(127&r$)<<7,128&r$&&(r$=gi(e$),n$|=(127&r$)<<14,128&r$&&(r$=gi(e$),n$|=(127&r$)<<21,128&r$&&(r$=gi(e$),i$=127&r$,128&r$&&(r$=gi(e$),i$|=(127&r$)<<7,128&r$&&(r$=gi(e$),i$|=(127&r$)<<14,128&r$&&(r$=gi(e$),i$|=(127&r$)<<21,128&r$&&(r$=gi(e$),o$=127&r$,128&r$&&(r$=gi(e$),o$|=(127&r$)<<7))))))))),{low:n$|i$<<28,high:i$>>>4|o$<<24,unsigned:t$}}function Kr(e$,t$){let r$=t$.low>>>0,n$=(t$.low>>>28|t$.high<<4)>>>0,i$=t$.high>>>24,o$=i$===0?n$===0?r$<16384?r$<128?1:2:r$<1<<21?3:4:n$<16384?n$<128?5:6:n$<1<<21?7:8:i$<128?9:10,s$=$u(e$,o$),a$=e$.bytes;switch(o$){case 10:a$[s$+9]=i$>>>7&1;case 9:a$[s$+8]=o$!==9?128|i$:127&i$;case 8:a$[s$+7]=o$!==8?n$>>>21|128:n$>>>21&127;case 7:a$[s$+6]=o$!==7?n$>>>14|128:n$>>>14&127;case 6:a$[s$+5]=o$!==6?n$>>>7|128:n$>>>7&127;case 5:a$[s$+4]=o$!==5?128|n$:127&n$;case 4:a$[s$+3]=o$!==4?r$>>>21|128:r$>>>21&127;case 3:a$[s$+2]=o$!==3?r$>>>14|128:r$>>>14&127;case 2:a$[s$+1]=o$!==2?r$>>>7|128:r$>>>7&127;case 1:a$[s$]=o$!==1?128|r$:127&r$}}var ey={},ny={},Tu=4294967296,D0=Tu*Tu,iy=D0/2;P0(0,!0);var ry=P0(0),wW=sa(0,-2147483648,!1),OW=sa(-1,2147483647,!1);function P0(e$,t$){let r$,n$,i$;return t$?(i$=0<=(e$>>>=0)&&e$<256)&&(n$=ny[e$],n$)?n$:(r$=sa(e$,0,!0),i$&&(ny[e$]=r$),r$):(i$=-128<=(e$|=0)&&e$<128)&&(n$=ey[e$],n$)?n$:(r$=sa(e$,e$<0?-1:0,!1),i$&&(ey[e$]=r$),r$)}function sa(e$,t$,r$){return{low:0|e$,high:0|t$,unsigned:!!r$}}function DW(e$,t$){if(isNaN(e$))return ry;{if(e$<=-iy)return wW;if(e$+1>=iy)return OW}return e$<0?ry:sa(e$%Tu|0,e$/Tu|0,t$)}function oy(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}var pm=class P5 extends Xt{get connectionState(){return this._connectionState}set connectionState(t$){if(this._connectionState===t$)return;let r$=this._connectionState;this._connectionState=t$,this.emit(Mi.CONNECTION_STATE_CHANGE,t$,r$)}get quality(){return this._quality}set quality(t$){this._quality=t$>1?1:t$<.1?.1:t$,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t$){var r$;super(),T(this,"name","AgoraRTCImageModeration"),T(this,"_connectionState",Xn.CONNECTING),T(this,"_sequence",0),T(this,"_moderationStartTime",void 0),T(this,"_workerConnection",void 0),T(this,"_workerMessageLengthLimit",void 0),T(this,"_qualityRatio",void 0),T(this,"_connectInfo",void 0),T(this,"_cancelTokenSource",mn.CancelToken.source()),T(this,"_retryConfig",void 0),T(this,"_moderationInterval",void 0),T(this,"_moderationTimer",null),T(this,"_moderationMode",1),T(this,"_quality",1),T(this,"_qualityTimer",null),T(this,"_ticket",void 0),T(this,"_moderationIntervalMinimum",void 0),T(this,"_uploadFailedNum",0),T(this,"_uploadNum",0),T(this,"_uploadTimer",null),T(this,"_extraInfo",void 0),T(this,"_vendor",""),T(this,"_encoder",new TextEncoder),T(this,"_moderationId",void 0),T(this,"inspectImage",()=>{if(this.connectionState!==Xn.CONNECTED)throw new O(R.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Xn.CONNECTED?this.requestToInspectImage():_.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Ut(5,"image-moderation-"),this._workerMessageLengthLimit=v("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=v("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(r$=t$.interval)!==null&&r$!==void 0?r$:1e3,t$.extraInfo&&(this._extraInfo=this._encoder.encode(t$.extraInfo)),t$.vendor&&(this._vendor=t$.vendor),this._qualityRatio=v("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Qo("worker-"+this._moderationId,Ee),this.on(Mi.STATE_CHANGE,(n$,i$)=>{_.debug("[".concat(this._moderationId,"] Moderation operation :").concat(hs[n$]," ").concat(i$||""))}),this.handleWorkerEvents()}async init(t$,r$){this.emit(Mi.STATE_CHANGE,hs.CONNECT_AP),this._connectInfo=t$;let n$=this._cancelTokenSource.token;return this._retryConfig=r$,new j((i$,o$)=>{this.on(Mi.CONNECTION_STATE_CHANGE,(s$,a$)=>{s$===Xn.CONNECTED&&i$()}),this.requestAP(t$,n$,r$).then(s$=>{this.connectWorker(s$)}).catch(s$=>{o$(s$)})})}updateConfig(t$){var r$;this._moderationInterval=(r$=t$.interval)!==null&&r$!==void 0?r$:1e3,t$.extraInfo&&(this._extraInfo=this._encoder.encode(t$.extraInfo)),t$.vendor&&(this._vendor=t$.vendor),_.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t$))),this.connectionState===Xn.CONNECTED&&this.inspectImage()}async requestAP(t$,r$,n$){let i$=v("WEBCS_DOMAIN").map(c$=>"https://".concat(c$,"/api/v1")),o$=await function(c$,u$,l$,d$){let{appId:h$,areaCode:p$,cname:_$,sid:f$,token:m$,uid:g$}=u$;Ys++;let v$="moderation_plugin",y$={service_name:v$,json_body:JSON.stringify({appId:h$,areaCode:p$,cname:_$,command:"allocateEdge",requestId:Ys,seq:Ys,sid:f$,appToken:m$,ts:Date.now(),uid:g$+""})},S$,b$,$$=c$[0];return Wi(async()=>{S$=Date.now();let C$=await Hi($$,{data:y$,cancelToken:l$,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(b$=Date.now()-S$,C$.code!==0){let O$=new O(R.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+C$.code,{retry:!0,responseTime:b$});throw _.error(O$.toString()),O$}let N$=JSON.parse(C$.json_body);if(N$.code!==200){let O$=new O(R.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(N$.code,", reason: ").concat(N$.reason),{code:N$.code,responseTime:b$});throw _.error(O$.toString()),O$}if(!N$.servers||!Array.isArray(N$.servers)||N$.servers.length===0){let O$=new O(R.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:N$.code,responseTime:b$});throw _.error(O$.toString()),O$}if(!N$.servers.some(O$=>!!O$.wss)){let O$=new O(R.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:N$.code,responseTime:b$});throw _.error(O$.toString()),O$}let k$=v("IMAGE_MODERATION_WORKER_HOST");return{addressList:N$.servers.map(O$=>{let{address:U$,wss:x$}=O$;if(U$&&x$)return"wss://".concat(U$.replace(/\./g,"-"),".").concat(k$,":").concat(x$,"/moderation")}).filter(O$=>!!O$),workerToken:N$.workerToken,vid:N$.vid,ticket:N$.appTicket,responseTime:b$}},(C$,N$)=>(X.apworkerEvent(f$,{success:!0,sc:200,serviceName:v$,responseDetail:JSON.stringify(C$.addressList),firstSuccess:N$===0,responseTime:b$,serverIp:c$[N$%c$.length]}),!1),(C$,N$)=>(X.apworkerEvent(f$,{success:!1,sc:C$.data&&C$.data.code||200,serviceName:v$,responseTime:b$,serverIp:c$[N$%c$.length]}),!!(C$.code!==R.OPERATION_ABORTED&&C$.code!==R.UNEXPECTED_RESPONSE||C$.data&&C$.data.retry)&&($$=c$[(N$+1)%c$.length],!0)),d$)}(i$,t$,r$,n$);this.emit(Mi.STATE_CHANGE,hs.AP_CONNECTED);let{addressList:s$,ticket:a$}=o$;return this._ticket=a$,s$}async connectWorker(t$){this.emit(Mi.STATE_CHANGE,hs.CONNECT_WORKER),await this._workerConnection.init(t$,1e4)}handleWorkerEvents(){this._workerConnection.on(it.CONNECTED,async()=>{this.emit(Mi.STATE_CHANGE,hs.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Xn.CONNECTED}),this._workerConnection.on(it.CLOSED,()=>{this.connectionState=Xn.CLOSED}),this._workerConnection.on(it.FAILED,()=>{this.connectionState=Xn.CLOSED}),this._workerConnection.on(it.RECONNECTING,()=>{this.connectionState=this.connectionState===Xn.CONNECTED?Xn.RECONNECTING:Xn.CONNECTING}),this._workerConnection.on(it.ON_MESSAGE,async t$=>{if(t$.data instanceof ArrayBuffer){let r$=IW(new Uint8Array(t$.data));v("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r$)),this._uploadNum++,r$.code===void 0||r$.code===0||(this._uploadFailedNum++,_.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(r$.code,", msg is ").concat(r$.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{X.reportApiInvoke(this._connectInfo.sid||null,{name:Te.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,r$.code],tag:Zt.TRACER}).onError(new O(R.IMAGE_MODERATION_UPLOAD_FAILED,r$.msg)),this._uploadTimer=null},v("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else _.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(it.WILL_RECONNECT,(t$,r$,n$)=>{t$==="recover"&&n$(t$),n$("tryNext")}),this._workerConnection.on(it.REQUEST_NEW_URLS,(t$,r$)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t$).catch(r$)})}static intToLong(t$){return{low:t$|=0,high:t$>>31,unsigned:t$>=0}}async requestToInspectImage(){let t$=ni(this,Mi.CLIENT_LOCAL_VIDEO_TRACK),r$={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t$){if(!t$.isPlaying)return void(v("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_.debug("Only the track being played can be inspected"));this._sequence++;let n$=await this.generateRequestData(t$,r$);this._workerConnection.sendMessage(n$,!0,!0)}else v("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_.debug("Only the track being published can be inspected")}async generateRequestData(t$,r$){let{appId:n$,cname:i$,cid:o$,vid:s$,sid:a$,uid:c$}=r$,u$=Date.now(),l$=await t$.getCurrentFrameImage("image/jpeg",this.quality),d$=await QO(l$,n$,i$),h$=this._sequence+"-"+o$+"-"+c$+"-"+u$+"-"+Ut(12,""),p$={appId:n$,cid:o$,cname:i$,deviceId:"",elapse:P5.intToLong(Number(u$-this._moderationStartTime)),fileSize:l$.buffer.byteLength,height:l$.height,width:l$.width,jpg:d$,networkType:6,osType:7,requestId:h$,sdkVersion:"4.22.0",sequence:this._sequence,sid:a$,timestamp:DW(u$),uid:c$,vid:s$,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete p$.callbackData;let _$=CW(p$);if(_$.byteLength<this._workerMessageLengthLimit){if(v("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let f$=function(m$){for(var g$=1;g$<arguments.length;g$++){var v$=arguments[g$]!=null?arguments[g$]:{};g$%2?oy(Object(v$),!0).forEach(function(y$){T(m$,y$,v$[y$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m$,Object.getOwnPropertyDescriptors(v$)):oy(Object(v$)).forEach(function(y$){Object.defineProperty(m$,y$,Object.getOwnPropertyDescriptor(v$,y$))})}return m$}({},p$);delete f$.jpg,_.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(f$))}return _$}{let f$=this.quality*this._qualityRatio;return this.quality=f$,await this.generateRequestData(t$,{appId:n$,cname:i$,cid:o$,vid:s$,sid:a$,uid:c$})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=mn.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Xn.CLOSED,this.emit(Mi.STATE_CHANGE,hs.CLOSED)}};function k0(e$){if(Nt(e$.interval,"interval",1e3,1/0),e$&&e$.extraInfo&&e$.extraInfo.length>1024)throw new O(R.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e$&&e$.vendor&&e$.vendor.length>1024)throw new O(R.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}var PW={name:"ImageModeration",create:function(e$){let{config:t$}=e$;return k0(t$),new pm(t$)}},sy,ay,cy,dy,ly,uy,hy,py,_y,Ey,my,fy,gy,Ty,Sy,Ry,Cy,Iy,vy,yy,Ay,by,wy,Oy,Ny,Dy,Py,ky,Ly,My,Uy,xy,Vy,Fy,By,jy,Gy,Wy,Hy,Ky,G;function Yy(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function xi(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?Yy(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):Yy(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}ze.setLogger(_);var kW=(sy=$(),ay=$({argsMap:(e$,t$)=>{if(!Array.isArray(t$)){if(!(t$ instanceof no))return[t$];t$=[t$]}return t$.map(r$=>r$?Object(r$).toString():"null")}}),cy=$({argsMap:(e$,t$)=>(t$||(t$=[]),Array.isArray(t$)||t$.trackMediaType!==fa.DATA?(Array.isArray(t$)||(t$=[t$]),t$.map(r$=>r$.getTrackId())):[t$.getChannelId()])}),dy=$({argsMap:(e$,t$,r$,n$)=>[typeof t$=="object"?t$.uid:t$,r$,n$]}),ly=$({argsMap:(e$,t$,r$)=>[t$,r$]}),uy=$({argsMap:(e$,t$)=>t$.map(r$=>{let{user:n$,mediaType:i$}=r$;return[n$==null?void 0:n$.uid,i$]})}),hy=$({argsMap:(e$,t$,r$,n$)=>[typeof t$=="object"?t$.uid:t$,r$,n$]}),py=$({argsMap:(e$,t$)=>t$.map(r$=>{let{user:n$,mediaType:i$}=r$;return{uid:n$==null?void 0:n$.uid,mediaType:i$}})}),_y=$(),Ey=$(),my=$(),fy=$(),gy=$(),Ty=$(),Sy=$(),Ry=$(),Cy=$(),Iy=$(),vy=$(),yy=$(),Ay=$(),by=$(),wy=$({argsMap:(e$,t$)=>[t$]}),Oy=$(),Ny=$(),Dy=$(),Py=$(),ky=$(),Ly=$(),My=$(),Uy=$(),xy=$({argsMap:(e$,t$)=>(Array.isArray(t$)||(t$=[t$]),[JSON.stringify(t$)])}),Vy=$(),Fy=$(),By=$(),jy=$(),Gy=$(),Wy=$(),Hy=$({reportResult:!0}),Ky=$(),G=class extends Xt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e$;return((e$=this._config)===null||e$===void 0?void 0:e$.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e$){let t$;if(super(),T(this,"store",void 0),T(this,"_uid",void 0),T(this,"_channelName",void 0),T(this,"_uintUid",void 0),T(this,"_users",[]),T(this,"_config",void 0),T(this,"_clientId",void 0),T(this,"_appId",void 0),T(this,"_sessionId",null),T(this,"_key",void 0),T(this,"_rtmConfig",{}),T(this,"_joinInfo",void 0),T(this,"_gateway",void 0),T(this,"_statsCollector",void 0),T(this,"_configDistribute",void 0),T(this,"_leaveMutex",new ze("client-leave")),T(this,"_publishMutex",new ze("client-publish")),T(this,"_renewTokenMutex",new ze("client-renewtoken")),T(this,"_subscribeMutex",new ze("client-subscribe")),T(this,"_encryptionMode","none"),T(this,"_encryptionSecret",null),T(this,"_encryptionSalt",null),T(this,"_encryptDataStream",!1),T(this,"_encryptDataStreamKey",null),T(this,"_encryptDataStreamIv",null),T(this,"_proxyServer",void 0),T(this,"_turnServer",{servers:[],mode:"auto"}),T(this,"_cloudProxyServerMode","disabled"),T(this,"_isDualStreamEnabled",!1),T(this,"_defaultStreamFallbackType",void 0),T(this,"_lowStreamParameter",void 0),T(this,"_streamFallbackTypeCacheMap",new Map),T(this,"_remoteStreamTypeCacheMap",new Map),T(this,"_axiosCancelSource",mn.CancelToken.source()),T(this,"_audioVolumeIndicationInterval",void 0),T(this,"_networkQualityInterval",void 0),T(this,"_userOfflineTimeout",void 0),T(this,"_streamRemovedTimeout",void 0),T(this,"_liveTranscodeStreamingClient",void 0),T(this,"_liveRawStreamingClient",void 0),T(this,"_channelMediaRelayClient",void 0),T(this,"_networkQualitySensitivity","normal"),T(this,"_p2pChannel",void 0),T(this,"_useLocalAccessPoint",!1),T(this,"_setLocalAPVersion",void 0),T(this,"_joinAndNotLeaveYet",!1),T(this,"_numberOfJoinCount",0),T(this,"_remoteDefaultVideoStreamType",void 0),T(this,"_inspect",void 0),T(this,"_moderation",void 0),T(this,"_license",void 0),T(this,"_pendingPublishedUsers",[]),T(this,"ntpAlignErrorCount",0),T(this,"remoteInboundOffset",0),T(this,"_handleLocalTrackEnable",(r$,n$,i$)=>{this.publish(r$,!1).then(n$).catch(i$)}),T(this,"_handleLocalTrackDisable",(r$,n$,i$)=>{this.unpublish(r$).then(n$).catch(i$)}),T(this,"_handleUserOnline",r$=>{if(v("BLOCK_LOCAL_CLIENT")&&Io(r$.uid,this.channelName))return void _.debug("[".concat(r$.uid,"] will be ignored in local"));this.isStringUID&&typeof r$.uid!="string"&&_.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let n$=this._users.find(i$=>i$.uid===r$.uid);if(n$)n$._trust_in_room_=!0,n$._is_pre_created&&(n$._is_pre_created=!1,this.safeEmit(ut.USER_JOINED,n$));else{let i$=new ir(r$.uid,r$.uint_id||r$.uid);this._users.push(i$),_.debug("[".concat(this._clientId,"] user online"),r$.uid),this.safeEmit(ut.USER_JOINED,i$)}}),T(this,"_handleUserOffline",r$=>{if(v("BLOCK_LOCAL_CLIENT")&&Io(r$.uid,this.channelName))return;let n$=this._users.find(i$=>i$.uid===r$.uid);n$&&(this._handleRemoveStream(r$),this._handleRemoveDataChannels(r$),n$._audio_pre_subscribed||n$._video_pre_subscribed?n$._is_pre_created=!0:Wl(this._users,n$),this._remoteStreamTypeCacheMap.delete(n$.uid),this._streamFallbackTypeCacheMap.delete(n$.uid),_.debug("[".concat(this._clientId,"] user offline"),r$.uid,"reason:",r$.reason),this.safeEmit(ut.USER_LEAVED,n$,r$.reason))}),T(this,"_handleAddAudioOrVideoStream",(r$,n$,i$,o$,s$,a$,c$)=>{if(v("BLOCK_LOCAL_CLIENT")&&Io(n$,this.channelName))return;let u$=this._users.find(d$=>d$.uid===n$);if(!u$)return void _.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));_.debug("[".concat(this._clientId,"] stream added with uid ").concat(n$,", type ").concat(r$)),this.store.subscribe(u$.uid,r$,void 0,void 0,void 0,Date.now());let l$=r$==="audio"?u$.hasAudio:u$.hasVideo;u$._uintid||(u$._uintid=s$||n$),r$==="audio"?u$._trust_audio_stream_added_state_=!0:u$._trust_video_stream_added_state_=!0,r$==="audio"?(u$._audio_added_=!0,i$!==void 0&&(u$._audioSSRC=i$),o$!==void 0&&(u$._cname=o$),a$&&(u$._audioOrtc=a$)):(u$._video_added_=!0,i$!==void 0&&(u$._videoSSRC=i$),o$!==void 0&&(u$._cname=o$),c$!==void 0&&(u$._rtxSsrcId=c$),a$&&(u$._videoOrtc=a$)),(r$==="audio"?u$.hasAudio:u$.hasVideo)&&!l$&&(_.info("[".concat(this._clientId,"] remote user ").concat(u$.uid," published ").concat(r$)),this.safeEmit(ut.USER_PUBLISHED,u$,r$)),r$==="video"?X.onGatewayStream(this._sessionId,De.ON_ADD_VIDEO_STREAM,Jt.ON_ADD_VIDEO_STREAM,{peer:s$||n$,ssrc:u$._videoSSRC}):X.onGatewayStream(this._sessionId,De.ON_ADD_AUDIO_STREAM,Jt.ON_ADD_AUDIO_STREAM,{peer:s$||n$,ssrc:u$._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(u$,r$,i$).then(d$=>{if(d$&&(_.debug("[".concat(this._clientId,"] resubscribe ").concat(r$," for user ").concat(u$.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Jd))return this._p2pChannel.unsubscribe(u$,r$,!0).then(()=>this._subscribe(u$,r$,!0).catch(h$=>{_.error("[".concat(this._clientId,"] resubscribe error"),h$.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(u$,r$)&&(_.debug("[".concat(this._clientId,"] resubscribe ").concat(r$," for user ").concat(u$.uid," after reconnect.")),this._subscribe(u$,r$,!0).catch(d$=>{_.error("[".concat(this._clientId,"] resubscribe error"),d$.toString())}))}),T(this,"_handleRemoveStream",r$=>{if(v("BLOCK_LOCAL_CLIENT")&&Io(r$.uid,this.channelName))return;let n$=this._users.find(o$=>o$.uid===r$.uid);if(!n$)return void _.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));_.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r$.uid));let i$=()=>{};n$.hasAudio&&n$.hasVideo?i$=()=>{_.info("[".concat(this._clientId,"] remote user ").concat(n$.uid," unpublished audio track")),this.safeEmit(ut.USER_UNPUBLISHED,n$,"audio"),_.info("[".concat(this._clientId,"] remote user ").concat(n$.uid," unpublished video track")),this.safeEmit(ut.USER_UNPUBLISHED,n$,"video")}:n$.hasVideo?i$=()=>{_.info("[".concat(this._clientId,"] remote user ").concat(n$.uid," unpublished video track")),this.safeEmit(ut.USER_UNPUBLISHED,n$,"video")}:n$.hasAudio&&(i$=()=>{_.info("[".concat(this._clientId,"] remote user ").concat(n$.uid," unpublished audio track")),this.safeEmit(ut.USER_UNPUBLISHED,n$,"audio")}),n$._video_pre_subscribed||n$._audio_pre_subscribed||(n$._trust_audio_stream_added_state_=!0,n$._trust_video_stream_added_state_=!0,n$._audio_added_=!1,n$._video_added_=!1,this._p2pChannel instanceof Jd&&this._p2pChannel.unsubscribe(n$).then(o$=>{if(o$)return this._gateway.unsubscribe(o$,n$.uid)}),n$._audioSSRC=void 0,n$._videoSSRC=void 0,n$._audioOrtc=void 0,n$._videoOrtc=void 0,n$._rtxSsrcId=void 0),X.onGatewayStream(this._sessionId,De.ON_REMOVE_STREAM,Jt.ON_REMOVE_STREAM,{peer:r$.uint_id||r$.uid}),i$()}),T(this,"_handleSetStreamLocalEnable",(r$,n$,i$)=>{if(v("BLOCK_LOCAL_CLIENT")&&Io(n$,this.channelName))return;let o$=this._users.find(c$=>c$.uid===n$);if(!o$)return void _.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));_.debug("[".concat(this._clientId,"] local ").concat(r$," ").concat(i$?"enabled":"disabled"," with uid ").concat(n$));let s$=r$==="audio"?o$.hasAudio:o$.hasVideo;if(r$==="audio"){o$._trust_audio_enabled_state_=!0;let c$=o$._audio_enabled_;if(o$._audio_enabled_=i$,o$._audio_enabled_===c$)return;{let u$=o$._audio_enabled_?"enable-local-audio":"disable-local-audio";_.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(n$,", msg: ").concat(u$)),this.safeEmit(ut.USER_INFO_UPDATED,n$,u$)}}else{o$._trust_video_enabled_state_=!0;let c$=o$._video_enabled_;if(o$._video_enabled_=i$,o$._video_enabled_===c$)return;{let u$=o$._video_enabled_?"enable-local-video":"disable-local-video";_.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n$,", msg: ").concat(u$)),this.safeEmit(ut.USER_INFO_UPDATED,n$,u$)}}let a$=r$==="audio"?o$.hasAudio:o$.hasVideo;return s$!==a$?!s$&&a$?(_.info("[".concat(this._clientId,"] remote user ").concat(n$," published ").concat(r$)),void this.safeEmit(ut.USER_PUBLISHED,o$,r$)):(r$==="video"&&o$._videoTrack&&o$._videoTrack._destroy(),r$==="audio"&&o$._audioTrack,this._p2pChannel.muteRemote(o$,r$),_.info("[".concat(this._clientId,"] remote user ").concat(n$," unpublished ").concat(r$)),void this.safeEmit(ut.USER_UNPUBLISHED,o$,r$)):void 0}),T(this,"_handleMuteStream",(r$,n$,i$)=>{if(v("BLOCK_LOCAL_CLIENT")&&Io(r$,this.channelName))return;_.debug("[".concat(this._clientId,"] receive mute message"),r$,n$,i$);let o$=this._users.find(c$=>c$.uid===r$);if(!o$)return void _.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r$));let s$=n$==="audio"?o$.hasAudio:o$.hasVideo;if(n$==="audio"){o$._trust_audio_mute_state_=!0;let c$=o$._audio_muted_;if(o$._audio_muted_=i$,o$._audio_muted_===c$)return;{let u$=o$._audio_muted_?"mute-audio":"unmute-audio";_.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r$,", msg: ").concat(u$)),this.safeEmit(ut.USER_INFO_UPDATED,r$,u$)}}else{o$._trust_video_mute_state_=!0;let c$=o$._video_muted_;if(o$._video_muted_=i$,o$._video_muted_===c$)return;{let u$=o$._video_muted_?"mute-video":"unmute-video";_.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r$,", msg: ").concat(u$)),this.safeEmit(ut.USER_INFO_UPDATED,r$,u$)}}let a$=n$==="audio"?o$.hasAudio:o$.hasVideo;if(s$!==a$){if(!s$&&a$)return(n$==="audio"?o$._audioSSRC:o$._videoSSRC)?(_.info("[".concat(this._clientId,"] remote user ").concat(r$," published ").concat(n$)),void this.safeEmit(ut.USER_PUBLISHED,o$,n$)):void _.warning("[".concat(this._clientId,"] remote user ").concat(r$," receive ").concat(n$," unmute message  before add stream message, ").concat(n$," SSRC doesn't exist yet."));n$==="video"&&o$._videoTrack&&!o$._video_pre_subscribed&&o$._videoTrack._destroy(),n$==="audio"&&o$._audioTrack,this._p2pChannel.muteRemote(o$,n$),_.info("[".concat(this._clientId,"] remote user ").concat(r$," unpublished ").concat(n$)),this.safeEmit(ut.USER_UNPUBLISHED,o$,n$)}}),T(this,"_handleP2PLost",async r$=>{_.debug("[".concat(this._clientId,"] receive p2p lost"),r$),parseInt(r$.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():_.warning("[".concat(this._clientId,"] P2PLost stream not found"),r$)}),T(this,"_handleTokenWillExpire",()=>{_.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(ut.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),T(this,"_handleBeforeUnload",r$=>{r$.type==="beforeunload"&&r$.returnValue!==void 0&&r$.returnValue!==""||(this.leave(),_.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),T(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(ut.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let r$={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r$.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r$.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(ut.NETWORK_QUALITY,r$)}),T(this,"_handleP2PAddAudioOrVideoStream",(r$,n$,i$,o$)=>{let s$=this._users.find(c$=>c$.uid===n$);if(!s$)return void _.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));_.debug("[".concat(this._clientId,"] stream added with uid ").concat(n$,", type ").concat(r$)),this.store.subscribe(s$.uid,r$,void 0,void 0,void 0,Date.now());let a$=r$==="audio"?s$.hasAudio:s$.hasVideo;r$==="audio"?s$._trust_audio_stream_added_state_=!0:s$._trust_video_stream_added_state_=!0,r$==="audio"?(s$._audio_added_=!0,i$!==void 0&&(s$._audioSSRC=i$),o$!==void 0&&(s$._audioMid=o$)):(s$._video_added_=!0,i$!==void 0&&(s$._videoSSRC=i$),o$!==void 0&&(s$._videoMid=o$)),(r$==="audio"?s$.hasAudio:s$.hasVideo)&&!a$&&(_.info("[".concat(this._clientId,"] remote user ").concat(s$.uid," published ").concat(r$)),this.safeEmit(ut.USER_PUBLISHED,s$,r$)),this._p2pChannel.hasPendingRemoteMedia(s$,r$)&&(_.debug("[".concat(this._clientId,"] resubscribe ").concat(r$," for user ").concat(s$.uid," after reconnect.")),this._subscribe(s$,r$,!0).catch(c$=>{_.error("[".concat(this._clientId,"] resubscribe error"),c$.toString())}))}),this._config=e$,this._clientId=Ut(5,"client-"),this.store=new ME(e$.codec,e$.audioCodec,e$.mode,this._clientId),this.store.clientCreated(),e$.proxyServer&&this.setProxyServer(e$.proxyServer,!0),e$.turnServer&&this.setTurnServer(e$.turnServer,!0),_.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(ii," build: ").concat(Ef,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e$.clientRoleOptions)try{fR(e$.clientRoleOptions),t$=Object.assign({},e$.clientRoleOptions)}catch(r$){_.warning("[".concat(this._clientId,"] ").concat(r$.toString()))}this._statsCollector=new _u(this.store),this._statsCollector.onStatsException=(r$,n$,i$)=>{_.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(r$,", msg: ").concat(n$,", uid: ").concat(i$)),this.safeEmit(ut.EXCEPTION,{code:r$,msg:n$,uid:i$})},this._statsCollector.onUploadPublishDuration=(r$,n$,i$,o$)=>{let s$=this._users.find(a$=>a$.uid===r$);s$&&X.peerPublishStatus(this._sessionId,{subscribeElapse:o$,audioPublishDuration:n$,videoPublishDuration:i$,peer:s$._uintid})},this.store.useP2P=e$.mode==="p2p",this._gateway=new tm(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e$.websocketRetryConfig||Ee,httpRetryConfig:e$.httpRetryConfig||Ee,forceWaitGatewayResponse:e$.forceWaitGatewayResponse===void 0||e$.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e$.role,clientRoleOptions:t$}),this._configDistribute=new im,this.store.useP2P?(this._p2pChannel=new An(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new Jd(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e$,t$,r$,n$,i$){let o$=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],s$=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Ot("JOIN_GATEWAY_USE_443PORT_ONLY",o$),Ot("JOIN_GATEWAY_USE_DUAL_DOMAIN",s$);let a$=this._gateway.signal.websocket;return a$ instanceof Nc&&(a$.use443PortOnly=o$,a$.tryDoubleDomain=s$),async function(c$,u$,l$){bd.get(c$)||bd.set(c$,[]),wd.get(c$)||wd.set(c$,u$),Yi.get(c$)||Yi.set(c$,0);let d$=bd.get(c$),h$=wd.get(c$);if(!d$||!h$)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Yi.get(c$)===h$){let g$=vc();d$.push(g$),await g$.promise}Yi.set(c$,Yi.get(c$)+1);for(var p$=arguments.length,_$=new Array(p$>3?p$-3:0),f$=3;f$<p$;f$++)_$[f$-3]=arguments[f$];let m$=await l$(..._$);return Yi.set(c$,Yi.get(c$)-1),Yi.get(c$)===h$-1&&d$.length>0&&(d$[0].resolve(),d$.shift()),Yi.get(c$)===0&&(bd.set(c$,[]),wd.set(c$,0),Yi.set(c$,0)),m$}("client.join",v("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e$,t$,r$,n$,i$)}async join(e$,t$,r$,n$,i$){let o$=++this._numberOfJoinCount;this.store.joinStart(),n$&&(this.store.uid=n$);let s$=(Nd||Nd||(Nd=(window.location.protocol.split(":")[0]||"").toUpperCase(),Nd))==="HTTPS",a$=vR()?window.isSecureContext:"Browser Not Support";(!vR()&&!s$||!window.isSecureContext)&&_.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),_.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),X.setAppId(e$);try{if(!r$&&r$!==null)throw new O(R.INVALID_PARAMS,"Invalid token: ".concat(r$,". If you don not use token, set it to null"));r$&&Pe(r$,"token",1,2047),Pe(e$,"appid",1,2047),Xu(t$),n$&&Qu(n$),i$&&Pe(i$,"optionalInfo",1,2047)}catch(f$){throw X.reportApiInvoke(Ms(),{name:Te.JOIN,options:[e$,t$,r$,n$],states:{isHttps:s$,isSecureContext:a$},tag:Zt.TRACER}).onError(f$),f$}if(this._leaveMutex.isLocked&&(_.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),_.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let f$=new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw X.reportApiInvoke(Ms(),{name:Te.JOIN,options:[e$,t$,r$,n$],states:{isHttps:s$,isSecureContext:a$},tag:Zt.TRACER}).onError(f$),f$}this._gateway.state="CONNECTING";let c$=await Xv({appId:e$,cname:t$,uid:n$,stringUid:typeof n$=="string"?n$:void 0,token:r$||e$,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let u$=(c$==null?void 0:c$.sid)||Ms();_.info("[".concat(this._clientId,"] start join channel ").concat(t$,", join number: ").concat(o$)),this._sessionId||(this._sessionId=u$,this.store.sessionId=this._sessionId);let l$=X.reportApiInvoke(u$,{name:Te.JOIN,options:[e$,t$,r$,n$],states:{isHttps:s$,isSecureContext:a$},tag:Zt.TRACER}),d$=xi(xi({},this._rtmConfig),{},{clientId:this._clientId,appId:e$,sid:this._sessionId,cname:t$,uid:typeof n$!="string"?n$:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r$||e$,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i$,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!c$},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(d$.setLocalAPVersion=this._setLocalAPVersion),typeof n$=="string"&&(d$.stringUid=n$,this._uintUid?(d$.uid=this._uintUid,this._uintUid=void 0):d$.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(d$.aesmode=this._encryptionMode,d$.aespassword=await(async f$=>{let m$=function(S$){let b$=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),$$=new Uint8Array(new ArrayBuffer(b$.length));for(let C$=0;C$<b$.length;C$+=1)$$[C$]=b$.charCodeAt(C$);return $$}(),g$=await window.crypto.subtle.importKey("spki",m$,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),v$=uf(f$),y$=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},g$,v$);return function(S$){let b$="";for(let $$=0;$$<S$.length;$$+=1)b$+=String.fromCharCode(S$[$$]);return window.btoa(b$)}(new Uint8Array(y$))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(d$.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let f$=new TextEncoder,m$=v("USE_PURE_ENCRYPTION_MASTER_KEY")?f$.encode(d$.appId+this._encryptionSecret+this._encryptionSecret):f$.encode(d$.appId+d$.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(g$,v$,y$){let S$=await window.crypto.subtle.importKey("raw",v$,"PBKDF2",!1,["deriveBits","deriveKey"]),b$=g$==="aes-128-gcm2"?128:256,$$=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:AR,hash:"SHA-256",salt:y$},S$,b$+TB);return new Uint8Array($$).subarray(b$/8)}(this._encryptionMode,m$,Fo(this._encryptionSalt)),this._encryptDataStreamKey=await async function(g$,v$,y$){let S$=await window.crypto.subtle.importKey("raw",v$,"PBKDF2",!1,["deriveBits","deriveKey"]),b$=g$==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:AR,hash:"SHA-256",salt:y$},S$,{name:"AES-GCM",length:b$},!0,["encrypt","decrypt"])}(this._encryptionMode,m$,Fo(this._encryptionSalt))}else a$?_.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):_.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,_.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t$,appId:e$,stringUid:d$.stringUid});let h$=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&h$===this._sessionId&&X.joinChannelTimeout(this._sessionId,5)},5e3);try{var p$;let f$,m$=d$.cloudProxyServer;if(W(p$=["proxy3","proxy4","proxy5"]).call(p$,m$)){let b$=v("PROXY_SERVER_TYPE3");Array.isArray(b$)?d$.proxyServer=b$[0]:d$.proxyServer=b$}if(X.setProxyServer(d$.proxyServer),_.setProxyServer(d$.proxyServer),this.store.requestAPStart(),c$){if(_.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(d$.stringUid?", ".concat(d$.stringUid," => ").concat(c$.intUid):""," ")),d$.stringUid&&!d$.uid&&(d$.uid=c$.intUid),f$={gatewayInfo:c$.ap.gatewayInfo},v("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&d$.turnServer.mode==="auto")if(c$.ap.proxyInfo.addresses.length===0)_.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let b$=(await kO(c$.ap.proxyInfo,c$.ap.gatewayInfo.uid)).map($$=>({turnServerURL:$$.address,tcpport:$$.tcpport||Ve.tcpport,udpport:$$.udpport||Ve.udpport,username:$$.username||Ve.username,password:$$.password||Ve.password,forceturn:!1,security:!0}));d$.turnServer={mode:"manual",servers:b$}}Qv(c$,d$.stringUid)}else{if(d$.stringUid&&!d$.uid){let b$;[b$,f$]=await j.all([h0(d$.stringUid,d$,this._axiosCancelSource.token,this._config.httpRetryConfig||Ee,this.store),tv(d$,this._axiosCancelSource.token,this._config.httpRetryConfig||Ee,!0,this.store)]),_.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(d$.stringUid," => ").concat(b$)),d$.uid=b$,f$.gatewayInfo.uid=b$,f$.gatewayInfo.res.uid=b$}else f$=await tv(d$,this._axiosCancelSource.token,this._config.httpRetryConfig||Ee,!0,this.store);if(!this._joinAndNotLeaveYet)throw new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(d$,this._axiosCancelSource.token),this._configDistribute.on(FE.UPDATE_BITRATE_LIMIT,b$=>{this._p2pChannel.updateBitrateLimit(b$)})},0),this._key=r$||e$;let g$=f$.gatewayInfo,v$=d$.uid?d$.uid:g$.uid;this._joinInfo=xi(xi({},d$),{},{cid:g$.cid,uid:v$,vid:g$.vid,apResponse:g$.res,apGatewayAddress:g$.apGatewayAddress,uni_lbs_ip:g$.uni_lbs_ip,gatewayAddrs:g$.gatewayAddrs}),this.store.intUid=v$;let y$=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));l$.onSuccess(y$),this._appId=e$,this._channelName=d$.cname,this._uid=y$,this.store.uid=y$,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(je()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let S$=d$.stringUid?"string uid: ".concat(d$.stringUid,",uid: ").concat(d$.uid):"uid: ".concat(this._uid);return _.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t$,",").concat(S$)),setTimeout(()=>{_.startUpload()},5e3),this.store.joinEnd(),_$=this,W(Jr).call(Jr,_$)||Jr.push(_$),this._cloudProxyServerMode==="disabled"&&ft().supportWebCrypto&&v("ENABLE_PRELOAD")&&Df(this._joinInfo),y$}catch(f$){let m$=Array.isArray(f$)?f$[0]:f$;throw m$&&m$.code===R.OPERATION_ABORTED?_.warning("[".concat(this._clientId,"] join number: ").concat(o$,", Joining channel failed, rollback"),m$):_.error("[".concat(this._clientId,"] join number: ").concat(o$,", Joining channel failed, rollback"),m$),m$.code!==R.OPERATION_ABORTED&&this._numberOfJoinCount===o$&&(this._gateway.state="DISCONNECTED",this._reset()),l$.onError(m$),m$}var _$}_joinGateway(){if(!this._joinInfo||!this._key)throw new O(R.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!v("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){_.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(je()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t$){let r$=Jr.indexOf(t$);r$!==-1&&Jr.splice(r$,1)}(this),this._statsCollector.stopUpdateStats();let e$=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return _.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e$();await this._gateway.leave(this.connectionState!=="CONNECTED"),_.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e$()}async publish(e$){let t$=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e$)){if(!(e$ instanceof no))return this._publishDataChannel(e$);e$=[e$]}if(e$.length===0)throw new O(R.INVALID_PARAMS,"param list is empty");let r$=e$;if(this._gateway.role==="audience")throw new O(R.INVALID_OPERATION,"audience can not publish stream");for(let i$ of r$){if(!(i$ instanceof no))throw new O(R.INVALID_PARAMS,"parameter is not local track");if(!i$._enabled&&t$)throw new O(R.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i$.getTrackId()))}_.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r$.map(i$=>"".concat(i$.getTrackId()," "))));let n$=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t$&&r$.forEach(i$=>{let o$=this._configDistribute.getBitrateLimit();i$ instanceof Ft&&o$&&i$.setBitrateLimit(o$.uplink)});try{await this._publishHighStream(r$),_.info("[".concat(this._clientId,"] Publish success, id ").concat(r$.map(i$=>"".concat(i$.getTrackId()," "))))}catch(i$){throw _.error("[".concat(this._clientId,"] publish error"),i$.toString()),i$}finally{n$()}}async _publishDataChannel(e$){Nt(e$.id,"id",0,65535,!0),Nr(e$.ordered,"ordered"),Pe(e$.metadata,"metadata",0,512),_.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e$.id));let t$=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i$=>i$.id===e$.id)!==-1)throw new O(R.INVALID_PARAMS,"Invalid id: ".concat(e$.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new O(R.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&v("FORCE_TURN")&&!v("TURN_ENABLE_TCP")&&!v("TURN_ENABLE_UDP"))throw new O(R.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let r$=function(i$){return Kv(i$,!1)}(e$),n$=await this._p2pChannel.publishDataChannel([r$]);if(n$.length>0){if(typeof r$._originDataChannelId!="number")throw _.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new O(R.CREATE_DATACHANNEL_ERROR);try{await j.all(n$.map(i$=>this._uid&&this._gateway.publishDataChannel(this._uid,i$,!0))),await r$._waitTillOpen()}catch(i$){if(i$.code!==R.DISCONNECT_P2P)throw i$}}return _.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r$.id)),r$}catch(r$){throw _.error("[".concat(this._clientId,"] publish datachannels error"),r$.toString()),r$}finally{t$()}}async unpublish(e$){if(!this._joinInfo||this._uid===void 0)throw new O(R.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t$=[];if(e$)if(Array.isArray(e$))t$=e$;else{if(!(e$ instanceof no))return this._unpublishDataChannel([e$]);t$=[e$]}else this.store.useP2P||await this._unpublishDataChannel(),t$=this._p2pChannel.getAllTracks(!0);_.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t$.map(n$=>"".concat(n$.getTrackId()," "))," "));let r$=await this._publishMutex.lock();try{if(this._p2pChannel instanceof An){let n$=await this._p2pChannel.unpublish(t$);n$&&await this._gateway.sendExtensionMessage(ie.UNPUBLISH,{unpubMsg:n$},!0)}else{let n$=await this._p2pChannel.unpublish(t$);n$&&await this._gateway.unpublish(n$,this._uid),_.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t$.map(i$=>"".concat(i$.getTrackId()))))}}catch(n$){throw _.error("[".concat(this._clientId,"] unpublish error"),n$.toString()),n$}finally{r$&&r$()}}async _unpublishDataChannel(e$){e$!==void 0&&e$.length!==0||(e$=this._p2pChannel.getAllDataChannels()),_.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e$.map(r$=>"".concat(r$.id," "))," "));let t$=await this._publishMutex.lock();try{let r$=await this._p2pChannel.unpublishDataChannel(e$);r$&&await this._gateway.unpublishDataChannel(r$),_.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e$.map(n$=>"".concat(n$.id))))}catch(r$){throw _.error("[".concat(this._clientId,"] unpublish dataChannel error"),r$.toString()),r$}finally{t$&&t$()}}async subscribe(e$,t$,r$){if(!(e$ instanceof ir)){let n$=this.remoteUsers.find(i$=>i$.uid===e$);if(!n$)throw new O(R.INVALID_REMOTE_USER,"user is not in the channel");e$=n$}return t$==="datachannel"?this._subscribeDataChannel(e$,r$):this._subscribe(e$,t$)}async presubscribe(e$,t$){if(Ce(t$,"mediaType",["audio","video"]),this._p2pChannel instanceof An)throw new O(R.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new O(R.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let r$=t$===Q.AUDIO,n$=t$===Q.VIDEO,i$=await this._subscribeMutex.lock();try{let{ssrcId:o$,ortc:s$,rtxSsrcId:a$,cname:c$,uint_id:u$}=await this._gateway.presubscribe(e$,t$,!0);if(o$==null)throw new O(R.UNEXPECTED_RESPONSE,"no ssrc id");let l$=this._users.find(h$=>h$.uid===e$);l$||(l$=new ir(e$,u$||e$),l$._is_pre_created=!0,this._users.push(l$)),c$&&(l$._cname=c$),l$._uintid||(l$._uintid=u$||e$),r$&&(l$._audioSSRC=o$,l$._audio_pre_subscribed=!0,s$&&(l$._audioOrtc=s$)),n$&&(l$._videoSSRC=o$,l$._video_pre_subscribed=!0,s$&&(l$._videoOrtc=s$),a$!=null&&(l$._rtxSsrcId=a$)),_.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(o$)),await this._p2pChannel.subscribe(l$,t$,o$,a$,s$);let d$=r$?l$._audioTrack:l$._videoTrack;if(!d$)throw new O(R.UNEXPECTED_ERROR,"can not find remote track in user");return r$&&(l$._trust_audio_stream_added_state_=!0,l$._audio_added_=!0),n$&&(l$._trust_video_stream_added_state_=!0,l$._video_added_=!0),d$}catch(o$){throw _.error("[".concat(this._clientId,"] presub user ").concat(e$," error"),o$),o$}finally{i$()}}async _subscribeDataChannel(e$,t$){var r$;if(Nt(t$,"channelId",0,65535,!0),!this._joinInfo)throw new O(R.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(s$=>s$===e$))throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid,", this user is not in the channel")),new O(R.INVALID_REMOTE_USER,"user is not in the channel");if(!e$.hasAudio&&!e$.hasVideo&&e$._dataChannels.length===0)throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid,", user is not published")),new O(R.INVALID_REMOTE_USER,"user is not published");let n$=(r$=e$._dataChannels)===null||r$===void 0?void 0:r$.find(s$=>s$.id===t$);if(!n$)throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid," with mediaType datachannel, remote datachannel is not published")),new O(R.REMOTE_USER_IS_NOT_PUBLISHED);let i$=await this._subscribeMutex.lock();_.info("[".concat(this._clientId,"] subscribe user ").concat(e$.uid,", mediaType: datachannel"));try{let s$=await this._p2pChannel.subscribeDataChannel(e$,[n$]);if(s$&&W(s$).call(s$,n$.id))try{var o$;if(typeof n$._originDataChannelId!="number")throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid," with mediaType datachannel, cannot get RTCDatachannel")),new O(R.CREATE_DATACHANNEL_ERROR);let a$={id:n$.id,datachannelId:n$._originDataChannelId,ordered:n$.ordered,maxRetransmits:n$.maxRetransmits,metadata:(o$=n$.metadata)!==null&&o$!==void 0?o$:""};await this._gateway.subscribeDataChannel(e$.uid,a$,!0),await n$._waitTillOpen()}catch(a$){if((a$==null?void 0:a$.code)!==R.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e$,[n$]),a$;await this._p2pChannel.unsubscribeDataChannel(e$,[n$]),this._p2pChannel.setPendingRemoteDataChannel(e$,n$.id)}return _.info("[".concat(this._clientId,"] subscribe success user ").concat(e$.uid,", mediaType: datachannel")),n$}finally{i$()}}async _p2pSubscribe(e$,t$,r$){if(Ce(t$,"mediaType",["audio","video"]),!this._joinInfo)throw new O(R.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(i$=>i$===e$)){let i$=new O(R.INVALID_REMOTE_USER,"user is not in the channel");throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid,", this user is not in the channel")),i$}if(!e$.hasAudio&&!e$.hasVideo){let i$=new O(R.INVALID_REMOTE_USER,"user is not published");throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid,", user is not published")),i$}if(!r$&&(t$==="audio"&&!e$.hasAudio||t$==="video"&&!e$.hasVideo)){let i$=new O(R.REMOTE_USER_IS_NOT_PUBLISHED);throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid," with mediaType ").concat(t$,", remote track is not published")),i$}let n$=await this._subscribeMutex.lock();_.info("[".concat(this._clientId,"] subscribe user ").concat(e$.uid,", mediaType: ").concat(t$));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e$,t$))await this._p2pChannel.unmuteRemote(e$,t$);else try{let o$=t$==="audio"?e$._audioSSRC:e$._videoSSRC,s$=t$==="audio"?e$._audioMid:e$._videoMid;this.store.subscribe(e$.uid,t$,Date.now()),this._p2pChannel instanceof An&&await this._p2pChannel.subscribe(e$,t$,o$,s$)}catch(o$){throw o$}_.info("[".concat(this._clientId,"] subscribe success user ").concat(e$.uid,", mediaType: ").concat(t$)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e$.uid,this._defaultStreamFallbackType).catch(o$=>{_.warning("[".concat(this._clientId,"] auto set fallback failed"),o$)});let i$=t$==="audio"?e$._audioTrack:e$._videoTrack;if(!i$)throw new O(R.UNEXPECTED_ERROR,"can not find remote track in user object");return i$}catch(i$){throw _.error("[".concat(this._clientId,"] subscribe user ").concat(e$.uid," error"),i$),i$}finally{n$()}}async _subscribe(e$,t$,r$){if(this._p2pChannel instanceof An)return this._p2pSubscribe(e$,t$);if(Ce(t$,"mediaType",["audio","video"]),!this._joinInfo)throw new O(R.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(c$=>c$===e$)){let c$=new O(R.INVALID_REMOTE_USER,"user is not in the channel");throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid,", this user is not in the channel")),c$}if(!e$.hasAudio&&!e$.hasVideo){let c$=new O(R.INVALID_REMOTE_USER,"user is not published");throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid,", user is not published")),c$}if(!(r$||(t$!=="audio"||e$.hasAudio&&e$._audioSSRC!==void 0)&&(t$!=="video"||e$.hasVideo&&e$._videoSSRC!==void 0))){let c$=new O(R.REMOTE_USER_IS_NOT_PUBLISHED);throw _.error("[".concat(this._clientId,"] can not subscribe ").concat(e$.uid," with mediaType ").concat(t$,", remote track is not published")),c$}let n$=t$==="audio"?e$._audioSSRC:e$._videoSSRC,i$=t$==="audio"?e$._audioOrtc:e$._videoOrtc,o$=t$==="video"?e$._rtxSsrcId:void 0,s$={stream_type:t$==="audio"?Q.AUDIO:Q.VIDEO,ssrcId:n$},a$=await this._subscribeMutex.lock();_.info("[".concat(this._clientId,"] subscribe user ").concat(e$.uid,", mediaType: ").concat(t$));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e$,t$))await this._p2pChannel.unmuteRemote(e$,t$);else try{let u$=t$==="audio"?e$._audioSSRC:e$._videoSSRC;u$!==void 0&&u$!==n$&&(n$=u$,i$=t$==="audio"?e$._audioOrtc:e$._videoOrtc,o$=t$==="video"?e$._rtxSsrcId:void 0,s$={stream_type:t$==="audio"?Q.AUDIO:Q.VIDEO,ssrcId:n$}),qe.markSubscribeStart(this.store.clientId,n$),this.store.subscribe(e$.uid,t$,Date.now()),await this._p2pChannel.subscribe(e$,t$,n$,o$,i$);try{this._p2pChannel.isPreSubScribe(n$)||await this._gateway.subscribe(e$.uid,s$,!0)}catch(l$){if((l$==null?void 0:l$.code)!==R.WS_ABORT)throw await this._p2pChannel.unsubscribe(e$,t$),l$;await this._p2pChannel.unsubscribe(e$,t$,!0),this._p2pChannel.setPendingRemoteMedia(e$,t$)}this.store.subscribe(e$.uid,t$,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e$,t$)}catch(u$){throw this._p2pChannel.reportSubscribeEvent(!1,u$==null?void 0:u$.code,e$,t$),u$}_.info("[".concat(this._clientId,"] subscribe success user ").concat(e$.uid,", mediaType: ").concat(t$)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e$.uid,this._defaultStreamFallbackType).catch(u$=>{_.warning("[".concat(this._clientId,"] auto set fallback failed"),u$)});let c$=t$==="audio"?e$._audioTrack:e$._videoTrack;if(!c$)throw new O(R.UNEXPECTED_ERROR,"can not find remote track in user object");return c$}catch(c$){throw _.error("[".concat(this._clientId,"] subscribe user ").concat(e$.uid," error"),c$),c$}finally{a$()}}async massSubscribe(e$){if(br(e$,"subscribeList"),!this._joinInfo)throw new O(R.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t$=Date.now(),r$=new Map,n$=await this._subscribeMutex.lock();_.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e$.map(a$=>{let{user:c$,mediaType:u$}=a$;return"user: ".concat(c$==null?void 0:c$.uid,", mediaType: ").concat(u$)}).join("; ")));let i$=(e$=[...e$]).map(a$=>{let{user:c$,mediaType:u$}=a$;return{user:c$,mediaType:u$}}),o$=await this._p2pChannel.globalLock();try{var s$;for(let c$=e$.length-1;c$>=0;c$--){let u$=e$[c$],{user:l$,mediaType:d$}=u$;if(Ce(d$,"mediaType",["audio","video"]),!l$){let _$=new O(R.INVALID_PARAMS,"user property does not exist in subscribeList item");throw _.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),_$}if(!this._users.find(_$=>_$===l$)){let _$=new O(R.INVALID_REMOTE_USER,"user is not in the channel");_.error("[".concat(this._clientId,"] can not massSubscribe ").concat(l$.uid,", this user is not in the channel")),i$[c$].error=_$,e$.splice(c$,1);continue}if(d$==="audio"&&(!l$.hasAudio||l$._audioSSRC===void 0)||d$==="video"&&(!l$.hasVideo||l$._videoSSRC===void 0)){let _$=new O(R.REMOTE_USER_IS_NOT_PUBLISHED);_.error("[".concat(this._clientId,"] can not subscribe ").concat(l$.uid," with mediaType ").concat(d$,", remote user is not published")),i$[c$].error=_$,e$.splice(c$,1);continue}let h$=ve.Video|ve.LwoVideo,p$=r$.get(l$);if(p$){if(d$==="video"?p$&h$:p$&ve.Audio){e$.splice(c$,1),_.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(l$.uid,", mediaType:").concat(d$," twice"));continue}r$.set(l$,p$|(d$==="video"?h$:ve.Audio))}else r$.set(l$,d$==="video"?h$:ve.Audio)}for(let c$=e$.length-1;c$>=0;c$--){let u$=e$[c$],{user:l$,mediaType:d$}=u$,h$=ve.Video|ve.LwoVideo;if(this._p2pChannel.hasRemoteMedia(l$,d$)){await this._p2pChannel.unmuteRemoteNoLock(l$,d$);let p$=r$.get(l$);r$.set(l$,d$==="video"?p$^h$:p$^ve.Audio),e$.splice(c$,1)}}this.store.massSubscribe(e$.map(c$=>({userId:c$.user.uid,type:c$.mediaType})),t$);let a$=ji(s$=Array.from(r$.entries())).call(s$,(c$,u$)=>{let[l$,d$]=u$;if(d$===0)return c$;let h$={stream_id:l$.uid,stream_type:d$};return d$&ve.Audio&&(h$.audio_ssrc=l$._audioSSRC),d$&ve.Video&&(h$.video_ssrc=l$._videoSSRC),c$.push(h$),c$},[]);try{e$.length>0&&await this._p2pChannel.massSubscribeNoLock(e$.map(u$=>{let{user:l$,mediaType:d$}=u$;return{user:l$,mediaType:d$,ssrcId:d$===Q.VIDEO?l$._videoSSRC:l$._audioSSRC,rtxSsrcId:d$===Q.VIDEO?l$._rtxSsrcId:void 0}}));let c$=new Map;if(a$=a$.filter(u$=>u$.video_ssrc&&!this._p2pChannel.isPreSubScribe(u$.video_ssrc)||u$.audio_ssrc&&!this._p2pChannel.isPreSubScribe(u$.audio_ssrc)||!u$.video_ssrc&&!u$.audio_ssrc),a$.length>0){let u$=await this._gateway.subscribeAll(a$,!0);((u$==null?void 0:u$.users)||[]).forEach(l$=>{let{stream_id:d$,video_error_code:h$,audio_error_code:p$,error_code:_$}=l$;(h$||p$||_$)&&c$.set(d$,{video_error_code:h$,audio_error_code:p$,error_code:_$})})}if(Array.from(c$.entries()).length>0){let u$=[];Array.from(c$.entries()).forEach(l$=>{let[d$,h$]=l$,p$=this.remoteUsers.find(_$=>_$.uid===d$);if(p$){let _$;h$.error_code||h$.video_error_code&&h$.audio_error_code?_$=void 0:h$.video_error_code?_$=Q.VIDEO:h$.audio_error_code&&(_$=Q.AUDIO),u$.push({user:p$,mediaType:_$})}}),u$.length>0&&await this._p2pChannel.massUnsubscribeNoLock(u$)}for(let u$ of i$){let l$=c$.get(u$.user.uid);if(l$){let d$=l$.error_code||u$.mediaType==="audio"&&l$.audio_error_code||u$.mediaType==="video"&&l$.video_error_code;if(d$){let h$=Oc(d$);_.error("user:".concat(u$.user.uid," mediaType:").concat(u$.mediaType," has massSubscribe error ").concat(h$.desc)),u$.error=new O(R.SUBSCRIBE_FAILED,"code ".concat(d$,": ").concat(h$.desc))}}u$.error||(u$.mediaType==="video"?u$.track=u$.user.videoTrack:u$.track=u$.user.audioTrack)}return this.store.massSubscribe(i$.filter(u$=>!u$.error).map(u$=>({userId:u$.user.uid,type:u$.mediaType})),void 0,Date.now()),i$.forEach(u$=>{var l$;X.subscribe(this.store.sessionId,{succ:!!u$.error,ec:((l$=u$.error)===null||l$===void 0?void 0:l$.code)||null,video:u$.mediaType===Q.VIDEO,audio:u$.mediaType===Q.AUDIO,peerid:u$.user.uid,subscribeRequestid:u$.mediaType===Q.VIDEO?u$.user._videoSSRC:u$.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t$),preSsrc:this._p2pChannel.isPreSubScribe(u$.user._videoSSRC)},!0)}),_.info("[".concat(this._clientId,"] massSubscribe success ").concat(e$.map(u$=>{let{user:l$,mediaType:d$}=u$;return"user: ".concat(l$==null?void 0:l$.uid,", mediaType: ").concat(d$)}).join("; "))),i$}catch(c$){throw await this._p2pChannel.massUnsubscribeNoLock(e$),c$}}finally{o$(),n$()}}async unsubscribe(e$,t$,r$){if(!(e$ instanceof ir)){let i$=this.remoteUsers.find(o$=>o$.uid===e$);if(!i$)throw new O(R.INVALID_REMOTE_USER,"user is not in the channel");e$=i$}if(t$||this.store.useP2P){if(t$==="datachannel")return this._unsubscribeDataChannel(e$,r$)}else await this._unsubscribeDataChannel(e$,r$);if(t$&&Ce(t$,"mediaType",["audio","video"]),!this._joinInfo)throw new O(R.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(i$=>i$===e$)){let i$=new O(R.INVALID_REMOTE_USER,"user is not in the channel");throw _.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e$.uid,", user is not in the channel")),i$}_.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e$.uid,", mediaType: ").concat(t$));let n$=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof An)await this._p2pChannel.unsubscribe(e$,t$);else{let i$=await this._p2pChannel.unsubscribe(e$,t$);i$&&await this._gateway.unsubscribe(i$,e$.uid),t$&&t$!=="audio"||(e$._audio_pre_subscribed=!1),t$&&t$!=="video"||(e$._video_pre_subscribed=!1),e$._is_pre_created&&Wl(this._users,e$),_.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e$.uid,", mediaType: ").concat(t$))}}catch(i$){if(i$.code===R.DISCONNECT_P2P)return void _.warning("disconnecting p2p, abort unsubscribe request.");throw _.error("[".concat(this._clientId,"] unsubscribe user ").concat(e$.uid," error"),i$.toString()),i$}finally{n$()}}async _unsubscribeDataChannel(e$,t$){if(t$&&Nt(t$,"id",0,65535,!0),!this._joinInfo)throw new O(R.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(n$=>n$===e$)){let n$=new O(R.INVALID_REMOTE_USER,"user is not in the channel");throw _.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e$.uid,", user is not in the channel")),n$}let r$;if(typeof t$=="number"){let n$=e$._dataChannels.find(i$=>i$.id===t$);n$&&(r$=[n$])}else r$=e$._dataChannels;if(r$===void 0){let n$=new O(R.REMOTE_USER_IS_NOT_PUBLISHED);throw _.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e$.uid," with channelId ").concat(t$,", remote datachannel is not published")),n$}_.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e$.uid,", mediaType: datachannel, ids: ").concat(r$.map(n$=>n$.id)));try{let n$=await this._p2pChannel.unsubscribeDataChannel(e$,r$);n$&&await this._gateway.unsubscribeDataChannel(n$,e$.uid),_.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e$.uid,", mediaType: datachannel, ids: ").concat(n$))}catch(n$){if(n$.code===R.DISCONNECT_P2P)return void _.warning("disconnecting p2p, abort unsubscribe request.");throw _.error("[".concat(this._clientId,"] unsubscribe user ").concat(e$.uid," error"),n$.toString()),n$}}async massUnsubscribe(e$){if(br(e$,"unsubscribeList"),!this._joinInfo)throw new O(R.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");_.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e$.map(r$=>{let{user:n$,mediaType:i$}=r$;return"user: ".concat(n$==null?void 0:n$.uid,", mediaType: ").concat(i$,";")}).join())),e$=[...e$];let t$=new Map;for(let r$=e$.length-1;r$>=0;r$--){let{user:n$,mediaType:i$}=e$[r$];if(!n$){let s$=new O(R.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw _.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),s$}if(Ce(i$,"mediaType",["video","audio",void 0]),!this._users.find(s$=>s$===n$)){_.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(n$.uid,", user is not in the channel")),e$.splice(r$,1);continue}let o$=ve.Video|ve.LwoVideo;if(t$.has(n$)){let s$=t$.get(n$),a$;switch(i$){case"video":a$=s$&o$;break;case"audio":a$=s$&ve.Audio;break;default:a$=s$&(ve.Audio|o$)}if(a$){_.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(n$.uid,",mediaType:").concat(i$," twice.")),e$.splice(r$,1);continue}i$?i$==="audio"?t$.set(n$,s$|ve.Audio):i$==="video"&&t$.set(n$,s$|o$):t$.set(n$,s$|ve.Audio|o$)}else i$?i$==="audio"?t$.set(n$,ve.Audio):i$==="video"&&t$.set(n$,o$):t$.set(n$,ve.Audio|o$)}try{let r$=await this._p2pChannel.massUnsubscribe(e$);r$&&await this._gateway.massUnsubscribe(r$),_.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e$.map(n$=>{let{user:i$,mediaType:o$}=n$;return"user: ".concat(i$==null?void 0:i$.uid,", mediaType: ").concat(o$,";")}).join()))}catch(r$){if(r$.code===R.DISCONNECT_P2P)return void _.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw _.error("[".concat(this._clientId,"] massUnsubscribe error"),r$.toString()),r$}}async setLowStreamParameter(e$){(function(r$){if(!r$)throw new N(R.INVALID_PARAMS);zt(r$.width)||bp(r$.width,"streamParameter.width"),zt(r$.height)||bp(r$.height,"streamParameter.height"),zt(r$.framerate)||bp(r$.framerate,"streamParameter.framerate"),zt(r$.bitrate)||Nt(r$.bitrate,"streamParameter.bitrate")})(e$),(!e$.width&&e$.height||e$.width&&!e$.height)&&_.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),_.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e$));let t$=this._configDistribute.getLowStreamConfigDistribute();if(t$&&t$.bitrate&&e$.bitrate&&t$.bitrate<e$.bitrate&&(e$.bitrate=t$.bitrate),this._lowStreamParameter=e$,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e$,U.LocalVideoLowTrack)}async enableDualStream(){if(!ft().supportDualStream)throw X.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new O(R.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new O(R.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e$){throw X.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e$}this._isDualStreamEnabled=!0,X.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),_.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new O(R.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(U.LocalVideoLowTrack))try{let e$=await this._p2pChannel.unpublishLowStream();e$&&await this._gateway.unpublish(e$,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e$){throw X.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e$}this._isDualStreamEnabled=!1,X.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),_.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e$,t$){if(function(r$){Ce(r$,"role",["audience","host"])}(e$),t$&&fR(t$),this.mode==="rtc"||this.mode==="p2p")throw _.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new O(R.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t$&&t$.level&&e$==="host")throw new O(R.INVALID_OPERATION,"host mode can not set audience latency level");if(e$==="audience"&&this._p2pChannel.hasLocalMedia())throw new O(R.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e$,t$),this._config.role=e$,_.info("[".concat(this._clientId,"] set client role to ").concat(e$,", level: ").concat(t$&&t$.level))}getRemoteInboundOffset(){var e$;let t$=(e$=this._p2pChannel.getStats())===null||e$===void 0?void 0:e$.audioSend[0];if(!t$||!t$.timestamp)return 0;let r$=t$.timestamp-Date.now();return Math.abs(r$)>1e3+t$.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r$:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e$,t$){if(Pe(e$,"proxyServer"),!t$){if(this.connectionState!=="DISCONNECTED")throw new O(R.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new O(R.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e$,X.setProxyServer(this._proxyServer),_.setProxyServer(this._proxyServer),_.info("[".concat(this._clientId,"] Set proxy server ").concat(t$?"by initialize call":""," success."))}setTurnServer(e$,t$){if(Array.isArray(e$)||(e$=[e$]),!t$){if(this.connectionState!=="DISCONNECTED")throw new O(R.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new O(R.INVALID_OPERATION,"You have already set the proxy")}if(Yu(e$))return this._turnServer={servers:e$,mode:"original-manual"},void _.info("[".concat(this._clientId,"] Set original turnserver ").concat(t$?"by initialize call":""," success: ").concat(e$.map(r$=>r$.urls).join(","),"."));e$.forEach(r$=>vO(r$)),this._turnServer={servers:e$,mode:"manual"},_.info("[".concat(this._clientId,"] Set turnserver ").concat(t$?"by initialize call":""," success."))}setLicense(e$){if(this.connectionState!=="DISCONNECTED")throw new O(R.INVALID_OPERATION,"you should set license before join channel");if(Pe(e$,"license",32,32),!/^[A-Za-z\d]+$/.test(e$))throw new O(R.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e$,_.info("[".concat(this._clientId,"] set license success"),e$)}startProxyServer(e$){if(this.connectionState!=="DISCONNECTED")throw new O(R.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new O(R.INVALID_OPERATION,"You have already set the proxy");let t$=[3,4,5],r$;switch(e$===void 0&&(e$=3),e$){case 1:case 2:throw new O(R.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:r$="proxy3";break;case 4:r$="proxy4";break;case 5:r$="proxy5";break;default:throw new O(R.INVALID_PARAMS,"proxy server mode must be ".concat(t$.join("|")))}this._cloudProxyServerMode=r$,this.store.cloudProxyServerMode=r$,_.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new O(R.INVALID_OPERATION,"Stop proxy server after leave channel");X.setProxyServer(),_.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",_.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e$){if(!e$.accessPoints)throw new O(R.INVALID_PARAMS,"accessPoints is required.");br(e$.accessPoints.serverList,"accessPoints.serverList"),Pe(e$.accessPoints.domain,"accessPoints.domain");let t$=(h$,p$)=>{Nt(h$,p$,0,65535,!0)},r$=443;if(e$.accessPoints.port&&(t$(e$.accessPoints.port,"accessPoints.port"),r$=e$.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new O(R.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");v("CLOSE_AFB_FOR_LOCAL_AP")&&(Ot("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Ot("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let n$=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i$=e$.accessPoints.domain,o$=e$.accessPoints.serverList.map(h$=>n$.test(h$)?"".concat(h$.replace(/\./g,"-"),".").concat(i$):h$),s$=o$.map(h$=>"".concat(h$,":").concat(r$));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Ot("WEBCS_DOMAIN",s$),Ot("WEBCS_DOMAIN_BACKUP_LIST",s$),Ot("GATEWAY_DOMAINS",[i$]),e$.report&&e$.report.hostname&&Array.isArray(e$.report.hostname)&&e$.report.hostname.length?(br(e$.report.hostname,"report.hostname"),Ot("EVENT_REPORT_DOMAIN",e$.report.hostname[0]),Ot("EVENT_REPORT_BACKUP_DOMAIN",e$.report.hostname[1]||e$.report.hostname[0])):(Ot("EVENT_REPORT_DOMAIN",o$[0]),Ot("EVENT_REPORT_BACKUP_DOMAIN",o$[1]||o$[0]));let a$=6443;e$.report&&e$.report.port&&(t$(e$.report.port,"report.port"),a$=e$.report.port),Ot("STATS_COLLECTOR_PORT",a$),e$.report?Ot("ENABLE_EVENT_REPORT",!0):Ot("ENABLE_EVENT_REPORT",!1);let c$="";e$.log&&e$.log.hostname&&Array.isArray(e$.log.hostname)&&e$.log.hostname.length?(br(e$.log.hostname,"log.hostname"),c$=e$.log.hostname[0]):c$=o$[0];let u$=6444;e$.log&&e$.log.port&&(t$(e$.log.port,"log.port"),u$=e$.log.port),Ot("LOG_UPLOAD_SERVER","".concat(c$,":").concat(u$));let l$=[];e$.cds&&e$.cds.hostname&&Array.isArray(e$.cds.hostname)&&e$.cds.hostname.length?(br(e$.cds.hostname,"cds.hostname"),l$=e$.cds.hostname):l$=o$;let d$=443;e$.cds&&e$.cds.port&&(t$(e$.cds.port,"cds.port"),d$=e$.cds.port),Ot("CDS_AP",l$.map(h$=>"".concat(h$,":").concat(d$))),e$.cds?Ot("ENABLE_CONFIG_DISTRIBUTE",!0):Ot("ENABLE_CONFIG_DISTRIBUTE",!1),_.info("set local access point v2 success")}setLocalAccessPoints(e$,t$){if(br(e$,"serverList"),Pe(t$,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new O(R.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let r$=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e$=e$.map(n$=>r$.test(n$)?"".concat(n$.replace(/\./g,"-"),".").concat(t$):n$),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Ot("WEBCS_DOMAIN",e$),Ot("WEBCS_DOMAIN_BACKUP_LIST",e$),Ot("GATEWAY_DOMAINS",[t$]),Ot("EVENT_REPORT_DOMAIN",e$[0]),Ot("EVENT_REPORT_BACKUP_DOMAIN",e$[1]||e$[0]),Ot("LOG_UPLOAD_SERVER","".concat(e$[0],":6444")),_.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e$){if(Ce(e$,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e$,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e$),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t$){throw _.error("[".concat(this._clientId,"] set default remote video stream type error"),t$.toString()),t$}else _.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e$))}async setRemoteVideoStreamType(e$,t$){Ce(t$,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e$,t$),setTimeout(()=>{let r$=this._users.find(n$=>n$.uid===e$);r$&&r$.videoTrack&&r$.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(r$){throw _.error("[".concat(this._clientId,"] set remote video stream type error"),r$.toString()),r$}_.info("[".concat(this._clientId,"] set remote ").concat(e$," video stream type to ").concat(t$)),this._remoteStreamTypeCacheMap.set(e$,t$)}async setStreamFallbackOption(e$,t$){Ce(t$,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e$,t$)}catch(r$){throw _.error("[".concat(this._clientId,"] set stream fallback option"),r$.toString()),r$}_.info("[".concat(this._clientId,"] set remote ").concat(e$," stream fallback type to ").concat(t$)),this._streamFallbackTypeCacheMap.set(e$,t$)}setEncryptionConfig(e$,t$,r$,n$){(function(o$){Ce(o$,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e$),Pe(t$,"secret");let i$=["aes-128-gcm2","aes-256-gcm2"];if(W(i$).call(i$,e$)){if(!r$||!(r$ instanceof Uint8Array&&r$.length===32))throw new O(R.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r$)throw new O(R.INVALID_PARAMS,"current encrypt mode does not need salt");if(n$){if(Nr(n$,"encryptDataStream"),!W(i$).call(i$,e$))throw new O(R.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t$)||_.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e$,this._encryptionSecret=t$,r$&&(this._encryptionSalt=so(r$))}async renewToken(e$){if(Pe(e$,"token",1,2047),!this._key||!this._joinInfo)throw new O(R.INVALID_OPERATION,"renewToken should not be called before user join");let t$=this._key;this._key=e$,this._joinInfo&&(this._joinInfo.token=e$);let r$=await this._renewTokenMutex.lock();try{if(v("USE_NEW_TOKEN")){_.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let n$=await JG(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ee);_.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e$,ticket:n$})}else _.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e$});_.debug("[".concat(this._clientId,"] renewToken success"))}catch(n$){throw this._key=t$,this._joinInfo.token=t$,_.error("[".concat(this._clientId,"] renewToken failed"),n$.toString()),n$}finally{r$()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?_.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e$=this._p2pChannel.getAudioLevels();this.safeEmit(ut.VOLUME_INDICATOR,e$)},v("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e$=this._statsCollector.getRTCStats(),t$=this._gateway.getInChannelInfo();return e$.Duration=Math.round(t$.duration/1e3),e$}async startLiveStreaming(e$,t$){if(!t$){if(this.codec!=="h264")throw new O(R.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new O(R.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e$)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e$))throw new O(R.LIVE_STREAMING_TASK_CONFLICT);let r$=t$?er.TRANSCODE:er.RAW;return this._createLiveStreamingClient(r$).startLiveStreamingTask(e$,r$)}setLiveTranscoding(e$){return this._createLiveStreamingClient(er.TRANSCODE).setTranscodingConfig(e$)}async stopLiveStreaming(e$){let t$=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(r$=>r$&&r$.hasUrl(e$));if(!t$.length)throw new O(R.INVALID_PARAMS,"can not find live streaming url to stop");await j.all(t$.map(r$=>r$&&r$.stopLiveStreamingTask(e$)))}async startChannelMediaRelay(e$){Pv(e$),await this._createChannelMediaRelayClient().startChannelMediaRelay(e$)}async updateChannelMediaRelay(e$){Pv(e$),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e$)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e$){var t$;let r$=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new O(R.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e$=="string"||e$ instanceof Uint8Array)&&(e$={payload:e$}),typeof e$.payload=="string"){let i$=new TextEncoder;e$.payload=i$.encode(e$.payload)}let n$=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&W(t$=["aes-128-gcm2","aes-256-gcm2"]).call(t$,this._encryptionMode)&&(n$=!0,e$.payload=await async function(i$,o$,s$){var a$;let c$=ji(a$=Array.from(s$)).call(a$,(f$,m$)=>f$+m$,0),u$={serverTs:0,seq:SB++,length:s$.length,checkSum:c$},l$=new Uint8Array(IR(c$,2)),d$=new ArrayBuffer(us),h$=new DataView(d$);h$.setUint32(0,u$.serverTs),h$.setUint16(4,u$.seq),h$.setUint16(6,u$.length),h$.setUint16(8,u$.checkSum);let p$=16-s$.length%16;s$=TR(s$,new Uint8Array(p$));let _$=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i$,tagLength:yR,additionalData:l$},o$,s$);return TR(new Uint8Array(d$),new Uint8Array(_$))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e$.payload)),new Blob([e$.payload]).size>1024)throw new O(R.INVALID_PARAMS,n$?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(et.DATA_STREAM,{payload:so(e$.payload),syncWithAudio:e$.syncWithAudio,sendTs:Date.now()-EW},!r$)}sendMetadata(e$){if(!this._joinInfo)throw new O(R.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e$]).size>1024)throw new O(R.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(et.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:so(e$)})}async sendCustomReportMessage(e$){if(Array.isArray(e$)||(e$=[e$]),e$.forEach(RB),!this._joinInfo)throw new O(R.INVALID_OPERATION,"can not send custom report, not joined");await X.sendCustomReportMessage(this._joinInfo.sid,e$)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e$,t$){Ce(t$.spatialLayer,"spatialLayer",[0,1,2,3]),Ce(t$.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e$,t$)}catch(r$){throw _.error("[".concat(this._clientId,"] pick SVC layer failed"),r$.toString()),r$}}async setRTMConfig(e$){let{apRTM:t$=!1,rtmFlag:r$}=e$;if(Nr(t$,"apRTM"),Nt(r$,"rtmFlag",0),this._rtmConfig.apRTM=t$,this._rtmConfig.rtmFlag=r$,_.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e$)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t$,this._joinInfo.rtmFlag=r$,this._gateway.setRTM2Flag(r$)}_reset(){if(_.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=mn.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&b0(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e$=>{e$._audioTrack&&e$._audioTrack._destroy(),e$._videoTrack&&e$._videoTrack._destroy(),e$._dataChannels&&(e$._dataChannels.forEach(t$=>t$._close()),e$._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new ze("client-publish"),this._subscribeMutex=new ze("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e$,t$){var r$;let n$=e$||Ms();e$?_.debug("[".concat(this._clientId,"] new Session ").concat(n$)):_.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n$));let i$=e$?"":this._sessionId||"";this._sessionId=n$,this.store.sessionId=n$;let o$={lts:new Date().getTime(),mode:this.mode,buildFormat:2,stringUid:(t$==null?void 0:t$.stringUid)||((r$=this._joinInfo)===null||r$===void 0?void 0:r$.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i$,clientRole:this.role==="audience"?2:1};X.sessionInit(this._sessionId,xi({cname:t$.channel,appid:t$.appId},o$)),this._joinInfo&&(this._joinInfo.sid=n$),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n$)}async _publishHighStream(e$){if(!this._joinInfo||this._uid===void 0)throw new O(R.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&v("FORCE_TURN")&&!v("TURN_ENABLE_TCP")&&!v("TURN_ENABLE_UDP"))throw new O(R.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");_.debug("[".concat(this._clientId,"] publish high stream"));try{let r$=await this._p2pChannel.publish(e$,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof An){let n$=(await r$.next()).value;if(n$){try{await this._gateway.sendExtensionMessage(ie.PUBLISH,n$,!0)}catch(i$){throw r$.throw(i$),i$}await r$.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let n$=(await r$.next()).value;if(n$){var t$;let i$;try{i$=await this._gateway.publish(this._uid,n$,!0)}catch(o$){if(o$.code!==R.DISCONNECT_P2P)throw r$.throw(o$),o$}await r$.next(((t$=i$)===null||t$===void 0?void 0:t$.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let i$ of e$)i$ instanceof Ft&&i$._encoderConfig&&this._gateway.setVideoProfile(i$._encoderConfig),!i$.muted&&i$.enabled||await this._p2pChannel.muteLocalTrack(i$)}}catch(r$){if(this._p2pChannel.reportPublishEvent(!1,r$==null?void 0:r$.code,e$),(r$==null?void 0:r$.code)===R.WS_ABORT)return;throw r$}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new O(R.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new O(R.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));_.debug("[".concat(this._clientId,"] publish low stream"));let e$=this._configDistribute.getLowStreamConfigDistribute();e$&&e$.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e$.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e$.bitrate));try{let r$=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n$=(await r$.next()).value;if(n$){var t$;let i$;try{i$=await this._gateway.publish(this._uid,n$,!0)}catch(o$){if(o$.code!==R.DISCONNECT_P2P)throw r$.throw(o$),o$}r$.next(((t$=i$)===null||t$===void 0?void 0:t$.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(r$){if(this._p2pChannel.reportPublishEvent(!1,r$==null?void 0:r$.code,void 0,!0),(r$==null?void 0:r$.code)===R.WS_ABORT)return;throw r$}}_createLiveStreamingClient(e$){let t$=()=>{if(!this._joinInfo||!this._appId)return new O(R.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let r$=(n$={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Za("LiveStreaming").create(n$));var n$;return r$.onLiveStreamError=(i$,o$)=>{X.reportApiInvoke(this._sessionId,{name:Te.ON_LIVE_STREAM_ERROR,options:[i$,o$],tag:Zt.TRACER}).onSuccess(),this.safeEmit(ut.LIVE_STREAMING_ERROR,i$,o$)},r$.onLiveStreamWarning=(i$,o$)=>{X.reportApiInvoke(this._sessionId,{name:Te.ON_LIVE_STREAM_WARNING,options:[i$,o$],tag:Zt.TRACER}).onSuccess(),this.safeEmit(ut.LIVE_STREAMING_WARNING,i$,o$)},r$.on(VE.REQUEST_WORKER_MANAGER_LIST,(i$,o$,s$)=>{if(!this._joinInfo)return s$(new O(R.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(a$,c$,u$,l$){let d$=v("UAP_AP").slice(0,v("AJAX_REQUEST_CONCURRENT")).map(h$=>c$.proxyServer?"https://".concat(c$.proxyServer,"/ap/?url=").concat(h$+"/api/v1?action=uap"):"https://".concat(h$,"/api/v1?action=uap"));return await WG(d$,a$,c$,u$,l$)})(i$,this._joinInfo,this._axiosCancelSource.token,Ee).then(o$).catch(s$)}),r$};return e$===er.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t$(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t$(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new O(R.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:t$,sendResolutionHeight:r$}=this.getLocalVideoStats(),n$=(e$={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t$,height:r$}},Za("ChannelMediaRelay").create(e$));n$.on("state",i$=>{i$===Sn.RELAY_STATE_FAILURE&&n$&&n$.dispose(),this.safeEmit(ut.CHANNEL_MEDIA_RELAY_STATE,i$)}),n$.on("event",i$=>{this.safeEmit(ut.CHANNEL_MEDIA_RELAY_EVENT,i$)}),this._channelMediaRelayClient=n$,this._statsCollector.onStatsChanged=(i$,o$)=>{var s$;i$==="resolution"&&((s$=this._channelMediaRelayClient)===null||s$===void 0||s$.setVideoProfile(o$))}}var e$;return this._channelMediaRelayClient}_handleUpdateDataChannel(e$,t$){let{added:r$,deleted:n$}=e$,i$=[];if(t$){let o$=[];this._users.forEach(s$=>{s$._dataChannels.forEach(a$=>{r$.every(c$=>c$.uid!==s$._uintid||c$.stream_id!==a$.id)&&o$.push({uid:s$._uintid,stream_id:a$.id,ordered:a$.ordered,max_retrans_times:a$.maxRetransmits,metadata:a$.metadata})})}),o$.length>0&&this._handleUpdateDataChannel({added:[],deleted:o$})}Array.isArray(r$)&&r$.length>0&&r$.forEach(o$=>{let{uid:s$,stream_id:a$,ordered:c$,max_retrans_times:u$,metadata:l$}=o$,d$=this._users.find(h$=>h$._uintid===s$);if(!d$)return void _.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(_.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(s$)),W(i$).call(i$,d$)||i$.push(d$),d$._uintid||(d$._uintid=s$),d$._dataChannels.findIndex(h$=>h$.id===o$.stream_id)===-1){let h$={id:a$,ordered:!!c$,maxRetransmits:u$,metadata:l$},p$=function(_$){return Kv(_$,!0)}(h$);d$._dataChannels.push(p$),_.info("[".concat(this._clientId,"] remote user ").concat(d$.uid," published datachannel")),t$||this.safeEmit(ut.USER_PUBLISHED,d$,"datachannel",h$)}this._p2pChannel.hasPendingRemoteDataChannel(d$,o$.stream_id)&&(_.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(d$.uid," after reconnect.")),this._subscribeDataChannel(d$,o$.stream_id).catch(h$=>{_.error("[".concat(this._clientId,"] resubscribe datachannel error"),h$.toString())}))}),t$&&(this.safeEmit(ut.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(n$)&&n$.length>0&&n$.forEach(o$=>{let{uid:s$,stream_id:a$}=o$,c$=this._users.find(l$=>l$._uintid===s$);if(!c$)return void _.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let u$=c$._dataChannels.find(l$=>l$.id===o$.stream_id);u$&&(_.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(s$)),this._p2pChannel.unsubscribeDataChannel(c$,[u$]).then(l$=>{if(c$._dataChannels=c$._dataChannels.filter(d$=>d$!==u$),l$)return this._gateway.unsubscribeDataChannel(l$,c$.uid)}),_.info("[".concat(this._clientId,"] remote user ").concat(s$," unpublished datachannel ,id:").concat(u$.id)),this.safeEmit(ut.USER_UNPUBLISHED,c$,"datachannel",u$._config))})}_handleRemoveDataChannels(e$){let t$=this._users.find(r$=>r$.uid===e$.uid);if(t$){if(t$._dataChannels!==void 0&&t$._dataChannels.length>0){_.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e$.uid));let r$=()=>{_.info("[".concat(this._clientId,"] remote user ").concat(t$.uid," unpublished datachannel")),t$._dataChannels.forEach(n$=>{this.safeEmit(ut.USER_UNPUBLISHED,t$,"datachannel",n$._config)})};this._p2pChannel.unsubscribeDataChannel(t$,t$._dataChannels).then(n$=>{if(n$)return this._gateway.unsubscribeDataChannel(n$,t$.uid)}),r$()}}else _.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(xe.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(xe.CONNECTION_STATE_CHANGE,(e$,t$,r$)=>{var n$;if(r$===At.FALLBACK)return;let i$=()=>{this.safeEmit(ut.CONNECTION_STATE_CHANGE,e$,t$,r$)};if(X.reportApiInvoke(this._sessionId||((n$=this._gateway.joinInfo)===null||n$===void 0?void 0:n$.sid)||null,{name:Te.CONNECTION_STATE_CHANGE,options:[e$,t$,r$],tag:Zt.TRACER}).onSuccess(JSON.stringify({cur:e$,prev:t$,reason:r$})),_.info("[".concat(this._clientId,"] connection state change: ").concat(t$," -> ").concat(e$)),e$==="DISCONNECTED")return this._reset(),void i$();if(e$==="RECONNECTING")this._users.forEach(s$=>{s$._trust_in_room_=!1,s$._trust_audio_enabled_state_=!1,s$._trust_video_enabled_state_=!1,s$._trust_audio_mute_state_=!1,s$._trust_video_mute_state_=!1,s$._trust_audio_stream_added_state_=!1,s$._trust_video_stream_added_state_=!1,s$._is_pre_created||(s$._audio_pre_subscribed||(s$._audioSSRC=void 0,s$._audioOrtc=void 0),s$._video_pre_subscribed||(s$._videoSSRC=void 0,s$._videoOrtc=void 0,s$._rtxSsrcId=void 0),s$._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e$==="CONNECTED"){var o$;this._streamFallbackTypeCacheMap.forEach((s$,a$)=>{this._gateway.setStreamFallbackOption(a$,s$).catch(c$=>{_.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),c$)})}),this._remoteStreamTypeCacheMap.forEach((s$,a$)=>{this._gateway.setRemoteVideoStreamType(a$,s$).catch(c$=>{_.warning("[".concat(this._clientId,"] auto set remote stream type failed"),c$)})}),this._remoteDefaultVideoStreamType!==void 0&&((o$=this._joinInfo)===null||o$===void 0?void 0:o$.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{_.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(s$=>{_.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(s$))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(s$=>!s$._trust_in_room_).forEach(s$=>{_.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(s$.uid)),this._handleUserOffline({uid:s$.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(s$=>{s$._trust_audio_mute_state_||(_.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(s$.uid)),this._handleMuteStream(s$.uid,Q.AUDIO,!1)),s$._trust_video_mute_state_||(_.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(s$.uid)),this._handleMuteStream(s$.uid,Q.VIDEO,!1)),s$._trust_audio_enabled_state_||(_.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(s$.uid)),this._handleSetStreamLocalEnable("audio",s$.uid,!0)),s$._trust_video_enabled_state_||(_.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(s$.uid)),this._handleSetStreamLocalEnable("video",s$.uid,!0)),s$._trust_video_stream_added_state_||(_.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(s$.uid)),this._handleResetAddStream(s$,"video")),s$._trust_audio_stream_added_state_||(_.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(s$.uid)),this._handleResetAddStream(s$,"audio")),s$._video_added_||s$._audio_added_||(_.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(s$.uid)),this._handleRemoveStream({uid:s$.uid,uint_id:s$._uintid}))}))},1e3))}i$()}),this._gateway.on(xe.REQUEST_NEW_GATEWAY_LIST,async(e$,t$)=>{if(!this._joinInfo)return t$(new O(R.UNEXPECTED_ERROR,"can not recover, no join info"));try{let r$,n$=await Xv(xi(xi({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));n$?(r$=n$.ap,Qv(n$),this._joinInfo.preload=!0):(r$=await nm(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ee,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=r$.gatewayInfo.res,this._joinInfo.gatewayAddrs=r$.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=r$.gatewayInfo.uni_lbs_ip);let i$=[];r$.gatewayInfo.gatewayAddrs.forEach(o$=>{let{address:s$}=o$,[a$,c$]=s$.split(":");this._joinInfo&&this._joinInfo.proxyServer?i$.push({proxy:this._joinInfo.proxyServer,host:a$,port:c$}):i$.push({host:a$,port:c$})}),e$(i$)}catch(r$){t$(r$)}}),this._gateway.on(xe.NETWORK_QUALITY,e$=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(ut.NETWORK_QUALITY,e$)}),this._gateway.on(xe.STREAM_TYPE_CHANGE,(e$,t$)=>{this.safeEmit(ut.STREAM_TYPE_CHANGED,e$,t$),X.reportApiInvoke(this._sessionId,{name:Te.STREAM_TYPE_CHANGE,options:[e$,t$],tag:Zt.TRACER}).onSuccess(JSON.stringify({uid:e$,streamType:t$}))}),this._gateway.on(xe.IS_P2P_DISCONNECTED,e$=>{this._p2pChannel.isP2PDisconnected()?e$(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e$(!1):e$(!0)}),this._gateway.on(xe.REQUEST_P2P_CONNECTION_PARAMS,async(e$,t$,r$)=>{try{let n$=await this._p2pChannel.getEstablishParams();v("ENABLE_PREALLOC_PC")&&n$||(n$=await this._p2pChannel.startP2PConnection(e$)),t$(n$)}catch(n$){r$(n$)}}),this._gateway.on(xe.JOIN_RESPONSE,(e$,t$)=>{if(this.store.useP2P)return;let r$=qI(e$.ortc,t$,e$.attributes.userAttributes.preSubSsrcs);this._p2pChannel.connect(r$)}),this._gateway.on(xe.PRE_CONNECT_PC,async e$=>{let{candidates:t$,fingerprint:r$}=e$;if(this._joinInfo&&t$.length>0&&!this._p2pChannel.isPlanB){var n$;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});let{cert:i$,cid:o$}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o$,"_").concat(i$),icePwd:"".concat(o$,"_").concat(i$)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(n$=v("FINGERPRINT"))!==null&&n$!==void 0?n$:r$}]},candidates:t$,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(dt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(dt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(dt.ON_ADD_AUDIO_STREAM,e$=>this._handleAddAudioOrVideoStream("audio",e$.uid,e$.ssrcId,e$.cname,e$.uint_id,e$.ortc)),this._gateway.signal.on(dt.ON_ADD_VIDEO_STREAM,e$=>this._handleAddAudioOrVideoStream("video",e$.uid,e$.ssrcId,e$.cname,e$.uint_id,e$.ortc,e$.rtxSsrcId)),this._gateway.signal.on(dt.ON_REMOTE_DATASTREAM_UPDATE,e$=>{this._handleUpdateDataChannel(e$)}),this._gateway.signal.on(dt.ON_REMOTE_FULL_DATASTREAM_INFO,e$=>{this._handleUpdateDataChannel({added:e$.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(dt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(dt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(dt.MUTE_AUDIO,e$=>this._handleMuteStream(e$.uid,Q.AUDIO,!0)),this._gateway.signal.on(dt.UNMUTE_AUDIO,e$=>this._handleMuteStream(e$.uid,Q.AUDIO,!1)),this._gateway.signal.on(dt.MUTE_VIDEO,e$=>this._handleMuteStream(e$.uid,Q.VIDEO,!0)),this._gateway.signal.on(dt.UNMUTE_VIDEO,e$=>this._handleMuteStream(e$.uid,Q.VIDEO,!1)),this._gateway.signal.on(dt.RECEIVE_METADATA,e$=>{let t$=Fo(e$.metadata);this.safeEmit(ut.RECEIVE_METADATA,e$.uid,t$)}),this._gateway.signal.on(dt.ON_DATA_STREAM,async e$=>{var t$;if(!e$)return;let r$=Fo(e$.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&W(t$=["aes-128-gcm2","aes-256-gcm2"]).call(t$,this._encryptionMode)){if(e$.payload.length<us)throw new O(R.UNEXPECTED_RESPONSE,"payload length ".concat(e$.payload.length," is less than header length ").concat(us));r$=await async function(i$,o$,s$){let a$=s$.subarray(0,us),c$=a$.slice(8,us),u$=(c$[0]<<8)+c$[1],l$=(a$[6]<<8)+a$[7],d$=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:i$,tagLength:yR,additionalData:new Uint8Array(IR(u$,2))},o$,s$.subarray(us));return new Uint8Array(d$).subarray(0,l$)}(this._encryptDataStreamIv,this._encryptDataStreamKey,r$)}let n$=0;if(e$.ordered||e$.syncWithAudio){let i$=this._p2pChannel.getStats(),o$=this.remoteUsers.find(a$=>a$.uid===e$.uid),s$=i$==null?void 0:i$.audioRecv.find(a$=>a$.ssrc===(o$==null?void 0:o$._audioSSRC));n$=s$==null?void 0:s$.jitterBufferMs}n$==null&&(n$=0),fW(xi(xi({},e$),{},{payload:r$}),n$,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(dt.ON_CRYPT_ERROR,()=>{po(()=>{_.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(ut.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(dt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{_.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,At.TOKEN_EXPIRE),this.safeEmit(ut.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(dt.ON_STREAM_FALLBACK_UPDATE,e$=>{_.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e$.stream_id,", attr: ").concat(e$.stream_type)),this.safeEmit(ut.STREAM_FALLBACK,e$.stream_id,e$.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(dt.ON_PUBLISH_STREAM,e$=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e$.proxy})),_.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e$))))}),this._gateway.signal.on(dt.ENABLE_LOCAL_VIDEO,e$=>{this._handleSetStreamLocalEnable("video",e$.uid,!0)}),this._gateway.signal.on(dt.DISABLE_LOCAL_VIDEO,e$=>{this._handleSetStreamLocalEnable("video",e$.uid,!1)}),this._gateway.signal.on(nt.REQUEST_TIMEOUT,(e$,t$)=>{if(this._joinInfo)switch(e$){case et.PUBLISH:{if(!t$)return;let i$=t$.ortc;if(i$){var r$,n$;let o$=i$.some(c$=>{let{stream_type:u$}=c$;return u$===Ct.Audio}),s$=i$.some(c$=>{let{stream_type:u$}=c$;return u$!==Ct.Audio}),a$=i$.some(c$=>{let{stream_type:u$}=c$;return u$===Ct.Screen||u$===Ct.ScreenLow});t$.state==="offer"&&X.publish(this._joinInfo.sid,{eventElapse:qe.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:R.TIMEOUT,audio:o$,video:s$,p2pid:t$.p2p_id,publishRequestid:this.store.pubId,screenshare:a$,audioName:o$?(r$=i$.find(c$=>{let{stream_type:u$}=c$;return u$===Ct.Audio}))===null||r$===void 0||(r$=r$.ssrcs[0])===null||r$===void 0?void 0:r$.ssrcId.toString():void 0,videoName:s$?(n$=i$.find(c$=>{let{stream_type:u$}=c$;return u$!==Ct.Audio}))===null||n$===void 0||(n$=n$.ssrcs[0])===null||n$===void 0?void 0:n$.ssrcId.toString():void 0})}break}case et.SUBSCRIBE:t$&&X.subscribe(this._joinInfo.sid,{succ:!1,ec:R.TIMEOUT,audio:t$.stream_type===Q.AUDIO,video:t$.stream_type===Q.VIDEO,peerid:t$.stream_id,subscribeRequestid:t$.ssrcId,p2pid:this.store.p2pId,eventElapse:qe.measureFromSubscribeStart(this.store.clientId,t$.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t$.ssrcId)})}}),this._gateway.signal.on(dt.ON_P2P_OK,e$=>{this.uid,this._uid}),this._gateway.signal.on(dt.ON_PUBLISHED_USER_LIST,e$=>{if(e$==null||!e$.users)return;v("BLOCK_LOCAL_CLIENT")&&(e$.users=e$.users.filter(n$=>!Io(n$.string_id||n$.stream_id,this.channelName)));let t$=[],r$=[];for(let n$ of e$.users){let i$=this._users.find(l$=>l$._uintid===n$.stream_id);i$?i$._trust_in_room_=!0:(i$=new ir(n$.string_id||n$.stream_id,n$.stream_id),this._users.push(i$),this.getListeners(ut.PUBLISHED_USER_LIST).length===0&&(_.debug("[".concat(this._clientId,"] user online"),n$.stream_id),this.safeEmit(ut.USER_JOINED,i$)));let o$=ve.Audio&n$.stream_type,s$=(ve.Video|ve.LwoVideo)&n$.stream_type,a$=(65280&n$.stream_type)!=0,c$=o$&&i$.hasAudio,u$=s$&&i$.hasVideo;s$&&(i$._trust_video_stream_added_state_=!0,i$._video_added_=!0,i$._videoSSRC=n$.video_ssrc,i$._rtxSsrcId=n$.video_rtx),o$&&(i$._trust_audio_stream_added_state_=!0,i$._audio_added_=!0,i$._audioSSRC=n$.audio_ssrc),o$&&!c$&&this.getListeners(ut.PUBLISHED_USER_LIST).length===0&&(_.info("[".concat(this._clientId,"] remote user ").concat(i$.uid," published audio")),this.safeEmit(ut.USER_PUBLISHED,i$,"audio")),s$&&!u$&&this.getListeners(ut.PUBLISHED_USER_LIST).length===0&&(_.info("[".concat(this._clientId,"] remote user ").concat(i$.uid," published video")),this.safeEmit(ut.USER_PUBLISHED,i$,"video")),(o$&&!c$||s$&&!u$||a$)&&t$.push(i$),s$&&this._p2pChannel.hasPendingRemoteMedia(i$,"video")&&r$.push({user:i$,mediaType:"video"}),o$&&this._p2pChannel.hasPendingRemoteMedia(i$,"audio")&&r$.push({user:i$,mediaType:"audio"})}r$.length>0&&(_.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r$.map(n$=>"user: ".concat(n$.user.uid,", mediaType: ").concat(n$.mediaType)).join("; ")," ")),this.massSubscribe(r$).catch(n$=>{_.error("[".concat(this._clientId,"] mass resubscribe error"),n$.toString())})),this.getListeners(ut.PUBLISHED_USER_LIST).length>0?v("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t$:(_.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t$.map(n$=>n$.uid).join(", "))),this.safeEmit(ut.PUBLISHED_USER_LIST,t$)):_.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t$.map(n$=>n$.uid).join(", ")))}),this._gateway.signal.on(dt.ON_RTP_CAPABILITY_CHANGE,e$=>{let{video_codec:t$}=e$;this._p2pChannel instanceof Jd&&this._p2pChannel.updateRemoteRTPCapabilities(t$.map(r$=>r$.toLowerCase()).filter(r$=>{var n$;return W(n$=Object.keys(Ju)).call(n$,r$)}))})}_handleP2PEvents(){this._gateway.signal.on(dt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(ie.PUBLISH,(e$,t$,r$)=>{let{uid:n$}=e$;e$.forEach(i$=>{let{kind:o$,ssrcs:s$,mid:a$,isMuted:c$}=i$;this._handleP2PAddAudioOrVideoStream(o$,n$,s$[0].ssrcId,a$);let u$=this._users.find(l$=>l$.uid===n$);return u$&&this._p2pChannel instanceof An?this._p2pChannel.mockSubscribe(u$,o$,s$[0].ssrcId,a$).then(()=>{t$()}).catch(r$):t$(),this._handleMuteStream(n$,o$,!!c$)})}),this._gateway.signal.on(ie.CALL,async(e$,t$,r$)=>{if(this._p2pChannel instanceof An)try{var n$;t$(await this._p2pChannel.startP2P({turnServer:(n$=this._joinInfo)===null||n$===void 0?void 0:n$.turnServer},e$))}catch(i$){r$(i$)}}),this._gateway.signal.on(nt.P2P_CONNECTION,async e$=>{this._p2pChannel instanceof An&&await this._p2pChannel.p2pConnect(e$)}),this._gateway.signal.on(ie.UNPUBLISH,async(e$,t$,r$)=>{if(this._p2pChannel instanceof An){let{unpubMsg:n$,uid:i$}=e$,o$=this._users.find(s$=>s$.uid===i$);if(!o$)return _.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i$)),void t$();try{n$.forEach(async s$=>{let{stream_type:a$}=s$,c$=a$===Ct.Audio?Q.AUDIO:Q.VIDEO;await this._p2pChannel.unsubscribe(o$,c$),this._handleMuteStream(i$,c$,!0)}),t$()}catch(s$){r$(s$)}}}),this._gateway.signal.on(ie.CONTROL,async(e$,t$)=>{let{action:r$}=e$;switch(r$){case to.MUTE_LOCAL_VIDEO:this._handleMuteStream(t$,Q.VIDEO,!0);break;case to.MUTE_LOCAL_AUDIO:this._handleMuteStream(t$,Q.AUDIO,!0);break;case to.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t$),this._handleMuteStream(t$,Q.VIDEO,!1);break;case to.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t$),this._handleMuteStream(t$,Q.AUDIO,!1)}}),this._gateway.signal.on(ie.RESTART_ICE,async(e$,t$,r$)=>{if(this._p2pChannel instanceof An)try{let{direction:n$,iceParameter:i$}=e$;n$!==cn.SEND_ONLY||i$?t$(await this._p2pChannel.restartICE(n$,i$)):(this._p2pChannel.handleDisconnect(n$),t$())}catch(n$){r$(n$)}}),this._gateway.signal.on(ie.CANDIDATE,e$=>{if(this._p2pChannel instanceof An){let{candidate:t$,direction:r$}=e$;this._p2pChannel.addRemoteCandidate(t$,r$)}}),this._p2pChannel.on(tt.RequestP2PRestartICE,async(e$,t$,r$)=>{try{let{direction:n$}=e$;t$(await this._gateway.sendExtensionMessage(ie.RESTART_ICE,e$,n$===cn.SEND_ONLY))}catch(n$){r$(n$)}}),this._p2pChannel.on(tt.LocalCandidate,e$=>{this._gateway.sendExtensionMessage(ie.CANDIDATE,JSON.stringify(e$),!0)}),this._p2pChannel.on(tt.RequestP2PMuteLocal,async(e$,t$,r$)=>{try{await this._gateway.sendExtensionMessage(ie.CONTROL,e$,!0),t$()}catch(n$){r$(n$)}}),this._p2pChannel.on(tt.RequestP2PUnmuteRemote,async(e$,t$,r$)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e$,this._joinInfo.stringUid||this._joinInfo.uid),t$()}catch(n$){n$.code===R.DISCONNECT_P2P?t$():r$(n$)}else t$()}),this._p2pChannel.on(tt.RequestP2PMuteRemote,async(e$,t$,r$)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e$,this._joinInfo.stringUid||this._joinInfo.uid),t$()}catch(n$){n$.code===R.DISCONNECT_P2P?t$():r$(n$)}else t$()}),this._p2pChannel.on(tt.StateChange,(e$,t$)=>{t$===Rt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(tt.RequestMuteLocal,async(e$,t$,r$)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e$,this._joinInfo.stringUid||this._joinInfo.uid),t$()}catch(n$){n$.code===R.DISCONNECT_P2P?t$():r$(n$)}else t$()}),this._p2pChannel.on(tt.RequestUnmuteLocal,async(e$,t$,r$)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e$,this._joinInfo.stringUid||this._joinInfo.uid),t$()}catch(n$){n$.code===R.DISCONNECT_P2P?t$():r$(n$)}else t$()}),this._p2pChannel.on(tt.RequestRePublish,(e$,t$,r$)=>{this.publish(e$,!1).then(t$).catch(r$)}),this._p2pChannel.on(tt.RequestRePublishDataChannel,(e$,t$,r$)=>{j.all(e$.map(async n$=>{let i$=await this._p2pChannel.publishDataChannel([n$]);try{i$.forEach(o$=>{this._uid&&this._gateway.publishDataChannel(this._uid,o$,!0)})}catch(o$){if(o$.code!==R.DISCONNECT_P2P)throw o$}})).then(t$).catch(r$)}),this._p2pChannel.on(tt.RequestReSubscribe,async(e$,t$,r$)=>{try{for(let{user:n$,kind:i$}of e$)i$===Q.VIDEO?await this.subscribe(n$,"video"):await this.subscribe(n$,"audio");t$()}catch(n$){r$(n$)}}),this._p2pChannel.on(tt.RequestUpload,(e$,t$)=>{this._gateway.upload(e$,t$)}),this._p2pChannel.on(tt.RequestUploadStats,e$=>{this._gateway.uploadWRTCStats(e$)}),this._p2pChannel.on(tt.MediaReconnectStart,e$=>{this.safeEmit(ut.MEDIA_RECONNECT_START,e$)}),this._p2pChannel.on(tt.MediaReconnectEnd,e$=>{this.safeEmit(ut.MEDIA_RECONNECT_END,e$)}),this._p2pChannel.on(tt.NeedSignalRTT,e$=>{e$(this._gateway.getSignalRTT())}),this._p2pChannel.on(tt.RequestRestartICE,async e$=>{if(this._p2pChannel instanceof An)return;let t$=await this._p2pChannel.restartICE(e$),r$=await t$.next();if(r$.done)return;let n$=r$.value,i$;try{i$=await this._gateway.restartICE({iceParameters:n$})}catch(s$){return void t$.throw(s$)}let{iceParameters:o$}=function(s$){let a$=s$.iceParameters;return{iceParameters:{iceUfrag:a$.iceUfrag,icePwd:a$.icePwd}}}(i$);await t$.next({remoteIceParameters:o$})}),this._p2pChannel.on(tt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(tt.RequestReconnectPC,async()=>{var e$;let{iceParameters:t$,dtlsParameters:r$,rtpCapabilities:n$}=await this._p2pChannel.startP2PConnection({turnServer:(e$=this._joinInfo)===null||e$===void 0?void 0:e$.turnServer}),{gatewayEstablishParams:i$,gatewayAddress:o$}=await this._gateway.reconnectPC({iceParameters:t$,dtlsParameters:r$,rtpCapabilities:n$}),s$=qI(i$,o$);await this._p2pChannel.connect(s$),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(tt.RequestUnpublishForReconnectPC,async(e$,t$,r$)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e$,this._uid),t$()):r$()}),this._p2pChannel.on(tt.P2PLost,()=>{this.safeEmit(ut.P2P_LOST,this.store.uid)}),this._p2pChannel.on(tt.UpdateVideoEncoder,e$=>{e$._encoderConfig&&this._gateway.setVideoProfile(e$._encoderConfig)}),this._p2pChannel.on(tt.ConnectionTypeChange,e$=>{this.safeEmit(ut.IS_USING_CLOUD_PROXY,e$)}),this._p2pChannel.on(tt.RequestLowStreamParameter,e$=>{e$(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(tt.QueryClientConnectionState,e$=>{e$(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e$){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let r$=(t$={config:e$},Za("ContentInspect").create(t$));this._inspect=r$,this.handleVideoInspectEvents(r$);let{appId:n$,cname:i$,sid:o$,token:s$,uid:a$,cid:c$,vid:u$}=this._joinInfo;await r$.init({appId:n$,areaCode:"",cname:i$,sid:o$,token:s$,uid:a$,cid:c$,vid:u$?Number(u$):0},Ee)}catch(r$){throw Array.isArray(r$)?r$[0]:r$}var t$}handleVideoInspectEvents(e$){e$.on(we.CONNECTION_STATE_CHANGE,(t$,r$)=>{if(this.safeEmit(ut.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t$,r$),r$===Ei.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(ut.CONTENT_INSPECT_ERROR,new O(R.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e$.inspectImage()}}),e$.on(we.INSPECT_RESULT,(t$,r$)=>{var n$;if((r$==null?void 0:r$.code)===R.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return _.debug("Stop inspect content because that has left channel"),this==null||(n$=this._inspect)===null||n$===void 0||n$.close(),void(this._inspect=void 0);this.safeEmit(ut.CONTENT_INSPECT_RESULT,t$,r$)}),e$.on(we.CLIENT_LOCAL_VIDEO_TRACK,t$=>{t$(this.localTracks.filter(r$=>r$.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e$){throw Array.isArray(e$)?e$[0]:e$}}async setImageModeration(e$,t$){if(Nr(e$,"enabled"),e$){if(!t$)throw new O(R.INVALID_PARAMS,"config is required");if(k0(t$),!this._joinInfo)throw new O(R.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t$);else{let n$=(r$={config:t$},Za("ImageModeration").create(r$));this._moderation=n$,this.handleImageModerationEvents(n$);let{appId:i$,cname:o$,sid:s$,token:a$,uid:c$,cid:u$,vid:l$}=this._joinInfo;await n$.init({appId:i$,areaCode:"",cname:o$,sid:s$,token:a$,uid:c$,cid:u$,vid:l$?Number(l$):0},Ee)}}catch(n$){throw Array.isArray(n$)?n$[0]:n$}}else{var r$;if(!this._moderation)throw new O(R.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(n$){throw Array.isArray(n$)?n$[0]:n$}}}handleImageModerationEvents(e$){e$.on(Mi.CONNECTION_STATE_CHANGE,(t$,r$)=>{if(this.safeEmit(ut.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t$,r$),t$===Xn.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new O(R.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e$.inspectImage()}}),e$.on(Mi.CLIENT_LOCAL_VIDEO_TRACK,t$=>{t$(this.localTracks.filter(r$=>r$.trackMediaType==="video")[0])})}setP2PTransport(e$){if(function(t$){Ce(t$,"transport",["default","auto","relay","sd-rtn"])}(e$),this.mode!=="p2p")throw new O(R.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e$,_.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e$))}getJoinChannelServiceRecords(){return _.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e$){Nr(e$,"enabled"),Ot("ENABLE_PUBLISH_AUDIO_FILTER",e$),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e$)}_handleResetAddStream(e$,t$){switch(t$){case"audio":e$._audio_added_=!1,e$._trust_audio_stream_added_state_=!0;break;case"video":e$._video_added_=!1,e$._trust_video_stream_added_state_=!0}}},q(G.prototype,"leave",[sy],Object.getOwnPropertyDescriptor(G.prototype,"leave"),G.prototype),q(G.prototype,"publish",[ay],Object.getOwnPropertyDescriptor(G.prototype,"publish"),G.prototype),q(G.prototype,"unpublish",[cy],Object.getOwnPropertyDescriptor(G.prototype,"unpublish"),G.prototype),q(G.prototype,"subscribe",[dy],Object.getOwnPropertyDescriptor(G.prototype,"subscribe"),G.prototype),q(G.prototype,"presubscribe",[ly],Object.getOwnPropertyDescriptor(G.prototype,"presubscribe"),G.prototype),q(G.prototype,"massSubscribe",[uy],Object.getOwnPropertyDescriptor(G.prototype,"massSubscribe"),G.prototype),q(G.prototype,"unsubscribe",[hy],Object.getOwnPropertyDescriptor(G.prototype,"unsubscribe"),G.prototype),q(G.prototype,"massUnsubscribe",[py],Object.getOwnPropertyDescriptor(G.prototype,"massUnsubscribe"),G.prototype),q(G.prototype,"setLowStreamParameter",[_y],Object.getOwnPropertyDescriptor(G.prototype,"setLowStreamParameter"),G.prototype),q(G.prototype,"enableDualStream",[Ey],Object.getOwnPropertyDescriptor(G.prototype,"enableDualStream"),G.prototype),q(G.prototype,"disableDualStream",[my],Object.getOwnPropertyDescriptor(G.prototype,"disableDualStream"),G.prototype),q(G.prototype,"setClientRole",[fy],Object.getOwnPropertyDescriptor(G.prototype,"setClientRole"),G.prototype),q(G.prototype,"setProxyServer",[gy],Object.getOwnPropertyDescriptor(G.prototype,"setProxyServer"),G.prototype),q(G.prototype,"setTurnServer",[Ty],Object.getOwnPropertyDescriptor(G.prototype,"setTurnServer"),G.prototype),q(G.prototype,"setLicense",[Sy],Object.getOwnPropertyDescriptor(G.prototype,"setLicense"),G.prototype),q(G.prototype,"startProxyServer",[Ry],Object.getOwnPropertyDescriptor(G.prototype,"startProxyServer"),G.prototype),q(G.prototype,"stopProxyServer",[Cy],Object.getOwnPropertyDescriptor(G.prototype,"stopProxyServer"),G.prototype),q(G.prototype,"setLocalAccessPointsV2",[Iy],Object.getOwnPropertyDescriptor(G.prototype,"setLocalAccessPointsV2"),G.prototype),q(G.prototype,"setLocalAccessPoints",[vy],Object.getOwnPropertyDescriptor(G.prototype,"setLocalAccessPoints"),G.prototype),q(G.prototype,"setRemoteDefaultVideoStreamType",[yy],Object.getOwnPropertyDescriptor(G.prototype,"setRemoteDefaultVideoStreamType"),G.prototype),q(G.prototype,"setRemoteVideoStreamType",[Ay],Object.getOwnPropertyDescriptor(G.prototype,"setRemoteVideoStreamType"),G.prototype),q(G.prototype,"setStreamFallbackOption",[by],Object.getOwnPropertyDescriptor(G.prototype,"setStreamFallbackOption"),G.prototype),q(G.prototype,"setEncryptionConfig",[wy],Object.getOwnPropertyDescriptor(G.prototype,"setEncryptionConfig"),G.prototype),q(G.prototype,"renewToken",[Oy],Object.getOwnPropertyDescriptor(G.prototype,"renewToken"),G.prototype),q(G.prototype,"enableAudioVolumeIndicator",[Ny],Object.getOwnPropertyDescriptor(G.prototype,"enableAudioVolumeIndicator"),G.prototype),q(G.prototype,"startLiveStreaming",[Dy],Object.getOwnPropertyDescriptor(G.prototype,"startLiveStreaming"),G.prototype),q(G.prototype,"setLiveTranscoding",[Py],Object.getOwnPropertyDescriptor(G.prototype,"setLiveTranscoding"),G.prototype),q(G.prototype,"stopLiveStreaming",[ky],Object.getOwnPropertyDescriptor(G.prototype,"stopLiveStreaming"),G.prototype),q(G.prototype,"startChannelMediaRelay",[Ly],Object.getOwnPropertyDescriptor(G.prototype,"startChannelMediaRelay"),G.prototype),q(G.prototype,"updateChannelMediaRelay",[My],Object.getOwnPropertyDescriptor(G.prototype,"updateChannelMediaRelay"),G.prototype),q(G.prototype,"stopChannelMediaRelay",[Uy],Object.getOwnPropertyDescriptor(G.prototype,"stopChannelMediaRelay"),G.prototype),q(G.prototype,"sendCustomReportMessage",[xy],Object.getOwnPropertyDescriptor(G.prototype,"sendCustomReportMessage"),G.prototype),q(G.prototype,"pickSVCLayer",[Vy],Object.getOwnPropertyDescriptor(G.prototype,"pickSVCLayer"),G.prototype),q(G.prototype,"setRTMConfig",[Fy],Object.getOwnPropertyDescriptor(G.prototype,"setRTMConfig"),G.prototype),q(G.prototype,"enableContentInspect",[By],Object.getOwnPropertyDescriptor(G.prototype,"enableContentInspect"),G.prototype),q(G.prototype,"disableContentInspect",[jy],Object.getOwnPropertyDescriptor(G.prototype,"disableContentInspect"),G.prototype),q(G.prototype,"setImageModeration",[Gy],Object.getOwnPropertyDescriptor(G.prototype,"setImageModeration"),G.prototype),q(G.prototype,"setP2PTransport",[Wy],Object.getOwnPropertyDescriptor(G.prototype,"setP2PTransport"),G.prototype),q(G.prototype,"getJoinChannelServiceRecords",[Hy],Object.getOwnPropertyDescriptor(G.prototype,"getJoinChannelServiceRecords"),G.prototype),q(G.prototype,"setPublishAudioFilterEnabled",[Ky],Object.getOwnPropertyDescriptor(G.prototype,"setPublishAudioFilterEnabled"),G.prototype),G),Su=class y5{constructor(t$,r$){T(this,"id",0),T(this,"element",void 0),T(this,"peerPair",void 0),T(this,"context",void 0),T(this,"audioPlayerElement",void 0),T(this,"audioTrack",void 0),y5.count+=1,this.id=y5.count,this.element=t$,this.context=r$}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t$=>{let r$=document.createElement("audio");r$.srcObject=new MediaStream([t$.track]),r$.play(),this.audioPlayerElement=r$}}async switchSdp(){if(!this.peerPair)return;let t$=async(n$,i$)=>{let o$=i$==="offer"?await n$.createOffer():await n$.createAnswer();return await n$.setLocalDescription(o$),n$.iceGatheringState==="complete"?n$.localDescription:new j(s$=>{n$.onicegatheringstatechange=()=>{n$.iceGatheringState==="complete"&&s$(n$.localDescription)}})},r$=async(n$,i$)=>await n$.setRemoteDescription(i$);try{let n$=await t$(this.peerPair[0],"offer");await r$(this.peerPair[1],n$);let i$=await t$(this.peerPair[1],"answer");await r$(this.peerPair[0],i$)}catch(n$){throw new O(R.LOCAL_AEC_ERROR,n$.toString()).print()}}async getTracksFromMediaElement(t$){if(this.audioTrack)return this.audioTrack;let r$;try{t$ instanceof HTMLVideoElement&&(t$.captureStream?t$.captureStream():t$.mozCaptureStream()),r$=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t$).connect(r$)}catch(i$){throw new O(R.LOCAL_AEC_ERROR,i$.toString()).print()}if(!r$)throw new O(R.LOCAL_AEC_ERROR,"no dest node when local aec").print();let n$=r$.stream.getAudioTracks()[0];return this.audioTrack=n$,n$}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let t$=this.element,r$=await this.getTracksFromMediaElement(t$);this.peerPair&&this.peerPair[0].addTrack(r$),await this.switchSdp()}close(){_.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t$=>{t$.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}},qy,Qd;T(Su,"count",0);var LW=window.AudioContext||window.webkitAudioContext,MW=new(qy=$({report:X}),q((Qd=class{constructor(){T(this,"units",[]),T(this,"context",void 0)}processExternalMediaAEC(e$){if(!this._doesEnvironmentNeedAEC())return _.debug("the system does not need to process local aec"),-1;this.context||(this.context=new LW);let t$=this.units.find(r$=>r$&&r$.getElement()===e$);return t$||(t$=new Su(e$,this.context),this.units.push(t$)),t$.startEchoCancellation(),_.debug("start processing local audio echo cancellation, id is",t$.id),t$.id}_doesEnvironmentNeedAEC(){return mt().name!==It.SAFARI}}).prototype,"processExternalMediaAEC",[qy],Object.getOwnPropertyDescriptor(Qd.prototype,"processExternalMediaAEC"),Qd.prototype),Qd);function zy(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function Jy(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?zy(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):zy(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var I_=window||document;function L0(e$){let t$=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!I_)return;let r$=Mt._cspEventHandlerPointer;if(r$&&t$)return void console.error(r$,t$);let n$=i$=>{if(!(i$&&i$.blockedURI&&(Mt.onSecurityPolicyViolation||Mt.getListeners(nr.SECURITY_POLICY_VIOLATION).length>0)))return;let o$=i$.blockedURI;v("CSP_DETECTED_HOSTNAME_LIST").some(s$=>W(o$).call(o$,s$))&&(Mt.onSecurityPolicyViolation&&typeof Mt.onSecurityPolicyViolation=="function"&&Mt.onSecurityPolicyViolation(i$),Mt.getListeners(nr.SECURITY_POLICY_VIOLATION).length>0&&Mt.safeEmit(nr.SECURITY_POLICY_VIOLATION,i$))};r$&&I_.removeEventListener("securitypolicyviolation",r$),(t$||e$&&typeof e$=="function"||Mt.getListeners(nr.SECURITY_POLICY_VIOLATION).length>0)&&I_.addEventListener("securitypolicyviolation",n$),Mt._cspEventHandlerPointer=n$}var UW=hn,xW=nO,Xy=RegExp.prototype,VW=function(e$){return e$===Xy||UW(Xy,e$)?xW(e$):e$.flags},en=ae(VW);function Sa(e$){let t$=e$.length;for(;--t$>=0;)e$[t$]=0}var Pf=256,M0=286,lc=30,uc=15,_m=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Ol=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),FW=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Qy=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wr=new Array(576);Sa(wr);var hc=new Array(60);Sa(hc);var Fc=new Array(512);Sa(Fc);var Bc=new Array(256);Sa(Bc);var kf=new Array(29);Sa(kf);var Ru=new Array(lc);function v_(e$,t$,r$,n$,i$){this.static_tree=e$,this.extra_bits=t$,this.extra_base=r$,this.elems=n$,this.max_length=i$,this.has_stree=e$&&e$.length}var Zy,$y,tA;function y_(e$,t$){this.dyn_tree=e$,this.max_code=0,this.stat_desc=t$}Sa(Ru);var U0=e$=>e$<256?Fc[e$]:Fc[256+(e$>>>7)],jc=(e$,t$)=>{e$.pending_buf[e$.pending++]=255&t$,e$.pending_buf[e$.pending++]=t$>>>8&255},Bn=(e$,t$,r$)=>{e$.bi_valid>16-r$?(e$.bi_buf|=t$<<e$.bi_valid&65535,jc(e$,e$.bi_buf),e$.bi_buf=t$>>16-e$.bi_valid,e$.bi_valid+=r$-16):(e$.bi_buf|=t$<<e$.bi_valid&65535,e$.bi_valid+=r$)},rr=(e$,t$,r$)=>{Bn(e$,r$[2*t$],r$[2*t$+1])},x0=(e$,t$)=>{let r$=0;do r$|=1&e$,e$>>>=1,r$<<=1;while(--t$>0);return r$>>>1},V0=(e$,t$,r$)=>{let n$=new Array(16),i$,o$,s$=0;for(i$=1;i$<=uc;i$++)s$=s$+r$[i$-1]<<1,n$[i$]=s$;for(o$=0;o$<=t$;o$++){let a$=e$[2*o$+1];a$!==0&&(e$[2*o$]=x0(n$[a$]++,a$))}},F0=e$=>{let t$;for(t$=0;t$<M0;t$++)e$.dyn_ltree[2*t$]=0;for(t$=0;t$<lc;t$++)e$.dyn_dtree[2*t$]=0;for(t$=0;t$<19;t$++)e$.bl_tree[2*t$]=0;e$.dyn_ltree[512]=1,e$.opt_len=e$.static_len=0,e$.sym_next=e$.matches=0},B0=e$=>{e$.bi_valid>8?jc(e$,e$.bi_buf):e$.bi_valid>0&&(e$.pending_buf[e$.pending++]=e$.bi_buf),e$.bi_buf=0,e$.bi_valid=0},eA=(e$,t$,r$,n$)=>{let i$=2*t$,o$=2*r$;return e$[i$]<e$[o$]||e$[i$]===e$[o$]&&n$[t$]<=n$[r$]},A_=(e$,t$,r$)=>{let n$=e$.heap[r$],i$=r$<<1;for(;i$<=e$.heap_len&&(i$<e$.heap_len&&eA(t$,e$.heap[i$+1],e$.heap[i$],e$.depth)&&i$++,!eA(t$,n$,e$.heap[i$],e$.depth));)e$.heap[r$]=e$.heap[i$],r$=i$,i$<<=1;e$.heap[r$]=n$},nA=(e$,t$,r$)=>{let n$,i$,o$,s$,a$=0;if(e$.sym_next!==0)do n$=255&e$.pending_buf[e$.sym_buf+a$++],n$+=(255&e$.pending_buf[e$.sym_buf+a$++])<<8,i$=e$.pending_buf[e$.sym_buf+a$++],n$===0?rr(e$,i$,t$):(o$=Bc[i$],rr(e$,o$+Pf+1,t$),s$=_m[o$],s$!==0&&(i$-=kf[o$],Bn(e$,i$,s$)),n$--,o$=U0(n$),rr(e$,o$,r$),s$=Ol[o$],s$!==0&&(n$-=Ru[o$],Bn(e$,n$,s$)));while(a$<e$.sym_next);rr(e$,256,t$)},b_=(e$,t$)=>{let r$=t$.dyn_tree,n$=t$.stat_desc.static_tree,i$=t$.stat_desc.has_stree,o$=t$.stat_desc.elems,s$,a$,c$,u$=-1;for(e$.heap_len=0,e$.heap_max=573,s$=0;s$<o$;s$++)r$[2*s$]!==0?(e$.heap[++e$.heap_len]=u$=s$,e$.depth[s$]=0):r$[2*s$+1]=0;for(;e$.heap_len<2;)c$=e$.heap[++e$.heap_len]=u$<2?++u$:0,r$[2*c$]=1,e$.depth[c$]=0,e$.opt_len--,i$&&(e$.static_len-=n$[2*c$+1]);for(t$.max_code=u$,s$=e$.heap_len>>1;s$>=1;s$--)A_(e$,r$,s$);c$=o$;do s$=e$.heap[1],e$.heap[1]=e$.heap[e$.heap_len--],A_(e$,r$,1),a$=e$.heap[1],e$.heap[--e$.heap_max]=s$,e$.heap[--e$.heap_max]=a$,r$[2*c$]=r$[2*s$]+r$[2*a$],e$.depth[c$]=(e$.depth[s$]>=e$.depth[a$]?e$.depth[s$]:e$.depth[a$])+1,r$[2*s$+1]=r$[2*a$+1]=c$,e$.heap[1]=c$++,A_(e$,r$,1);while(e$.heap_len>=2);e$.heap[--e$.heap_max]=e$.heap[1],((l$,d$)=>{let h$=d$.dyn_tree,p$=d$.max_code,_$=d$.stat_desc.static_tree,f$=d$.stat_desc.has_stree,m$=d$.stat_desc.extra_bits,g$=d$.stat_desc.extra_base,v$=d$.stat_desc.max_length,y$,S$,b$,$$,C$,N$,k$=0;for($$=0;$$<=uc;$$++)l$.bl_count[$$]=0;for(h$[2*l$.heap[l$.heap_max]+1]=0,y$=l$.heap_max+1;y$<573;y$++)S$=l$.heap[y$],$$=h$[2*h$[2*S$+1]+1]+1,$$>v$&&($$=v$,k$++),h$[2*S$+1]=$$,S$>p$||(l$.bl_count[$$]++,C$=0,S$>=g$&&(C$=m$[S$-g$]),N$=h$[2*S$],l$.opt_len+=N$*($$+C$),f$&&(l$.static_len+=N$*(_$[2*S$+1]+C$)));if(k$!==0){do{for($$=v$-1;l$.bl_count[$$]===0;)$$--;l$.bl_count[$$]--,l$.bl_count[$$+1]+=2,l$.bl_count[v$]--,k$-=2}while(k$>0);for($$=v$;$$!==0;$$--)for(S$=l$.bl_count[$$];S$!==0;)b$=l$.heap[--y$],b$>p$||(h$[2*b$+1]!==$$&&(l$.opt_len+=($$-h$[2*b$+1])*h$[2*b$],h$[2*b$+1]=$$),S$--)}})(e$,t$),V0(r$,u$,e$.bl_count)},iA=(e$,t$,r$)=>{let n$,i$,o$=-1,s$=t$[1],a$=0,c$=7,u$=4;for(s$===0&&(c$=138,u$=3),t$[2*(r$+1)+1]=65535,n$=0;n$<=r$;n$++)i$=s$,s$=t$[2*(n$+1)+1],++a$<c$&&i$===s$||(a$<u$?e$.bl_tree[2*i$]+=a$:i$!==0?(i$!==o$&&e$.bl_tree[2*i$]++,e$.bl_tree[32]++):a$<=10?e$.bl_tree[34]++:e$.bl_tree[36]++,a$=0,o$=i$,s$===0?(c$=138,u$=3):i$===s$?(c$=6,u$=3):(c$=7,u$=4))},rA=(e$,t$,r$)=>{let n$,i$,o$=-1,s$=t$[1],a$=0,c$=7,u$=4;for(s$===0&&(c$=138,u$=3),n$=0;n$<=r$;n$++)if(i$=s$,s$=t$[2*(n$+1)+1],!(++a$<c$&&i$===s$)){if(a$<u$)do rr(e$,i$,e$.bl_tree);while(--a$!=0);else i$!==0?(i$!==o$&&(rr(e$,i$,e$.bl_tree),a$--),rr(e$,16,e$.bl_tree),Bn(e$,a$-3,2)):a$<=10?(rr(e$,17,e$.bl_tree),Bn(e$,a$-3,3)):(rr(e$,18,e$.bl_tree),Bn(e$,a$-11,7));a$=0,o$=i$,s$===0?(c$=138,u$=3):i$===s$?(c$=6,u$=3):(c$=7,u$=4)}},oA=!1,j0=(e$,t$,r$,n$)=>{Bn(e$,0+(n$?1:0),3),B0(e$),jc(e$,r$),jc(e$,~r$),r$&&e$.pending_buf.set(e$.window.subarray(t$,t$+r$),e$.pending),e$.pending+=r$},BW=e$=>{oA||((()=>{let t$,r$,n$,i$,o$,s$=new Array(16);for(n$=0,i$=0;i$<28;i$++)for(kf[i$]=n$,t$=0;t$<1<<_m[i$];t$++)Bc[n$++]=i$;for(Bc[n$-1]=i$,o$=0,i$=0;i$<16;i$++)for(Ru[i$]=o$,t$=0;t$<1<<Ol[i$];t$++)Fc[o$++]=i$;for(o$>>=7;i$<lc;i$++)for(Ru[i$]=o$<<7,t$=0;t$<1<<Ol[i$]-7;t$++)Fc[256+o$++]=i$;for(r$=0;r$<=uc;r$++)s$[r$]=0;for(t$=0;t$<=143;)wr[2*t$+1]=8,t$++,s$[8]++;for(;t$<=255;)wr[2*t$+1]=9,t$++,s$[9]++;for(;t$<=279;)wr[2*t$+1]=7,t$++,s$[7]++;for(;t$<=287;)wr[2*t$+1]=8,t$++,s$[8]++;for(V0(wr,287,s$),t$=0;t$<lc;t$++)hc[2*t$+1]=5,hc[2*t$]=x0(t$,5);Zy=new v_(wr,_m,257,M0,uc),$y=new v_(hc,Ol,0,lc,uc),tA=new v_(new Array(0),FW,0,19,7)})(),oA=!0),e$.l_desc=new y_(e$.dyn_ltree,Zy),e$.d_desc=new y_(e$.dyn_dtree,$y),e$.bl_desc=new y_(e$.bl_tree,tA),e$.bi_buf=0,e$.bi_valid=0,F0(e$)},jW=(e$,t$,r$,n$)=>{let i$,o$,s$=0;e$.level>0?(e$.strm.data_type===2&&(e$.strm.data_type=(a$=>{let c$,u$=4093624447;for(c$=0;c$<=31;c$++,u$>>>=1)if(1&u$&&a$.dyn_ltree[2*c$]!==0)return 0;if(a$.dyn_ltree[18]!==0||a$.dyn_ltree[20]!==0||a$.dyn_ltree[26]!==0)return 1;for(c$=32;c$<Pf;c$++)if(a$.dyn_ltree[2*c$]!==0)return 1;return 0})(e$)),b_(e$,e$.l_desc),b_(e$,e$.d_desc),s$=(a$=>{let c$;for(iA(a$,a$.dyn_ltree,a$.l_desc.max_code),iA(a$,a$.dyn_dtree,a$.d_desc.max_code),b_(a$,a$.bl_desc),c$=18;c$>=3&&a$.bl_tree[2*Qy[c$]+1]===0;c$--);return a$.opt_len+=3*(c$+1)+5+5+4,c$})(e$),i$=e$.opt_len+3+7>>>3,o$=e$.static_len+3+7>>>3,o$<=i$&&(i$=o$)):i$=o$=r$+5,r$+4<=i$&&t$!==-1?j0(e$,t$,r$,n$):e$.strategy===4||o$===i$?(Bn(e$,2+(n$?1:0),3),nA(e$,wr,hc)):(Bn(e$,4+(n$?1:0),3),((a$,c$,u$,l$)=>{let d$;for(Bn(a$,c$-257,5),Bn(a$,u$-1,5),Bn(a$,l$-4,4),d$=0;d$<l$;d$++)Bn(a$,a$.bl_tree[2*Qy[d$]+1],3);rA(a$,a$.dyn_ltree,c$-1),rA(a$,a$.dyn_dtree,u$-1)})(e$,e$.l_desc.max_code+1,e$.d_desc.max_code+1,s$+1),nA(e$,e$.dyn_ltree,e$.dyn_dtree)),F0(e$),n$&&B0(e$)},GW=(e$,t$,r$)=>(e$.pending_buf[e$.sym_buf+e$.sym_next++]=t$,e$.pending_buf[e$.sym_buf+e$.sym_next++]=t$>>8,e$.pending_buf[e$.sym_buf+e$.sym_next++]=r$,t$===0?e$.dyn_ltree[2*r$]++:(e$.matches++,t$--,e$.dyn_ltree[2*(Bc[r$]+Pf+1)]++,e$.dyn_dtree[2*U0(t$)]++),e$.sym_next===e$.sym_end),WW=e$=>{Bn(e$,2,3),rr(e$,256,wr),(t$=>{t$.bi_valid===16?(jc(t$,t$.bi_buf),t$.bi_buf=0,t$.bi_valid=0):t$.bi_valid>=8&&(t$.pending_buf[t$.pending++]=255&t$.bi_buf,t$.bi_buf>>=8,t$.bi_valid-=8)})(e$)},HW={_tr_init:BW,_tr_stored_block:j0,_tr_flush_block:jW,_tr_tally:GW,_tr_align:WW},Gc=(e$,t$,r$,n$)=>{let i$=65535&e$|0,o$=e$>>>16&65535|0,s$=0;for(;r$!==0;){s$=r$>2e3?2e3:r$,r$-=s$;do i$=i$+t$[n$++]|0,o$=o$+i$|0;while(--s$);i$%=65521,o$%=65521}return i$|o$<<16|0},KW=new Uint32Array((()=>{let e$,t$=[];for(var r$=0;r$<256;r$++){e$=r$;for(var n$=0;n$<8;n$++)e$=1&e$?3988292384^e$>>>1:e$>>>1;t$[r$]=e$}return t$})()),an=(e$,t$,r$,n$)=>{let i$=KW,o$=n$+r$;e$^=-1;for(let s$=n$;s$<o$;s$++)e$=e$>>>8^i$[255&(e$^t$[s$])];return-1^e$},Zo={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ra={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:YW,_tr_stored_block:Em,_tr_flush_block:qW,_tr_tally:ao,_tr_align:zW}=HW,{Z_NO_FLUSH:co,Z_PARTIAL_FLUSH:JW,Z_FULL_FLUSH:XW,Z_FINISH:Ri,Z_BLOCK:sA,Z_OK:_n,Z_STREAM_END:aA,Z_STREAM_ERROR:dr,Z_DATA_ERROR:QW,Z_BUF_ERROR:w_,Z_DEFAULT_COMPRESSION:ZW,Z_FILTERED:$W,Z_HUFFMAN_ONLY:Zd,Z_RLE:t32,Z_FIXED:e3,Z_DEFAULT_STRATEGY:n3,Z_UNKNOWN:i3,Z_DEFLATED:th}=Ra,mm=286,r3=30,o3=19,s3=2*mm+1,a3=15,jo=258,lr=262,aa=42,Go=113,tc=666,Wo=(e$,t$)=>(e$.msg=Zo[t$],t$),cA=e$=>2*e$-(e$>4?9:0),Qr=e$=>{let t$=e$.length;for(;--t$>=0;)e$[t$]=0},c3=e$=>{let t$,r$,n$,i$=e$.w_size;t$=e$.hash_size,n$=t$;do r$=e$.head[--n$],e$.head[n$]=r$>=i$?r$-i$:0;while(--t$);t$=i$,n$=t$;do r$=e$.prev[--n$],e$.prev[n$]=r$>=i$?r$-i$:0;while(--t$)},lo=(e$,t$,r$)=>(t$<<e$.hash_shift^r$)&e$.hash_mask,Zn=e$=>{let t$=e$.state,r$=t$.pending;r$>e$.avail_out&&(r$=e$.avail_out),r$!==0&&(e$.output.set(t$.pending_buf.subarray(t$.pending_out,t$.pending_out+r$),e$.next_out),e$.next_out+=r$,t$.pending_out+=r$,e$.total_out+=r$,e$.avail_out-=r$,t$.pending-=r$,t$.pending===0&&(t$.pending_out=0))},ti=(e$,t$)=>{qW(e$,e$.block_start>=0?e$.block_start:-1,e$.strstart-e$.block_start,t$),e$.block_start=e$.strstart,Zn(e$.strm)},te=(e$,t$)=>{e$.pending_buf[e$.pending++]=t$},ja=(e$,t$)=>{e$.pending_buf[e$.pending++]=t$>>>8&255,e$.pending_buf[e$.pending++]=255&t$},fm=(e$,t$,r$,n$)=>{let i$=e$.avail_in;return i$>n$&&(i$=n$),i$===0?0:(e$.avail_in-=i$,t$.set(e$.input.subarray(e$.next_in,e$.next_in+i$),r$),e$.state.wrap===1?e$.adler=Gc(e$.adler,t$,i$,r$):e$.state.wrap===2&&(e$.adler=an(e$.adler,t$,i$,r$)),e$.next_in+=i$,e$.total_in+=i$,i$)},G0=(e$,t$)=>{let r$,n$,i$=e$.max_chain_length,o$=e$.strstart,s$=e$.prev_length,a$=e$.nice_match,c$=e$.strstart>e$.w_size-lr?e$.strstart-(e$.w_size-lr):0,u$=e$.window,l$=e$.w_mask,d$=e$.prev,h$=e$.strstart+jo,p$=u$[o$+s$-1],_$=u$[o$+s$];e$.prev_length>=e$.good_match&&(i$>>=2),a$>e$.lookahead&&(a$=e$.lookahead);do if(r$=t$,u$[r$+s$]===_$&&u$[r$+s$-1]===p$&&u$[r$]===u$[o$]&&u$[++r$]===u$[o$+1]){o$+=2,r$++;do;while(u$[++o$]===u$[++r$]&&u$[++o$]===u$[++r$]&&u$[++o$]===u$[++r$]&&u$[++o$]===u$[++r$]&&u$[++o$]===u$[++r$]&&u$[++o$]===u$[++r$]&&u$[++o$]===u$[++r$]&&u$[++o$]===u$[++r$]&&o$<h$);if(n$=jo-(h$-o$),o$=h$-jo,n$>s$){if(e$.match_start=t$,s$=n$,n$>=a$)break;p$=u$[o$+s$-1],_$=u$[o$+s$]}}while((t$=d$[t$&l$])>c$&&--i$!=0);return s$<=e$.lookahead?s$:e$.lookahead},ca=e$=>{let t$=e$.w_size,r$,n$,i$;do{if(n$=e$.window_size-e$.lookahead-e$.strstart,e$.strstart>=t$+(t$-lr)&&(e$.window.set(e$.window.subarray(t$,t$+t$-n$),0),e$.match_start-=t$,e$.strstart-=t$,e$.block_start-=t$,e$.insert>e$.strstart&&(e$.insert=e$.strstart),c3(e$),n$+=t$),e$.strm.avail_in===0)break;if(r$=fm(e$.strm,e$.window,e$.strstart+e$.lookahead,n$),e$.lookahead+=r$,e$.lookahead+e$.insert>=3)for(i$=e$.strstart-e$.insert,e$.ins_h=e$.window[i$],e$.ins_h=lo(e$,e$.ins_h,e$.window[i$+1]);e$.insert&&(e$.ins_h=lo(e$,e$.ins_h,e$.window[i$+3-1]),e$.prev[i$&e$.w_mask]=e$.head[e$.ins_h],e$.head[e$.ins_h]=i$,i$++,e$.insert--,!(e$.lookahead+e$.insert<3)););}while(e$.lookahead<lr&&e$.strm.avail_in!==0)},W0=(e$,t$)=>{let r$,n$,i$,o$=e$.pending_buf_size-5>e$.w_size?e$.w_size:e$.pending_buf_size-5,s$=0,a$=e$.strm.avail_in;do{if(r$=65535,i$=e$.bi_valid+42>>3,e$.strm.avail_out<i$||(i$=e$.strm.avail_out-i$,n$=e$.strstart-e$.block_start,r$>n$+e$.strm.avail_in&&(r$=n$+e$.strm.avail_in),r$>i$&&(r$=i$),r$<o$&&(r$===0&&t$!==Ri||t$===co||r$!==n$+e$.strm.avail_in)))break;s$=t$===Ri&&r$===n$+e$.strm.avail_in?1:0,Em(e$,0,0,s$),e$.pending_buf[e$.pending-4]=r$,e$.pending_buf[e$.pending-3]=r$>>8,e$.pending_buf[e$.pending-2]=~r$,e$.pending_buf[e$.pending-1]=~r$>>8,Zn(e$.strm),n$&&(n$>r$&&(n$=r$),e$.strm.output.set(e$.window.subarray(e$.block_start,e$.block_start+n$),e$.strm.next_out),e$.strm.next_out+=n$,e$.strm.avail_out-=n$,e$.strm.total_out+=n$,e$.block_start+=n$,r$-=n$),r$&&(fm(e$.strm,e$.strm.output,e$.strm.next_out,r$),e$.strm.next_out+=r$,e$.strm.avail_out-=r$,e$.strm.total_out+=r$)}while(s$===0);return a$-=e$.strm.avail_in,a$&&(a$>=e$.w_size?(e$.matches=2,e$.window.set(e$.strm.input.subarray(e$.strm.next_in-e$.w_size,e$.strm.next_in),0),e$.strstart=e$.w_size,e$.insert=e$.strstart):(e$.window_size-e$.strstart<=a$&&(e$.strstart-=e$.w_size,e$.window.set(e$.window.subarray(e$.w_size,e$.w_size+e$.strstart),0),e$.matches<2&&e$.matches++,e$.insert>e$.strstart&&(e$.insert=e$.strstart)),e$.window.set(e$.strm.input.subarray(e$.strm.next_in-a$,e$.strm.next_in),e$.strstart),e$.strstart+=a$,e$.insert+=a$>e$.w_size-e$.insert?e$.w_size-e$.insert:a$),e$.block_start=e$.strstart),e$.high_water<e$.strstart&&(e$.high_water=e$.strstart),s$?4:t$!==co&&t$!==Ri&&e$.strm.avail_in===0&&e$.strstart===e$.block_start?2:(i$=e$.window_size-e$.strstart,e$.strm.avail_in>i$&&e$.block_start>=e$.w_size&&(e$.block_start-=e$.w_size,e$.strstart-=e$.w_size,e$.window.set(e$.window.subarray(e$.w_size,e$.w_size+e$.strstart),0),e$.matches<2&&e$.matches++,i$+=e$.w_size,e$.insert>e$.strstart&&(e$.insert=e$.strstart)),i$>e$.strm.avail_in&&(i$=e$.strm.avail_in),i$&&(fm(e$.strm,e$.window,e$.strstart,i$),e$.strstart+=i$,e$.insert+=i$>e$.w_size-e$.insert?e$.w_size-e$.insert:i$),e$.high_water<e$.strstart&&(e$.high_water=e$.strstart),i$=e$.bi_valid+42>>3,i$=e$.pending_buf_size-i$>65535?65535:e$.pending_buf_size-i$,o$=i$>e$.w_size?e$.w_size:i$,n$=e$.strstart-e$.block_start,(n$>=o$||(n$||t$===Ri)&&t$!==co&&e$.strm.avail_in===0&&n$<=i$)&&(r$=n$>i$?i$:n$,s$=t$===Ri&&e$.strm.avail_in===0&&r$===n$?1:0,Em(e$,e$.block_start,r$,s$),e$.block_start+=r$,Zn(e$.strm)),s$?3:1)},O_=(e$,t$)=>{let r$,n$;for(;;){if(e$.lookahead<lr){if(ca(e$),e$.lookahead<lr&&t$===co)return 1;if(e$.lookahead===0)break}if(r$=0,e$.lookahead>=3&&(e$.ins_h=lo(e$,e$.ins_h,e$.window[e$.strstart+3-1]),r$=e$.prev[e$.strstart&e$.w_mask]=e$.head[e$.ins_h],e$.head[e$.ins_h]=e$.strstart),r$!==0&&e$.strstart-r$<=e$.w_size-lr&&(e$.match_length=G0(e$,r$)),e$.match_length>=3)if(n$=ao(e$,e$.strstart-e$.match_start,e$.match_length-3),e$.lookahead-=e$.match_length,e$.match_length<=e$.max_lazy_match&&e$.lookahead>=3){e$.match_length--;do e$.strstart++,e$.ins_h=lo(e$,e$.ins_h,e$.window[e$.strstart+3-1]),r$=e$.prev[e$.strstart&e$.w_mask]=e$.head[e$.ins_h],e$.head[e$.ins_h]=e$.strstart;while(--e$.match_length!=0);e$.strstart++}else e$.strstart+=e$.match_length,e$.match_length=0,e$.ins_h=e$.window[e$.strstart],e$.ins_h=lo(e$,e$.ins_h,e$.window[e$.strstart+1]);else n$=ao(e$,0,e$.window[e$.strstart]),e$.lookahead--,e$.strstart++;if(n$&&(ti(e$,!1),e$.strm.avail_out===0))return 1}return e$.insert=e$.strstart<2?e$.strstart:2,t$===Ri?(ti(e$,!0),e$.strm.avail_out===0?3:4):e$.sym_next&&(ti(e$,!1),e$.strm.avail_out===0)?1:2},Rs=(e$,t$)=>{let r$,n$,i$;for(;;){if(e$.lookahead<lr){if(ca(e$),e$.lookahead<lr&&t$===co)return 1;if(e$.lookahead===0)break}if(r$=0,e$.lookahead>=3&&(e$.ins_h=lo(e$,e$.ins_h,e$.window[e$.strstart+3-1]),r$=e$.prev[e$.strstart&e$.w_mask]=e$.head[e$.ins_h],e$.head[e$.ins_h]=e$.strstart),e$.prev_length=e$.match_length,e$.prev_match=e$.match_start,e$.match_length=2,r$!==0&&e$.prev_length<e$.max_lazy_match&&e$.strstart-r$<=e$.w_size-lr&&(e$.match_length=G0(e$,r$),e$.match_length<=5&&(e$.strategy===$W||e$.match_length===3&&e$.strstart-e$.match_start>4096)&&(e$.match_length=2)),e$.prev_length>=3&&e$.match_length<=e$.prev_length){i$=e$.strstart+e$.lookahead-3,n$=ao(e$,e$.strstart-1-e$.prev_match,e$.prev_length-3),e$.lookahead-=e$.prev_length-1,e$.prev_length-=2;do++e$.strstart<=i$&&(e$.ins_h=lo(e$,e$.ins_h,e$.window[e$.strstart+3-1]),r$=e$.prev[e$.strstart&e$.w_mask]=e$.head[e$.ins_h],e$.head[e$.ins_h]=e$.strstart);while(--e$.prev_length!=0);if(e$.match_available=0,e$.match_length=2,e$.strstart++,n$&&(ti(e$,!1),e$.strm.avail_out===0))return 1}else if(e$.match_available){if(n$=ao(e$,0,e$.window[e$.strstart-1]),n$&&ti(e$,!1),e$.strstart++,e$.lookahead--,e$.strm.avail_out===0)return 1}else e$.match_available=1,e$.strstart++,e$.lookahead--}return e$.match_available&&(n$=ao(e$,0,e$.window[e$.strstart-1]),e$.match_available=0),e$.insert=e$.strstart<2?e$.strstart:2,t$===Ri?(ti(e$,!0),e$.strm.avail_out===0?3:4):e$.sym_next&&(ti(e$,!1),e$.strm.avail_out===0)?1:2};function $i(e$,t$,r$,n$,i$){this.good_length=e$,this.max_lazy=t$,this.nice_length=r$,this.max_chain=n$,this.func=i$}var ec=[new $i(0,0,0,0,W0),new $i(4,4,8,4,O_),new $i(4,5,16,8,O_),new $i(4,6,32,32,O_),new $i(4,4,16,16,Rs),new $i(8,16,32,32,Rs),new $i(8,16,128,128,Rs),new $i(8,32,128,256,Rs),new $i(32,128,258,1024,Rs),new $i(32,258,258,4096,Rs)];function d3(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=th,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*s3),this.dyn_dtree=new Uint16Array(2*(2*r3+1)),this.bl_tree=new Uint16Array(2*(2*o3+1)),Qr(this.dyn_ltree),Qr(this.dyn_dtree),Qr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(a3+1),this.heap=new Uint16Array(2*mm+1),Qr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*mm+1),Qr(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Wc=e$=>{if(!e$)return 1;let t$=e$.state;return!t$||t$.strm!==e$||t$.status!==aa&&t$.status!==57&&t$.status!==69&&t$.status!==73&&t$.status!==91&&t$.status!==103&&t$.status!==Go&&t$.status!==tc?1:0},H0=e$=>{if(Wc(e$))return Wo(e$,dr);e$.total_in=e$.total_out=0,e$.data_type=i3;let t$=e$.state;return t$.pending=0,t$.pending_out=0,t$.wrap<0&&(t$.wrap=-t$.wrap),t$.status=t$.wrap===2?57:t$.wrap?aa:Go,e$.adler=t$.wrap===2?0:1,t$.last_flush=-2,YW(t$),_n},K0=e$=>{let t$=H0(e$);return t$===_n&&(r$=>{r$.window_size=2*r$.w_size,Qr(r$.head),r$.max_lazy_match=ec[r$.level].max_lazy,r$.good_match=ec[r$.level].good_length,r$.nice_match=ec[r$.level].nice_length,r$.max_chain_length=ec[r$.level].max_chain,r$.strstart=0,r$.block_start=0,r$.lookahead=0,r$.insert=0,r$.match_length=r$.prev_length=2,r$.match_available=0,r$.ins_h=0})(e$.state),t$},dA=(e$,t$,r$,n$,i$,o$)=>{if(!e$)return dr;let s$=1;if(t$===ZW&&(t$=6),n$<0?(s$=0,n$=-n$):n$>15&&(s$=2,n$-=16),i$<1||i$>9||r$!==th||n$<8||n$>15||t$<0||t$>9||o$<0||o$>e3||n$===8&&s$!==1)return Wo(e$,dr);n$===8&&(n$=9);let a$=new d3;return e$.state=a$,a$.strm=e$,a$.status=aa,a$.wrap=s$,a$.gzhead=null,a$.w_bits=n$,a$.w_size=1<<a$.w_bits,a$.w_mask=a$.w_size-1,a$.hash_bits=i$+7,a$.hash_size=1<<a$.hash_bits,a$.hash_mask=a$.hash_size-1,a$.hash_shift=~~((a$.hash_bits+3-1)/3),a$.window=new Uint8Array(2*a$.w_size),a$.head=new Uint16Array(a$.hash_size),a$.prev=new Uint16Array(a$.w_size),a$.lit_bufsize=1<<i$+6,a$.pending_buf_size=4*a$.lit_bufsize,a$.pending_buf=new Uint8Array(a$.pending_buf_size),a$.sym_buf=a$.lit_bufsize,a$.sym_end=3*(a$.lit_bufsize-1),a$.level=t$,a$.strategy=o$,a$.method=r$,K0(e$)},l3=(e$,t$)=>{if(Wc(e$)||t$>sA||t$<0)return e$?Wo(e$,dr):dr;let r$=e$.state;if(!e$.output||e$.avail_in!==0&&!e$.input||r$.status===tc&&t$!==Ri)return Wo(e$,e$.avail_out===0?w_:dr);let n$=r$.last_flush;if(r$.last_flush=t$,r$.pending!==0){if(Zn(e$),e$.avail_out===0)return r$.last_flush=-1,_n}else if(e$.avail_in===0&&cA(t$)<=cA(n$)&&t$!==Ri)return Wo(e$,w_);if(r$.status===tc&&e$.avail_in!==0)return Wo(e$,w_);if(r$.status===aa&&r$.wrap===0&&(r$.status=Go),r$.status===aa){let i$=th+(r$.w_bits-8<<4)<<8,o$=-1;if(o$=r$.strategy>=Zd||r$.level<2?0:r$.level<6?1:r$.level===6?2:3,i$|=o$<<6,r$.strstart!==0&&(i$|=32),i$+=31-i$%31,ja(r$,i$),r$.strstart!==0&&(ja(r$,e$.adler>>>16),ja(r$,65535&e$.adler)),e$.adler=1,r$.status=Go,Zn(e$),r$.pending!==0)return r$.last_flush=-1,_n}if(r$.status===57){if(e$.adler=0,te(r$,31),te(r$,139),te(r$,8),r$.gzhead)te(r$,(r$.gzhead.text?1:0)+(r$.gzhead.hcrc?2:0)+(r$.gzhead.extra?4:0)+(r$.gzhead.name?8:0)+(r$.gzhead.comment?16:0)),te(r$,255&r$.gzhead.time),te(r$,r$.gzhead.time>>8&255),te(r$,r$.gzhead.time>>16&255),te(r$,r$.gzhead.time>>24&255),te(r$,r$.level===9?2:r$.strategy>=Zd||r$.level<2?4:0),te(r$,255&r$.gzhead.os),r$.gzhead.extra&&r$.gzhead.extra.length&&(te(r$,255&r$.gzhead.extra.length),te(r$,r$.gzhead.extra.length>>8&255)),r$.gzhead.hcrc&&(e$.adler=an(e$.adler,r$.pending_buf,r$.pending,0)),r$.gzindex=0,r$.status=69;else if(te(r$,0),te(r$,0),te(r$,0),te(r$,0),te(r$,0),te(r$,r$.level===9?2:r$.strategy>=Zd||r$.level<2?4:0),te(r$,3),r$.status=Go,Zn(e$),r$.pending!==0)return r$.last_flush=-1,_n}if(r$.status===69){if(r$.gzhead.extra){let i$=r$.pending,o$=(65535&r$.gzhead.extra.length)-r$.gzindex;for(;r$.pending+o$>r$.pending_buf_size;){let a$=r$.pending_buf_size-r$.pending;if(r$.pending_buf.set(r$.gzhead.extra.subarray(r$.gzindex,r$.gzindex+a$),r$.pending),r$.pending=r$.pending_buf_size,r$.gzhead.hcrc&&r$.pending>i$&&(e$.adler=an(e$.adler,r$.pending_buf,r$.pending-i$,i$)),r$.gzindex+=a$,Zn(e$),r$.pending!==0)return r$.last_flush=-1,_n;i$=0,o$-=a$}let s$=new Uint8Array(r$.gzhead.extra);r$.pending_buf.set(s$.subarray(r$.gzindex,r$.gzindex+o$),r$.pending),r$.pending+=o$,r$.gzhead.hcrc&&r$.pending>i$&&(e$.adler=an(e$.adler,r$.pending_buf,r$.pending-i$,i$)),r$.gzindex=0}r$.status=73}if(r$.status===73){if(r$.gzhead.name){let i$,o$=r$.pending;do{if(r$.pending===r$.pending_buf_size){if(r$.gzhead.hcrc&&r$.pending>o$&&(e$.adler=an(e$.adler,r$.pending_buf,r$.pending-o$,o$)),Zn(e$),r$.pending!==0)return r$.last_flush=-1,_n;o$=0}i$=r$.gzindex<r$.gzhead.name.length?255&r$.gzhead.name.charCodeAt(r$.gzindex++):0,te(r$,i$)}while(i$!==0);r$.gzhead.hcrc&&r$.pending>o$&&(e$.adler=an(e$.adler,r$.pending_buf,r$.pending-o$,o$)),r$.gzindex=0}r$.status=91}if(r$.status===91){if(r$.gzhead.comment){let i$,o$=r$.pending;do{if(r$.pending===r$.pending_buf_size){if(r$.gzhead.hcrc&&r$.pending>o$&&(e$.adler=an(e$.adler,r$.pending_buf,r$.pending-o$,o$)),Zn(e$),r$.pending!==0)return r$.last_flush=-1,_n;o$=0}i$=r$.gzindex<r$.gzhead.comment.length?255&r$.gzhead.comment.charCodeAt(r$.gzindex++):0,te(r$,i$)}while(i$!==0);r$.gzhead.hcrc&&r$.pending>o$&&(e$.adler=an(e$.adler,r$.pending_buf,r$.pending-o$,o$))}r$.status=103}if(r$.status===103){if(r$.gzhead.hcrc){if(r$.pending+2>r$.pending_buf_size&&(Zn(e$),r$.pending!==0))return r$.last_flush=-1,_n;te(r$,255&e$.adler),te(r$,e$.adler>>8&255),e$.adler=0}if(r$.status=Go,Zn(e$),r$.pending!==0)return r$.last_flush=-1,_n}if(e$.avail_in!==0||r$.lookahead!==0||t$!==co&&r$.status!==tc){let i$=r$.level===0?W0(r$,t$):r$.strategy===Zd?((o$,s$)=>{let a$;for(;;){if(o$.lookahead===0&&(ca(o$),o$.lookahead===0)){if(s$===co)return 1;break}if(o$.match_length=0,a$=ao(o$,0,o$.window[o$.strstart]),o$.lookahead--,o$.strstart++,a$&&(ti(o$,!1),o$.strm.avail_out===0))return 1}return o$.insert=0,s$===Ri?(ti(o$,!0),o$.strm.avail_out===0?3:4):o$.sym_next&&(ti(o$,!1),o$.strm.avail_out===0)?1:2})(r$,t$):r$.strategy===t32?((o$,s$)=>{let a$,c$,u$,l$,d$=o$.window;for(;;){if(o$.lookahead<=jo){if(ca(o$),o$.lookahead<=jo&&s$===co)return 1;if(o$.lookahead===0)break}if(o$.match_length=0,o$.lookahead>=3&&o$.strstart>0&&(u$=o$.strstart-1,c$=d$[u$],c$===d$[++u$]&&c$===d$[++u$]&&c$===d$[++u$])){l$=o$.strstart+jo;do;while(c$===d$[++u$]&&c$===d$[++u$]&&c$===d$[++u$]&&c$===d$[++u$]&&c$===d$[++u$]&&c$===d$[++u$]&&c$===d$[++u$]&&c$===d$[++u$]&&u$<l$);o$.match_length=jo-(l$-u$),o$.match_length>o$.lookahead&&(o$.match_length=o$.lookahead)}if(o$.match_length>=3?(a$=ao(o$,1,o$.match_length-3),o$.lookahead-=o$.match_length,o$.strstart+=o$.match_length,o$.match_length=0):(a$=ao(o$,0,o$.window[o$.strstart]),o$.lookahead--,o$.strstart++),a$&&(ti(o$,!1),o$.strm.avail_out===0))return 1}return o$.insert=0,s$===Ri?(ti(o$,!0),o$.strm.avail_out===0?3:4):o$.sym_next&&(ti(o$,!1),o$.strm.avail_out===0)?1:2})(r$,t$):ec[r$.level].func(r$,t$);if(i$!==3&&i$!==4||(r$.status=tc),i$===1||i$===3)return e$.avail_out===0&&(r$.last_flush=-1),_n;if(i$===2&&(t$===JW?zW(r$):t$!==sA&&(Em(r$,0,0,!1),t$===XW&&(Qr(r$.head),r$.lookahead===0&&(r$.strstart=0,r$.block_start=0,r$.insert=0))),Zn(e$),e$.avail_out===0))return r$.last_flush=-1,_n}return t$!==Ri?_n:r$.wrap<=0?aA:(r$.wrap===2?(te(r$,255&e$.adler),te(r$,e$.adler>>8&255),te(r$,e$.adler>>16&255),te(r$,e$.adler>>24&255),te(r$,255&e$.total_in),te(r$,e$.total_in>>8&255),te(r$,e$.total_in>>16&255),te(r$,e$.total_in>>24&255)):(ja(r$,e$.adler>>>16),ja(r$,65535&e$.adler)),Zn(e$),r$.wrap>0&&(r$.wrap=-r$.wrap),r$.pending!==0?_n:aA)},u3=(e$,t$)=>{let r$=t$.length;if(Wc(e$))return dr;let n$=e$.state,i$=n$.wrap;if(i$===2||i$===1&&n$.status!==aa||n$.lookahead)return dr;if(i$===1&&(e$.adler=Gc(e$.adler,t$,r$,0)),n$.wrap=0,r$>=n$.w_size){i$===0&&(Qr(n$.head),n$.strstart=0,n$.block_start=0,n$.insert=0);let c$=new Uint8Array(n$.w_size);c$.set(t$.subarray(r$-n$.w_size,r$),0),t$=c$,r$=n$.w_size}let o$=e$.avail_in,s$=e$.next_in,a$=e$.input;for(e$.avail_in=r$,e$.next_in=0,e$.input=t$,ca(n$);n$.lookahead>=3;){let c$=n$.strstart,u$=n$.lookahead-2;do n$.ins_h=lo(n$,n$.ins_h,n$.window[c$+3-1]),n$.prev[c$&n$.w_mask]=n$.head[n$.ins_h],n$.head[n$.ins_h]=c$,c$++;while(--u$);n$.strstart=c$,n$.lookahead=2,ca(n$)}return n$.strstart+=n$.lookahead,n$.block_start=n$.strstart,n$.insert=n$.lookahead,n$.lookahead=0,n$.match_length=n$.prev_length=2,n$.match_available=0,e$.next_in=s$,e$.input=a$,e$.avail_in=o$,n$.wrap=i$,_n},pc={deflateInit:(e$,t$)=>dA(e$,t$,th,15,8,n3),deflateInit2:dA,deflateReset:K0,deflateResetKeep:H0,deflateSetHeader:(e$,t$)=>Wc(e$)||e$.state.wrap!==2?dr:(e$.state.gzhead=t$,_n),deflate:l3,deflateEnd:e$=>{if(Wc(e$))return dr;let t$=e$.state.status;return e$.state=null,t$===Go?Wo(e$,QW):_n},deflateSetDictionary:u3,deflateInfo:"pako deflate (from Nodeca project)"},h3=(e$,t$)=>Object.prototype.hasOwnProperty.call(e$,t$),eh={assign:function(e$){let t$=Array.prototype.slice.call(arguments,1);for(;t$.length;){let r$=t$.shift();if(r$){if(typeof r$!="object")throw new TypeError(r$+"must be non-object");for(let n$ in r$)h3(r$,n$)&&(e$[n$]=r$[n$])}}return e$},flattenChunks:e$=>{let t$=0;for(let n$=0,i$=e$.length;n$<i$;n$++)t$+=e$[n$].length;let r$=new Uint8Array(t$);for(let n$=0,i$=0,o$=e$.length;n$<o$;n$++){let s$=e$[n$];r$.set(s$,i$),i$+=s$.length}return r$}},Y0=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Y0=!1}var Hc=new Uint8Array(256);for(let e$=0;e$<256;e$++)Hc[e$]=e$>=252?6:e$>=248?5:e$>=240?4:e$>=224?3:e$>=192?2:1;Hc[254]=Hc[254]=1;var Kc={string2buf:e$=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e$);let t$,r$,n$,i$,o$,s$=e$.length,a$=0;for(i$=0;i$<s$;i$++)r$=e$.charCodeAt(i$),(64512&r$)==55296&&i$+1<s$&&(n$=e$.charCodeAt(i$+1),(64512&n$)==56320&&(r$=65536+(r$-55296<<10)+(n$-56320),i$++)),a$+=r$<128?1:r$<2048?2:r$<65536?3:4;for(t$=new Uint8Array(a$),o$=0,i$=0;o$<a$;i$++)r$=e$.charCodeAt(i$),(64512&r$)==55296&&i$+1<s$&&(n$=e$.charCodeAt(i$+1),(64512&n$)==56320&&(r$=65536+(r$-55296<<10)+(n$-56320),i$++)),r$<128?t$[o$++]=r$:r$<2048?(t$[o$++]=192|r$>>>6,t$[o$++]=128|63&r$):r$<65536?(t$[o$++]=224|r$>>>12,t$[o$++]=128|r$>>>6&63,t$[o$++]=128|63&r$):(t$[o$++]=240|r$>>>18,t$[o$++]=128|r$>>>12&63,t$[o$++]=128|r$>>>6&63,t$[o$++]=128|63&r$);return t$},buf2string:(e$,t$)=>{let r$=t$||e$.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e$.subarray(0,t$));let n$,i$,o$=new Array(2*r$);for(i$=0,n$=0;n$<r$;){let s$=e$[n$++];if(s$<128){o$[i$++]=s$;continue}let a$=Hc[s$];if(a$>4)o$[i$++]=65533,n$+=a$-1;else{for(s$&=a$===2?31:a$===3?15:7;a$>1&&n$<r$;)s$=s$<<6|63&e$[n$++],a$--;a$>1?o$[i$++]=65533:s$<65536?o$[i$++]=s$:(s$-=65536,o$[i$++]=55296|s$>>10&1023,o$[i$++]=56320|1023&s$)}}return((s$,a$)=>{if(a$<65534&&s$.subarray&&Y0)return String.fromCharCode.apply(null,s$.length===a$?s$:s$.subarray(0,a$));let c$="";for(let u$=0;u$<a$;u$++)c$+=String.fromCharCode(s$[u$]);return c$})(o$,i$)},utf8border:(e$,t$)=>{(t$=t$||e$.length)>e$.length&&(t$=e$.length);let r$=t$-1;for(;r$>=0&&(192&e$[r$])==128;)r$--;return r$<0||r$===0?t$:r$+Hc[e$[r$]]>t$?r$:t$}},q0=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},z0=Object.prototype.toString,{Z_NO_FLUSH:p3,Z_SYNC_FLUSH:_3,Z_FULL_FLUSH:E3,Z_FINISH:m3,Z_OK:Cu,Z_STREAM_END:f3,Z_DEFAULT_COMPRESSION:g3,Z_DEFAULT_STRATEGY:T3,Z_DEFLATED:S3}=Ra;function _c(e$){this.options=eh.assign({level:g3,method:S3,chunkSize:16384,windowBits:15,memLevel:8,strategy:T3},e$||{});let t$=this.options;t$.raw&&t$.windowBits>0?t$.windowBits=-t$.windowBits:t$.gzip&&t$.windowBits>0&&t$.windowBits<16&&(t$.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new q0,this.strm.avail_out=0;let r$=pc.deflateInit2(this.strm,t$.level,t$.method,t$.windowBits,t$.memLevel,t$.strategy);if(r$!==Cu)throw new Error(Zo[r$]);if(t$.header&&pc.deflateSetHeader(this.strm,t$.header),t$.dictionary){let n$;if(n$=typeof t$.dictionary=="string"?Kc.string2buf(t$.dictionary):z0.call(t$.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t$.dictionary):t$.dictionary,r$=pc.deflateSetDictionary(this.strm,n$),r$!==Cu)throw new Error(Zo[r$]);this._dict_set=!0}}function N_(e$,t$){let r$=new _c(t$);if(r$.push(e$,!0),r$.err)throw r$.msg||Zo[r$.err];return r$.result}_c.prototype.push=function(e$,t$){let r$=this.strm,n$=this.options.chunkSize,i$,o$;if(this.ended)return!1;for(o$=t$===~~t$?t$:t$===!0?m3:p3,typeof e$=="string"?r$.input=Kc.string2buf(e$):z0.call(e$)==="[object ArrayBuffer]"?r$.input=new Uint8Array(e$):r$.input=e$,r$.next_in=0,r$.avail_in=r$.input.length;;)if(r$.avail_out===0&&(r$.output=new Uint8Array(n$),r$.next_out=0,r$.avail_out=n$),(o$===_3||o$===E3)&&r$.avail_out<=6)this.onData(r$.output.subarray(0,r$.next_out)),r$.avail_out=0;else{if(i$=pc.deflate(r$,o$),i$===f3)return r$.next_out>0&&this.onData(r$.output.subarray(0,r$.next_out)),i$=pc.deflateEnd(this.strm),this.onEnd(i$),this.ended=!0,i$===Cu;if(r$.avail_out!==0){if(o$>0&&r$.next_out>0)this.onData(r$.output.subarray(0,r$.next_out)),r$.avail_out=0;else if(r$.avail_in===0)break}else this.onData(r$.output)}return!0},_c.prototype.onData=function(e$){this.chunks.push(e$)},_c.prototype.onEnd=function(e$){e$===Cu&&(this.result=eh.flattenChunks(this.chunks)),this.chunks=[],this.err=e$,this.msg=this.strm.msg};var R3={Deflate:_c,deflate:N_,deflateRaw:function(e$,t$){return(t$=t$||{}).raw=!0,N_(e$,t$)},gzip:function(e$,t$){return(t$=t$||{}).gzip=!0,N_(e$,t$)},constants:Ra},$d=16209,C3=function(e$,t$){let r$,n$,i$,o$,s$,a$,c$,u$,l$,d$,h$,p$,_$,f$,m$,g$,v$,y$,S$,b$,$$,C$,N$,k$,O$=e$.state;r$=e$.next_in,N$=e$.input,n$=r$+(e$.avail_in-5),i$=e$.next_out,k$=e$.output,o$=i$-(t$-e$.avail_out),s$=i$+(e$.avail_out-257),a$=O$.dmax,c$=O$.wsize,u$=O$.whave,l$=O$.wnext,d$=O$.window,h$=O$.hold,p$=O$.bits,_$=O$.lencode,f$=O$.distcode,m$=(1<<O$.lenbits)-1,g$=(1<<O$.distbits)-1;e:do{p$<15&&(h$+=N$[r$++]<<p$,p$+=8,h$+=N$[r$++]<<p$,p$+=8),v$=_$[h$&m$];t:for(;;){if(y$=v$>>>24,h$>>>=y$,p$-=y$,y$=v$>>>16&255,y$===0)k$[i$++]=65535&v$;else{if(!(16&y$)){if(!(64&y$)){v$=_$[(65535&v$)+(h$&(1<<y$)-1)];continue t}if(32&y$){O$.mode=16191;break e}e$.msg="invalid literal/length code",O$.mode=$d;break e}S$=65535&v$,y$&=15,y$&&(p$<y$&&(h$+=N$[r$++]<<p$,p$+=8),S$+=h$&(1<<y$)-1,h$>>>=y$,p$-=y$),p$<15&&(h$+=N$[r$++]<<p$,p$+=8,h$+=N$[r$++]<<p$,p$+=8),v$=f$[h$&g$];r:for(;;){if(y$=v$>>>24,h$>>>=y$,p$-=y$,y$=v$>>>16&255,!(16&y$)){if(!(64&y$)){v$=f$[(65535&v$)+(h$&(1<<y$)-1)];continue r}e$.msg="invalid distance code",O$.mode=$d;break e}if(b$=65535&v$,y$&=15,p$<y$&&(h$+=N$[r$++]<<p$,p$+=8,p$<y$&&(h$+=N$[r$++]<<p$,p$+=8)),b$+=h$&(1<<y$)-1,b$>a$){e$.msg="invalid distance too far back",O$.mode=$d;break e}if(h$>>>=y$,p$-=y$,y$=i$-o$,b$>y$){if(y$=b$-y$,y$>u$&&O$.sane){e$.msg="invalid distance too far back",O$.mode=$d;break e}if($$=0,C$=d$,l$===0){if($$+=c$-y$,y$<S$){S$-=y$;do k$[i$++]=d$[$$++];while(--y$);$$=i$-b$,C$=k$}}else if(l$<y$){if($$+=c$+l$-y$,y$-=l$,y$<S$){S$-=y$;do k$[i$++]=d$[$$++];while(--y$);if($$=0,l$<S$){y$=l$,S$-=y$;do k$[i$++]=d$[$$++];while(--y$);$$=i$-b$,C$=k$}}}else if($$+=l$-y$,y$<S$){S$-=y$;do k$[i$++]=d$[$$++];while(--y$);$$=i$-b$,C$=k$}for(;S$>2;)k$[i$++]=C$[$$++],k$[i$++]=C$[$$++],k$[i$++]=C$[$$++],S$-=3;S$&&(k$[i$++]=C$[$$++],S$>1&&(k$[i$++]=C$[$$++]))}else{$$=i$-b$;do k$[i$++]=k$[$$++],k$[i$++]=k$[$$++],k$[i$++]=k$[$$++],S$-=3;while(S$>2);S$&&(k$[i$++]=k$[$$++],S$>1&&(k$[i$++]=k$[$$++]))}break}}break}}while(r$<n$&&i$<s$);S$=p$>>3,r$-=S$,p$-=S$<<3,h$&=(1<<p$)-1,e$.next_in=r$,e$.next_out=i$,e$.avail_in=r$<n$?n$-r$+5:5-(r$-n$),e$.avail_out=i$<s$?s$-i$+257:257-(i$-s$),O$.hold=h$,O$.bits=p$},tl=15,I3=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),v3=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),y3=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),A3=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Ec=(e$,t$,r$,n$,i$,o$,s$,a$)=>{let c$=a$.bits,u$,l$,d$,h$,p$,_$,f$=0,m$=0,g$=0,v$=0,y$=0,S$=0,b$=0,$$=0,C$=0,N$=0,k$=null,O$=new Uint16Array(16),U$=new Uint16Array(16),x$,F$,L$,M$=null;for(f$=0;f$<=tl;f$++)O$[f$]=0;for(m$=0;m$<n$;m$++)O$[t$[r$+m$]]++;for(y$=c$,v$=tl;v$>=1&&O$[v$]===0;v$--);if(y$>v$&&(y$=v$),v$===0)return i$[o$++]=20971520,i$[o$++]=20971520,a$.bits=1,0;for(g$=1;g$<v$&&O$[g$]===0;g$++);for(y$<g$&&(y$=g$),$$=1,f$=1;f$<=tl;f$++)if($$<<=1,$$-=O$[f$],$$<0)return-1;if($$>0&&(e$===0||v$!==1))return-1;for(U$[1]=0,f$=1;f$<tl;f$++)U$[f$+1]=U$[f$]+O$[f$];for(m$=0;m$<n$;m$++)t$[r$+m$]!==0&&(s$[U$[t$[r$+m$]]++]=m$);if(e$===0?(k$=M$=s$,_$=20):e$===1?(k$=I3,M$=v3,_$=257):(k$=y3,M$=A3,_$=0),N$=0,m$=0,f$=g$,p$=o$,S$=y$,b$=0,d$=-1,C$=1<<y$,h$=C$-1,e$===1&&C$>852||e$===2&&C$>592)return 1;for(;;){x$=f$-b$,s$[m$]+1<_$?(F$=0,L$=s$[m$]):s$[m$]>=_$?(F$=M$[s$[m$]-_$],L$=k$[s$[m$]-_$]):(F$=96,L$=0),u$=1<<f$-b$,l$=1<<S$,g$=l$;do l$-=u$,i$[p$+(N$>>b$)+l$]=x$<<24|F$<<16|L$|0;while(l$!==0);for(u$=1<<f$-1;N$&u$;)u$>>=1;if(u$!==0?(N$&=u$-1,N$+=u$):N$=0,m$++,--O$[f$]==0){if(f$===v$)break;f$=t$[r$+s$[m$]]}if(f$>y$&&(N$&h$)!==d$){for(b$===0&&(b$=y$),p$+=g$,S$=f$-b$,$$=1<<S$;S$+b$<v$&&($$-=O$[S$+b$],!($$<=0));)S$++,$$<<=1;if(C$+=1<<S$,e$===1&&C$>852||e$===2&&C$>592)return 1;d$=N$&h$,i$[d$]=y$<<24|S$<<16|p$-o$|0}}return N$!==0&&(i$[p$+N$]=f$-b$<<24|64<<16|0),a$.bits=y$,0},{Z_FINISH:lA,Z_BLOCK:b3,Z_TREES:el,Z_OK:Yo,Z_STREAM_END:w3,Z_NEED_DICT:O3,Z_STREAM_ERROR:Ci,Z_DATA_ERROR:J0,Z_MEM_ERROR:X0,Z_BUF_ERROR:N3,Z_DEFLATED:uA}=Ra,nh=16180,Iu=16190,Cr=16191,D_=16192,P_=16194,nl=16199,il=16200,k_=16206,be=16209,hA=e$=>(e$>>>24&255)+(e$>>>8&65280)+((65280&e$)<<8)+((255&e$)<<24);function D3(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var qo=e$=>{if(!e$)return 1;let t$=e$.state;return!t$||t$.strm!==e$||t$.mode<nh||t$.mode>16211?1:0},Q0=e$=>{if(qo(e$))return Ci;let t$=e$.state;return e$.total_in=e$.total_out=t$.total=0,e$.msg="",t$.wrap&&(e$.adler=1&t$.wrap),t$.mode=nh,t$.last=0,t$.havedict=0,t$.flags=-1,t$.dmax=32768,t$.head=null,t$.hold=0,t$.bits=0,t$.lencode=t$.lendyn=new Int32Array(852),t$.distcode=t$.distdyn=new Int32Array(592),t$.sane=1,t$.back=-1,Yo},Z0=e$=>{if(qo(e$))return Ci;let t$=e$.state;return t$.wsize=0,t$.whave=0,t$.wnext=0,Q0(e$)},$0=(e$,t$)=>{let r$;if(qo(e$))return Ci;let n$=e$.state;return t$<0?(r$=0,t$=-t$):(r$=5+(t$>>4),t$<48&&(t$&=15)),t$&&(t$<8||t$>15)?Ci:(n$.window!==null&&n$.wbits!==t$&&(n$.window=null),n$.wrap=r$,n$.wbits=t$,Z0(e$))},pA=(e$,t$)=>{if(!e$)return Ci;let r$=new D3;e$.state=r$,r$.strm=e$,r$.window=null,r$.mode=nh;let n$=$0(e$,t$);return n$!==Yo&&(e$.state=null),n$},L_,M_,_A=!0,P3=e$=>{if(_A){L_=new Int32Array(512),M_=new Int32Array(32);let t$=0;for(;t$<144;)e$.lens[t$++]=8;for(;t$<256;)e$.lens[t$++]=9;for(;t$<280;)e$.lens[t$++]=7;for(;t$<288;)e$.lens[t$++]=8;for(Ec(1,e$.lens,0,288,L_,0,e$.work,{bits:9}),t$=0;t$<32;)e$.lens[t$++]=5;Ec(2,e$.lens,0,32,M_,0,e$.work,{bits:5}),_A=!1}e$.lencode=L_,e$.lenbits=9,e$.distcode=M_,e$.distbits=5},tN=(e$,t$,r$,n$)=>{let i$,o$=e$.state;return o$.window===null&&(o$.wsize=1<<o$.wbits,o$.wnext=0,o$.whave=0,o$.window=new Uint8Array(o$.wsize)),n$>=o$.wsize?(o$.window.set(t$.subarray(r$-o$.wsize,r$),0),o$.wnext=0,o$.whave=o$.wsize):(i$=o$.wsize-o$.wnext,i$>n$&&(i$=n$),o$.window.set(t$.subarray(r$-n$,r$-n$+i$),o$.wnext),(n$-=i$)?(o$.window.set(t$.subarray(r$-n$,r$),0),o$.wnext=n$,o$.whave=o$.wsize):(o$.wnext+=i$,o$.wnext===o$.wsize&&(o$.wnext=0),o$.whave<o$.wsize&&(o$.whave+=i$))),0},k3=(e$,t$)=>{let r$,n$,i$,o$,s$,a$,c$,u$,l$,d$,h$,p$,_$,f$,m$,g$,v$,y$,S$,b$,$$,C$,N$=0,k$=new Uint8Array(4),O$,U$,x$=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(qo(e$)||!e$.output||!e$.input&&e$.avail_in!==0)return Ci;r$=e$.state,r$.mode===Cr&&(r$.mode=D_),s$=e$.next_out,i$=e$.output,c$=e$.avail_out,o$=e$.next_in,n$=e$.input,a$=e$.avail_in,u$=r$.hold,l$=r$.bits,d$=a$,h$=c$,C$=Yo;e:for(;;)switch(r$.mode){case nh:if(r$.wrap===0){r$.mode=D_;break}for(;l$<16;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(2&r$.wrap&&u$===35615){r$.wbits===0&&(r$.wbits=15),r$.check=0,k$[0]=255&u$,k$[1]=u$>>>8&255,r$.check=an(r$.check,k$,2,0),u$=0,l$=0,r$.mode=16181;break}if(r$.head&&(r$.head.done=!1),!(1&r$.wrap)||(((255&u$)<<8)+(u$>>8))%31){e$.msg="incorrect header check",r$.mode=be;break}if((15&u$)!==uA){e$.msg="unknown compression method",r$.mode=be;break}if(u$>>>=4,l$-=4,$$=8+(15&u$),r$.wbits===0&&(r$.wbits=$$),$$>15||$$>r$.wbits){e$.msg="invalid window size",r$.mode=be;break}r$.dmax=1<<r$.wbits,r$.flags=0,e$.adler=r$.check=1,r$.mode=512&u$?16189:Cr,u$=0,l$=0;break;case 16181:for(;l$<16;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(r$.flags=u$,(255&en(r$))!==uA){e$.msg="unknown compression method",r$.mode=be;break}if(57344&en(r$)){e$.msg="unknown header flags set",r$.mode=be;break}r$.head&&(r$.head.text=u$>>8&1),512&en(r$)&&4&r$.wrap&&(k$[0]=255&u$,k$[1]=u$>>>8&255,r$.check=an(r$.check,k$,2,0)),u$=0,l$=0,r$.mode=16182;case 16182:for(;l$<32;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}r$.head&&(r$.head.time=u$),512&en(r$)&&4&r$.wrap&&(k$[0]=255&u$,k$[1]=u$>>>8&255,k$[2]=u$>>>16&255,k$[3]=u$>>>24&255,r$.check=an(r$.check,k$,4,0)),u$=0,l$=0,r$.mode=16183;case 16183:for(;l$<16;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}r$.head&&(r$.head.xflags=255&u$,r$.head.os=u$>>8),512&en(r$)&&4&r$.wrap&&(k$[0]=255&u$,k$[1]=u$>>>8&255,r$.check=an(r$.check,k$,2,0)),u$=0,l$=0,r$.mode=16184;case 16184:if(1024&en(r$)){for(;l$<16;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}r$.length=u$,r$.head&&(r$.head.extra_len=u$),512&en(r$)&&4&r$.wrap&&(k$[0]=255&u$,k$[1]=u$>>>8&255,r$.check=an(r$.check,k$,2,0)),u$=0,l$=0}else r$.head&&(r$.head.extra=null);r$.mode=16185;case 16185:if(1024&en(r$)&&(p$=r$.length,p$>a$&&(p$=a$),p$&&(r$.head&&($$=r$.head.extra_len-r$.length,r$.head.extra||(r$.head.extra=new Uint8Array(r$.head.extra_len)),r$.head.extra.set(n$.subarray(o$,o$+p$),$$)),512&en(r$)&&4&r$.wrap&&(r$.check=an(r$.check,n$,p$,o$)),a$-=p$,o$+=p$,r$.length-=p$),r$.length))break e;r$.length=0,r$.mode=16186;case 16186:if(2048&en(r$)){if(a$===0)break e;p$=0;do $$=n$[o$+p$++],r$.head&&$$&&r$.length<65536&&(r$.head.name+=String.fromCharCode($$));while($$&&p$<a$);if(512&en(r$)&&4&r$.wrap&&(r$.check=an(r$.check,n$,p$,o$)),a$-=p$,o$+=p$,$$)break e}else r$.head&&(r$.head.name=null);r$.length=0,r$.mode=16187;case 16187:if(4096&en(r$)){if(a$===0)break e;p$=0;do $$=n$[o$+p$++],r$.head&&$$&&r$.length<65536&&(r$.head.comment+=String.fromCharCode($$));while($$&&p$<a$);if(512&en(r$)&&4&r$.wrap&&(r$.check=an(r$.check,n$,p$,o$)),a$-=p$,o$+=p$,$$)break e}else r$.head&&(r$.head.comment=null);r$.mode=16188;case 16188:if(512&en(r$)){for(;l$<16;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(4&r$.wrap&&u$!==(65535&r$.check)){e$.msg="header crc mismatch",r$.mode=be;break}u$=0,l$=0}r$.head&&(r$.head.hcrc=en(r$)>>9&1,r$.head.done=!0),e$.adler=r$.check=0,r$.mode=Cr;break;case 16189:for(;l$<32;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}e$.adler=r$.check=hA(u$),u$=0,l$=0,r$.mode=Iu;case Iu:if(r$.havedict===0)return e$.next_out=s$,e$.avail_out=c$,e$.next_in=o$,e$.avail_in=a$,r$.hold=u$,r$.bits=l$,O3;e$.adler=r$.check=1,r$.mode=Cr;case Cr:if(t$===b3||t$===el)break e;case D_:if(r$.last){u$>>>=7&l$,l$-=7&l$,r$.mode=k_;break}for(;l$<3;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}switch(r$.last=1&u$,u$>>>=1,l$-=1,3&u$){case 0:r$.mode=16193;break;case 1:if(P3(r$),r$.mode=nl,t$===el){u$>>>=2,l$-=2;break e}break;case 2:r$.mode=16196;break;case 3:e$.msg="invalid block type",r$.mode=be}u$>>>=2,l$-=2;break;case 16193:for(u$>>>=7&l$,l$-=7&l$;l$<32;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if((65535&u$)!=(u$>>>16^65535)){e$.msg="invalid stored block lengths",r$.mode=be;break}if(r$.length=65535&u$,u$=0,l$=0,r$.mode=P_,t$===el)break e;case P_:r$.mode=16195;case 16195:if(p$=r$.length,p$){if(p$>a$&&(p$=a$),p$>c$&&(p$=c$),p$===0)break e;i$.set(n$.subarray(o$,o$+p$),s$),a$-=p$,o$+=p$,c$-=p$,s$+=p$,r$.length-=p$;break}r$.mode=Cr;break;case 16196:for(;l$<14;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(r$.nlen=257+(31&u$),u$>>>=5,l$-=5,r$.ndist=1+(31&u$),u$>>>=5,l$-=5,r$.ncode=4+(15&u$),u$>>>=4,l$-=4,r$.nlen>286||r$.ndist>30){e$.msg="too many length or distance symbols",r$.mode=be;break}r$.have=0,r$.mode=16197;case 16197:for(;r$.have<r$.ncode;){for(;l$<3;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}r$.lens[x$[r$.have++]]=7&u$,u$>>>=3,l$-=3}for(;r$.have<19;)r$.lens[x$[r$.have++]]=0;if(r$.lencode=r$.lendyn,r$.lenbits=7,O$={bits:r$.lenbits},C$=Ec(0,r$.lens,0,19,r$.lencode,0,r$.work,O$),r$.lenbits=O$.bits,C$){e$.msg="invalid code lengths set",r$.mode=be;break}r$.have=0,r$.mode=16198;case 16198:for(;r$.have<r$.nlen+r$.ndist;){for(;N$=r$.lencode[u$&(1<<r$.lenbits)-1],m$=N$>>>24,g$=N$>>>16&255,v$=65535&N$,!(m$<=l$);){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(v$<16)u$>>>=m$,l$-=m$,r$.lens[r$.have++]=v$;else{if(v$===16){for(U$=m$+2;l$<U$;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(u$>>>=m$,l$-=m$,r$.have===0){e$.msg="invalid bit length repeat",r$.mode=be;break}$$=r$.lens[r$.have-1],p$=3+(3&u$),u$>>>=2,l$-=2}else if(v$===17){for(U$=m$+3;l$<U$;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}u$>>>=m$,l$-=m$,$$=0,p$=3+(7&u$),u$>>>=3,l$-=3}else{for(U$=m$+7;l$<U$;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}u$>>>=m$,l$-=m$,$$=0,p$=11+(127&u$),u$>>>=7,l$-=7}if(r$.have+p$>r$.nlen+r$.ndist){e$.msg="invalid bit length repeat",r$.mode=be;break}for(;p$--;)r$.lens[r$.have++]=$$}}if(r$.mode===be)break;if(r$.lens[256]===0){e$.msg="invalid code -- missing end-of-block",r$.mode=be;break}if(r$.lenbits=9,O$={bits:r$.lenbits},C$=Ec(1,r$.lens,0,r$.nlen,r$.lencode,0,r$.work,O$),r$.lenbits=O$.bits,C$){e$.msg="invalid literal/lengths set",r$.mode=be;break}if(r$.distbits=6,r$.distcode=r$.distdyn,O$={bits:r$.distbits},C$=Ec(2,r$.lens,r$.nlen,r$.ndist,r$.distcode,0,r$.work,O$),r$.distbits=O$.bits,C$){e$.msg="invalid distances set",r$.mode=be;break}if(r$.mode=nl,t$===el)break e;case nl:r$.mode=il;case il:if(a$>=6&&c$>=258){e$.next_out=s$,e$.avail_out=c$,e$.next_in=o$,e$.avail_in=a$,r$.hold=u$,r$.bits=l$,C3(e$,h$),s$=e$.next_out,i$=e$.output,c$=e$.avail_out,o$=e$.next_in,n$=e$.input,a$=e$.avail_in,u$=r$.hold,l$=r$.bits,r$.mode===Cr&&(r$.back=-1);break}for(r$.back=0;N$=r$.lencode[u$&(1<<r$.lenbits)-1],m$=N$>>>24,g$=N$>>>16&255,v$=65535&N$,!(m$<=l$);){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(g$&&!(240&g$)){for(y$=m$,S$=g$,b$=v$;N$=r$.lencode[b$+((u$&(1<<y$+S$)-1)>>y$)],m$=N$>>>24,g$=N$>>>16&255,v$=65535&N$,!(y$+m$<=l$);){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}u$>>>=y$,l$-=y$,r$.back+=y$}if(u$>>>=m$,l$-=m$,r$.back+=m$,r$.length=v$,g$===0){r$.mode=16205;break}if(32&g$){r$.back=-1,r$.mode=Cr;break}if(64&g$){e$.msg="invalid literal/length code",r$.mode=be;break}r$.extra=15&g$,r$.mode=16201;case 16201:if(r$.extra){for(U$=r$.extra;l$<U$;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}r$.length+=u$&(1<<r$.extra)-1,u$>>>=r$.extra,l$-=r$.extra,r$.back+=r$.extra}r$.was=r$.length,r$.mode=16202;case 16202:for(;N$=r$.distcode[u$&(1<<r$.distbits)-1],m$=N$>>>24,g$=N$>>>16&255,v$=65535&N$,!(m$<=l$);){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(!(240&g$)){for(y$=m$,S$=g$,b$=v$;N$=r$.distcode[b$+((u$&(1<<y$+S$)-1)>>y$)],m$=N$>>>24,g$=N$>>>16&255,v$=65535&N$,!(y$+m$<=l$);){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}u$>>>=y$,l$-=y$,r$.back+=y$}if(u$>>>=m$,l$-=m$,r$.back+=m$,64&g$){e$.msg="invalid distance code",r$.mode=be;break}r$.offset=v$,r$.extra=15&g$,r$.mode=16203;case 16203:if(r$.extra){for(U$=r$.extra;l$<U$;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}r$.offset+=u$&(1<<r$.extra)-1,u$>>>=r$.extra,l$-=r$.extra,r$.back+=r$.extra}if(r$.offset>r$.dmax){e$.msg="invalid distance too far back",r$.mode=be;break}r$.mode=16204;case 16204:if(c$===0)break e;if(p$=h$-c$,r$.offset>p$){if(p$=r$.offset-p$,p$>r$.whave&&r$.sane){e$.msg="invalid distance too far back",r$.mode=be;break}p$>r$.wnext?(p$-=r$.wnext,_$=r$.wsize-p$):_$=r$.wnext-p$,p$>r$.length&&(p$=r$.length),f$=r$.window}else f$=i$,_$=s$-r$.offset,p$=r$.length;p$>c$&&(p$=c$),c$-=p$,r$.length-=p$;do i$[s$++]=f$[_$++];while(--p$);r$.length===0&&(r$.mode=il);break;case 16205:if(c$===0)break e;i$[s$++]=r$.length,c$--,r$.mode=il;break;case k_:if(r$.wrap){for(;l$<32;){if(a$===0)break e;a$--,u$|=n$[o$++]<<l$,l$+=8}if(h$-=c$,e$.total_out+=h$,r$.total+=h$,4&r$.wrap&&h$&&(e$.adler=r$.check=en(r$)?an(r$.check,i$,h$,s$-h$):Gc(r$.check,i$,h$,s$-h$)),h$=c$,4&r$.wrap&&(en(r$)?u$:hA(u$))!==r$.check){e$.msg="incorrect data check",r$.mode=be;break}u$=0,l$=0}r$.mode=16207;case 16207:if(r$.wrap&&en(r$)){for(;l$<32;){if(a$===0)break e;a$--,u$+=n$[o$++]<<l$,l$+=8}if(4&r$.wrap&&u$!==(4294967295&r$.total)){e$.msg="incorrect length check",r$.mode=be;break}u$=0,l$=0}r$.mode=16208;case 16208:C$=w3;break e;case be:C$=J0;break e;case 16210:return X0;default:return Ci}return e$.next_out=s$,e$.avail_out=c$,e$.next_in=o$,e$.avail_in=a$,r$.hold=u$,r$.bits=l$,(r$.wsize||h$!==e$.avail_out&&r$.mode<be&&(r$.mode<k_||t$!==lA))&&tN(e$,e$.output,e$.next_out,h$-e$.avail_out),d$-=e$.avail_in,h$-=e$.avail_out,e$.total_in+=d$,e$.total_out+=h$,r$.total+=h$,4&r$.wrap&&h$&&(e$.adler=r$.check=en(r$)?an(r$.check,i$,h$,e$.next_out-h$):Gc(r$.check,i$,h$,e$.next_out-h$)),e$.data_type=r$.bits+(r$.last?64:0)+(r$.mode===Cr?128:0)+(r$.mode===nl||r$.mode===P_?256:0),(d$===0&&h$===0||t$===lA)&&C$===Yo&&(C$=N3),C$},Or={inflateReset:Z0,inflateReset2:$0,inflateResetKeep:Q0,inflateInit:e$=>pA(e$,15),inflateInit2:pA,inflate:k3,inflateEnd:e$=>{if(qo(e$))return Ci;let t$=e$.state;return t$.window&&(t$.window=null),e$.state=null,Yo},inflateGetHeader:(e$,t$)=>{if(qo(e$))return Ci;let r$=e$.state;return 2&r$.wrap?(r$.head=t$,t$.done=!1,Yo):Ci},inflateSetDictionary:(e$,t$)=>{let r$=t$.length,n$,i$,o$;return qo(e$)?Ci:(n$=e$.state,n$.wrap!==0&&n$.mode!==Iu?Ci:n$.mode===Iu&&(i$=1,i$=Gc(i$,t$,r$,0),i$!==n$.check)?J0:(o$=tN(e$,t$,r$,r$),o$?(n$.mode=16210,X0):(n$.havedict=1,Yo)))},inflateInfo:"pako inflate (from Nodeca project)"},L3=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},eN=Object.prototype.toString,{Z_NO_FLUSH:M3,Z_FINISH:U3,Z_OK:mc,Z_STREAM_END:U_,Z_NEED_DICT:x_,Z_STREAM_ERROR:x3,Z_DATA_ERROR:EA,Z_MEM_ERROR:V3}=Ra;function fc(e$){this.options=eh.assign({chunkSize:65536,windowBits:15,to:""},e$||{});let t$=this.options;t$.raw&&t$.windowBits>=0&&t$.windowBits<16&&(t$.windowBits=-t$.windowBits,t$.windowBits===0&&(t$.windowBits=-15)),!(t$.windowBits>=0&&t$.windowBits<16)||e$&&e$.windowBits||(t$.windowBits+=32),t$.windowBits>15&&t$.windowBits<48&&!(15&t$.windowBits)&&(t$.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new q0,this.strm.avail_out=0;let r$=Or.inflateInit2(this.strm,t$.windowBits);if(r$!==mc)throw new Error(Zo[r$]);if(this.header=new L3,Or.inflateGetHeader(this.strm,this.header),t$.dictionary&&(typeof t$.dictionary=="string"?t$.dictionary=Kc.string2buf(t$.dictionary):eN.call(t$.dictionary)==="[object ArrayBuffer]"&&(t$.dictionary=new Uint8Array(t$.dictionary)),t$.raw&&(r$=Or.inflateSetDictionary(this.strm,t$.dictionary),r$!==mc)))throw new Error(Zo[r$])}function V_(e$,t$){let r$=new fc(t$);if(r$.push(e$),r$.err)throw r$.msg||Zo[r$.err];return r$.result}fc.prototype.push=function(e$,t$){let r$=this.strm,n$=this.options.chunkSize,i$=this.options.dictionary,o$,s$,a$;if(this.ended)return!1;for(s$=t$===~~t$?t$:t$===!0?U3:M3,eN.call(e$)==="[object ArrayBuffer]"?r$.input=new Uint8Array(e$):r$.input=e$,r$.next_in=0,r$.avail_in=r$.input.length;;){for(r$.avail_out===0&&(r$.output=new Uint8Array(n$),r$.next_out=0,r$.avail_out=n$),o$=Or.inflate(r$,s$),o$===x_&&i$&&(o$=Or.inflateSetDictionary(r$,i$),o$===mc?o$=Or.inflate(r$,s$):o$===EA&&(o$=x_));r$.avail_in>0&&o$===U_&&r$.state.wrap>0&&e$[r$.next_in]!==0;)Or.inflateReset(r$),o$=Or.inflate(r$,s$);switch(o$){case x3:case EA:case x_:case V3:return this.onEnd(o$),this.ended=!0,!1}if(a$=r$.avail_out,r$.next_out&&(r$.avail_out===0||o$===U_))if(this.options.to==="string"){let c$=Kc.utf8border(r$.output,r$.next_out),u$=r$.next_out-c$,l$=Kc.buf2string(r$.output,c$);r$.next_out=u$,r$.avail_out=n$-u$,u$&&r$.output.set(r$.output.subarray(c$,c$+u$),0),this.onData(l$)}else this.onData(r$.output.length===r$.next_out?r$.output:r$.output.subarray(0,r$.next_out));if(o$!==mc||a$!==0){if(o$===U_)return o$=Or.inflateEnd(this.strm),this.onEnd(o$),this.ended=!0,!0;if(r$.avail_in===0)break}}return!0},fc.prototype.onData=function(e$){this.chunks.push(e$)},fc.prototype.onEnd=function(e$){e$===mc&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=eh.flattenChunks(this.chunks)),this.chunks=[],this.err=e$,this.msg=this.strm.msg};var F3={Inflate:fc,inflate:V_,inflateRaw:function(e$,t$){return(t$=t$||{}).raw=!0,V_(e$,t$)},ungzip:V_,constants:Ra},{Deflate:$H,deflate:B3,deflateRaw:t52,gzip:e5}=R3,{Inflate:n5,inflate:j3,inflateRaw:i5,ungzip:r5}=F3,G3=B3,W3=j3,nN=function(e$){return e$[e$.ONE_BYTE=0]="ONE_BYTE",e$[e$.TWO_BYTE=1]="TWO_BYTE",e$}(nN||{}),gm=class{constructor(){T(this,"_sequence",0),T(this,"_startTime",Date.now()),T(this,"isUseOneByte",!0)}get startTime(){let e$=Date.now()-this._startTime;return e$<Math.pow(2,16)?e$:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e$){let t$={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e$};if(e$.byteLength>128){let s$=new Uint8Array(4);s$.set([1,0,0,0]);let a$={id:0,length:4,data:s$.buffer},c$={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[a$]};t$.commonPacketHeader.extension=1,t$.extension=c$,t$.payload=this.compress(e$),t$.commonPacketHeader.length=8+(t$.extension.length+2)+t$.payload.byteLength}else t$.commonPacketHeader.length=8+t$.payload.byteLength;v("SHOW_DATASTREAM2_LOG")&&_.debug("send data header: ".concat(JSON.stringify(t$.commonPacketHeader)));let r$=new ArrayBuffer(t$.commonPacketHeader.length),n$=new Uint8Array(r$),i$=new DataView(r$),o$=0;if(i$.setUint16(o$,t$.commonPacketHeader.extension<<15|t$.commonPacketHeader.reserved<<14|t$.commonPacketHeader.length,!0),o$+=2,i$.setUint32(o$,t$.commonPacketHeader.sequence,!0),o$+=4,i$.setUint16(o$,t$.commonStreamHeader,!0),o$+=2,t$.extension){let s$=this.serializeExtension(t$.extension);n$.set(new Uint8Array(s$),o$),o$+=s$.byteLength}if(n$.set(new Uint8Array(t$.payload),o$),o$+=t$.payload.byteLength,o$!==t$.commonPacketHeader.length)throw Error("serialize error!");return r$}deserialize(e$){if(e$.byteLength<4)return new ArrayBuffer(0);let t$=new DataView(e$),r$=0,n$=t$.getUint16(r$,!0);r$+=2;let i$={length:16383&n$,reserved:(16384&n$)>>14,extension:(32768&n$)>>15,sequence:t$.getUint16(r$+2,!0)<<16|t$.getUint16(r$,!0)},o$,s$;if(r$+=4,v("SHOW_DATASTREAM2_LOG")&&_.debug("receive data header: ".concat(JSON.stringify(i$))),t$.getUint16(r$,!0),r$+=2,i$.extension){s$=this.deserializeExtension(e$.slice(r$)),r$+=2+s$.length,o$=e$.slice(r$);let a$=!1;if(s$.datas.length>0){let c$=s$.datas.find(u$=>u$.id===0);c$&&(a$=(1&new DataView(c$.data).getUint32(0,!0))==1)}o$=a$?this.decompress(o$):o$}else o$=e$.slice(8);return o$}serializeExtension(e$){let{profile:t$,length:r$,datas:n$}=e$,i$=new ArrayBuffer(r$+2),o$=new Uint8Array(i$),s$=new DataView(i$),a$=0;if(s$.setUint8(a$++,t$),s$.setUint8(a$++,r$),n$.forEach(c$=>{t$?(s$.setUint8(a$++,c$.id),s$.setUint8(a$++,c$.length),o$.set(new Uint8Array(c$.data),a$),a$+=c$.data.byteLength):(s$.setUint8(a$++,c$.id|c$.length<<4),o$.set(new Uint8Array(c$.data),a$),a$+=c$.data.byteLength)}),a$!==r$+2)throw Error("serialize extension error, is ".concat(a$,"!==").concat(r$+2));return i$}deserializeExtension(e$){let t$=new DataView(e$),r$=0,n$=t$.getUint8(r$);r$++;let i$=t$.getUint8(r$);r$++;let o$=n$===nN.TWO_BYTE,s$=[],a$=new DataView(e$,2),c$=0;for(;c$<i$;){let u$=0,l$=0,d$=new ArrayBuffer(0);o$?(u$=a$.getUint8(c$),c$++,l$=a$.getUint8(c$),c$++):(u$=15&a$.getUint8(c$),l$=a$.getUint8(c$)>>4,c$++),l$>0&&(d$=a$.buffer.slice(c$+2,c$+2+l$),c$+=d$.byteLength),s$.push({id:u$,length:l$,data:d$})}if(c$!==i$)throw Error("parse error");return{profile:n$,length:i$,datas:s$}}decompress(e$){return W3(new Uint8Array(e$))}compress(e$){return G3(new Uint8Array(e$))}},H3={name:"DataStream",create:(e$,t$)=>{let r$=t$?new QE(e$):new ZE(e$);return r$.useDataStream(new gm),r$}},Tm=class extends Xt{constructor(e$,t$,r$){super(),T(this,"ws",void 0),T(this,"requestId",1),T(this,"heartBeatTimer",void 0),T(this,"joinInfo",void 0),T(this,"clientId",void 0),T(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),T(this,"onClose",n$=>{this.emit("close"),this.dispose()}),T(this,"onMessage",n$=>{let i$=JSON.parse(n$.data);if(!i$||i$.command!=="serverResponse"||!i$.requestId)return i$&&i$.command==="serverStatus"&&i$.serverStatus&&i$.serverStatus.command?(this.emit("status",i$.serverStatus),void this.emit(i$.serverStatus.command,i$.serverStatus)):void 0;this.emit("req_".concat(i$.requestId),i$)}),this.joinInfo=e$,this.clientId=t$,this.ws=new Qo("cross-channel-".concat(this.clientId),r$),this.ws.on(it.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(it.CONNECTED,this.onOpen),this.ws.on(it.ON_MESSAGE,this.onMessage),this.ws.on(it.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e$){let t$=this.requestId++;return e$.requestId=t$,e$.seq=t$,this.ws.sendMessage(e$),t$}waitStatus(e$){return new j((t$,r$)=>{let n$=window.setTimeout(()=>{r$(new O(R.TIMEOUT,"wait status timeout, status: ".concat(e$)))},5e3);this.once(e$,i$=>{window.clearTimeout(n$),i$.state&&i$.state!==0?r$(new O(R.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e$))):t$(void 0)}),this.once("dispose",()=>{window.clearTimeout(n$),r$(new O(R.WS_ABORT))})})}async request(e$){if(this.ws.state==="closed")throw new O(R.WS_DISCONNECT);let t$=()=>new j((o$,s$)=>{this.ws.once(it.CLOSED,()=>s$(new O(R.WS_ABORT))),this.ws.once(it.CONNECTED,o$)});this.ws.state!=="connected"&&await t$();let r$=this.sendMessage(e$),n$=new j((o$,s$)=>{let a$=()=>{s$(new O(R.WS_ABORT))};this.ws.once(it.RECONNECTING,a$),this.ws.once(it.CLOSED,a$),this.once("req_".concat(r$),o$),Me(3e3).then(()=>{this.removeAllListeners("req_".concat(r$)),this.ws.off(it.RECONNECTING,a$),this.ws.off(it.CLOSED,a$),s$(new O(R.TIMEOUT,"cross channel ws request timeout"))})}),i$=await n$;if(!i$||i$.code!==200)throw new O(R.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(i$)));return i$}async connect(e$){this.ws.removeAllListeners(it.REQUEST_NEW_URLS),this.ws.on(it.REQUEST_NEW_URLS,t$=>{t$(e$)}),await this.ws.init(e$)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e$){let t$=this.requestId++;return e$.requestId=t$,this.ws.sendMessage(e$),t$}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}},Sm=class extends Xt{set state(e$){e$!==this._state&&(e$!==Sn.RELAY_STATE_FAILURE&&(this.errorCode=ys.RELAY_OK),this.emit("state",e$,this.errorCode),this._state=e$)}get state(){return this._state}constructor(e$,t$,r$,n$,i$){super(),T(this,"joinInfo",void 0),T(this,"sid",void 0),T(this,"clientId",void 0),T(this,"cancelToken",mn.CancelToken.source()),T(this,"workerToken",void 0),T(this,"requestId",0),T(this,"signal",void 0),T(this,"prevChannelMediaConfig",void 0),T(this,"httpRetryConfig",void 0),T(this,"_resolution",void 0),T(this,"_state",Sn.RELAY_STATE_IDLE),T(this,"errorCode",ys.RELAY_OK),T(this,"onStatus",o$=>{_.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(o$))),o$&&o$.command&&(o$.command==="onAudioPacketReceived"&&this.emit("event",Ir.PACKET_RECEIVED_AUDIO_FROM_SRC),o$.command==="onVideoPacketReceived"&&this.emit("event",Ir.PACKET_RECEIVED_VIDEO_FROM_SRC),o$.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=ys.SRC_TOKEN_EXPIRED,this.state=Sn.RELAY_STATE_FAILURE),o$.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=ys.DEST_TOKEN_EXPIRED,this.state=Sn.RELAY_STATE_FAILURE))}),T(this,"onReconnect",async()=>{_.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Ir.NETWORK_DISCONNECTED),this.state=Sn.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(o$=>{this.state!==Sn.RELAY_STATE_IDLE&&(_.error("auto restart channel media relay failed",o$.toString()),this.errorCode=ys.SERVER_CONNECTION_LOST,this.state=Sn.RELAY_STATE_FAILURE)})}),this.joinInfo=e$,this.clientId=t$,this.sid=Ms(),this.signal=new Tm(this.joinInfo,this.clientId,r$),this.httpRetryConfig=n$,this._resolution=i$}async startChannelMediaRelay(e$){if(this.state!==Sn.RELAY_STATE_IDLE)throw new O(R.INVALID_OPERATION);this.state=Sn.RELAY_STATE_CONNECTING,await this.connect(),_.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e$)}catch(t$){throw t$.data&&t$.data.serverResponse&&t$.data.serverResponse.command==="SetSourceChannel"?new O(R.CROSS_CHANNEL_FAILED_JOIN_SRC):t$.data&&t$.data.serverResponse&&t$.serverResponse.command==="SetDestChannelStatus"?new O(R.CROSS_CHANNEL_FAILED_JOIN_DEST):t$.data&&t$.data.serverResponse&&t$.serverResponse.command==="StartPacketTransfer"?new O(R.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):t$}this.prevChannelMediaConfig=e$}async updateChannelMediaRelay(e$){if(this.state!==Sn.RELAY_STATE_RUNNING)throw new O(R.INVALID_OPERATION);await this.sendUpdateMessage(e$),this.prevChannelMediaConfig=e$}async setVideoProfile(e$){if(this._resolution=e$,this.state!==Sn.RELAY_STATE_RUNNING)throw new O(R.INVALID_OPERATION);let t$=this.genMessage(sn.SetVideoProfile);await this.signal.request(t$),_.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),_.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Sn.RELAY_STATE_IDLE,this.dispose()}dispose(){_.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=mn.CancelToken.source(),this.state=Sn.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let e$=await zG(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e$.workerToken,await this.signal.connect(e$.addressList),this.emit("event",Ir.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e$){let t$=this.genMessage(sn.StopPacketTransfer);await this.signal.request(t$),await this.signal.waitStatus("Normal Quit"),_.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let r$=this.genMessage(sn.SetSdkProfile,e$);await this.signal.request(r$),_.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let n$=this.genMessage(sn.SetSourceChannel,e$);await this.signal.request(n$),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Ir.PACKET_JOINED_SRC_CHANNEL),_.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let i$=this.genMessage(sn.SetSourceUserId,e$);await this.signal.request(i$),_.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let o$=this.genMessage(sn.SetDestChannel,e$);await this.signal.request(o$),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Ir.PACKET_JOINED_DEST_CHANNEL),_.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let s$=this.genMessage(sn.StartPacketTransfer,e$);await this.signal.request(s$),this.emit("event",Ir.PACKET_SENT_TO_DEST_CHANNEL),this.state=Sn.RELAY_STATE_RUNNING,_.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e$){let t$=this.genMessage(sn.UpdateDestChannel,e$);await this.signal.request(t$),this.emit("event",Ir.PACKET_UPDATE_DEST_CHANNEL),_.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let e$=this.genMessage(sn.StopPacketTransfer);await this.signal.request(e$),_.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e$,t$){let r$=[],n$=[],i$=[];this.requestId+=1;let o$={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:ii,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};o$.sdkVersion==="4.22.0"&&(o$.sdkVersion="0.0.1");let s$=null,a$=null;switch(e$){case sn.SetSdkProfile:return o$.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o$;case sn.SetSourceChannel:if(a$=t$&&t$.getSrcChannelMediaInfo(),!a$)throw new O(R.UNEXPECTED_ERROR,"can not find source config");return o$.clientRequest={command:"SetSourceChannel",uid:"0",channelName:a$.channelName,token:a$.token||this.joinInfo.appId},o$;case sn.SetSourceUserId:if(a$=t$&&t$.getSrcChannelMediaInfo(),!a$)throw new O(R.UNEXPECTED_ERROR,"can not find source config");return o$.clientRequest={command:"SetSourceUserId",uid:a$.uid+""},o$;case sn.SetDestChannel:if(s$=t$&&t$.getDestChannelMediaInfo(),!s$)throw new O(R.UNEXPECTED_ERROR,"can not find dest config");return s$.forEach(c$=>{r$.push(c$.channelName),n$.push(c$.uid+""),i$.push(c$.token||this.joinInfo.appId)}),o$.clientRequest={command:"SetDestChannel",channelName:r$,uid:n$,token:i$},o$;case sn.StartPacketTransfer:return o$.clientRequest={command:"StartPacketTransfer"},o$;case sn.Reconnect:return o$.clientRequest={command:"Reconnect"},o$;case sn.StopPacketTransfer:return o$.clientRequest={command:"StopPacketTransfer"},o$;case sn.UpdateDestChannel:if(s$=t$&&t$.getDestChannelMediaInfo(),!s$)throw new O(R.UNEXPECTED_ERROR,"can not find dest config");return s$.forEach(c$=>{r$.push(c$.channelName),n$.push(c$.uid+""),i$.push(c$.token||this.joinInfo.appId)}),o$.clientRequest={command:"UpdateDestChannel",channelName:r$,uid:n$,token:i$},o$;case sn.SetVideoProfile:o$.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o$}},K3={name:"ChannelMediaRelay",create:function(e$){return new Sm(e$.joinInfo,e$.clientId,e$.websocketRetryConfig||Ee,e$.httpRetryConfig||Ee,e$.resolution)}};function mA(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function Ga(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?mA(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):mA(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var Rm=class extends Xt{constructor(e$,t$,r$,n$){super(),T(this,"spec",void 0),T(this,"token",void 0),T(this,"websocket",void 0),T(this,"pingpongTimer",void 0),T(this,"reconnectMode","retry"),T(this,"serviceMode",void 0),T(this,"reqId",0),T(this,"commandReqId",0),T(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),T(this,"handleWebSocketMessage",i$=>{if(!i$.data)return;let o$=JSON.parse(i$.data);o$.requestId?this.emit("@".concat(o$.requestId,"-").concat(o$.sid),o$):(X.workerEvent(this.spec.sid,{actionType:"status",serverCode:o$.code,workerType:this.serviceMode===er.TRANSCODE?1:2}),this.emit(Xr.PUBLISH_STREAM_STATUS,o$))}),this.spec=t$,this.token=e$,this.serviceMode=n$,this.websocket=new Qo("live-streaming",r$),this.websocket.on(it.CONNECTED,this.handleWebSocketOpen),this.websocket.on(it.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(it.REQUEST_NEW_URLS,(i$,o$)=>{Ge(this,Xr.REQUEST_NEW_ADDRESS).then(i$).catch(o$)}),this.websocket.on(it.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e$){return this.websocket.init(e$)}async request(e$,t$,r$,n$){this.reqId+=1,e$==="request"&&(this.commandReqId+=1);let i$=this.commandReqId,o$=this.reqId;if(!o$||!this.websocket)throw new O(R.UNEXPECTED_ERROR);let s$=Ga({command:e$,sdkVersion:ii==="4.22.0"?"0.0.1":ii,seq:o$,requestId:o$,allocate:r$,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t$);if(this.websocket.state==="closed")throw new O(R.WS_DISCONNECT);let a$=()=>new j((d$,h$)=>{this.websocket.once(it.CLOSED,()=>h$(new O(R.WS_ABORT))),this.websocket.once(it.CONNECTED,d$)});this.websocket.state!=="connected"&&await a$(),s$.clientRequest&&(s$.clientRequest.workerToken=this.token);let c$=new j((d$,h$)=>{let p$=()=>{h$(new O(R.WS_ABORT))};this.websocket.once(it.RECONNECTING,p$),this.websocket.once(it.CLOSED,p$),this.once("@".concat(o$,"-").concat(this.spec.sid),_$=>{d$(_$)})});n$&&X.workerEvent(this.spec.sid,Ga(Ga({},n$),{},{requestId:i$,actionType:"request",payload:JSON.stringify(t$.clientRequest),serverCode:0,code:0}));let u$=Date.now();this.websocket.sendMessage(s$);let l$=null;try{l$=await c$}catch(d$){if(this.websocket.state==="closed")throw d$;return await a$(),await this.request(e$,t$,r$)}return n$&&X.workerEvent(this.spec.sid,Ga(Ga({},n$),{},{requestId:i$,actionType:"response",payload:JSON.stringify(l$.serverResponse),serverCode:l$.code,success:l$.code===200,responseTime:Date.now()-u$})),l$.code!==200&&this.handleResponseError(l$),l$}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let e$=ii==="4.22.0"?"0.0.1":ii;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e$,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e$){switch(e$.code){case fe.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void _.warning("live stream response already exists stream");case fe.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case fe.LIVE_STREAM_RESPONSE_BAD_STREAM:case fe.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new O(R.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e$.code}).throw();case fe.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e$.serverResponse.command==="UnpublishStream")return;throw new O(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case fe.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new O(R.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e$.code}).throw();case fe.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let t$=new O(R.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Xr.WARNING,t$,e$.serverResponse.url)}case fe.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let t$=new O(R.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Xr.WARNING,t$,e$.serverResponse.url)}case fe.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new O(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case fe.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new O(R.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e$.code}).throw();case fe.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let t$=new O(R.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Xr.WARNING,t$,e$.serverResponse.url)}case fe.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new O(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e$.code}).throw();case fe.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new O(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case fe.LIVE_STREAM_RESPONSE_WORKER_LOST:case fe.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e$.serverResponse.command==="UnpublishStream")return;throw new O(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case fe.ERROR_FAIL_SEND_MESSAGE:if(e$.serverResponse.command==="UnpublishStream")return;if(e$.serverResponse.command==="UpdateTranscoding"||e$.serverResponse.command==="ControlStream")return new O(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e$.code}).throw();throw new O(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case fe.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case fe.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case fe.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case fe.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new O(R.LIVE_STREAMING_CDN_ERROR,"",{code:e$.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(zu)},6e3)}};function fA(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}function Tn(e$){for(var t$=1;t$<arguments.length;t$++){var r$=arguments[t$]!=null?arguments[t$]:{};t$%2?fA(Object(r$),!0).forEach(function(n$){T(e$,n$,r$[n$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e$,Object.getOwnPropertyDescriptors(r$)):fA(Object(r$)).forEach(function(n$){Object.defineProperty(e$,n$,Object.getOwnPropertyDescriptor(r$,n$))})}return e$}var Cm=class extends Xt{constructor(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ee,r$=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ee;super(),T(this,"onLiveStreamWarning",void 0),T(this,"onLiveStreamError",void 0),T(this,"spec",void 0),T(this,"retryTimeout",1e4),T(this,"connection",void 0),T(this,"httpRetryConfig",void 0),T(this,"wsRetryConfig",void 0),T(this,"streamingTasks",new Map),T(this,"isStartingStreamingTask",!1),T(this,"taskMutex",new ze("live-streaming")),T(this,"cancelToken",mn.CancelToken.source()),T(this,"transcodingConfig",void 0),T(this,"uapResponse",void 0),T(this,"lastTaskId",1),T(this,"statusError",new Map),this.spec=e$,this.httpRetryConfig=r$,this.wsRetryConfig=t$}async setTranscodingConfig(e$){let t$=Tn(Tn({},aj),e$);t$.videoCodecProfile!==66&&t$.videoCodecProfile!==77&&t$.videoCodecProfile!==100&&(_.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t$.videoCodecProfile," -> 100")),t$.videoCodecProfile=100),t$.transcodingUsers||(t$.transcodingUsers=t$.userConfigs),t$.transcodingUsers&&(t$.transcodingUsers=t$.transcodingUsers.map(o$=>Tn(Tn(Tn({},sj),o$),{},{zOrder:o$.zOrder?o$.zOrder+1:1}))),function(o$){zt(o$.width)||Nt(o$.width,"config.width",0,1e4),zt(o$.height)||Nt(o$.height,"config.height",0,1e4),zt(o$.videoBitrate)||Nt(o$.videoBitrate,"config.videoBitrate",1,1e6),zt(o$.videoFrameRate)||Nt(o$.videoFrameRate,"config.videoFrameRate"),zt(o$.lowLatency)||Nr(o$.lowLatency,"config.lowLatency"),zt(o$.audioSampleRate)||Ce(o$.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),zt(o$.audioBitrate)||Nt(o$.audioBitrate,"config.audioBitrate",1,128),zt(o$.audioChannels)||Ce(o$.audioChannels,"config.audioChannels",[1,2,3,4,5]),zt(o$.videoGop)||Nt(o$.videoGop,"config.videoGop"),zt(o$.videoCodecProfile)||Ce(o$.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),zt(o$.userCount)||Nt(o$.userCount,"config.userCount",0,17),zt(o$.backgroundColor)||Nt(o$.backgroundColor,"config.backgroundColor",0,16777215),zt(o$.userConfigExtraInfo)||Pe(o$.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),o$.transcodingUsers&&!zt(o$.transcodingUsers)&&(br(o$.transcodingUsers,"config.transcodingUsers"),o$.transcodingUsers.forEach((s$,a$)=>{Qu(s$.uid),zt(s$.x)||Nt(s$.x,"transcodingUser[".concat(a$,"].x"),0,1e4),zt(s$.y)||Nt(s$.y,"transcodingUser[".concat(a$,"].y"),0,1e4),zt(s$.width)||Nt(s$.width,"transcodingUser[".concat(a$,"].width"),0,1e4),zt(s$.height)||Nt(s$.height,"transcodingUser[".concat(a$,"].height"),0,1e4),zt(s$.zOrder)||Nt(s$.zOrder-1,"transcodingUser[".concat(a$,"].zOrder"),0,100),zt(s$.alpha)||Nt(s$.alpha,"transcodingUser[".concat(a$,"].alpha"),0,1,!1)})),zt(o$.watermark)||xp(o$.watermark,"watermark"),zt(o$.backgroundImage)||xp(o$.backgroundImage,"backgroundImage"),o$.images&&!zt(o$.images)&&(br(o$.images,"config.images"),o$.images.forEach((s$,a$)=>{xp(s$,"images[".concat(a$,"]"))}))}(t$);let r$=[];t$.images&&r$.push(...t$.images.map(o$=>Tn(Tn(Tn({},Up),o$),{},{zOrder:255}))),t$.backgroundImage&&(r$.push(Tn(Tn(Tn({},Up),t$.backgroundImage),{},{zOrder:0})),delete t$.backgroundImage),t$.watermark&&(r$.push(Tn(Tn(Tn({},Up),t$.watermark),{},{zOrder:255})),delete t$.watermark),t$.images=r$,t$.transcodingUsers&&(t$.userConfigs=t$.transcodingUsers.map(o$=>Tn({},o$)),t$.userCount=t$.transcodingUsers.length,delete t$.transcodingUsers);let n$=(t$.userConfigs||[]).map(o$=>typeof o$.uid=="number"?j.resolve(o$.uid):h0(o$.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await j.all(n$)).forEach((o$,s$)=>{t$.userConfigs&&t$.userConfigs[s$]&&(t$.userConfigs[s$].uid=o$)}),this.transcodingConfig=t$,this.connection)try{var i$;let o$=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Pr(i$=this.streamingTasks).call(i$)).map(s$=>s$.taskId).join("#")});_.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(o$.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(o$){if(!o$.data||!o$.data.retry)throw o$;o$.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(s$=>{_.warning("[".concat(this.spec.clientId,"] live streaming receive error"),o$.toString(),"try to republish",s$.url),this.startLiveStreamingTask(s$.url,s$.mode,o$).then(()=>{_.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(s$.url," success"))}).catch(a$=>{_.error("[".concat(this.spec.clientId,"] live streaming republish failed"),s$.url,a$.toString()),this.onLiveStreamError&&this.onLiveStreamError(s$.url,a$)})})}}async startLiveStreamingTask(e$,t$,r$){if(!this.transcodingConfig&&t$===er.TRANSCODE)throw new O(R.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let n$={command:"PublishStream",ts:Date.now(),url:e$,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};_.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e$,", mode: ").concat(t$));let i$=await this.taskMutex.lock();if(!this.connection&&r$)return void i$();if(this.streamingTasks.get(e$)&&!r$)return i$(),new O(R.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t$))}catch(s$){throw i$(),s$}switch(t$){case er.TRANSCODE:n$.transcodingConfig=Tn({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(n$.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let o$=this.lastTaskId++;try{let s$=new j((c$,u$)=>{Me(this.retryTimeout).then(()=>{if(r$)return u$(r$);let l$=this.statusError.get(e$);return l$?(this.statusError.delete(e$),u$(l$)):void 0})}),a$=await j.race([this.connection.request("request",{clientRequest:n$},!0,{url:e$,command:"PublishStream",workerType:t$===er.TRANSCODE?1:2,requestByUser:!r$,tid:o$.toString()}),s$]);this.isStartingStreamingTask=!1,_.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(a$.code)),this.streamingTasks.set(e$,{clientRequest:n$,mode:t$,url:e$,taskId:o$}),i$()}catch(s$){if(i$(),this.isStartingStreamingTask=!1,!s$.data||!s$.data.retry||r$)throw s$;return s$.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e$,t$,s$)):await this.startLiveStreamingTask(e$,t$,s$)}}stopLiveStreamingTask(e$){return new j((t$,r$)=>{let n$=this.streamingTasks.get(e$);if(!n$||!this.connection)return new O(R.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let i$=n$.mode;n$.abortTask=()=>{_.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e$),t$()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:n$.url}},!1,{url:e$,command:"UnPublishStream",workerType:i$===er.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(o$=>{_.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(o$.code)),this.streamingTasks.delete(e$),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),t$()}).catch(r$)})}resetAllTask(){var e$;let t$=Array.from(Pr(e$=this.streamingTasks).call(e$));this.terminate();for(let r$ of t$)this.startLiveStreamingTask(r$.url,r$.mode).catch(n$=>{this.onLiveStreamError&&this.onLiveStreamError(r$.url,n$)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=mn.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e$){if(this.connection)throw new O(R.UNEXPECTED_ERROR,"live streaming connection has already connected");let t$=await Ge(this,VE.REQUEST_WORKER_MANAGER_LIST,e$);return this.uapResponse=t$,this.connection=new Rm(t$.workerToken,this.spec,this.wsRetryConfig,e$),this.connection.on(Xr.WARNING,(r$,n$)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(n$,r$)),this.connection.on(Xr.PUBLISH_STREAM_STATUS,r$=>this.handlePublishStreamServer(r$)),this.connection.on(Xr.REQUEST_NEW_ADDRESS,(r$,n$)=>{if(!this.connection)return n$(new O(R.UNEXPECTED_ERROR,"can not get new live streaming address list"));Ge(this,VE.REQUEST_WORKER_MANAGER_LIST,e$).then(i$=>{this.uapResponse=i$,r$(i$.addressList)}).catch(n$)}),await this.connection.init(t$.addressList),this.connection}handlePublishStreamServer(e$){let t$=e$.serverStatus&&e$.serverStatus.url||"empty_url",r$=this.streamingTasks.get(t$),n$=e$.reason;switch(e$.code){case fe.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case fe.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case fe.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case fe.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let o$=new O(R.LIVE_STREAMING_CDN_ERROR,"",{code:e$.code});if(r$)return _.error(o$.toString()),this.onLiveStreamError&&this.onLiveStreamError(t$,o$);if(!this.isStartingStreamingTask)return;this.statusError.set(t$,o$)}case fe.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let o$=new O(R.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,n$);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t$,o$)}case fe.LIVE_STREAM_RESPONSE_WORKER_LOST:case fe.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var i$;if(!this.connection)return;this.connection.tryNextAddress();let o$=Array.from(Pr(i$=this.streamingTasks).call(i$));for(let s$ of o$)s$.abortTask?s$.abortTask():(_.warning("[".concat(this.spec.clientId,"] publish stream status code"),e$.code,"try to republish",s$.url),this.startLiveStreamingTask(s$.url,s$.mode,new O(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e$.code})).then(()=>{_.debug("[".concat(this.spec.clientId,"] republish live stream success"),s$.url)}).catch(a$=>{_.error(a$.toString()),this.onLiveStreamError&&this.onLiveStreamError(s$.url,a$)}));return}}}hasUrl(e$){return this.streamingTasks.has(e$)}},Y3={name:"LiveStreaming",create:function(e$){return new Cm(e$.joinInfo,e$.websocketRetryConfig||Ee,e$.httpRetryConfig||Ee)}};function q3(e$){let t$=gA();return function(r$,n$){let i$=r$.appId;i$!==void 0&&(yt(n$,10),tr(n$,i$));let o$=r$.cid;o$!==void 0&&(yt(n$,16),yt(n$,o$));let s$=r$.cname;s$!==void 0&&(yt(n$,26),tr(n$,s$));let a$=r$.deviceId;a$!==void 0&&(yt(n$,34),tr(n$,a$));let c$=r$.elapse;c$!==void 0&&(yt(n$,40),Yr(n$,c$));let u$=r$.fileSize;u$!==void 0&&(yt(n$,48),Yr(n$,Cs(u$)));let l$=r$.height;l$!==void 0&&(yt(n$,56),Yr(n$,Cs(l$)));let d$=r$.jpg;d$!==void 0&&(yt(n$,66),yt(n$,d$.length),function(V$,A$){let I$=Ca(V$,A$.length);V$.bytes.set(A$,I$)}(n$,d$));let h$=r$.networkType;h$!==void 0&&(yt(n$,72),Yr(n$,Cs(h$)));let p$=r$.osType;p$!==void 0&&(yt(n$,80),Yr(n$,Cs(p$)));let _$=r$.requestId;_$!==void 0&&(yt(n$,90),tr(n$,_$));let f$=r$.sdkVersion;f$!==void 0&&(yt(n$,98),tr(n$,f$));let m$=r$.sequence;m$!==void 0&&(yt(n$,104),Yr(n$,Cs(m$)));let g$=r$.sid;g$!==void 0&&(yt(n$,114),tr(n$,g$));let v$=r$.timestamp;v$!==void 0&&(yt(n$,120),Yr(n$,v$));let y$=r$.uid;y$!==void 0&&(yt(n$,128),yt(n$,y$));let S$=r$.vid;S$!==void 0&&(yt(n$,136),yt(n$,S$));let b$=r$.width;b$!==void 0&&(yt(n$,144),Yr(n$,Cs(b$)));let $$=r$.service;$$!==void 0&&(yt(n$,152),yt(n$,$$));let C$=r$.callbackData;C$!==void 0&&(yt(n$,162),tr(n$,C$));let N$=r$.jpgEncryption;N$!==void 0&&(yt(n$,168),yt(n$,N$));let k$=r$.requestType;k$!==void 0&&(yt(n$,176),yt(n$,k$));let O$=r$.scorePorn;O$!==void 0&&(yt(n$,185),j_(n$,O$));let U$=r$.scoreSexy;U$!==void 0&&(yt(n$,193),j_(n$,U$));let x$=r$.scoreNeutral;x$!==void 0&&(yt(n$,201),j_(n$,x$));let F$=r$.scene;F$!==void 0&&(yt(n$,208),yt(n$,F$));let L$=r$.ossFilePrefix;L$!==void 0&&(yt(n$,218),tr(n$,L$));let M$=r$.serviceVendor;if(M$!==void 0)for(let V$ of M$){yt(n$,226);let A$=gA();X3(V$,A$),yt(n$,A$.limit),tH(n$,A$),$3(A$)}}(e$,t$),function(r$){let n$=r$.bytes,i$=r$.limit;return n$.length===i$?n$:n$.subarray(0,i$)}(t$)}function z3(e$){return function(r$){let n$={};e:for(;!oN(r$);){let i$=or(r$);switch(i$>>>3){case 0:break e;case 1:n$.code=or(r$);break;case 2:n$.msg=sN(r$,or(r$));break;case 3:{let o$=Q3(r$);n$.data=J3(r$),r$.limit=o$;break}default:iN(r$,7&i$)}}return n$}({bytes:t$=e$,offset:0,limit:t$.length});var t$}function J3(e$){let t$={};e:for(;!oN(e$);){let r$=or(e$);switch(r$>>>3){case 0:break e;case 1:t$.requestId=sN(e$,or(e$));break;case 2:t$.requestType=or(e$)>>>0;break;case 3:t$.scorePorn=B_(e$);break;case 4:t$.scoreSexy=B_(e$);break;case 5:t$.scoreNeutral=B_(e$);break;case 6:t$.requestScene=or(e$)>>>0;break;case 7:t$.scene=or(e$)>>>0;break;default:iN(e$,7&r$)}}return t$}function X3(e$,t$){let r$=e$.service;r$!==void 0&&(yt(t$,8),yt(t$,r$));let n$=e$.vendor;n$!==void 0&&(yt(t$,16),yt(t$,n$));let i$=e$.token;i$!==void 0&&(yt(t$,26),tr(t$,i$));let o$=e$.callbackUrl;o$!==void 0&&(yt(t$,34),tr(t$,o$))}function Q3(e$){let t$=or(e$),r$=e$.limit;return e$.limit=e$.offset+t$,r$}function iN(e$,t$){switch(t$){case 0:for(;128&aN(e$););break;case 2:F_(e$,or(e$));break;case 5:F_(e$,4);break;case 1:F_(e$,8);break;default:throw new Error("Unimplemented type: "+t$)}}var Z3=new Float32Array(1);new Uint8Array(Z3.buffer);var Lf=new Float64Array(1),Rn=new Uint8Array(Lf.buffer);function Cs(e$){return{low:e$|=0,high:e$>>31,unsigned:e$>=0}}var rN=[];function gA(){let e$=rN.pop();return e$?(e$.offset=e$.limit=0,e$):{bytes:new Uint8Array(64),offset:0,limit:0}}function $3(e$){rN.push(e$)}function F_(e$,t$){if(e$.offset+t$>e$.limit)throw new Error("Skip past limit");e$.offset+=t$}function oN(e$){return e$.offset>=e$.limit}function Ca(e$,t$){let r$=e$.bytes,n$=e$.offset,i$=e$.limit,o$=n$+t$;if(o$>r$.length){let s$=new Uint8Array(2*o$);s$.set(r$),e$.bytes=s$}return e$.offset=o$,o$>i$&&(e$.limit=o$),n$}function Mf(e$,t$){let r$=e$.offset;if(r$+t$>e$.limit)throw new Error("Read past limit");return e$.offset+=t$,r$}function sN(e$,t$){let r$=Mf(e$,t$),n$=String.fromCharCode,i$=e$.bytes,o$="",s$="";for(let a$=0;a$<t$;a$++){let c$,u$,l$,d$,h$=i$[a$+r$];128&h$?(224&h$)==192?a$+1>=t$?s$+=o$:(c$=i$[a$+r$+1],(192&c$)!=128?s$+=o$:(d$=(31&h$)<<6|63&c$,d$<128?s$+=o$:(s$+=n$(d$),a$++))):(240&h$)==224?a$+2>=t$?s$+=o$:(c$=i$[a$+r$+1],u$=i$[a$+r$+2],(49344&(c$|u$<<8))!=32896?s$+=o$:(d$=(15&h$)<<12|(63&c$)<<6|63&u$,d$<2048||d$>=55296&&d$<=57343?s$+=o$:(s$+=n$(d$),a$+=2))):(248&h$)==240?a$+3>=t$?s$+=o$:(c$=i$[a$+r$+1],u$=i$[a$+r$+2],l$=i$[a$+r$+3],(12632256&(c$|u$<<8|l$<<16))!=8421504?s$+=o$:(d$=(7&h$)<<18|(63&c$)<<12|(63&u$)<<6|63&l$,d$<65536||d$>1114111?s$+=o$:(d$-=65536,s$+=n$(55296+(d$>>10),56320+(1023&d$)),a$+=3))):s$+=o$:s$+=n$(h$)}return s$}function tr(e$,t$){let r$=t$.length,n$=0;for(let s$=0;s$<r$;s$++){let a$=t$.charCodeAt(s$);a$>=55296&&a$<=56319&&s$+1<r$&&(a$=(a$<<10)+t$.charCodeAt(++s$)-56613888),n$+=a$<128?1:a$<2048?2:a$<65536?3:4}yt(e$,n$);let i$=Ca(e$,n$),o$=e$.bytes;for(let s$=0;s$<r$;s$++){let a$=t$.charCodeAt(s$);a$>=55296&&a$<=56319&&s$+1<r$&&(a$=(a$<<10)+t$.charCodeAt(++s$)-56613888),a$<128?o$[i$++]=a$:(a$<2048?o$[i$++]=a$>>6&31|192:(a$<65536?o$[i$++]=a$>>12&15|224:(o$[i$++]=a$>>18&7|240,o$[i$++]=a$>>12&63|128),o$[i$++]=a$>>6&63|128),o$[i$++]=63&a$|128)}}function tH(e$,t$){let r$=Ca(e$,t$.limit),n$=e$.bytes,i$=t$.bytes;for(let o$=0,s$=t$.limit;o$<s$;o$++)n$[o$+r$]=i$[o$]}function aN(e$){return e$.bytes[Mf(e$,1)]}function TA(e$,t$){let r$=Ca(e$,1);e$.bytes[r$]=t$}function B_(e$){let t$=Mf(e$,8),r$=e$.bytes;return Rn[0]=r$[t$++],Rn[1]=r$[t$++],Rn[2]=r$[t$++],Rn[3]=r$[t$++],Rn[4]=r$[t$++],Rn[5]=r$[t$++],Rn[6]=r$[t$++],Rn[7]=r$[t$++],Lf[0]}function j_(e$,t$){let r$=Ca(e$,8),n$=e$.bytes;Lf[0]=t$,n$[r$++]=Rn[0],n$[r$++]=Rn[1],n$[r$++]=Rn[2],n$[r$++]=Rn[3],n$[r$++]=Rn[4],n$[r$++]=Rn[5],n$[r$++]=Rn[6],n$[r$++]=Rn[7]}function or(e$){let t$,r$=0,n$=0;do t$=aN(e$),r$<32&&(n$|=(127&t$)<<r$),r$+=7;while(128&t$);return n$}function yt(e$,t$){for(t$>>>=0;t$>=128;)TA(e$,127&t$|128),t$>>>=7;TA(e$,t$)}function Yr(e$,t$){let r$=t$.low>>>0,n$=(t$.low>>>28|t$.high<<4)>>>0,i$=t$.high>>>24,o$=i$===0?n$===0?r$<16384?r$<128?1:2:r$<1<<21?3:4:n$<16384?n$<128?5:6:n$<1<<21?7:8:i$<128?9:10,s$=Ca(e$,o$),a$=e$.bytes;switch(o$){case 10:a$[s$+9]=i$>>>7&1;case 9:a$[s$+8]=o$!==9?128|i$:127&i$;case 8:a$[s$+7]=o$!==8?n$>>>21|128:n$>>>21&127;case 7:a$[s$+6]=o$!==7?n$>>>14|128:n$>>>14&127;case 6:a$[s$+5]=o$!==6?n$>>>7|128:n$>>>7&127;case 5:a$[s$+4]=o$!==5?128|n$:127&n$;case 4:a$[s$+3]=o$!==4?r$>>>21|128:r$>>>21&127;case 3:a$[s$+2]=o$!==3?r$>>>14|128:r$>>>14&127;case 2:a$[s$+1]=o$!==2?r$>>>7|128:r$>>>7&127;case 1:a$[s$]=o$!==1?128|r$:127&r$}}function SA(e$,t$){var r$=Object.keys(e$);if(Object.getOwnPropertySymbols){var n$=Object.getOwnPropertySymbols(e$);t$&&(n$=n$.filter(function(i$){return Object.getOwnPropertyDescriptor(e$,i$).enumerable})),r$.push.apply(r$,n$)}return r$}var eH=new Map([["moderation",1],["supervise",2]]);function RA(e$){return{low:e$|=0,high:e$>>31,unsigned:e$>=0}}var Im=class extends Xt{get connectionState(){return this._connectionState}set connectionState(e$){if(this._connectionState===e$)return;let t$=this._connectionState;this._connectionState=e$,this.emit(we.CONNECTION_STATE_CHANGE,t$,e$)}get inspectType(){return this._inspectType}set inspectType(e$){var t$;this._inspectMode=ji(t$=e$.map(r$=>eH.get(r$)||0)).call(t$,(r$,n$)=>r$+n$),this._inspectType=e$}get quality(){return this._quality}set quality(e$){this._quality=e$>1?1:e$<.1?.1:e$,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e$){super(),T(this,"name","AgoraRTCVideoContentInspect"),T(this,"_connectionState",Ei.CONNECTING),T(this,"_innerConnectionState",void 0),T(this,"sequence",0),T(this,"inspectStartTime",void 0),T(this,"workerManagerConnection",void 0),T(this,"workerConnection",void 0),T(this,"workerMessageLengthLimit",void 0),T(this,"inspectIntervalMinimum",void 0),T(this,"qualityRatio",void 0),T(this,"_connectInfo",void 0),T(this,"_cancelTokenSource",mn.CancelToken.source()),T(this,"_retryConfig",void 0),T(this,"wmSequence",0),T(this,"inspectInterval",void 0),T(this,"inspectTimer",null),T(this,"ossFilePrefix",void 0),T(this,"extraInfo",void 0),T(this,"_inspectType",void 0),T(this,"_inspectMode",void 0),T(this,"_quality",1),T(this,"qualityTimer",null),T(this,"_inspectId",void 0),T(this,"_needWorkUrlOnly",!1),T(this,"inspectImage",()=>{if(this.connectionState!==Ei.CONNECTED)throw new O(R.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Ei.CONNECTED?this.requestToInspectImage():_.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Ut(5,"inspect-"),this.workerMessageLengthLimit=v("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=v("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=v("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e$.interval,this.ossFilePrefix=e$.ossFilePrefix,this.extraInfo=e$.extraInfo,this.inspectType=e$.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Qo("worker-manager-"+this._inspectId,Ee),this.on(we.STATE_CHANGE,(t$,r$)=>{this._innerConnectionState=t$,_.debug("[".concat(this._inspectId,"] Inspect operation :").concat(di[t$]," ").concat(r$||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Qo("worker-"+this._inspectId,Ee),this.handleWorkerEvents()}async init(e$,t$){this.emit(we.STATE_CHANGE,di.CONNECT_AP),this._connectInfo=e$;let r$=this._cancelTokenSource.token;return this._retryConfig=t$,new j((n$,i$)=>{this.on(we.CONNECTION_STATE_CHANGE,(o$,s$)=>{s$===Ei.CONNECTED&&n$()}),this.requestAP(e$,r$,t$).then(o$=>{this.connectWorkerManager(o$)}).catch(o$=>{i$(o$)})})}async requestAP(e$,t$,r$){let n$=v("WEBCS_DOMAIN").map(s$=>"https://".concat(s$,"/api/v1")),i$=await function(s$,a$,c$,u$){let{appId:l$,areaCode:d$,cname:h$,sid:p$,token:_$,uid:f$}=a$;Ys++;let m$="image_moderation_api",g$={service_name:m$,json_body:JSON.stringify({appId:l$,areaCode:d$,cname:h$,command:"allocateEdge",requestId:Ys,seq:Ys,sid:p$,token:_$,ts:Date.now(),uid:f$+""})},v$,y$,S$=s$[0];return Wi(async()=>{v$=Date.now();let b$=await Hi(S$,{data:g$,cancelToken:c$,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(y$=Date.now()-v$,b$.code!==0){let k$=new O(R.UNEXPECTED_RESPONSE,"image inspect ap error, code"+b$.code,{retry:!0,responseTime:y$});throw _.error(k$.toString()),k$}let $$=JSON.parse(b$.json_body);if($$.code!==200){let k$=new O(R.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat($$.code,", reason: ").concat($$.reason),{code:$$.code,responseTime:y$});throw _.error(k$.toString()),k$}if(!$$.servers||!Array.isArray($$.servers)||$$.servers.length===0){let k$=new O(R.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:$$.code,responseTime:y$});throw _.error(k$.toString()),k$}let C$=v("VIDEO_INSPECT_WORKER_MANAGER_HOST"),N$=v("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:$$.servers.map(k$=>{let{address:O$,wss:U$}=k$;if(O$&&U$)return"wss://".concat(O$.replace(/\./g,"-"),".").concat(C$,":").concat(N$||U$)}).filter(k$=>!!k$),workerToken:$$.workerToken,vid:$$.vid,responseTime:y$}},(b$,$$)=>(X.apworkerEvent(p$,{success:!0,sc:200,serviceName:m$,responseDetail:JSON.stringify(b$.addressList),firstSuccess:$$===0,responseTime:y$,serverIp:s$[$$%s$.length]}),!1),(b$,$$)=>(X.apworkerEvent(p$,{success:!1,sc:b$.data&&b$.data.code||200,serviceName:m$,responseTime:y$,serverIp:s$[$$%s$.length]}),!!(b$.code!==R.OPERATION_ABORTED&&b$.code!==R.UNEXPECTED_RESPONSE||b$.data&&b$.data.retry)&&(S$=s$[($$+1)%s$.length],!0)),u$)}(n$,e$,t$,r$);this.emit(we.STATE_CHANGE,di.AP_CONNECTED);let{addressList:o$}=i$;return this.wmSequence++,o$}async connectWorkerManager(e$){let t$=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=t$,this.emit(we.STATE_CHANGE,di.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e$,1e4)}async connectWorker(e$){await this.workerConnection.init([e$])}handleWorkerManagerEvents(){this.workerManagerConnection.on(it.CONNECTED,async()=>{this.emit(we.STATE_CHANGE,di.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.22.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(it.CLOSED,()=>{this._innerConnectionState<di.GET_WORKER_MANAGER_RESPONSE&&_.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(it.FAILED,()=>{this._innerConnectionState<di.GET_WORKER_MANAGER_RESPONSE&&_.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(it.RECONNECTING,()=>{this._innerConnectionState<di.GET_WORKER_MANAGER_RESPONSE&&_.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(it.ON_MESSAGE,async e$=>{this.emit(we.STATE_CHANGE,di.GET_WORKER_MANAGER_RESPONSE);let t$=this.workerManagerConnection.url;this.workerManagerConnection.close();let r$=JSON.parse(e$.data);if(r$.code!==200)throw _.error("[".concat(this._inspectId,"] Unexpected code ").concat(r$.code," from worker manager")),new O(R.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r$);if(!(r$.serverResponse&&r$.serverResponse.portWss&&t$))throw _.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r$))),new O(R.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r$);{let n$=v("VIDEO_INSPECT_WORKER_PORT")||r$.serverResponse.portWss,i$=t$.replace(/:\d+\/?$/,":".concat(n$));this.emit(we.STATE_CHANGE,di.CONNECT_WORKER,i$),this._needWorkUrlOnly?this.emit(we.REQUEST_NEW_WORKER_URL,i$):await this.connectWorker(i$)}}),this.workerManagerConnection.on(it.WILL_RECONNECT,(e$,t$,r$)=>{r$(e$)}),this.workerManagerConnection.on(it.REQUEST_NEW_URLS,(e$,t$)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e$).catch(t$)})}handleWorkerEvents(){this.workerConnection.on(it.CONNECTED,async()=>{this.emit(we.STATE_CHANGE,di.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Ei.CONNECTED}),this.workerConnection.on(it.ON_MESSAGE,async e$=>{if(e$.data instanceof ArrayBuffer){let r$=z3(new Uint8Array(e$.data));if(v("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&_.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r$)),r$.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(we.INSPECT_RESULT,void 0,void 0);if(r$.data&&r$.data.scorePorn&&r$.data.scoreSexy&&r$.data.scoreNeutral){var t$;let n$={porn:r$.data.scorePorn,sexy:r$.data.scoreSexy,neutral:r$.data.scoreNeutral},i$=ji(t$=Object.keys(n$)).call(t$,(s$,a$)=>n$[s$]>n$[a$]?s$:a$,"porn"),o$=Object.keys(n$).find(s$=>s$===i$);this.emit(we.INSPECT_RESULT,o$)}else this.emit(we.INSPECT_RESULT,void 0,new O(R.UNEXPECTED_RESPONSE,r$.code+"","There is an unexpected data on message"))}else this.emit(we.INSPECT_RESULT,void 0,new O(R.UNEXPECTED_RESPONSE,r$.code+"",r$.msg))}else _.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(we.INSPECT_RESULT,void 0,new O(R.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(it.CLOSED,()=>{this.connectionState=Ei.CLOSED}),this.workerConnection.on(it.FAILED,()=>{this.connectionState=Ei.CLOSED}),this.workerConnection.on(it.RECONNECTING,()=>{this.connectionState=this.connectionState===Ei.CONNECTED?Ei.RECONNECTING:Ei.CONNECTING}),this.workerConnection.on(it.WILL_RECONNECT,(e$,t$,r$)=>{e$==="recover"&&r$(e$),r$("tryNext")}),this.workerConnection.on(it.REQUEST_NEW_URLS,(e$,t$)=>{this.workerManagerConnection.close(),this.once(we.REQUEST_NEW_WORKER_URL,r$=>{e$([r$])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r$=>{this.connectWorkerManager(r$,!0)}).catch(r$=>{t$(r$)})})}async requestToInspectImage(){this.sequence++;let e$=ni(this,we.CLIENT_LOCAL_VIDEO_TRACK),t$={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e$){if(!e$.isPlaying)return void this.emit(we.INSPECT_RESULT,void 0,new O(R.INVALID_OPERATION,"Only the track being played can be inspected"));let r$=await this.generateRequestData(e$,t$);this.workerConnection.sendMessage(r$,!0,!0)}else this.emit(we.INSPECT_RESULT,void 0,new O(R.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e$,t$){let{appId:r$,cname:n$,cid:i$,vid:o$,sid:s$,uid:a$}=t$,c$=Date.now(),u$=await e$.getCurrentFrameImage("image/jpeg",this.quality),l$=await QO(u$,r$,n$),d$=this.sequence+"-"+i$+"-"+a$+"-"+c$+"-"+Ut(12,""),h$={appId:r$,cid:i$,cname:n$,deviceId:"",elapse:RA(Number(c$-this.inspectStartTime)),fileSize:l$.byteLength,jpgEncryption:2,height:u$.height,width:u$.width,jpg:l$,networkType:6,osType:7,requestId:d$,sdkVersion:"4.22.0",sequence:this.sequence,sid:s$,timestamp:RA(c$),uid:a$,vid:o$,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete h$.callbackData,this.ossFilePrefix===void 0&&delete h$.ossFilePrefix;let p$=q3(h$);if(p$.byteLength<this.workerMessageLengthLimit){if(v("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let _$=function(f$){for(var m$=1;m$<arguments.length;m$++){var g$=arguments[m$]!=null?arguments[m$]:{};m$%2?SA(Object(g$),!0).forEach(function(v$){T(f$,v$,g$[v$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f$,Object.getOwnPropertyDescriptors(g$)):SA(Object(g$)).forEach(function(v$){Object.defineProperty(f$,v$,Object.getOwnPropertyDescriptor(g$,v$))})}return f$}({},h$);delete _$.jpg,_.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(_$))}return p$}{let _$=this.quality*this.qualityRatio;return this.quality=_$,await this.generateRequestData(e$,{appId:r$,cname:n$,cid:i$,vid:o$,sid:s$,uid:a$})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=mn.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Ei.CLOSED,this.emit(we.STATE_CHANGE,di.CLOSED)}},nH={name:"ContentInspect",create:function(e$){let{config:t$}=e$;return function(r$){if(!r$)throw new O(R.INVALID_PARAMS,"inspectConfig is necessary.");if(!r$.inspectType||!Array.isArray(r$.inspectType))throw new O(R.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let n$=[...new Set(r$.inspectType)];n$.forEach(i$=>{var o$;if(!W(o$=["supervise","moderation"]).call(o$,i$))throw new O(R.INVALID_PARAMS,"".concat(i$," is not a valid inspect type."))}),r$.inspectType=n$}if(r$&&r$.extraInfo&&r$.extraInfo.length>1024)throw new O(R.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t$),new Im(t$)}};Ot("PROCESS_ID","process-".concat(Ut(8,""),"-").concat(Ut(4,""),"-").concat(Ut(4,""),"-").concat(Ut(4,""),"-").concat(Ut(12,""))),function(){let e$;try{e$=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t$){return void _.error("Error loading sdk config",t$.message)}if(e$)try{let t$=JSON.parse(window.atob(e$)),r$=Date.now();_.debug("Loading global parameters from cache",t$),Object.keys(t$).forEach(n$=>{if(Object.prototype.hasOwnProperty.call(oe,n$)){let{value:i$,expires:o$}=t$[n$];if(o$&&o$<=r$)return;$r[n$]=i$,oe[n$]=i$}})}catch(t$){_.error("Error loading mutableParamsCache: ".concat(e$),t$.message)}}(),Array.isArray($r.AREAS)&&$r.AREAS.length>0&&Af($r.AREAS,!0);var CA=(e$,t$,r$)=>{_.debug("setParameter key:".concat(e$,", value:").concat(JSON.stringify(t$))),Ot(e$,t$,r$)};Ba(K3,!1),Ba(Y3,!1),Ba(PW,!1),Ba(nH,!1),Ba(H3,!1);var Mt=function(e$){let t$=new Xt,r$=e$,n$={getListeners:t$.getListeners.bind(t$),on:(i$,o$)=>(function(s$,a$){s$===nr.SECURITY_POLICY_VIOLATION&&L0(a$,!0)}(i$,o$),t$.on.bind(t$)(i$,o$)),addListener:t$.addListener.bind(t$),once:t$.once.bind(t$),off:t$.off.bind(t$),removeAllListeners:t$.removeAllListeners.bind(t$),emit:t$.emit.bind(t$),safeEmit:t$.safeEmit.bind(t$)};return Jy(Jy({},r$),n$)}({__TRACK_LIST__:As,VERSION:ii,BUILD:Ef,ESM_BUNDLER:!1,ESM:!0,UMD:!1,DEV:!1,setParameter:CA,getParameter:v,getSupportedCodec:async function(){let e$={audio:[],video:[]};try{let t$=new RTCPeerConnection,r$=await async function(n$){let i$;return ft().supportUnifiedPlan?(n$.addTransceiver("video",{direction:"recvonly"}),n$.addTransceiver("audio",{direction:"recvonly"}),i$=(await n$.createOffer()).sdp):i$=(await n$.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i$}(t$);if(!r$)return e$;t$.close(),t$=null,e$=function(n$){let i$={video:[],audio:[]};return n$.match(/ VP8/i)&&i$.video.push("VP8"),n$.match(/ VP9/i)&&i$.video.push("VP9"),n$.match(/ AV1/i)&&i$.video.push("AV1"),n$.match(/ H264/i)&&i$.video.push("H264"),n$.match(/ H265/i)&&i$.video.push("H265"),n$.match(/ opus/i)&&i$.audio.push("OPUS"),n$.match(/ PCMU/i)&&i$.audio.push("PCMU"),n$.match(/ PCMA/i)&&i$.audio.push("PCMA"),n$.match(/ G722/i)&&i$.audio.push("G722"),i$}(r$)}catch(t$){throw new O(R.CREATE_OFFER_FAILED,t$.toString&&t$.toString()).print()}return e$},checkSystemRequirements:function(){let e$=X.reportApiInvoke(null,{name:Te.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Zt.TRACER}),t$=!1;try{let o$=window.RTCPeerConnection,s$=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,a$=window.WebSocket;t$=!!(o$&&s$&&a$),t$&&lf()&&EO(75)&&new o$().close()}catch(o$){return _.error("check system requirement failed: ",o$),!1}let r$=!1,n$=mt();n$.name===It.CHROME&&Number(n$.version)>=58&&(Vi.engine.name!=="WebKit"||function(){let o$=mt();if(Gl()){if(o$.os===ye.MAC_OS)return!0;if(o$.os===ye.IOS){let s$=Vi.os.version&&Vi.os.version.split(".");if(s$&&Number(s$[0])===14&&s$[1]&&Number(s$[1])>=3||s$&&Number(s$[0])>14)return!0}}return!1}())&&(r$=!0),(n$.name===It.FIREFOX&&Number(n$.version)>=56||n$.name===It.OPERA&&Number(n$.version)>=45||n$.name===It.SAFARI&&Number(n$.version)>=11||n$.name==="WebKit"&&(ln()||vi())&&n$.osVersion&&Number(n$.osVersion.split(".")[0])>=11||TO()||mt().name===It.QQ)&&(r$=!0),_.debug("checkSystemRequirements, api:",t$,"browser",r$);let i$=t$&&r$;return e$.onSuccess(i$),i$},getDevices:function(e$){return Gn.enumerateDevices(!0,!0,e$)},getMicrophones:function(e$){return Gn.getRecordingDevices(e$)},getCameras:function(e$){return Gn.getCamerasDevices(e$)},getElectronScreenSources:KO,getPlaybackDevices:function(e$){return Gn.getSpeakers(e$)},createClient:function(){var e$;let t$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},r$=X.reportApiInvoke(null,{name:Te.CREATE_CLIENT,options:[t$],tag:Zt.TRACER});try{(function(n$){Ce(n$.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Ce(n$.mode,"config.mode",["rtc","live","p2p"]),n$.audioCodec!==void 0&&Ce(n$.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),n$.proxyServer!==void 0&&Pe(n$.proxyServer,"config.proxyServer",1,1e4),n$.turnServer!==void 0&&vO(n$.turnServer),n$.httpRetryConfig!==void 0&&mR(n$.httpRetryConfig),n$.websocketRetryConfig!==void 0&&mR(n$.websocketRetryConfig)})(t$)}catch(n$){throw r$.onError(n$),n$}return(fO(16,0)||gO(16,0))&&(t$.codec==="vp9"&&(t$.codec="vp8",_.debug("browser not support vp9, force use vp8")),Ot("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t$.audioCodec===void 0&&(t$.audioCodec="opus"),r$.onSuccess(),new kW(xi(xi({forceWaitGatewayResponse:!0},t$),{},{role:W(e$=["rtc","p2p"]).call(e$,t$.mode)?"host":t$.role||"audience"}))},createCameraVideoTrack:async function(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t$=v("CAMERA_CAPTURE_CONFIG"),r$=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CREATE_CAM_VIDEO_TRACK,options:[Kt({},e$),t$]});t$&&(e$.encoderConfig=t$);let n$=ru(e$),i$=Ut(8,"track-cam-"),o$=null;_.info("start create camera video track with config",JSON.stringify(e$),"trackId",i$);try{o$=(await Fn({video:n$},i$)).getVideoTracks()[0]||null}catch(a$){throw r$.onError(a$),a$}if(!o$){let a$=new N(R.UNEXPECTED_ERROR,"can not find track in media stream");return r$.onError(a$),a$.throw(_)}e$.optimizationMode&&c_(i$,o$,e$,cr(e$.encoderConfig));let s$=new XE(o$,e$,n$,e$.scalabiltyMode?Fd(e$.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e$.optimizationMode,i$);return r$.onSuccess(s$.getTrackId()),_.info("create camera video success, trackId:",i$),s$},createCustomVideoTrack:function(e$){let t$=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CREATE_CUSTOM_VIDEO_TRACK,options:[e$]}),r$=new Ft(e$.mediaStreamTrack,{width:e$.width,height:e$.height,frameRate:e$.frameRate,bitrateMax:e$.bitrateMax,bitrateMin:e$.bitrateMin},e$.scalabiltyMode?Fd(e$.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e$.optimizationMode,Ut(8,"track-cus-"),[Gt.CUSTOM_TRACK]);return t$.onSuccess(r$.getTrackId()),_.info("create custom video track success with config",e$,"trackId",r$.getTrackId()),r$},createScreenVideoTrack:async function(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",r$=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CREATE_SCREEN_VIDEO_TRACK,options:[Kt({},e$),t$]});e$.encoderConfig?typeof e$.encoderConfig=="string"||e$.encoderConfig.width&&e$.encoderConfig.height||(e$.encoderConfig.width={max:1920},e$.encoderConfig.height={max:1080}):e$.encoderConfig="1080p_2";let n$=function(l$){let d$={};l$.screenSourceType&&(d$.mediaSource=l$.screenSourceType),l$.extensionId&&oo()&&(d$.extensionId=l$.extensionId);let{displaySurface:h$,selfBrowserSurface:p$,surfaceSwitching:_$,systemAudio:f$}=l$;(OE(107)||lR(107)||uR(93))&&(h$&&(Ce(h$,"displaySurface",["browser","window","monitor"]),d$.displaySurface=h$),p$?(Ce(p$,"selfBrowserSurface",["exclude","include"]),d$.selfBrowserSurface=p$):d$.selfBrowserSurface="include",_$&&(Ce(_$,"surfaceSwitching",["exclude","include"]),d$.surfaceSwitching=_$)),(OE(105)||lR(105)||uR(91))&&f$&&(Ce(f$,"systemAudio",["exclude","include"]),d$.systemAudio=f$),l$.electronScreenSourceId&&(d$.sourceId=l$.electronScreenSourceId);let m$=l$.encoderConfig?r_(l$.encoderConfig):null;return d$.mandatory={chromeMediaSource:"desktop",maxWidth:m$?m$.width:void 0,maxHeight:m$?m$.height:void 0},m$&&(m$.frameRate&&(typeof m$.frameRate=="number"?(d$.mandatory.maxFrameRate=m$.frameRate,d$.mandatory.minFrameRate=m$.frameRate):(d$.mandatory.maxFrameRate=m$.frameRate.max||m$.frameRate.ideal||m$.frameRate.exact||void 0,d$.mandatory.minFrameRate=m$.frameRate.min||m$.frameRate.ideal||m$.frameRate.exact||void 0),d$.frameRate=m$.frameRate),m$.width&&(d$.width=m$.width),m$.height&&(d$.height=m$.height)),d$}(e$),i$=Ut(8,"track-scr-v-"),o$=null,s$=null,a$=ft();if(!a$.supportShareAudio&&t$==="enable"){let l$=new N(R.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r$.onError(l$),l$.throw(_)}_.info("start create screen video track with config",e$,"withAudio",t$,"trackId",i$);try{let l$=await Fn({screen:n$,screenAudio:t$==="auto"?a$.supportShareAudio:t$==="enable"},i$);o$=l$.getVideoTracks()[0]||null,s$=l$.getAudioTracks()[0]||null}catch(l$){throw r$.onError(l$),l$}if(!o$){let l$=new N(R.UNEXPECTED_ERROR,"can not find track in media stream");return r$.onError(l$),l$.throw(_)}if(!s$&&t$==="enable"){o$&&o$.stop();let l$=new N(R.SHARE_AUDIO_NOT_ALLOWED);return r$.onError(l$),l$.throw(_)}e$.optimizationMode||(e$.optimizationMode="detail"),e$.optimizationMode&&(c_(i$,o$,e$,e$.encoderConfig&&r_(e$.encoderConfig)||void 0),e$.encoderConfig&&typeof e$.encoderConfig!="string"&&(e$.encoderConfig.bitrateMin=e$.encoderConfig.bitrateMax));let c$=new Ft(o$,e$.encoderConfig?r_(e$.encoderConfig):{},e$.scalabiltyMode?Fd(e$.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e$.optimizationMode,i$,[Gt.SCREEN_TRACK]);if(!s$)return r$.onSuccess(c$.getTrackId()),_.info("create screen video track success","video:",c$.getTrackId()),c$;let u$=new Qt(s$,void 0,Ut(8,"track-scr-a-"),!1);return r$.onSuccess([c$.getTrackId(),u$.getTrackId()]),_.info("create screen video track success","video:",c$.getTrackId(),"audio:",u$.getTrackId()),[c$,u$]},createMicrophoneAndCameraTracks:async function(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r$=v("CAMERA_CAPTURE_CONFIG"),n$=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CREATE_MIC_AND_CAM_TRACKS,options:[e$,t$,r$]});r$&&(t$.encoderConfig=r$);let i$=ru(t$),o$=fC(e$),s$=Ut(8,"track-mic-"),a$=Ut(8,"track-cam-"),c$=null,u$=null;_.info("start create camera video track(".concat(a$,") and microphone audio track(").concat(s$,") with config, audio: ").concat(JSON.stringify(e$),", video: ").concat(JSON.stringify(t$)));try{let h$=await Fn({audio:o$,video:i$},"".concat(s$,"-").concat(a$));c$=h$.getAudioTracks()[0],u$=h$.getVideoTracks()[0]}catch(h$){throw n$.onError(h$),h$}if(!c$||!u$){let h$=new N(R.UNEXPECTED_ERROR,"can not find tracks in media stream");return n$.onError(h$),h$.throw(_)}t$.optimizationMode&&c_(a$,u$,t$,cr(t$.encoderConfig));let l$=new ou(c$,e$,o$,s$),d$=new XE(u$,t$,i$,t$.scalabiltyMode?Fd(t$.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t$.optimizationMode,a$);return n$.onSuccess([l$.getTrackId(),d$.getTrackId()]),_.info("create camera video track(".concat(a$,") and microphone audio track(").concat(s$,") success")),[l$,d$]},createMicrophoneAudioTrack:async function(){let e$=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t$=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CREATE_MIC_AUDIO_TRACK,options:[e$]}),r$=fC(e$),n$=Ut(8,"track-mic-"),i$=null;_.info("start create microphone audio track with config",JSON.stringify(e$),"trackId",n$);try{i$=(await Fn({audio:r$},n$)).getAudioTracks()[0]||null}catch(s$){throw t$.onError(s$),s$}if(!i$){let s$=new N(R.UNEXPECTED_ERROR,"can not find track in media stream");return t$.onError(s$),s$.throw(_)}let o$=new ou(i$,e$,r$,n$);return t$.onSuccess(o$.getTrackId()),_.info("create microphone audio track success, trackId:",n$),o$},createCustomAudioTrack:function(e$){let t$=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CREATE_CUSTOM_AUDIO_TRACK,options:[e$]}),r$=new Qt(e$.mediaStreamTrack,e$.encoderConfig?Jl(e$.encoderConfig):{},Ut(8,"track-cus-"),!1);return _.info("create custom audio track success with config",e$,"trackId",r$.getTrackId()),t$.onSuccess(r$.getTrackId()),r$},createBufferSourceAudioTrack:async function(e$){var t$;let{cacheOnlineFile:r$,encoderConfig:n$}=e$,{source:i$}=e$,o$={source:i$ instanceof AudioBuffer?"AudioBuffer":i$ instanceof File?(t$=File.name)!==null&&t$!==void 0?t$:"File":i$,cacheOnlineFile:r$,encoderConfig:n$},s$=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CREATE_BUFFER_AUDIO_TRACK,options:[o$]});if(v("DISABLE_WEBAUDIO"))throw new N(R.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");let a$=Ut(8,"track-buf-");_.info("start create buffer source audio track with config",JSON.stringify(o$),"trackId",a$);let c$=i$;if(!(i$ instanceof AudioBuffer))try{i$=await async function(d$,h$){let p$=null;if(typeof d$=="string"){let f$=eI.get(d$);if(f$)return _.debug("use cached audio resource: ",d$),f$;try{p$=(await Wi(()=>mn.get(d$,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(m$){throw new N(R.FETCH_AUDIO_FILE_FAILED,m$.toString())}}else p$=await new j((f$,m$)=>{let g$=new FileReader;g$.onload=v$=>{v$.target?f$(v$.target.result):m$(new N(R.READ_LOCAL_AUDIO_FILE_ERROR))},g$.onerror=()=>{m$(new N(R.READ_LOCAL_AUDIO_FILE_ERROR))},g$.readAsArrayBuffer(d$)});let _$=await function(f$){let m$=ga();return new j((g$,v$)=>{m$.decodeAudioData(f$,y$=>{g$(y$)},y$=>{v$(new N(R.DECODE_AUDIO_FILE_FAILED,y$.toString()))})})}(p$);return typeof d$=="string"&&h$&&eI.set(d$,_$),_$}(i$,r$)}catch(d$){return s$.onError(d$),d$.throw(_)}let u$=new JE(i$),l$=new VG(c$,u$,n$?Jl(n$):{},a$);return _.info("create buffer source audio track success, trackId:",a$),s$.onSuccess(l$.getTrackId()),l$},setAppType:function(e$){if(_.debug("setAppType: ".concat(e$)),!(Number.isInteger(e$)&&e$>=0))throw _.debug("Invalid appType"),new O(R.INVALID_PARAMS,"invalid app type",e$);Ot("APP_TYPE",Math.floor(e$))},setLogLevel:function(e$){_.setLogLevel(e$)},enableLogUpload:function(){v("USE_NEW_LOG")?Ot("UPLOAD_LOG",!0):_.enableLogUpload()},disableLogUpload:function(){v("USE_NEW_LOG")?Ot("UPLOAD_LOG",!1):_.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new Eu},checkAudioTrackIsActive:async function(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r$=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t$]});if(!(e$ instanceof Qt||e$ instanceof Ks)){let c$=new O(R.INVALID_TRACK,"the parameter is not a audio track");return r$.onError(c$),c$.throw()}t$&&t$<1e3&&(t$=1e3);let n$=e$ instanceof Qt?e$.getTrackLabel():"remote_track",i$=e$.getVolumeLevel(),o$=i$,s$=i$,a$=Date.now();return new j(c$=>{let u$=setInterval(()=>{let l$=e$.getVolumeLevel();o$=l$>o$?l$:o$,s$=l$<s$?l$:s$;let d$=o$-s$>1e-4,h$=Date.now()-a$;if(d$||h$>t$){clearInterval(u$);let p$=d$,_$={duration:h$,deviceLabel:n$,maxVolumeLevel:o$,result:p$};_.info("[track-".concat(e$.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(_$))),r$.onSuccess(_$),c$(p$)}},200)})},checkVideoTrackIsActive:async function(e$){let t$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r$=X.reportApiInvoke(null,{tag:Zt.TRACER,name:Te.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t$]});if(!(e$ instanceof Ft||e$ instanceof Hs)){let d$=new O(R.INVALID_TRACK,"the parameter is not a video track");return r$.onError(d$),d$.throw()}t$&&t$<1e3&&(t$=1e3);let n$=e$ instanceof Ft?e$.getTrackLabel():"remote_track",i$=e$.getMediaStreamTrack(!0),o$=document.createElement("video");o$.style.width="1px",o$.style.height="1px",o$.setAttribute("muted",""),o$.muted=!0,o$.setAttribute("playsinline",""),o$.controls=!1,(je()||Gl())&&(o$.style.opacity="0.01",o$.style.position="fixed",o$.style.left="0",o$.style.top="0",document.body.appendChild(o$)),o$.srcObject=new MediaStream([i$]),o$.play();let s$=document.createElement("canvas");s$.width=160,s$.height=120;let a$=0,c$=0;try{let d$=Date.now();a$=await function(h$,p$,_$,f$){let m$,g$=0,v$=null;return new j((y$,S$)=>{function b$(){g$>f$&&m$&&(m$(),y$(g$));let $$=_$.getContext("2d");if(!$$){let k$=new O(R.UNEXPECTED_ERROR,"can not get canvas 2d context.");return _.error(k$.toString()),void S$(k$)}$$.drawImage(h$,0,0,160,120);let C$=$$.getImageData(0,0,_$.width,_$.height),N$=Math.floor(C$.data.length/3);if(v$){for(let k$=0;k$<N$;k$+=3)if(C$.data[k$]!==v$[k$])return g$+=1,void(v$=C$.data);v$=C$.data}else v$=C$.data}setTimeout(()=>{m$&&(m$(),y$(g$))},p$),m$=Rf(()=>{b$()},30)})}(o$,t$,s$,4),c$=Date.now()-d$}catch(d$){throw r$.onError(d$),d$}gW===It.SAFARI&&(o$.pause(),o$.remove()),o$.srcObject=null;let u$=a$>4,l$={duration:c$,changedPicNum:a$,deviceLabel:n$,result:u$};return _.info("[track-".concat(e$.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(l$))),r$.onSuccess(l$),u$},setArea:Af,audioElementPlayCenter:En,resumeAudioContext:function(){En.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e$){MW.processExternalMediaAEC(e$)},registerExtensions:function(e$){let t$=v("PLUGIN_INFO")||[];e$.forEach(r$=>{"name"in r$&&!W(t$).call(t$,r$.name)&&t$.push(r$.name);let n$=r$;n$.__registered__=!0,n$.logger.hookLog=_.extLog,n$.reporter.hookApiInvoke=X.extApiInvoke,n$.parameters&&Object.keys(n$.parameters).forEach(i$=>{n$.parameters[i$]=v(i$)})}),CA("PLUGIN_INFO",t$)},ChannelMediaRelayError:ys,ChannelMediaRelayEvent:Ir,ChannelMediaRelayState:Sn,RemoteStreamFallbackType:PG,RemoteStreamType:DG,ConnectionDisconnectedReason:At,AudienceLatencyLevelType:EB,AREAS:St,preload:async function(e$,t$,r$,n$){return y0(e$,t$,r$,n$)}});Object.defineProperties(Mt,{onAudioAutoplayFailed:{get:()=>Un.onAudioAutoplayFailed,set:e$=>{Un.onAudioAutoplayFailed=e$}},onAutoplayFailed:{get:()=>Un.onAutoplayFailed,set:e$=>{Un.onAutoplayFailed=e$}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Mt._onSecurityPolicyViolation,set(e$){Mt._onSecurityPolicyViolation=e$,L0(e$)}},__CLIENT_LIST__:{get:()=>v("SHOW_GLOBAL_CLIENT_LIST")?Jr:[]}}),Gn.on(Bo.CAMERA_DEVICE_CHANGED,e$=>{_.info("camera device changed",JSON.stringify(e$)),Mt.onCameraChanged&&Mt.onCameraChanged(e$),Mt.safeEmit(nr.CAMERA_CHANGED,e$)}),Gn.on(Bo.RECORDING_DEVICE_CHANGED,e$=>{_.info("microphone device changed",JSON.stringify(e$)),Mt.onMicrophoneChanged&&Mt.onMicrophoneChanged(e$),Mt.safeEmit(nr.MICROPHONE_CHANGED,e$)}),Gn.on(Bo.PLAYOUT_DEVICE_CHANGED,e$=>{_.debug("playout device changed",JSON.stringify(e$)),Mt.onPlaybackDeviceChanged&&Mt.onPlaybackDeviceChanged(e$),Mt.safeEmit(nr.PLAYBACK_DEVICE_CHANGED,e$)}),En.onAutoplayFailed=()=>{_.info("detect audio element autoplay failed"),Un.onAudioAutoplayFailed&&Un.onAudioAutoplayFailed()},wt.on("autoplay-failed",()=>{_.info("detect webaudio autoplay failed"),Un.onAudioAutoplayFailed&&Un.onAudioAutoplayFailed(),Mt.safeEmit(nr.AUTOPLAY_FAILED)}),wt.on(ke.STATE_CHANGE,(e$,t$)=>{_.info("audio context state changed: ".concat(t$," => ").concat(e$)),Mt.onAudioContextStateChanged&&Mt.onAudioContextStateChanged(e$,t$),Mt.safeEmit(nr.AUDIO_CONTEXT_STATE_CHANGED,e$,t$)}),he.on(ks.NETWORK_STATE_CHANGE,(e$,t$)=>{_.info("[network-indicator] network state changed, ".concat(t$," => ").concat(e$))}),window&&(window.__ARTC__=Mt);var pN=reactExports.createContext(null);function K5({client:e$,children:t$}){return jsxRuntimeExports.jsx(pN.Provider,{value:e$,children:t$})}reactExports.createContext(null);reactExports.createContext(void 0);var zf=class{constructor(){T5(this,"appType",1001);Mt.setAppType(this.appType)}};new zf;var U6=Mt;const client=U6.createClient({mode:"rtc",codec:"vp8"});createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(reactExports.StrictMode,{children:jsxRuntimeExports.jsx(K5,{client,children:jsxRuntimeExports.jsx(App,{})})}));
